{"version":3,"file":"js/npm.plotly.js.8fae92bf.js","mappings":"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/E,YAAa,CACT,wCACA,6CACA,6CACA,6DACA,8BACFC,KAAK,MAEXy4E,gBAAiB,CACb34E,QAAS,UACTgF,MAAM,EACN/E,YAAa,CACT,sEACA,+FACA,sFACA,yEACA,sFACA,wEACA,qEACFC,KAAK,MAEXw4E,sBAAuB,CACnB14E,QAAS,UACTgF,MAAM,EACN/E,YAAa,CACT,6EACA,8EACA,iDACFC,KAAK,MAEX62E,uBAAwB,CACpB/2E,QAAS,MACTgF,KAAM,GACN/E,YAAa,CACT,mCACA,8DACFC,KAAK,MAEX+2E,oBAAqB,CACjBj3E,QAAS,MACTgF,KAAM,GACN/E,YAAa,CACT,2CACA,6DACA,iFACA,2DACA,oFACA,2FACA,sFACA,yCACFC,KAAK,MAEXyuE,eAAgB,CACZ3uE,QAAS,MACTgF,MAAM,EACN/E,YAAa,CACT,wDACA,uDACA,2EACA,sDACFC,KAAK,MAEXmyE,qBAAsB,CAClBryE,QAAS,MACTgF,KAAM,GACN/E,YAAa,CACT,yDACA,0DACA,wCACFC,KAAK,MAEXs6E,YAAa,CACTx6E,QAAS,UACTgF,MAAM,EACN/E,YAAa,CACT,yDACA,+BACFC,KAAK,MAEX42E,UAAW,CACP92E,QAAS,UACTgF,MAAM,EACN/E,YAAa,gDAGjBmuI,iBAAkB,CACdpuI,QAAS,SACTgF,KAAM,EACNqE,IAAK,EACLC,IAAK,EACLrJ,YAAa,CACT,iDACA,2DACA,4BACFC,KAAK,MAGX6tI,cAAe,CACX/tI,QAAS,MACTgF,KAAM,cACN/E,YAAa,CACT,uEACA,4BACA,gFACA,4BACA,6EACFC,KAAK,MAGXwkJ,YAAa,CACT1kJ,QAAS,SACTmzG,SAAS,EACTnuG,KAAM,uBACN/E,YAAa,CACT,8CACA,+DACA,mCACA,qCACA,0DACA,wCACFC,KAAK,MAGXykJ,kBAAmB,CACf3kJ,QAAS,SACTgF,KAAM,KACN/E,YAAa,CACT,4DACA,yDACA,gFACFC,KAAK,MAGXivH,QAAS,CACLnvH,QAAS,UACTqJ,IAAK,EACLC,IAAK,EACLtE,KAAM,EACN/E,YAAa,CACT,6DACA,mDACA,oBACA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","sources":["webpack://wellcast/./node_modules/plotly.js/build/plotcss.js","webpack://wellcast/./node_modules/plotly.js/lib/aggregate.js","webpack://wellcast/./node_modules/plotly.js/lib/bar.js","webpack://wellcast/./node_modules/plotly.js/lib/box.js","webpack://wellcast/./node_modules/plotly.js/lib/calendars.js","webpack://wellcast/./node_modules/plotly.js/lib/contour.js","webpack://wellcast/./node_modules/plotly.js/lib/core.js","webpack://wellcast/./node_modules/plotly.js/lib/filter.js","webpack://wellcast/./node_modules/plotly.js/lib/groupby.js","webpack://wellcast/./node_modules/plotly.js/lib/heatmap.js","webpack://wellcast/./node_modules/plotly.js/lib/histogram.js","webpack://wellcast/./node_modules/plotly.js/lib/histogram2d.js","webpack://wellcast/./node_modules/plotly.js/lib/histogram2dcontour.js","webpack://wellcast/./node_modules/plotly.js/lib/image.js","webpack://wellcast/./node_modules/plotly.js/lib/index-cartesian.js","webpack://wellcast/./node_modules/plotly.js/lib/pie.js","webpack://wellcast/./node_modules/plotly.js/lib/scatterternary.js","webpack://wellcast/./node_modules/plotly.js/lib/sort.js","webpack://wellcast/./node_modules/plotly.js/lib/violin.js","webpack://wellcast/./node_modules/plotly.js/src/components/annotations3d/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/annotations3d/convert.js","webpack://wellcast/./node_modules/plotly.js/src/components/annotations3d/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/annotations3d/draw.js","webpack://wellcast/./node_modules/plotly.js/src/components/annotations3d/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/annotations/arrow_paths.js","webpack://wellcast/./node_modules/plotly.js/src/components/annotations/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/annotations/calc_autorange.js","webpack://wellcast/./node_modules/plotly.js/src/components/annotations/click.js","webpack://wellcast/./node_modules/plotly.js/src/components/annotations/common_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/annotations/convert_coords.js","webpack://wellcast/./node_modules/plotly.js/src/components/annotations/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/annotations/draw.js","webpack://wellcast/./node_modules/plotly.js/src/components/annotations/draw_arrow_head.js","webpack://wellcast/./node_modules/plotly.js/src/components/annotations/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/calendars/calendars.js","webpack://wellcast/./node_modules/plotly.js/src/components/calendars/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/color/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/color/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/colorbar/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/colorbar/constants.js","webpack://wellcast/./node_modules/plotly.js/src/components/colorbar/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/colorbar/draw.js","webpack://wellcast/./node_modules/plotly.js/src/components/colorbar/has_colorbar.js","webpack://wellcast/./node_modules/plotly.js/src/components/colorbar/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/colorscale/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/colorscale/calc.js","webpack://wellcast/./node_modules/plotly.js/src/components/colorscale/cross_trace_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/colorscale/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/colorscale/helpers.js","webpack://wellcast/./node_modules/plotly.js/src/components/colorscale/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/colorscale/layout_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/colorscale/layout_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/colorscale/scales.js","webpack://wellcast/./node_modules/plotly.js/src/components/dragelement/align.js","webpack://wellcast/./node_modules/plotly.js/src/components/dragelement/cursor.js","webpack://wellcast/./node_modules/plotly.js/src/components/dragelement/helpers.js","webpack://wellcast/./node_modules/plotly.js/src/components/dragelement/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/dragelement/unhover.js","webpack://wellcast/./node_modules/plotly.js/src/components/drawing/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/drawing/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/drawing/symbol_defs.js","webpack://wellcast/./node_modules/plotly.js/src/components/errorbars/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/errorbars/calc.js","webpack://wellcast/./node_modules/plotly.js/src/components/errorbars/compute_error.js","webpack://wellcast/./node_modules/plotly.js/src/components/errorbars/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/errorbars/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/errorbars/plot.js","webpack://wellcast/./node_modules/plotly.js/src/components/errorbars/style.js","webpack://wellcast/./node_modules/plotly.js/src/components/fx/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/fx/calc.js","webpack://wellcast/./node_modules/plotly.js/src/components/fx/click.js","webpack://wellcast/./node_modules/plotly.js/src/components/fx/constants.js","webpack://wellcast/./node_modules/plotly.js/src/components/fx/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/fx/helpers.js","webpack://wellcast/./node_modules/plotly.js/src/components/fx/hover.js","webpack://wellcast/./node_modules/plotly.js/src/components/fx/hoverlabel_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/fx/hovermode_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/fx/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/fx/layout_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/fx/layout_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/fx/layout_global_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/grid/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/images/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/images/convert_coords.js","webpack://wellcast/./node_modules/plotly.js/src/components/images/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/images/draw.js","webpack://wellcast/./node_modules/plotly.js/src/components/images/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/legend/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/legend/constants.js","webpack://wellcast/./node_modules/plotly.js/src/components/legend/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/legend/draw.js","webpack://wellcast/./node_modules/plotly.js/src/components/legend/get_legend_data.js","webpack://wellcast/./node_modules/plotly.js/src/components/legend/handle_click.js","webpack://wellcast/./node_modules/plotly.js/src/components/legend/helpers.js","webpack://wellcast/./node_modules/plotly.js/src/components/legend/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/legend/style.js","webpack://wellcast/./node_modules/plotly.js/src/components/modebar/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/modebar/buttons.js","webpack://wellcast/./node_modules/plotly.js/src/components/modebar/constants.js","webpack://wellcast/./node_modules/plotly.js/src/components/modebar/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/modebar/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/modebar/manage.js","webpack://wellcast/./node_modules/plotly.js/src/components/modebar/modebar.js","webpack://wellcast/./node_modules/plotly.js/src/components/rangeselector/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/rangeselector/constants.js","webpack://wellcast/./node_modules/plotly.js/src/components/rangeselector/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/rangeselector/draw.js","webpack://wellcast/./node_modules/plotly.js/src/components/rangeselector/get_update_object.js","webpack://wellcast/./node_modules/plotly.js/src/components/rangeselector/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/rangeslider/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/rangeslider/calc_autorange.js","webpack://wellcast/./node_modules/plotly.js/src/components/rangeslider/constants.js","webpack://wellcast/./node_modules/plotly.js/src/components/rangeslider/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/rangeslider/draw.js","webpack://wellcast/./node_modules/plotly.js/src/components/rangeslider/helpers.js","webpack://wellcast/./node_modules/plotly.js/src/components/rangeslider/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/rangeslider/oppaxis_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/shapes/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/shapes/calc_autorange.js","webpack://wellcast/./node_modules/plotly.js/src/components/shapes/constants.js","webpack://wellcast/./node_modules/plotly.js/src/components/shapes/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/shapes/draw.js","webpack://wellcast/./node_modules/plotly.js/src/components/shapes/draw_newshape/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/shapes/draw_newshape/constants.js","webpack://wellcast/./node_modules/plotly.js/src/components/shapes/draw_newshape/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/shapes/draw_newshape/display_outlines.js","webpack://wellcast/./node_modules/plotly.js/src/components/shapes/draw_newshape/helpers.js","webpack://wellcast/./node_modules/plotly.js/src/components/shapes/draw_newshape/newshapes.js","webpack://wellcast/./node_modules/plotly.js/src/components/shapes/helpers.js","webpack://wellcast/./node_modules/plotly.js/src/components/shapes/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/sliders/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/sliders/constants.js","webpack://wellcast/./node_modules/plotly.js/src/components/sliders/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/sliders/draw.js","webpack://wellcast/./node_modules/plotly.js/src/components/sliders/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/titles/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/updatemenus/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/components/updatemenus/constants.js","webpack://wellcast/./node_modules/plotly.js/src/components/updatemenus/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/components/updatemenus/draw.js","webpack://wellcast/./node_modules/plotly.js/src/components/updatemenus/index.js","webpack://wellcast/./node_modules/plotly.js/src/components/updatemenus/scrollbox.js","webpack://wellcast/./node_modules/plotly.js/src/constants/alignment.js","webpack://wellcast/./node_modules/plotly.js/src/constants/axis_placeable_objects.js","webpack://wellcast/./node_modules/plotly.js/src/constants/docs.js","webpack://wellcast/./node_modules/plotly.js/src/constants/filter_ops.js","webpack://wellcast/./node_modules/plotly.js/src/constants/interactions.js","webpack://wellcast/./node_modules/plotly.js/src/constants/numerical.js","webpack://wellcast/./node_modules/plotly.js/src/constants/xmlns_namespaces.js","webpack://wellcast/./node_modules/plotly.js/src/core.js","webpack://wellcast/./node_modules/plotly.js/src/fonts/ploticon.js","webpack://wellcast/./node_modules/plotly.js/src/lib/anchor_utils.js","webpack://wellcast/./node_modules/plotly.js/src/lib/angles.js","webpack://wellcast/./node_modules/plotly.js/src/lib/array.js","webpack://wellcast/./node_modules/plotly.js/src/lib/clean_number.js","webpack://wellcast/./node_modules/plotly.js/src/lib/clear_gl_canvases.js","webpack://wellcast/./node_modules/plotly.js/src/lib/clear_responsive.js","webpack://wellcast/./node_modules/plotly.js/src/lib/coerce.js","webpack://wellcast/./node_modules/plotly.js/src/lib/dates.js","webpack://wellcast/./node_modules/plotly.js/src/lib/dom.js","webpack://wellcast/./node_modules/plotly.js/src/lib/events.js","webpack://wellcast/./node_modules/plotly.js/src/lib/extend.js","webpack://wellcast/./node_modules/plotly.js/src/lib/filter_unique.js","webpack://wellcast/./node_modules/plotly.js/src/lib/filter_visible.js","webpack://wellcast/./node_modules/plotly.js/src/lib/geometry2d.js","webpack://wellcast/./node_modules/plotly.js/src/lib/identity.js","webpack://wellcast/./node_modules/plotly.js/src/lib/increment.js","webpack://wellcast/./node_modules/plotly.js/src/lib/index.js","webpack://wellcast/./node_modules/plotly.js/src/lib/is_plain_object.js","webpack://wellcast/./node_modules/plotly.js/src/lib/keyed_container.js","webpack://wellcast/./node_modules/plotly.js/src/lib/localize.js","webpack://wellcast/./node_modules/plotly.js/src/lib/loggers.js","webpack://wellcast/./node_modules/plotly.js/src/lib/make_trace_groups.js","webpack://wellcast/./node_modules/plotly.js/src/lib/matrix.js","webpack://wellcast/./node_modules/plotly.js/src/lib/mod.js","webpack://wellcast/./node_modules/plotly.js/src/lib/nested_property.js","webpack://wellcast/./node_modules/plotly.js/src/lib/noop.js","webpack://wellcast/./node_modules/plotly.js/src/lib/notifier.js","webpack://wellcast/./node_modules/plotly.js/src/lib/override_cursor.js","webpack://wellcast/./node_modules/plotly.js/src/lib/polygon.js","webpack://wellcast/./node_modules/plotly.js/src/lib/preserve_drawing_buffer.js","webpack://wellcast/./node_modules/plotly.js/src/lib/push_unique.js","webpack://wellcast/./node_modules/plotly.js/src/lib/queue.js","webpack://wellcast/./node_modules/plotly.js/src/lib/regex.js","webpack://wellcast/./node_modules/plotly.js/src/lib/relative_attr.js","webpack://wellcast/./node_modules/plotly.js/src/lib/relink_private.js","webpack://wellcast/./node_modules/plotly.js/src/lib/search.js","webpack://wellcast/./node_modules/plotly.js/src/lib/setcursor.js","webpack://wellcast/./node_modules/plotly.js/src/lib/stats.js","webpack://wellcast/./node_modules/plotly.js/src/lib/svg_text_utils.js","webpack://wellcast/./node_modules/plotly.js/src/lib/throttle.js","webpack://wellcast/./node_modules/plotly.js/src/lib/to_log_range.js","webpack://wellcast/./node_modules/plotly.js/src/locale-en-us.js","webpack://wellcast/./node_modules/plotly.js/src/locale-en.js","webpack://wellcast/./node_modules/plotly.js/src/plot_api/container_array_match.js","webpack://wellcast/./node_modules/plotly.js/src/plot_api/edit_types.js","webpack://wellcast/./node_modules/plotly.js/src/plot_api/helpers.js","webpack://wellcast/./node_modules/plotly.js/src/plot_api/index.js","webpack://wellcast/./node_modules/plotly.js/src/plot_api/manage_arrays.js","webpack://wellcast/./node_modules/plotly.js/src/plot_api/plot_api.js","webpack://wellcast/./node_modules/plotly.js/src/plot_api/plot_config.js","webpack://wellcast/./node_modules/plotly.js/src/plot_api/plot_schema.js","webpack://wellcast/./node_modules/plotly.js/src/plot_api/plot_template.js","webpack://wellcast/./node_modules/plotly.js/src/plot_api/subroutines.js","webpack://wellcast/./node_modules/plotly.js/src/plot_api/template_api.js","webpack://wellcast/./node_modules/plotly.js/src/plot_api/to_image.js","webpack://wellcast/./node_modules/plotly.js/src/plot_api/validate.js","webpack://wellcast/./node_modules/plotly.js/src/plots/animation_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/plots/array_container_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/plots/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/align_period.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/autorange.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/axes.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/axis_autotype.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/axis_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/axis_format_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/axis_ids.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/category_order_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/clean_ticks.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/constants.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/constraints.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/dragbox.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/graph_interact.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/handle_outline.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/helpers.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/include_components.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/index.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/layout_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/layout_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/line_grid_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/position_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/scale_zoom.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/select.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/set_convert.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/tick_label_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/tick_mark_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/tick_value_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/transition_axes.js","webpack://wellcast/./node_modules/plotly.js/src/plots/cartesian/type_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/plots/command.js","webpack://wellcast/./node_modules/plotly.js/src/plots/domain.js","webpack://wellcast/./node_modules/plotly.js/src/plots/font_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/plots/frame_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/plots/get_data.js","webpack://wellcast/./node_modules/plotly.js/src/plots/gl3d/project.js","webpack://wellcast/./node_modules/plotly.js/src/plots/layout_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/plots/pad_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/plots/plots.js","webpack://wellcast/./node_modules/plotly.js/src/plots/subplot_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/plots/template_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/plots/ternary/index.js","webpack://wellcast/./node_modules/plotly.js/src/plots/ternary/layout_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/plots/ternary/layout_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/plots/ternary/ternary.js","webpack://wellcast/./node_modules/plotly.js/src/registry.js","webpack://wellcast/./node_modules/plotly.js/src/snapshot/cloneplot.js","webpack://wellcast/./node_modules/plotly.js/src/snapshot/download.js","webpack://wellcast/./node_modules/plotly.js/src/snapshot/filesaver.js","webpack://wellcast/./node_modules/plotly.js/src/snapshot/helpers.js","webpack://wellcast/./node_modules/plotly.js/src/snapshot/index.js","webpack://wellcast/./node_modules/plotly.js/src/snapshot/svgtoimg.js","webpack://wellcast/./node_modules/plotly.js/src/snapshot/toimage.js","webpack://wellcast/./node_modules/plotly.js/src/snapshot/tosvg.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/arrays_to_calcdata.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/calc.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/constants.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/cross_trace_calc.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/event_data.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/helpers.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/hover.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/index.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/layout_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/layout_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/plot.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/select.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/sieve.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/style.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/style_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/bar/uniform_text.js","webpack://wellcast/./node_modules/plotly.js/src/traces/box/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/box/calc.js","webpack://wellcast/./node_modules/plotly.js/src/traces/box/cross_trace_calc.js","webpack://wellcast/./node_modules/plotly.js/src/traces/box/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/box/event_data.js","webpack://wellcast/./node_modules/plotly.js/src/traces/box/hover.js","webpack://wellcast/./node_modules/plotly.js/src/traces/box/index.js","webpack://wellcast/./node_modules/plotly.js/src/traces/box/layout_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/box/layout_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/box/plot.js","webpack://wellcast/./node_modules/plotly.js/src/traces/box/select.js","webpack://wellcast/./node_modules/plotly.js/src/traces/box/style.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/calc.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/close_boundaries.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/colorbar.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/constants.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/constraint_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/constraint_mapping.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/contours_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/convert_to_constraints.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/empty_pathinfo.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/end_plus.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/find_all_paths.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/hover.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/index.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/label_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/make_color_map.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/make_crossings.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/plot.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/set_contours.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/style.js","webpack://wellcast/./node_modules/plotly.js/src/traces/contour/style_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/heatmap/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/heatmap/calc.js","webpack://wellcast/./node_modules/plotly.js/src/traces/heatmap/clean_2d_array.js","webpack://wellcast/./node_modules/plotly.js/src/traces/heatmap/colorbar.js","webpack://wellcast/./node_modules/plotly.js/src/traces/heatmap/convert_column_xyz.js","webpack://wellcast/./node_modules/plotly.js/src/traces/heatmap/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/heatmap/find_empties.js","webpack://wellcast/./node_modules/plotly.js/src/traces/heatmap/hover.js","webpack://wellcast/./node_modules/plotly.js/src/traces/heatmap/index.js","webpack://wellcast/./node_modules/plotly.js/src/traces/heatmap/interp2d.js","webpack://wellcast/./node_modules/plotly.js/src/traces/heatmap/make_bound_array.js","webpack://wellcast/./node_modules/plotly.js/src/traces/heatmap/plot.js","webpack://wellcast/./node_modules/plotly.js/src/traces/heatmap/style.js","webpack://wellcast/./node_modules/plotly.js/src/traces/heatmap/style_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/heatmap/xyz_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram2d/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram2d/calc.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram2d/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram2d/hover.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram2d/index.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram2d/sample_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram2dcontour/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram2dcontour/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram2dcontour/index.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram/average.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram/bin_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram/bin_functions.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram/bin_label_vals.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram/calc.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram/constants.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram/cross_trace_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram/event_data.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram/hover.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram/index.js","webpack://wellcast/./node_modules/plotly.js/src/traces/histogram/norm_functions.js","webpack://wellcast/./node_modules/plotly.js/src/traces/image/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/image/calc.js","webpack://wellcast/./node_modules/plotly.js/src/traces/image/constants.js","webpack://wellcast/./node_modules/plotly.js/src/traces/image/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/image/event_data.js","webpack://wellcast/./node_modules/plotly.js/src/traces/image/helpers.js","webpack://wellcast/./node_modules/plotly.js/src/traces/image/hover.js","webpack://wellcast/./node_modules/plotly.js/src/traces/image/index.js","webpack://wellcast/./node_modules/plotly.js/src/traces/image/plot.js","webpack://wellcast/./node_modules/plotly.js/src/traces/image/style.js","webpack://wellcast/./node_modules/plotly.js/src/traces/pie/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/pie/base_plot.js","webpack://wellcast/./node_modules/plotly.js/src/traces/pie/calc.js","webpack://wellcast/./node_modules/plotly.js/src/traces/pie/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/pie/event_data.js","webpack://wellcast/./node_modules/plotly.js/src/traces/pie/helpers.js","webpack://wellcast/./node_modules/plotly.js/src/traces/pie/index.js","webpack://wellcast/./node_modules/plotly.js/src/traces/pie/layout_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/pie/layout_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/pie/plot.js","webpack://wellcast/./node_modules/plotly.js/src/traces/pie/style.js","webpack://wellcast/./node_modules/plotly.js/src/traces/pie/style_one.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/arrays_to_calcdata.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/calc.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/calc_selection.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/colorscale_calc.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/constants.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/cross_trace_calc.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/cross_trace_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/fillcolor_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/format_labels.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/get_trace_color.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/hover.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/index.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/line_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/line_points.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/line_shape_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/link_traces.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/make_bubble_size_func.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/marker_colorbar.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/marker_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/period_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/plot.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/select.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/stack_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/style.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/subtypes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/text_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatter/xy_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatterternary/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatterternary/calc.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatterternary/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatterternary/event_data.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatterternary/format_labels.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatterternary/hover.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatterternary/index.js","webpack://wellcast/./node_modules/plotly.js/src/traces/scatterternary/plot.js","webpack://wellcast/./node_modules/plotly.js/src/traces/violin/attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/violin/calc.js","webpack://wellcast/./node_modules/plotly.js/src/traces/violin/cross_trace_calc.js","webpack://wellcast/./node_modules/plotly.js/src/traces/violin/defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/violin/helpers.js","webpack://wellcast/./node_modules/plotly.js/src/traces/violin/hover.js","webpack://wellcast/./node_modules/plotly.js/src/traces/violin/index.js","webpack://wellcast/./node_modules/plotly.js/src/traces/violin/layout_attributes.js","webpack://wellcast/./node_modules/plotly.js/src/traces/violin/layout_defaults.js","webpack://wellcast/./node_modules/plotly.js/src/traces/violin/plot.js","webpack://wellcast/./node_modules/plotly.js/src/traces/violin/style.js","webpack://wellcast/./node_modules/plotly.js/src/transforms/aggregate.js","webpack://wellcast/./node_modules/plotly.js/src/transforms/filter.js","webpack://wellcast/./node_modules/plotly.js/src/transforms/groupby.js","webpack://wellcast/./node_modules/plotly.js/src/transforms/helpers.js","webpack://wellcast/./node_modules/plotly.js/src/transforms/sort.js","webpack://wellcast/./node_modules/plotly.js/src/version.js"],"sourcesContent":["'use strict';\n\nvar Lib = require('../src/lib');\nvar rules = {\n    \"X,X div\": \"direction:ltr;font-family:\\\"Open Sans\\\",verdana,arial,sans-serif;margin:0;padding:0;\",\n    \"X input,X button\": \"font-family:\\\"Open Sans\\\",verdana,arial,sans-serif;\",\n    \"X input:focus,X button:focus\": \"outline:none;\",\n    \"X a\": \"text-decoration:none;\",\n    \"X a:hover\": \"text-decoration:none;\",\n    \"X .crisp\": \"shape-rendering:crispEdges;\",\n    \"X .user-select-none\": \"-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;\",\n    \"X svg\": \"overflow:hidden;\",\n    \"X svg a\": \"fill:#447adb;\",\n    \"X svg a:hover\": \"fill:#3c6dc5;\",\n    \"X .main-svg\": \"position:absolute;top:0;left:0;pointer-events:none;\",\n    \"X .main-svg .draglayer\": \"pointer-events:all;\",\n    \"X .cursor-default\": \"cursor:default;\",\n    \"X .cursor-pointer\": \"cursor:pointer;\",\n    \"X .cursor-crosshair\": \"cursor:crosshair;\",\n    \"X .cursor-move\": \"cursor:move;\",\n    \"X .cursor-col-resize\": \"cursor:col-resize;\",\n    \"X .cursor-row-resize\": \"cursor:row-resize;\",\n    \"X .cursor-ns-resize\": \"cursor:ns-resize;\",\n    \"X .cursor-ew-resize\": \"cursor:ew-resize;\",\n    \"X .cursor-sw-resize\": \"cursor:sw-resize;\",\n    \"X .cursor-s-resize\": \"cursor:s-resize;\",\n    \"X .cursor-se-resize\": \"cursor:se-resize;\",\n    \"X .cursor-w-resize\": \"cursor:w-resize;\",\n    \"X .cursor-e-resize\": \"cursor:e-resize;\",\n    \"X .cursor-nw-resize\": \"cursor:nw-resize;\",\n    \"X .cursor-n-resize\": \"cursor:n-resize;\",\n    \"X .cursor-ne-resize\": \"cursor:ne-resize;\",\n    \"X .cursor-grab\": \"cursor:-webkit-grab;cursor:grab;\",\n    \"X .modebar\": \"position:absolute;top:2px;right:2px;\",\n    \"X .ease-bg\": \"-webkit-transition:background-color .3s ease 0s;-moz-transition:background-color .3s ease 0s;-ms-transition:background-color .3s ease 0s;-o-transition:background-color .3s ease 0s;transition:background-color .3s ease 0s;\",\n    \"X .modebar--hover>:not(.watermark)\": \"opacity:0;-webkit-transition:opacity .3s ease 0s;-moz-transition:opacity .3s ease 0s;-ms-transition:opacity .3s ease 0s;-o-transition:opacity .3s ease 0s;transition:opacity .3s ease 0s;\",\n    \"X:hover .modebar--hover .modebar-group\": \"opacity:1;\",\n    \"X .modebar-group\": \"float:left;display:inline-block;box-sizing:border-box;padding-left:8px;position:relative;vertical-align:middle;white-space:nowrap;\",\n    \"X .modebar-btn\": \"position:relative;font-size:16px;padding:3px 4px;height:22px;cursor:pointer;line-height:normal;box-sizing:border-box;\",\n    \"X .modebar-btn svg\": \"position:relative;top:2px;\",\n    \"X .modebar.vertical\": \"display:flex;flex-direction:column;flex-wrap:wrap;align-content:flex-end;max-height:100%;\",\n    \"X .modebar.vertical svg\": \"top:-1px;\",\n    \"X .modebar.vertical .modebar-group\": \"display:block;float:none;padding-left:0px;padding-bottom:8px;\",\n    \"X .modebar.vertical .modebar-group .modebar-btn\": \"display:block;text-align:center;\",\n    \"X [data-title]:before,X [data-title]:after\": \"position:absolute;-webkit-transform:translate3d(0, 0, 0);-moz-transform:translate3d(0, 0, 0);-ms-transform:translate3d(0, 0, 0);-o-transform:translate3d(0, 0, 0);transform:translate3d(0, 0, 0);display:none;opacity:0;z-index:1001;pointer-events:none;top:110%;right:50%;\",\n    \"X [data-title]:hover:before,X [data-title]:hover:after\": \"display:block;opacity:1;\",\n    \"X [data-title]:before\": \"content:\\\"\\\";position:absolute;background:transparent;border:6px solid transparent;z-index:1002;margin-top:-12px;border-bottom-color:#69738a;margin-right:-6px;\",\n    \"X [data-title]:after\": \"content:attr(data-title);background:#69738a;color:#fff;padding:8px 10px;font-size:12px;line-height:12px;white-space:nowrap;margin-right:-18px;border-radius:2px;\",\n    \"X .vertical [data-title]:before,X .vertical [data-title]:after\": \"top:0%;right:200%;\",\n    \"X .vertical [data-title]:before\": \"border:6px solid transparent;border-left-color:#69738a;margin-top:8px;margin-right:-30px;\",\n    \"X .select-outline\": \"fill:none;stroke-width:1;shape-rendering:crispEdges;\",\n    \"X .select-outline-1\": \"stroke:#fff;\",\n    \"X .select-outline-2\": \"stroke:#000;stroke-dasharray:2px 2px;\",\n    Y: \"font-family:\\\"Open Sans\\\",verdana,arial,sans-serif;position:fixed;top:50px;right:20px;z-index:10000;font-size:10pt;max-width:180px;\",\n    \"Y p\": \"margin:0;\",\n    \"Y .notifier-note\": \"min-width:180px;max-width:250px;border:1px solid #fff;z-index:3000;margin:0;background-color:#8c97af;background-color:rgba(140,151,175,.9);color:#fff;padding:10px;overflow-wrap:break-word;word-wrap:break-word;-ms-hyphens:auto;-webkit-hyphens:auto;hyphens:auto;\",\n    \"Y .notifier-close\": \"color:#fff;opacity:.8;float:right;padding:0 5px;background:none;border:none;font-size:20px;font-weight:bold;line-height:20px;\",\n    \"Y .notifier-close:hover\": \"color:#444;text-decoration:none;cursor:pointer;\"\n};\n\nfor(var selector in rules) {\n    var fullSelector = selector.replace(/^,/,' ,')\n        .replace(/X/g, '.js-plotly-plot .plotly')\n        .replace(/Y/g, '.plotly-notifier');\n    Lib.addStyleRule(fullSelector, rules[selector]);\n}\n","'use strict';\n\nmodule.exports = require('../src/transforms/aggregate');\n","'use strict';\n\nmodule.exports = require('../src/traces/bar');\n","'use strict';\n\nmodule.exports = require('../src/traces/box');\n","'use strict';\n\nmodule.exports = require('../src/components/calendars');\n","'use strict';\n\nmodule.exports = require('../src/traces/contour');\n","'use strict';\n\nmodule.exports = require('../src/core');\n","'use strict';\n\nmodule.exports = require('../src/transforms/filter');\n","'use strict';\n\nmodule.exports = require('../src/transforms/groupby');\n","'use strict';\n\nmodule.exports = require('../src/traces/heatmap');\n","'use strict';\n\nmodule.exports = require('../src/traces/histogram');\n","'use strict';\n\nmodule.exports = require('../src/traces/histogram2d');\n","'use strict';\n\nmodule.exports = require('../src/traces/histogram2dcontour');\n","'use strict';\n\nmodule.exports = require('../src/traces/image');\n","'use strict';\n\nvar Plotly = require('./core');\n\nPlotly.register([\n    // traces\n    require('./bar'),\n    require('./box'),\n    require('./heatmap'),\n    require('./histogram'),\n    require('./histogram2d'),\n    require('./histogram2dcontour'),\n    require('./contour'),\n    require('./scatterternary'),\n    require('./violin'),\n    require('./image'),\n    require('./pie'),\n\n    // transforms\n    require('./aggregate'),\n    require('./filter'),\n    require('./groupby'),\n    require('./sort'),\n\n    // components\n    require('./calendars'),\n]);\n\nmodule.exports = Plotly;\n","'use strict';\n\nmodule.exports = require('../src/traces/pie');\n","'use strict';\n\nmodule.exports = require('../src/traces/scatterternary');\n","'use strict';\n\nmodule.exports = require('../src/transforms/sort');\n","'use strict';\n\nmodule.exports = require('../src/traces/violin');\n","'use strict';\n\nvar annAttrs = require('../annotations/attributes');\nvar overrideAll = require('../../plot_api/edit_types').overrideAll;\nvar templatedArray = require('../../plot_api/plot_template').templatedArray;\n\nmodule.exports = overrideAll(templatedArray('annotation', {\n    visible: annAttrs.visible,\n    x: {\n        valType: 'any',\n        description: [\n            'Sets the annotation\\'s x position.'\n        ].join(' ')\n    },\n    y: {\n        valType: 'any',\n        description: [\n            'Sets the annotation\\'s y position.'\n        ].join(' ')\n    },\n    z: {\n        valType: 'any',\n        description: [\n            'Sets the annotation\\'s z position.'\n        ].join(' ')\n    },\n    ax: {\n        valType: 'number',\n        description: [\n            'Sets the x component of the arrow tail about the arrow head (in pixels).'\n        ].join(' ')\n    },\n    ay: {\n        valType: 'number',\n        description: [\n            'Sets the y component of the arrow tail about the arrow head (in pixels).'\n        ].join(' ')\n    },\n\n    xanchor: annAttrs.xanchor,\n    xshift: annAttrs.xshift,\n    yanchor: annAttrs.yanchor,\n    yshift: annAttrs.yshift,\n\n    text: annAttrs.text,\n    textangle: annAttrs.textangle,\n    font: annAttrs.font,\n    width: annAttrs.width,\n    height: annAttrs.height,\n    opacity: annAttrs.opacity,\n    align: annAttrs.align,\n    valign: annAttrs.valign,\n    bgcolor: annAttrs.bgcolor,\n    bordercolor: annAttrs.bordercolor,\n    borderpad: annAttrs.borderpad,\n    borderwidth: annAttrs.borderwidth,\n    showarrow: annAttrs.showarrow,\n    arrowcolor: annAttrs.arrowcolor,\n    arrowhead: annAttrs.arrowhead,\n    startarrowhead: annAttrs.startarrowhead,\n    arrowside: annAttrs.arrowside,\n    arrowsize: annAttrs.arrowsize,\n    startarrowsize: annAttrs.startarrowsize,\n    arrowwidth: annAttrs.arrowwidth,\n    standoff: annAttrs.standoff,\n    startstandoff: annAttrs.startstandoff,\n    hovertext: annAttrs.hovertext,\n    hoverlabel: annAttrs.hoverlabel,\n    captureevents: annAttrs.captureevents,\n\n    // maybes later?\n    // clicktoshow: annAttrs.clicktoshow,\n    // xclick: annAttrs.xclick,\n    // yclick: annAttrs.yclick,\n\n    // not needed!\n    // axref: 'pixel'\n    // ayref: 'pixel'\n    // xref: 'x'\n    // yref: 'y\n    // zref: 'z'\n}), 'calc', 'from-root');\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Axes = require('../../plots/cartesian/axes');\n\nmodule.exports = function convert(scene) {\n    var fullSceneLayout = scene.fullSceneLayout;\n    var anns = fullSceneLayout.annotations;\n\n    for(var i = 0; i < anns.length; i++) {\n        mockAnnAxes(anns[i], scene);\n    }\n\n    scene.fullLayout._infolayer\n        .selectAll('.annotation-' + scene.id)\n        .remove();\n};\n\nfunction mockAnnAxes(ann, scene) {\n    var fullSceneLayout = scene.fullSceneLayout;\n    var domain = fullSceneLayout.domain;\n    var size = scene.fullLayout._size;\n\n    var base = {\n        // this gets fill in on render\n        pdata: null,\n\n        // to get setConvert to not execute cleanly\n        type: 'linear',\n\n        // don't try to update them on `editable: true`\n        autorange: false,\n\n        // set infinite range so that annotation draw routine\n        // does not try to remove 'outside-range' annotations,\n        // this case is handled in the render loop\n        range: [-Infinity, Infinity]\n    };\n\n    ann._xa = {};\n    Lib.extendFlat(ann._xa, base);\n    Axes.setConvert(ann._xa);\n    ann._xa._offset = size.l + domain.x[0] * size.w;\n    ann._xa.l2p = function() {\n        return 0.5 * (1 + ann._pdata[0] / ann._pdata[3]) * size.w * (domain.x[1] - domain.x[0]);\n    };\n\n    ann._ya = {};\n    Lib.extendFlat(ann._ya, base);\n    Axes.setConvert(ann._ya);\n    ann._ya._offset = size.t + (1 - domain.y[1]) * size.h;\n    ann._ya.l2p = function() {\n        return 0.5 * (1 - ann._pdata[1] / ann._pdata[3]) * size.h * (domain.y[1] - domain.y[0]);\n    };\n}\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Axes = require('../../plots/cartesian/axes');\nvar handleArrayContainerDefaults = require('../../plots/array_container_defaults');\nvar handleAnnotationCommonDefaults = require('../annotations/common_defaults');\nvar attributes = require('./attributes');\n\nmodule.exports = function handleDefaults(sceneLayoutIn, sceneLayoutOut, opts) {\n    handleArrayContainerDefaults(sceneLayoutIn, sceneLayoutOut, {\n        name: 'annotations',\n        handleItemDefaults: handleAnnotationDefaults,\n        fullLayout: opts.fullLayout\n    });\n};\n\nfunction handleAnnotationDefaults(annIn, annOut, sceneLayout, opts) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(annIn, annOut, attributes, attr, dflt);\n    }\n\n    function coercePosition(axLetter) {\n        var axName = axLetter + 'axis';\n\n        // mock in such way that getFromId grabs correct 3D axis\n        var gdMock = { _fullLayout: {} };\n        gdMock._fullLayout[axName] = sceneLayout[axName];\n\n        return Axes.coercePosition(annOut, gdMock, coerce, axLetter, axLetter, 0.5);\n    }\n\n\n    var visible = coerce('visible');\n    if(!visible) return;\n\n    handleAnnotationCommonDefaults(annIn, annOut, opts.fullLayout, coerce);\n\n    coercePosition('x');\n    coercePosition('y');\n    coercePosition('z');\n\n    // if you have one coordinate you should all three\n    Lib.noneOrAll(annIn, annOut, ['x', 'y', 'z']);\n\n    // hard-set here for completeness\n    annOut.xref = 'x';\n    annOut.yref = 'y';\n    annOut.zref = 'z';\n\n    coerce('xanchor');\n    coerce('yanchor');\n    coerce('xshift');\n    coerce('yshift');\n\n    if(annOut.showarrow) {\n        annOut.axref = 'pixel';\n        annOut.ayref = 'pixel';\n\n        // TODO maybe default values should be bigger than the 2D case?\n        coerce('ax', -10);\n        coerce('ay', -30);\n\n        // if you have one part of arrow length you should have both\n        Lib.noneOrAll(annIn, annOut, ['ax', 'ay']);\n    }\n}\n","'use strict';\n\nvar drawRaw = require('../annotations/draw').drawRaw;\nvar project = require('../../plots/gl3d/project');\nvar axLetters = ['x', 'y', 'z'];\n\nmodule.exports = function draw(scene) {\n    var fullSceneLayout = scene.fullSceneLayout;\n    var dataScale = scene.dataScale;\n    var anns = fullSceneLayout.annotations;\n\n    for(var i = 0; i < anns.length; i++) {\n        var ann = anns[i];\n        var annotationIsOffscreen = false;\n\n        for(var j = 0; j < 3; j++) {\n            var axLetter = axLetters[j];\n            var pos = ann[axLetter];\n            var ax = fullSceneLayout[axLetter + 'axis'];\n            var posFraction = ax.r2fraction(pos);\n\n            if(posFraction < 0 || posFraction > 1) {\n                annotationIsOffscreen = true;\n                break;\n            }\n        }\n\n        if(annotationIsOffscreen) {\n            scene.fullLayout._infolayer\n                .select('.annotation-' + scene.id + '[data-index=\"' + i + '\"]')\n                .remove();\n        } else {\n            ann._pdata = project(scene.glplot.cameraParams, [\n                fullSceneLayout.xaxis.r2l(ann.x) * dataScale[0],\n                fullSceneLayout.yaxis.r2l(ann.y) * dataScale[1],\n                fullSceneLayout.zaxis.r2l(ann.z) * dataScale[2]\n            ]);\n\n            drawRaw(scene.graphDiv, ann, i, scene.id, ann._xa, ann._ya);\n        }\n    }\n};\n","'use strict';\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\n\nmodule.exports = {\n    moduleType: 'component',\n    name: 'annotations3d',\n\n    schema: {\n        subplots: {\n            scene: {annotations: require('./attributes')}\n        }\n    },\n\n    layoutAttributes: require('./attributes'),\n    handleDefaults: require('./defaults'),\n    includeBasePlot: includeGL3D,\n\n    convert: require('./convert'),\n    draw: require('./draw')\n};\n\nfunction includeGL3D(layoutIn, layoutOut) {\n    var GL3D = Registry.subplotsRegistry.gl3d;\n    if(!GL3D) return;\n\n    var attrRegex = GL3D.attrRegex;\n\n    var keys = Object.keys(layoutIn);\n    for(var i = 0; i < keys.length; i++) {\n        var k = keys[i];\n        if(attrRegex.test(k) && (layoutIn[k].annotations || []).length) {\n            Lib.pushUnique(layoutOut._basePlotModules, GL3D);\n            Lib.pushUnique(layoutOut._subplots.gl3d, k);\n        }\n    }\n}\n","'use strict';\n\n/**\n * All paths are tuned for maximum scalability of the arrowhead,\n * ie throughout arrowwidth=0.3..3 the head is joined smoothly\n * to the line, with the line coming from the left and ending at (0, 0).\n *\n * `backoff` is the distance to move the arrowhead and the end of the line,\n * in order that the arrowhead points to the desired place, either at\n * the tip of the arrow or (in the case of circle or square)\n * the center of the symbol.\n *\n * `noRotate`, if truthy, says that this arrowhead should not rotate with the\n * arrow. That's the case for squares, which should always be straight, and\n * circles, for which it's irrelevant.\n */\n\nmodule.exports = [\n    // no arrow\n    {\n        path: '',\n        backoff: 0\n    },\n    // wide with flat back\n    {\n        path: 'M-2.4,-3V3L0.6,0Z',\n        backoff: 0.6\n    },\n    // narrower with flat back\n    {\n        path: 'M-3.7,-2.5V2.5L1.3,0Z',\n        backoff: 1.3\n    },\n    // barbed\n    {\n        path: 'M-4.45,-3L-1.65,-0.2V0.2L-4.45,3L1.55,0Z',\n        backoff: 1.55\n    },\n    // wide line-drawn\n    {\n        path: 'M-2.2,-2.2L-0.2,-0.2V0.2L-2.2,2.2L-1.4,3L1.6,0L-1.4,-3Z',\n        backoff: 1.6\n    },\n    // narrower line-drawn\n    {\n        path: 'M-4.4,-2.1L-0.6,-0.2V0.2L-4.4,2.1L-4,3L2,0L-4,-3Z',\n        backoff: 2\n    },\n    // circle\n    {\n        path: 'M2,0A2,2 0 1,1 0,-2A2,2 0 0,1 2,0Z',\n        backoff: 0,\n        noRotate: true\n    },\n    // square\n    {\n        path: 'M2,2V-2H-2V2Z',\n        backoff: 0,\n        noRotate: true\n    }\n];\n","'use strict';\n\nvar ARROWPATHS = require('./arrow_paths');\nvar fontAttrs = require('../../plots/font_attributes');\nvar cartesianConstants = require('../../plots/cartesian/constants');\nvar templatedArray = require('../../plot_api/plot_template').templatedArray;\nvar axisPlaceableObjs = require('../../constants/axis_placeable_objects');\n\nfunction arrowAxisRefDescription(axis) {\n    return [\n        'In order for absolute positioning of the arrow to work, *a' + axis +\n        'ref* must be exactly the same as *' + axis + 'ref*, otherwise *a' + axis +\n        'ref* will revert to *pixel* (explained next).',\n        'For relative positioning, *a' + axis + 'ref* can be set to *pixel*,',\n        'in which case the *a' + axis + '* value is specified in pixels',\n        'relative to *' + axis + '*.',\n        'Absolute positioning is useful',\n        'for trendline annotations which should continue to indicate',\n        'the correct trend when zoomed. Relative positioning is useful',\n        'for specifying the text offset for an annotated point.'\n    ].join(' ');\n}\n\nfunction arrowCoordinateDescription(axis, lower, upper) {\n    return [\n        'Sets the', axis, 'component of the arrow tail about the arrow head.',\n        'If `a' + axis + 'ref` is `pixel`, a positive (negative)',\n        'component corresponds to an arrow pointing',\n        'from', upper, 'to', lower, '(' + lower, 'to', upper + ').',\n        'If `a' + axis + 'ref` is not `pixel` and is exactly the same as `' + axis + 'ref`,',\n        'this is an absolute value on that axis,',\n        'like `' + axis + '`, specified in the same coordinates as `' + axis + 'ref`.'\n    ].join(' ');\n}\n\nmodule.exports = templatedArray('annotation', {\n    visible: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'calc+arraydraw',\n        description: [\n            'Determines whether or not this annotation is visible.'\n        ].join(' ')\n    },\n\n    text: {\n        valType: 'string',\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets the text associated with this annotation.',\n            'Plotly uses a subset of HTML tags to do things like',\n            'newline (<br>), bold (<b></b>), italics (<i></i>),',\n            'hyperlinks (<a href=\\'...\\'></a>). Tags <em>, <sup>, <sub>',\n            '<span> are also supported.'\n        ].join(' ')\n    },\n    textangle: {\n        valType: 'angle',\n        dflt: 0,\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets the angle at which the `text` is drawn',\n            'with respect to the horizontal.'\n        ].join(' ')\n    },\n    font: fontAttrs({\n        editType: 'calc+arraydraw',\n        colorEditType: 'arraydraw',\n        description: 'Sets the annotation text font.'\n    }),\n    width: {\n        valType: 'number',\n        min: 1,\n        dflt: null,\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets an explicit width for the text box. null (default) lets the',\n            'text set the box width. Wider text will be clipped.',\n            'There is no automatic wrapping; use <br> to start a new line.'\n        ].join(' ')\n    },\n    height: {\n        valType: 'number',\n        min: 1,\n        dflt: null,\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets an explicit height for the text box. null (default) lets the',\n            'text set the box height. Taller text will be clipped.'\n        ].join(' ')\n    },\n    opacity: {\n        valType: 'number',\n        min: 0,\n        max: 1,\n        dflt: 1,\n        editType: 'arraydraw',\n        description: 'Sets the opacity of the annotation (text + arrow).'\n    },\n    align: {\n        valType: 'enumerated',\n        values: ['left', 'center', 'right'],\n        dflt: 'center',\n        editType: 'arraydraw',\n        description: [\n            'Sets the horizontal alignment of the `text` within the box.',\n            'Has an effect only if `text` spans two or more lines',\n            '(i.e. `text` contains one or more <br> HTML tags) or if an',\n            'explicit width is set to override the text width.'\n        ].join(' ')\n    },\n    valign: {\n        valType: 'enumerated',\n        values: ['top', 'middle', 'bottom'],\n        dflt: 'middle',\n        editType: 'arraydraw',\n        description: [\n            'Sets the vertical alignment of the `text` within the box.',\n            'Has an effect only if an explicit height is set to override',\n            'the text height.'\n        ].join(' ')\n    },\n    bgcolor: {\n        valType: 'color',\n        dflt: 'rgba(0,0,0,0)',\n        editType: 'arraydraw',\n        description: 'Sets the background color of the annotation.'\n    },\n    bordercolor: {\n        valType: 'color',\n        dflt: 'rgba(0,0,0,0)',\n        editType: 'arraydraw',\n        description: [\n            'Sets the color of the border enclosing the annotation `text`.'\n        ].join(' ')\n    },\n    borderpad: {\n        valType: 'number',\n        min: 0,\n        dflt: 1,\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets the padding (in px) between the `text`',\n            'and the enclosing border.'\n        ].join(' ')\n    },\n    borderwidth: {\n        valType: 'number',\n        min: 0,\n        dflt: 1,\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets the width (in px) of the border enclosing',\n            'the annotation `text`.'\n        ].join(' ')\n    },\n    // arrow\n    showarrow: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'calc+arraydraw',\n        description: [\n            'Determines whether or not the annotation is drawn with an arrow.',\n            'If *true*, `text` is placed near the arrow\\'s tail.',\n            'If *false*, `text` lines up with the `x` and `y` provided.'\n        ].join(' ')\n    },\n    arrowcolor: {\n        valType: 'color',\n        editType: 'arraydraw',\n        description: 'Sets the color of the annotation arrow.'\n    },\n    arrowhead: {\n        valType: 'integer',\n        min: 0,\n        max: ARROWPATHS.length,\n        dflt: 1,\n        editType: 'arraydraw',\n        description: 'Sets the end annotation arrow head style.'\n    },\n    startarrowhead: {\n        valType: 'integer',\n        min: 0,\n        max: ARROWPATHS.length,\n        dflt: 1,\n        editType: 'arraydraw',\n        description: 'Sets the start annotation arrow head style.'\n    },\n    arrowside: {\n        valType: 'flaglist',\n        flags: ['end', 'start'],\n        extras: ['none'],\n        dflt: 'end',\n        editType: 'arraydraw',\n        description: 'Sets the annotation arrow head position.'\n    },\n    arrowsize: {\n        valType: 'number',\n        min: 0.3,\n        dflt: 1,\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets the size of the end annotation arrow head, relative to `arrowwidth`.',\n            'A value of 1 (default) gives a head about 3x as wide as the line.'\n        ].join(' ')\n    },\n    startarrowsize: {\n        valType: 'number',\n        min: 0.3,\n        dflt: 1,\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets the size of the start annotation arrow head, relative to `arrowwidth`.',\n            'A value of 1 (default) gives a head about 3x as wide as the line.'\n        ].join(' ')\n    },\n    arrowwidth: {\n        valType: 'number',\n        min: 0.1,\n        editType: 'calc+arraydraw',\n        description: 'Sets the width (in px) of annotation arrow line.'\n    },\n    standoff: {\n        valType: 'number',\n        min: 0,\n        dflt: 0,\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets a distance, in pixels, to move the end arrowhead away from the',\n            'position it is pointing at, for example to point at the edge of',\n            'a marker independent of zoom. Note that this shortens the arrow',\n            'from the `ax` / `ay` vector, in contrast to `xshift` / `yshift`',\n            'which moves everything by this amount.'\n        ].join(' ')\n    },\n    startstandoff: {\n        valType: 'number',\n        min: 0,\n        dflt: 0,\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets a distance, in pixels, to move the start arrowhead away from the',\n            'position it is pointing at, for example to point at the edge of',\n            'a marker independent of zoom. Note that this shortens the arrow',\n            'from the `ax` / `ay` vector, in contrast to `xshift` / `yshift`',\n            'which moves everything by this amount.'\n        ].join(' ')\n    },\n    ax: {\n        valType: 'any',\n        editType: 'calc+arraydraw',\n        description: [\n            arrowCoordinateDescription('x', 'left', 'right')\n        ].join(' ')\n    },\n    ay: {\n        valType: 'any',\n        editType: 'calc+arraydraw',\n        description: [\n            arrowCoordinateDescription('y', 'top', 'bottom')\n        ].join(' ')\n    },\n    axref: {\n        valType: 'enumerated',\n        dflt: 'pixel',\n        values: [\n            'pixel',\n            cartesianConstants.idRegex.x.toString()\n        ],\n        editType: 'calc',\n        description: [\n            'Indicates in what coordinates the tail of the',\n            'annotation (ax,ay) is specified.',\n            axisPlaceableObjs.axisRefDescription('ax', 'left', 'right'),\n            arrowAxisRefDescription('x')\n        ].join(' ')\n    },\n    ayref: {\n        valType: 'enumerated',\n        dflt: 'pixel',\n        values: [\n            'pixel',\n            cartesianConstants.idRegex.y.toString()\n        ],\n        editType: 'calc',\n        description: [\n            'Indicates in what coordinates the tail of the',\n            'annotation (ax,ay) is specified.',\n            axisPlaceableObjs.axisRefDescription('ay', 'bottom', 'top'),\n            arrowAxisRefDescription('y')\n        ].join(' ')\n    },\n    // positioning\n    xref: {\n        valType: 'enumerated',\n        values: [\n            'paper',\n            cartesianConstants.idRegex.x.toString()\n        ],\n        editType: 'calc',\n        description: [\n            'Sets the annotation\\'s x coordinate axis.',\n            axisPlaceableObjs.axisRefDescription('x', 'left', 'right'),\n        ].join(' ')\n    },\n    x: {\n        valType: 'any',\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets the annotation\\'s x position.',\n            'If the axis `type` is *log*, then you must take the',\n            'log of your desired range.',\n            'If the axis `type` is *date*, it should be date strings,',\n            'like date data, though Date objects and unix milliseconds',\n            'will be accepted and converted to strings.',\n            'If the axis `type` is *category*, it should be numbers,',\n            'using the scale where each category is assigned a serial',\n            'number from zero in the order it appears.'\n        ].join(' ')\n    },\n    xanchor: {\n        valType: 'enumerated',\n        values: ['auto', 'left', 'center', 'right'],\n        dflt: 'auto',\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets the text box\\'s horizontal position anchor',\n            'This anchor binds the `x` position to the *left*, *center*',\n            'or *right* of the annotation.',\n            'For example, if `x` is set to 1, `xref` to *paper* and',\n            '`xanchor` to *right* then the right-most portion of the',\n            'annotation lines up with the right-most edge of the',\n            'plotting area.',\n            'If *auto*, the anchor is equivalent to *center* for',\n            'data-referenced annotations or if there is an arrow,',\n            'whereas for paper-referenced with no arrow, the anchor picked',\n            'corresponds to the closest side.'\n        ].join(' ')\n    },\n    xshift: {\n        valType: 'number',\n        dflt: 0,\n        editType: 'calc+arraydraw',\n        description: [\n            'Shifts the position of the whole annotation and arrow to the',\n            'right (positive) or left (negative) by this many pixels.'\n        ].join(' ')\n    },\n    yref: {\n        valType: 'enumerated',\n        values: [\n            'paper',\n            cartesianConstants.idRegex.y.toString()\n        ],\n        editType: 'calc',\n        description: [\n            'Sets the annotation\\'s y coordinate axis.',\n            axisPlaceableObjs.axisRefDescription('y', 'bottom', 'top'),\n        ].join(' ')\n    },\n    y: {\n        valType: 'any',\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets the annotation\\'s y position.',\n            'If the axis `type` is *log*, then you must take the',\n            'log of your desired range.',\n            'If the axis `type` is *date*, it should be date strings,',\n            'like date data, though Date objects and unix milliseconds',\n            'will be accepted and converted to strings.',\n            'If the axis `type` is *category*, it should be numbers,',\n            'using the scale where each category is assigned a serial',\n            'number from zero in the order it appears.'\n        ].join(' ')\n    },\n    yanchor: {\n        valType: 'enumerated',\n        values: ['auto', 'top', 'middle', 'bottom'],\n        dflt: 'auto',\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets the text box\\'s vertical position anchor',\n            'This anchor binds the `y` position to the *top*, *middle*',\n            'or *bottom* of the annotation.',\n            'For example, if `y` is set to 1, `yref` to *paper* and',\n            '`yanchor` to *top* then the top-most portion of the',\n            'annotation lines up with the top-most edge of the',\n            'plotting area.',\n            'If *auto*, the anchor is equivalent to *middle* for',\n            'data-referenced annotations or if there is an arrow,',\n            'whereas for paper-referenced with no arrow, the anchor picked',\n            'corresponds to the closest side.'\n        ].join(' ')\n    },\n    yshift: {\n        valType: 'number',\n        dflt: 0,\n        editType: 'calc+arraydraw',\n        description: [\n            'Shifts the position of the whole annotation and arrow up',\n            '(positive) or down (negative) by this many pixels.'\n        ].join(' ')\n    },\n    clicktoshow: {\n        valType: 'enumerated',\n        values: [false, 'onoff', 'onout'],\n        dflt: false,\n        editType: 'arraydraw',\n        description: [\n            'Makes this annotation respond to clicks on the plot.',\n            'If you click a data point that exactly matches the `x` and `y`',\n            'values of this annotation, and it is hidden (visible: false),',\n            'it will appear. In *onoff* mode, you must click the same point',\n            'again to make it disappear, so if you click multiple points,',\n            'you can show multiple annotations. In *onout* mode, a click',\n            'anywhere else in the plot (on another data point or not) will',\n            'hide this annotation.',\n            'If you need to show/hide this annotation in response to different',\n            '`x` or `y` values, you can set `xclick` and/or `yclick`. This is',\n            'useful for example to label the side of a bar. To label markers',\n            'though, `standoff` is preferred over `xclick` and `yclick`.'\n        ].join(' ')\n    },\n    xclick: {\n        valType: 'any',\n        editType: 'arraydraw',\n        description: [\n            'Toggle this annotation when clicking a data point whose `x` value',\n            'is `xclick` rather than the annotation\\'s `x` value.'\n        ].join(' ')\n    },\n    yclick: {\n        valType: 'any',\n        editType: 'arraydraw',\n        description: [\n            'Toggle this annotation when clicking a data point whose `y` value',\n            'is `yclick` rather than the annotation\\'s `y` value.'\n        ].join(' ')\n    },\n    hovertext: {\n        valType: 'string',\n        editType: 'arraydraw',\n        description: [\n            'Sets text to appear when hovering over this annotation.',\n            'If omitted or blank, no hover label will appear.'\n        ].join(' ')\n    },\n    hoverlabel: {\n        bgcolor: {\n            valType: 'color',\n            editType: 'arraydraw',\n            description: [\n                'Sets the background color of the hover label.',\n                'By default uses the annotation\\'s `bgcolor` made opaque,',\n                'or white if it was transparent.'\n            ].join(' ')\n        },\n        bordercolor: {\n            valType: 'color',\n            editType: 'arraydraw',\n            description: [\n                'Sets the border color of the hover label.',\n                'By default uses either dark grey or white, for maximum',\n                'contrast with `hoverlabel.bgcolor`.'\n            ].join(' ')\n        },\n        font: fontAttrs({\n            editType: 'arraydraw',\n            description: [\n                'Sets the hover label text font.',\n                'By default uses the global hover font and size,',\n                'with color from `hoverlabel.bordercolor`.'\n            ].join(' ')\n        }),\n        editType: 'arraydraw'\n    },\n    captureevents: {\n        valType: 'boolean',\n        editType: 'arraydraw',\n        description: [\n            'Determines whether the annotation text box captures mouse move',\n            'and click events, or allows those events to pass through to data',\n            'points in the plot that may be behind the annotation. By default',\n            '`captureevents` is *false* unless `hovertext` is provided.',\n            'If you use the event `plotly_clickannotation` without `hovertext`',\n            'you must explicitly enable `captureevents`.'\n        ].join(' ')\n    },\n    editType: 'calc',\n\n    _deprecated: {\n        ref: {\n            valType: 'string',\n            editType: 'calc',\n            description: [\n                'Obsolete. Set `xref` and `yref` separately instead.'\n            ].join(' ')\n        }\n    }\n});\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Axes = require('../../plots/cartesian/axes');\n\nvar draw = require('./draw').draw;\n\n\nmodule.exports = function calcAutorange(gd) {\n    var fullLayout = gd._fullLayout;\n    var annotationList = Lib.filterVisible(fullLayout.annotations);\n\n    if(annotationList.length && gd._fullData.length) {\n        return Lib.syncOrAsync([draw, annAutorange], gd);\n    }\n};\n\nfunction annAutorange(gd) {\n    var fullLayout = gd._fullLayout;\n\n    // find the bounding boxes for each of these annotations'\n    // relative to their anchor points\n    // use the arrow and the text bg rectangle,\n    // as the whole anno may include hidden text in its bbox\n    Lib.filterVisible(fullLayout.annotations).forEach(function(ann) {\n        var xa = Axes.getFromId(gd, ann.xref);\n        var ya = Axes.getFromId(gd, ann.yref);\n        var xRefType = Axes.getRefType(ann.xref);\n        var yRefType = Axes.getRefType(ann.yref);\n\n        ann._extremes = {};\n        if(xRefType === 'range') calcAxisExpansion(ann, xa);\n        if(yRefType === 'range') calcAxisExpansion(ann, ya);\n    });\n}\n\nfunction calcAxisExpansion(ann, ax) {\n    var axId = ax._id;\n    var letter = axId.charAt(0);\n    var pos = ann[letter];\n    var apos = ann['a' + letter];\n    var ref = ann[letter + 'ref'];\n    var aref = ann['a' + letter + 'ref'];\n    var padplus = ann['_' + letter + 'padplus'];\n    var padminus = ann['_' + letter + 'padminus'];\n    var shift = {x: 1, y: -1}[letter] * ann[letter + 'shift'];\n    var headSize = 3 * ann.arrowsize * ann.arrowwidth || 0;\n    var headPlus = headSize + shift;\n    var headMinus = headSize - shift;\n    var startHeadSize = 3 * ann.startarrowsize * ann.arrowwidth || 0;\n    var startHeadPlus = startHeadSize + shift;\n    var startHeadMinus = startHeadSize - shift;\n    var extremes;\n\n    if(aref === ref) {\n        // expand for the arrowhead (padded by arrowhead)\n        var extremeArrowHead = Axes.findExtremes(ax, [ax.r2c(pos)], {\n            ppadplus: headPlus,\n            ppadminus: headMinus\n        });\n        // again for the textbox (padded by textbox)\n        var extremeText = Axes.findExtremes(ax, [ax.r2c(apos)], {\n            ppadplus: Math.max(padplus, startHeadPlus),\n            ppadminus: Math.max(padminus, startHeadMinus)\n        });\n        extremes = {\n            min: [extremeArrowHead.min[0], extremeText.min[0]],\n            max: [extremeArrowHead.max[0], extremeText.max[0]]\n        };\n    } else {\n        startHeadPlus = apos ? startHeadPlus + apos : startHeadPlus;\n        startHeadMinus = apos ? startHeadMinus - apos : startHeadMinus;\n        extremes = Axes.findExtremes(ax, [ax.r2c(pos)], {\n            ppadplus: Math.max(padplus, headPlus, startHeadPlus),\n            ppadminus: Math.max(padminus, headMinus, startHeadMinus)\n        });\n    }\n\n    ann._extremes[axId] = extremes;\n}\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Registry = require('../../registry');\nvar arrayEditor = require('../../plot_api/plot_template').arrayEditor;\n\nmodule.exports = {\n    hasClickToShow: hasClickToShow,\n    onClick: onClick\n};\n\n/*\n * hasClickToShow: does the given hoverData have ANY annotations which will\n * turn ON if we click here? (used by hover events to set cursor)\n *\n * gd: graphDiv\n * hoverData: a hoverData array, as included with the *plotly_hover* or\n *     *plotly_click* events in the `points` attribute\n *\n * returns: boolean\n */\nfunction hasClickToShow(gd, hoverData) {\n    var sets = getToggleSets(gd, hoverData);\n    return sets.on.length > 0 || sets.explicitOff.length > 0;\n}\n\n/*\n * onClick: perform the toggling (via Plotly.update) implied by clicking\n * at this hoverData\n *\n * gd: graphDiv\n * hoverData: a hoverData array, as included with the *plotly_hover* or\n *     *plotly_click* events in the `points` attribute\n *\n * returns: Promise that the update is complete\n */\nfunction onClick(gd, hoverData) {\n    var toggleSets = getToggleSets(gd, hoverData);\n    var onSet = toggleSets.on;\n    var offSet = toggleSets.off.concat(toggleSets.explicitOff);\n    var update = {};\n    var annotationsOut = gd._fullLayout.annotations;\n    var i, editHelpers;\n\n    if(!(onSet.length || offSet.length)) return;\n\n    for(i = 0; i < onSet.length; i++) {\n        editHelpers = arrayEditor(gd.layout, 'annotations', annotationsOut[onSet[i]]);\n        editHelpers.modifyItem('visible', true);\n        Lib.extendFlat(update, editHelpers.getUpdateObj());\n    }\n\n    for(i = 0; i < offSet.length; i++) {\n        editHelpers = arrayEditor(gd.layout, 'annotations', annotationsOut[offSet[i]]);\n        editHelpers.modifyItem('visible', false);\n        Lib.extendFlat(update, editHelpers.getUpdateObj());\n    }\n\n    return Registry.call('update', gd, {}, update);\n}\n\n/*\n * getToggleSets: find the annotations which will turn on or off at this\n * hoverData\n *\n * gd: graphDiv\n * hoverData: a hoverData array, as included with the *plotly_hover* or\n *     *plotly_click* events in the `points` attribute\n *\n * returns: {\n *   on: Array (indices of annotations to turn on),\n *   off: Array (indices to turn off because you're not hovering on them),\n *   explicitOff: Array (indices to turn off because you *are* hovering on them)\n * }\n */\nfunction getToggleSets(gd, hoverData) {\n    var annotations = gd._fullLayout.annotations;\n    var onSet = [];\n    var offSet = [];\n    var explicitOffSet = [];\n    var hoverLen = (hoverData || []).length;\n\n    var i, j, anni, showMode, pointj, xa, ya, toggleType;\n\n    for(i = 0; i < annotations.length; i++) {\n        anni = annotations[i];\n        showMode = anni.clicktoshow;\n\n        if(showMode) {\n            for(j = 0; j < hoverLen; j++) {\n                pointj = hoverData[j];\n                xa = pointj.xaxis;\n                ya = pointj.yaxis;\n\n                if(xa._id === anni.xref &&\n                    ya._id === anni.yref &&\n                    xa.d2r(pointj.x) === clickData2r(anni._xclick, xa) &&\n                    ya.d2r(pointj.y) === clickData2r(anni._yclick, ya)\n                ) {\n                    // match! toggle this annotation\n                    // regardless of its clicktoshow mode\n                    // but if it's onout mode, off is implicit\n                    if(anni.visible) {\n                        if(showMode === 'onout') toggleType = offSet;\n                        else toggleType = explicitOffSet;\n                    } else {\n                        toggleType = onSet;\n                    }\n                    toggleType.push(i);\n                    break;\n                }\n            }\n\n            if(j === hoverLen) {\n                // no match - only turn this annotation OFF, and only if\n                // showmode is 'onout'\n                if(anni.visible && showMode === 'onout') offSet.push(i);\n            }\n        }\n    }\n\n    return {on: onSet, off: offSet, explicitOff: explicitOffSet};\n}\n\n// to handle log axes until v3\nfunction clickData2r(d, ax) {\n    return ax.type === 'log' ? ax.l2r(d) : ax.d2r(d);\n}\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Color = require('../color');\n\n// defaults common to 'annotations' and 'annotations3d'\nmodule.exports = function handleAnnotationCommonDefaults(annIn, annOut, fullLayout, coerce) {\n    coerce('opacity');\n    var bgColor = coerce('bgcolor');\n\n    var borderColor = coerce('bordercolor');\n    var borderOpacity = Color.opacity(borderColor);\n\n    coerce('borderpad');\n\n    var borderWidth = coerce('borderwidth');\n    var showArrow = coerce('showarrow');\n\n    coerce('text', showArrow ? ' ' : fullLayout._dfltTitle.annotation);\n    coerce('textangle');\n    Lib.coerceFont(coerce, 'font', fullLayout.font);\n\n    coerce('width');\n    coerce('align');\n\n    var h = coerce('height');\n    if(h) coerce('valign');\n\n    if(showArrow) {\n        var arrowside = coerce('arrowside');\n        var arrowhead;\n        var arrowsize;\n\n        if(arrowside.indexOf('end') !== -1) {\n            arrowhead = coerce('arrowhead');\n            arrowsize = coerce('arrowsize');\n        }\n\n        if(arrowside.indexOf('start') !== -1) {\n            coerce('startarrowhead', arrowhead);\n            coerce('startarrowsize', arrowsize);\n        }\n        coerce('arrowcolor', borderOpacity ? annOut.bordercolor : Color.defaultLine);\n        coerce('arrowwidth', ((borderOpacity && borderWidth) || 1) * 2);\n        coerce('standoff');\n        coerce('startstandoff');\n    }\n\n    var hoverText = coerce('hovertext');\n    var globalHoverLabel = fullLayout.hoverlabel || {};\n\n    if(hoverText) {\n        var hoverBG = coerce('hoverlabel.bgcolor', globalHoverLabel.bgcolor ||\n            (Color.opacity(bgColor) ? Color.rgb(bgColor) : Color.defaultLine)\n        );\n\n        var hoverBorder = coerce('hoverlabel.bordercolor', globalHoverLabel.bordercolor ||\n            Color.contrast(hoverBG)\n        );\n\n        Lib.coerceFont(coerce, 'hoverlabel.font', {\n            family: globalHoverLabel.font.family,\n            size: globalHoverLabel.font.size,\n            color: globalHoverLabel.font.color || hoverBorder\n        });\n    }\n\n    coerce('captureevents', !!hoverText);\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar toLogRange = require('../../lib/to_log_range');\n\n/*\n * convertCoords: when converting an axis between log and linear\n * you need to alter any annotations on that axis to keep them\n * pointing at the same data point.\n * In v3.0 this will become obsolete\n *\n * gd: the plot div\n * ax: the axis being changed\n * newType: the type it's getting\n * doExtra: function(attr, val) from inside relayout that sets the attribute.\n *     Use this to make the changes as it's aware if any other changes in the\n *     same relayout call should override this conversion.\n */\nmodule.exports = function convertCoords(gd, ax, newType, doExtra) {\n    ax = ax || {};\n\n    var toLog = (newType === 'log') && (ax.type === 'linear');\n    var fromLog = (newType === 'linear') && (ax.type === 'log');\n\n    if(!(toLog || fromLog)) return;\n\n    var annotations = gd._fullLayout.annotations;\n    var axLetter = ax._id.charAt(0);\n    var ann;\n    var attrPrefix;\n\n    function convert(attr) {\n        var currentVal = ann[attr];\n        var newVal = null;\n\n        if(toLog) newVal = toLogRange(currentVal, ax.range);\n        else newVal = Math.pow(10, currentVal);\n\n        // if conversion failed, delete the value so it gets a default value\n        if(!isNumeric(newVal)) newVal = null;\n\n        doExtra(attrPrefix + attr, newVal);\n    }\n\n    for(var i = 0; i < annotations.length; i++) {\n        ann = annotations[i];\n        attrPrefix = 'annotations[' + i + '].';\n\n        if(ann[axLetter + 'ref'] === ax._id) convert(axLetter);\n        if(ann['a' + axLetter + 'ref'] === ax._id) convert('a' + axLetter);\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Axes = require('../../plots/cartesian/axes');\nvar handleArrayContainerDefaults = require('../../plots/array_container_defaults');\n\nvar handleAnnotationCommonDefaults = require('./common_defaults');\nvar attributes = require('./attributes');\n\n\nmodule.exports = function supplyLayoutDefaults(layoutIn, layoutOut) {\n    handleArrayContainerDefaults(layoutIn, layoutOut, {\n        name: 'annotations',\n        handleItemDefaults: handleAnnotationDefaults\n    });\n};\n\nfunction handleAnnotationDefaults(annIn, annOut, fullLayout) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(annIn, annOut, attributes, attr, dflt);\n    }\n\n    var visible = coerce('visible');\n    var clickToShow = coerce('clicktoshow');\n\n    if(!(visible || clickToShow)) return;\n\n    handleAnnotationCommonDefaults(annIn, annOut, fullLayout, coerce);\n\n    var showArrow = annOut.showarrow;\n\n    // positioning\n    var axLetters = ['x', 'y'];\n    var arrowPosDflt = [-10, -30];\n    var gdMock = {_fullLayout: fullLayout};\n\n    for(var i = 0; i < 2; i++) {\n        var axLetter = axLetters[i];\n\n        // xref, yref\n        var axRef = Axes.coerceRef(annIn, annOut, gdMock, axLetter, '', 'paper');\n\n        if(axRef !== 'paper') {\n            var ax = Axes.getFromId(gdMock, axRef);\n            ax._annIndices.push(annOut._index);\n        }\n\n        // x, y\n        Axes.coercePosition(annOut, gdMock, coerce, axRef, axLetter, 0.5);\n\n        if(showArrow) {\n            var arrowPosAttr = 'a' + axLetter;\n            // axref, ayref\n            var aaxRef = Axes.coerceRef(annIn, annOut, gdMock, arrowPosAttr, 'pixel',\n                    ['pixel', 'paper']);\n\n            // for now the arrow can only be on the same axis or specified as pixels\n            // TODO: sometime it might be interesting to allow it to be on *any* axis\n            // but that would require updates to drawing & autorange code and maybe more\n            if(aaxRef !== 'pixel' && aaxRef !== axRef) {\n                aaxRef = annOut[arrowPosAttr] = 'pixel';\n            }\n\n            // ax, ay\n            var aDflt = (aaxRef === 'pixel') ? arrowPosDflt[i] : 0.4;\n            Axes.coercePosition(annOut, gdMock, coerce, aaxRef, arrowPosAttr, aDflt);\n        }\n\n        // xanchor, yanchor\n        coerce(axLetter + 'anchor');\n\n        // xshift, yshift\n        coerce(axLetter + 'shift');\n    }\n\n    // if you have one coordinate you should have both\n    Lib.noneOrAll(annIn, annOut, ['x', 'y']);\n\n    // if you have one part of arrow length you should have both\n    if(showArrow) {\n        Lib.noneOrAll(annIn, annOut, ['ax', 'ay']);\n    }\n\n    if(clickToShow) {\n        var xClick = coerce('xclick');\n        var yClick = coerce('yclick');\n\n        // put the actual click data to bind to into private attributes\n        // so we don't have to do this little bit of logic on every hover event\n        annOut._xclick = (xClick === undefined) ?\n            annOut.x :\n            Axes.cleanPosition(xClick, gdMock, annOut.xref);\n        annOut._yclick = (yClick === undefined) ?\n            annOut.y :\n            Axes.cleanPosition(yClick, gdMock, annOut.yref);\n    }\n}\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Registry = require('../../registry');\nvar Plots = require('../../plots/plots');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar Axes = require('../../plots/cartesian/axes');\nvar Color = require('../color');\nvar Drawing = require('../drawing');\nvar Fx = require('../fx');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar setCursor = require('../../lib/setcursor');\nvar dragElement = require('../dragelement');\nvar arrayEditor = require('../../plot_api/plot_template').arrayEditor;\n\nvar drawArrowHead = require('./draw_arrow_head');\n\n// Annotations are stored in gd.layout.annotations, an array of objects\n// index can point to one item in this array,\n//  or non-numeric to simply add a new one\n//  or -1 to modify all existing\n// opt can be the full options object, or one key (to be set to value)\n//  or undefined to simply redraw\n// if opt is blank, val can be 'add' or a full options object to add a new\n//  annotation at that point in the array, or 'remove' to delete this one\n\nmodule.exports = {\n    draw: draw,\n    drawOne: drawOne,\n    drawRaw: drawRaw\n};\n\n/*\n * draw: draw all annotations without any new modifications\n */\nfunction draw(gd) {\n    var fullLayout = gd._fullLayout;\n\n    fullLayout._infolayer.selectAll('.annotation').remove();\n\n    for(var i = 0; i < fullLayout.annotations.length; i++) {\n        if(fullLayout.annotations[i].visible) {\n            drawOne(gd, i);\n        }\n    }\n\n    return Plots.previousPromises(gd);\n}\n\n/*\n * drawOne: draw a single cartesian or paper-ref annotation, potentially with modifications\n *\n * index (int): the annotation to draw\n */\nfunction drawOne(gd, index) {\n    var fullLayout = gd._fullLayout;\n    var options = fullLayout.annotations[index] || {};\n    var xa = Axes.getFromId(gd, options.xref);\n    var ya = Axes.getFromId(gd, options.yref);\n\n    if(xa) xa.setScale();\n    if(ya) ya.setScale();\n\n    drawRaw(gd, options, index, false, xa, ya);\n}\n\n// Convert pixels to the coordinates relevant for the axis referred to. For\n// example, for paper it would convert to a value normalized by the dimension of\n// the plot.\n// axDomainRef: if true and axa defined, draws relative to axis domain,\n// otherwise draws relative to data (if axa defined) or paper (if not).\nfunction shiftPosition(axa, dAx, axLetter, gs, options) {\n    var optAx = options[axLetter];\n    var axRef = options[axLetter + 'ref'];\n    var vertical = axLetter.indexOf('y') !== -1;\n    var axDomainRef = Axes.getRefType(axRef) === 'domain';\n    var gsDim = vertical ? gs.h : gs.w;\n    if(axa) {\n        if(axDomainRef) {\n            // here optAx normalized to length of axis (e.g., normally in range\n            // 0 to 1). But dAx is in pixels. So we normalize dAx to length of\n            // axis before doing the math.\n            return optAx + (vertical ? -dAx : dAx) / axa._length;\n        } else {\n            return axa.p2r(axa.r2p(optAx) + dAx);\n        }\n    } else {\n        return optAx + (vertical ? -dAx : dAx) / gsDim;\n    }\n}\n\n/**\n * drawRaw: draw a single annotation, potentially with modifications\n *\n * @param {DOM element} gd\n * @param {object} options : this annotation's fullLayout options\n * @param {integer} index : index in 'annotations' container of the annotation to draw\n * @param {string} subplotId : id of the annotation's subplot\n *  - use false for 2d (i.e. cartesian or paper-ref) annotations\n * @param {object | undefined} xa : full x-axis object to compute subplot pos-to-px\n * @param {object | undefined} ya : ... y-axis\n */\nfunction drawRaw(gd, options, index, subplotId, xa, ya) {\n    var fullLayout = gd._fullLayout;\n    var gs = gd._fullLayout._size;\n    var edits = gd._context.edits;\n\n    var className, containerStr;\n\n    if(subplotId) {\n        className = 'annotation-' + subplotId;\n        containerStr = subplotId + '.annotations';\n    } else {\n        className = 'annotation';\n        containerStr = 'annotations';\n    }\n\n    var editHelpers = arrayEditor(gd.layout, containerStr, options);\n    var modifyBase = editHelpers.modifyBase;\n    var modifyItem = editHelpers.modifyItem;\n    var getUpdateObj = editHelpers.getUpdateObj;\n\n    // remove the existing annotation if there is one\n    fullLayout._infolayer\n        .selectAll('.' + className + '[data-index=\"' + index + '\"]')\n        .remove();\n\n    var annClipID = 'clip' + fullLayout._uid + '_ann' + index;\n\n    // this annotation is gone - quit now after deleting it\n    // TODO: use d3 idioms instead of deleting and redrawing every time\n    if(!options._input || options.visible === false) {\n        d3.selectAll('#' + annClipID).remove();\n        return;\n    }\n\n    // calculated pixel positions\n    // x & y each will get text, head, and tail as appropriate\n    var annPosPx = {x: {}, y: {}};\n    var textangle = +options.textangle || 0;\n\n    // create the components\n    // made a single group to contain all, so opacity can work right\n    // with border/arrow together this could handle a whole bunch of\n    // cleanup at this point, but works for now\n    var annGroup = fullLayout._infolayer.append('g')\n        .classed(className, true)\n        .attr('data-index', String(index))\n        .style('opacity', options.opacity);\n\n    // another group for text+background so that they can rotate together\n    var annTextGroup = annGroup.append('g')\n        .classed('annotation-text-g', true);\n\n    var editTextPosition = edits[options.showarrow ? 'annotationTail' : 'annotationPosition'];\n    var textEvents = options.captureevents || edits.annotationText || editTextPosition;\n\n    function makeEventData(initialEvent) {\n        var eventData = {\n            index: index,\n            annotation: options._input,\n            fullAnnotation: options,\n            event: initialEvent\n        };\n        if(subplotId) {\n            eventData.subplotId = subplotId;\n        }\n        return eventData;\n    }\n\n    var annTextGroupInner = annTextGroup.append('g')\n        .style('pointer-events', textEvents ? 'all' : null)\n        .call(setCursor, 'pointer')\n        .on('click', function() {\n            gd._dragging = false;\n            gd.emit('plotly_clickannotation', makeEventData(d3.event));\n        });\n\n    if(options.hovertext) {\n        annTextGroupInner\n        .on('mouseover', function() {\n            var hoverOptions = options.hoverlabel;\n            var hoverFont = hoverOptions.font;\n            var bBox = this.getBoundingClientRect();\n            var bBoxRef = gd.getBoundingClientRect();\n\n            Fx.loneHover({\n                x0: bBox.left - bBoxRef.left,\n                x1: bBox.right - bBoxRef.left,\n                y: (bBox.top + bBox.bottom) / 2 - bBoxRef.top,\n                text: options.hovertext,\n                color: hoverOptions.bgcolor,\n                borderColor: hoverOptions.bordercolor,\n                fontFamily: hoverFont.family,\n                fontSize: hoverFont.size,\n                fontColor: hoverFont.color\n            }, {\n                container: fullLayout._hoverlayer.node(),\n                outerContainer: fullLayout._paper.node(),\n                gd: gd\n            });\n        })\n        .on('mouseout', function() {\n            Fx.loneUnhover(fullLayout._hoverlayer.node());\n        });\n    }\n\n    var borderwidth = options.borderwidth;\n    var borderpad = options.borderpad;\n    var borderfull = borderwidth + borderpad;\n\n    var annTextBG = annTextGroupInner.append('rect')\n        .attr('class', 'bg')\n        .style('stroke-width', borderwidth + 'px')\n        .call(Color.stroke, options.bordercolor)\n        .call(Color.fill, options.bgcolor);\n\n    var isSizeConstrained = options.width || options.height;\n\n    var annTextClip = fullLayout._topclips\n        .selectAll('#' + annClipID)\n        .data(isSizeConstrained ? [0] : []);\n\n    annTextClip.enter().append('clipPath')\n        .classed('annclip', true)\n        .attr('id', annClipID)\n      .append('rect');\n    annTextClip.exit().remove();\n\n    var font = options.font;\n\n    var text = fullLayout._meta ?\n        Lib.templateString(options.text, fullLayout._meta) :\n        options.text;\n\n    var annText = annTextGroupInner.append('text')\n        .classed('annotation-text', true)\n        .text(text);\n\n    function textLayout(s) {\n        s.call(Drawing.font, font)\n        .attr({\n            'text-anchor': {\n                left: 'start',\n                right: 'end'\n            }[options.align] || 'middle'\n        });\n\n        svgTextUtils.convertToTspans(s, gd, drawGraphicalElements);\n        return s;\n    }\n\n    function drawGraphicalElements() {\n        // if the text has *only* a link, make the whole box into a link\n        var anchor3 = annText.selectAll('a');\n        if(anchor3.size() === 1 && anchor3.text() === annText.text()) {\n            var wholeLink = annTextGroupInner.insert('a', ':first-child').attr({\n                'xlink:xlink:href': anchor3.attr('xlink:href'),\n                'xlink:xlink:show': anchor3.attr('xlink:show')\n            })\n            .style({cursor: 'pointer'});\n\n            wholeLink.node().appendChild(annTextBG.node());\n        }\n\n        var mathjaxGroup = annTextGroupInner.select('.annotation-text-math-group');\n        var hasMathjax = !mathjaxGroup.empty();\n        var anntextBB = Drawing.bBox(\n                (hasMathjax ? mathjaxGroup : annText).node());\n        var textWidth = anntextBB.width;\n        var textHeight = anntextBB.height;\n        var annWidth = options.width || textWidth;\n        var annHeight = options.height || textHeight;\n        var outerWidth = Math.round(annWidth + 2 * borderfull);\n        var outerHeight = Math.round(annHeight + 2 * borderfull);\n\n        function shiftFraction(v, anchor) {\n            if(anchor === 'auto') {\n                if(v < 1 / 3) anchor = 'left';\n                else if(v > 2 / 3) anchor = 'right';\n                else anchor = 'center';\n            }\n            return {\n                center: 0,\n                middle: 0,\n                left: 0.5,\n                bottom: -0.5,\n                right: -0.5,\n                top: 0.5\n            }[anchor];\n        }\n\n        var annotationIsOffscreen = false;\n        var letters = ['x', 'y'];\n\n        for(var i = 0; i < letters.length; i++) {\n            var axLetter = letters[i];\n            var axRef = options[axLetter + 'ref'] || axLetter;\n            var tailRef = options['a' + axLetter + 'ref'];\n            var ax = {x: xa, y: ya}[axLetter];\n            var dimAngle = (textangle + (axLetter === 'x' ? 0 : -90)) * Math.PI / 180;\n            // note that these two can be either positive or negative\n            var annSizeFromWidth = outerWidth * Math.cos(dimAngle);\n            var annSizeFromHeight = outerHeight * Math.sin(dimAngle);\n            // but this one is the positive total size\n            var annSize = Math.abs(annSizeFromWidth) + Math.abs(annSizeFromHeight);\n            var anchor = options[axLetter + 'anchor'];\n            var overallShift = options[axLetter + 'shift'] * (axLetter === 'x' ? 1 : -1);\n            var posPx = annPosPx[axLetter];\n            var basePx;\n            var textPadShift;\n            var alignPosition;\n            var autoAlignFraction;\n            var textShift;\n            var axRefType = Axes.getRefType(axRef);\n\n            /*\n             * calculate the *primary* pixel position\n             * which is the arrowhead if there is one,\n             * otherwise the text anchor point\n             */\n            if(ax && (axRefType !== 'domain')) {\n                // check if annotation is off screen, to bypass DOM manipulations\n                var posFraction = ax.r2fraction(options[axLetter]);\n                if(posFraction < 0 || posFraction > 1) {\n                    if(tailRef === axRef) {\n                        posFraction = ax.r2fraction(options['a' + axLetter]);\n                        if(posFraction < 0 || posFraction > 1) {\n                            annotationIsOffscreen = true;\n                        }\n                    } else {\n                        annotationIsOffscreen = true;\n                    }\n                }\n                basePx = ax._offset + ax.r2p(options[axLetter]);\n                autoAlignFraction = 0.5;\n            } else {\n                var axRefTypeEqDomain = axRefType === 'domain';\n                if(axLetter === 'x') {\n                    alignPosition = options[axLetter];\n                    basePx = axRefTypeEqDomain ?\n                        ax._offset + ax._length * alignPosition :\n                        basePx = gs.l + gs.w * alignPosition;\n                } else {\n                    alignPosition = 1 - options[axLetter];\n                    basePx = axRefTypeEqDomain ?\n                        ax._offset + ax._length * alignPosition :\n                        basePx = gs.t + gs.h * alignPosition;\n                }\n                autoAlignFraction = options.showarrow ? 0.5 : alignPosition;\n            }\n\n            // now translate this into pixel positions of head, tail, and text\n            // as well as paddings for autorange\n            if(options.showarrow) {\n                posPx.head = basePx;\n\n                var arrowLength = options['a' + axLetter];\n\n                // with an arrow, the text rotates around the anchor point\n                textShift = annSizeFromWidth * shiftFraction(0.5, options.xanchor) -\n                    annSizeFromHeight * shiftFraction(0.5, options.yanchor);\n\n                if(tailRef === axRef) {\n                    // In the case tailRefType is 'domain' or 'paper', the arrow's\n                    // position is set absolutely, which is consistent with how\n                    // it behaves when its position is set in data ('range')\n                    // coordinates.\n                    var tailRefType = Axes.getRefType(tailRef);\n                    if(tailRefType === 'domain') {\n                        if(axLetter === 'y') {\n                            arrowLength = 1 - arrowLength;\n                        }\n                        posPx.tail = ax._offset + ax._length * arrowLength;\n                    } else if(tailRefType === 'paper') {\n                        if(axLetter === 'y') {\n                            arrowLength = 1 - arrowLength;\n                            posPx.tail = gs.t + gs.h * arrowLength;\n                        } else {\n                            posPx.tail = gs.l + gs.w * arrowLength;\n                        }\n                    } else {\n                        // assumed tailRef is range or paper referenced\n                        posPx.tail = ax._offset + ax.r2p(arrowLength);\n                    }\n                    // tail is range- or domain-referenced: autorange pads the\n                    // text in px from the tail\n                    textPadShift = textShift;\n                } else {\n                    posPx.tail = basePx + arrowLength;\n                    // tail is specified in px from head, so autorange also pads vs head\n                    textPadShift = textShift + arrowLength;\n                }\n\n                posPx.text = posPx.tail + textShift;\n\n                // constrain pixel/paper referenced so the draggers are at least\n                // partially visible\n                var maxPx = fullLayout[(axLetter === 'x') ? 'width' : 'height'];\n                if(axRef === 'paper') {\n                    posPx.head = Lib.constrain(posPx.head, 1, maxPx - 1);\n                }\n                if(tailRef === 'pixel') {\n                    var shiftPlus = -Math.max(posPx.tail - 3, posPx.text);\n                    var shiftMinus = Math.min(posPx.tail + 3, posPx.text) - maxPx;\n                    if(shiftPlus > 0) {\n                        posPx.tail += shiftPlus;\n                        posPx.text += shiftPlus;\n                    } else if(shiftMinus > 0) {\n                        posPx.tail -= shiftMinus;\n                        posPx.text -= shiftMinus;\n                    }\n                }\n\n                posPx.tail += overallShift;\n                posPx.head += overallShift;\n            } else {\n                // with no arrow, the text rotates and *then* we put the anchor\n                // relative to the new bounding box\n                textShift = annSize * shiftFraction(autoAlignFraction, anchor);\n                textPadShift = textShift;\n                posPx.text = basePx + textShift;\n            }\n\n            posPx.text += overallShift;\n            textShift += overallShift;\n            textPadShift += overallShift;\n\n            // padplus/minus are used by autorange\n            options['_' + axLetter + 'padplus'] = (annSize / 2) + textPadShift;\n            options['_' + axLetter + 'padminus'] = (annSize / 2) - textPadShift;\n\n            // size/shift are used during dragging\n            options['_' + axLetter + 'size'] = annSize;\n            options['_' + axLetter + 'shift'] = textShift;\n        }\n\n        if(annotationIsOffscreen) {\n            annTextGroupInner.remove();\n            return;\n        }\n\n        var xShift = 0;\n        var yShift = 0;\n\n        if(options.align !== 'left') {\n            xShift = (annWidth - textWidth) * (options.align === 'center' ? 0.5 : 1);\n        }\n        if(options.valign !== 'top') {\n            yShift = (annHeight - textHeight) * (options.valign === 'middle' ? 0.5 : 1);\n        }\n\n        if(hasMathjax) {\n            mathjaxGroup.select('svg').attr({\n                x: borderfull + xShift - 1,\n                y: borderfull + yShift\n            })\n            .call(Drawing.setClipUrl, isSizeConstrained ? annClipID : null, gd);\n        } else {\n            var texty = borderfull + yShift - anntextBB.top;\n            var textx = borderfull + xShift - anntextBB.left;\n\n            annText.call(svgTextUtils.positionText, textx, texty)\n                .call(Drawing.setClipUrl, isSizeConstrained ? annClipID : null, gd);\n        }\n\n        annTextClip.select('rect').call(Drawing.setRect, borderfull, borderfull,\n            annWidth, annHeight);\n\n        annTextBG.call(Drawing.setRect, borderwidth / 2, borderwidth / 2,\n            outerWidth - borderwidth, outerHeight - borderwidth);\n\n        annTextGroupInner.call(Drawing.setTranslate,\n            Math.round(annPosPx.x.text - outerWidth / 2),\n            Math.round(annPosPx.y.text - outerHeight / 2));\n\n        /*\n         * rotate text and background\n         * we already calculated the text center position *as rotated*\n         * because we needed that for autoranging anyway, so now whether\n         * we have an arrow or not, we rotate about the text center.\n         */\n        annTextGroup.attr({transform: 'rotate(' + textangle + ',' +\n                            annPosPx.x.text + ',' + annPosPx.y.text + ')'});\n\n        /*\n         * add the arrow\n         * uses options[arrowwidth,arrowcolor,arrowhead] for styling\n         * dx and dy are normally zero, but when you are dragging the textbox\n         * while the head stays put, dx and dy are the pixel offsets\n         */\n        var drawArrow = function(dx, dy) {\n            annGroup\n                .selectAll('.annotation-arrow-g')\n                .remove();\n\n            var headX = annPosPx.x.head;\n            var headY = annPosPx.y.head;\n            var tailX = annPosPx.x.tail + dx;\n            var tailY = annPosPx.y.tail + dy;\n            var textX = annPosPx.x.text + dx;\n            var textY = annPosPx.y.text + dy;\n\n            // find the edge of the text box, where we'll start the arrow:\n            // create transform matrix to rotate the text box corners\n            var transform = Lib.rotationXYMatrix(textangle, textX, textY);\n            var applyTransform = Lib.apply2DTransform(transform);\n            var applyTransform2 = Lib.apply2DTransform2(transform);\n\n            // calculate and transform bounding box\n            var width = +annTextBG.attr('width');\n            var height = +annTextBG.attr('height');\n            var xLeft = textX - 0.5 * width;\n            var xRight = xLeft + width;\n            var yTop = textY - 0.5 * height;\n            var yBottom = yTop + height;\n            var edges = [\n                [xLeft, yTop, xLeft, yBottom],\n                [xLeft, yBottom, xRight, yBottom],\n                [xRight, yBottom, xRight, yTop],\n                [xRight, yTop, xLeft, yTop]\n            ].map(applyTransform2);\n\n            // Remove the line if it ends inside the box.  Use ray\n            // casting for rotated boxes: see which edges intersect a\n            // line from the arrowhead to far away and reduce with xor\n            // to get the parity of the number of intersections.\n            if(edges.reduce(function(a, x) {\n                return a ^\n                    !!Lib.segmentsIntersect(headX, headY, headX + 1e6, headY + 1e6,\n                            x[0], x[1], x[2], x[3]);\n            }, false)) {\n                // no line or arrow - so quit drawArrow now\n                return;\n            }\n\n            edges.forEach(function(x) {\n                var p = Lib.segmentsIntersect(tailX, tailY, headX, headY,\n                            x[0], x[1], x[2], x[3]);\n                if(p) {\n                    tailX = p.x;\n                    tailY = p.y;\n                }\n            });\n\n            var strokewidth = options.arrowwidth;\n            var arrowColor = options.arrowcolor;\n            var arrowSide = options.arrowside;\n\n            var arrowGroup = annGroup.append('g')\n                .style({opacity: Color.opacity(arrowColor)})\n                .classed('annotation-arrow-g', true);\n\n            var arrow = arrowGroup.append('path')\n                .attr('d', 'M' + tailX + ',' + tailY + 'L' + headX + ',' + headY)\n                .style('stroke-width', strokewidth + 'px')\n                .call(Color.stroke, Color.rgb(arrowColor));\n\n            drawArrowHead(arrow, arrowSide, options);\n\n            // the arrow dragger is a small square right at the head, then a line to the tail,\n            // all expanded by a stroke width of 6px plus the arrow line width\n            if(edits.annotationPosition && arrow.node().parentNode && !subplotId) {\n                var arrowDragHeadX = headX;\n                var arrowDragHeadY = headY;\n                if(options.standoff) {\n                    var arrowLength = Math.sqrt(Math.pow(headX - tailX, 2) + Math.pow(headY - tailY, 2));\n                    arrowDragHeadX += options.standoff * (tailX - headX) / arrowLength;\n                    arrowDragHeadY += options.standoff * (tailY - headY) / arrowLength;\n                }\n                var arrowDrag = arrowGroup.append('path')\n                    .classed('annotation-arrow', true)\n                    .classed('anndrag', true)\n                    .classed('cursor-move', true)\n                    .attr({\n                        d: 'M3,3H-3V-3H3ZM0,0L' + (tailX - arrowDragHeadX) + ',' + (tailY - arrowDragHeadY),\n                        transform: strTranslate(arrowDragHeadX, arrowDragHeadY)\n                    })\n                    .style('stroke-width', (strokewidth + 6) + 'px')\n                    .call(Color.stroke, 'rgba(0,0,0,0)')\n                    .call(Color.fill, 'rgba(0,0,0,0)');\n\n                var annx0, anny0;\n\n                // dragger for the arrow & head: translates the whole thing\n                // (head/tail/text) all together\n                dragElement.init({\n                    element: arrowDrag.node(),\n                    gd: gd,\n                    prepFn: function() {\n                        var pos = Drawing.getTranslate(annTextGroupInner);\n\n                        annx0 = pos.x;\n                        anny0 = pos.y;\n                        if(xa && xa.autorange) {\n                            modifyBase(xa._name + '.autorange', true);\n                        }\n                        if(ya && ya.autorange) {\n                            modifyBase(ya._name + '.autorange', true);\n                        }\n                    },\n                    moveFn: function(dx, dy) {\n                        var annxy0 = applyTransform(annx0, anny0);\n                        var xcenter = annxy0[0] + dx;\n                        var ycenter = annxy0[1] + dy;\n                        annTextGroupInner.call(Drawing.setTranslate, xcenter, ycenter);\n\n                        modifyItem('x',\n                            shiftPosition(xa, dx, 'x', gs, options));\n                        modifyItem('y',\n                            shiftPosition(ya, dy, 'y', gs, options));\n\n                        // for these 2 calls to shiftPosition, it is assumed xa, ya are\n                        // defined, so gsDim will not be used, but we put it in\n                        // anyways for consistency\n                        if(options.axref === options.xref) {\n                            modifyItem('ax', shiftPosition(xa, dx, 'ax', gs, options));\n                        }\n\n                        if(options.ayref === options.yref) {\n                            modifyItem('ay', shiftPosition(ya, dy, 'ay', gs, options));\n                        }\n\n                        arrowGroup.attr('transform', strTranslate(dx, dy));\n                        annTextGroup.attr({\n                            transform: 'rotate(' + textangle + ',' +\n                                   xcenter + ',' + ycenter + ')'\n                        });\n                    },\n                    doneFn: function() {\n                        Registry.call('_guiRelayout', gd, getUpdateObj());\n                        var notesBox = document.querySelector('.js-notes-box-panel');\n                        if(notesBox) notesBox.redraw(notesBox.selectedObj);\n                    }\n                });\n            }\n        };\n\n        if(options.showarrow) drawArrow(0, 0);\n\n        // user dragging the annotation (text, not arrow)\n        if(editTextPosition) {\n            var baseTextTransform;\n\n            // dragger for the textbox: if there's an arrow, just drag the\n            // textbox and tail, leave the head untouched\n            dragElement.init({\n                element: annTextGroupInner.node(),\n                gd: gd,\n                prepFn: function() {\n                    baseTextTransform = annTextGroup.attr('transform');\n                },\n                moveFn: function(dx, dy) {\n                    var csr = 'pointer';\n                    if(options.showarrow) {\n                        // for these 2 calls to shiftPosition, it is assumed xa, ya are\n                        // defined, so gsDim will not be used, but we put it in\n                        // anyways for consistency\n                        if(options.axref === options.xref) {\n                            modifyItem('ax', shiftPosition(xa, dx, 'ax', gs, options));\n                        } else {\n                            modifyItem('ax', options.ax + dx);\n                        }\n\n                        if(options.ayref === options.yref) {\n                            modifyItem('ay', shiftPosition(ya, dy, 'ay', gs.w, options));\n                        } else {\n                            modifyItem('ay', options.ay + dy);\n                        }\n\n                        drawArrow(dx, dy);\n                    } else if(!subplotId) {\n                        var xUpdate, yUpdate;\n                        if(xa) {\n                            // shiftPosition will not execute code where xa was\n                            // undefined, so we use to calculate xUpdate too\n                            xUpdate = shiftPosition(xa, dx, 'x', gs, options);\n                        } else {\n                            var widthFraction = options._xsize / gs.w;\n                            var xLeft = options.x + (options._xshift - options.xshift) / gs.w - widthFraction / 2;\n\n                            xUpdate = dragElement.align(xLeft + dx / gs.w,\n                                widthFraction, 0, 1, options.xanchor);\n                        }\n\n                        if(ya) {\n                            // shiftPosition will not execute code where ya was\n                            // undefined, so we use to calculate yUpdate too\n                            yUpdate = shiftPosition(ya, dy, 'y', gs, options);\n                        } else {\n                            var heightFraction = options._ysize / gs.h;\n                            var yBottom = options.y - (options._yshift + options.yshift) / gs.h - heightFraction / 2;\n\n                            yUpdate = dragElement.align(yBottom - dy / gs.h,\n                                heightFraction, 0, 1, options.yanchor);\n                        }\n                        modifyItem('x', xUpdate);\n                        modifyItem('y', yUpdate);\n                        if(!xa || !ya) {\n                            csr = dragElement.getCursor(\n                                xa ? 0.5 : xUpdate,\n                                ya ? 0.5 : yUpdate,\n                                options.xanchor, options.yanchor\n                            );\n                        }\n                    } else return;\n\n                    annTextGroup.attr({\n                        transform: strTranslate(dx, dy) + baseTextTransform\n                    });\n\n                    setCursor(annTextGroupInner, csr);\n                },\n                clickFn: function(_, initialEvent) {\n                    if(options.captureevents) {\n                        gd.emit('plotly_clickannotation', makeEventData(initialEvent));\n                    }\n                },\n                doneFn: function() {\n                    setCursor(annTextGroupInner);\n                    Registry.call('_guiRelayout', gd, getUpdateObj());\n                    var notesBox = document.querySelector('.js-notes-box-panel');\n                    if(notesBox) notesBox.redraw(notesBox.selectedObj);\n                }\n            });\n        }\n    }\n\n    if(edits.annotationText) {\n        annText.call(svgTextUtils.makeEditable, {delegate: annTextGroupInner, gd: gd})\n            .call(textLayout)\n            .on('edit', function(_text) {\n                options.text = _text;\n\n                this.call(textLayout);\n\n                modifyItem('text', _text);\n\n                if(xa && xa.autorange) {\n                    modifyBase(xa._name + '.autorange', true);\n                }\n                if(ya && ya.autorange) {\n                    modifyBase(ya._name + '.autorange', true);\n                }\n\n                Registry.call('_guiRelayout', gd, getUpdateObj());\n            });\n    } else annText.call(textLayout);\n}\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Color = require('../color');\n\nvar ARROWPATHS = require('./arrow_paths');\n\nvar Lib = require('../../lib');\nvar strScale = Lib.strScale;\nvar strRotate = Lib.strRotate;\nvar strTranslate = Lib.strTranslate;\n\n/**\n * Add arrowhead(s) to a path or line element\n *\n * @param {d3.selection} el3: a d3-selected line or path element\n *\n * @param {string} ends: 'none', 'start', 'end', or 'start+end' for which ends get arrowheads\n *\n * @param {object} options: style information. Must have all the following:\n * @param {number} options.arrowhead: end head style - see ./arrow_paths\n * @param {number} options.startarrowhead: start head style - see ./arrow_paths\n * @param {number} options.arrowsize: relative size of the end head vs line width\n * @param {number} options.startarrowsize: relative size of the start head vs line width\n * @param {number} options.standoff: distance in px to move the end arrow point from its target\n * @param {number} options.startstandoff: distance in px to move the start arrow point from its target\n * @param {number} options.arrowwidth: width of the arrow line\n * @param {string} options.arrowcolor: color of the arrow line, for the head to match\n *     Note that the opacity of this color is ignored, as it's assumed the container\n *     of both the line and head has opacity applied to it so there isn't greater opacity\n *     where they overlap.\n */\nmodule.exports = function drawArrowHead(el3, ends, options) {\n    var el = el3.node();\n    var headStyle = ARROWPATHS[options.arrowhead || 0];\n    var startHeadStyle = ARROWPATHS[options.startarrowhead || 0];\n    var scale = (options.arrowwidth || 1) * (options.arrowsize || 1);\n    var startScale = (options.arrowwidth || 1) * (options.startarrowsize || 1);\n    var doStart = ends.indexOf('start') >= 0;\n    var doEnd = ends.indexOf('end') >= 0;\n    var backOff = headStyle.backoff * scale + options.standoff;\n    var startBackOff = startHeadStyle.backoff * startScale + options.startstandoff;\n\n    var start, end, startRot, endRot;\n\n    if(el.nodeName === 'line') {\n        start = {x: +el3.attr('x1'), y: +el3.attr('y1')};\n        end = {x: +el3.attr('x2'), y: +el3.attr('y2')};\n\n        var dx = start.x - end.x;\n        var dy = start.y - end.y;\n\n        startRot = Math.atan2(dy, dx);\n        endRot = startRot + Math.PI;\n        if(backOff && startBackOff) {\n            if(backOff + startBackOff > Math.sqrt(dx * dx + dy * dy)) {\n                hideLine();\n                return;\n            }\n        }\n\n        if(backOff) {\n            if(backOff * backOff > dx * dx + dy * dy) {\n                hideLine();\n                return;\n            }\n            var backOffX = backOff * Math.cos(startRot);\n            var backOffY = backOff * Math.sin(startRot);\n\n            end.x += backOffX;\n            end.y += backOffY;\n            el3.attr({x2: end.x, y2: end.y});\n        }\n\n        if(startBackOff) {\n            if(startBackOff * startBackOff > dx * dx + dy * dy) {\n                hideLine();\n                return;\n            }\n            var startBackOffX = startBackOff * Math.cos(startRot);\n            var startbackOffY = startBackOff * Math.sin(startRot);\n\n            start.x -= startBackOffX;\n            start.y -= startbackOffY;\n            el3.attr({x1: start.x, y1: start.y});\n        }\n    } else if(el.nodeName === 'path') {\n        var pathlen = el.getTotalLength();\n        // using dash to hide the backOff region of the path.\n        // if we ever allow dash for the arrow we'll have to\n        // do better than this hack... maybe just manually\n        // combine the two\n        var dashArray = '';\n\n        if(pathlen < backOff + startBackOff) {\n            hideLine();\n            return;\n        }\n\n\n        var start0 = el.getPointAtLength(0);\n        var dstart = el.getPointAtLength(0.1);\n\n        startRot = Math.atan2(start0.y - dstart.y, start0.x - dstart.x);\n        start = el.getPointAtLength(Math.min(startBackOff, pathlen));\n\n        dashArray = '0px,' + startBackOff + 'px,';\n\n        var end0 = el.getPointAtLength(pathlen);\n        var dend = el.getPointAtLength(pathlen - 0.1);\n\n        endRot = Math.atan2(end0.y - dend.y, end0.x - dend.x);\n        end = el.getPointAtLength(Math.max(0, pathlen - backOff));\n\n        var shortening = dashArray ? startBackOff + backOff : backOff;\n        dashArray += (pathlen - shortening) + 'px,' + pathlen + 'px';\n\n        el3.style('stroke-dasharray', dashArray);\n    }\n\n    function hideLine() { el3.style('stroke-dasharray', '0px,100px'); }\n\n    function drawhead(arrowHeadStyle, p, rot, arrowScale) {\n        if(!arrowHeadStyle.path) return;\n        if(arrowHeadStyle.noRotate) rot = 0;\n\n        d3.select(el.parentNode).append('path')\n            .attr({\n                'class': el3.attr('class'),\n                d: arrowHeadStyle.path,\n                transform:\n                    strTranslate(p.x, p.y) +\n                    strRotate(rot * 180 / Math.PI) +\n                    strScale(arrowScale)\n            })\n            .style({\n                fill: Color.rgb(options.arrowcolor),\n                'stroke-width': 0\n            });\n    }\n\n    if(doStart) drawhead(startHeadStyle, start, startRot, startScale);\n    if(doEnd) drawhead(headStyle, end, endRot, scale);\n};\n","'use strict';\n\nvar drawModule = require('./draw');\nvar clickModule = require('./click');\n\nmodule.exports = {\n    moduleType: 'component',\n    name: 'annotations',\n\n    layoutAttributes: require('./attributes'),\n    supplyLayoutDefaults: require('./defaults'),\n    includeBasePlot: require('../../plots/cartesian/include_components')('annotations'),\n\n    calcAutorange: require('./calc_autorange'),\n    draw: drawModule.draw,\n    drawOne: drawModule.drawOne,\n    drawRaw: drawModule.drawRaw,\n\n    hasClickToShow: clickModule.hasClickToShow,\n    onClick: clickModule.onClick,\n\n    convertCoords: require('./convert_coords')\n};\n","'use strict';\n\n// a trimmed down version of:\n// https://github.com/alexcjohnson/world-calendars/blob/master/dist/index.js\n\nmodule.exports = require('world-calendars/dist/main');\n\nrequire('world-calendars/dist/plus');\n\nrequire('world-calendars/dist/calendars/chinese');\nrequire('world-calendars/dist/calendars/coptic');\nrequire('world-calendars/dist/calendars/discworld');\nrequire('world-calendars/dist/calendars/ethiopian');\nrequire('world-calendars/dist/calendars/hebrew');\nrequire('world-calendars/dist/calendars/islamic');\nrequire('world-calendars/dist/calendars/julian');\nrequire('world-calendars/dist/calendars/mayan');\nrequire('world-calendars/dist/calendars/nanakshahi');\nrequire('world-calendars/dist/calendars/nepali');\nrequire('world-calendars/dist/calendars/persian');\nrequire('world-calendars/dist/calendars/taiwan');\nrequire('world-calendars/dist/calendars/thai');\nrequire('world-calendars/dist/calendars/ummalqura');\n","'use strict';\n\nvar calendars = require('./calendars');\n\nvar Lib = require('../../lib');\nvar constants = require('../../constants/numerical');\n\nvar EPOCHJD = constants.EPOCHJD;\nvar ONEDAY = constants.ONEDAY;\n\nvar attributes = {\n    valType: 'enumerated',\n    values: Object.keys(calendars.calendars),\n    editType: 'calc',\n    dflt: 'gregorian'\n};\n\nvar handleDefaults = function(contIn, contOut, attr, dflt) {\n    var attrs = {};\n    attrs[attr] = attributes;\n\n    return Lib.coerce(contIn, contOut, attrs, attr, dflt);\n};\n\nvar handleTraceDefaults = function(traceIn, traceOut, coords, layout) {\n    for(var i = 0; i < coords.length; i++) {\n        handleDefaults(traceIn, traceOut, coords[i] + 'calendar', layout.calendar);\n    }\n};\n\n// each calendar needs its own default canonical tick. I would love to use\n// 2000-01-01 (or even 0000-01-01) for them all but they don't necessarily\n// all support either of those dates. Instead I'll use the most significant\n// number they *do* support, biased toward the present day.\nvar CANONICAL_TICK = {\n    chinese: '2000-01-01',\n    coptic: '2000-01-01',\n    discworld: '2000-01-01',\n    ethiopian: '2000-01-01',\n    hebrew: '5000-01-01',\n    islamic: '1000-01-01',\n    julian: '2000-01-01',\n    mayan: '5000-01-01',\n    nanakshahi: '1000-01-01',\n    nepali: '2000-01-01',\n    persian: '1000-01-01',\n    jalali: '1000-01-01',\n    taiwan: '1000-01-01',\n    thai: '2000-01-01',\n    ummalqura: '1400-01-01'\n};\n\n// Start on a Sunday - for week ticks\n// Discworld and Mayan calendars don't have 7-day weeks but we're going to give them\n// 7-day week ticks so start on our Sundays.\n// If anyone really cares we can customize the auto tick spacings for these calendars.\nvar CANONICAL_SUNDAY = {\n    chinese: '2000-01-02',\n    coptic: '2000-01-03',\n    discworld: '2000-01-03',\n    ethiopian: '2000-01-05',\n    hebrew: '5000-01-01',\n    islamic: '1000-01-02',\n    julian: '2000-01-03',\n    mayan: '5000-01-01',\n    nanakshahi: '1000-01-05',\n    nepali: '2000-01-05',\n    persian: '1000-01-01',\n    jalali: '1000-01-01',\n    taiwan: '1000-01-04',\n    thai: '2000-01-04',\n    ummalqura: '1400-01-06'\n};\n\nvar DFLTRANGE = {\n    chinese: ['2000-01-01', '2001-01-01'],\n    coptic: ['1700-01-01', '1701-01-01'],\n    discworld: ['1800-01-01', '1801-01-01'],\n    ethiopian: ['2000-01-01', '2001-01-01'],\n    hebrew: ['5700-01-01', '5701-01-01'],\n    islamic: ['1400-01-01', '1401-01-01'],\n    julian: ['2000-01-01', '2001-01-01'],\n    mayan: ['5200-01-01', '5201-01-01'],\n    nanakshahi: ['0500-01-01', '0501-01-01'],\n    nepali: ['2000-01-01', '2001-01-01'],\n    persian: ['1400-01-01', '1401-01-01'],\n    jalali: ['1400-01-01', '1401-01-01'],\n    taiwan: ['0100-01-01', '0101-01-01'],\n    thai: ['2500-01-01', '2501-01-01'],\n    ummalqura: ['1400-01-01', '1401-01-01']\n};\n\n/*\n * convert d3 templates to world-calendars templates, so our users only need\n * to know d3's specifiers. Map space padding to no padding, and unknown fields\n * to an ugly placeholder\n */\nvar UNKNOWN = '##';\nvar d3ToWorldCalendars = {\n    'd': {'0': 'dd', '-': 'd'}, // 2-digit or unpadded day of month\n    'e': {'0': 'd', '-': 'd'}, // alternate, always unpadded day of month\n    'a': {'0': 'D', '-': 'D'}, // short weekday name\n    'A': {'0': 'DD', '-': 'DD'}, // full weekday name\n    'j': {'0': 'oo', '-': 'o'}, // 3-digit or unpadded day of the year\n    'W': {'0': 'ww', '-': 'w'}, // 2-digit or unpadded week of the year (Monday first)\n    'm': {'0': 'mm', '-': 'm'}, // 2-digit or unpadded month number\n    'b': {'0': 'M', '-': 'M'}, // short month name\n    'B': {'0': 'MM', '-': 'MM'}, // full month name\n    'y': {'0': 'yy', '-': 'yy'}, // 2-digit year (map unpadded to zero-padded)\n    'Y': {'0': 'yyyy', '-': 'yyyy'}, // 4-digit year (map unpadded to zero-padded)\n    'U': UNKNOWN, // Sunday-first week of the year\n    'w': UNKNOWN, // day of the week [0(sunday),6]\n    // combined format, we replace the date part with the world-calendar version\n    // and the %X stays there for d3 to handle with time parts\n    'c': {'0': 'D M d %X yyyy', '-': 'D M d %X yyyy'},\n    'x': {'0': 'mm/dd/yyyy', '-': 'mm/dd/yyyy'}\n};\n\nfunction worldCalFmt(fmt, x, calendar) {\n    var dateJD = Math.floor((x + 0.05) / ONEDAY) + EPOCHJD;\n    var cDate = getCal(calendar).fromJD(dateJD);\n    var i = 0;\n    var modifier, directive, directiveLen, directiveObj, replacementPart;\n\n    while((i = fmt.indexOf('%', i)) !== -1) {\n        modifier = fmt.charAt(i + 1);\n        if(modifier === '0' || modifier === '-' || modifier === '_') {\n            directiveLen = 3;\n            directive = fmt.charAt(i + 2);\n            if(modifier === '_') modifier = '-';\n        } else {\n            directive = modifier;\n            modifier = '0';\n            directiveLen = 2;\n        }\n        directiveObj = d3ToWorldCalendars[directive];\n        if(!directiveObj) {\n            i += directiveLen;\n        } else {\n            // code is recognized as a date part but world-calendars doesn't support it\n            if(directiveObj === UNKNOWN) replacementPart = UNKNOWN;\n\n            // format the cDate according to the translated directive\n            else replacementPart = cDate.formatDate(directiveObj[modifier]);\n\n            fmt = fmt.substr(0, i) + replacementPart + fmt.substr(i + directiveLen);\n            i += replacementPart.length;\n        }\n    }\n    return fmt;\n}\n\n// cache world calendars, so we don't have to reinstantiate\n// during each date-time conversion\nvar allCals = {};\nfunction getCal(calendar) {\n    var calendarObj = allCals[calendar];\n    if(calendarObj) return calendarObj;\n\n    calendarObj = allCals[calendar] = calendars.instance(calendar);\n    return calendarObj;\n}\n\nfunction makeAttrs(description) {\n    return Lib.extendFlat({}, attributes, { description: description });\n}\n\nfunction makeTraceAttrsDescription(coord) {\n    return 'Sets the calendar system to use with `' + coord + '` date data.';\n}\n\nvar xAttrs = {\n    xcalendar: makeAttrs(makeTraceAttrsDescription('x'))\n};\n\nvar xyAttrs = Lib.extendFlat({}, xAttrs, {\n    ycalendar: makeAttrs(makeTraceAttrsDescription('y'))\n});\n\nvar xyzAttrs = Lib.extendFlat({}, xyAttrs, {\n    zcalendar: makeAttrs(makeTraceAttrsDescription('z'))\n});\n\nvar axisAttrs = makeAttrs([\n    'Sets the calendar system to use for `range` and `tick0`',\n    'if this is a date axis. This does not set the calendar for',\n    'interpreting data on this axis, that\\'s specified in the trace',\n    'or via the global `layout.calendar`'\n].join(' '));\n\nmodule.exports = {\n    moduleType: 'component',\n    name: 'calendars',\n\n    schema: {\n        traces: {\n            scatter: xyAttrs,\n            bar: xyAttrs,\n            box: xyAttrs,\n            heatmap: xyAttrs,\n            contour: xyAttrs,\n            histogram: xyAttrs,\n            histogram2d: xyAttrs,\n            histogram2dcontour: xyAttrs,\n            scatter3d: xyzAttrs,\n            surface: xyzAttrs,\n            mesh3d: xyzAttrs,\n            scattergl: xyAttrs,\n            ohlc: xAttrs,\n            candlestick: xAttrs\n        },\n        layout: {\n            calendar: makeAttrs([\n                'Sets the default calendar system to use for interpreting and',\n                'displaying dates throughout the plot.'\n            ].join(' '))\n        },\n        subplots: {\n            xaxis: {calendar: axisAttrs},\n            yaxis: {calendar: axisAttrs},\n            scene: {\n                xaxis: {calendar: axisAttrs},\n                // TODO: it's actually redundant to include yaxis and zaxis here\n                // because in the scene attributes these are the same object so merging\n                // into one merges into them all. However, I left them in for parity with\n                // cartesian, where yaxis is unused until we Plotschema.get() when we\n                // use its presence or absence to determine whether to delete attributes\n                // from yaxis if they only apply to x (rangeselector/rangeslider)\n                yaxis: {calendar: axisAttrs},\n                zaxis: {calendar: axisAttrs}\n            },\n            polar: {\n                radialaxis: {calendar: axisAttrs}\n            }\n        },\n        transforms: {\n            filter: {\n                valuecalendar: makeAttrs([\n                    'WARNING: All transforms are deprecated and may be removed from the API in next major version.',\n                    'Sets the calendar system to use for `value`, if it is a date.'\n                ].join(' ')),\n                targetcalendar: makeAttrs([\n                    'WARNING: All transforms are deprecated and may be removed from the API in next major version.',\n                    'Sets the calendar system to use for `target`, if it is an',\n                    'array of dates. If `target` is a string (eg *x*) we use the',\n                    'corresponding trace attribute (eg `xcalendar`) if it exists,',\n                    'even if `targetcalendar` is provided.'\n                ].join(' '))\n            }\n        }\n    },\n\n    layoutAttributes: attributes,\n\n    handleDefaults: handleDefaults,\n    handleTraceDefaults: handleTraceDefaults,\n\n    CANONICAL_SUNDAY: CANONICAL_SUNDAY,\n    CANONICAL_TICK: CANONICAL_TICK,\n    DFLTRANGE: DFLTRANGE,\n\n    getCal: getCal,\n    worldCalFmt: worldCalFmt\n};\n","'use strict';\n\n\n// IMPORTANT - default colors should be in hex for compatibility\nexports.defaults = [\n    '#1f77b4',  // muted blue\n    '#ff7f0e',  // safety orange\n    '#2ca02c',  // cooked asparagus green\n    '#d62728',  // brick red\n    '#9467bd',  // muted purple\n    '#8c564b',  // chestnut brown\n    '#e377c2',  // raspberry yogurt pink\n    '#7f7f7f',  // middle gray\n    '#bcbd22',  // curry yellow-green\n    '#17becf'   // blue-teal\n];\n\nexports.defaultLine = '#444';\n\nexports.lightLine = '#eee';\n\nexports.background = '#fff';\n\nexports.borderLine = '#BEC8D9';\n\n// with axis.color and Color.interp we aren't using lightLine\n// itself anymore, instead interpolating between axis.color\n// and the background color using tinycolor.mix. lightFraction\n// gives back exactly lightLine if the other colors are defaults.\nexports.lightFraction = 100 * (0xe - 0x4) / (0xf - 0x4);\n","'use strict';\n\nvar tinycolor = require('tinycolor2');\nvar isNumeric = require('fast-isnumeric');\nvar isTypedArray = require('../../lib/array').isTypedArray;\n\nvar color = module.exports = {};\n\nvar colorAttrs = require('./attributes');\ncolor.defaults = colorAttrs.defaults;\nvar defaultLine = color.defaultLine = colorAttrs.defaultLine;\ncolor.lightLine = colorAttrs.lightLine;\nvar background = color.background = colorAttrs.background;\n\n/*\n * tinyRGB: turn a tinycolor into an rgb string, but\n * unlike the built-in tinycolor.toRgbString this never includes alpha\n */\ncolor.tinyRGB = function(tc) {\n    var c = tc.toRgb();\n    return 'rgb(' + Math.round(c.r) + ', ' +\n        Math.round(c.g) + ', ' + Math.round(c.b) + ')';\n};\n\ncolor.rgb = function(cstr) { return color.tinyRGB(tinycolor(cstr)); };\n\ncolor.opacity = function(cstr) { return cstr ? tinycolor(cstr).getAlpha() : 0; };\n\ncolor.addOpacity = function(cstr, op) {\n    var c = tinycolor(cstr).toRgb();\n    return 'rgba(' + Math.round(c.r) + ', ' +\n        Math.round(c.g) + ', ' + Math.round(c.b) + ', ' + op + ')';\n};\n\n// combine two colors into one apparent color\n// if back has transparency or is missing,\n// color.background is assumed behind it\ncolor.combine = function(front, back) {\n    var fc = tinycolor(front).toRgb();\n    if(fc.a === 1) return tinycolor(front).toRgbString();\n\n    var bc = tinycolor(back || background).toRgb();\n    var bcflat = bc.a === 1 ? bc : {\n        r: 255 * (1 - bc.a) + bc.r * bc.a,\n        g: 255 * (1 - bc.a) + bc.g * bc.a,\n        b: 255 * (1 - bc.a) + bc.b * bc.a\n    };\n    var fcflat = {\n        r: bcflat.r * (1 - fc.a) + fc.r * fc.a,\n        g: bcflat.g * (1 - fc.a) + fc.g * fc.a,\n        b: bcflat.b * (1 - fc.a) + fc.b * fc.a\n    };\n    return tinycolor(fcflat).toRgbString();\n};\n\n/*\n * Create a color that contrasts with cstr.\n *\n * If cstr is a dark color, we lighten it; if it's light, we darken.\n *\n * If lightAmount / darkAmount are used, we adjust by these percentages,\n * otherwise we go all the way to white or black.\n */\ncolor.contrast = function(cstr, lightAmount, darkAmount) {\n    var tc = tinycolor(cstr);\n\n    if(tc.getAlpha() !== 1) tc = tinycolor(color.combine(cstr, background));\n\n    var newColor = tc.isDark() ?\n        (lightAmount ? tc.lighten(lightAmount) : background) :\n        (darkAmount ? tc.darken(darkAmount) : defaultLine);\n\n    return newColor.toString();\n};\n\ncolor.stroke = function(s, c) {\n    var tc = tinycolor(c);\n    s.style({'stroke': color.tinyRGB(tc), 'stroke-opacity': tc.getAlpha()});\n};\n\ncolor.fill = function(s, c) {\n    var tc = tinycolor(c);\n    s.style({\n        'fill': color.tinyRGB(tc),\n        'fill-opacity': tc.getAlpha()\n    });\n};\n\n// search container for colors with the deprecated rgb(fractions) format\n// and convert them to rgb(0-255 values)\ncolor.clean = function(container) {\n    if(!container || typeof container !== 'object') return;\n\n    var keys = Object.keys(container);\n    var i, j, key, val;\n\n    for(i = 0; i < keys.length; i++) {\n        key = keys[i];\n        val = container[key];\n\n        if(key.substr(key.length - 5) === 'color') {\n            // only sanitize keys that end in \"color\" or \"colorscale\"\n\n            if(Array.isArray(val)) {\n                for(j = 0; j < val.length; j++) val[j] = cleanOne(val[j]);\n            } else container[key] = cleanOne(val);\n        } else if(key.substr(key.length - 10) === 'colorscale' && Array.isArray(val)) {\n            // colorscales have the format [[0, color1], [frac, color2], ... [1, colorN]]\n\n            for(j = 0; j < val.length; j++) {\n                if(Array.isArray(val[j])) val[j][1] = cleanOne(val[j][1]);\n            }\n        } else if(Array.isArray(val)) {\n            // recurse into arrays of objects, and plain objects\n\n            var el0 = val[0];\n            if(!Array.isArray(el0) && el0 && typeof el0 === 'object') {\n                for(j = 0; j < val.length; j++) color.clean(val[j]);\n            }\n        } else if(val && typeof val === 'object' && !isTypedArray(val)) color.clean(val);\n    }\n};\n\nfunction cleanOne(val) {\n    if(isNumeric(val) || typeof val !== 'string') return val;\n\n    var valTrim = val.trim();\n    if(valTrim.substr(0, 3) !== 'rgb') return val;\n\n    var match = valTrim.match(/^rgba?\\s*\\(([^()]*)\\)$/);\n    if(!match) return val;\n\n    var parts = match[1].trim().split(/\\s*[\\s,]\\s*/);\n    var rgba = valTrim.charAt(3) === 'a' && parts.length === 4;\n    if(!rgba && parts.length !== 3) return val;\n\n    for(var i = 0; i < parts.length; i++) {\n        if(!parts[i].length) return val;\n        parts[i] = Number(parts[i]);\n\n        if(!(parts[i] >= 0)) {\n            // all parts must be non-negative numbers\n\n            return val;\n        }\n\n        if(i === 3) {\n            // alpha>1 gets clipped to 1\n\n            if(parts[i] > 1) parts[i] = 1;\n        } else if(parts[i] >= 1) {\n            // r, g, b must be < 1 (ie 1 itself is not allowed)\n\n            return val;\n        }\n    }\n\n    var rgbStr = Math.round(parts[0] * 255) + ', ' +\n        Math.round(parts[1] * 255) + ', ' +\n        Math.round(parts[2] * 255);\n\n    if(rgba) return 'rgba(' + rgbStr + ', ' + parts[3] + ')';\n    return 'rgb(' + rgbStr + ')';\n}\n","'use strict';\n\nvar axesAttrs = require('../../plots/cartesian/layout_attributes');\nvar fontAttrs = require('../../plots/font_attributes');\nvar extendFlat = require('../../lib/extend').extendFlat;\nvar overrideAll = require('../../plot_api/edit_types').overrideAll;\n\n\nmodule.exports = overrideAll({\n// TODO: only right is supported currently\n//     orient: {\n//         valType: 'enumerated',\n//         values: ['left', 'right', 'top', 'bottom'],\n//         dflt: 'right',\n//         description: [\n//             'Determines which side are the labels on',\n//             '(so left and right make vertical bars, etc.)'\n//         ].join(' ')\n//     },\n    thicknessmode: {\n        valType: 'enumerated',\n        values: ['fraction', 'pixels'],\n        dflt: 'pixels',\n        description: [\n            'Determines whether this color bar\\'s thickness',\n            '(i.e. the measure in the constant color direction)',\n            'is set in units of plot *fraction* or in *pixels*.',\n            'Use `thickness` to set the value.'\n        ].join(' ')\n    },\n    thickness: {\n        valType: 'number',\n        min: 0,\n        dflt: 30,\n        description: [\n            'Sets the thickness of the color bar',\n            'This measure excludes the size of the padding, ticks and labels.'\n        ].join(' ')\n    },\n    lenmode: {\n        valType: 'enumerated',\n        values: ['fraction', 'pixels'],\n        dflt: 'fraction',\n        description: [\n            'Determines whether this color bar\\'s length',\n            '(i.e. the measure in the color variation direction)',\n            'is set in units of plot *fraction* or in *pixels.',\n            'Use `len` to set the value.'\n        ].join(' ')\n    },\n    len: {\n        valType: 'number',\n        min: 0,\n        dflt: 1,\n        description: [\n            'Sets the length of the color bar',\n            'This measure excludes the padding of both ends.',\n            'That is, the color bar length is this length minus the',\n            'padding on both ends.'\n        ].join(' ')\n    },\n    x: {\n        valType: 'number',\n        dflt: 1.02,\n        min: -2,\n        max: 3,\n        description: [\n            'Sets the x position of the color bar (in plot fraction).'\n        ].join(' ')\n    },\n    xanchor: {\n        valType: 'enumerated',\n        values: ['left', 'center', 'right'],\n        dflt: 'left',\n        description: [\n            'Sets this color bar\\'s horizontal position anchor.',\n            'This anchor binds the `x` position to the *left*, *center*',\n            'or *right* of the color bar.'\n        ].join(' ')\n    },\n    xpad: {\n        valType: 'number',\n        min: 0,\n        dflt: 10,\n        description: 'Sets the amount of padding (in px) along the x direction.'\n    },\n    y: {\n        valType: 'number',\n        dflt: 0.5,\n        min: -2,\n        max: 3,\n        description: [\n            'Sets the y position of the color bar (in plot fraction).'\n        ].join(' ')\n    },\n    yanchor: {\n        valType: 'enumerated',\n        values: ['top', 'middle', 'bottom'],\n        dflt: 'middle',\n        description: [\n            'Sets this color bar\\'s vertical position anchor',\n            'This anchor binds the `y` position to the *top*, *middle*',\n            'or *bottom* of the color bar.'\n        ].join(' ')\n    },\n    ypad: {\n        valType: 'number',\n        min: 0,\n        dflt: 10,\n        description: 'Sets the amount of padding (in px) along the y direction.'\n    },\n    // a possible line around the bar itself\n    outlinecolor: axesAttrs.linecolor,\n    outlinewidth: axesAttrs.linewidth,\n    // Should outlinewidth have {dflt: 0} ?\n    // another possible line outside the padding and tick labels\n    bordercolor: axesAttrs.linecolor,\n    borderwidth: {\n        valType: 'number',\n        min: 0,\n        dflt: 0,\n        description: [\n            'Sets the width (in px) or the border enclosing this color bar.'\n        ].join(' ')\n    },\n    bgcolor: {\n        valType: 'color',\n        dflt: 'rgba(0,0,0,0)',\n        description: 'Sets the color of padded area.'\n    },\n    // tick and title properties named and function exactly as in axes\n    tickmode: axesAttrs.tickmode,\n    nticks: axesAttrs.nticks,\n    tick0: axesAttrs.tick0,\n    dtick: axesAttrs.dtick,\n    tickvals: axesAttrs.tickvals,\n    ticktext: axesAttrs.ticktext,\n    ticks: extendFlat({}, axesAttrs.ticks, {dflt: ''}),\n    ticklabeloverflow: extendFlat({}, axesAttrs.ticklabeloverflow, {\n        description: [\n            'Determines how we handle tick labels that would overflow either the graph div or the domain of the axis.',\n            'The default value for inside tick labels is *hide past domain*.',\n            'In other cases the default is *hide past div*.'\n        ].join(' ')\n    }),\n    ticklabelposition: {\n        valType: 'enumerated',\n        values: [\n            'outside', 'inside',\n            'outside top', 'inside top',\n            'outside bottom', 'inside bottom'\n        ],\n        dflt: 'outside',\n        description: [\n            'Determines where tick labels are drawn.'\n        ].join(' ')\n    },\n    ticklen: axesAttrs.ticklen,\n    tickwidth: axesAttrs.tickwidth,\n    tickcolor: axesAttrs.tickcolor,\n    showticklabels: axesAttrs.showticklabels,\n    tickfont: fontAttrs({\n        description: 'Sets the color bar\\'s tick label font'\n    }),\n    tickangle: axesAttrs.tickangle,\n    tickformat: axesAttrs.tickformat,\n    tickformatstops: axesAttrs.tickformatstops,\n    tickprefix: axesAttrs.tickprefix,\n    showtickprefix: axesAttrs.showtickprefix,\n    ticksuffix: axesAttrs.ticksuffix,\n    showticksuffix: axesAttrs.showticksuffix,\n    separatethousands: axesAttrs.separatethousands,\n    exponentformat: axesAttrs.exponentformat,\n    minexponent: axesAttrs.minexponent,\n    showexponent: axesAttrs.showexponent,\n    title: {\n        text: {\n            valType: 'string',\n            description: [\n                'Sets the title of the color bar.',\n                'Note that before the existence of `title.text`, the title\\'s',\n                'contents used to be defined as the `title` attribute itself.',\n                'This behavior has been deprecated.'\n            ].join(' ')\n        },\n        font: fontAttrs({\n            description: [\n                'Sets this color bar\\'s title font.',\n                'Note that the title\\'s font used to be set',\n                'by the now deprecated `titlefont` attribute.'\n            ].join(' ')\n        }),\n        side: {\n            valType: 'enumerated',\n            values: ['right', 'top', 'bottom'],\n            dflt: 'top',\n            description: [\n                'Determines the location of color bar\\'s title',\n                'with respect to the color bar.',\n                'Note that the title\\'s location used to be set',\n                'by the now deprecated `titleside` attribute.'\n            ].join(' ')\n        }\n    },\n\n    _deprecated: {\n        title: {\n            valType: 'string',\n            description: [\n                'Deprecated in favor of color bar\\'s `title.text`.',\n                'Note that value of color bar\\'s `title` is no longer a simple',\n                '*string* but a set of sub-attributes.'\n            ].join(' ')\n        },\n        titlefont: fontAttrs({\n            description: 'Deprecated in favor of color bar\\'s `title.font`.'\n        }),\n        titleside: {\n            valType: 'enumerated',\n            values: ['right', 'top', 'bottom'],\n            dflt: 'top',\n            description: 'Deprecated in favor of color bar\\'s `title.side`.'\n        }\n    }\n}, 'colorbars', 'from-root');\n","'use strict';\n\nmodule.exports = {\n    cn: {\n        colorbar: 'colorbar',\n        cbbg: 'cbbg',\n        cbfill: 'cbfill',\n        cbfills: 'cbfills',\n        cbline: 'cbline',\n        cblines: 'cblines',\n        cbaxis: 'cbaxis',\n        cbtitleunshift: 'cbtitleunshift',\n        cbtitle: 'cbtitle',\n        cboutline: 'cboutline',\n        crisp: 'crisp',\n        jsPlaceholder: 'js-placeholder'\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Template = require('../../plot_api/plot_template');\n\nvar handleTickValueDefaults = require('../../plots/cartesian/tick_value_defaults');\nvar handleTickMarkDefaults = require('../../plots/cartesian/tick_mark_defaults');\nvar handleTickLabelDefaults = require('../../plots/cartesian/tick_label_defaults');\n\nvar attributes = require('./attributes');\n\nmodule.exports = function colorbarDefaults(containerIn, containerOut, layout) {\n    var colorbarOut = Template.newContainer(containerOut, 'colorbar');\n    var colorbarIn = containerIn.colorbar || {};\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(colorbarIn, colorbarOut, attributes, attr, dflt);\n    }\n\n    var thicknessmode = coerce('thicknessmode');\n    coerce('thickness', (thicknessmode === 'fraction') ?\n        30 / (layout.width - layout.margin.l - layout.margin.r) :\n        30\n    );\n\n    var lenmode = coerce('lenmode');\n    coerce('len', (lenmode === 'fraction') ?\n        1 :\n        layout.height - layout.margin.t - layout.margin.b\n    );\n\n    coerce('x');\n    coerce('xanchor');\n    coerce('xpad');\n    coerce('y');\n    coerce('yanchor');\n    coerce('ypad');\n    Lib.noneOrAll(colorbarIn, colorbarOut, ['x', 'y']);\n\n    coerce('outlinecolor');\n    coerce('outlinewidth');\n    coerce('bordercolor');\n    coerce('borderwidth');\n    coerce('bgcolor');\n\n    var ticklabelposition = coerce('ticklabelposition');\n    coerce('ticklabeloverflow', ticklabelposition.indexOf('inside') !== -1 ? 'hide past domain' : 'hide past div');\n\n    handleTickValueDefaults(colorbarIn, colorbarOut, coerce, 'linear');\n\n    var font = layout.font;\n    var opts = {outerTicks: false, font: font};\n    if(ticklabelposition.indexOf('inside') !== -1) {\n        opts.bgColor = 'black'; // could we instead use the average of colors in the scale?\n    }\n    handleTickLabelDefaults(colorbarIn, colorbarOut, coerce, 'linear', opts);\n    handleTickMarkDefaults(colorbarIn, colorbarOut, coerce, 'linear', opts);\n\n    coerce('title.text', layout._dfltTitle.colorbar);\n\n    var tickFont = colorbarOut.tickfont;\n    var dfltTitleFont = Lib.extendFlat({}, tickFont, {\n        color: font.color,\n        size: Lib.bigFont(tickFont.size)\n    });\n    Lib.coerceFont(coerce, 'title.font', dfltTitleFont);\n    coerce('title.side');\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar tinycolor = require('tinycolor2');\n\nvar Plots = require('../../plots/plots');\nvar Registry = require('../../registry');\nvar Axes = require('../../plots/cartesian/axes');\nvar dragElement = require('../dragelement');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar extendFlat = require('../../lib/extend').extendFlat;\nvar setCursor = require('../../lib/setcursor');\nvar Drawing = require('../drawing');\nvar Color = require('../color');\nvar Titles = require('../titles');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar flipScale = require('../colorscale/helpers').flipScale;\n\nvar handleAxisDefaults = require('../../plots/cartesian/axis_defaults');\nvar handleAxisPositionDefaults = require('../../plots/cartesian/position_defaults');\nvar axisLayoutAttrs = require('../../plots/cartesian/layout_attributes');\n\nvar alignmentConstants = require('../../constants/alignment');\nvar LINE_SPACING = alignmentConstants.LINE_SPACING;\nvar FROM_TL = alignmentConstants.FROM_TL;\nvar FROM_BR = alignmentConstants.FROM_BR;\n\nvar cn = require('./constants').cn;\n\nfunction draw(gd) {\n    var fullLayout = gd._fullLayout;\n\n    var colorBars = fullLayout._infolayer\n        .selectAll('g.' + cn.colorbar)\n        .data(makeColorBarData(gd), function(opts) { return opts._id; });\n\n    colorBars.enter().append('g')\n        .attr('class', function(opts) { return opts._id; })\n        .classed(cn.colorbar, true);\n\n    colorBars.each(function(opts) {\n        var g = d3.select(this);\n\n        Lib.ensureSingle(g, 'rect', cn.cbbg);\n        Lib.ensureSingle(g, 'g', cn.cbfills);\n        Lib.ensureSingle(g, 'g', cn.cblines);\n        Lib.ensureSingle(g, 'g', cn.cbaxis, function(s) { s.classed(cn.crisp, true); });\n        Lib.ensureSingle(g, 'g', cn.cbtitleunshift, function(s) { s.append('g').classed(cn.cbtitle, true); });\n        Lib.ensureSingle(g, 'rect', cn.cboutline);\n\n        var done = drawColorBar(g, opts, gd);\n        if(done && done.then) (gd._promises || []).push(done);\n\n        if(gd._context.edits.colorbarPosition) {\n            makeEditable(g, opts, gd);\n        }\n    });\n\n    colorBars.exit()\n        .each(function(opts) { Plots.autoMargin(gd, opts._id); })\n        .remove();\n\n    colorBars.order();\n}\n\nfunction makeColorBarData(gd) {\n    var fullLayout = gd._fullLayout;\n    var calcdata = gd.calcdata;\n    var out = [];\n\n    // single out item\n    var opts;\n    // colorbar attr parent container\n    var cont;\n    // trace attr container\n    var trace;\n    // colorbar options\n    var cbOpt;\n\n    function initOpts(opts) {\n        return extendFlat(opts, {\n            // fillcolor can be a d3 scale, domain is z values, range is colors\n            // or leave it out for no fill,\n            // or set to a string constant for single-color fill\n            _fillcolor: null,\n            // line.color has the same options as fillcolor\n            _line: {color: null, width: null, dash: null},\n            // levels of lines to draw.\n            // note that this DOES NOT determine the extent of the bar\n            // that's given by the domain of fillcolor\n            // (or line.color if no fillcolor domain)\n            _levels: {start: null, end: null, size: null},\n            // separate fill levels (for example, heatmap coloring of a\n            // contour map) if this is omitted, fillcolors will be\n            // evaluated halfway between levels\n            _filllevels: null,\n            // for continuous colorscales: fill with a gradient instead of explicit levels\n            // value should be the colorscale [[0, c0], [v1, c1], ..., [1, cEnd]]\n            _fillgradient: null,\n            // when using a gradient, we need the data range specified separately\n            _zrange: null\n        });\n    }\n\n    function calcOpts() {\n        if(typeof cbOpt.calc === 'function') {\n            cbOpt.calc(gd, trace, opts);\n        } else {\n            opts._fillgradient = cont.reversescale ?\n                flipScale(cont.colorscale) :\n                cont.colorscale;\n            opts._zrange = [cont[cbOpt.min], cont[cbOpt.max]];\n        }\n    }\n\n    for(var i = 0; i < calcdata.length; i++) {\n        var cd = calcdata[i];\n        trace = cd[0].trace;\n        var moduleOpts = trace._module.colorbar;\n\n        if(trace.visible === true && moduleOpts) {\n            var allowsMultiplotCbs = Array.isArray(moduleOpts);\n            var cbOpts = allowsMultiplotCbs ? moduleOpts : [moduleOpts];\n\n            for(var j = 0; j < cbOpts.length; j++) {\n                cbOpt = cbOpts[j];\n                var contName = cbOpt.container;\n                cont = contName ? trace[contName] : trace;\n\n                if(cont && cont.showscale) {\n                    opts = initOpts(cont.colorbar);\n                    opts._id = 'cb' + trace.uid + (allowsMultiplotCbs && contName ? '-' + contName : '');\n                    opts._traceIndex = trace.index;\n                    opts._propPrefix = (contName ? contName + '.' : '') + 'colorbar.';\n                    opts._meta = trace._meta;\n                    calcOpts();\n                    out.push(opts);\n                }\n            }\n        }\n    }\n\n    for(var k in fullLayout._colorAxes) {\n        cont = fullLayout[k];\n\n        if(cont.showscale) {\n            var colorAxOpts = fullLayout._colorAxes[k];\n\n            opts = initOpts(cont.colorbar);\n            opts._id = 'cb' + k;\n            opts._propPrefix = k + '.colorbar.';\n            opts._meta = fullLayout._meta;\n\n            cbOpt = {min: 'cmin', max: 'cmax'};\n            if(colorAxOpts[0] !== 'heatmap') {\n                trace = colorAxOpts[1];\n                cbOpt.calc = trace._module.colorbar.calc;\n            }\n\n            calcOpts();\n            out.push(opts);\n        }\n    }\n\n    return out;\n}\n\nfunction drawColorBar(g, opts, gd) {\n    var fullLayout = gd._fullLayout;\n    var gs = fullLayout._size;\n\n    var fillColor = opts._fillcolor;\n    var line = opts._line;\n    var title = opts.title;\n    var titleSide = title.side;\n\n    var zrange = opts._zrange ||\n        d3.extent((typeof fillColor === 'function' ? fillColor : line.color).domain());\n\n    var lineColormap = typeof line.color === 'function' ?\n        line.color :\n        function() { return line.color; };\n    var fillColormap = typeof fillColor === 'function' ?\n        fillColor :\n        function() { return fillColor; };\n\n    var levelsIn = opts._levels;\n    var levelsOut = calcLevels(gd, opts, zrange);\n    var fillLevels = levelsOut.fill;\n    var lineLevels = levelsOut.line;\n\n    // we calculate pixel sizes based on the specified graph size,\n    // not the actual (in case something pushed the margins around)\n    // which is a little odd but avoids an odd iterative effect\n    // when the colorbar itself is pushing the margins.\n    // but then the fractional size is calculated based on the\n    // actual graph size, so that the axes will size correctly.\n    var thickPx = Math.round(opts.thickness * (opts.thicknessmode === 'fraction' ? gs.w : 1));\n    var thickFrac = thickPx / gs.w;\n    var lenPx = Math.round(opts.len * (opts.lenmode === 'fraction' ? gs.h : 1));\n    var lenFrac = lenPx / gs.h;\n    var xpadFrac = opts.xpad / gs.w;\n    var yExtraPx = (opts.borderwidth + opts.outlinewidth) / 2;\n    var ypadFrac = opts.ypad / gs.h;\n\n    // x positioning: do it initially just for left anchor,\n    // then fix at the end (since we don't know the width yet)\n    var xLeft = Math.round(opts.x * gs.w + opts.xpad);\n    // for dragging... this is getting a little muddled...\n    var xLeftFrac = opts.x - thickFrac * ({middle: 0.5, right: 1}[opts.xanchor] || 0);\n\n    // y positioning we can do correctly from the start\n    var yBottomFrac = opts.y + lenFrac * (({top: -0.5, bottom: 0.5}[opts.yanchor] || 0) - 0.5);\n    var yBottomPx = Math.round(gs.h * (1 - yBottomFrac));\n    var yTopPx = yBottomPx - lenPx;\n\n    // stash a few things for makeEditable\n    opts._lenFrac = lenFrac;\n    opts._thickFrac = thickFrac;\n    opts._xLeftFrac = xLeftFrac;\n    opts._yBottomFrac = yBottomFrac;\n\n    // stash mocked axis for contour label formatting\n    var ax = opts._axis = mockColorBarAxis(gd, opts, zrange);\n\n    // position can't go in through supplyDefaults\n    // because that restricts it to [0,1]\n    ax.position = opts.x + xpadFrac + thickFrac;\n\n    if(['top', 'bottom'].indexOf(titleSide) !== -1) {\n        ax.title.side = titleSide;\n        ax.titlex = opts.x + xpadFrac;\n        ax.titley = yBottomFrac + (title.side === 'top' ? lenFrac - ypadFrac : ypadFrac);\n    }\n\n    if(line.color && opts.tickmode === 'auto') {\n        ax.tickmode = 'linear';\n        ax.tick0 = levelsIn.start;\n        var dtick = levelsIn.size;\n        // expand if too many contours, so we don't get too many ticks\n        var autoNtick = Lib.constrain((yBottomPx - yTopPx) / 50, 4, 15) + 1;\n        var dtFactor = (zrange[1] - zrange[0]) / ((opts.nticks || autoNtick) * dtick);\n        if(dtFactor > 1) {\n            var dtexp = Math.pow(10, Math.floor(Math.log(dtFactor) / Math.LN10));\n            dtick *= dtexp * Lib.roundUp(dtFactor / dtexp, [2, 5, 10]);\n            // if the contours are at round multiples, reset tick0\n            // so they're still at round multiples. Otherwise,\n            // keep the first label on the first contour level\n            if((Math.abs(levelsIn.start) / levelsIn.size + 1e-6) % 1 < 2e-6) {\n                ax.tick0 = 0;\n            }\n        }\n        ax.dtick = dtick;\n    }\n\n    // set domain after init, because we may want to\n    // allow it outside [0,1]\n    ax.domain = [\n        yBottomFrac + ypadFrac,\n        yBottomFrac + lenFrac - ypadFrac\n    ];\n\n    ax.setScale();\n\n    g.attr('transform', strTranslate(Math.round(gs.l), Math.round(gs.t)));\n\n    var titleCont = g.select('.' + cn.cbtitleunshift)\n        .attr('transform', strTranslate(-Math.round(gs.l), -Math.round(gs.t)));\n\n    var axLayer = g.select('.' + cn.cbaxis);\n    var titleEl;\n    var titleHeight = 0;\n\n    function drawTitle(titleClass, titleOpts) {\n        var dfltTitleOpts = {\n            propContainer: ax,\n            propName: opts._propPrefix + 'title',\n            traceIndex: opts._traceIndex,\n            _meta: opts._meta,\n            placeholder: fullLayout._dfltTitle.colorbar,\n            containerGroup: g.select('.' + cn.cbtitle)\n        };\n\n        // this class-to-rotate thing with convertToTspans is\n        // getting hackier and hackier... delete groups with the\n        // wrong class (in case earlier the colorbar was drawn on\n        // a different side, I think?)\n        var otherClass = titleClass.charAt(0) === 'h' ?\n            titleClass.substr(1) :\n            'h' + titleClass;\n        g.selectAll('.' + otherClass + ',.' + otherClass + '-math-group').remove();\n\n        Titles.draw(gd, titleClass, extendFlat(dfltTitleOpts, titleOpts || {}));\n    }\n\n    function drawDummyTitle() {\n        if(['top', 'bottom'].indexOf(titleSide) !== -1) {\n            // draw the title so we know how much room it needs\n            // when we squish the axis. This one only applies to\n            // top or bottom titles, not right side.\n            var x = gs.l + (opts.x + xpadFrac) * gs.w;\n            var fontSize = ax.title.font.size;\n            var y;\n\n            if(titleSide === 'top') {\n                y = (1 - (yBottomFrac + lenFrac - ypadFrac)) * gs.h +\n                    gs.t + 3 + fontSize * 0.75;\n            } else {\n                y = (1 - (yBottomFrac + ypadFrac)) * gs.h +\n                    gs.t - 3 - fontSize * 0.25;\n            }\n            drawTitle(ax._id + 'title', {\n                attributes: {x: x, y: y, 'text-anchor': 'start'}\n            });\n        }\n    }\n\n    function drawCbTitle() {\n        if(['top', 'bottom'].indexOf(titleSide) === -1) {\n            var fontSize = ax.title.font.size;\n            var y = ax._offset + ax._length / 2;\n            var x = gs.l + (ax.position || 0) * gs.w + ((ax.side === 'right') ?\n                10 + fontSize * ((ax.showticklabels ? 1 : 0.5)) :\n                -10 - fontSize * ((ax.showticklabels ? 0.5 : 0)));\n\n            // the 'h' + is a hack to get around the fact that\n            // convertToTspans rotates any 'y...' class by 90 degrees.\n            // TODO: find a better way to control this.\n            drawTitle('h' + ax._id + 'title', {\n                avoid: {\n                    selection: d3.select(gd).selectAll('g.' + ax._id + 'tick'),\n                    side: titleSide,\n                    offsetLeft: gs.l,\n                    offsetTop: 0,\n                    maxShift: fullLayout.width\n                },\n                attributes: {x: x, y: y, 'text-anchor': 'middle'},\n                transform: {rotate: '-90', offset: 0}\n            });\n        }\n    }\n\n    function drawAxis() {\n        if(['top', 'bottom'].indexOf(titleSide) !== -1) {\n            // squish the axis top to make room for the title\n            var titleGroup = g.select('.' + cn.cbtitle);\n            var titleText = titleGroup.select('text');\n            var titleTrans = [-opts.outlinewidth / 2, opts.outlinewidth / 2];\n            var mathJaxNode = titleGroup\n                .select('.h' + ax._id + 'title-math-group')\n                .node();\n            var lineSize = 15.6;\n            if(titleText.node()) {\n                lineSize = parseInt(titleText.node().style.fontSize, 10) * LINE_SPACING;\n            }\n            if(mathJaxNode) {\n                titleHeight = Drawing.bBox(mathJaxNode).height;\n                if(titleHeight > lineSize) {\n                    // not entirely sure how mathjax is doing\n                    // vertical alignment, but this seems to work.\n                    titleTrans[1] -= (titleHeight - lineSize) / 2;\n                }\n            } else if(titleText.node() && !titleText.classed(cn.jsPlaceholder)) {\n                titleHeight = Drawing.bBox(titleText.node()).height;\n            }\n            if(titleHeight) {\n                // buffer btwn colorbar and title\n                // TODO: configurable\n                titleHeight += 5;\n\n                if(titleSide === 'top') {\n                    ax.domain[1] -= titleHeight / gs.h;\n                    titleTrans[1] *= -1;\n                } else {\n                    ax.domain[0] += titleHeight / gs.h;\n                    var nlines = svgTextUtils.lineCount(titleText);\n                    titleTrans[1] += (1 - nlines) * lineSize;\n                }\n\n                titleGroup.attr('transform', strTranslate(titleTrans[0], titleTrans[1]));\n                ax.setScale();\n            }\n        }\n\n        g.selectAll('.' + cn.cbfills + ',.' + cn.cblines)\n            .attr('transform', strTranslate(0, Math.round(gs.h * (1 - ax.domain[1]))));\n\n        axLayer.attr('transform', strTranslate(0, Math.round(-gs.t)));\n\n        var fills = g.select('.' + cn.cbfills)\n            .selectAll('rect.' + cn.cbfill)\n            .attr('style', '')\n            .data(fillLevels);\n        fills.enter().append('rect')\n            .classed(cn.cbfill, true)\n            .style('stroke', 'none');\n        fills.exit().remove();\n\n        var zBounds = zrange\n            .map(ax.c2p)\n            .map(Math.round)\n            .sort(function(a, b) { return a - b; });\n\n        fills.each(function(d, i) {\n            var z = [\n                (i === 0) ? zrange[0] : (fillLevels[i] + fillLevels[i - 1]) / 2,\n                (i === fillLevels.length - 1) ? zrange[1] : (fillLevels[i] + fillLevels[i + 1]) / 2\n            ]\n            .map(ax.c2p)\n            .map(Math.round);\n\n            // offset the side adjoining the next rectangle so they\n            // overlap, to prevent antialiasing gaps\n            z[1] = Lib.constrain(z[1] + (z[1] > z[0]) ? 1 : -1, zBounds[0], zBounds[1]);\n\n\n            // Colorbar cannot currently support opacities so we\n            // use an opaque fill even when alpha channels present\n            var fillEl = d3.select(this).attr({\n                x: xLeft,\n                width: Math.max(thickPx, 2),\n                y: d3.min(z),\n                height: Math.max(d3.max(z) - d3.min(z), 2),\n            });\n\n            if(opts._fillgradient) {\n                Drawing.gradient(fillEl, gd, opts._id, 'vertical', opts._fillgradient, 'fill');\n            } else {\n                // tinycolor can't handle exponents and\n                // at this scale, removing it makes no difference.\n                var colorString = fillColormap(d).replace('e-', '');\n                fillEl.attr('fill', tinycolor(colorString).toHexString());\n            }\n        });\n\n        var lines = g.select('.' + cn.cblines)\n            .selectAll('path.' + cn.cbline)\n            .data(line.color && line.width ? lineLevels : []);\n        lines.enter().append('path')\n            .classed(cn.cbline, true);\n        lines.exit().remove();\n        lines.each(function(d) {\n            d3.select(this)\n                .attr('d', 'M' + xLeft + ',' +\n                    (Math.round(ax.c2p(d)) + (line.width / 2) % 1) + 'h' + thickPx)\n                .call(Drawing.lineGroupStyle, line.width, lineColormap(d), line.dash);\n        });\n\n        // force full redraw of labels and ticks\n        axLayer.selectAll('g.' + ax._id + 'tick,path').remove();\n\n        var shift = xLeft + thickPx +\n            (opts.outlinewidth || 0) / 2 - (opts.ticks === 'outside' ? 1 : 0);\n\n        var vals = Axes.calcTicks(ax);\n        var tickSign = Axes.getTickSigns(ax)[2];\n\n        Axes.drawTicks(gd, ax, {\n            vals: ax.ticks === 'inside' ? Axes.clipEnds(ax, vals) : vals,\n            layer: axLayer,\n            path: Axes.makeTickPath(ax, shift, tickSign),\n            transFn: Axes.makeTransTickFn(ax)\n        });\n\n        return Axes.drawLabels(gd, ax, {\n            vals: vals,\n            layer: axLayer,\n            transFn: Axes.makeTransTickLabelFn(ax),\n            labelFns: Axes.makeLabelFns(ax, shift)\n        });\n    }\n\n    // wait for the axis & title to finish rendering before\n    // continuing positioning\n    // TODO: why are we redrawing multiple times now with this?\n    // I guess autoMargin doesn't like being post-promise?\n    function positionCB() {\n        var innerWidth = thickPx + opts.outlinewidth / 2;\n        if(ax.ticklabelposition.indexOf('inside') === -1) {\n            innerWidth += Drawing.bBox(axLayer.node()).width;\n        }\n\n        titleEl = titleCont.select('text');\n\n        if(titleEl.node() && !titleEl.classed(cn.jsPlaceholder)) {\n            var mathJaxNode = titleCont.select('.h' + ax._id + 'title-math-group').node();\n            var titleWidth;\n            if(mathJaxNode && ['top', 'bottom'].indexOf(titleSide) !== -1) {\n                titleWidth = Drawing.bBox(mathJaxNode).width;\n            } else {\n                // note: the formula below works for all title sides,\n                // (except for top/bottom mathjax, above)\n                // but the weird gs.l is because the titleunshift\n                // transform gets removed by Drawing.bBox\n                titleWidth = Drawing.bBox(titleCont.node()).right - xLeft - gs.l;\n            }\n            innerWidth = Math.max(innerWidth, titleWidth);\n        }\n\n        var outerwidth = 2 * opts.xpad + innerWidth + opts.borderwidth + opts.outlinewidth / 2;\n        var outerheight = yBottomPx - yTopPx;\n\n        g.select('.' + cn.cbbg).attr({\n            x: xLeft - opts.xpad - (opts.borderwidth + opts.outlinewidth) / 2,\n            y: yTopPx - yExtraPx,\n            width: Math.max(outerwidth, 2),\n            height: Math.max(outerheight + 2 * yExtraPx, 2)\n        })\n        .call(Color.fill, opts.bgcolor)\n        .call(Color.stroke, opts.bordercolor)\n        .style('stroke-width', opts.borderwidth);\n\n        g.selectAll('.' + cn.cboutline).attr({\n            x: xLeft,\n            y: yTopPx + opts.ypad + (titleSide === 'top' ? titleHeight : 0),\n            width: Math.max(thickPx, 2),\n            height: Math.max(outerheight - 2 * opts.ypad - titleHeight, 2)\n        })\n        .call(Color.stroke, opts.outlinecolor)\n        .style({\n            fill: 'none',\n            'stroke-width': opts.outlinewidth\n        });\n\n        // fix positioning for xanchor!='left'\n        var xoffset = ({center: 0.5, right: 1}[opts.xanchor] || 0) * outerwidth;\n        g.attr('transform', strTranslate(gs.l - xoffset, gs.t));\n\n        // auto margin adjustment\n        var marginOpts = {};\n        var tFrac = FROM_TL[opts.yanchor];\n        var bFrac = FROM_BR[opts.yanchor];\n        if(opts.lenmode === 'pixels') {\n            marginOpts.y = opts.y;\n            marginOpts.t = outerheight * tFrac;\n            marginOpts.b = outerheight * bFrac;\n        } else {\n            marginOpts.t = marginOpts.b = 0;\n            marginOpts.yt = opts.y + opts.len * tFrac;\n            marginOpts.yb = opts.y - opts.len * bFrac;\n        }\n\n        var lFrac = FROM_TL[opts.xanchor];\n        var rFrac = FROM_BR[opts.xanchor];\n        if(opts.thicknessmode === 'pixels') {\n            marginOpts.x = opts.x;\n            marginOpts.l = outerwidth * lFrac;\n            marginOpts.r = outerwidth * rFrac;\n        } else {\n            var extraThickness = outerwidth - thickPx;\n            marginOpts.l = extraThickness * lFrac;\n            marginOpts.r = extraThickness * rFrac;\n            marginOpts.xl = opts.x - opts.thickness * lFrac;\n            marginOpts.xr = opts.x + opts.thickness * rFrac;\n        }\n\n        Plots.autoMargin(gd, opts._id, marginOpts);\n    }\n\n    return Lib.syncOrAsync([\n        Plots.previousPromises,\n        drawDummyTitle,\n        drawAxis,\n        drawCbTitle,\n        Plots.previousPromises,\n        positionCB\n    ], gd);\n}\n\nfunction makeEditable(g, opts, gd) {\n    var fullLayout = gd._fullLayout;\n    var gs = fullLayout._size;\n    var t0, xf, yf;\n\n    dragElement.init({\n        element: g.node(),\n        gd: gd,\n        prepFn: function() {\n            t0 = g.attr('transform');\n            setCursor(g);\n        },\n        moveFn: function(dx, dy) {\n            g.attr('transform', t0 + strTranslate(dx, dy));\n\n            xf = dragElement.align(opts._xLeftFrac + (dx / gs.w), opts._thickFrac,\n                0, 1, opts.xanchor);\n            yf = dragElement.align(opts._yBottomFrac - (dy / gs.h), opts._lenFrac,\n                0, 1, opts.yanchor);\n\n            var csr = dragElement.getCursor(xf, yf, opts.xanchor, opts.yanchor);\n            setCursor(g, csr);\n        },\n        doneFn: function() {\n            setCursor(g);\n\n            if(xf !== undefined && yf !== undefined) {\n                var update = {};\n                update[opts._propPrefix + 'x'] = xf;\n                update[opts._propPrefix + 'y'] = yf;\n                if(opts._traceIndex !== undefined) {\n                    Registry.call('_guiRestyle', gd, update, opts._traceIndex);\n                } else {\n                    Registry.call('_guiRelayout', gd, update);\n                }\n            }\n        }\n    });\n}\n\nfunction calcLevels(gd, opts, zrange) {\n    var levelsIn = opts._levels;\n    var lineLevels = [];\n    var fillLevels = [];\n    var l;\n    var i;\n\n    var l0 = levelsIn.end + levelsIn.size / 100;\n    var ls = levelsIn.size;\n    var zr0 = (1.001 * zrange[0] - 0.001 * zrange[1]);\n    var zr1 = (1.001 * zrange[1] - 0.001 * zrange[0]);\n\n    for(i = 0; i < 1e5; i++) {\n        l = levelsIn.start + i * ls;\n        if(ls > 0 ? (l >= l0) : (l <= l0)) break;\n        if(l > zr0 && l < zr1) lineLevels.push(l);\n    }\n\n    if(opts._fillgradient) {\n        fillLevels = [0];\n    } else if(typeof opts._fillcolor === 'function') {\n        var fillLevelsIn = opts._filllevels;\n\n        if(fillLevelsIn) {\n            l0 = fillLevelsIn.end + fillLevelsIn.size / 100;\n            ls = fillLevelsIn.size;\n            for(i = 0; i < 1e5; i++) {\n                l = fillLevelsIn.start + i * ls;\n                if(ls > 0 ? (l >= l0) : (l <= l0)) break;\n                if(l > zrange[0] && l < zrange[1]) fillLevels.push(l);\n            }\n        } else {\n            fillLevels = lineLevels.map(function(v) {\n                return v - levelsIn.size / 2;\n            });\n            fillLevels.push(fillLevels[fillLevels.length - 1] + levelsIn.size);\n        }\n    } else if(opts._fillcolor && typeof opts._fillcolor === 'string') {\n        // doesn't matter what this value is, with a single value\n        // we'll make a single fill rect covering the whole bar\n        fillLevels = [0];\n    }\n\n    if(levelsIn.size < 0) {\n        lineLevels.reverse();\n        fillLevels.reverse();\n    }\n\n    return {line: lineLevels, fill: fillLevels};\n}\n\nfunction mockColorBarAxis(gd, opts, zrange) {\n    var fullLayout = gd._fullLayout;\n\n    var cbAxisIn = {\n        type: 'linear',\n        range: zrange,\n        tickmode: opts.tickmode,\n        nticks: opts.nticks,\n        tick0: opts.tick0,\n        dtick: opts.dtick,\n        tickvals: opts.tickvals,\n        ticktext: opts.ticktext,\n        ticks: opts.ticks,\n        ticklen: opts.ticklen,\n        tickwidth: opts.tickwidth,\n        tickcolor: opts.tickcolor,\n        showticklabels: opts.showticklabels,\n        ticklabelposition: opts.ticklabelposition,\n        ticklabeloverflow: opts.ticklabeloverflow,\n        tickfont: opts.tickfont,\n        tickangle: opts.tickangle,\n        tickformat: opts.tickformat,\n        exponentformat: opts.exponentformat,\n        minexponent: opts.minexponent,\n        separatethousands: opts.separatethousands,\n        showexponent: opts.showexponent,\n        showtickprefix: opts.showtickprefix,\n        tickprefix: opts.tickprefix,\n        showticksuffix: opts.showticksuffix,\n        ticksuffix: opts.ticksuffix,\n        title: opts.title,\n        showline: true,\n        anchor: 'free',\n        side: 'right',\n        position: 1\n    };\n\n    var cbAxisOut = {\n        type: 'linear',\n        _id: 'y' + opts._id\n    };\n\n    var axisOptions = {\n        letter: 'y',\n        font: fullLayout.font,\n        noHover: true,\n        noTickson: true,\n        noTicklabelmode: true,\n        calendar: fullLayout.calendar  // not really necessary (yet?)\n    };\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(cbAxisIn, cbAxisOut, axisLayoutAttrs, attr, dflt);\n    }\n\n    handleAxisDefaults(cbAxisIn, cbAxisOut, coerce, axisOptions, fullLayout);\n    handleAxisPositionDefaults(cbAxisIn, cbAxisOut, coerce, axisOptions);\n\n    return cbAxisOut;\n}\n\nmodule.exports = {\n    draw: draw\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\n\nmodule.exports = function hasColorbar(container) {\n    return Lib.isPlainObject(container.colorbar);\n};\n","'use strict';\n\nmodule.exports = {\n    moduleType: 'component',\n    name: 'colorbar',\n\n    attributes: require('./attributes'),\n    supplyDefaults: require('./defaults'),\n\n    draw: require('./draw').draw,\n    hasColorbar: require('./has_colorbar')\n};\n","'use strict';\n\nvar colorbarAttrs = require('../colorbar/attributes');\nvar counterRegex = require('../../lib/regex').counter;\n\nvar palettes = require('./scales.js').scales;\nvar paletteStr = Object.keys(palettes);\n\nfunction code(s) {\n    return '`' + s + '`';\n}\n\n/**\n * Make colorscale attribute declarations for\n *\n * - colorscale,\n * - (c|z)auto, (c|z)min, (c|z)max,\n * - autocolorscale, reversescale,\n * - showscale (optionally)\n * - color (optionally)\n *\n * @param {string} context (dflt: '', i.e. from trace root):\n *     the container this is in ('', *marker*, *marker.line* etc)\n *\n * @param {object} opts:\n *   - cLetter {string} (dflt: 'c'):\n *     leading letter for 'min', 'max and 'auto' attribute (either 'z' or 'c')\n *\n *   - colorAttr {string} (dflt: 'z' if `cLetter: 'z'`, 'color' if `cLetter: 'c'`):\n *     (for descriptions) sets the name of the color attribute that maps to the colorscale.\n *\n *     N.B. if `colorAttr: 'color'`, we include the `color` declaration here.\n *\n *   - onlyIfNumerical {string} (dflt: false' if `cLetter: 'z'`, true if `cLetter: 'c'`):\n *     (for descriptions) set to true if colorscale attribute only\n *\n *   - colorscaleDflt {string}:\n *     overrides the colorscale dflt\n *\n *   - autoColorDflt {boolean} (dflt true):\n *     normally autocolorscale.dflt is `true`, but pass `false` to override\n *\n *   - noScale {boolean} (dflt: true if `context: 'marker.line'`, false otherwise):\n *     set to `false` to not include showscale attribute (e.g. for 'marker.line')\n *\n *   - showScaleDflt {boolean} (dflt: true if `cLetter: 'z'`, false otherwise)\n *\n *   - editTypeOverride {boolean} (dflt: ''):\n *     most of these attributes already require a recalc, but the ones that do not\n *     have editType *style* or *plot* unless you override (presumably with *calc*)\n *\n *   - anim {boolean) (dflt: undefined): is 'color' animatable?\n *\n * @return {object}\n */\nmodule.exports = function colorScaleAttrs(context, opts) {\n    context = context || '';\n    opts = opts || {};\n\n    var cLetter = opts.cLetter || 'c';\n    var onlyIfNumerical = ('onlyIfNumerical' in opts) ? opts.onlyIfNumerical : Boolean(context);\n    var noScale = ('noScale' in opts) ? opts.noScale : context === 'marker.line';\n    var showScaleDflt = ('showScaleDflt' in opts) ? opts.showScaleDflt : cLetter === 'z';\n    var colorscaleDflt = typeof opts.colorscaleDflt === 'string' ? palettes[opts.colorscaleDflt] : null;\n    var editTypeOverride = opts.editTypeOverride || '';\n    var contextHead = context ? (context + '.') : '';\n\n    var colorAttr, colorAttrFull;\n\n    if('colorAttr' in opts) {\n        colorAttr = opts.colorAttr;\n        colorAttrFull = opts.colorAttr;\n    } else {\n        colorAttr = {z: 'z', c: 'color'}[cLetter];\n        colorAttrFull = 'in ' + code(contextHead + colorAttr);\n    }\n\n    var effectDesc = onlyIfNumerical ?\n        ' Has an effect only if ' + colorAttrFull + 'is set to a numerical array.' :\n        '';\n\n    var auto = cLetter + 'auto';\n    var min = cLetter + 'min';\n    var max = cLetter + 'max';\n    var mid = cLetter + 'mid';\n    var autoFull = code(contextHead + auto);\n    var minFull = code(contextHead + min);\n    var maxFull = code(contextHead + max);\n    var minmaxFull = minFull + ' and ' + maxFull;\n    var autoImpliedEdits = {};\n    autoImpliedEdits[min] = autoImpliedEdits[max] = undefined;\n    var minmaxImpliedEdits = {};\n    minmaxImpliedEdits[auto] = false;\n\n    var attrs = {};\n\n    if(colorAttr === 'color') {\n        attrs.color = {\n            valType: 'color',\n            arrayOk: true,\n            editType: editTypeOverride || 'style',\n            description: [\n                'Sets the', context, 'color.',\n                ' It accepts either a specific color',\n                ' or an array of numbers that are mapped to the colorscale',\n                ' relative to the max and min values of the array or relative to',\n                ' ' + minmaxFull + ' if set.'\n            ].join('')\n        };\n\n        if(opts.anim) {\n            attrs.color.anim = true;\n        }\n    }\n\n    attrs[auto] = {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'calc',\n        impliedEdits: autoImpliedEdits,\n        description: [\n            'Determines whether or not the color domain is computed',\n            ' with respect to the input data (here ' + colorAttrFull + ') or the bounds set in',\n            ' ', minmaxFull,\n            ' ', effectDesc,\n            ' Defaults to `false` when ', minmaxFull, ' are set by the user.'\n        ].join('')\n    };\n\n    attrs[min] = {\n        valType: 'number',\n        dflt: null,\n        editType: editTypeOverride || 'plot',\n        impliedEdits: minmaxImpliedEdits,\n        description: [\n            'Sets the lower bound of the color domain.',\n            effectDesc,\n            ' Value should have the same units as ', colorAttrFull,\n            ' and if set, ', maxFull, ' must be set as well.'\n        ].join('')\n    };\n\n    attrs[max] = {\n        valType: 'number',\n        dflt: null,\n        editType: editTypeOverride || 'plot',\n        impliedEdits: minmaxImpliedEdits,\n        description: [\n            'Sets the upper bound of the color domain.',\n            effectDesc,\n            ' Value should have the same units as ', colorAttrFull,\n            ' and if set, ', minFull, ' must be set as well.'\n        ].join('')\n    };\n\n    attrs[mid] = {\n        valType: 'number',\n        dflt: null,\n        editType: 'calc',\n        impliedEdits: autoImpliedEdits,\n        description: [\n            'Sets the mid-point of the color domain by scaling ', minFull,\n            ' and/or ', maxFull, ' to be equidistant to this point.',\n            effectDesc,\n            ' Value should have the same units as ', colorAttrFull, '. ',\n            'Has no effect when ', autoFull, ' is `false`.'\n        ].join('')\n    };\n\n    attrs.colorscale = {\n        valType: 'colorscale',\n        editType: 'calc',\n        dflt: colorscaleDflt,\n        impliedEdits: {autocolorscale: false},\n        description: [\n            'Sets the colorscale.',\n            effectDesc,\n            ' The colorscale must be an array containing',\n            ' arrays mapping a normalized value to an',\n            ' rgb, rgba, hex, hsl, hsv, or named color string.',\n            ' At minimum, a mapping for the lowest (0) and highest (1)',\n            ' values are required. For example,',\n            ' `[[0, \\'rgb(0,0,255)\\'], [1, \\'rgb(255,0,0)\\']]`.',\n            ' To control the bounds of the colorscale in color space,',\n            ' use', minmaxFull, '.',\n            ' Alternatively, `colorscale` may be a palette name string',\n            ' of the following list: ' + paletteStr + '.'\n        ].join('')\n    };\n\n    attrs.autocolorscale = {\n        valType: 'boolean',\n        // gets overrode in 'heatmap' & 'surface' for backwards comp.\n        dflt: opts.autoColorDflt === false ? false : true,\n        editType: 'calc',\n        impliedEdits: {colorscale: undefined},\n        description: [\n            'Determines whether the colorscale is a default palette (`autocolorscale: true`)',\n            ' or the palette determined by ', code(contextHead + 'colorscale'), '.',\n            effectDesc,\n            ' In case `colorscale` is unspecified or `autocolorscale` is true, the default ',\n            ' palette will be chosen according to whether numbers in the `color` array are',\n            ' all positive, all negative or mixed.'\n        ].join('')\n    };\n\n    attrs.reversescale = {\n        valType: 'boolean',\n        dflt: false,\n        editType: 'plot',\n        description: [\n            'Reverses the color mapping if true.',\n            effectDesc,\n            ' If true, ', minFull, ' will correspond to the last color',\n            ' in the array and ', maxFull, ' will correspond to the first color.'\n        ].join('')\n    };\n\n    if(!noScale) {\n        attrs.showscale = {\n            valType: 'boolean',\n            dflt: showScaleDflt,\n            editType: 'calc',\n            description: [\n                'Determines whether or not a colorbar is displayed for this trace.',\n                effectDesc\n            ].join('')\n        };\n\n        attrs.colorbar = colorbarAttrs;\n    }\n\n    if(!opts.noColorAxis) {\n        attrs.coloraxis = {\n            valType: 'subplotid',\n            regex: counterRegex('coloraxis'),\n            dflt: null,\n            editType: 'calc',\n            description: [\n                'Sets a reference to a shared color axis.',\n                'References to these shared color axes are *coloraxis*, *coloraxis2*, *coloraxis3*, etc.',\n                'Settings for these shared color axes are set in the layout, under',\n                '`layout.coloraxis`, `layout.coloraxis2`, etc.',\n                'Note that multiple color scales can be linked to the same color axis.'\n            ].join(' ')\n        };\n    }\n\n    return attrs;\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\nvar Lib = require('../../lib');\nvar extractOpts = require('./helpers').extractOpts;\n\nmodule.exports = function calc(gd, trace, opts) {\n    var fullLayout = gd._fullLayout;\n    var vals = opts.vals;\n    var containerStr = opts.containerStr;\n\n    var container = containerStr ?\n        Lib.nestedProperty(trace, containerStr).get() :\n        trace;\n\n    var cOpts = extractOpts(container);\n    var auto = cOpts.auto !== false;\n    var min = cOpts.min;\n    var max = cOpts.max;\n    var mid = cOpts.mid;\n\n    var minVal = function() { return Lib.aggNums(Math.min, null, vals); };\n    var maxVal = function() { return Lib.aggNums(Math.max, null, vals); };\n\n    if(min === undefined) {\n        min = minVal();\n    } else if(auto) {\n        if(container._colorAx && isNumeric(min)) {\n            min = Math.min(min, minVal());\n        } else {\n            min = minVal();\n        }\n    }\n\n    if(max === undefined) {\n        max = maxVal();\n    } else if(auto) {\n        if(container._colorAx && isNumeric(max)) {\n            max = Math.max(max, maxVal());\n        } else {\n            max = maxVal();\n        }\n    }\n\n    if(auto && mid !== undefined) {\n        if(max - mid > mid - min) {\n            min = mid - (max - mid);\n        } else if(max - mid < mid - min) {\n            max = mid + (mid - min);\n        }\n    }\n\n    if(min === max) {\n        min -= 0.5;\n        max += 0.5;\n    }\n\n    cOpts._sync('min', min);\n    cOpts._sync('max', max);\n\n    if(cOpts.autocolorscale) {\n        var scl;\n        if(min * max < 0) scl = fullLayout.colorscale.diverging;\n        else if(min >= 0) scl = fullLayout.colorscale.sequential;\n        else scl = fullLayout.colorscale.sequentialminus;\n        cOpts._sync('colorscale', scl);\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar hasColorscale = require('./helpers').hasColorscale;\nvar extractOpts = require('./helpers').extractOpts;\n\nmodule.exports = function crossTraceDefaults(fullData, fullLayout) {\n    function replace(cont, k) {\n        var val = cont['_' + k];\n        if(val !== undefined) {\n            cont[k] = val;\n        }\n    }\n\n    function relinkColorAttrs(outerCont, cbOpt) {\n        var cont = cbOpt.container ?\n            Lib.nestedProperty(outerCont, cbOpt.container).get() :\n            outerCont;\n\n        if(cont) {\n            if(cont.coloraxis) {\n                // stash ref to color axis\n                cont._colorAx = fullLayout[cont.coloraxis];\n            } else {\n                var cOpts = extractOpts(cont);\n                var isAuto = cOpts.auto;\n\n                if(isAuto || cOpts.min === undefined) {\n                    replace(cont, cbOpt.min);\n                }\n                if(isAuto || cOpts.max === undefined) {\n                    replace(cont, cbOpt.max);\n                }\n                if(cOpts.autocolorscale) {\n                    replace(cont, 'colorscale');\n                }\n            }\n        }\n    }\n\n    for(var i = 0; i < fullData.length; i++) {\n        var trace = fullData[i];\n        var cbOpts = trace._module.colorbar;\n\n        if(cbOpts) {\n            if(Array.isArray(cbOpts)) {\n                for(var j = 0; j < cbOpts.length; j++) {\n                    relinkColorAttrs(trace, cbOpts[j]);\n                }\n            } else {\n                relinkColorAttrs(trace, cbOpts);\n            }\n        }\n\n        if(hasColorscale(trace, 'marker.line')) {\n            relinkColorAttrs(trace, {\n                container: 'marker.line',\n                min: 'cmin',\n                max: 'cmax'\n            });\n        }\n    }\n\n    for(var k in fullLayout._colorAxes) {\n        relinkColorAttrs(fullLayout[k], {min: 'cmin', max: 'cmax'});\n    }\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\nvar Lib = require('../../lib');\nvar hasColorbar = require('../colorbar/has_colorbar');\nvar colorbarDefaults = require('../colorbar/defaults');\n\nvar isValidScale = require('./scales').isValid;\nvar traceIs = require('../../registry').traceIs;\n\nfunction npMaybe(parentCont, prefix) {\n    var containerStr = prefix.slice(0, prefix.length - 1);\n    return prefix ?\n        Lib.nestedProperty(parentCont, containerStr).get() || {} :\n        parentCont;\n}\n\n/**\n * Colorscale / colorbar default handler\n *\n * @param {object} parentContIn : user (input) parent container (e.g. trace or layout coloraxis object)\n * @param {object} parentContOut : full parent container\n * @param {object} layout : (full) layout object\n * @param {fn} coerce : Lib.coerce wrapper\n * @param {object} opts :\n * - prefix {string} : attr string prefix to colorscale container from parent root\n * - cLetter {string} : 'c or 'z' color letter\n */\nmodule.exports = function colorScaleDefaults(parentContIn, parentContOut, layout, coerce, opts) {\n    var prefix = opts.prefix;\n    var cLetter = opts.cLetter;\n    var inTrace = '_module' in parentContOut;\n    var containerIn = npMaybe(parentContIn, prefix);\n    var containerOut = npMaybe(parentContOut, prefix);\n    var template = npMaybe(parentContOut._template || {}, prefix) || {};\n\n    // colorScaleDefaults wrapper called if-ever we need to reset the colorscale\n    // attributes for containers that were linked to invalid color axes\n    var thisFn = function() {\n        delete parentContIn.coloraxis;\n        delete parentContOut.coloraxis;\n        return colorScaleDefaults(parentContIn, parentContOut, layout, coerce, opts);\n    };\n\n    if(inTrace) {\n        var colorAxes = layout._colorAxes || {};\n        var colorAx = coerce(prefix + 'coloraxis');\n\n        if(colorAx) {\n            var colorbarVisuals = (\n                traceIs(parentContOut, 'contour') &&\n                Lib.nestedProperty(parentContOut, 'contours.coloring').get()\n            ) || 'heatmap';\n\n            var stash = colorAxes[colorAx];\n\n            if(stash) {\n                stash[2].push(thisFn);\n\n                if(stash[0] !== colorbarVisuals) {\n                    stash[0] = false;\n                    Lib.warn([\n                        'Ignoring coloraxis:', colorAx, 'setting',\n                        'as it is linked to incompatible colorscales.'\n                    ].join(' '));\n                }\n            } else {\n                // stash:\n                // - colorbar visual 'type'\n                // - colorbar options to help in Colorbar.draw\n                // - list of colorScaleDefaults wrapper functions\n                colorAxes[colorAx] = [colorbarVisuals, parentContOut, [thisFn]];\n            }\n            return;\n        }\n    }\n\n    var minIn = containerIn[cLetter + 'min'];\n    var maxIn = containerIn[cLetter + 'max'];\n    var validMinMax = isNumeric(minIn) && isNumeric(maxIn) && (minIn < maxIn);\n    var auto = coerce(prefix + cLetter + 'auto', !validMinMax);\n\n    if(auto) {\n        coerce(prefix + cLetter + 'mid');\n    } else {\n        coerce(prefix + cLetter + 'min');\n        coerce(prefix + cLetter + 'max');\n    }\n\n    // handles both the trace case (autocolorscale is false by default) and\n    // the marker and marker.line case (autocolorscale is true by default)\n    var sclIn = containerIn.colorscale;\n    var sclTemplate = template.colorscale;\n    var autoColorscaleDflt;\n    if(sclIn !== undefined) autoColorscaleDflt = !isValidScale(sclIn);\n    if(sclTemplate !== undefined) autoColorscaleDflt = !isValidScale(sclTemplate);\n    coerce(prefix + 'autocolorscale', autoColorscaleDflt);\n\n    coerce(prefix + 'colorscale');\n    coerce(prefix + 'reversescale');\n\n    if(prefix !== 'marker.line.') {\n        // handles both the trace case where the dflt is listed in attributes and\n        // the marker case where the dflt is determined by hasColorbar\n        var showScaleDflt;\n        if(prefix && inTrace) showScaleDflt = hasColorbar(containerIn);\n\n        var showScale = coerce(prefix + 'showscale', showScaleDflt);\n        if(showScale) {\n            if(prefix && template) containerOut._template = template;\n            colorbarDefaults(containerIn, containerOut, layout);\n        }\n    }\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar tinycolor = require('tinycolor2');\nvar isNumeric = require('fast-isnumeric');\n\nvar Lib = require('../../lib');\nvar Color = require('../color');\n\nvar isValidScale = require('./scales').isValid;\n\nfunction hasColorscale(trace, containerStr, colorKey) {\n    var container = containerStr ?\n        Lib.nestedProperty(trace, containerStr).get() || {} :\n        trace;\n    var color = container[colorKey || 'color'];\n\n    var isArrayWithOneNumber = false;\n    if(Lib.isArrayOrTypedArray(color)) {\n        for(var i = 0; i < color.length; i++) {\n            if(isNumeric(color[i])) {\n                isArrayWithOneNumber = true;\n                break;\n            }\n        }\n    }\n\n    return (\n        Lib.isPlainObject(container) && (\n            isArrayWithOneNumber ||\n            container.showscale === true ||\n            (isNumeric(container.cmin) && isNumeric(container.cmax)) ||\n            isValidScale(container.colorscale) ||\n            Lib.isPlainObject(container.colorbar)\n        )\n    );\n}\n\nvar constantAttrs = ['showscale', 'autocolorscale', 'colorscale', 'reversescale', 'colorbar'];\nvar letterAttrs = ['min', 'max', 'mid', 'auto'];\n\n/**\n * Extract 'c' / 'z', trace / color axis colorscale options\n *\n * Note that it would be nice to replace all z* with c* equivalents in v3\n *\n * @param {object} cont : attribute container\n * @return {object}:\n *  - min: cmin or zmin\n *  - max: cmax or zmax\n *  - mid: cmid or zmid\n *  - auto: cauto or zauto\n *  - *scale: *scale attrs\n *  - colorbar: colorbar\n *  - _sync: function syncing attr and underscore dual (useful when calc'ing min/max)\n */\nfunction extractOpts(cont) {\n    var colorAx = cont._colorAx;\n    var cont2 = colorAx ? colorAx : cont;\n    var out = {};\n    var cLetter;\n    var i, k;\n\n    for(i = 0; i < constantAttrs.length; i++) {\n        k = constantAttrs[i];\n        out[k] = cont2[k];\n    }\n\n    if(colorAx) {\n        cLetter = 'c';\n        for(i = 0; i < letterAttrs.length; i++) {\n            k = letterAttrs[i];\n            out[k] = cont2['c' + k];\n        }\n    } else {\n        var k2;\n        for(i = 0; i < letterAttrs.length; i++) {\n            k = letterAttrs[i];\n            k2 = 'c' + k;\n            if(k2 in cont2) {\n                out[k] = cont2[k2];\n                continue;\n            }\n            k2 = 'z' + k;\n            if(k2 in cont2) {\n                out[k] = cont2[k2];\n            }\n        }\n        cLetter = k2.charAt(0);\n    }\n\n    out._sync = function(k, v) {\n        var k2 = letterAttrs.indexOf(k) !== -1 ? cLetter + k : k;\n        cont2[k2] = cont2['_' + k2] = v;\n    };\n\n    return out;\n}\n\n/**\n * Extract colorscale into numeric domain and color range.\n *\n * @param {object} cont colorscale container (e.g. trace, marker)\n *  - colorscale {array of arrays}\n *  - cmin/zmin {number}\n *  - cmax/zmax {number}\n *  - reversescale {boolean}\n *\n * @return {object}\n *  - domain {array}\n *  - range {array}\n */\nfunction extractScale(cont) {\n    var cOpts = extractOpts(cont);\n    var cmin = cOpts.min;\n    var cmax = cOpts.max;\n\n    var scl = cOpts.reversescale ?\n        flipScale(cOpts.colorscale) :\n        cOpts.colorscale;\n\n    var N = scl.length;\n    var domain = new Array(N);\n    var range = new Array(N);\n\n    for(var i = 0; i < N; i++) {\n        var si = scl[i];\n        domain[i] = cmin + si[0] * (cmax - cmin);\n        range[i] = si[1];\n    }\n\n    return {domain: domain, range: range};\n}\n\nfunction flipScale(scl) {\n    var N = scl.length;\n    var sclNew = new Array(N);\n\n    for(var i = N - 1, j = 0; i >= 0; i--, j++) {\n        var si = scl[i];\n        sclNew[j] = [1 - si[0], si[1]];\n    }\n    return sclNew;\n}\n\n/**\n * General colorscale function generator.\n *\n * @param {object} specs output of Colorscale.extractScale or precomputed domain, range.\n *  - domain {array}\n *  - range {array}\n *\n * @param {object} opts\n *  - noNumericCheck {boolean} if true, scale func bypasses numeric checks\n *  - returnArray {boolean} if true, scale func return 4-item array instead of color strings\n *\n * @return {function}\n */\nfunction makeColorScaleFunc(specs, opts) {\n    opts = opts || {};\n\n    var domain = specs.domain;\n    var range = specs.range;\n    var N = range.length;\n    var _range = new Array(N);\n\n    for(var i = 0; i < N; i++) {\n        var rgba = tinycolor(range[i]).toRgb();\n        _range[i] = [rgba.r, rgba.g, rgba.b, rgba.a];\n    }\n\n    var _sclFunc = d3.scale.linear()\n        .domain(domain)\n        .range(_range)\n        .clamp(true);\n\n    var noNumericCheck = opts.noNumericCheck;\n    var returnArray = opts.returnArray;\n    var sclFunc;\n\n    if(noNumericCheck && returnArray) {\n        sclFunc = _sclFunc;\n    } else if(noNumericCheck) {\n        sclFunc = function(v) {\n            return colorArray2rbga(_sclFunc(v));\n        };\n    } else if(returnArray) {\n        sclFunc = function(v) {\n            if(isNumeric(v)) return _sclFunc(v);\n            else if(tinycolor(v).isValid()) return v;\n            else return Color.defaultLine;\n        };\n    } else {\n        sclFunc = function(v) {\n            if(isNumeric(v)) return colorArray2rbga(_sclFunc(v));\n            else if(tinycolor(v).isValid()) return v;\n            else return Color.defaultLine;\n        };\n    }\n\n    // colorbar draw looks into the d3 scale closure for domain and range\n    sclFunc.domain = _sclFunc.domain;\n    sclFunc.range = function() { return range; };\n\n    return sclFunc;\n}\n\nfunction makeColorScaleFuncFromTrace(trace, opts) {\n    return makeColorScaleFunc(extractScale(trace), opts);\n}\n\nfunction colorArray2rbga(colorArray) {\n    var colorObj = {\n        r: colorArray[0],\n        g: colorArray[1],\n        b: colorArray[2],\n        a: colorArray[3]\n    };\n\n    return tinycolor(colorObj).toRgbString();\n}\n\nmodule.exports = {\n    hasColorscale: hasColorscale,\n    extractOpts: extractOpts,\n    extractScale: extractScale,\n    flipScale: flipScale,\n    makeColorScaleFunc: makeColorScaleFunc,\n    makeColorScaleFuncFromTrace: makeColorScaleFuncFromTrace\n};\n","'use strict';\n\nvar scales = require('./scales');\nvar helpers = require('./helpers');\n\nmodule.exports = {\n    moduleType: 'component',\n    name: 'colorscale',\n\n    attributes: require('./attributes'),\n    layoutAttributes: require('./layout_attributes'),\n\n    supplyLayoutDefaults: require('./layout_defaults'),\n    handleDefaults: require('./defaults'),\n    crossTraceDefaults: require('./cross_trace_defaults'),\n\n    calc: require('./calc'),\n\n    // ./scales.js is required in lib/coerce.js ;\n    // it needs to be a separate module to avoid circular a dependency\n    scales: scales.scales,\n    defaultScale: scales.defaultScale,\n    getScale: scales.get,\n    isValidScale: scales.isValid,\n\n    hasColorscale: helpers.hasColorscale,\n    extractOpts: helpers.extractOpts,\n    extractScale: helpers.extractScale,\n    flipScale: helpers.flipScale,\n    makeColorScaleFunc: helpers.makeColorScaleFunc,\n    makeColorScaleFuncFromTrace: helpers.makeColorScaleFuncFromTrace\n};\n","'use strict';\n\nvar extendFlat = require('../../lib/extend').extendFlat;\n\nvar colorScaleAttrs = require('./attributes');\nvar scales = require('./scales').scales;\n\nvar msg = 'Note that `autocolorscale` must be true for this attribute to work.';\n\nmodule.exports = {\n    editType: 'calc',\n\n    colorscale: {\n        editType: 'calc',\n\n        sequential: {\n            valType: 'colorscale',\n            dflt: scales.Reds,\n            editType: 'calc',\n            description: [\n                'Sets the default sequential colorscale for positive values.',\n                msg\n            ].join(' ')\n        },\n        sequentialminus: {\n            valType: 'colorscale',\n            dflt: scales.Blues,\n            editType: 'calc',\n            description: [\n                'Sets the default sequential colorscale for negative values.',\n                msg\n            ].join(' ')\n        },\n        diverging: {\n            valType: 'colorscale',\n            dflt: scales.RdBu,\n            editType: 'calc',\n            description: [\n                'Sets the default diverging colorscale.',\n                msg\n            ].join(' ')\n        }\n    },\n\n    coloraxis: extendFlat({\n        // not really a 'subplot' attribute container,\n        // but this is the flag we use to denote attributes that\n        // support yaxis, yaxis2, yaxis3, ... counters\n        _isSubplotObj: true,\n        editType: 'calc',\n        description: [\n            ''\n        ].join(' ')\n    }, colorScaleAttrs('', {\n        colorAttr: 'corresponding trace color array(s)',\n        noColorAxis: true,\n        showScaleDflt: true\n    }))\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Template = require('../../plot_api/plot_template');\n\nvar colorScaleAttrs = require('./layout_attributes');\nvar colorScaleDefaults = require('./defaults');\n\nmodule.exports = function supplyLayoutDefaults(layoutIn, layoutOut) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(layoutIn, layoutOut, colorScaleAttrs, attr, dflt);\n    }\n\n    coerce('colorscale.sequential');\n    coerce('colorscale.sequentialminus');\n    coerce('colorscale.diverging');\n\n    var colorAxes = layoutOut._colorAxes;\n    var colorAxIn, colorAxOut;\n\n    function coerceAx(attr, dflt) {\n        return Lib.coerce(colorAxIn, colorAxOut, colorScaleAttrs.coloraxis, attr, dflt);\n    }\n\n    for(var k in colorAxes) {\n        var stash = colorAxes[k];\n\n        if(stash[0]) {\n            colorAxIn = layoutIn[k] || {};\n            colorAxOut = Template.newContainer(layoutOut, k, 'coloraxis');\n            colorAxOut._name = k;\n            colorScaleDefaults(colorAxIn, colorAxOut, layoutOut, coerceAx, {prefix: '', cLetter: 'c'});\n        } else {\n            // re-coerce colorscale attributes w/o coloraxis\n            for(var i = 0; i < stash[2].length; i++) {\n                stash[2][i]();\n            }\n            delete layoutOut._colorAxes[k];\n        }\n    }\n};\n","'use strict';\n\nvar tinycolor = require('tinycolor2');\n\nvar scales = {\n    'Greys': [\n        [0, 'rgb(0,0,0)'], [1, 'rgb(255,255,255)']\n    ],\n\n    'YlGnBu': [\n        [0, 'rgb(8,29,88)'], [0.125, 'rgb(37,52,148)'],\n        [0.25, 'rgb(34,94,168)'], [0.375, 'rgb(29,145,192)'],\n        [0.5, 'rgb(65,182,196)'], [0.625, 'rgb(127,205,187)'],\n        [0.75, 'rgb(199,233,180)'], [0.875, 'rgb(237,248,217)'],\n        [1, 'rgb(255,255,217)']\n    ],\n\n    'Greens': [\n        [0, 'rgb(0,68,27)'], [0.125, 'rgb(0,109,44)'],\n        [0.25, 'rgb(35,139,69)'], [0.375, 'rgb(65,171,93)'],\n        [0.5, 'rgb(116,196,118)'], [0.625, 'rgb(161,217,155)'],\n        [0.75, 'rgb(199,233,192)'], [0.875, 'rgb(229,245,224)'],\n        [1, 'rgb(247,252,245)']\n    ],\n\n    'YlOrRd': [\n        [0, 'rgb(128,0,38)'], [0.125, 'rgb(189,0,38)'],\n        [0.25, 'rgb(227,26,28)'], [0.375, 'rgb(252,78,42)'],\n        [0.5, 'rgb(253,141,60)'], [0.625, 'rgb(254,178,76)'],\n        [0.75, 'rgb(254,217,118)'], [0.875, 'rgb(255,237,160)'],\n        [1, 'rgb(255,255,204)']\n    ],\n\n    'Bluered': [\n        [0, 'rgb(0,0,255)'], [1, 'rgb(255,0,0)']\n    ],\n\n    // modified RdBu based on\n    // http://www.kennethmoreland.com/color-maps/\n    'RdBu': [\n        [0, 'rgb(5,10,172)'], [0.35, 'rgb(106,137,247)'],\n        [0.5, 'rgb(190,190,190)'], [0.6, 'rgb(220,170,132)'],\n        [0.7, 'rgb(230,145,90)'], [1, 'rgb(178,10,28)']\n    ],\n\n    // Scale for non-negative numeric values\n    'Reds': [\n        [0, 'rgb(220,220,220)'], [0.2, 'rgb(245,195,157)'],\n        [0.4, 'rgb(245,160,105)'], [1, 'rgb(178,10,28)']\n    ],\n\n    // Scale for non-positive numeric values\n    'Blues': [\n        [0, 'rgb(5,10,172)'], [0.35, 'rgb(40,60,190)'],\n        [0.5, 'rgb(70,100,245)'], [0.6, 'rgb(90,120,245)'],\n        [0.7, 'rgb(106,137,247)'], [1, 'rgb(220,220,220)']\n    ],\n\n    'Picnic': [\n        [0, 'rgb(0,0,255)'], [0.1, 'rgb(51,153,255)'],\n        [0.2, 'rgb(102,204,255)'], [0.3, 'rgb(153,204,255)'],\n        [0.4, 'rgb(204,204,255)'], [0.5, 'rgb(255,255,255)'],\n        [0.6, 'rgb(255,204,255)'], [0.7, 'rgb(255,153,255)'],\n        [0.8, 'rgb(255,102,204)'], [0.9, 'rgb(255,102,102)'],\n        [1, 'rgb(255,0,0)']\n    ],\n\n    'Rainbow': [\n        [0, 'rgb(150,0,90)'], [0.125, 'rgb(0,0,200)'],\n        [0.25, 'rgb(0,25,255)'], [0.375, 'rgb(0,152,255)'],\n        [0.5, 'rgb(44,255,150)'], [0.625, 'rgb(151,255,0)'],\n        [0.75, 'rgb(255,234,0)'], [0.875, 'rgb(255,111,0)'],\n        [1, 'rgb(255,0,0)']\n    ],\n\n    'Portland': [\n        [0, 'rgb(12,51,131)'], [0.25, 'rgb(10,136,186)'],\n        [0.5, 'rgb(242,211,56)'], [0.75, 'rgb(242,143,56)'],\n        [1, 'rgb(217,30,30)']\n    ],\n\n    'Jet': [\n        [0, 'rgb(0,0,131)'], [0.125, 'rgb(0,60,170)'],\n        [0.375, 'rgb(5,255,255)'], [0.625, 'rgb(255,255,0)'],\n        [0.875, 'rgb(250,0,0)'], [1, 'rgb(128,0,0)']\n    ],\n\n    'Hot': [\n        [0, 'rgb(0,0,0)'], [0.3, 'rgb(230,0,0)'],\n        [0.6, 'rgb(255,210,0)'], [1, 'rgb(255,255,255)']\n    ],\n\n    'Blackbody': [\n        [0, 'rgb(0,0,0)'], [0.2, 'rgb(230,0,0)'],\n        [0.4, 'rgb(230,210,0)'], [0.7, 'rgb(255,255,255)'],\n        [1, 'rgb(160,200,255)']\n    ],\n\n    'Earth': [\n        [0, 'rgb(0,0,130)'], [0.1, 'rgb(0,180,180)'],\n        [0.2, 'rgb(40,210,40)'], [0.4, 'rgb(230,230,50)'],\n        [0.6, 'rgb(120,70,20)'], [1, 'rgb(255,255,255)']\n    ],\n\n    'Electric': [\n        [0, 'rgb(0,0,0)'], [0.15, 'rgb(30,0,100)'],\n        [0.4, 'rgb(120,0,100)'], [0.6, 'rgb(160,90,0)'],\n        [0.8, 'rgb(230,200,0)'], [1, 'rgb(255,250,220)']\n    ],\n\n    'Viridis': [\n        [0, '#440154'], [0.06274509803921569, '#48186a'],\n        [0.12549019607843137, '#472d7b'], [0.18823529411764706, '#424086'],\n        [0.25098039215686274, '#3b528b'], [0.3137254901960784, '#33638d'],\n        [0.3764705882352941, '#2c728e'], [0.4392156862745098, '#26828e'],\n        [0.5019607843137255, '#21918c'], [0.5647058823529412, '#1fa088'],\n        [0.6274509803921569, '#28ae80'], [0.6901960784313725, '#3fbc73'],\n        [0.7529411764705882, '#5ec962'], [0.8156862745098039, '#84d44b'],\n        [0.8784313725490196, '#addc30'], [0.9411764705882353, '#d8e219'],\n        [1, '#fde725']\n    ],\n\n    'Cividis': [\n        [0.000000, 'rgb(0,32,76)'], [0.058824, 'rgb(0,42,102)'],\n        [0.117647, 'rgb(0,52,110)'], [0.176471, 'rgb(39,63,108)'],\n        [0.235294, 'rgb(60,74,107)'], [0.294118, 'rgb(76,85,107)'],\n        [0.352941, 'rgb(91,95,109)'], [0.411765, 'rgb(104,106,112)'],\n        [0.470588, 'rgb(117,117,117)'], [0.529412, 'rgb(131,129,120)'],\n        [0.588235, 'rgb(146,140,120)'], [0.647059, 'rgb(161,152,118)'],\n        [0.705882, 'rgb(176,165,114)'], [0.764706, 'rgb(192,177,109)'],\n        [0.823529, 'rgb(209,191,102)'], [0.882353, 'rgb(225,204,92)'],\n        [0.941176, 'rgb(243,219,79)'], [1.000000, 'rgb(255,233,69)']\n    ]\n};\n\nvar defaultScale = scales.RdBu;\n\nfunction getScale(scl, dflt) {\n    if(!dflt) dflt = defaultScale;\n    if(!scl) return dflt;\n\n    function parseScale() {\n        try {\n            scl = scales[scl] || JSON.parse(scl);\n        } catch(e) {\n            scl = dflt;\n        }\n    }\n\n    if(typeof scl === 'string') {\n        parseScale();\n        // occasionally scl is double-JSON encoded...\n        if(typeof scl === 'string') parseScale();\n    }\n\n    if(!isValidScaleArray(scl)) return dflt;\n    return scl;\n}\n\n\nfunction isValidScaleArray(scl) {\n    var highestVal = 0;\n\n    if(!Array.isArray(scl) || scl.length < 2) return false;\n\n    if(!scl[0] || !scl[scl.length - 1]) return false;\n\n    if(+scl[0][0] !== 0 || +scl[scl.length - 1][0] !== 1) return false;\n\n    for(var i = 0; i < scl.length; i++) {\n        var si = scl[i];\n\n        if(si.length !== 2 || +si[0] < highestVal || !tinycolor(si[1]).isValid()) {\n            return false;\n        }\n\n        highestVal = +si[0];\n    }\n\n    return true;\n}\n\nfunction isValidScale(scl) {\n    if(scales[scl] !== undefined) return true;\n    else return isValidScaleArray(scl);\n}\n\nmodule.exports = {\n    scales: scales,\n    defaultScale: defaultScale,\n\n    get: getScale,\n    isValid: isValidScale\n};\n","'use strict';\n\n\n// for automatic alignment on dragging, <1/3 means left align,\n// >2/3 means right, and between is center. Pick the right fraction\n// based on where you are, and return the fraction corresponding to\n// that position on the object\nmodule.exports = function align(v, dv, v0, v1, anchor) {\n    var vmin = (v - v0) / (v1 - v0);\n    var vmax = vmin + dv / (v1 - v0);\n    var vc = (vmin + vmax) / 2;\n\n    // explicitly specified anchor\n    if(anchor === 'left' || anchor === 'bottom') return vmin;\n    if(anchor === 'center' || anchor === 'middle') return vc;\n    if(anchor === 'right' || anchor === 'top') return vmax;\n\n    // automatic based on position\n    if(vmin < (2 / 3) - vc) return vmin;\n    if(vmax > (4 / 3) - vc) return vmax;\n    return vc;\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\n\n// set cursors pointing toward the closest corner/side,\n// to indicate alignment\n// x and y are 0-1, fractions of the plot area\nvar cursorset = [\n    ['sw-resize', 's-resize', 'se-resize'],\n    ['w-resize', 'move', 'e-resize'],\n    ['nw-resize', 'n-resize', 'ne-resize']\n];\n\nmodule.exports = function getCursor(x, y, xanchor, yanchor) {\n    if(xanchor === 'left') x = 0;\n    else if(xanchor === 'center') x = 1;\n    else if(xanchor === 'right') x = 2;\n    else x = Lib.constrain(Math.floor(x * 3), 0, 2);\n\n    if(yanchor === 'bottom') y = 0;\n    else if(yanchor === 'middle') y = 1;\n    else if(yanchor === 'top') y = 2;\n    else y = Lib.constrain(Math.floor(y * 3), 0, 2);\n\n    return cursorset[y][x];\n};\n","'use strict';\n\nexports.selectMode = function(dragmode) {\n    return (\n        dragmode === 'lasso' ||\n        dragmode === 'select'\n    );\n};\n\nexports.drawMode = function(dragmode) {\n    return (\n        dragmode === 'drawclosedpath' ||\n        dragmode === 'drawopenpath' ||\n        dragmode === 'drawline' ||\n        dragmode === 'drawrect' ||\n        dragmode === 'drawcircle'\n    );\n};\n\nexports.openMode = function(dragmode) {\n    return (\n        dragmode === 'drawline' ||\n        dragmode === 'drawopenpath'\n    );\n};\n\nexports.rectMode = function(dragmode) {\n    return (\n        dragmode === 'select' ||\n        dragmode === 'drawline' ||\n        dragmode === 'drawrect' ||\n        dragmode === 'drawcircle'\n    );\n};\n\nexports.freeMode = function(dragmode) {\n    return (\n        dragmode === 'lasso' ||\n        dragmode === 'drawclosedpath' ||\n        dragmode === 'drawopenpath'\n    );\n};\n\nexports.selectingOrDrawing = function(dragmode) {\n    return (\n        exports.freeMode(dragmode) ||\n        exports.rectMode(dragmode)\n    );\n};\n","'use strict';\n\nvar mouseOffset = require('mouse-event-offset');\nvar hasHover = require('has-hover');\nvar supportsPassive = require('has-passive-events');\n\nvar removeElement = require('../../lib').removeElement;\nvar constants = require('../../plots/cartesian/constants');\n\nvar dragElement = module.exports = {};\n\ndragElement.align = require('./align');\ndragElement.getCursor = require('./cursor');\n\nvar unhover = require('./unhover');\ndragElement.unhover = unhover.wrapped;\ndragElement.unhoverRaw = unhover.raw;\n\n/**\n * Abstracts click & drag interactions\n *\n * During the interaction, a \"coverSlip\" element - a transparent\n * div covering the whole page - is created, which has two key effects:\n * - Lets you drag beyond the boundaries of the plot itself without\n *   dropping (but if you drag all the way out of the browser window the\n *   interaction will end)\n * - Freezes the cursor: whatever mouse cursor the drag element had when the\n *   interaction started gets copied to the coverSlip for use until mouseup\n *\n * If the user executes a drag bigger than MINDRAG, callbacks will fire as:\n *      prepFn, moveFn (1 or more times), doneFn\n * If the user does not drag enough, prepFn and clickFn will fire.\n *\n * Note: If you cancel contextmenu, clickFn will fire even with a right click\n * (unlike native events) so you'll get a `plotly_click` event. Cancel context eg:\n *    gd.addEventListener('contextmenu', function(e) { e.preventDefault(); });\n * TODO: we should probably turn this into a `config` parameter, so we can fix it\n * such that if you *don't* cancel contextmenu, we can prevent partial drags, which\n * put you in a weird state.\n *\n * If the user clicks multiple times quickly, clickFn will fire each time\n * but numClicks will increase to help you recognize doubleclicks.\n *\n * @param {object} options with keys:\n *      element (required) the DOM element to drag\n *      prepFn (optional) function(event, startX, startY)\n *          executed on mousedown\n *          startX and startY are the clientX and clientY pixel position\n *          of the mousedown event\n *      moveFn (optional) function(dx, dy)\n *          executed on move, ONLY after we've exceeded MINDRAG\n *          (we keep executing moveFn if you move back to where you started)\n *          dx and dy are the net pixel offset of the drag,\n *          dragged is true/false, has the mouse moved enough to\n *          constitute a drag\n *      doneFn (optional) function(e)\n *          executed on mouseup, ONLY if we exceeded MINDRAG (so you can be\n *          sure that moveFn has been called at least once)\n *          numClicks is how many clicks we've registered within\n *          a doubleclick time\n *          e is the original mouseup event\n *      clickFn (optional) function(numClicks, e)\n *          executed on mouseup if we have NOT exceeded MINDRAG (ie moveFn\n *          has not been called at all)\n *          numClicks is how many clicks we've registered within\n *          a doubleclick time\n *          e is the original mousedown event\n *      clampFn (optional, function(dx, dy) return [dx2, dy2])\n *          Provide custom clamping function for small displacements.\n *          By default, clamping is done using `minDrag` to x and y displacements\n *          independently.\n */\ndragElement.init = function init(options) {\n    var gd = options.gd;\n    var numClicks = 1;\n    var doubleClickDelay = gd._context.doubleClickDelay;\n    var element = options.element;\n\n    var startX,\n        startY,\n        newMouseDownTime,\n        cursor,\n        dragCover,\n        initialEvent,\n        initialTarget,\n        rightClick;\n\n    if(!gd._mouseDownTime) gd._mouseDownTime = 0;\n\n    element.style.pointerEvents = 'all';\n\n    element.onmousedown = onStart;\n\n    if(!supportsPassive) {\n        element.ontouchstart = onStart;\n    } else {\n        if(element._ontouchstart) {\n            element.removeEventListener('touchstart', element._ontouchstart);\n        }\n        element._ontouchstart = onStart;\n        element.addEventListener('touchstart', onStart, {passive: false});\n    }\n\n    function _clampFn(dx, dy, minDrag) {\n        if(Math.abs(dx) < minDrag) dx = 0;\n        if(Math.abs(dy) < minDrag) dy = 0;\n        return [dx, dy];\n    }\n\n    var clampFn = options.clampFn || _clampFn;\n\n    function onStart(e) {\n        // make dragging and dragged into properties of gd\n        // so that others can look at and modify them\n        gd._dragged = false;\n        gd._dragging = true;\n        var offset = pointerOffset(e);\n        startX = offset[0];\n        startY = offset[1];\n        initialTarget = e.target;\n        initialEvent = e;\n        rightClick = e.buttons === 2 || e.ctrlKey;\n\n        // fix Fx.hover for touch events\n        if(typeof e.clientX === 'undefined' && typeof e.clientY === 'undefined') {\n            e.clientX = startX;\n            e.clientY = startY;\n        }\n\n        newMouseDownTime = (new Date()).getTime();\n        if(newMouseDownTime - gd._mouseDownTime < doubleClickDelay) {\n            // in a click train\n            numClicks += 1;\n        } else {\n            // new click train\n            numClicks = 1;\n            gd._mouseDownTime = newMouseDownTime;\n        }\n\n        if(options.prepFn) options.prepFn(e, startX, startY);\n\n        if(hasHover && !rightClick) {\n            dragCover = coverSlip();\n            dragCover.style.cursor = window.getComputedStyle(element).cursor;\n        } else if(!hasHover) {\n            // document acts as a dragcover for mobile, bc we can't create dragcover dynamically\n            dragCover = document;\n            cursor = window.getComputedStyle(document.documentElement).cursor;\n            document.documentElement.style.cursor = window.getComputedStyle(element).cursor;\n        }\n\n        document.addEventListener('mouseup', onDone);\n        document.addEventListener('touchend', onDone);\n\n        if(options.dragmode !== false) {\n            e.preventDefault();\n            document.addEventListener('mousemove', onMove);\n            document.addEventListener('touchmove', onMove, {passive: false});\n        }\n\n        return;\n    }\n\n    function onMove(e) {\n        e.preventDefault();\n\n        var offset = pointerOffset(e);\n        var minDrag = options.minDrag || constants.MINDRAG;\n        var dxdy = clampFn(offset[0] - startX, offset[1] - startY, minDrag);\n        var dx = dxdy[0];\n        var dy = dxdy[1];\n\n        if(dx || dy) {\n            gd._dragged = true;\n            dragElement.unhover(gd, e);\n        }\n\n        if(gd._dragged && options.moveFn && !rightClick) {\n            gd._dragdata = {\n                element: element,\n                dx: dx,\n                dy: dy\n            };\n            options.moveFn(dx, dy);\n        }\n\n        return;\n    }\n\n    function onDone(e) {\n        delete gd._dragdata;\n\n        if(options.dragmode !== false) {\n            e.preventDefault();\n            document.removeEventListener('mousemove', onMove);\n            document.removeEventListener('touchmove', onMove);\n        }\n\n        document.removeEventListener('mouseup', onDone);\n        document.removeEventListener('touchend', onDone);\n\n        if(hasHover) {\n            removeElement(dragCover);\n        } else if(cursor) {\n            dragCover.documentElement.style.cursor = cursor;\n            cursor = null;\n        }\n\n        if(!gd._dragging) {\n            gd._dragged = false;\n            return;\n        }\n        gd._dragging = false;\n\n        // don't count as a dblClick unless the mouseUp is also within\n        // the dblclick delay\n        if((new Date()).getTime() - gd._mouseDownTime > doubleClickDelay) {\n            numClicks = Math.max(numClicks - 1, 1);\n        }\n\n        if(gd._dragged) {\n            if(options.doneFn) options.doneFn();\n        } else {\n            if(options.clickFn) options.clickFn(numClicks, initialEvent);\n\n            // If we haven't dragged, this should be a click. But because of the\n            // coverSlip changing the element, the natural system might not generate one,\n            // so we need to make our own. But right clicks don't normally generate\n            // click events, only contextmenu events, which happen on mousedown.\n            if(!rightClick) {\n                var e2;\n\n                try {\n                    e2 = new MouseEvent('click', e);\n                } catch(err) {\n                    var offset = pointerOffset(e);\n                    e2 = document.createEvent('MouseEvents');\n                    e2.initMouseEvent('click',\n                        e.bubbles, e.cancelable,\n                        e.view, e.detail,\n                        e.screenX, e.screenY,\n                        offset[0], offset[1],\n                        e.ctrlKey, e.altKey, e.shiftKey, e.metaKey,\n                        e.button, e.relatedTarget);\n                }\n\n                initialTarget.dispatchEvent(e2);\n            }\n        }\n\n        gd._dragging = false;\n        gd._dragged = false;\n        return;\n    }\n};\n\nfunction coverSlip() {\n    var cover = document.createElement('div');\n\n    cover.className = 'dragcover';\n    var cStyle = cover.style;\n    cStyle.position = 'fixed';\n    cStyle.left = 0;\n    cStyle.right = 0;\n    cStyle.top = 0;\n    cStyle.bottom = 0;\n    cStyle.zIndex = 999999999;\n    cStyle.background = 'none';\n\n    document.body.appendChild(cover);\n\n    return cover;\n}\n\ndragElement.coverSlip = coverSlip;\n\nfunction pointerOffset(e) {\n    return mouseOffset(\n        e.changedTouches ? e.changedTouches[0] : e,\n        document.body\n    );\n}\n","'use strict';\n\nvar Events = require('../../lib/events');\nvar throttle = require('../../lib/throttle');\nvar getGraphDiv = require('../../lib/dom').getGraphDiv;\n\nvar hoverConstants = require('../fx/constants');\n\nvar unhover = module.exports = {};\n\nunhover.wrapped = function(gd, evt, subplot) {\n    gd = getGraphDiv(gd);\n\n    // Important, clear any queued hovers\n    if(gd._fullLayout) {\n        throttle.clear(gd._fullLayout._uid + hoverConstants.HOVERID);\n    }\n\n    unhover.raw(gd, evt, subplot);\n};\n\n\n// remove hover effects on mouse out, and emit unhover event\nunhover.raw = function raw(gd, evt) {\n    var fullLayout = gd._fullLayout;\n    var oldhoverdata = gd._hoverdata;\n\n    if(!evt) evt = {};\n    if(evt.target && !gd._dragged &&\n       Events.triggerHandler(gd, 'plotly_beforehover', evt) === false) {\n        return;\n    }\n\n    fullLayout._hoverlayer.selectAll('g').remove();\n    fullLayout._hoverlayer.selectAll('line').remove();\n    fullLayout._hoverlayer.selectAll('circle').remove();\n    gd._hoverdata = undefined;\n\n    if(evt.target && oldhoverdata) {\n        gd.emit('plotly_unhover', {\n            event: evt,\n            points: oldhoverdata\n        });\n    }\n};\n","'use strict';\n\nexports.dash = {\n    valType: 'string',\n    // string type usually doesn't take values... this one should really be\n    // a special type or at least a special coercion function, from the GUI\n    // you only get these values but elsewhere the user can supply a list of\n    // dash lengths in px, and it will be honored\n    values: ['solid', 'dot', 'dash', 'longdash', 'dashdot', 'longdashdot'],\n    dflt: 'solid',\n    editType: 'style',\n    description: [\n        'Sets the dash style of lines. Set to a dash type string',\n        '(*solid*, *dot*, *dash*, *longdash*, *dashdot*, or *longdashdot*)',\n        'or a dash length list in px (eg *5px,10px,2px,2px*).'\n    ].join(' ')\n};\n\nexports.pattern = {\n    shape: {\n        valType: 'enumerated',\n        values: ['', '/', '\\\\', 'x', '-', '|', '+', '.'],\n        dflt: '',\n        arrayOk: true,\n        editType: 'style',\n        description: [\n            'Sets the shape of the pattern fill.',\n            'By default, no pattern is used for filling the area.',\n        ].join(' ')\n    },\n    fillmode: {\n        valType: 'enumerated',\n        values: ['replace', 'overlay'],\n        dflt: 'replace',\n        editType: 'style',\n        description: [\n            'Determines whether `marker.color` should be used',\n            'as a default to `bgcolor` or a `fgcolor`.'\n        ].join(' ')\n    },\n    bgcolor: {\n        valType: 'color',\n        arrayOk: true,\n        editType: 'style',\n        description: [\n            'When there is no colorscale sets the color of background pattern fill.',\n            'Defaults to a `marker.color` background when `fillmode` is *overlay*.',\n            'Otherwise, defaults to a transparent background.'\n        ].join(' ')\n    },\n    fgcolor: {\n        valType: 'color',\n        arrayOk: true,\n        editType: 'style',\n        description: [\n            'When there is no colorscale sets the color of foreground pattern fill.',\n            'Defaults to a `marker.color` background when `fillmode` is *replace*.',\n            'Otherwise, defaults to dark grey or white',\n            'to increase contrast with the `bgcolor`.',\n        ].join(' ')\n    },\n    fgopacity: {\n        valType: 'number',\n        editType: 'style',\n        min: 0,\n        max: 1,\n        description: [\n            'Sets the opacity of the foreground pattern fill.',\n            'Defaults to a 0.5 when `fillmode` is *overlay*.',\n            'Otherwise, defaults to 1.'\n        ].join(' ')\n    },\n    size: {\n        valType: 'number',\n        min: 0,\n        dflt: 8,\n        arrayOk: true,\n        editType: 'style',\n        description: [\n            'Sets the size of unit squares of the pattern fill in pixels,',\n            'which corresponds to the interval of repetition of the pattern.',\n        ].join(' ')\n    },\n    solidity: {\n        valType: 'number',\n        min: 0,\n        max: 1,\n        dflt: 0.3,\n        arrayOk: true,\n        editType: 'style',\n        description: [\n            'Sets the solidity of the pattern fill.',\n            'Solidity is roughly the fraction of the area filled by the pattern.',\n            'Solidity of 0 shows only the background color without pattern',\n            'and solidty of 1 shows only the foreground color without pattern.',\n        ].join(' ')\n    },\n    editType: 'style',\n    description: [\n        'Sets the pattern within the marker.'\n    ].join(' '),\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar isNumeric = require('fast-isnumeric');\nvar tinycolor = require('tinycolor2');\n\nvar Registry = require('../../registry');\nvar Color = require('../color');\nvar Colorscale = require('../colorscale');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar svgTextUtils = require('../../lib/svg_text_utils');\n\nvar xmlnsNamespaces = require('../../constants/xmlns_namespaces');\nvar alignment = require('../../constants/alignment');\nvar LINE_SPACING = alignment.LINE_SPACING;\nvar DESELECTDIM = require('../../constants/interactions').DESELECTDIM;\n\nvar subTypes = require('../../traces/scatter/subtypes');\nvar makeBubbleSizeFn = require('../../traces/scatter/make_bubble_size_func');\nvar appendArrayPointValue = require('../../components/fx/helpers').appendArrayPointValue;\n\nvar drawing = module.exports = {};\n\n// -----------------------------------------------------\n// styling functions for plot elements\n// -----------------------------------------------------\n\ndrawing.font = function(s, family, size, color) {\n    // also allow the form font(s, {family, size, color})\n    if(Lib.isPlainObject(family)) {\n        color = family.color;\n        size = family.size;\n        family = family.family;\n    }\n    if(family) s.style('font-family', family);\n    if(size + 1) s.style('font-size', size + 'px');\n    if(color) s.call(Color.fill, color);\n};\n\n/*\n * Positioning helpers\n * Note: do not use `setPosition` with <text> nodes modified by\n * `svgTextUtils.convertToTspans`. Use `svgTextUtils.positionText`\n * instead, so that <tspan.line> elements get updated to match.\n */\ndrawing.setPosition = function(s, x, y) { s.attr('x', x).attr('y', y); };\ndrawing.setSize = function(s, w, h) { s.attr('width', w).attr('height', h); };\ndrawing.setRect = function(s, x, y, w, h) {\n    s.call(drawing.setPosition, x, y).call(drawing.setSize, w, h);\n};\n\n/** Translate node\n *\n * @param {object} d : calcdata point item\n * @param {sel} sel : d3 selction of node to translate\n * @param {object} xa : corresponding full xaxis object\n * @param {object} ya : corresponding full yaxis object\n *\n * @return {boolean} :\n *  true if selection got translated\n *  false if selection could not get translated\n */\ndrawing.translatePoint = function(d, sel, xa, ya) {\n    var x = xa.c2p(d.x);\n    var y = ya.c2p(d.y);\n\n    if(isNumeric(x) && isNumeric(y) && sel.node()) {\n        // for multiline text this works better\n        if(sel.node().nodeName === 'text') {\n            sel.attr('x', x).attr('y', y);\n        } else {\n            sel.attr('transform', strTranslate(x, y));\n        }\n    } else {\n        return false;\n    }\n\n    return true;\n};\n\ndrawing.translatePoints = function(s, xa, ya) {\n    s.each(function(d) {\n        var sel = d3.select(this);\n        drawing.translatePoint(d, sel, xa, ya);\n    });\n};\n\ndrawing.hideOutsideRangePoint = function(d, sel, xa, ya, xcalendar, ycalendar) {\n    sel.attr(\n        'display',\n        (xa.isPtWithinRange(d, xcalendar) && ya.isPtWithinRange(d, ycalendar)) ? null : 'none'\n    );\n};\n\ndrawing.hideOutsideRangePoints = function(traceGroups, subplot) {\n    if(!subplot._hasClipOnAxisFalse) return;\n\n    var xa = subplot.xaxis;\n    var ya = subplot.yaxis;\n\n    traceGroups.each(function(d) {\n        var trace = d[0].trace;\n        var xcalendar = trace.xcalendar;\n        var ycalendar = trace.ycalendar;\n        var selector = Registry.traceIs(trace, 'bar-like') ? '.bartext' : '.point,.textpoint';\n\n        traceGroups.selectAll(selector).each(function(d) {\n            drawing.hideOutsideRangePoint(d, d3.select(this), xa, ya, xcalendar, ycalendar);\n        });\n    });\n};\n\ndrawing.crispRound = function(gd, lineWidth, dflt) {\n    // for lines that disable antialiasing we want to\n    // make sure the width is an integer, and at least 1 if it's nonzero\n\n    if(!lineWidth || !isNumeric(lineWidth)) return dflt || 0;\n\n    // but not for static plots - these don't get antialiased anyway.\n    if(gd._context.staticPlot) return lineWidth;\n\n    if(lineWidth < 1) return 1;\n    return Math.round(lineWidth);\n};\n\ndrawing.singleLineStyle = function(d, s, lw, lc, ld) {\n    s.style('fill', 'none');\n    var line = (((d || [])[0] || {}).trace || {}).line || {};\n    var lw1 = lw || line.width || 0;\n    var dash = ld || line.dash || '';\n\n    Color.stroke(s, lc || line.color);\n    drawing.dashLine(s, dash, lw1);\n};\n\ndrawing.lineGroupStyle = function(s, lw, lc, ld) {\n    s.style('fill', 'none')\n    .each(function(d) {\n        var line = (((d || [])[0] || {}).trace || {}).line || {};\n        var lw1 = lw || line.width || 0;\n        var dash = ld || line.dash || '';\n\n        d3.select(this)\n            .call(Color.stroke, lc || line.color)\n            .call(drawing.dashLine, dash, lw1);\n    });\n};\n\ndrawing.dashLine = function(s, dash, lineWidth) {\n    lineWidth = +lineWidth || 0;\n\n    dash = drawing.dashStyle(dash, lineWidth);\n\n    s.style({\n        'stroke-dasharray': dash,\n        'stroke-width': lineWidth + 'px'\n    });\n};\n\ndrawing.dashStyle = function(dash, lineWidth) {\n    lineWidth = +lineWidth || 1;\n    var dlw = Math.max(lineWidth, 3);\n\n    if(dash === 'solid') dash = '';\n    else if(dash === 'dot') dash = dlw + 'px,' + dlw + 'px';\n    else if(dash === 'dash') dash = (3 * dlw) + 'px,' + (3 * dlw) + 'px';\n    else if(dash === 'longdash') dash = (5 * dlw) + 'px,' + (5 * dlw) + 'px';\n    else if(dash === 'dashdot') {\n        dash = (3 * dlw) + 'px,' + dlw + 'px,' + dlw + 'px,' + dlw + 'px';\n    } else if(dash === 'longdashdot') {\n        dash = (5 * dlw) + 'px,' + (2 * dlw) + 'px,' + dlw + 'px,' + (2 * dlw) + 'px';\n    }\n    // otherwise user wrote the dasharray themselves - leave it be\n\n    return dash;\n};\n\n// Same as fillGroupStyle, except in this case the selection may be a transition\ndrawing.singleFillStyle = function(sel) {\n    var node = d3.select(sel.node());\n    var data = node.data();\n    var fillcolor = (((data[0] || [])[0] || {}).trace || {}).fillcolor;\n    if(fillcolor) {\n        sel.call(Color.fill, fillcolor);\n    }\n};\n\ndrawing.fillGroupStyle = function(s) {\n    s.style('stroke-width', 0)\n    .each(function(d) {\n        var shape = d3.select(this);\n        // N.B. 'd' won't be a calcdata item when\n        // fill !== 'none' on a segment-less and marker-less trace\n        if(d[0].trace) {\n            shape.call(Color.fill, d[0].trace.fillcolor);\n        }\n    });\n};\n\nvar SYMBOLDEFS = require('./symbol_defs');\n\ndrawing.symbolNames = [];\ndrawing.symbolFuncs = [];\ndrawing.symbolNeedLines = {};\ndrawing.symbolNoDot = {};\ndrawing.symbolNoFill = {};\ndrawing.symbolList = [];\n\nObject.keys(SYMBOLDEFS).forEach(function(k) {\n    var symDef = SYMBOLDEFS[k];\n    var n = symDef.n;\n    drawing.symbolList.push(\n        n,\n        String(n),\n        k,\n\n        n + 100,\n        String(n + 100),\n        k + '-open'\n    );\n    drawing.symbolNames[n] = k;\n    drawing.symbolFuncs[n] = symDef.f;\n\n    if(symDef.needLine) {\n        drawing.symbolNeedLines[n] = true;\n    }\n    if(symDef.noDot) {\n        drawing.symbolNoDot[n] = true;\n    } else {\n        drawing.symbolList.push(\n            n + 200,\n            String(n + 200),\n            k + '-dot',\n\n            n + 300,\n            String(n + 300),\n            k + '-open-dot'\n        );\n    }\n    if(symDef.noFill) {\n        drawing.symbolNoFill[n] = true;\n    }\n});\n\nvar MAXSYMBOL = drawing.symbolNames.length;\n// add a dot in the middle of the symbol\nvar DOTPATH = 'M0,0.5L0.5,0L0,-0.5L-0.5,0Z';\n\ndrawing.symbolNumber = function(v) {\n    if(isNumeric(v)) {\n        v = +v;\n    } else if(typeof v === 'string') {\n        var vbase = 0;\n        if(v.indexOf('-open') > 0) {\n            vbase = 100;\n            v = v.replace('-open', '');\n        }\n        if(v.indexOf('-dot') > 0) {\n            vbase += 200;\n            v = v.replace('-dot', '');\n        }\n        v = drawing.symbolNames.indexOf(v);\n        if(v >= 0) { v += vbase; }\n    }\n\n    return (v % 100 >= MAXSYMBOL || v >= 400) ?\n        0 : Math.floor(Math.max(v, 0));\n};\n\nfunction makePointPath(symbolNumber, r) {\n    var base = symbolNumber % 100;\n    return drawing.symbolFuncs[base](r) + (symbolNumber >= 200 ? DOTPATH : '');\n}\n\nvar HORZGRADIENT = {x1: 1, x2: 0, y1: 0, y2: 0};\nvar VERTGRADIENT = {x1: 0, x2: 0, y1: 1, y2: 0};\nvar stopFormatter = d3.format('~.1f');\nvar gradientInfo = {\n    radial: {node: 'radialGradient'},\n    radialreversed: {node: 'radialGradient', reversed: true},\n    horizontal: {node: 'linearGradient', attrs: HORZGRADIENT},\n    horizontalreversed: {node: 'linearGradient', attrs: HORZGRADIENT, reversed: true},\n    vertical: {node: 'linearGradient', attrs: VERTGRADIENT},\n    verticalreversed: {node: 'linearGradient', attrs: VERTGRADIENT, reversed: true}\n};\n\n/**\n * gradient: create and apply a gradient fill\n *\n * @param {object} sel: d3 selection to apply this gradient to\n *     You can use `selection.call(Drawing.gradient, ...)`\n * @param {DOM element} gd: the graph div `sel` is part of\n * @param {string} gradientID: a unique (within this plot) identifier\n *     for this gradient, so that we don't create unnecessary definitions\n * @param {string} type: 'radial', 'horizontal', or 'vertical', optionally with\n *     'reversed' at the end. Normally radial goes center to edge,\n *     horizontal goes right to left, and vertical goes bottom to top\n * @param {array} colorscale: as in attribute values, [[fraction, color], ...]\n * @param {string} prop: the property to apply to, 'fill' or 'stroke'\n */\ndrawing.gradient = function(sel, gd, gradientID, type, colorscale, prop) {\n    var len = colorscale.length;\n    var info = gradientInfo[type];\n    var colorStops = new Array(len);\n    for(var i = 0; i < len; i++) {\n        if(info.reversed) {\n            colorStops[len - 1 - i] = [stopFormatter((1 - colorscale[i][0]) * 100), colorscale[i][1]];\n        } else {\n            colorStops[i] = [stopFormatter(colorscale[i][0] * 100), colorscale[i][1]];\n        }\n    }\n\n    var fullLayout = gd._fullLayout;\n    var fullID = 'g' + fullLayout._uid + '-' + gradientID;\n\n    var gradient = fullLayout._defs.select('.gradients')\n        .selectAll('#' + fullID)\n        .data([type + colorStops.join(';')], Lib.identity);\n\n    gradient.exit().remove();\n\n    gradient.enter()\n        .append(info.node)\n        .each(function() {\n            var el = d3.select(this);\n            if(info.attrs) el.attr(info.attrs);\n\n            el.attr('id', fullID);\n\n            var stops = el.selectAll('stop')\n                .data(colorStops);\n            stops.exit().remove();\n            stops.enter().append('stop');\n\n            stops.each(function(d) {\n                var tc = tinycolor(d[1]);\n                d3.select(this).attr({\n                    offset: d[0] + '%',\n                    'stop-color': Color.tinyRGB(tc),\n                    'stop-opacity': tc.getAlpha()\n                });\n            });\n        });\n\n    sel.style(prop, getFullUrl(fullID, gd))\n        .style(prop + '-opacity', null);\n\n    var className2query = function(s) {\n        return '.' + s.attr('class').replace(/\\s/g, '.');\n    };\n    var k = className2query(d3.select(sel.node().parentNode)) +\n        '>' + className2query(sel);\n    fullLayout._gradientUrlQueryParts[k] = 1;\n};\n\n/**\n * pattern: create and apply a pattern fill\n *\n * @param {object} sel: d3 selection to apply this pattern to\n *     You can use `selection.call(Drawing.pattern, ...)`\n * @param {string} calledBy: option to know the caller component\n * @param {DOM element} gd: the graph div `sel` is part of\n * @param {string} patternID: a unique (within this plot) identifier\n *     for this pattern, so that we don't create unnecessary definitions\n * @param {number} size: size of unit squares for repetition of this pattern\n * @param {number} solidity: how solid lines of this pattern are\n * @param {string} mcc: color when painted with colorscale\n * @param {string} fillmode: fillmode for this pattern\n * @param {string} bgcolor: background color for this pattern\n * @param {string} fgcolor: foreground color for this pattern\n * @param {number} fgopacity: foreground opacity for this pattern\n */\ndrawing.pattern = function(sel, calledBy, gd, patternID, shape, size, solidity, mcc, fillmode, bgcolor, fgcolor, fgopacity) {\n    var isLegend = calledBy === 'legend';\n\n    if(mcc) {\n        if(fillmode === 'overlay') {\n            bgcolor = mcc;\n            fgcolor = Color.contrast(bgcolor);\n        } else {\n            bgcolor = undefined;\n            fgcolor = mcc;\n        }\n    }\n\n    var fullLayout = gd._fullLayout;\n    var fullID = 'p' + fullLayout._uid + '-' + patternID;\n    var width, height;\n\n    // linear interpolation\n    var linearFn = function(x, x0, x1, y0, y1) {\n        return y0 + (y1 - y0) * (x - x0) / (x1 - x0);\n    };\n\n    var path, linewidth, radius;\n    var patternTag;\n    var patternAttrs = {};\n    switch(shape) {\n        case '/':\n            width = size * Math.sqrt(2);\n            height = size * Math.sqrt(2);\n            path = 'M-' + (width / 4) + ',' + (height / 4) + 'l' + (width / 2) + ',-' + (height / 2) +\n                   'M0,' + height + 'L' + width + ',0' +\n                   'M' + (width / 4 * 3) + ',' + (height / 4 * 5) + 'l' + (width / 2) + ',-' + (height / 2);\n            linewidth = solidity * size;\n            patternTag = 'path';\n            patternAttrs = {\n                'd': path,\n                'opacity': fgopacity,\n                'stroke': fgcolor,\n                'stroke-width': linewidth + 'px'\n            };\n            break;\n        case '\\\\':\n            width = size * Math.sqrt(2);\n            height = size * Math.sqrt(2);\n            path = 'M' + (width / 4 * 3) + ',-' + (height / 4) + 'l' + (width / 2) + ',' + (height / 2) +\n                   'M0,0L' + width + ',' + height +\n                   'M-' + (width / 4) + ',' + (height / 4 * 3) + 'l' + (width / 2) + ',' + (height / 2);\n            linewidth = solidity * size;\n            patternTag = 'path';\n            patternAttrs = {\n                'd': path,\n                'opacity': fgopacity,\n                'stroke': fgcolor,\n                'stroke-width': linewidth + 'px'\n            };\n            break;\n        case 'x':\n            width = size * Math.sqrt(2);\n            height = size * Math.sqrt(2);\n            path = 'M-' + (width / 4) + ',' + (height / 4) + 'l' + (width / 2) + ',-' + (height / 2) +\n                   'M0,' + height + 'L' + width + ',0' +\n                   'M' + (width / 4 * 3) + ',' + (height / 4 * 5) + 'l' + (width / 2) + ',-' + (height / 2) +\n                   'M' + (width / 4 * 3) + ',-' + (height / 4) + 'l' + (width / 2) + ',' + (height / 2) +\n                   'M0,0L' + width + ',' + height +\n                   'M-' + (width / 4) + ',' + (height / 4 * 3) + 'l' + (width / 2) + ',' + (height / 2);\n            linewidth = size - size * Math.sqrt(1.0 - solidity);\n            patternTag = 'path';\n            patternAttrs = {\n                'd': path,\n                'opacity': fgopacity,\n                'stroke': fgcolor,\n                'stroke-width': linewidth + 'px'\n            };\n            break;\n        case '|':\n            width = size;\n            height = size;\n            patternTag = 'path';\n            path = 'M' + (width / 2) + ',0L' + (width / 2) + ',' + height;\n            linewidth = solidity * size;\n            patternTag = 'path';\n            patternAttrs = {\n                'd': path,\n                'opacity': fgopacity,\n                'stroke': fgcolor,\n                'stroke-width': linewidth + 'px'\n            };\n            break;\n        case '-':\n            width = size;\n            height = size;\n            patternTag = 'path';\n            path = 'M0,' + (height / 2) + 'L' + width + ',' + (height / 2);\n            linewidth = solidity * size;\n            patternTag = 'path';\n            patternAttrs = {\n                'd': path,\n                'opacity': fgopacity,\n                'stroke': fgcolor,\n                'stroke-width': linewidth + 'px'\n            };\n            break;\n        case '+':\n            width = size;\n            height = size;\n            patternTag = 'path';\n            path = 'M' + (width / 2) + ',0L' + (width / 2) + ',' + height +\n                   'M0,' + (height / 2) + 'L' + width + ',' + (height / 2);\n            linewidth = size - size * Math.sqrt(1.0 - solidity);\n            patternTag = 'path';\n            patternAttrs = {\n                'd': path,\n                'opacity': fgopacity,\n                'stroke': fgcolor,\n                'stroke-width': linewidth + 'px'\n            };\n            break;\n        case '.':\n            width = size;\n            height = size;\n            if(solidity < Math.PI / 4) {\n                radius = Math.sqrt(solidity * size * size / Math.PI);\n            } else {\n                radius = linearFn(solidity, Math.PI / 4, 1.0, size / 2, size / Math.sqrt(2));\n            }\n            patternTag = 'circle';\n            patternAttrs = {\n                'cx': width / 2,\n                'cy': height / 2,\n                'r': radius,\n                'opacity': fgopacity,\n                'fill': fgcolor\n            };\n            break;\n    }\n\n    var str = [\n        shape || 'noSh',\n        bgcolor || 'noBg',\n        fgcolor || 'noFg',\n        size,\n        solidity\n    ].join(';');\n\n    var pattern = fullLayout._defs.select('.patterns')\n        .selectAll('#' + fullID)\n        .data([str], Lib.identity);\n\n    pattern.exit().remove();\n\n    pattern.enter()\n        .append('pattern')\n        .each(function() {\n            var el = d3.select(this);\n\n            el.attr({\n                'id': fullID,\n                'width': width + 'px',\n                'height': height + 'px',\n                'patternUnits': 'userSpaceOnUse',\n                // for legends scale down patterns just a bit so that default size (i.e 8) nicely fit in small icons\n                'patternTransform': isLegend ? 'scale(0.8)' : ''\n            });\n\n            if(bgcolor) {\n                var rects = el.selectAll('rect').data([0]);\n                rects.exit().remove();\n                rects.enter()\n                    .append('rect')\n                    .attr({\n                        'width': width + 'px',\n                        'height': height + 'px',\n                        'fill': bgcolor\n                    });\n            }\n\n            var patterns = el.selectAll(patternTag).data([0]);\n            patterns.exit().remove();\n            patterns.enter()\n                .append(patternTag)\n                .attr(patternAttrs);\n        });\n\n    sel.style('fill', getFullUrl(fullID, gd))\n        .style('fill-opacity', null);\n\n    sel.classed('pattern_filled', true);\n    var className2query = function(s) {\n        return '.' + s.attr('class').replace(/\\s/g, '.');\n    };\n    var k = className2query(d3.select(sel.node().parentNode)) + '>.pattern_filled';\n    fullLayout._patternUrlQueryParts[k] = 1;\n};\n\n/*\n * Make the gradients container and clear out any previous gradients.\n * We never collect all the gradients we need in one place,\n * so we can't ever remove gradients that have stopped being useful,\n * except all at once before a full redraw.\n * The upside of this is arbitrary points can share gradient defs\n */\ndrawing.initGradients = function(gd) {\n    var fullLayout = gd._fullLayout;\n\n    var gradientsGroup = Lib.ensureSingle(fullLayout._defs, 'g', 'gradients');\n    gradientsGroup.selectAll('linearGradient,radialGradient').remove();\n\n    // initialize stash of query parts filled in Drawing.gradient,\n    // used to fix URL strings during image exports\n    fullLayout._gradientUrlQueryParts = {};\n};\n\ndrawing.initPatterns = function(gd) {\n    var fullLayout = gd._fullLayout;\n\n    var patternsGroup = Lib.ensureSingle(fullLayout._defs, 'g', 'patterns');\n    patternsGroup.selectAll('pattern').remove();\n\n    // initialize stash of query parts filled in Drawing.pattern,\n    // used to fix URL strings during image exports\n    fullLayout._patternUrlQueryParts = {};\n};\n\ndrawing.getPatternAttr = function(mp, i, dflt) {\n    if(mp && Lib.isArrayOrTypedArray(mp)) {\n        return i < mp.length ? mp[i] : dflt;\n    }\n    return mp;\n};\n\ndrawing.pointStyle = function(s, trace, gd) {\n    if(!s.size()) return;\n\n    var fns = drawing.makePointStyleFns(trace);\n\n    s.each(function(d) {\n        drawing.singlePointStyle(d, d3.select(this), trace, fns, gd);\n    });\n};\n\ndrawing.singlePointStyle = function(d, sel, trace, fns, gd) {\n    var marker = trace.marker;\n    var markerLine = marker.line;\n\n    sel.style('opacity',\n        fns.selectedOpacityFn ? fns.selectedOpacityFn(d) :\n            (d.mo === undefined ? marker.opacity : d.mo)\n    );\n\n    if(fns.ms2mrc) {\n        var r;\n\n        // handle multi-trace graph edit case\n        if(d.ms === 'various' || marker.size === 'various') {\n            r = 3;\n        } else {\n            r = fns.ms2mrc(d.ms);\n        }\n\n        // store the calculated size so hover can use it\n        d.mrc = r;\n\n        if(fns.selectedSizeFn) {\n            r = d.mrc = fns.selectedSizeFn(d);\n        }\n\n        // turn the symbol into a sanitized number\n        var x = drawing.symbolNumber(d.mx || marker.symbol) || 0;\n\n        // save if this marker is open\n        // because that impacts how to handle colors\n        d.om = x % 200 >= 100;\n\n        sel.attr('d', makePointPath(x, r));\n    }\n\n    var perPointGradient = false;\n    var fillColor, lineColor, lineWidth;\n\n    // 'so' is suspected outliers, for box plots\n    if(d.so) {\n        lineWidth = markerLine.outlierwidth;\n        lineColor = markerLine.outliercolor;\n        fillColor = marker.outliercolor;\n    } else {\n        var markerLineWidth = (markerLine || {}).width;\n\n        lineWidth = (\n            d.mlw + 1 ||\n            markerLineWidth + 1 ||\n            // TODO: we need the latter for legends... can we get rid of it?\n            (d.trace ? (d.trace.marker.line || {}).width : 0) + 1\n        ) - 1 || 0;\n\n        if('mlc' in d) lineColor = d.mlcc = fns.lineScale(d.mlc);\n        // weird case: array wasn't long enough to apply to every point\n        else if(Lib.isArrayOrTypedArray(markerLine.color)) lineColor = Color.defaultLine;\n        else lineColor = markerLine.color;\n\n        if(Lib.isArrayOrTypedArray(marker.color)) {\n            fillColor = Color.defaultLine;\n            perPointGradient = true;\n        }\n\n        if('mc' in d) {\n            fillColor = d.mcc = fns.markerScale(d.mc);\n        } else {\n            fillColor = marker.color || 'rgba(0,0,0,0)';\n        }\n\n        if(fns.selectedColorFn) {\n            fillColor = fns.selectedColorFn(d);\n        }\n    }\n\n    if(d.om) {\n        // open markers can't have zero linewidth, default to 1px,\n        // and use fill color as stroke color\n        sel.call(Color.stroke, fillColor)\n            .style({\n                'stroke-width': (lineWidth || 1) + 'px',\n                fill: 'none'\n            });\n    } else {\n        sel.style('stroke-width', (d.isBlank ? 0 : lineWidth) + 'px');\n\n        var markerGradient = marker.gradient;\n\n        var gradientType = d.mgt;\n        if(gradientType) perPointGradient = true;\n        else gradientType = markerGradient && markerGradient.type;\n\n        // for legend - arrays will propagate through here, but we don't need\n        // to treat it as per-point.\n        if(Lib.isArrayOrTypedArray(gradientType)) {\n            gradientType = gradientType[0];\n            if(!gradientInfo[gradientType]) gradientType = 0;\n        }\n\n        var markerPattern = marker.pattern;\n        var patternShape = markerPattern && drawing.getPatternAttr(markerPattern.shape, d.i, '');\n\n        if(gradientType && gradientType !== 'none') {\n            var gradientColor = d.mgc;\n            if(gradientColor) perPointGradient = true;\n            else gradientColor = markerGradient.color;\n\n            var gradientID = trace.uid;\n            if(perPointGradient) gradientID += '-' + d.i;\n\n            drawing.gradient(sel, gd, gradientID, gradientType,\n                [[0, gradientColor], [1, fillColor]], 'fill');\n        } else if(patternShape) {\n            var patternBGColor = drawing.getPatternAttr(markerPattern.bgcolor, d.i, null);\n            var patternFGColor = drawing.getPatternAttr(markerPattern.fgcolor, d.i, null);\n            var patternFGOpacity = markerPattern.fgopacity;\n            var patternSize = drawing.getPatternAttr(markerPattern.size, d.i, 8);\n            var patternSolidity = drawing.getPatternAttr(markerPattern.solidity, d.i, 0.3);\n            var perPointPattern = d.mcc ||\n                Lib.isArrayOrTypedArray(markerPattern.shape) ||\n                Lib.isArrayOrTypedArray(markerPattern.bgcolor) ||\n                Lib.isArrayOrTypedArray(markerPattern.size) ||\n                Lib.isArrayOrTypedArray(markerPattern.solidity);\n\n            var patternID = trace.uid;\n            if(perPointPattern) patternID += '-' + d.i;\n\n            drawing.pattern(\n                sel, 'point', gd, patternID,\n                patternShape, patternSize, patternSolidity,\n                d.mcc, markerPattern.fillmode,\n                patternBGColor, patternFGColor, patternFGOpacity\n            );\n        } else {\n            Color.fill(sel, fillColor);\n        }\n\n        if(lineWidth) {\n            Color.stroke(sel, lineColor);\n        }\n    }\n};\n\ndrawing.makePointStyleFns = function(trace) {\n    var out = {};\n    var marker = trace.marker;\n\n    // allow array marker and marker line colors to be\n    // scaled by given max and min to colorscales\n    out.markerScale = drawing.tryColorscale(marker, '');\n    out.lineScale = drawing.tryColorscale(marker, 'line');\n\n    if(Registry.traceIs(trace, 'symbols')) {\n        out.ms2mrc = subTypes.isBubble(trace) ?\n            makeBubbleSizeFn(trace) :\n            function() { return (marker.size || 6) / 2; };\n    }\n\n    if(trace.selectedpoints) {\n        Lib.extendFlat(out, drawing.makeSelectedPointStyleFns(trace));\n    }\n\n    return out;\n};\n\ndrawing.makeSelectedPointStyleFns = function(trace) {\n    var out = {};\n\n    var selectedAttrs = trace.selected || {};\n    var unselectedAttrs = trace.unselected || {};\n\n    var marker = trace.marker || {};\n    var selectedMarker = selectedAttrs.marker || {};\n    var unselectedMarker = unselectedAttrs.marker || {};\n\n    var mo = marker.opacity;\n    var smo = selectedMarker.opacity;\n    var usmo = unselectedMarker.opacity;\n    var smoIsDefined = smo !== undefined;\n    var usmoIsDefined = usmo !== undefined;\n\n    if(Lib.isArrayOrTypedArray(mo) || smoIsDefined || usmoIsDefined) {\n        out.selectedOpacityFn = function(d) {\n            var base = d.mo === undefined ? marker.opacity : d.mo;\n\n            if(d.selected) {\n                return smoIsDefined ? smo : base;\n            } else {\n                return usmoIsDefined ? usmo : DESELECTDIM * base;\n            }\n        };\n    }\n\n    var mc = marker.color;\n    var smc = selectedMarker.color;\n    var usmc = unselectedMarker.color;\n\n    if(smc || usmc) {\n        out.selectedColorFn = function(d) {\n            var base = d.mcc || mc;\n\n            if(d.selected) {\n                return smc || base;\n            } else {\n                return usmc || base;\n            }\n        };\n    }\n\n    var ms = marker.size;\n    var sms = selectedMarker.size;\n    var usms = unselectedMarker.size;\n    var smsIsDefined = sms !== undefined;\n    var usmsIsDefined = usms !== undefined;\n\n    if(Registry.traceIs(trace, 'symbols') && (smsIsDefined || usmsIsDefined)) {\n        out.selectedSizeFn = function(d) {\n            var base = d.mrc || ms / 2;\n\n            if(d.selected) {\n                return smsIsDefined ? sms / 2 : base;\n            } else {\n                return usmsIsDefined ? usms / 2 : base;\n            }\n        };\n    }\n\n    return out;\n};\n\ndrawing.makeSelectedTextStyleFns = function(trace) {\n    var out = {};\n\n    var selectedAttrs = trace.selected || {};\n    var unselectedAttrs = trace.unselected || {};\n\n    var textFont = trace.textfont || {};\n    var selectedTextFont = selectedAttrs.textfont || {};\n    var unselectedTextFont = unselectedAttrs.textfont || {};\n\n    var tc = textFont.color;\n    var stc = selectedTextFont.color;\n    var utc = unselectedTextFont.color;\n\n    out.selectedTextColorFn = function(d) {\n        var base = d.tc || tc;\n\n        if(d.selected) {\n            return stc || base;\n        } else {\n            if(utc) return utc;\n            else return stc ? base : Color.addOpacity(base, DESELECTDIM);\n        }\n    };\n\n    return out;\n};\n\ndrawing.selectedPointStyle = function(s, trace) {\n    if(!s.size() || !trace.selectedpoints) return;\n\n    var fns = drawing.makeSelectedPointStyleFns(trace);\n    var marker = trace.marker || {};\n    var seq = [];\n\n    if(fns.selectedOpacityFn) {\n        seq.push(function(pt, d) {\n            pt.style('opacity', fns.selectedOpacityFn(d));\n        });\n    }\n\n    if(fns.selectedColorFn) {\n        seq.push(function(pt, d) {\n            Color.fill(pt, fns.selectedColorFn(d));\n        });\n    }\n\n    if(fns.selectedSizeFn) {\n        seq.push(function(pt, d) {\n            var mx = d.mx || marker.symbol || 0;\n            var mrc2 = fns.selectedSizeFn(d);\n\n            pt.attr('d', makePointPath(drawing.symbolNumber(mx), mrc2));\n\n            // save for Drawing.selectedTextStyle\n            d.mrc2 = mrc2;\n        });\n    }\n\n    if(seq.length) {\n        s.each(function(d) {\n            var pt = d3.select(this);\n            for(var i = 0; i < seq.length; i++) {\n                seq[i](pt, d);\n            }\n        });\n    }\n};\n\ndrawing.tryColorscale = function(marker, prefix) {\n    var cont = prefix ? Lib.nestedProperty(marker, prefix).get() : marker;\n\n    if(cont) {\n        var colorArray = cont.color;\n        if((cont.colorscale || cont._colorAx) && Lib.isArrayOrTypedArray(colorArray)) {\n            return Colorscale.makeColorScaleFuncFromTrace(cont);\n        }\n    }\n    return Lib.identity;\n};\n\nvar TEXTOFFSETSIGN = {\n    start: 1, end: -1, middle: 0, bottom: 1, top: -1\n};\n\nfunction textPointPosition(s, textPosition, fontSize, markerRadius) {\n    var group = d3.select(s.node().parentNode);\n\n    var v = textPosition.indexOf('top') !== -1 ?\n        'top' :\n        textPosition.indexOf('bottom') !== -1 ? 'bottom' : 'middle';\n    var h = textPosition.indexOf('left') !== -1 ?\n        'end' :\n        textPosition.indexOf('right') !== -1 ? 'start' : 'middle';\n\n    // if markers are shown, offset a little more than\n    // the nominal marker size\n    // ie 2/1.6 * nominal, bcs some markers are a bit bigger\n    var r = markerRadius ? markerRadius / 0.8 + 1 : 0;\n\n    var numLines = (svgTextUtils.lineCount(s) - 1) * LINE_SPACING + 1;\n    var dx = TEXTOFFSETSIGN[h] * r;\n    var dy = fontSize * 0.75 + TEXTOFFSETSIGN[v] * r +\n        (TEXTOFFSETSIGN[v] - 1) * numLines * fontSize / 2;\n\n    // fix the overall text group position\n    s.attr('text-anchor', h);\n    group.attr('transform', strTranslate(dx, dy));\n}\n\nfunction extracTextFontSize(d, trace) {\n    var fontSize = d.ts || trace.textfont.size;\n    return (isNumeric(fontSize) && fontSize > 0) ? fontSize : 0;\n}\n\n// draw text at points\ndrawing.textPointStyle = function(s, trace, gd) {\n    if(!s.size()) return;\n\n    var selectedTextColorFn;\n    if(trace.selectedpoints) {\n        var fns = drawing.makeSelectedTextStyleFns(trace);\n        selectedTextColorFn = fns.selectedTextColorFn;\n    }\n\n    var texttemplate = trace.texttemplate;\n    var fullLayout = gd._fullLayout;\n\n    s.each(function(d) {\n        var p = d3.select(this);\n\n        var text = texttemplate ?\n            Lib.extractOption(d, trace, 'txt', 'texttemplate') :\n            Lib.extractOption(d, trace, 'tx', 'text');\n\n        if(!text && text !== 0) {\n            p.remove();\n            return;\n        }\n\n        if(texttemplate) {\n            var fn = trace._module.formatLabels;\n            var labels = fn ? fn(d, trace, fullLayout) : {};\n            var pointValues = {};\n            appendArrayPointValue(pointValues, trace, d.i);\n            var meta = trace._meta || {};\n            text = Lib.texttemplateString(text, labels, fullLayout._d3locale, pointValues, d, meta);\n        }\n\n        var pos = d.tp || trace.textposition;\n        var fontSize = extracTextFontSize(d, trace);\n        var fontColor = selectedTextColorFn ?\n            selectedTextColorFn(d) :\n            (d.tc || trace.textfont.color);\n\n        p.call(drawing.font,\n                d.tf || trace.textfont.family,\n                fontSize,\n                fontColor)\n            .text(text)\n            .call(svgTextUtils.convertToTspans, gd)\n            .call(textPointPosition, pos, fontSize, d.mrc);\n    });\n};\n\ndrawing.selectedTextStyle = function(s, trace) {\n    if(!s.size() || !trace.selectedpoints) return;\n\n    var fns = drawing.makeSelectedTextStyleFns(trace);\n\n    s.each(function(d) {\n        var tx = d3.select(this);\n        var tc = fns.selectedTextColorFn(d);\n        var tp = d.tp || trace.textposition;\n        var fontSize = extracTextFontSize(d, trace);\n\n        Color.fill(tx, tc);\n        textPointPosition(tx, tp, fontSize, d.mrc2 || d.mrc);\n    });\n};\n\n// generalized Catmull-Rom splines, per\n// http://www.cemyuksel.com/research/catmullrom_param/catmullrom.pdf\nvar CatmullRomExp = 0.5;\ndrawing.smoothopen = function(pts, smoothness) {\n    if(pts.length < 3) { return 'M' + pts.join('L');}\n    var path = 'M' + pts[0];\n    var tangents = [];\n    var i;\n    for(i = 1; i < pts.length - 1; i++) {\n        tangents.push(makeTangent(pts[i - 1], pts[i], pts[i + 1], smoothness));\n    }\n    path += 'Q' + tangents[0][0] + ' ' + pts[1];\n    for(i = 2; i < pts.length - 1; i++) {\n        path += 'C' + tangents[i - 2][1] + ' ' + tangents[i - 1][0] + ' ' + pts[i];\n    }\n    path += 'Q' + tangents[pts.length - 3][1] + ' ' + pts[pts.length - 1];\n    return path;\n};\n\ndrawing.smoothclosed = function(pts, smoothness) {\n    if(pts.length < 3) { return 'M' + pts.join('L') + 'Z'; }\n    var path = 'M' + pts[0];\n    var pLast = pts.length - 1;\n    var tangents = [makeTangent(pts[pLast], pts[0], pts[1], smoothness)];\n    var i;\n    for(i = 1; i < pLast; i++) {\n        tangents.push(makeTangent(pts[i - 1], pts[i], pts[i + 1], smoothness));\n    }\n    tangents.push(\n        makeTangent(pts[pLast - 1], pts[pLast], pts[0], smoothness)\n    );\n\n    for(i = 1; i <= pLast; i++) {\n        path += 'C' + tangents[i - 1][1] + ' ' + tangents[i][0] + ' ' + pts[i];\n    }\n    path += 'C' + tangents[pLast][1] + ' ' + tangents[0][0] + ' ' + pts[0] + 'Z';\n    return path;\n};\n\nfunction makeTangent(prevpt, thispt, nextpt, smoothness) {\n    var d1x = prevpt[0] - thispt[0];\n    var d1y = prevpt[1] - thispt[1];\n    var d2x = nextpt[0] - thispt[0];\n    var d2y = nextpt[1] - thispt[1];\n    var d1a = Math.pow(d1x * d1x + d1y * d1y, CatmullRomExp / 2);\n    var d2a = Math.pow(d2x * d2x + d2y * d2y, CatmullRomExp / 2);\n    var numx = (d2a * d2a * d1x - d1a * d1a * d2x) * smoothness;\n    var numy = (d2a * d2a * d1y - d1a * d1a * d2y) * smoothness;\n    var denom1 = 3 * d2a * (d1a + d2a);\n    var denom2 = 3 * d1a * (d1a + d2a);\n    return [\n        [\n            d3.round(thispt[0] + (denom1 && numx / denom1), 2),\n            d3.round(thispt[1] + (denom1 && numy / denom1), 2)\n        ], [\n            d3.round(thispt[0] - (denom2 && numx / denom2), 2),\n            d3.round(thispt[1] - (denom2 && numy / denom2), 2)\n        ]\n    ];\n}\n\n// step paths - returns a generator function for paths\n// with the given step shape\nvar STEPPATH = {\n    hv: function(p0, p1) {\n        return 'H' + d3.round(p1[0], 2) + 'V' + d3.round(p1[1], 2);\n    },\n    vh: function(p0, p1) {\n        return 'V' + d3.round(p1[1], 2) + 'H' + d3.round(p1[0], 2);\n    },\n    hvh: function(p0, p1) {\n        return 'H' + d3.round((p0[0] + p1[0]) / 2, 2) + 'V' +\n            d3.round(p1[1], 2) + 'H' + d3.round(p1[0], 2);\n    },\n    vhv: function(p0, p1) {\n        return 'V' + d3.round((p0[1] + p1[1]) / 2, 2) + 'H' +\n            d3.round(p1[0], 2) + 'V' + d3.round(p1[1], 2);\n    }\n};\nvar STEPLINEAR = function(p0, p1) {\n    return 'L' + d3.round(p1[0], 2) + ',' + d3.round(p1[1], 2);\n};\ndrawing.steps = function(shape) {\n    var onestep = STEPPATH[shape] || STEPLINEAR;\n    return function(pts) {\n        var path = 'M' + d3.round(pts[0][0], 2) + ',' + d3.round(pts[0][1], 2);\n        for(var i = 1; i < pts.length; i++) {\n            path += onestep(pts[i - 1], pts[i]);\n        }\n        return path;\n    };\n};\n\n// off-screen svg render testing element, shared by the whole page\n// uses the id 'js-plotly-tester' and stores it in drawing.tester\ndrawing.makeTester = function() {\n    var tester = Lib.ensureSingleById(d3.select('body'), 'svg', 'js-plotly-tester', function(s) {\n        s.attr(xmlnsNamespaces.svgAttrs)\n            .style({\n                position: 'absolute',\n                left: '-10000px',\n                top: '-10000px',\n                width: '9000px',\n                height: '9000px',\n                'z-index': '1'\n            });\n    });\n\n    // browsers differ on how they describe the bounding rect of\n    // the svg if its contents spill over... so make a 1x1px\n    // reference point we can measure off of.\n    var testref = Lib.ensureSingle(tester, 'path', 'js-reference-point', function(s) {\n        s.attr('d', 'M0,0H1V1H0Z')\n            .style({\n                'stroke-width': 0,\n                fill: 'black'\n            });\n    });\n\n    drawing.tester = tester;\n    drawing.testref = testref;\n};\n\n/*\n * use our offscreen tester to get a clientRect for an element,\n * in a reference frame where it isn't translated (or transformed) and\n * its anchor point is at (0,0)\n * always returns a copy of the bbox, so the caller can modify it safely\n *\n * @param {SVGElement} node: the element to measure. If possible this should be\n *   a <text> or MathJax <g> element that's already passed through\n *   `convertToTspans` because in that case we can cache the results, but it's\n *   possible to pass in any svg element.\n *\n * @param {boolean} inTester: is this element already in `drawing.tester`?\n *   If you are measuring a dummy element, rather than one you really intend\n *   to use on the plot, making it in `drawing.tester` in the first place\n *   allows us to test faster because it cuts out cloning and appending it.\n *\n * @param {string} hash: for internal use only, if we already know the cache key\n *   for this element beforehand.\n *\n * @return {object}: a plain object containing the width, height, left, right,\n *   top, and bottom of `node`\n */\ndrawing.savedBBoxes = {};\nvar savedBBoxesCount = 0;\nvar maxSavedBBoxes = 10000;\n\ndrawing.bBox = function(node, inTester, hash) {\n    /*\n     * Cache elements we've already measured so we don't have to\n     * remeasure the same thing many times\n     * We have a few bBox callers though who pass a node larger than\n     * a <text> or a MathJax <g>, such as an axis group containing many labels.\n     * These will not generate a hash (unless we figure out an appropriate\n     * hash key for them) and thus we will not hash them.\n     */\n    if(!hash) hash = nodeHash(node);\n    var out;\n    if(hash) {\n        out = drawing.savedBBoxes[hash];\n        if(out) return Lib.extendFlat({}, out);\n    } else if(node.childNodes.length === 1) {\n        /*\n         * If we have only one child element, which is itself hashable, make\n         * a new hash from this element plus its x,y,transform\n         * These bounding boxes *include* x,y,transform - mostly for use by\n         * callers trying to avoid overlaps (ie titles)\n         */\n        var innerNode = node.childNodes[0];\n\n        hash = nodeHash(innerNode);\n        if(hash) {\n            var x = +innerNode.getAttribute('x') || 0;\n            var y = +innerNode.getAttribute('y') || 0;\n            var transform = innerNode.getAttribute('transform');\n\n            if(!transform) {\n                // in this case, just varying x and y, don't bother caching\n                // the final bBox because the alteration is quick.\n                var innerBB = drawing.bBox(innerNode, false, hash);\n                if(x) {\n                    innerBB.left += x;\n                    innerBB.right += x;\n                }\n                if(y) {\n                    innerBB.top += y;\n                    innerBB.bottom += y;\n                }\n                return innerBB;\n            }\n            /*\n             * else we have a transform - rather than make a complicated\n             * (and error-prone and probably slow) transform parser/calculator,\n             * just continue on calculating the boundingClientRect of the group\n             * and use the new composite hash to cache it.\n             * That said, `innerNode.transform.baseVal` is an array of\n             * `SVGTransform` objects, that *do* seem to have a nice matrix\n             * multiplication interface that we could use to avoid making\n             * another getBoundingClientRect call...\n             */\n            hash += '~' + x + '~' + y + '~' + transform;\n\n            out = drawing.savedBBoxes[hash];\n            if(out) return Lib.extendFlat({}, out);\n        }\n    }\n    var testNode, tester;\n    if(inTester) {\n        testNode = node;\n    } else {\n        tester = drawing.tester.node();\n\n        // copy the node to test into the tester\n        testNode = node.cloneNode(true);\n        tester.appendChild(testNode);\n    }\n\n    // standardize its position (and newline tspans if any)\n    d3.select(testNode)\n        .attr('transform', null)\n        .call(svgTextUtils.positionText, 0, 0);\n\n    var testRect = testNode.getBoundingClientRect();\n    var refRect = drawing.testref\n        .node()\n        .getBoundingClientRect();\n\n    if(!inTester) tester.removeChild(testNode);\n\n    var bb = {\n        height: testRect.height,\n        width: testRect.width,\n        left: testRect.left - refRect.left,\n        top: testRect.top - refRect.top,\n        right: testRect.right - refRect.left,\n        bottom: testRect.bottom - refRect.top\n    };\n\n    // make sure we don't have too many saved boxes,\n    // or a long session could overload on memory\n    // by saving boxes for long-gone elements\n    if(savedBBoxesCount >= maxSavedBBoxes) {\n        drawing.savedBBoxes = {};\n        savedBBoxesCount = 0;\n    }\n\n    // cache this bbox\n    if(hash) drawing.savedBBoxes[hash] = bb;\n    savedBBoxesCount++;\n\n    return Lib.extendFlat({}, bb);\n};\n\n// capture everything about a node (at least in our usage) that\n// impacts its bounding box, given that bBox clears x, y, and transform\nfunction nodeHash(node) {\n    var inputText = node.getAttribute('data-unformatted');\n    if(inputText === null) return;\n    return inputText +\n        node.getAttribute('data-math') +\n        node.getAttribute('text-anchor') +\n        node.getAttribute('style');\n}\n\n/**\n * Set clipPath URL in a way that work for all situations.\n *\n * In details, graphs on pages with <base> HTML tags need to prepend\n * the clip path ids with the page's base url EXCEPT during toImage exports.\n *\n * @param {d3 selection} s : node to add clip-path attribute\n * @param {string} localId : local clip-path (w/o base url) id\n * @param {DOM element || object} gd\n * - context._baseUrl {string}\n * - context._exportedPlot {boolean}\n */\ndrawing.setClipUrl = function(s, localId, gd) {\n    s.attr('clip-path', getFullUrl(localId, gd));\n};\n\nfunction getFullUrl(localId, gd) {\n    if(!localId) return null;\n\n    var context = gd._context;\n    var baseUrl = context._exportedPlot ? '' : (context._baseUrl || '');\n    return baseUrl ?\n        'url(\\'' + baseUrl + '#' + localId + '\\')' :\n        'url(#' + localId + ')';\n}\n\ndrawing.getTranslate = function(element) {\n    // Note the separator [^\\d] between x and y in this regex\n    // We generally use ',' but IE will convert it to ' '\n    var re = /.*\\btranslate\\((-?\\d*\\.?\\d*)[^-\\d]*(-?\\d*\\.?\\d*)[^\\d].*/;\n    var getter = element.attr ? 'attr' : 'getAttribute';\n    var transform = element[getter]('transform') || '';\n\n    var translate = transform.replace(re, function(match, p1, p2) {\n        return [p1, p2].join(' ');\n    })\n    .split(' ');\n\n    return {\n        x: +translate[0] || 0,\n        y: +translate[1] || 0\n    };\n};\n\ndrawing.setTranslate = function(element, x, y) {\n    var re = /(\\btranslate\\(.*?\\);?)/;\n    var getter = element.attr ? 'attr' : 'getAttribute';\n    var setter = element.attr ? 'attr' : 'setAttribute';\n    var transform = element[getter]('transform') || '';\n\n    x = x || 0;\n    y = y || 0;\n\n    transform = transform.replace(re, '').trim();\n    transform += strTranslate(x, y);\n    transform = transform.trim();\n\n    element[setter]('transform', transform);\n\n    return transform;\n};\n\ndrawing.getScale = function(element) {\n    var re = /.*\\bscale\\((\\d*\\.?\\d*)[^\\d]*(\\d*\\.?\\d*)[^\\d].*/;\n    var getter = element.attr ? 'attr' : 'getAttribute';\n    var transform = element[getter]('transform') || '';\n\n    var translate = transform.replace(re, function(match, p1, p2) {\n        return [p1, p2].join(' ');\n    })\n    .split(' ');\n\n    return {\n        x: +translate[0] || 1,\n        y: +translate[1] || 1\n    };\n};\n\ndrawing.setScale = function(element, x, y) {\n    var re = /(\\bscale\\(.*?\\);?)/;\n    var getter = element.attr ? 'attr' : 'getAttribute';\n    var setter = element.attr ? 'attr' : 'setAttribute';\n    var transform = element[getter]('transform') || '';\n\n    x = x || 1;\n    y = y || 1;\n\n    transform = transform.replace(re, '').trim();\n    transform += 'scale(' + x + ',' + y + ')';\n    transform = transform.trim();\n\n    element[setter]('transform', transform);\n\n    return transform;\n};\n\nvar SCALE_RE = /\\s*sc.*/;\n\ndrawing.setPointGroupScale = function(selection, xScale, yScale) {\n    xScale = xScale || 1;\n    yScale = yScale || 1;\n\n    if(!selection) return;\n\n    // The same scale transform for every point:\n    var scale = (xScale === 1 && yScale === 1) ?\n        '' :\n        'scale(' + xScale + ',' + yScale + ')';\n\n    selection.each(function() {\n        var t = (this.getAttribute('transform') || '').replace(SCALE_RE, '');\n        t += scale;\n        t = t.trim();\n        this.setAttribute('transform', t);\n    });\n};\n\nvar TEXT_POINT_LAST_TRANSLATION_RE = /translate\\([^)]*\\)\\s*$/;\n\ndrawing.setTextPointsScale = function(selection, xScale, yScale) {\n    if(!selection) return;\n\n    selection.each(function() {\n        var transforms;\n        var el = d3.select(this);\n        var text = el.select('text');\n\n        if(!text.node()) return;\n\n        var x = parseFloat(text.attr('x') || 0);\n        var y = parseFloat(text.attr('y') || 0);\n\n        var existingTransform = (el.attr('transform') || '').match(TEXT_POINT_LAST_TRANSLATION_RE);\n\n        if(xScale === 1 && yScale === 1) {\n            transforms = [];\n        } else {\n            transforms = [\n                strTranslate(x, y),\n                'scale(' + xScale + ',' + yScale + ')',\n                strTranslate(-x, -y),\n            ];\n        }\n\n        if(existingTransform) {\n            transforms.push(existingTransform);\n        }\n\n        el.attr('transform', transforms.join(''));\n    });\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\n/** Marker symbol definitions\n * users can specify markers either by number or name\n * add 100 (or '-open') and you get an open marker\n *  open markers have no fill and use line color as the stroke color\n * add 200 (or '-dot') and you get a dot in the middle\n * add both and you get both\n */\n\nmodule.exports = {\n    circle: {\n        n: 0,\n        f: function(r) {\n            var rs = d3.round(r, 2);\n            return 'M' + rs + ',0A' + rs + ',' + rs + ' 0 1,1 0,-' + rs +\n                'A' + rs + ',' + rs + ' 0 0,1 ' + rs + ',0Z';\n        }\n    },\n    square: {\n        n: 1,\n        f: function(r) {\n            var rs = d3.round(r, 2);\n            return 'M' + rs + ',' + rs + 'H-' + rs + 'V-' + rs + 'H' + rs + 'Z';\n        }\n    },\n    diamond: {\n        n: 2,\n        f: function(r) {\n            var rd = d3.round(r * 1.3, 2);\n            return 'M' + rd + ',0L0,' + rd + 'L-' + rd + ',0L0,-' + rd + 'Z';\n        }\n    },\n    cross: {\n        n: 3,\n        f: function(r) {\n            var rc = d3.round(r * 0.4, 2);\n            var rc2 = d3.round(r * 1.2, 2);\n            return 'M' + rc2 + ',' + rc + 'H' + rc + 'V' + rc2 + 'H-' + rc +\n                'V' + rc + 'H-' + rc2 + 'V-' + rc + 'H-' + rc + 'V-' + rc2 +\n                'H' + rc + 'V-' + rc + 'H' + rc2 + 'Z';\n        }\n    },\n    x: {\n        n: 4,\n        f: function(r) {\n            var rx = d3.round(r * 0.8 / Math.sqrt(2), 2);\n            var ne = 'l' + rx + ',' + rx;\n            var se = 'l' + rx + ',-' + rx;\n            var sw = 'l-' + rx + ',-' + rx;\n            var nw = 'l-' + rx + ',' + rx;\n            return 'M0,' + rx + ne + se + sw + se + sw + nw + sw + nw + ne + nw + ne + 'Z';\n        }\n    },\n    'triangle-up': {\n        n: 5,\n        f: function(r) {\n            var rt = d3.round(r * 2 / Math.sqrt(3), 2);\n            var r2 = d3.round(r / 2, 2);\n            var rs = d3.round(r, 2);\n            return 'M-' + rt + ',' + r2 + 'H' + rt + 'L0,-' + rs + 'Z';\n        }\n    },\n    'triangle-down': {\n        n: 6,\n        f: function(r) {\n            var rt = d3.round(r * 2 / Math.sqrt(3), 2);\n            var r2 = d3.round(r / 2, 2);\n            var rs = d3.round(r, 2);\n            return 'M-' + rt + ',-' + r2 + 'H' + rt + 'L0,' + rs + 'Z';\n        }\n    },\n    'triangle-left': {\n        n: 7,\n        f: function(r) {\n            var rt = d3.round(r * 2 / Math.sqrt(3), 2);\n            var r2 = d3.round(r / 2, 2);\n            var rs = d3.round(r, 2);\n            return 'M' + r2 + ',-' + rt + 'V' + rt + 'L-' + rs + ',0Z';\n        }\n    },\n    'triangle-right': {\n        n: 8,\n        f: function(r) {\n            var rt = d3.round(r * 2 / Math.sqrt(3), 2);\n            var r2 = d3.round(r / 2, 2);\n            var rs = d3.round(r, 2);\n            return 'M-' + r2 + ',-' + rt + 'V' + rt + 'L' + rs + ',0Z';\n        }\n    },\n    'triangle-ne': {\n        n: 9,\n        f: function(r) {\n            var r1 = d3.round(r * 0.6, 2);\n            var r2 = d3.round(r * 1.2, 2);\n            return 'M-' + r2 + ',-' + r1 + 'H' + r1 + 'V' + r2 + 'Z';\n        }\n    },\n    'triangle-se': {\n        n: 10,\n        f: function(r) {\n            var r1 = d3.round(r * 0.6, 2);\n            var r2 = d3.round(r * 1.2, 2);\n            return 'M' + r1 + ',-' + r2 + 'V' + r1 + 'H-' + r2 + 'Z';\n        }\n    },\n    'triangle-sw': {\n        n: 11,\n        f: function(r) {\n            var r1 = d3.round(r * 0.6, 2);\n            var r2 = d3.round(r * 1.2, 2);\n            return 'M' + r2 + ',' + r1 + 'H-' + r1 + 'V-' + r2 + 'Z';\n        }\n    },\n    'triangle-nw': {\n        n: 12,\n        f: function(r) {\n            var r1 = d3.round(r * 0.6, 2);\n            var r2 = d3.round(r * 1.2, 2);\n            return 'M-' + r1 + ',' + r2 + 'V-' + r1 + 'H' + r2 + 'Z';\n        }\n    },\n    pentagon: {\n        n: 13,\n        f: function(r) {\n            var x1 = d3.round(r * 0.951, 2);\n            var x2 = d3.round(r * 0.588, 2);\n            var y0 = d3.round(-r, 2);\n            var y1 = d3.round(r * -0.309, 2);\n            var y2 = d3.round(r * 0.809, 2);\n            return 'M' + x1 + ',' + y1 + 'L' + x2 + ',' + y2 + 'H-' + x2 +\n                'L-' + x1 + ',' + y1 + 'L0,' + y0 + 'Z';\n        }\n    },\n    hexagon: {\n        n: 14,\n        f: function(r) {\n            var y0 = d3.round(r, 2);\n            var y1 = d3.round(r / 2, 2);\n            var x = d3.round(r * Math.sqrt(3) / 2, 2);\n            return 'M' + x + ',-' + y1 + 'V' + y1 + 'L0,' + y0 +\n                'L-' + x + ',' + y1 + 'V-' + y1 + 'L0,-' + y0 + 'Z';\n        }\n    },\n    hexagon2: {\n        n: 15,\n        f: function(r) {\n            var x0 = d3.round(r, 2);\n            var x1 = d3.round(r / 2, 2);\n            var y = d3.round(r * Math.sqrt(3) / 2, 2);\n            return 'M-' + x1 + ',' + y + 'H' + x1 + 'L' + x0 +\n                ',0L' + x1 + ',-' + y + 'H-' + x1 + 'L-' + x0 + ',0Z';\n        }\n    },\n    octagon: {\n        n: 16,\n        f: function(r) {\n            var a = d3.round(r * 0.924, 2);\n            var b = d3.round(r * 0.383, 2);\n            return 'M-' + b + ',-' + a + 'H' + b + 'L' + a + ',-' + b + 'V' + b +\n                'L' + b + ',' + a + 'H-' + b + 'L-' + a + ',' + b + 'V-' + b + 'Z';\n        }\n    },\n    star: {\n        n: 17,\n        f: function(r) {\n            var rs = r * 1.4;\n            var x1 = d3.round(rs * 0.225, 2);\n            var x2 = d3.round(rs * 0.951, 2);\n            var x3 = d3.round(rs * 0.363, 2);\n            var x4 = d3.round(rs * 0.588, 2);\n            var y0 = d3.round(-rs, 2);\n            var y1 = d3.round(rs * -0.309, 2);\n            var y3 = d3.round(rs * 0.118, 2);\n            var y4 = d3.round(rs * 0.809, 2);\n            var y5 = d3.round(rs * 0.382, 2);\n            return 'M' + x1 + ',' + y1 + 'H' + x2 + 'L' + x3 + ',' + y3 +\n                'L' + x4 + ',' + y4 + 'L0,' + y5 + 'L-' + x4 + ',' + y4 +\n                'L-' + x3 + ',' + y3 + 'L-' + x2 + ',' + y1 + 'H-' + x1 +\n                'L0,' + y0 + 'Z';\n        }\n    },\n    hexagram: {\n        n: 18,\n        f: function(r) {\n            var y = d3.round(r * 0.66, 2);\n            var x1 = d3.round(r * 0.38, 2);\n            var x2 = d3.round(r * 0.76, 2);\n            return 'M-' + x2 + ',0l-' + x1 + ',-' + y + 'h' + x2 +\n                'l' + x1 + ',-' + y + 'l' + x1 + ',' + y + 'h' + x2 +\n                'l-' + x1 + ',' + y + 'l' + x1 + ',' + y + 'h-' + x2 +\n                'l-' + x1 + ',' + y + 'l-' + x1 + ',-' + y + 'h-' + x2 + 'Z';\n        }\n    },\n    'star-triangle-up': {\n        n: 19,\n        f: function(r) {\n            var x = d3.round(r * Math.sqrt(3) * 0.8, 2);\n            var y1 = d3.round(r * 0.8, 2);\n            var y2 = d3.round(r * 1.6, 2);\n            var rc = d3.round(r * 4, 2);\n            var aPart = 'A ' + rc + ',' + rc + ' 0 0 1 ';\n            return 'M-' + x + ',' + y1 + aPart + x + ',' + y1 +\n                aPart + '0,-' + y2 + aPart + '-' + x + ',' + y1 + 'Z';\n        }\n    },\n    'star-triangle-down': {\n        n: 20,\n        f: function(r) {\n            var x = d3.round(r * Math.sqrt(3) * 0.8, 2);\n            var y1 = d3.round(r * 0.8, 2);\n            var y2 = d3.round(r * 1.6, 2);\n            var rc = d3.round(r * 4, 2);\n            var aPart = 'A ' + rc + ',' + rc + ' 0 0 1 ';\n            return 'M' + x + ',-' + y1 + aPart + '-' + x + ',-' + y1 +\n                aPart + '0,' + y2 + aPart + x + ',-' + y1 + 'Z';\n        }\n    },\n    'star-square': {\n        n: 21,\n        f: function(r) {\n            var rp = d3.round(r * 1.1, 2);\n            var rc = d3.round(r * 2, 2);\n            var aPart = 'A ' + rc + ',' + rc + ' 0 0 1 ';\n            return 'M-' + rp + ',-' + rp + aPart + '-' + rp + ',' + rp +\n                aPart + rp + ',' + rp + aPart + rp + ',-' + rp +\n                aPart + '-' + rp + ',-' + rp + 'Z';\n        }\n    },\n    'star-diamond': {\n        n: 22,\n        f: function(r) {\n            var rp = d3.round(r * 1.4, 2);\n            var rc = d3.round(r * 1.9, 2);\n            var aPart = 'A ' + rc + ',' + rc + ' 0 0 1 ';\n            return 'M-' + rp + ',0' + aPart + '0,' + rp +\n                aPart + rp + ',0' + aPart + '0,-' + rp +\n                aPart + '-' + rp + ',0' + 'Z';\n        }\n    },\n    'diamond-tall': {\n        n: 23,\n        f: function(r) {\n            var x = d3.round(r * 0.7, 2);\n            var y = d3.round(r * 1.4, 2);\n            return 'M0,' + y + 'L' + x + ',0L0,-' + y + 'L-' + x + ',0Z';\n        }\n    },\n    'diamond-wide': {\n        n: 24,\n        f: function(r) {\n            var x = d3.round(r * 1.4, 2);\n            var y = d3.round(r * 0.7, 2);\n            return 'M0,' + y + 'L' + x + ',0L0,-' + y + 'L-' + x + ',0Z';\n        }\n    },\n    hourglass: {\n        n: 25,\n        f: function(r) {\n            var rs = d3.round(r, 2);\n            return 'M' + rs + ',' + rs + 'H-' + rs + 'L' + rs + ',-' + rs + 'H-' + rs + 'Z';\n        },\n        noDot: true\n    },\n    bowtie: {\n        n: 26,\n        f: function(r) {\n            var rs = d3.round(r, 2);\n            return 'M' + rs + ',' + rs + 'V-' + rs + 'L-' + rs + ',' + rs + 'V-' + rs + 'Z';\n        },\n        noDot: true\n    },\n    'circle-cross': {\n        n: 27,\n        f: function(r) {\n            var rs = d3.round(r, 2);\n            return 'M0,' + rs + 'V-' + rs + 'M' + rs + ',0H-' + rs +\n                'M' + rs + ',0A' + rs + ',' + rs + ' 0 1,1 0,-' + rs +\n                'A' + rs + ',' + rs + ' 0 0,1 ' + rs + ',0Z';\n        },\n        needLine: true,\n        noDot: true\n    },\n    'circle-x': {\n        n: 28,\n        f: function(r) {\n            var rs = d3.round(r, 2);\n            var rc = d3.round(r / Math.sqrt(2), 2);\n            return 'M' + rc + ',' + rc + 'L-' + rc + ',-' + rc +\n                'M' + rc + ',-' + rc + 'L-' + rc + ',' + rc +\n                'M' + rs + ',0A' + rs + ',' + rs + ' 0 1,1 0,-' + rs +\n                'A' + rs + ',' + rs + ' 0 0,1 ' + rs + ',0Z';\n        },\n        needLine: true,\n        noDot: true\n    },\n    'square-cross': {\n        n: 29,\n        f: function(r) {\n            var rs = d3.round(r, 2);\n            return 'M0,' + rs + 'V-' + rs + 'M' + rs + ',0H-' + rs +\n                'M' + rs + ',' + rs + 'H-' + rs + 'V-' + rs + 'H' + rs + 'Z';\n        },\n        needLine: true,\n        noDot: true\n    },\n    'square-x': {\n        n: 30,\n        f: function(r) {\n            var rs = d3.round(r, 2);\n            return 'M' + rs + ',' + rs + 'L-' + rs + ',-' + rs +\n                'M' + rs + ',-' + rs + 'L-' + rs + ',' + rs +\n                'M' + rs + ',' + rs + 'H-' + rs + 'V-' + rs + 'H' + rs + 'Z';\n        },\n        needLine: true,\n        noDot: true\n    },\n    'diamond-cross': {\n        n: 31,\n        f: function(r) {\n            var rd = d3.round(r * 1.3, 2);\n            return 'M' + rd + ',0L0,' + rd + 'L-' + rd + ',0L0,-' + rd + 'Z' +\n                'M0,-' + rd + 'V' + rd + 'M-' + rd + ',0H' + rd;\n        },\n        needLine: true,\n        noDot: true\n    },\n    'diamond-x': {\n        n: 32,\n        f: function(r) {\n            var rd = d3.round(r * 1.3, 2);\n            var r2 = d3.round(r * 0.65, 2);\n            return 'M' + rd + ',0L0,' + rd + 'L-' + rd + ',0L0,-' + rd + 'Z' +\n                'M-' + r2 + ',-' + r2 + 'L' + r2 + ',' + r2 +\n                'M-' + r2 + ',' + r2 + 'L' + r2 + ',-' + r2;\n        },\n        needLine: true,\n        noDot: true\n    },\n    'cross-thin': {\n        n: 33,\n        f: function(r) {\n            var rc = d3.round(r * 1.4, 2);\n            return 'M0,' + rc + 'V-' + rc + 'M' + rc + ',0H-' + rc;\n        },\n        needLine: true,\n        noDot: true,\n        noFill: true\n    },\n    'x-thin': {\n        n: 34,\n        f: function(r) {\n            var rx = d3.round(r, 2);\n            return 'M' + rx + ',' + rx + 'L-' + rx + ',-' + rx +\n                'M' + rx + ',-' + rx + 'L-' + rx + ',' + rx;\n        },\n        needLine: true,\n        noDot: true,\n        noFill: true\n    },\n    asterisk: {\n        n: 35,\n        f: function(r) {\n            var rc = d3.round(r * 1.2, 2);\n            var rs = d3.round(r * 0.85, 2);\n            return 'M0,' + rc + 'V-' + rc + 'M' + rc + ',0H-' + rc +\n                'M' + rs + ',' + rs + 'L-' + rs + ',-' + rs +\n                'M' + rs + ',-' + rs + 'L-' + rs + ',' + rs;\n        },\n        needLine: true,\n        noDot: true,\n        noFill: true\n    },\n    hash: {\n        n: 36,\n        f: function(r) {\n            var r1 = d3.round(r / 2, 2);\n            var r2 = d3.round(r, 2);\n            return 'M' + r1 + ',' + r2 + 'V-' + r2 +\n                'm-' + r2 + ',0V' + r2 +\n                'M' + r2 + ',' + r1 + 'H-' + r2 +\n                'm0,-' + r2 + 'H' + r2;\n        },\n        needLine: true,\n        noFill: true\n    },\n    'y-up': {\n        n: 37,\n        f: function(r) {\n            var x = d3.round(r * 1.2, 2);\n            var y0 = d3.round(r * 1.6, 2);\n            var y1 = d3.round(r * 0.8, 2);\n            return 'M-' + x + ',' + y1 + 'L0,0M' + x + ',' + y1 + 'L0,0M0,-' + y0 + 'L0,0';\n        },\n        needLine: true,\n        noDot: true,\n        noFill: true\n    },\n    'y-down': {\n        n: 38,\n        f: function(r) {\n            var x = d3.round(r * 1.2, 2);\n            var y0 = d3.round(r * 1.6, 2);\n            var y1 = d3.round(r * 0.8, 2);\n            return 'M-' + x + ',-' + y1 + 'L0,0M' + x + ',-' + y1 + 'L0,0M0,' + y0 + 'L0,0';\n        },\n        needLine: true,\n        noDot: true,\n        noFill: true\n    },\n    'y-left': {\n        n: 39,\n        f: function(r) {\n            var y = d3.round(r * 1.2, 2);\n            var x0 = d3.round(r * 1.6, 2);\n            var x1 = d3.round(r * 0.8, 2);\n            return 'M' + x1 + ',' + y + 'L0,0M' + x1 + ',-' + y + 'L0,0M-' + x0 + ',0L0,0';\n        },\n        needLine: true,\n        noDot: true,\n        noFill: true\n    },\n    'y-right': {\n        n: 40,\n        f: function(r) {\n            var y = d3.round(r * 1.2, 2);\n            var x0 = d3.round(r * 1.6, 2);\n            var x1 = d3.round(r * 0.8, 2);\n            return 'M-' + x1 + ',' + y + 'L0,0M-' + x1 + ',-' + y + 'L0,0M' + x0 + ',0L0,0';\n        },\n        needLine: true,\n        noDot: true,\n        noFill: true\n    },\n    'line-ew': {\n        n: 41,\n        f: function(r) {\n            var rc = d3.round(r * 1.4, 2);\n            return 'M' + rc + ',0H-' + rc;\n        },\n        needLine: true,\n        noDot: true,\n        noFill: true\n    },\n    'line-ns': {\n        n: 42,\n        f: function(r) {\n            var rc = d3.round(r * 1.4, 2);\n            return 'M0,' + rc + 'V-' + rc;\n        },\n        needLine: true,\n        noDot: true,\n        noFill: true\n    },\n    'line-ne': {\n        n: 43,\n        f: function(r) {\n            var rx = d3.round(r, 2);\n            return 'M' + rx + ',-' + rx + 'L-' + rx + ',' + rx;\n        },\n        needLine: true,\n        noDot: true,\n        noFill: true\n    },\n    'line-nw': {\n        n: 44,\n        f: function(r) {\n            var rx = d3.round(r, 2);\n            return 'M' + rx + ',' + rx + 'L-' + rx + ',-' + rx;\n        },\n        needLine: true,\n        noDot: true,\n        noFill: true\n    },\n    'arrow-up': {\n        n: 45,\n        f: function(r) {\n            var rx = d3.round(r, 2);\n            var ry = d3.round(r * 2, 2);\n            return 'M0,0L-' + rx + ',' + ry + 'H' + rx + 'Z';\n        },\n        noDot: true\n    },\n    'arrow-down': {\n        n: 46,\n        f: function(r) {\n            var rx = d3.round(r, 2);\n            var ry = d3.round(r * 2, 2);\n            return 'M0,0L-' + rx + ',-' + ry + 'H' + rx + 'Z';\n        },\n        noDot: true\n    },\n    'arrow-left': {\n        n: 47,\n        f: function(r) {\n            var rx = d3.round(r * 2, 2);\n            var ry = d3.round(r, 2);\n            return 'M0,0L' + rx + ',-' + ry + 'V' + ry + 'Z';\n        },\n        noDot: true\n    },\n    'arrow-right': {\n        n: 48,\n        f: function(r) {\n            var rx = d3.round(r * 2, 2);\n            var ry = d3.round(r, 2);\n            return 'M0,0L-' + rx + ',-' + ry + 'V' + ry + 'Z';\n        },\n        noDot: true\n    },\n    'arrow-bar-up': {\n        n: 49,\n        f: function(r) {\n            var rx = d3.round(r, 2);\n            var ry = d3.round(r * 2, 2);\n            return 'M-' + rx + ',0H' + rx + 'M0,0L-' + rx + ',' + ry + 'H' + rx + 'Z';\n        },\n        needLine: true,\n        noDot: true\n    },\n    'arrow-bar-down': {\n        n: 50,\n        f: function(r) {\n            var rx = d3.round(r, 2);\n            var ry = d3.round(r * 2, 2);\n            return 'M-' + rx + ',0H' + rx + 'M0,0L-' + rx + ',-' + ry + 'H' + rx + 'Z';\n        },\n        needLine: true,\n        noDot: true\n    },\n    'arrow-bar-left': {\n        n: 51,\n        f: function(r) {\n            var rx = d3.round(r * 2, 2);\n            var ry = d3.round(r, 2);\n            return 'M0,-' + ry + 'V' + ry + 'M0,0L' + rx + ',-' + ry + 'V' + ry + 'Z';\n        },\n        needLine: true,\n        noDot: true\n    },\n    'arrow-bar-right': {\n        n: 52,\n        f: function(r) {\n            var rx = d3.round(r * 2, 2);\n            var ry = d3.round(r, 2);\n            return 'M0,-' + ry + 'V' + ry + 'M0,0L-' + rx + ',-' + ry + 'V' + ry + 'Z';\n        },\n        needLine: true,\n        noDot: true\n    }\n};\n","'use strict';\n\n\nmodule.exports = {\n    visible: {\n        valType: 'boolean',\n        editType: 'calc',\n        description: [\n            'Determines whether or not this set of error bars is visible.'\n        ].join(' ')\n    },\n    type: {\n        valType: 'enumerated',\n        values: ['percent', 'constant', 'sqrt', 'data'],\n        editType: 'calc',\n        description: [\n            'Determines the rule used to generate the error bars.',\n\n            'If *constant`, the bar lengths are of a constant value.',\n            'Set this constant in `value`.',\n\n            'If *percent*, the bar lengths correspond to a percentage of',\n            'underlying data. Set this percentage in `value`.',\n\n            'If *sqrt*, the bar lengths correspond to the square of the',\n            'underlying data.',\n\n            'If *data*, the bar lengths are set with data set `array`.'\n        ].join(' ')\n    },\n    symmetric: {\n        valType: 'boolean',\n        editType: 'calc',\n        description: [\n            'Determines whether or not the error bars have the same length',\n            'in both direction',\n            '(top/bottom for vertical bars, left/right for horizontal bars.'\n        ].join(' ')\n    },\n    array: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: [\n            'Sets the data corresponding the length of each error bar.',\n            'Values are plotted relative to the underlying data.'\n        ].join(' ')\n    },\n    arrayminus: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: [\n            'Sets the data corresponding the length of each error bar in the',\n            'bottom (left) direction for vertical (horizontal) bars',\n            'Values are plotted relative to the underlying data.'\n        ].join(' ')\n    },\n    value: {\n        valType: 'number',\n        min: 0,\n        dflt: 10,\n        editType: 'calc',\n        description: [\n            'Sets the value of either the percentage',\n            '(if `type` is set to *percent*) or the constant',\n            '(if `type` is set to *constant*) corresponding to the lengths of',\n            'the error bars.'\n        ].join(' ')\n    },\n    valueminus: {\n        valType: 'number',\n        min: 0,\n        dflt: 10,\n        editType: 'calc',\n        description: [\n            'Sets the value of either the percentage',\n            '(if `type` is set to *percent*) or the constant',\n            '(if `type` is set to *constant*) corresponding to the lengths of',\n            'the error bars in the',\n            'bottom (left) direction for vertical (horizontal) bars'\n        ].join(' ')\n    },\n    traceref: {\n        valType: 'integer',\n        min: 0,\n        dflt: 0,\n        editType: 'style'\n    },\n    tracerefminus: {\n        valType: 'integer',\n        min: 0,\n        dflt: 0,\n        editType: 'style'\n    },\n    copy_ystyle: {\n        valType: 'boolean',\n        editType: 'plot'\n    },\n    copy_zstyle: {\n        valType: 'boolean',\n        editType: 'style'\n    },\n    color: {\n        valType: 'color',\n        editType: 'style',\n        description: 'Sets the stoke color of the error bars.'\n    },\n    thickness: {\n        valType: 'number',\n        min: 0,\n        dflt: 2,\n        editType: 'style',\n        description: 'Sets the thickness (in px) of the error bars.'\n    },\n    width: {\n        valType: 'number',\n        min: 0,\n        editType: 'plot',\n        description: [\n            'Sets the width (in px) of the cross-bar at both ends',\n            'of the error bars.'\n        ].join(' ')\n    },\n    editType: 'calc',\n\n    _deprecated: {\n        opacity: {\n            valType: 'number',\n            editType: 'style',\n            description: [\n                'Obsolete.',\n                'Use the alpha channel in error bar `color` to set the opacity.'\n            ].join(' ')\n        }\n    }\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\nvar Registry = require('../../registry');\nvar Axes = require('../../plots/cartesian/axes');\nvar Lib = require('../../lib');\n\nvar makeComputeError = require('./compute_error');\n\nmodule.exports = function calc(gd) {\n    var calcdata = gd.calcdata;\n\n    for(var i = 0; i < calcdata.length; i++) {\n        var calcTrace = calcdata[i];\n        var trace = calcTrace[0].trace;\n\n        if(trace.visible === true && Registry.traceIs(trace, 'errorBarsOK')) {\n            var xa = Axes.getFromId(gd, trace.xaxis);\n            var ya = Axes.getFromId(gd, trace.yaxis);\n            calcOneAxis(calcTrace, trace, xa, 'x');\n            calcOneAxis(calcTrace, trace, ya, 'y');\n        }\n    }\n};\n\nfunction calcOneAxis(calcTrace, trace, axis, coord) {\n    var opts = trace['error_' + coord] || {};\n    var isVisible = (opts.visible && ['linear', 'log'].indexOf(axis.type) !== -1);\n    var vals = [];\n\n    if(!isVisible) return;\n\n    var computeError = makeComputeError(opts);\n\n    for(var i = 0; i < calcTrace.length; i++) {\n        var calcPt = calcTrace[i];\n\n        var iIn = calcPt.i;\n\n        // for types that don't include `i` in each calcdata point\n        if(iIn === undefined) iIn = i;\n\n        // for stacked area inserted points\n        // TODO: errorbars have been tested cursorily with stacked area,\n        // but not thoroughly. It's not even really clear what you want to do:\n        // Should it just be calculated based on that trace's size data?\n        // Should you add errors from below in quadrature?\n        // And what about normalization, where in principle the errors shrink\n        // again when you get up to the top end?\n        // One option would be to forbid errorbars with stacking until we\n        // decide how to handle these questions.\n        else if(iIn === null) continue;\n\n        var calcCoord = calcPt[coord];\n\n        if(!isNumeric(axis.c2l(calcCoord))) continue;\n\n        var errors = computeError(calcCoord, iIn);\n        if(isNumeric(errors[0]) && isNumeric(errors[1])) {\n            var shoe = calcPt[coord + 's'] = calcCoord - errors[0];\n            var hat = calcPt[coord + 'h'] = calcCoord + errors[1];\n            vals.push(shoe, hat);\n        }\n    }\n\n    var axId = axis._id;\n    var baseExtremes = trace._extremes[axId];\n    var extremes = Axes.findExtremes(\n        axis,\n        vals,\n        Lib.extendFlat({tozero: baseExtremes.opts.tozero}, {padded: true})\n    );\n    baseExtremes.min = baseExtremes.min.concat(extremes.min);\n    baseExtremes.max = baseExtremes.max.concat(extremes.max);\n}\n","'use strict';\n\n\n/**\n * Error bar computing function generator\n *\n * N.B. The generated function does not clean the dataPt entries. Non-numeric\n * entries result in undefined error magnitudes.\n *\n * @param {object} opts error bar attributes\n *\n * @return {function} :\n *      @param {numeric} dataPt data point from where to compute the error magnitude\n *      @param {number} index index of dataPt in its corresponding data array\n *      @return {array}\n *        - error[0] : error magnitude in the negative direction\n *        - error[1] : \" \" \" \" positive \"\n */\nmodule.exports = function makeComputeError(opts) {\n    var type = opts.type;\n    var symmetric = opts.symmetric;\n\n    if(type === 'data') {\n        var array = opts.array || [];\n\n        if(symmetric) {\n            return function computeError(dataPt, index) {\n                var val = +(array[index]);\n                return [val, val];\n            };\n        } else {\n            var arrayminus = opts.arrayminus || [];\n            return function computeError(dataPt, index) {\n                var val = +array[index];\n                var valMinus = +arrayminus[index];\n                // in case one is present and the other is missing, fill in 0\n                // so we still see the present one. Mostly useful during manual\n                // data entry.\n                if(!isNaN(val) || !isNaN(valMinus)) {\n                    return [valMinus || 0, val || 0];\n                }\n                return [NaN, NaN];\n            };\n        }\n    } else {\n        var computeErrorValue = makeComputeErrorValue(type, opts.value);\n        var computeErrorValueMinus = makeComputeErrorValue(type, opts.valueminus);\n\n        if(symmetric || opts.valueminus === undefined) {\n            return function computeError(dataPt) {\n                var val = computeErrorValue(dataPt);\n                return [val, val];\n            };\n        } else {\n            return function computeError(dataPt) {\n                return [\n                    computeErrorValueMinus(dataPt),\n                    computeErrorValue(dataPt)\n                ];\n            };\n        }\n    }\n};\n\n/**\n * Compute error bar magnitude (for all types except data)\n *\n * @param {string} type error bar type\n * @param {numeric} value error bar value\n *\n * @return {function} :\n *      @param {numeric} dataPt\n */\nfunction makeComputeErrorValue(type, value) {\n    if(type === 'percent') {\n        return function(dataPt) {\n            return Math.abs(dataPt * value / 100);\n        };\n    }\n    if(type === 'constant') {\n        return function() {\n            return Math.abs(value);\n        };\n    }\n    if(type === 'sqrt') {\n        return function(dataPt) {\n            return Math.sqrt(Math.abs(dataPt));\n        };\n    }\n}\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar Template = require('../../plot_api/plot_template');\n\nvar attributes = require('./attributes');\n\n\nmodule.exports = function(traceIn, traceOut, defaultColor, opts) {\n    var objName = 'error_' + opts.axis;\n    var containerOut = Template.newContainer(traceOut, objName);\n    var containerIn = traceIn[objName] || {};\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(containerIn, containerOut, attributes, attr, dflt);\n    }\n\n    var hasErrorBars = (\n        containerIn.array !== undefined ||\n        containerIn.value !== undefined ||\n        containerIn.type === 'sqrt'\n    );\n\n    var visible = coerce('visible', hasErrorBars);\n\n    if(visible === false) return;\n\n    var type = coerce('type', 'array' in containerIn ? 'data' : 'percent');\n    var symmetric = true;\n\n    if(type !== 'sqrt') {\n        symmetric = coerce('symmetric',\n            !((type === 'data' ? 'arrayminus' : 'valueminus') in containerIn));\n    }\n\n    if(type === 'data') {\n        coerce('array');\n        coerce('traceref');\n        if(!symmetric) {\n            coerce('arrayminus');\n            coerce('tracerefminus');\n        }\n    } else if(type === 'percent' || type === 'constant') {\n        coerce('value');\n        if(!symmetric) coerce('valueminus');\n    }\n\n    var copyAttr = 'copy_' + opts.inherit + 'style';\n    if(opts.inherit) {\n        var inheritObj = traceOut['error_' + opts.inherit];\n        if((inheritObj || {}).visible) {\n            coerce(copyAttr, !(containerIn.color ||\n                               isNumeric(containerIn.thickness) ||\n                               isNumeric(containerIn.width)));\n        }\n    }\n    if(!opts.inherit || !containerOut[copyAttr]) {\n        coerce('color', defaultColor);\n        coerce('thickness');\n        coerce('width', Registry.traceIs(traceOut, 'gl3d') ? 0 : 4);\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar overrideAll = require('../../plot_api/edit_types').overrideAll;\n\nvar attributes = require('./attributes');\n\nvar xyAttrs = {\n    error_x: Lib.extendFlat({}, attributes),\n    error_y: Lib.extendFlat({}, attributes)\n};\ndelete xyAttrs.error_x.copy_zstyle;\ndelete xyAttrs.error_y.copy_zstyle;\ndelete xyAttrs.error_y.copy_ystyle;\n\nvar xyzAttrs = {\n    error_x: Lib.extendFlat({}, attributes),\n    error_y: Lib.extendFlat({}, attributes),\n    error_z: Lib.extendFlat({}, attributes)\n};\ndelete xyzAttrs.error_x.copy_ystyle;\ndelete xyzAttrs.error_y.copy_ystyle;\ndelete xyzAttrs.error_z.copy_ystyle;\ndelete xyzAttrs.error_z.copy_zstyle;\n\nmodule.exports = {\n    moduleType: 'component',\n    name: 'errorbars',\n\n    schema: {\n        traces: {\n            scatter: xyAttrs,\n            bar: xyAttrs,\n            histogram: xyAttrs,\n            scatter3d: overrideAll(xyzAttrs, 'calc', 'nested'),\n            scattergl: overrideAll(xyAttrs, 'calc', 'nested')\n        }\n    },\n\n    supplyDefaults: require('./defaults'),\n\n    calc: require('./calc'),\n    makeComputeError: require('./compute_error'),\n\n    plot: require('./plot'),\n    style: require('./style'),\n    hoverInfo: hoverInfo\n};\n\nfunction hoverInfo(calcPoint, trace, hoverPoint) {\n    if((trace.error_y || {}).visible) {\n        hoverPoint.yerr = calcPoint.yh - calcPoint.y;\n        if(!trace.error_y.symmetric) hoverPoint.yerrneg = calcPoint.y - calcPoint.ys;\n    }\n    if((trace.error_x || {}).visible) {\n        hoverPoint.xerr = calcPoint.xh - calcPoint.x;\n        if(!trace.error_x.symmetric) hoverPoint.xerrneg = calcPoint.x - calcPoint.xs;\n    }\n}\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar isNumeric = require('fast-isnumeric');\n\nvar Drawing = require('../drawing');\nvar subTypes = require('../../traces/scatter/subtypes');\n\nmodule.exports = function plot(gd, traces, plotinfo, transitionOpts) {\n    var isNew;\n\n    var xa = plotinfo.xaxis;\n    var ya = plotinfo.yaxis;\n\n    var hasAnimation = transitionOpts && transitionOpts.duration > 0;\n\n    traces.each(function(d) {\n        var trace = d[0].trace;\n        // || {} is in case the trace (specifically scatterternary)\n        // doesn't support error bars at all, but does go through\n        // the scatter.plot mechanics, which calls ErrorBars.plot\n        // internally\n        var xObj = trace.error_x || {};\n        var yObj = trace.error_y || {};\n\n        var keyFunc;\n\n        if(trace.ids) {\n            keyFunc = function(d) {return d.id;};\n        }\n\n        var sparse = (\n            subTypes.hasMarkers(trace) &&\n            trace.marker.maxdisplayed > 0\n        );\n\n        if(!yObj.visible && !xObj.visible) d = [];\n\n        var errorbars = d3.select(this).selectAll('g.errorbar')\n            .data(d, keyFunc);\n\n        errorbars.exit().remove();\n\n        if(!d.length) return;\n\n        if(!xObj.visible) errorbars.selectAll('path.xerror').remove();\n        if(!yObj.visible) errorbars.selectAll('path.yerror').remove();\n\n        errorbars.style('opacity', 1);\n\n        var enter = errorbars.enter().append('g')\n            .classed('errorbar', true);\n\n        if(hasAnimation) {\n            enter.style('opacity', 0).transition()\n                .duration(transitionOpts.duration)\n                .style('opacity', 1);\n        }\n\n        Drawing.setClipUrl(errorbars, plotinfo.layerClipId, gd);\n\n        errorbars.each(function(d) {\n            var errorbar = d3.select(this);\n            var coords = errorCoords(d, xa, ya);\n\n            if(sparse && !d.vis) return;\n\n            var path;\n\n            var yerror = errorbar.select('path.yerror');\n            if(yObj.visible && isNumeric(coords.x) &&\n                    isNumeric(coords.yh) &&\n                    isNumeric(coords.ys)) {\n                var yw = yObj.width;\n\n                path = 'M' + (coords.x - yw) + ',' +\n                    coords.yh + 'h' + (2 * yw) + // hat\n                    'm-' + yw + ',0V' + coords.ys; // bar\n\n\n                if(!coords.noYS) path += 'm-' + yw + ',0h' + (2 * yw); // shoe\n\n                isNew = !yerror.size();\n\n                if(isNew) {\n                    yerror = errorbar.append('path')\n                        .style('vector-effect', 'non-scaling-stroke')\n                        .classed('yerror', true);\n                } else if(hasAnimation) {\n                    yerror = yerror\n                        .transition()\n                            .duration(transitionOpts.duration)\n                            .ease(transitionOpts.easing);\n                }\n\n                yerror.attr('d', path);\n            } else yerror.remove();\n\n            var xerror = errorbar.select('path.xerror');\n            if(xObj.visible && isNumeric(coords.y) &&\n                    isNumeric(coords.xh) &&\n                    isNumeric(coords.xs)) {\n                var xw = (xObj.copy_ystyle ? yObj : xObj).width;\n\n                path = 'M' + coords.xh + ',' +\n                    (coords.y - xw) + 'v' + (2 * xw) + // hat\n                    'm0,-' + xw + 'H' + coords.xs; // bar\n\n                if(!coords.noXS) path += 'm0,-' + xw + 'v' + (2 * xw); // shoe\n\n                isNew = !xerror.size();\n\n                if(isNew) {\n                    xerror = errorbar.append('path')\n                        .style('vector-effect', 'non-scaling-stroke')\n                        .classed('xerror', true);\n                } else if(hasAnimation) {\n                    xerror = xerror\n                        .transition()\n                            .duration(transitionOpts.duration)\n                            .ease(transitionOpts.easing);\n                }\n\n                xerror.attr('d', path);\n            } else xerror.remove();\n        });\n    });\n};\n\n// compute the coordinates of the error-bar objects\nfunction errorCoords(d, xa, ya) {\n    var out = {\n        x: xa.c2p(d.x),\n        y: ya.c2p(d.y)\n    };\n\n    // calculate the error bar size and hat and shoe locations\n    if(d.yh !== undefined) {\n        out.yh = ya.c2p(d.yh);\n        out.ys = ya.c2p(d.ys);\n\n        // if the shoes go off-scale (ie log scale, error bars past zero)\n        // clip the bar and hide the shoes\n        if(!isNumeric(out.ys)) {\n            out.noYS = true;\n            out.ys = ya.c2p(d.ys, true);\n        }\n    }\n\n    if(d.xh !== undefined) {\n        out.xh = xa.c2p(d.xh);\n        out.xs = xa.c2p(d.xs);\n\n        if(!isNumeric(out.xs)) {\n            out.noXS = true;\n            out.xs = xa.c2p(d.xs, true);\n        }\n    }\n\n    return out;\n}\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Color = require('../color');\n\n\nmodule.exports = function style(traces) {\n    traces.each(function(d) {\n        var trace = d[0].trace;\n        var yObj = trace.error_y || {};\n        var xObj = trace.error_x || {};\n\n        var s = d3.select(this);\n\n        s.selectAll('path.yerror')\n            .style('stroke-width', yObj.thickness + 'px')\n            .call(Color.stroke, yObj.color);\n\n        if(xObj.copy_ystyle) xObj = yObj;\n\n        s.selectAll('path.xerror')\n            .style('stroke-width', xObj.thickness + 'px')\n            .call(Color.stroke, xObj.color);\n    });\n};\n","'use strict';\n\nvar fontAttrs = require('../../plots/font_attributes');\nvar hoverLabelAttrs = require('./layout_attributes').hoverlabel;\nvar extendFlat = require('../../lib/extend').extendFlat;\n\nmodule.exports = {\n    hoverlabel: {\n        bgcolor: extendFlat({}, hoverLabelAttrs.bgcolor, {\n            arrayOk: true,\n            description: 'Sets the background color of the hover labels for this trace'\n        }),\n        bordercolor: extendFlat({}, hoverLabelAttrs.bordercolor, {\n            arrayOk: true,\n            description: 'Sets the border color of the hover labels for this trace.'\n        }),\n        font: fontAttrs({\n            arrayOk: true,\n            editType: 'none',\n            description: 'Sets the font used in hover labels.'\n        }),\n        align: extendFlat({}, hoverLabelAttrs.align, {arrayOk: true}),\n        namelength: extendFlat({}, hoverLabelAttrs.namelength, {arrayOk: true}),\n        editType: 'none'\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Registry = require('../../registry');\n\nmodule.exports = function calc(gd) {\n    var calcdata = gd.calcdata;\n    var fullLayout = gd._fullLayout;\n\n    function makeCoerceHoverInfo(trace) {\n        return function(val) {\n            return Lib.coerceHoverinfo({hoverinfo: val}, {_module: trace._module}, fullLayout);\n        };\n    }\n\n    for(var i = 0; i < calcdata.length; i++) {\n        var cd = calcdata[i];\n        var trace = cd[0].trace;\n\n        // don't include hover calc fields for pie traces\n        // as calcdata items might be sorted by value and\n        // won't match the data array order.\n        if(Registry.traceIs(trace, 'pie-like')) continue;\n\n        var fillFn = Registry.traceIs(trace, '2dMap') ? paste : Lib.fillArray;\n\n        fillFn(trace.hoverinfo, cd, 'hi', makeCoerceHoverInfo(trace));\n\n        if(trace.hovertemplate) fillFn(trace.hovertemplate, cd, 'ht');\n\n        if(!trace.hoverlabel) continue;\n\n        fillFn(trace.hoverlabel.bgcolor, cd, 'hbg');\n        fillFn(trace.hoverlabel.bordercolor, cd, 'hbc');\n        fillFn(trace.hoverlabel.font.size, cd, 'hts');\n        fillFn(trace.hoverlabel.font.color, cd, 'htc');\n        fillFn(trace.hoverlabel.font.family, cd, 'htf');\n        fillFn(trace.hoverlabel.namelength, cd, 'hnl');\n        fillFn(trace.hoverlabel.align, cd, 'hta');\n    }\n};\n\nfunction paste(traceAttr, cd, cdAttr, fn) {\n    fn = fn || Lib.identity;\n\n    if(Array.isArray(traceAttr)) {\n        cd[0][cdAttr] = fn(traceAttr);\n    }\n}\n","'use strict';\n\nvar Registry = require('../../registry');\nvar hover = require('./hover').hover;\n\nmodule.exports = function click(gd, evt, subplot) {\n    var annotationsDone = Registry.getComponentMethod('annotations', 'onClick')(gd, gd._hoverdata);\n\n    // fallback to fail-safe in case the plot type's hover method doesn't pass the subplot.\n    // Ternary, for example, didn't, but it was caught because tested.\n    if(subplot !== undefined) {\n        // The true flag at the end causes it to re-run the hover computation to figure out *which*\n        // point is being clicked. Without this, clicking is somewhat unreliable.\n        hover(gd, evt, subplot, true);\n    }\n\n    function emitClick() { gd.emit('plotly_click', {points: gd._hoverdata, event: evt}); }\n\n    if(gd._hoverdata && evt && evt.target) {\n        if(annotationsDone && annotationsDone.then) {\n            annotationsDone.then(emitClick);\n        } else emitClick();\n\n        // why do we get a double event without this???\n        if(evt.stopImmediatePropagation) evt.stopImmediatePropagation();\n    }\n};\n","'use strict';\n\nmodule.exports = {\n    // hover labels for multiple horizontal bars get tilted by this angle\n    YANGLE: 60,\n\n    // size and display constants for hover text\n\n    // pixel size of hover arrows\n    HOVERARROWSIZE: 6,\n    // pixels padding around text\n    HOVERTEXTPAD: 3,\n    // hover font\n    HOVERFONTSIZE: 13,\n    HOVERFONT: 'Arial, sans-serif',\n\n    // minimum time (msec) between hover calls\n    HOVERMINTIME: 50,\n\n    // ID suffix (with fullLayout._uid) for hover events in the throttle cache\n    HOVERID: '-hover'\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar attributes = require('./attributes');\nvar handleHoverLabelDefaults = require('./hoverlabel_defaults');\n\nmodule.exports = function supplyDefaults(traceIn, traceOut, defaultColor, layout) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(traceIn, traceOut, attributes, attr, dflt);\n    }\n\n    var opts = Lib.extendFlat({}, layout.hoverlabel);\n    if(traceOut.hovertemplate) opts.namelength = -1;\n\n    handleHoverLabelDefaults(traceIn, traceOut, coerce, opts);\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\n// look for either subplot or xaxis and yaxis attributes\n// does not handle splom case\nexports.getSubplot = function(trace) {\n    return trace.subplot || (trace.xaxis + trace.yaxis) || trace.geo;\n};\n\n// is trace in given list of subplots?\n// does handle splom case\nexports.isTraceInSubplots = function(trace, subplots) {\n    if(trace.type === 'splom') {\n        var xaxes = trace.xaxes || [];\n        var yaxes = trace.yaxes || [];\n        for(var i = 0; i < xaxes.length; i++) {\n            for(var j = 0; j < yaxes.length; j++) {\n                if(subplots.indexOf(xaxes[i] + yaxes[j]) !== -1) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n\n    return subplots.indexOf(exports.getSubplot(trace)) !== -1;\n};\n\n// convenience functions for mapping all relevant axes\nexports.flat = function(subplots, v) {\n    var out = new Array(subplots.length);\n    for(var i = 0; i < subplots.length; i++) {\n        out[i] = v;\n    }\n    return out;\n};\n\nexports.p2c = function(axArray, v) {\n    var out = new Array(axArray.length);\n    for(var i = 0; i < axArray.length; i++) {\n        out[i] = axArray[i].p2c(v);\n    }\n    return out;\n};\n\nexports.getDistanceFunction = function(mode, dx, dy, dxy) {\n    if(mode === 'closest') return dxy || exports.quadrature(dx, dy);\n    return mode.charAt(0) === 'x' ? dx : dy;\n};\n\nexports.getClosest = function(cd, distfn, pointData) {\n    // do we already have a point number? (array mode only)\n    if(pointData.index !== false) {\n        if(pointData.index >= 0 && pointData.index < cd.length) {\n            pointData.distance = 0;\n        } else pointData.index = false;\n    } else {\n        // apply the distance function to each data point\n        // this is the longest loop... if this bogs down, we may need\n        // to create pre-sorted data (by x or y), not sure how to\n        // do this for 'closest'\n        for(var i = 0; i < cd.length; i++) {\n            var newDistance = distfn(cd[i]);\n            if(newDistance <= pointData.distance) {\n                pointData.index = i;\n                pointData.distance = newDistance;\n            }\n        }\n    }\n    return pointData;\n};\n\n/*\n * pseudo-distance function for hover effects on areas: inside the region\n * distance is finite (`passVal`), outside it's Infinity.\n *\n * @param {number} v0: signed difference between the current position and the left edge\n * @param {number} v1: signed difference between the current position and the right edge\n * @param {number} passVal: the value to return on success\n */\nexports.inbox = function(v0, v1, passVal) {\n    return (v0 * v1 < 0 || v0 === 0) ? passVal : Infinity;\n};\n\nexports.quadrature = function(dx, dy) {\n    return function(di) {\n        var x = dx(di);\n        var y = dy(di);\n        return Math.sqrt(x * x + y * y);\n    };\n};\n\n/** Fill event data point object for hover and selection.\n *  Invokes _module.eventData if present.\n *\n * N.B. note that point 'index' corresponds to input data array index\n *  whereas 'number' is its post-transform version.\n *\n * If the hovered/selected pt corresponds to an multiple input points\n * (e.g. for histogram and transformed traces), 'pointNumbers` and 'pointIndices'\n * are include in the event data.\n *\n * @param {object} pt\n * @param {object} trace\n * @param {object} cd\n * @return {object}\n */\nexports.makeEventData = function(pt, trace, cd) {\n    // hover uses 'index', select uses 'pointNumber'\n    var pointNumber = 'index' in pt ? pt.index : pt.pointNumber;\n\n    var out = {\n        data: trace._input,\n        fullData: trace,\n        curveNumber: trace.index,\n        pointNumber: pointNumber\n    };\n\n    if(trace._indexToPoints) {\n        var pointIndices = trace._indexToPoints[pointNumber];\n\n        if(pointIndices.length === 1) {\n            out.pointIndex = pointIndices[0];\n        } else {\n            out.pointIndices = pointIndices;\n        }\n    } else {\n        out.pointIndex = pointNumber;\n    }\n\n    if(trace._module.eventData) {\n        out = trace._module.eventData(out, pt, trace, cd, pointNumber);\n    } else {\n        if('xVal' in pt) out.x = pt.xVal;\n        else if('x' in pt) out.x = pt.x;\n\n        if('yVal' in pt) out.y = pt.yVal;\n        else if('y' in pt) out.y = pt.y;\n\n        if(pt.xa) out.xaxis = pt.xa;\n        if(pt.ya) out.yaxis = pt.ya;\n        if(pt.zLabelVal !== undefined) out.z = pt.zLabelVal;\n    }\n\n    exports.appendArrayPointValue(out, trace, pointNumber);\n\n    return out;\n};\n\n/** Appends values inside array attributes corresponding to given point number\n *\n * @param {object} pointData : point data object (gets mutated here)\n * @param {object} trace : full trace object\n * @param {number|Array(number)} pointNumber : point number. May be a length-2 array\n *     [row, col] to dig into 2D arrays\n */\nexports.appendArrayPointValue = function(pointData, trace, pointNumber) {\n    var arrayAttrs = trace._arrayAttrs;\n\n    if(!arrayAttrs) {\n        return;\n    }\n\n    for(var i = 0; i < arrayAttrs.length; i++) {\n        var astr = arrayAttrs[i];\n        var key = getPointKey(astr);\n\n        if(pointData[key] === undefined) {\n            var val = Lib.nestedProperty(trace, astr).get();\n            var pointVal = getPointData(val, pointNumber);\n\n            if(pointVal !== undefined) pointData[key] = pointVal;\n        }\n    }\n};\n\n/**\n * Appends values inside array attributes corresponding to given point number array\n * For use when pointData references a plot entity that arose (or potentially arose)\n * from multiple points in the input data\n *\n * @param {object} pointData : point data object (gets mutated here)\n * @param {object} trace : full trace object\n * @param {Array(number)|Array(Array(number))} pointNumbers : Array of point numbers.\n *     Each entry in the array may itself be a length-2 array [row, col] to dig into 2D arrays\n */\nexports.appendArrayMultiPointValues = function(pointData, trace, pointNumbers) {\n    var arrayAttrs = trace._arrayAttrs;\n\n    if(!arrayAttrs) {\n        return;\n    }\n\n    for(var i = 0; i < arrayAttrs.length; i++) {\n        var astr = arrayAttrs[i];\n        var key = getPointKey(astr);\n\n        if(pointData[key] === undefined) {\n            var val = Lib.nestedProperty(trace, astr).get();\n            var keyVal = new Array(pointNumbers.length);\n\n            for(var j = 0; j < pointNumbers.length; j++) {\n                keyVal[j] = getPointData(val, pointNumbers[j]);\n            }\n            pointData[key] = keyVal;\n        }\n    }\n};\n\nvar pointKeyMap = {\n    ids: 'id',\n    locations: 'location',\n    labels: 'label',\n    values: 'value',\n    'marker.colors': 'color',\n    parents: 'parent'\n};\n\nfunction getPointKey(astr) {\n    return pointKeyMap[astr] || astr;\n}\n\nfunction getPointData(val, pointNumber) {\n    if(Array.isArray(pointNumber)) {\n        if(Array.isArray(val) && Array.isArray(val[pointNumber[0]])) {\n            return val[pointNumber[0]][pointNumber[1]];\n        }\n    } else {\n        return val[pointNumber];\n    }\n}\n\nvar xyHoverMode = {\n    x: true,\n    y: true\n};\n\nvar unifiedHoverMode = {\n    'x unified': true,\n    'y unified': true\n};\n\nexports.isUnifiedHover = function(hovermode) {\n    if(typeof hovermode !== 'string') return false;\n    return !!unifiedHoverMode[hovermode];\n};\n\nexports.isXYhover = function(hovermode) {\n    if(typeof hovermode !== 'string') return false;\n    return !!xyHoverMode[hovermode];\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar isNumeric = require('fast-isnumeric');\nvar tinycolor = require('tinycolor2');\n\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar strRotate = Lib.strRotate;\nvar Events = require('../../lib/events');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar overrideCursor = require('../../lib/override_cursor');\nvar Drawing = require('../drawing');\nvar Color = require('../color');\nvar dragElement = require('../dragelement');\nvar Axes = require('../../plots/cartesian/axes');\nvar Registry = require('../../registry');\n\nvar helpers = require('./helpers');\nvar constants = require('./constants');\n\nvar legendSupplyDefaults = require('../legend/defaults');\nvar legendDraw = require('../legend/draw');\n\n// hover labels for multiple horizontal bars get tilted by some angle,\n// then need to be offset differently if they overlap\nvar YANGLE = constants.YANGLE;\nvar YA_RADIANS = Math.PI * YANGLE / 180;\n\n// expansion of projected height\nvar YFACTOR = 1 / Math.sin(YA_RADIANS);\n\n// to make the appropriate post-rotation x offset,\n// you need both x and y offsets\nvar YSHIFTX = Math.cos(YA_RADIANS);\nvar YSHIFTY = Math.sin(YA_RADIANS);\n\n// size and display constants for hover text\nvar HOVERARROWSIZE = constants.HOVERARROWSIZE;\nvar HOVERTEXTPAD = constants.HOVERTEXTPAD;\n\nvar multipleHoverPoints = {\n    box: true,\n    ohlc: true,\n    violin: true,\n    candlestick: true\n};\n\n// fx.hover: highlight data on hover\n// evt can be a mousemove event, or an object with data about what points\n//   to hover on\n//      {xpx,ypx[,hovermode]} - pixel locations from top left\n//          (with optional overriding hovermode)\n//      {xval,yval[,hovermode]} - data values\n//      [{curveNumber,(pointNumber|xval and/or yval)}] -\n//              array of specific points to highlight\n//          pointNumber is a single integer if gd.data[curveNumber] is 1D,\n//              or a two-element array if it's 2D\n//          xval and yval are data values,\n//              1D data may specify either or both,\n//              2D data must specify both\n// subplot is an id string (default \"xy\")\n// makes use of gl.hovermode, which can be:\n//      x (find the points with the closest x values, ie a column),\n//      closest (find the single closest point)\n//    internally there are two more that occasionally get used:\n//      y (pick out a row - only used for multiple horizontal bar charts)\n//      array (used when the user specifies an explicit\n//          array of points to hover on)\n//\n// We wrap the hovers in a timer, to limit their frequency.\n// The actual rendering is done by private function _hover.\nexports.hover = function hover(gd, evt, subplot, noHoverEvent) {\n    gd = Lib.getGraphDiv(gd);\n\n    Lib.throttle(\n        gd._fullLayout._uid + constants.HOVERID,\n        constants.HOVERMINTIME,\n        function() { _hover(gd, evt, subplot, noHoverEvent); }\n    );\n};\n\n/*\n * Draw a single hover item or an array of hover item in a pre-existing svg container somewhere\n * hoverItem should have keys:\n *    - x and y (or x0, x1, y0, and y1):\n *      the pixel position to mark, relative to opts.container\n *    - xLabel, yLabel, zLabel, text, and name:\n *      info to go in the label\n *    - color:\n *      the background color for the label.\n *    - idealAlign (optional):\n *      'left' or 'right' for which side of the x/y box to try to put this on first\n *    - borderColor (optional):\n *      color for the border, defaults to strongest contrast with color\n *    - fontFamily (optional):\n *      string, the font for this label, defaults to constants.HOVERFONT\n *    - fontSize (optional):\n *      the label font size, defaults to constants.HOVERFONTSIZE\n *    - fontColor (optional):\n *      defaults to borderColor\n * opts should have keys:\n *    - bgColor:\n *      the background color this is against, used if the trace is\n *      non-opaque, and for the name, which goes outside the box\n *    - container:\n *      a <svg> or <g> element to add the hover label to\n *    - outerContainer:\n *      normally a parent of `container`, sets the bounding box to use to\n *      constrain the hover label and determine whether to show it on the left or right\n * opts can have optional keys:\n *    - anchorIndex:\n        the index of the hover item used as an anchor for positioning.\n        The other hover items will be pushed up or down to prevent overlap.\n */\nexports.loneHover = function loneHover(hoverItems, opts) {\n    var multiHover = true;\n    if(!Array.isArray(hoverItems)) {\n        multiHover = false;\n        hoverItems = [hoverItems];\n    }\n\n    var pointsData = hoverItems.map(function(hoverItem) {\n        return {\n            color: hoverItem.color || Color.defaultLine,\n            x0: hoverItem.x0 || hoverItem.x || 0,\n            x1: hoverItem.x1 || hoverItem.x || 0,\n            y0: hoverItem.y0 || hoverItem.y || 0,\n            y1: hoverItem.y1 || hoverItem.y || 0,\n            xLabel: hoverItem.xLabel,\n            yLabel: hoverItem.yLabel,\n            zLabel: hoverItem.zLabel,\n            text: hoverItem.text,\n            name: hoverItem.name,\n            idealAlign: hoverItem.idealAlign,\n\n            // optional extra bits of styling\n            borderColor: hoverItem.borderColor,\n            fontFamily: hoverItem.fontFamily,\n            fontSize: hoverItem.fontSize,\n            fontColor: hoverItem.fontColor,\n            nameLength: hoverItem.nameLength,\n            textAlign: hoverItem.textAlign,\n\n            // filler to make createHoverText happy\n            trace: hoverItem.trace || {\n                index: 0,\n                hoverinfo: ''\n            },\n            xa: {_offset: 0},\n            ya: {_offset: 0},\n            index: 0,\n\n            hovertemplate: hoverItem.hovertemplate || false,\n            eventData: hoverItem.eventData || false,\n            hovertemplateLabels: hoverItem.hovertemplateLabels || false,\n        };\n    });\n\n    var container3 = d3.select(opts.container);\n    var outerContainer3 = opts.outerContainer ? d3.select(opts.outerContainer) : container3;\n\n    var fullOpts = {\n        hovermode: 'closest',\n        rotateLabels: false,\n        bgColor: opts.bgColor || Color.background,\n        container: container3,\n        outerContainer: outerContainer3\n    };\n\n    var hoverLabel = createHoverText(pointsData, fullOpts, opts.gd);\n\n    // Fix vertical overlap\n    var tooltipSpacing = 5;\n    var lastBottomY = 0;\n    var anchor = 0;\n    hoverLabel\n        .sort(function(a, b) {return a.y0 - b.y0;})\n        .each(function(d, i) {\n            var topY = d.y0 - d.by / 2;\n\n            if((topY - tooltipSpacing) < lastBottomY) {\n                d.offset = (lastBottomY - topY) + tooltipSpacing;\n            } else {\n                d.offset = 0;\n            }\n\n            lastBottomY = topY + d.by + d.offset;\n\n            if(i === opts.anchorIndex || 0) anchor = d.offset;\n        })\n        .each(function(d) {\n            d.offset -= anchor;\n        });\n\n    var scaleX = opts.gd._fullLayout._invScaleX;\n    var scaleY = opts.gd._fullLayout._invScaleY;\n    alignHoverText(hoverLabel, fullOpts.rotateLabels, scaleX, scaleY);\n\n    return multiHover ? hoverLabel : hoverLabel.node();\n};\n\n// The actual implementation is here:\nfunction _hover(gd, evt, subplot, noHoverEvent) {\n    if(!subplot) subplot = 'xy';\n\n    // if the user passed in an array of subplots,\n    // use those instead of finding overlayed plots\n    var subplots = Array.isArray(subplot) ? subplot : [subplot];\n\n    var fullLayout = gd._fullLayout;\n    var plots = fullLayout._plots || [];\n    var plotinfo = plots[subplot];\n    var hasCartesian = fullLayout._has('cartesian');\n\n    // list of all overlaid subplots to look at\n    if(plotinfo) {\n        var overlayedSubplots = plotinfo.overlays.map(function(pi) {\n            return pi.id;\n        });\n\n        subplots = subplots.concat(overlayedSubplots);\n    }\n\n    var len = subplots.length;\n    var xaArray = new Array(len);\n    var yaArray = new Array(len);\n    var supportsCompare = false;\n\n    for(var i = 0; i < len; i++) {\n        var spId = subplots[i];\n\n        if(plots[spId]) {\n            // 'cartesian' case\n            supportsCompare = true;\n            xaArray[i] = plots[spId].xaxis;\n            yaArray[i] = plots[spId].yaxis;\n        } else if(fullLayout[spId] && fullLayout[spId]._subplot) {\n            // other subplot types\n            var _subplot = fullLayout[spId]._subplot;\n            xaArray[i] = _subplot.xaxis;\n            yaArray[i] = _subplot.yaxis;\n        } else {\n            Lib.warn('Unrecognized subplot: ' + spId);\n            return;\n        }\n    }\n\n    var hovermode = evt.hovermode || fullLayout.hovermode;\n\n    if(hovermode && !supportsCompare) hovermode = 'closest';\n\n    if(['x', 'y', 'closest', 'x unified', 'y unified'].indexOf(hovermode) === -1 || !gd.calcdata ||\n            gd.querySelector('.zoombox') || gd._dragging) {\n        return dragElement.unhoverRaw(gd, evt);\n    }\n\n    var hoverdistance = fullLayout.hoverdistance;\n    if(hoverdistance === -1) hoverdistance = Infinity;\n\n    var spikedistance = fullLayout.spikedistance;\n    if(spikedistance === -1) spikedistance = Infinity;\n\n    // hoverData: the set of candidate points we've found to highlight\n    var hoverData = [];\n\n    // searchData: the data to search in. Mostly this is just a copy of\n    // gd.calcdata, filtered to the subplot and overlays we're on\n    // but if a point array is supplied it will be a mapping\n    // of indicated curves\n    var searchData = [];\n\n    // [x|y]valArray: the axis values of the hover event\n    // mapped onto each of the currently selected overlaid subplots\n    var xvalArray, yvalArray;\n\n    var itemnum, curvenum, cd, trace, subplotId, subploti, _mode,\n        xval, yval, pointData, closedataPreviousLength;\n\n    // spikePoints: the set of candidate points we've found to draw spikes to\n    var spikePoints = {\n        hLinePoint: null,\n        vLinePoint: null\n    };\n\n    // does subplot have one (or more) horizontal traces?\n    // This is used to determine whether we rotate the labels or not\n    var hasOneHorizontalTrace = false;\n\n    // Figure out what we're hovering on:\n    // mouse location or user-supplied data\n\n    if(Array.isArray(evt)) {\n        // user specified an array of points to highlight\n        hovermode = 'array';\n        for(itemnum = 0; itemnum < evt.length; itemnum++) {\n            cd = gd.calcdata[evt[itemnum].curveNumber || 0];\n            if(cd) {\n                trace = cd[0].trace;\n                if(cd[0].trace.hoverinfo !== 'skip') {\n                    searchData.push(cd);\n                    if(trace.orientation === 'h') {\n                        hasOneHorizontalTrace = true;\n                    }\n                }\n            }\n        }\n    } else {\n        for(curvenum = 0; curvenum < gd.calcdata.length; curvenum++) {\n            cd = gd.calcdata[curvenum];\n            trace = cd[0].trace;\n            if(trace.hoverinfo !== 'skip' && helpers.isTraceInSubplots(trace, subplots)) {\n                searchData.push(cd);\n                if(trace.orientation === 'h') {\n                    hasOneHorizontalTrace = true;\n                }\n            }\n        }\n\n        // [x|y]px: the pixels (from top left) of the mouse location\n        // on the currently selected plot area\n        // add pointerX|Y property for drawing the spikes in spikesnap 'cursor' situation\n        var hasUserCalledHover = !evt.target;\n        var xpx, ypx;\n\n        if(hasUserCalledHover) {\n            if('xpx' in evt) xpx = evt.xpx;\n            else xpx = xaArray[0]._length / 2;\n\n            if('ypx' in evt) ypx = evt.ypx;\n            else ypx = yaArray[0]._length / 2;\n        } else {\n            // fire the beforehover event and quit if it returns false\n            // note that we're only calling this on real mouse events, so\n            // manual calls to fx.hover will always run.\n            if(Events.triggerHandler(gd, 'plotly_beforehover', evt) === false) {\n                return;\n            }\n\n            // Discover event target, traversing open shadow roots.\n            var target = evt.composedPath && evt.composedPath()[0];\n            if(!target) {\n                // Fallback for browsers not supporting composedPath\n                target = evt.target;\n            }\n            var dbb = target.getBoundingClientRect();\n\n            xpx = evt.clientX - dbb.left;\n            ypx = evt.clientY - dbb.top;\n\n            fullLayout._calcInverseTransform(gd);\n            var transformedCoords = Lib.apply3DTransform(fullLayout._invTransform)(xpx, ypx);\n\n            xpx = transformedCoords[0];\n            ypx = transformedCoords[1];\n\n            // in case hover was called from mouseout into hovertext,\n            // it's possible you're not actually over the plot anymore\n            if(xpx < 0 || xpx > xaArray[0]._length || ypx < 0 || ypx > yaArray[0]._length) {\n                return dragElement.unhoverRaw(gd, evt);\n            }\n        }\n\n        evt.pointerX = xpx + xaArray[0]._offset;\n        evt.pointerY = ypx + yaArray[0]._offset;\n\n        if('xval' in evt) xvalArray = helpers.flat(subplots, evt.xval);\n        else xvalArray = helpers.p2c(xaArray, xpx);\n\n        if('yval' in evt) yvalArray = helpers.flat(subplots, evt.yval);\n        else yvalArray = helpers.p2c(yaArray, ypx);\n\n        if(!isNumeric(xvalArray[0]) || !isNumeric(yvalArray[0])) {\n            Lib.warn('Fx.hover failed', evt, gd);\n            return dragElement.unhoverRaw(gd, evt);\n        }\n    }\n\n    // the pixel distance to beat as a matching point\n    // in 'x' or 'y' mode this resets for each trace\n    var distance = Infinity;\n\n    // find the closest point in each trace\n    // this is minimum dx and/or dy, depending on mode\n    // and the pixel position for the label (labelXpx, labelYpx)\n    function findHoverPoints(customXVal, customYVal) {\n        for(curvenum = 0; curvenum < searchData.length; curvenum++) {\n            cd = searchData[curvenum];\n\n            // filter out invisible or broken data\n            if(!cd || !cd[0] || !cd[0].trace) continue;\n\n            trace = cd[0].trace;\n\n            if(trace.visible !== true || trace._length === 0) continue;\n\n            // Explicitly bail out for these two. I don't know how to otherwise prevent\n            // the rest of this function from running and failing\n            if(['carpet', 'contourcarpet'].indexOf(trace._module.name) !== -1) continue;\n\n            if(trace.type === 'splom') {\n                // splom traces do not generate overlay subplots,\n                // it is safe to assume here splom traces correspond to the 0th subplot\n                subploti = 0;\n                subplotId = subplots[subploti];\n            } else {\n                subplotId = helpers.getSubplot(trace);\n                subploti = subplots.indexOf(subplotId);\n            }\n\n            // within one trace mode can sometimes be overridden\n            _mode = hovermode;\n            if(helpers.isUnifiedHover(_mode)) {\n                _mode = _mode.charAt(0);\n            }\n\n            // container for new point, also used to pass info into module.hoverPoints\n            pointData = {\n                // trace properties\n                cd: cd,\n                trace: trace,\n                xa: xaArray[subploti],\n                ya: yaArray[subploti],\n\n                // max distances for hover and spikes - for points that want to show but do not\n                // want to override other points, set distance/spikeDistance equal to max*Distance\n                // and it will not get filtered out but it will be guaranteed to have a greater\n                // distance than any point that calculated a real distance.\n                maxHoverDistance: hoverdistance,\n                maxSpikeDistance: spikedistance,\n\n                // point properties - override all of these\n                index: false, // point index in trace - only used by plotly.js hoverdata consumers\n                distance: Math.min(distance, hoverdistance), // pixel distance or pseudo-distance\n\n                // distance/pseudo-distance for spikes. This distance should always be calculated\n                // as if in \"closest\" mode, and should only be set if this point should\n                // generate a spike.\n                spikeDistance: Infinity,\n\n                // in some cases the spikes have different positioning from the hover label\n                // they don't need x0/x1, just one position\n                xSpike: undefined,\n                ySpike: undefined,\n\n                // where and how to display the hover label\n                color: Color.defaultLine, // trace color\n                name: trace.name,\n                x0: undefined,\n                x1: undefined,\n                y0: undefined,\n                y1: undefined,\n                xLabelVal: undefined,\n                yLabelVal: undefined,\n                zLabelVal: undefined,\n                text: undefined\n            };\n\n            // add ref to subplot object (non-cartesian case)\n            if(fullLayout[subplotId]) {\n                pointData.subplot = fullLayout[subplotId]._subplot;\n            }\n            // add ref to splom scene\n            if(fullLayout._splomScenes && fullLayout._splomScenes[trace.uid]) {\n                pointData.scene = fullLayout._splomScenes[trace.uid];\n            }\n\n            closedataPreviousLength = hoverData.length;\n\n            // for a highlighting array, figure out what\n            // we're searching for with this element\n            if(_mode === 'array') {\n                var selection = evt[curvenum];\n                if('pointNumber' in selection) {\n                    pointData.index = selection.pointNumber;\n                    _mode = 'closest';\n                } else {\n                    _mode = '';\n                    if('xval' in selection) {\n                        xval = selection.xval;\n                        _mode = 'x';\n                    }\n                    if('yval' in selection) {\n                        yval = selection.yval;\n                        _mode = _mode ? 'closest' : 'y';\n                    }\n                }\n            } else if(customXVal !== undefined && customYVal !== undefined) {\n                xval = customXVal;\n                yval = customYVal;\n            } else {\n                xval = xvalArray[subploti];\n                yval = yvalArray[subploti];\n            }\n\n            // Now if there is range to look in, find the points to hover.\n            if(hoverdistance !== 0) {\n                if(trace._module && trace._module.hoverPoints) {\n                    var newPoints = trace._module.hoverPoints(pointData, xval, yval, _mode, {\n                        finiteRange: true,\n                        hoverLayer: fullLayout._hoverlayer\n                    });\n\n                    if(newPoints) {\n                        var newPoint;\n                        for(var newPointNum = 0; newPointNum < newPoints.length; newPointNum++) {\n                            newPoint = newPoints[newPointNum];\n                            if(isNumeric(newPoint.x0) && isNumeric(newPoint.y0)) {\n                                hoverData.push(cleanPoint(newPoint, hovermode));\n                            }\n                        }\n                    }\n                } else {\n                    Lib.log('Unrecognized trace type in hover:', trace);\n                }\n            }\n\n            // in closest mode, remove any existing (farther) points\n            // and don't look any farther than this latest point (or points, some\n            // traces like box & violin make multiple hover labels at once)\n            if(hovermode === 'closest' && hoverData.length > closedataPreviousLength) {\n                hoverData.splice(0, closedataPreviousLength);\n                distance = hoverData[0].distance;\n            }\n\n            // Now if there is range to look in, find the points to draw the spikelines\n            // Do it only if there is no hoverData\n            if(hasCartesian && (spikedistance !== 0)) {\n                if(hoverData.length === 0) {\n                    pointData.distance = spikedistance;\n                    pointData.index = false;\n                    var closestPoints = trace._module.hoverPoints(pointData, xval, yval, 'closest', {\n                        hoverLayer: fullLayout._hoverlayer\n                    });\n                    if(closestPoints) {\n                        closestPoints = closestPoints.filter(function(point) {\n                            // some hover points, like scatter fills, do not allow spikes,\n                            // so will generate a hover point but without a valid spikeDistance\n                            return point.spikeDistance <= spikedistance;\n                        });\n                    }\n                    if(closestPoints && closestPoints.length) {\n                        var tmpPoint;\n                        var closestVPoints = closestPoints.filter(function(point) {\n                            return point.xa.showspikes && point.xa.spikesnap !== 'hovered data';\n                        });\n                        if(closestVPoints.length) {\n                            var closestVPt = closestVPoints[0];\n                            if(isNumeric(closestVPt.x0) && isNumeric(closestVPt.y0)) {\n                                tmpPoint = fillSpikePoint(closestVPt);\n                                if(!spikePoints.vLinePoint || (spikePoints.vLinePoint.spikeDistance > tmpPoint.spikeDistance)) {\n                                    spikePoints.vLinePoint = tmpPoint;\n                                }\n                            }\n                        }\n\n                        var closestHPoints = closestPoints.filter(function(point) {\n                            return point.ya.showspikes && point.ya.spikesnap !== 'hovered data';\n                        });\n                        if(closestHPoints.length) {\n                            var closestHPt = closestHPoints[0];\n                            if(isNumeric(closestHPt.x0) && isNumeric(closestHPt.y0)) {\n                                tmpPoint = fillSpikePoint(closestHPt);\n                                if(!spikePoints.hLinePoint || (spikePoints.hLinePoint.spikeDistance > tmpPoint.spikeDistance)) {\n                                    spikePoints.hLinePoint = tmpPoint;\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    findHoverPoints();\n\n    function selectClosestPoint(pointsData, spikedistance) {\n        var resultPoint = null;\n        var minDistance = Infinity;\n        var thisSpikeDistance;\n        for(var i = 0; i < pointsData.length; i++) {\n            thisSpikeDistance = pointsData[i].spikeDistance;\n            if(thisSpikeDistance <= minDistance && thisSpikeDistance <= spikedistance) {\n                resultPoint = pointsData[i];\n                minDistance = thisSpikeDistance;\n            }\n        }\n        return resultPoint;\n    }\n\n    function fillSpikePoint(point) {\n        if(!point) return null;\n        return {\n            xa: point.xa,\n            ya: point.ya,\n            x: point.xSpike !== undefined ? point.xSpike : (point.x0 + point.x1) / 2,\n            y: point.ySpike !== undefined ? point.ySpike : (point.y0 + point.y1) / 2,\n            distance: point.distance,\n            spikeDistance: point.spikeDistance,\n            curveNumber: point.trace.index,\n            color: point.color,\n            pointNumber: point.index\n        };\n    }\n\n    var spikelineOpts = {\n        fullLayout: fullLayout,\n        container: fullLayout._hoverlayer,\n        outerContainer: fullLayout._paperdiv,\n        event: evt\n    };\n    var oldspikepoints = gd._spikepoints;\n    var newspikepoints = {\n        vLinePoint: spikePoints.vLinePoint,\n        hLinePoint: spikePoints.hLinePoint\n    };\n    gd._spikepoints = newspikepoints;\n\n    // Now if it is not restricted by spikedistance option, set the points to draw the spikelines\n    if(hasCartesian && (spikedistance !== 0)) {\n        if(hoverData.length !== 0) {\n            var tmpHPointData = hoverData.filter(function(point) {\n                return point.ya.showspikes;\n            });\n            var tmpHPoint = selectClosestPoint(tmpHPointData, spikedistance);\n            spikePoints.hLinePoint = fillSpikePoint(tmpHPoint);\n\n            var tmpVPointData = hoverData.filter(function(point) {\n                return point.xa.showspikes;\n            });\n            var tmpVPoint = selectClosestPoint(tmpVPointData, spikedistance);\n            spikePoints.vLinePoint = fillSpikePoint(tmpVPoint);\n        }\n    }\n\n    // if hoverData is empty check for the spikes to draw and quit if there are none\n    if(hoverData.length === 0) {\n        var result = dragElement.unhoverRaw(gd, evt);\n        if(hasCartesian && ((spikePoints.hLinePoint !== null) || (spikePoints.vLinePoint !== null))) {\n            if(spikesChanged(oldspikepoints)) {\n                createSpikelines(gd, spikePoints, spikelineOpts);\n            }\n        }\n        return result;\n    }\n\n    if(hasCartesian) {\n        if(spikesChanged(oldspikepoints)) {\n            createSpikelines(gd, spikePoints, spikelineOpts);\n        }\n    }\n\n    var sortHoverData = function() {\n        hoverData.sort(function(d1, d2) { return d1.distance - d2.distance; });\n\n        // move period positioned points and box/bar-like traces to the end of the list\n        hoverData = orderRangePoints(hoverData, hovermode);\n    };\n    sortHoverData();\n\n    if(\n        helpers.isXYhover(_mode) &&\n        hoverData[0].length !== 0 &&\n        hoverData[0].trace.type !== 'splom' // TODO: add support for splom\n    ) {\n        // pick winning point\n        var winningPoint = hoverData[0];\n        // discard other points\n        if(multipleHoverPoints[winningPoint.trace.type]) {\n            hoverData = hoverData.filter(function(d) {\n                return d.trace.index === winningPoint.trace.index;\n            });\n        } else {\n            hoverData = [winningPoint];\n        }\n        var initLen = hoverData.length;\n\n        var winX = getCoord('x', winningPoint, fullLayout);\n        var winY = getCoord('y', winningPoint, fullLayout);\n\n        // in compare mode, select every point at position\n        findHoverPoints(winX, winY);\n\n        var finalPoints = [];\n        var seen = {};\n        var id = 0;\n        var insert = function(newHd) {\n            var key = multipleHoverPoints[newHd.trace.type] ? hoverDataKey(newHd) : newHd.trace.index;\n            if(!seen[key]) {\n                id++;\n                seen[key] = id;\n                finalPoints.push(newHd);\n            } else {\n                var oldId = seen[key] - 1;\n                var oldHd = finalPoints[oldId];\n                if(oldId > 0 &&\n                    Math.abs(newHd.distance) <\n                    Math.abs(oldHd.distance)\n                ) {\n                    // replace with closest\n                    finalPoints[oldId] = newHd;\n                }\n            }\n        };\n\n        var k;\n        // insert the winnig point(s) first\n        for(k = 0; k < initLen; k++) {\n            insert(hoverData[k]);\n        }\n        // override from the end\n        for(k = hoverData.length - 1; k > initLen - 1; k--) {\n            insert(hoverData[k]);\n        }\n        hoverData = finalPoints;\n        sortHoverData();\n    }\n\n    // lastly, emit custom hover/unhover events\n    var oldhoverdata = gd._hoverdata;\n    var newhoverdata = [];\n\n    // pull out just the data that's useful to\n    // other people and send it to the event\n    for(itemnum = 0; itemnum < hoverData.length; itemnum++) {\n        var pt = hoverData[itemnum];\n        var eventData = helpers.makeEventData(pt, pt.trace, pt.cd);\n\n        if(pt.hovertemplate !== false) {\n            var ht = false;\n            if(pt.cd[pt.index] && pt.cd[pt.index].ht) {\n                ht = pt.cd[pt.index].ht;\n            }\n            pt.hovertemplate = ht || pt.trace.hovertemplate || false;\n        }\n\n        pt.eventData = [eventData];\n        newhoverdata.push(eventData);\n    }\n\n    gd._hoverdata = newhoverdata;\n\n    var rotateLabels = (\n        (hovermode === 'y' && (searchData.length > 1 || hoverData.length > 1)) ||\n        (hovermode === 'closest' && hasOneHorizontalTrace && hoverData.length > 1)\n    );\n\n    var bgColor = Color.combine(\n        fullLayout.plot_bgcolor || Color.background,\n        fullLayout.paper_bgcolor\n    );\n\n    var labelOpts = {\n        hovermode: hovermode,\n        rotateLabels: rotateLabels,\n        bgColor: bgColor,\n        container: fullLayout._hoverlayer,\n        outerContainer: fullLayout._paperdiv,\n        commonLabelOpts: fullLayout.hoverlabel,\n        hoverdistance: fullLayout.hoverdistance\n    };\n\n    var hoverLabels = createHoverText(hoverData, labelOpts, gd);\n\n    if(!helpers.isUnifiedHover(hovermode)) {\n        hoverAvoidOverlaps(hoverLabels, rotateLabels ? 'xa' : 'ya', fullLayout);\n        alignHoverText(hoverLabels, rotateLabels, fullLayout._invScaleX, fullLayout._invScaleY);\n    }    // TODO: tagName hack is needed to appease geo.js's hack of using evt.target=true\n    // we should improve the \"fx\" API so other plots can use it without these hack.\n    if(evt.target && evt.target.tagName) {\n        var hasClickToShow = Registry.getComponentMethod('annotations', 'hasClickToShow')(gd, newhoverdata);\n        overrideCursor(d3.select(evt.target), hasClickToShow ? 'pointer' : '');\n    }\n\n    // don't emit events if called manually\n    if(!evt.target || noHoverEvent || !hoverChanged(gd, evt, oldhoverdata)) return;\n\n    if(oldhoverdata) {\n        gd.emit('plotly_unhover', {\n            event: evt,\n            points: oldhoverdata\n        });\n    }\n\n    gd.emit('plotly_hover', {\n        event: evt,\n        points: gd._hoverdata,\n        xaxes: xaArray,\n        yaxes: yaArray,\n        xvals: xvalArray,\n        yvals: yvalArray\n    });\n}\n\nfunction hoverDataKey(d) {\n    return [d.trace.index, d.index, d.x0, d.y0, d.name, d.attr, d.xa, d.ya || ''].join(',');\n}\n\nvar EXTRA_STRING_REGEX = /<extra>([\\s\\S]*)<\\/extra>/;\n\nfunction createHoverText(hoverData, opts, gd) {\n    var fullLayout = gd._fullLayout;\n    var hovermode = opts.hovermode;\n    var rotateLabels = opts.rotateLabels;\n    var bgColor = opts.bgColor;\n    var container = opts.container;\n    var outerContainer = opts.outerContainer;\n    var commonLabelOpts = opts.commonLabelOpts || {};\n\n    // opts.fontFamily/Size are used for the common label\n    // and as defaults for each hover label, though the individual labels\n    // can override this.\n    var fontFamily = opts.fontFamily || constants.HOVERFONT;\n    var fontSize = opts.fontSize || constants.HOVERFONTSIZE;\n\n    var c0 = hoverData[0];\n    var xa = c0.xa;\n    var ya = c0.ya;\n    var axLetter = hovermode.charAt(0);\n    var t0 = c0[axLetter + 'Label'];\n    var outerContainerBB = outerContainer.node().getBoundingClientRect();\n    var outerTop = outerContainerBB.top;\n    var outerWidth = outerContainerBB.width;\n    var outerHeight = outerContainerBB.height;\n\n    // show the common label, if any, on the axis\n    // never show a common label in array mode,\n    // even if sometimes there could be one\n    var showCommonLabel = (\n        (t0 !== undefined) &&\n        (c0.distance <= opts.hoverdistance) &&\n        (hovermode === 'x' || hovermode === 'y')\n    );\n\n    // all hover traces hoverinfo must contain the hovermode\n    // to have common labels\n    if(showCommonLabel) {\n        var allHaveZ = true;\n        var i, traceHoverinfo;\n        for(i = 0; i < hoverData.length; i++) {\n            if(allHaveZ && hoverData[i].zLabel === undefined) allHaveZ = false;\n\n            traceHoverinfo = hoverData[i].hoverinfo || hoverData[i].trace.hoverinfo;\n            if(traceHoverinfo) {\n                var parts = Array.isArray(traceHoverinfo) ? traceHoverinfo : traceHoverinfo.split('+');\n                if(parts.indexOf('all') === -1 &&\n                    parts.indexOf(hovermode) === -1) {\n                    showCommonLabel = false;\n                    break;\n                }\n            }\n        }\n\n        // xyz labels put all info in their main label, so have no need of a common label\n        if(allHaveZ) showCommonLabel = false;\n    }\n\n    var commonLabel = container.selectAll('g.axistext')\n        .data(showCommonLabel ? [0] : []);\n    commonLabel.enter().append('g')\n        .classed('axistext', true);\n    commonLabel.exit().remove();\n\n    commonLabel.each(function() {\n        var label = d3.select(this);\n        var lpath = Lib.ensureSingle(label, 'path', '', function(s) {\n            s.style({'stroke-width': '1px'});\n        });\n        var ltext = Lib.ensureSingle(label, 'text', '', function(s) {\n            // prohibit tex interpretation until we can handle\n            // tex and regular text together\n            s.attr('data-notex', 1);\n        });\n\n        var commonBgColor = commonLabelOpts.bgcolor || Color.defaultLine;\n        var commonStroke = commonLabelOpts.bordercolor || Color.contrast(commonBgColor);\n        var contrastColor = Color.contrast(commonBgColor);\n        var commonLabelFont = {\n            family: commonLabelOpts.font.family || fontFamily,\n            size: commonLabelOpts.font.size || fontSize,\n            color: commonLabelOpts.font.color || contrastColor\n        };\n\n        lpath.style({\n            fill: commonBgColor,\n            stroke: commonStroke\n        });\n\n        ltext.text(t0)\n            .call(Drawing.font, commonLabelFont)\n            .call(svgTextUtils.positionText, 0, 0)\n            .call(svgTextUtils.convertToTspans, gd);\n\n        label.attr('transform', '');\n\n        var tbb = ltext.node().getBoundingClientRect();\n        var lx, ly;\n\n        if(hovermode === 'x') {\n            var topsign = xa.side === 'top' ? '-' : '';\n\n            ltext.attr('text-anchor', 'middle')\n                .call(svgTextUtils.positionText, 0, (xa.side === 'top' ?\n                    (outerTop - tbb.bottom - HOVERARROWSIZE - HOVERTEXTPAD) :\n                    (outerTop - tbb.top + HOVERARROWSIZE + HOVERTEXTPAD)));\n\n            lx = xa._offset + (c0.x0 + c0.x1) / 2;\n            ly = ya._offset + (xa.side === 'top' ? 0 : ya._length);\n\n            var halfWidth = tbb.width / 2 + HOVERTEXTPAD;\n\n            if(lx < halfWidth) {\n                lx = halfWidth;\n\n                lpath.attr('d', 'M-' + (halfWidth - HOVERARROWSIZE) + ',0' +\n                    'L-' + (halfWidth - HOVERARROWSIZE * 2) + ',' + topsign + HOVERARROWSIZE +\n                    'H' + (HOVERTEXTPAD + tbb.width / 2) +\n                    'v' + topsign + (HOVERTEXTPAD * 2 + tbb.height) +\n                    'H-' + halfWidth +\n                    'V' + topsign + HOVERARROWSIZE +\n                    'Z');\n            } else if(lx > (fullLayout.width - halfWidth)) {\n                lx = fullLayout.width - halfWidth;\n\n                lpath.attr('d', 'M' + (halfWidth - HOVERARROWSIZE) + ',0' +\n                    'L' + halfWidth + ',' + topsign + HOVERARROWSIZE +\n                    'v' + topsign + (HOVERTEXTPAD * 2 + tbb.height) +\n                    'H-' + halfWidth +\n                    'V' + topsign + HOVERARROWSIZE +\n                    'H' + (halfWidth - HOVERARROWSIZE * 2) + 'Z');\n            } else {\n                lpath.attr('d', 'M0,0' +\n                    'L' + HOVERARROWSIZE + ',' + topsign + HOVERARROWSIZE +\n                    'H' + (HOVERTEXTPAD + tbb.width / 2) +\n                    'v' + topsign + (HOVERTEXTPAD * 2 + tbb.height) +\n                    'H-' + (HOVERTEXTPAD + tbb.width / 2) +\n                    'V' + topsign + HOVERARROWSIZE +\n                    'H-' + HOVERARROWSIZE + 'Z');\n            }\n        } else {\n            var anchor;\n            var sgn;\n            var leftsign;\n            if(ya.side === 'right') {\n                anchor = 'start';\n                sgn = 1;\n                leftsign = '';\n                lx = xa._offset + xa._length;\n            } else {\n                anchor = 'end';\n                sgn = -1;\n                leftsign = '-';\n                lx = xa._offset;\n            }\n\n            ly = ya._offset + (c0.y0 + c0.y1) / 2;\n\n            ltext.attr('text-anchor', anchor);\n\n            lpath.attr('d', 'M0,0' +\n                'L' + leftsign + HOVERARROWSIZE + ',' + HOVERARROWSIZE +\n                'V' + (HOVERTEXTPAD + tbb.height / 2) +\n                'h' + leftsign + (HOVERTEXTPAD * 2 + tbb.width) +\n                'V-' + (HOVERTEXTPAD + tbb.height / 2) +\n                'H' + leftsign + HOVERARROWSIZE + 'V-' + HOVERARROWSIZE + 'Z');\n\n            var halfHeight = tbb.height / 2;\n            var lty = outerTop - tbb.top - halfHeight;\n            var clipId = 'clip' + fullLayout._uid + 'commonlabel' + ya._id;\n            var clipPath;\n\n            if(lx < (tbb.width + 2 * HOVERTEXTPAD + HOVERARROWSIZE)) {\n                clipPath = 'M-' + (HOVERARROWSIZE + HOVERTEXTPAD) + '-' + halfHeight +\n                    'h-' + (tbb.width - HOVERTEXTPAD) +\n                    'V' + halfHeight +\n                    'h' + (tbb.width - HOVERTEXTPAD) + 'Z';\n\n                var ltx = tbb.width - lx + HOVERTEXTPAD;\n                svgTextUtils.positionText(ltext, ltx, lty);\n\n                // shift each line (except the longest) so that start-of-line\n                // is always visible\n                if(anchor === 'end') {\n                    ltext.selectAll('tspan').each(function() {\n                        var s = d3.select(this);\n                        var dummy = Drawing.tester.append('text')\n                            .text(s.text())\n                            .call(Drawing.font, commonLabelFont);\n                        var dummyBB = dummy.node().getBoundingClientRect();\n                        if(Math.round(dummyBB.width) < Math.round(tbb.width)) {\n                            s.attr('x', ltx - dummyBB.width);\n                        }\n                        dummy.remove();\n                    });\n                }\n            } else {\n                svgTextUtils.positionText(ltext, sgn * (HOVERTEXTPAD + HOVERARROWSIZE), lty);\n                clipPath = null;\n            }\n\n            var textClip = fullLayout._topclips.selectAll('#' + clipId).data(clipPath ? [0] : []);\n            textClip.enter().append('clipPath').attr('id', clipId).append('path');\n            textClip.exit().remove();\n            textClip.select('path').attr('d', clipPath);\n            Drawing.setClipUrl(ltext, clipPath ? clipId : null, gd);\n        }\n\n        label.attr('transform', strTranslate(lx, ly));\n    });\n\n    // Show a single hover label\n    if(helpers.isUnifiedHover(hovermode)) {\n        // Delete leftover hover labels from other hovermodes\n        container.selectAll('g.hovertext').remove();\n\n        // Return early if nothing is hovered on\n        if(hoverData.length === 0) return;\n\n        // mock legend\n        var mockLayoutIn = {\n            showlegend: true,\n            legend: {\n                title: {text: t0, font: fullLayout.hoverlabel.font},\n                font: fullLayout.hoverlabel.font,\n                bgcolor: fullLayout.hoverlabel.bgcolor,\n                bordercolor: fullLayout.hoverlabel.bordercolor,\n                borderwidth: 1,\n                tracegroupgap: 7,\n                traceorder: fullLayout.legend ? fullLayout.legend.traceorder : undefined,\n                orientation: 'v'\n            }\n        };\n        var mockLayoutOut = {};\n        legendSupplyDefaults(mockLayoutIn, mockLayoutOut, gd._fullData);\n        var mockLegend = mockLayoutOut.legend;\n\n        // prepare items for the legend\n        mockLegend.entries = [];\n        for(var j = 0; j < hoverData.length; j++) {\n            var texts = getHoverLabelText(hoverData[j], true, hovermode, fullLayout, t0);\n            var text = texts[0];\n            var name = texts[1];\n            var pt = hoverData[j];\n            pt.name = name;\n            if(name !== '') {\n                pt.text = name + ' : ' + text;\n            } else {\n                pt.text = text;\n            }\n\n            // pass through marker's calcdata to style legend items\n            var cd = pt.cd[pt.index];\n            if(cd) {\n                if(cd.mc) pt.mc = cd.mc;\n                if(cd.mcc) pt.mc = cd.mcc;\n                if(cd.mlc) pt.mlc = cd.mlc;\n                if(cd.mlcc) pt.mlc = cd.mlcc;\n                if(cd.mlw) pt.mlw = cd.mlw;\n                if(cd.mrc) pt.mrc = cd.mrc;\n                if(cd.dir) pt.dir = cd.dir;\n            }\n            pt._distinct = true;\n\n            mockLegend.entries.push([pt]);\n        }\n        mockLegend.entries.sort(function(a, b) { return a[0].trace.index - b[0].trace.index;});\n        mockLegend.layer = container;\n\n        // Draw unified hover label\n        mockLegend._inHover = true;\n        legendDraw(gd, mockLegend);\n\n        // Position the hover\n        var winningPoint = hoverData[0];\n        var ly = (winningPoint.y0 + winningPoint.y1) / 2;\n        var lx = (winningPoint.x0 + winningPoint.x1) / 2;\n        var legendContainer = container.select('g.legend');\n        var tbb = legendContainer.node().getBoundingClientRect();\n        lx += xa._offset;\n        ly += ya._offset - tbb.height / 2;\n\n        // Change horizontal alignment to end up on screen\n        var txWidth = tbb.width + 2 * HOVERTEXTPAD;\n        var anchorStartOK = lx + txWidth <= outerWidth;\n        var anchorEndOK = lx - txWidth >= 0;\n        if(!anchorStartOK && anchorEndOK) {\n            lx -= txWidth;\n        } else {\n            lx += 2 * HOVERTEXTPAD;\n        }\n\n        // Change vertical alignement to end up on screen\n        var txHeight = tbb.height + 2 * HOVERTEXTPAD;\n        var overflowTop = ly <= outerTop;\n        var overflowBottom = ly + txHeight >= outerHeight;\n        var canFit = txHeight <= outerHeight;\n        if(canFit) {\n            if(overflowTop) {\n                ly = ya._offset + 2 * HOVERTEXTPAD;\n            } else if(overflowBottom) {\n                ly = outerHeight - txHeight;\n            }\n        }\n        legendContainer.attr('transform', strTranslate(lx, ly));\n\n        return legendContainer;\n    }\n\n    // show all the individual labels\n\n    // first create the objects\n    var hoverLabels = container.selectAll('g.hovertext')\n        .data(hoverData, function(d) {\n            // N.B. when multiple items have the same result key-function value,\n            // only the first of those items in hoverData gets rendered\n            return hoverDataKey(d);\n        });\n    hoverLabels.enter().append('g')\n        .classed('hovertext', true)\n        .each(function() {\n            var g = d3.select(this);\n            // trace name label (rect and text.name)\n            g.append('rect')\n                .call(Color.fill, Color.addOpacity(bgColor, 0.8));\n            g.append('text').classed('name', true);\n            // trace data label (path and text.nums)\n            g.append('path')\n                .style('stroke-width', '1px');\n            g.append('text').classed('nums', true)\n                .call(Drawing.font, fontFamily, fontSize);\n        });\n    hoverLabels.exit().remove();\n\n    // then put the text in, position the pointer to the data,\n    // and figure out sizes\n    hoverLabels.each(function(d) {\n        var g = d3.select(this).attr('transform', '');\n\n        var dColor = d.color;\n        if(Array.isArray(dColor)) {\n            dColor = dColor[d.eventData[0].pointNumber];\n        }\n\n        // combine possible non-opaque trace color with bgColor\n        var color0 = d.bgcolor || dColor;\n        // color for 'nums' part of the label\n        var numsColor = Color.combine(\n            Color.opacity(color0) ? color0 : Color.defaultLine,\n            bgColor\n        );\n        // color for 'name' part of the label\n        var nameColor = Color.combine(\n            Color.opacity(dColor) ? dColor : Color.defaultLine,\n            bgColor\n        );\n        // find a contrasting color for border and text\n        var contrastColor = d.borderColor || Color.contrast(numsColor);\n\n        var texts = getHoverLabelText(d, showCommonLabel, hovermode, fullLayout, t0, g);\n        var text = texts[0];\n        var name = texts[1];\n\n        // main label\n        var tx = g.select('text.nums')\n            .call(Drawing.font,\n                d.fontFamily || fontFamily,\n                d.fontSize || fontSize,\n                d.fontColor || contrastColor)\n            .text(text)\n            .attr('data-notex', 1)\n            .call(svgTextUtils.positionText, 0, 0)\n            .call(svgTextUtils.convertToTspans, gd);\n\n        var tx2 = g.select('text.name');\n        var tx2width = 0;\n        var tx2height = 0;\n\n        // secondary label for non-empty 'name'\n        if(name && name !== text) {\n            tx2.call(Drawing.font,\n                    d.fontFamily || fontFamily,\n                    d.fontSize || fontSize,\n                    nameColor)\n                .text(name)\n                .attr('data-notex', 1)\n                .call(svgTextUtils.positionText, 0, 0)\n                .call(svgTextUtils.convertToTspans, gd);\n\n            var t2bb = tx2.node().getBoundingClientRect();\n            tx2width = t2bb.width + 2 * HOVERTEXTPAD;\n            tx2height = t2bb.height + 2 * HOVERTEXTPAD;\n        } else {\n            tx2.remove();\n            g.select('rect').remove();\n        }\n\n        g.select('path').style({\n            fill: numsColor,\n            stroke: contrastColor\n        });\n\n        var tbb = tx.node().getBoundingClientRect();\n        var htx = d.xa._offset + (d.x0 + d.x1) / 2;\n        var hty = d.ya._offset + (d.y0 + d.y1) / 2;\n        var dx = Math.abs(d.x1 - d.x0);\n        var dy = Math.abs(d.y1 - d.y0);\n        var txTotalWidth = tbb.width + HOVERARROWSIZE + HOVERTEXTPAD + tx2width;\n        var anchorStartOK, anchorEndOK;\n\n        d.ty0 = outerTop - tbb.top;\n        d.bx = tbb.width + 2 * HOVERTEXTPAD;\n        d.by = Math.max(tbb.height + 2 * HOVERTEXTPAD, tx2height);\n        d.anchor = 'start';\n        d.txwidth = tbb.width;\n        d.tx2width = tx2width;\n        d.offset = 0;\n\n        if(rotateLabels) {\n            d.pos = htx;\n            anchorStartOK = hty + dy / 2 + txTotalWidth <= outerHeight;\n            anchorEndOK = hty - dy / 2 - txTotalWidth >= 0;\n            if((d.idealAlign === 'top' || !anchorStartOK) && anchorEndOK) {\n                hty -= dy / 2;\n                d.anchor = 'end';\n            } else if(anchorStartOK) {\n                hty += dy / 2;\n                d.anchor = 'start';\n            } else d.anchor = 'middle';\n        } else {\n            d.pos = hty;\n            anchorStartOK = htx + dx / 2 + txTotalWidth <= outerWidth;\n            anchorEndOK = htx - dx / 2 - txTotalWidth >= 0;\n\n            if((d.idealAlign === 'left' || !anchorStartOK) && anchorEndOK) {\n                htx -= dx / 2;\n                d.anchor = 'end';\n            } else if(anchorStartOK) {\n                htx += dx / 2;\n                d.anchor = 'start';\n            } else {\n                d.anchor = 'middle';\n\n                var txHalfWidth = txTotalWidth / 2;\n                var overflowR = htx + txHalfWidth - outerWidth;\n                var overflowL = htx - txHalfWidth;\n                if(overflowR > 0) htx -= overflowR;\n                if(overflowL < 0) htx += -overflowL;\n            }\n        }\n\n        tx.attr('text-anchor', d.anchor);\n        if(tx2width) tx2.attr('text-anchor', d.anchor);\n        g.attr('transform', strTranslate(htx, hty) +\n            (rotateLabels ? strRotate(YANGLE) : ''));\n    });\n\n    return hoverLabels;\n}\n\nfunction getHoverLabelText(d, showCommonLabel, hovermode, fullLayout, t0, g) {\n    var name = '';\n    var text = '';\n    // to get custom 'name' labels pass cleanPoint\n    if(d.nameOverride !== undefined) d.name = d.nameOverride;\n\n    if(d.name) {\n        if(d.trace._meta) {\n            d.name = Lib.templateString(d.name, d.trace._meta);\n        }\n        name = plainText(d.name, d.nameLength);\n    }\n\n    var h0 = hovermode.charAt(0);\n    var h1 = h0 === 'x' ? 'y' : 'x';\n\n    if(d.zLabel !== undefined) {\n        if(d.xLabel !== undefined) text += 'x: ' + d.xLabel + '<br>';\n        if(d.yLabel !== undefined) text += 'y: ' + d.yLabel + '<br>';\n        if(d.trace.type !== 'choropleth' && d.trace.type !== 'choroplethmapbox') {\n            text += (text ? 'z: ' : '') + d.zLabel;\n        }\n    } else if(showCommonLabel && d[h0 + 'Label'] === t0) {\n        text = d[h1 + 'Label'] || '';\n    } else if(d.xLabel === undefined) {\n        if(d.yLabel !== undefined && d.trace.type !== 'scattercarpet') {\n            text = d.yLabel;\n        }\n    } else if(d.yLabel === undefined) text = d.xLabel;\n    else text = '(' + d.xLabel + ', ' + d.yLabel + ')';\n\n    if((d.text || d.text === 0) && !Array.isArray(d.text)) {\n        text += (text ? '<br>' : '') + d.text;\n    }\n\n    // used by other modules (initially just ternary) that\n    // manage their own hoverinfo independent of cleanPoint\n    // the rest of this will still apply, so such modules\n    // can still put things in (x|y|z)Label, text, and name\n    // and hoverinfo will still determine their visibility\n    if(d.extraText !== undefined) text += (text ? '<br>' : '') + d.extraText;\n\n    // if 'text' is empty at this point,\n    // and hovertemplate is not defined,\n    // put 'name' in main label and don't show secondary label\n    if(g && text === '' && !d.hovertemplate) {\n        // if 'name' is also empty, remove entire label\n        if(name === '') g.remove();\n        text = name;\n    }\n\n    // hovertemplate\n    var hovertemplate = d.hovertemplate || false;\n    if(hovertemplate) {\n        var labels = d.hovertemplateLabels || d;\n\n        if(d[h0 + 'Label'] !== t0) {\n            labels[h0 + 'other'] = labels[h0 + 'Val'];\n            labels[h0 + 'otherLabel'] = labels[h0 + 'Label'];\n        }\n\n        text = Lib.hovertemplateString(\n            hovertemplate,\n            labels,\n            fullLayout._d3locale,\n            d.eventData[0] || {},\n            d.trace._meta\n        );\n\n        text = text.replace(EXTRA_STRING_REGEX, function(match, extra) {\n            // assign name for secondary text label\n            name = plainText(extra, d.nameLength);\n            // remove from main text label\n            return '';\n        });\n    }\n    return [text, name];\n}\n\n// Make groups of touching points, and within each group\n// move each point so that no labels overlap, but the average\n// label position is the same as it was before moving. Incidentally,\n// this is equivalent to saying all the labels are on equal linear\n// springs about their initial position. Initially, each point is\n// its own group, but as we find overlaps we will clump the points.\n//\n// Also, there are hard constraints at the edges of the graphs,\n// that push all groups to the middle so they are visible. I don't\n// know what happens if the group spans all the way from one edge to\n// the other, though it hardly matters - there's just too much\n// information then.\nfunction hoverAvoidOverlaps(hoverLabels, axKey, fullLayout) {\n    var nummoves = 0;\n    var axSign = 1;\n    var nLabels = hoverLabels.size();\n\n    // make groups of touching points\n    var pointgroups = new Array(nLabels);\n    var k = 0;\n\n    hoverLabels.each(function(d) {\n        var ax = d[axKey];\n        var axIsX = ax._id.charAt(0) === 'x';\n        var rng = ax.range;\n\n        if(k === 0 && rng && ((rng[0] > rng[1]) !== axIsX)) {\n            axSign = -1;\n        }\n        pointgroups[k++] = [{\n            datum: d,\n            traceIndex: d.trace.index,\n            dp: 0,\n            pos: d.pos,\n            posref: d.posref,\n            size: d.by * (axIsX ? YFACTOR : 1) / 2,\n            pmin: 0,\n            pmax: (axIsX ? fullLayout.width : fullLayout.height)\n        }];\n    });\n\n    pointgroups.sort(function(a, b) {\n        return (a[0].posref - b[0].posref) ||\n            // for equal positions, sort trace indices increasing or decreasing\n            // depending on whether the axis is reversed or not... so stacked\n            // traces will generally keep their order even if one trace adds\n            // nothing to the stack.\n            (axSign * (b[0].traceIndex - a[0].traceIndex));\n    });\n\n    var donepositioning, topOverlap, bottomOverlap, i, j, pti, sumdp;\n\n    function constrainGroup(grp) {\n        var minPt = grp[0];\n        var maxPt = grp[grp.length - 1];\n\n        // overlap with the top - positive vals are overlaps\n        topOverlap = minPt.pmin - minPt.pos - minPt.dp + minPt.size;\n\n        // overlap with the bottom - positive vals are overlaps\n        bottomOverlap = maxPt.pos + maxPt.dp + maxPt.size - minPt.pmax;\n\n        // check for min overlap first, so that we always\n        // see the largest labels\n        // allow for .01px overlap, so we don't get an\n        // infinite loop from rounding errors\n        if(topOverlap > 0.01) {\n            for(j = grp.length - 1; j >= 0; j--) grp[j].dp += topOverlap;\n            donepositioning = false;\n        }\n        if(bottomOverlap < 0.01) return;\n        if(topOverlap < -0.01) {\n            // make sure we're not pushing back and forth\n            for(j = grp.length - 1; j >= 0; j--) grp[j].dp -= bottomOverlap;\n            donepositioning = false;\n        }\n        if(!donepositioning) return;\n\n        // no room to fix positioning, delete off-screen points\n\n        // first see how many points we need to delete\n        var deleteCount = 0;\n        for(i = 0; i < grp.length; i++) {\n            pti = grp[i];\n            if(pti.pos + pti.dp + pti.size > minPt.pmax) deleteCount++;\n        }\n\n        // start by deleting points whose data is off screen\n        for(i = grp.length - 1; i >= 0; i--) {\n            if(deleteCount <= 0) break;\n            pti = grp[i];\n\n            // pos has already been constrained to [pmin,pmax]\n            // so look for points close to that to delete\n            if(pti.pos > minPt.pmax - 1) {\n                pti.del = true;\n                deleteCount--;\n            }\n        }\n        for(i = 0; i < grp.length; i++) {\n            if(deleteCount <= 0) break;\n            pti = grp[i];\n\n            // pos has already been constrained to [pmin,pmax]\n            // so look for points close to that to delete\n            if(pti.pos < minPt.pmin + 1) {\n                pti.del = true;\n                deleteCount--;\n\n                // shift the whole group minus into this new space\n                bottomOverlap = pti.size * 2;\n                for(j = grp.length - 1; j >= 0; j--) grp[j].dp -= bottomOverlap;\n            }\n        }\n        // then delete points that go off the bottom\n        for(i = grp.length - 1; i >= 0; i--) {\n            if(deleteCount <= 0) break;\n            pti = grp[i];\n            if(pti.pos + pti.dp + pti.size > minPt.pmax) {\n                pti.del = true;\n                deleteCount--;\n            }\n        }\n    }\n\n    // loop through groups, combining them if they overlap,\n    // until nothing moves\n    while(!donepositioning && nummoves <= nLabels) {\n        // to avoid infinite loops, don't move more times\n        // than there are traces\n        nummoves++;\n\n        // assume nothing will move in this iteration,\n        // reverse this if it does\n        donepositioning = true;\n        i = 0;\n        while(i < pointgroups.length - 1) {\n            // the higher (g0) and lower (g1) point group\n            var g0 = pointgroups[i];\n            var g1 = pointgroups[i + 1];\n\n            // the lowest point in the higher group (p0)\n            // the highest point in the lower group (p1)\n            var p0 = g0[g0.length - 1];\n            var p1 = g1[0];\n            topOverlap = p0.pos + p0.dp + p0.size - p1.pos - p1.dp + p1.size;\n\n            // Only group points that lie on the same axes\n            if(topOverlap > 0.01 && (p0.pmin === p1.pmin) && (p0.pmax === p1.pmax)) {\n                // push the new point(s) added to this group out of the way\n                for(j = g1.length - 1; j >= 0; j--) g1[j].dp += topOverlap;\n\n                // add them to the group\n                g0.push.apply(g0, g1);\n                pointgroups.splice(i + 1, 1);\n\n                // adjust for minimum average movement\n                sumdp = 0;\n                for(j = g0.length - 1; j >= 0; j--) sumdp += g0[j].dp;\n                bottomOverlap = sumdp / g0.length;\n                for(j = g0.length - 1; j >= 0; j--) g0[j].dp -= bottomOverlap;\n                donepositioning = false;\n            } else i++;\n        }\n\n        // check if we're going off the plot on either side and fix\n        pointgroups.forEach(constrainGroup);\n    }\n\n    // now put these offsets into hoverData\n    for(i = pointgroups.length - 1; i >= 0; i--) {\n        var grp = pointgroups[i];\n        for(j = grp.length - 1; j >= 0; j--) {\n            var pt = grp[j];\n            var hoverPt = pt.datum;\n            hoverPt.offset = pt.dp;\n            hoverPt.del = pt.del;\n        }\n    }\n}\n\nfunction alignHoverText(hoverLabels, rotateLabels, scaleX, scaleY) {\n    var pX = function(x) { return x * scaleX; };\n    var pY = function(y) { return y * scaleY; };\n\n    // finally set the text positioning relative to the data and draw the\n    // box around it\n    hoverLabels.each(function(d) {\n        var g = d3.select(this);\n        if(d.del) return g.remove();\n\n        var tx = g.select('text.nums');\n        var anchor = d.anchor;\n        var horzSign = anchor === 'end' ? -1 : 1;\n        var alignShift = {start: 1, end: -1, middle: 0}[anchor];\n        var txx = alignShift * (HOVERARROWSIZE + HOVERTEXTPAD);\n        var tx2x = txx + alignShift * (d.txwidth + HOVERTEXTPAD);\n        var offsetX = 0;\n        var offsetY = d.offset;\n\n        var isMiddle = anchor === 'middle';\n        if(isMiddle) {\n            txx -= d.tx2width / 2;\n            tx2x += d.txwidth / 2 + HOVERTEXTPAD;\n        }\n        if(rotateLabels) {\n            offsetY *= -YSHIFTY;\n            offsetX = d.offset * YSHIFTX;\n        }\n\n        g.select('path')\n            .attr('d', isMiddle ?\n            // middle aligned: rect centered on data\n            ('M-' + pX(d.bx / 2 + d.tx2width / 2) + ',' + pY(offsetY - d.by / 2) +\n              'h' + pX(d.bx) + 'v' + pY(d.by) + 'h-' + pX(d.bx) + 'Z') :\n            // left or right aligned: side rect with arrow to data\n            ('M0,0L' + pX(horzSign * HOVERARROWSIZE + offsetX) + ',' + pY(HOVERARROWSIZE + offsetY) +\n                'v' + pY(d.by / 2 - HOVERARROWSIZE) +\n                'h' + pX(horzSign * d.bx) +\n                'v-' + pY(d.by) +\n                'H' + pX(horzSign * HOVERARROWSIZE + offsetX) +\n                'V' + pY(offsetY - HOVERARROWSIZE) +\n                'Z'));\n\n        var posX = offsetX + txx;\n        var posY = offsetY + d.ty0 - d.by / 2 + HOVERTEXTPAD;\n        var textAlign = d.textAlign || 'auto';\n\n        if(textAlign !== 'auto') {\n            if(textAlign === 'left' && anchor !== 'start') {\n                tx.attr('text-anchor', 'start');\n                posX = isMiddle ?\n                    -d.bx / 2 - d.tx2width / 2 + HOVERTEXTPAD :\n                    -d.bx - HOVERTEXTPAD;\n            } else if(textAlign === 'right' && anchor !== 'end') {\n                tx.attr('text-anchor', 'end');\n                posX = isMiddle ?\n                    d.bx / 2 - d.tx2width / 2 - HOVERTEXTPAD :\n                    d.bx + HOVERTEXTPAD;\n            }\n        }\n\n        tx.call(svgTextUtils.positionText, pX(posX), pY(posY));\n\n        if(d.tx2width) {\n            g.select('text.name')\n                .call(svgTextUtils.positionText,\n                    pX(tx2x + alignShift * HOVERTEXTPAD + offsetX),\n                    pY(offsetY + d.ty0 - d.by / 2 + HOVERTEXTPAD));\n            g.select('rect')\n                .call(Drawing.setRect,\n                    pX(tx2x + (alignShift - 1) * d.tx2width / 2 + offsetX),\n                    pY(offsetY - d.by / 2 - 1),\n                    pX(d.tx2width), pY(d.by + 2));\n        }\n    });\n}\n\nfunction cleanPoint(d, hovermode) {\n    var index = d.index;\n    var trace = d.trace || {};\n    var cd0 = d.cd[0];\n    var cd = d.cd[index] || {};\n\n    function pass(v) {\n        return v || (isNumeric(v) && v === 0);\n    }\n\n    var getVal = Array.isArray(index) ?\n        function(calcKey, traceKey) {\n            var v = Lib.castOption(cd0, index, calcKey);\n            return pass(v) ? v : Lib.extractOption({}, trace, '', traceKey);\n        } :\n        function(calcKey, traceKey) {\n            return Lib.extractOption(cd, trace, calcKey, traceKey);\n        };\n\n    function fill(key, calcKey, traceKey) {\n        var val = getVal(calcKey, traceKey);\n        if(pass(val)) d[key] = val;\n    }\n\n    fill('hoverinfo', 'hi', 'hoverinfo');\n    fill('bgcolor', 'hbg', 'hoverlabel.bgcolor');\n    fill('borderColor', 'hbc', 'hoverlabel.bordercolor');\n    fill('fontFamily', 'htf', 'hoverlabel.font.family');\n    fill('fontSize', 'hts', 'hoverlabel.font.size');\n    fill('fontColor', 'htc', 'hoverlabel.font.color');\n    fill('nameLength', 'hnl', 'hoverlabel.namelength');\n    fill('textAlign', 'hta', 'hoverlabel.align');\n\n    d.posref = (hovermode === 'y' || (hovermode === 'closest' && trace.orientation === 'h')) ?\n        (d.xa._offset + (d.x0 + d.x1) / 2) :\n        (d.ya._offset + (d.y0 + d.y1) / 2);\n\n    // then constrain all the positions to be on the plot\n    d.x0 = Lib.constrain(d.x0, 0, d.xa._length);\n    d.x1 = Lib.constrain(d.x1, 0, d.xa._length);\n    d.y0 = Lib.constrain(d.y0, 0, d.ya._length);\n    d.y1 = Lib.constrain(d.y1, 0, d.ya._length);\n\n    // and convert the x and y label values into formatted text\n    if(d.xLabelVal !== undefined) {\n        d.xLabel = ('xLabel' in d) ? d.xLabel : Axes.hoverLabelText(d.xa, d.xLabelVal, trace.xhoverformat);\n        d.xVal = d.xa.c2d(d.xLabelVal);\n    }\n    if(d.yLabelVal !== undefined) {\n        d.yLabel = ('yLabel' in d) ? d.yLabel : Axes.hoverLabelText(d.ya, d.yLabelVal, trace.yhoverformat);\n        d.yVal = d.ya.c2d(d.yLabelVal);\n    }\n\n    // Traces like heatmaps generate the zLabel in their hoverPoints function\n    if(d.zLabelVal !== undefined && d.zLabel === undefined) {\n        d.zLabel = String(d.zLabelVal);\n    }\n\n    // for box means and error bars, add the range to the label\n    if(!isNaN(d.xerr) && !(d.xa.type === 'log' && d.xerr <= 0)) {\n        var xeText = Axes.tickText(d.xa, d.xa.c2l(d.xerr), 'hover').text;\n        if(d.xerrneg !== undefined) {\n            d.xLabel += ' +' + xeText + ' / -' +\n                Axes.tickText(d.xa, d.xa.c2l(d.xerrneg), 'hover').text;\n        } else d.xLabel += '  ' + xeText;\n\n        // small distance penalty for error bars, so that if there are\n        // traces with errors and some without, the error bar label will\n        // hoist up to the point\n        if(hovermode === 'x') d.distance += 1;\n    }\n    if(!isNaN(d.yerr) && !(d.ya.type === 'log' && d.yerr <= 0)) {\n        var yeText = Axes.tickText(d.ya, d.ya.c2l(d.yerr), 'hover').text;\n        if(d.yerrneg !== undefined) {\n            d.yLabel += ' +' + yeText + ' / -' +\n                Axes.tickText(d.ya, d.ya.c2l(d.yerrneg), 'hover').text;\n        } else d.yLabel += '  ' + yeText;\n\n        if(hovermode === 'y') d.distance += 1;\n    }\n\n    var infomode = d.hoverinfo || d.trace.hoverinfo;\n\n    if(infomode && infomode !== 'all') {\n        infomode = Array.isArray(infomode) ? infomode : infomode.split('+');\n        if(infomode.indexOf('x') === -1) d.xLabel = undefined;\n        if(infomode.indexOf('y') === -1) d.yLabel = undefined;\n        if(infomode.indexOf('z') === -1) d.zLabel = undefined;\n        if(infomode.indexOf('text') === -1) d.text = undefined;\n        if(infomode.indexOf('name') === -1) d.name = undefined;\n    }\n\n    return d;\n}\n\nfunction createSpikelines(gd, closestPoints, opts) {\n    var container = opts.container;\n    var fullLayout = opts.fullLayout;\n    var gs = fullLayout._size;\n    var evt = opts.event;\n    var showY = !!closestPoints.hLinePoint;\n    var showX = !!closestPoints.vLinePoint;\n\n    var xa, ya;\n\n    // Remove old spikeline items\n    container.selectAll('.spikeline').remove();\n\n    if(!(showX || showY)) return;\n\n    var contrastColor = Color.combine(fullLayout.plot_bgcolor, fullLayout.paper_bgcolor);\n\n    // Horizontal line (to y-axis)\n    if(showY) {\n        var hLinePoint = closestPoints.hLinePoint;\n        var hLinePointX, hLinePointY;\n\n        xa = hLinePoint && hLinePoint.xa;\n        ya = hLinePoint && hLinePoint.ya;\n        var ySnap = ya.spikesnap;\n\n        if(ySnap === 'cursor') {\n            hLinePointX = evt.pointerX;\n            hLinePointY = evt.pointerY;\n        } else {\n            hLinePointX = xa._offset + hLinePoint.x;\n            hLinePointY = ya._offset + hLinePoint.y;\n        }\n        var dfltHLineColor = tinycolor.readability(hLinePoint.color, contrastColor) < 1.5 ?\n            Color.contrast(contrastColor) : hLinePoint.color;\n        var yMode = ya.spikemode;\n        var yThickness = ya.spikethickness;\n        var yColor = ya.spikecolor || dfltHLineColor;\n        var xEdge = Axes.getPxPosition(gd, ya);\n        var xBase, xEndSpike;\n\n        if(yMode.indexOf('toaxis') !== -1 || yMode.indexOf('across') !== -1) {\n            if(yMode.indexOf('toaxis') !== -1) {\n                xBase = xEdge;\n                xEndSpike = hLinePointX;\n            }\n            if(yMode.indexOf('across') !== -1) {\n                var xAcross0 = ya._counterDomainMin;\n                var xAcross1 = ya._counterDomainMax;\n                if(ya.anchor === 'free') {\n                    xAcross0 = Math.min(xAcross0, ya.position);\n                    xAcross1 = Math.max(xAcross1, ya.position);\n                }\n                xBase = gs.l + xAcross0 * gs.w;\n                xEndSpike = gs.l + xAcross1 * gs.w;\n            }\n\n            // Foreground horizontal line (to y-axis)\n            container.insert('line', ':first-child')\n                .attr({\n                    x1: xBase,\n                    x2: xEndSpike,\n                    y1: hLinePointY,\n                    y2: hLinePointY,\n                    'stroke-width': yThickness,\n                    stroke: yColor,\n                    'stroke-dasharray': Drawing.dashStyle(ya.spikedash, yThickness)\n                })\n                .classed('spikeline', true)\n                .classed('crisp', true);\n\n            // Background horizontal Line (to y-axis)\n            container.insert('line', ':first-child')\n                .attr({\n                    x1: xBase,\n                    x2: xEndSpike,\n                    y1: hLinePointY,\n                    y2: hLinePointY,\n                    'stroke-width': yThickness + 2,\n                    stroke: contrastColor\n                })\n                .classed('spikeline', true)\n                .classed('crisp', true);\n        }\n        // Y axis marker\n        if(yMode.indexOf('marker') !== -1) {\n            container.insert('circle', ':first-child')\n                .attr({\n                    cx: xEdge + (ya.side !== 'right' ? yThickness : -yThickness),\n                    cy: hLinePointY,\n                    r: yThickness,\n                    fill: yColor\n                })\n                .classed('spikeline', true);\n        }\n    }\n\n    if(showX) {\n        var vLinePoint = closestPoints.vLinePoint;\n        var vLinePointX, vLinePointY;\n\n        xa = vLinePoint && vLinePoint.xa;\n        ya = vLinePoint && vLinePoint.ya;\n        var xSnap = xa.spikesnap;\n\n        if(xSnap === 'cursor') {\n            vLinePointX = evt.pointerX;\n            vLinePointY = evt.pointerY;\n        } else {\n            vLinePointX = xa._offset + vLinePoint.x;\n            vLinePointY = ya._offset + vLinePoint.y;\n        }\n        var dfltVLineColor = tinycolor.readability(vLinePoint.color, contrastColor) < 1.5 ?\n            Color.contrast(contrastColor) : vLinePoint.color;\n        var xMode = xa.spikemode;\n        var xThickness = xa.spikethickness;\n        var xColor = xa.spikecolor || dfltVLineColor;\n        var yEdge = Axes.getPxPosition(gd, xa);\n        var yBase, yEndSpike;\n\n        if(xMode.indexOf('toaxis') !== -1 || xMode.indexOf('across') !== -1) {\n            if(xMode.indexOf('toaxis') !== -1) {\n                yBase = yEdge;\n                yEndSpike = vLinePointY;\n            }\n            if(xMode.indexOf('across') !== -1) {\n                var yAcross0 = xa._counterDomainMin;\n                var yAcross1 = xa._counterDomainMax;\n                if(xa.anchor === 'free') {\n                    yAcross0 = Math.min(yAcross0, xa.position);\n                    yAcross1 = Math.max(yAcross1, xa.position);\n                }\n                yBase = gs.t + (1 - yAcross1) * gs.h;\n                yEndSpike = gs.t + (1 - yAcross0) * gs.h;\n            }\n\n            // Foreground vertical line (to x-axis)\n            container.insert('line', ':first-child')\n                .attr({\n                    x1: vLinePointX,\n                    x2: vLinePointX,\n                    y1: yBase,\n                    y2: yEndSpike,\n                    'stroke-width': xThickness,\n                    stroke: xColor,\n                    'stroke-dasharray': Drawing.dashStyle(xa.spikedash, xThickness)\n                })\n                .classed('spikeline', true)\n                .classed('crisp', true);\n\n            // Background vertical line (to x-axis)\n            container.insert('line', ':first-child')\n                .attr({\n                    x1: vLinePointX,\n                    x2: vLinePointX,\n                    y1: yBase,\n                    y2: yEndSpike,\n                    'stroke-width': xThickness + 2,\n                    stroke: contrastColor\n                })\n                .classed('spikeline', true)\n                .classed('crisp', true);\n        }\n\n        // X axis marker\n        if(xMode.indexOf('marker') !== -1) {\n            container.insert('circle', ':first-child')\n                .attr({\n                    cx: vLinePointX,\n                    cy: yEdge - (xa.side !== 'top' ? xThickness : -xThickness),\n                    r: xThickness,\n                    fill: xColor\n                })\n                .classed('spikeline', true);\n        }\n    }\n}\n\nfunction hoverChanged(gd, evt, oldhoverdata) {\n    // don't emit any events if nothing changed\n    if(!oldhoverdata || oldhoverdata.length !== gd._hoverdata.length) return true;\n\n    for(var i = oldhoverdata.length - 1; i >= 0; i--) {\n        var oldPt = oldhoverdata[i];\n        var newPt = gd._hoverdata[i];\n\n        if(oldPt.curveNumber !== newPt.curveNumber ||\n            String(oldPt.pointNumber) !== String(newPt.pointNumber) ||\n            String(oldPt.pointNumbers) !== String(newPt.pointNumbers)\n        ) {\n            return true;\n        }\n    }\n    return false;\n}\n\nfunction spikesChanged(gd, oldspikepoints) {\n    // don't relayout the plot because of new spikelines if spikelines points didn't change\n    if(!oldspikepoints) return true;\n    if(oldspikepoints.vLinePoint !== gd._spikepoints.vLinePoint ||\n        oldspikepoints.hLinePoint !== gd._spikepoints.hLinePoint\n    ) return true;\n    return false;\n}\n\nfunction plainText(s, len) {\n    return svgTextUtils.plainText(s || '', {\n        len: len,\n        allowedTags: ['br', 'sub', 'sup', 'b', 'i', 'em']\n    });\n}\n\nfunction orderRangePoints(hoverData, hovermode) {\n    var axLetter = hovermode.charAt(0);\n\n    var first = [];\n    var second = [];\n    var last = [];\n\n    for(var i = 0; i < hoverData.length; i++) {\n        var d = hoverData[i];\n\n        if(\n            Registry.traceIs(d.trace, 'bar-like') ||\n            Registry.traceIs(d.trace, 'box-violin')\n        ) {\n            last.push(d);\n        } else if(d.trace[axLetter + 'period']) {\n            second.push(d);\n        } else {\n            first.push(d);\n        }\n    }\n\n    return first.concat(second).concat(last);\n}\n\nfunction getCoord(axLetter, winningPoint, fullLayout) {\n    var ax = winningPoint[axLetter + 'a'];\n    var val = winningPoint[axLetter + 'Val'];\n\n    if(ax.type === 'category') val = ax._categoriesMap[val];\n    else if(ax.type === 'date') val = ax.d2c(val);\n\n    var cd0 = winningPoint.cd[winningPoint.index];\n    if(cd0 && cd0.t && cd0.t.posLetter === ax._id) {\n        if(\n            fullLayout.boxmode === 'group' ||\n            fullLayout.violinmode === 'group'\n        ) {\n            val += cd0.t.dPos;\n        }\n    }\n\n    return val;\n}\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Color = require('../color');\nvar isUnifiedHover = require('./helpers').isUnifiedHover;\n\nmodule.exports = function handleHoverLabelDefaults(contIn, contOut, coerce, opts) {\n    opts = opts || {};\n\n    function inheritFontAttr(attr) {\n        if(!opts.font[attr]) {\n            opts.font[attr] = contOut.legend ? contOut.legend.font[attr] : contOut.font[attr];\n        }\n    }\n\n    // In unified hover, inherit from layout.legend if available or layout\n    if(contOut && isUnifiedHover(contOut.hovermode)) {\n        if(!opts.font) opts.font = {};\n        inheritFontAttr('size');\n        inheritFontAttr('family');\n        inheritFontAttr('color');\n\n        if(contOut.legend) {\n            if(!opts.bgcolor) opts.bgcolor = Color.combine(contOut.legend.bgcolor, contOut.paper_bgcolor);\n            if(!opts.bordercolor) opts.bordercolor = contOut.legend.bordercolor;\n        } else {\n            if(!opts.bgcolor) opts.bgcolor = contOut.paper_bgcolor;\n        }\n    }\n\n    coerce('hoverlabel.bgcolor', opts.bgcolor);\n    coerce('hoverlabel.bordercolor', opts.bordercolor);\n    coerce('hoverlabel.namelength', opts.namelength);\n    Lib.coerceFont(coerce, 'hoverlabel.font', opts.font);\n    coerce('hoverlabel.align', opts.align);\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar layoutAttributes = require('./layout_attributes');\n\nmodule.exports = function handleHoverModeDefaults(layoutIn, layoutOut) {\n    function coerce(attr, dflt) {\n        // don't coerce if it is already coerced in other place e.g. in cartesian defaults\n        if(layoutOut[attr] !== undefined) return layoutOut[attr];\n\n        return Lib.coerce(layoutIn, layoutOut, layoutAttributes, attr, dflt);\n    }\n\n    coerce('clickmode');\n    return coerce('hovermode');\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar Lib = require('../../lib');\nvar dragElement = require('../dragelement');\nvar helpers = require('./helpers');\nvar layoutAttributes = require('./layout_attributes');\nvar hoverModule = require('./hover');\n\nmodule.exports = {\n    moduleType: 'component',\n    name: 'fx',\n\n    constants: require('./constants'),\n    schema: {\n        layout: layoutAttributes\n    },\n\n    attributes: require('./attributes'),\n    layoutAttributes: layoutAttributes,\n\n    supplyLayoutGlobalDefaults: require('./layout_global_defaults'),\n    supplyDefaults: require('./defaults'),\n    supplyLayoutDefaults: require('./layout_defaults'),\n\n    calc: require('./calc'),\n\n    getDistanceFunction: helpers.getDistanceFunction,\n    getClosest: helpers.getClosest,\n    inbox: helpers.inbox,\n    quadrature: helpers.quadrature,\n    appendArrayPointValue: helpers.appendArrayPointValue,\n\n    castHoverOption: castHoverOption,\n    castHoverinfo: castHoverinfo,\n\n    hover: hoverModule.hover,\n    unhover: dragElement.unhover,\n\n    loneHover: hoverModule.loneHover,\n    loneUnhover: loneUnhover,\n\n    click: require('./click')\n};\n\nfunction loneUnhover(containerOrSelection) {\n    // duck type whether the arg is a d3 selection because ie9 doesn't\n    // handle instanceof like modern browsers do.\n    var selection = Lib.isD3Selection(containerOrSelection) ?\n            containerOrSelection :\n            d3.select(containerOrSelection);\n\n    selection.selectAll('g.hovertext').remove();\n    selection.selectAll('.spikeline').remove();\n}\n\n// helpers for traces that use Fx.loneHover\n\nfunction castHoverOption(trace, ptNumber, attr) {\n    return Lib.castOption(trace, ptNumber, 'hoverlabel.' + attr);\n}\n\nfunction castHoverinfo(trace, fullLayout, ptNumber) {\n    function _coerce(val) {\n        return Lib.coerceHoverinfo({hoverinfo: val}, {_module: trace._module}, fullLayout);\n    }\n\n    return Lib.castOption(trace, ptNumber, 'hoverinfo', _coerce);\n}\n","'use strict';\n\nvar constants = require('./constants');\n\nvar fontAttrs = require('../../plots/font_attributes')({\n    editType: 'none',\n    description: 'Sets the default hover label font used by all traces on the graph.'\n});\nfontAttrs.family.dflt = constants.HOVERFONT;\nfontAttrs.size.dflt = constants.HOVERFONTSIZE;\n\nmodule.exports = {\n    clickmode: {\n        valType: 'flaglist',\n        flags: ['event', 'select'],\n        dflt: 'event',\n        editType: 'plot',\n        extras: ['none'],\n        description: [\n            'Determines the mode of single click interactions.',\n            '*event* is the default value and emits the `plotly_click`',\n            'event. In addition this mode emits the `plotly_selected` event',\n            'in drag modes *lasso* and *select*, but with no event data attached',\n            '(kept for compatibility reasons).',\n            'The *select* flag enables selecting single',\n            'data points via click. This mode also supports persistent selections,',\n            'meaning that pressing Shift while clicking, adds to / subtracts from an',\n            'existing selection. *select* with `hovermode`: *x* can be confusing, consider',\n            'explicitly setting `hovermode`: *closest* when using this feature.',\n            'Selection events are sent accordingly as long as *event* flag is set as well.',\n            'When the *event* flag is missing, `plotly_click` and `plotly_selected`',\n            'events are not fired.'\n        ].join(' ')\n    },\n    dragmode: {\n        valType: 'enumerated',\n        values: [\n            'zoom',\n            'pan',\n            'select',\n            'lasso',\n            'drawclosedpath',\n            'drawopenpath',\n            'drawline',\n            'drawrect',\n            'drawcircle',\n            'orbit',\n            'turntable',\n            false\n        ],\n        dflt: 'zoom',\n        editType: 'modebar',\n        description: [\n            'Determines the mode of drag interactions.',\n            '*select* and *lasso* apply only to scatter traces with',\n            'markers or text. *orbit* and *turntable* apply only to',\n            '3D scenes.'\n        ].join(' ')\n    },\n    hovermode: {\n        valType: 'enumerated',\n        values: ['x', 'y', 'closest', false, 'x unified', 'y unified'],\n        dflt: 'closest',\n        editType: 'modebar',\n        description: [\n            'Determines the mode of hover interactions.',\n            'If *closest*, a single hoverlabel will appear',\n            'for the *closest* point within the `hoverdistance`.',\n            'If *x* (or *y*), multiple hoverlabels will appear for multiple points',\n            'at the *closest* x- (or y-) coordinate within the `hoverdistance`,',\n            'with the caveat that no more than one hoverlabel will appear per trace.',\n            'If *x unified* (or *y unified*), a single hoverlabel will appear',\n            'multiple points at the closest x- (or y-) coordinate within the `hoverdistance`',\n            'with the caveat that no more than one hoverlabel will appear per trace.',\n            'In this mode, spikelines are enabled by default perpendicular to the specified axis.',\n            'If false, hover interactions are disabled.'\n        ].join(' ')\n    },\n    hoverdistance: {\n        valType: 'integer',\n        min: -1,\n        dflt: 20,\n        editType: 'none',\n        description: [\n            'Sets the default distance (in pixels) to look for data',\n            'to add hover labels (-1 means no cutoff, 0 means no looking for data).',\n            'This is only a real distance for hovering on point-like objects,',\n            'like scatter points. For area-like objects (bars, scatter fills, etc)',\n            'hovering is on inside the area and off outside, but these objects',\n            'will not supersede hover on point-like objects in case of conflict.'\n        ].join(' ')\n    },\n    spikedistance: {\n        valType: 'integer',\n        min: -1,\n        dflt: -1,\n        editType: 'none',\n        description: [\n            'Sets the default distance (in pixels) to look for data to draw',\n            'spikelines to (-1 means no cutoff, 0 means no looking for data).',\n            'As with hoverdistance, distance does not apply to area-like objects.',\n            'In addition, some objects can be hovered on but will not generate',\n            'spikelines, such as scatter fills.'\n        ].join(' ')\n    },\n    hoverlabel: {\n        bgcolor: {\n            valType: 'color',\n            editType: 'none',\n            description: [\n                'Sets the background color of all hover labels on graph'\n            ].join(' ')\n        },\n        bordercolor: {\n            valType: 'color',\n            editType: 'none',\n            description: [\n                'Sets the border color of all hover labels on graph.'\n            ].join(' ')\n        },\n        font: fontAttrs,\n        align: {\n            valType: 'enumerated',\n            values: ['left', 'right', 'auto'],\n            dflt: 'auto',\n            editType: 'none',\n            description: [\n                'Sets the horizontal alignment of the text content within hover label box.',\n                'Has an effect only if the hover label text spans more two or more lines'\n            ].join(' ')\n        },\n        namelength: {\n            valType: 'integer',\n            min: -1,\n            dflt: 15,\n            editType: 'none',\n            description: [\n                'Sets the default length (in number of characters) of the trace name in',\n                'the hover labels for all traces. -1 shows the whole name',\n                'regardless of length. 0-3 shows the first 0-3 characters, and',\n                'an integer >3 will show the whole name if it is less than that',\n                'many characters, but if it is longer, will truncate to',\n                '`namelength - 3` characters and add an ellipsis.'\n            ].join(' ')\n        },\n        editType: 'none'\n    },\n    selectdirection: {\n        valType: 'enumerated',\n        values: ['h', 'v', 'd', 'any'],\n        dflt: 'any',\n        description: [\n            'When `dragmode` is set to *select*, this limits the selection of the drag to',\n            'horizontal, vertical or diagonal. *h* only allows horizontal selection,',\n            '*v* only vertical, *d* only diagonal and *any* sets no limit.'\n        ].join(' '),\n        editType: 'none'\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar layoutAttributes = require('./layout_attributes');\nvar handleHoverModeDefaults = require('./hovermode_defaults');\nvar handleHoverLabelDefaults = require('./hoverlabel_defaults');\n\nmodule.exports = function supplyLayoutDefaults(layoutIn, layoutOut) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(layoutIn, layoutOut, layoutAttributes, attr, dflt);\n    }\n\n    var hoverMode = handleHoverModeDefaults(layoutIn, layoutOut);\n    if(hoverMode) {\n        coerce('hoverdistance');\n        coerce('spikedistance');\n    }\n\n    var dragMode = coerce('dragmode');\n    if(dragMode === 'select') coerce('selectdirection');\n\n    // if only mapbox or geo subplots is present on graph,\n    // reset 'zoom' dragmode to 'pan' until 'zoom' is implemented,\n    // so that the correct modebar button is active\n    var hasMapbox = layoutOut._has('mapbox');\n    var hasGeo = layoutOut._has('geo');\n    var len = layoutOut._basePlotModules.length;\n\n    if(layoutOut.dragmode === 'zoom' && (\n        ((hasMapbox || hasGeo) && len === 1) ||\n        (hasMapbox && hasGeo && len === 2)\n    )) {\n        layoutOut.dragmode = 'pan';\n    }\n\n    handleHoverLabelDefaults(layoutIn, layoutOut, coerce);\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar handleHoverLabelDefaults = require('./hoverlabel_defaults');\nvar layoutAttributes = require('./layout_attributes');\n\nmodule.exports = function supplyLayoutGlobalDefaults(layoutIn, layoutOut) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(layoutIn, layoutOut, layoutAttributes, attr, dflt);\n    }\n\n    handleHoverLabelDefaults(layoutIn, layoutOut, coerce);\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar counterRegex = require('../../lib/regex').counter;\nvar domainAttrs = require('../../plots/domain').attributes;\nvar cartesianIdRegex = require('../../plots/cartesian/constants').idRegex;\nvar Template = require('../../plot_api/plot_template');\n\nvar gridAttrs = {\n    rows: {\n        valType: 'integer',\n        min: 1,\n        editType: 'plot',\n        description: [\n            'The number of rows in the grid. If you provide a 2D `subplots`',\n            'array or a `yaxes` array, its length is used as the default.',\n            'But it\\'s also possible to have a different length, if you',\n            'want to leave a row at the end for non-cartesian subplots.'\n        ].join(' ')\n    },\n    roworder: {\n        valType: 'enumerated',\n        values: ['top to bottom', 'bottom to top'],\n        dflt: 'top to bottom',\n        editType: 'plot',\n        description: [\n            'Is the first row the top or the bottom? Note that columns',\n            'are always enumerated from left to right.'\n        ].join(' ')\n    },\n    columns: {\n        valType: 'integer',\n        min: 1,\n        editType: 'plot',\n        description: [\n            'The number of columns in the grid. If you provide a 2D `subplots`',\n            'array, the length of its longest row is used as the default.',\n            'If you give an `xaxes` array, its length is used as the default.',\n            'But it\\'s also possible to have a different length, if you',\n            'want to leave a row at the end for non-cartesian subplots.'\n        ].join(' ')\n    },\n    subplots: {\n        valType: 'info_array',\n        freeLength: true,\n        dimensions: 2,\n        items: {valType: 'enumerated', values: [counterRegex('xy').toString(), ''], editType: 'plot'},\n        editType: 'plot',\n        description: [\n            'Used for freeform grids, where some axes may be shared across subplots',\n            'but others are not. Each entry should be a cartesian subplot id, like',\n            '*xy* or *x3y2*, or ** to leave that cell empty. You may reuse x axes',\n            'within the same column, and y axes within the same row.',\n            'Non-cartesian subplots and traces that support `domain` can place themselves',\n            'in this grid separately using the `gridcell` attribute.'\n        ].join(' ')\n    },\n    xaxes: {\n        valType: 'info_array',\n        freeLength: true,\n        items: {valType: 'enumerated', values: [cartesianIdRegex.x.toString(), ''], editType: 'plot'},\n        editType: 'plot',\n        description: [\n            'Used with `yaxes` when the x and y axes are shared across columns and rows.',\n            'Each entry should be an x axis id like *x*, *x2*, etc., or ** to',\n            'not put an x axis in that column. Entries other than ** must be unique.',\n            'Ignored if `subplots` is present. If missing but `yaxes` is present,',\n            'will generate consecutive IDs.'\n        ].join(' ')\n    },\n    yaxes: {\n        valType: 'info_array',\n        freeLength: true,\n        items: {valType: 'enumerated', values: [cartesianIdRegex.y.toString(), ''], editType: 'plot'},\n        editType: 'plot',\n        description: [\n            'Used with `yaxes` when the x and y axes are shared across columns and rows.',\n            'Each entry should be an y axis id like *y*, *y2*, etc., or ** to',\n            'not put a y axis in that row. Entries other than ** must be unique.',\n            'Ignored if `subplots` is present. If missing but `xaxes` is present,',\n            'will generate consecutive IDs.'\n        ].join(' ')\n    },\n    pattern: {\n        valType: 'enumerated',\n        values: ['independent', 'coupled'],\n        dflt: 'coupled',\n        editType: 'plot',\n        description: [\n            'If no `subplots`, `xaxes`, or `yaxes` are given but we do have `rows` and `columns`,',\n            'we can generate defaults using consecutive axis IDs, in two ways:',\n            '*coupled* gives one x axis per column and one y axis per row.',\n            '*independent* uses a new xy pair for each cell, left-to-right across each row',\n            'then iterating rows according to `roworder`.'\n        ].join(' ')\n    },\n    xgap: {\n        valType: 'number',\n        min: 0,\n        max: 1,\n        editType: 'plot',\n        description: [\n            'Horizontal space between grid cells, expressed as a fraction',\n            'of the total width available to one cell. Defaults to 0.1',\n            'for coupled-axes grids and 0.2 for independent grids.'\n        ].join(' ')\n    },\n    ygap: {\n        valType: 'number',\n        min: 0,\n        max: 1,\n        editType: 'plot',\n        description: [\n            'Vertical space between grid cells, expressed as a fraction',\n            'of the total height available to one cell. Defaults to 0.1',\n            'for coupled-axes grids and 0.3 for independent grids.'\n        ].join(' ')\n    },\n    domain: domainAttrs({name: 'grid', editType: 'plot', noGridCell: true}, {\n        description: [\n            'The first and last cells end exactly at the domain',\n            'edges, with no grout around the edges.'\n        ].join(' ')\n    }),\n    xside: {\n        valType: 'enumerated',\n        values: ['bottom', 'bottom plot', 'top plot', 'top'],\n        dflt: 'bottom plot',\n        editType: 'plot',\n        description: [\n            'Sets where the x axis labels and titles go. *bottom* means',\n            'the very bottom of the grid. *bottom plot* is the lowest plot',\n            'that each x axis is used in. *top* and *top plot* are similar.'\n        ].join(' ')\n    },\n    yside: {\n        valType: 'enumerated',\n        values: ['left', 'left plot', 'right plot', 'right'],\n        dflt: 'left plot',\n        editType: 'plot',\n        description: [\n            'Sets where the y axis labels and titles go. *left* means',\n            'the very left edge of the grid. *left plot* is the leftmost plot',\n            'that each y axis is used in. *right* and *right plot* are similar.'\n        ].join(' ')\n    },\n    editType: 'plot'\n};\n\nfunction getAxes(layout, grid, axLetter) {\n    var gridVal = grid[axLetter + 'axes'];\n    var splomVal = Object.keys((layout._splomAxes || {})[axLetter] || {});\n\n    if(Array.isArray(gridVal)) return gridVal;\n    if(splomVal.length) return splomVal;\n}\n\n// the shape of the grid - this needs to be done BEFORE supplyDataDefaults\n// so that non-subplot traces can place themselves in the grid\nfunction sizeDefaults(layoutIn, layoutOut) {\n    var gridIn = layoutIn.grid || {};\n    var xAxes = getAxes(layoutOut, gridIn, 'x');\n    var yAxes = getAxes(layoutOut, gridIn, 'y');\n\n    if(!layoutIn.grid && !xAxes && !yAxes) return;\n\n    var hasSubplotGrid = Array.isArray(gridIn.subplots) && Array.isArray(gridIn.subplots[0]);\n    var hasXaxes = Array.isArray(xAxes);\n    var hasYaxes = Array.isArray(yAxes);\n    var isSplomGenerated = (\n        hasXaxes && xAxes !== gridIn.xaxes &&\n        hasYaxes && yAxes !== gridIn.yaxes\n    );\n\n    var dfltRows, dfltColumns;\n\n    if(hasSubplotGrid) {\n        dfltRows = gridIn.subplots.length;\n        dfltColumns = gridIn.subplots[0].length;\n    } else {\n        if(hasYaxes) dfltRows = yAxes.length;\n        if(hasXaxes) dfltColumns = xAxes.length;\n    }\n\n    var gridOut = Template.newContainer(layoutOut, 'grid');\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(gridIn, gridOut, gridAttrs, attr, dflt);\n    }\n\n    var rows = coerce('rows', dfltRows);\n    var columns = coerce('columns', dfltColumns);\n\n    if(!(rows * columns > 1)) {\n        delete layoutOut.grid;\n        return;\n    }\n\n    if(!hasSubplotGrid && !hasXaxes && !hasYaxes) {\n        var useDefaultSubplots = coerce('pattern') === 'independent';\n        if(useDefaultSubplots) hasSubplotGrid = true;\n    }\n    gridOut._hasSubplotGrid = hasSubplotGrid;\n\n    var rowOrder = coerce('roworder');\n    var reversed = rowOrder === 'top to bottom';\n\n    var dfltGapX = hasSubplotGrid ? 0.2 : 0.1;\n    var dfltGapY = hasSubplotGrid ? 0.3 : 0.1;\n\n    var dfltSideX, dfltSideY;\n    if(isSplomGenerated && layoutOut._splomGridDflt) {\n        dfltSideX = layoutOut._splomGridDflt.xside;\n        dfltSideY = layoutOut._splomGridDflt.yside;\n    }\n\n    gridOut._domains = {\n        x: fillGridPositions('x', coerce, dfltGapX, dfltSideX, columns),\n        y: fillGridPositions('y', coerce, dfltGapY, dfltSideY, rows, reversed)\n    };\n}\n\n// coerce x or y sizing attributes and return an array of domains for this direction\nfunction fillGridPositions(axLetter, coerce, dfltGap, dfltSide, len, reversed) {\n    var dirGap = coerce(axLetter + 'gap', dfltGap);\n    var domain = coerce('domain.' + axLetter);\n    coerce(axLetter + 'side', dfltSide);\n\n    var out = new Array(len);\n    var start = domain[0];\n    var step = (domain[1] - start) / (len - dirGap);\n    var cellDomain = step * (1 - dirGap);\n    for(var i = 0; i < len; i++) {\n        var cellStart = start + step * i;\n        out[reversed ? (len - 1 - i) : i] = [cellStart, cellStart + cellDomain];\n    }\n    return out;\n}\n\n// the (cartesian) contents of the grid - this needs to happen AFTER supplyDataDefaults\n// so that we know what cartesian subplots are available\nfunction contentDefaults(layoutIn, layoutOut) {\n    var gridOut = layoutOut.grid;\n    // make sure we got to the end of handleGridSizing\n    if(!gridOut || !gridOut._domains) return;\n\n    var gridIn = layoutIn.grid || {};\n    var subplots = layoutOut._subplots;\n    var hasSubplotGrid = gridOut._hasSubplotGrid;\n    var rows = gridOut.rows;\n    var columns = gridOut.columns;\n    var useDefaultSubplots = gridOut.pattern === 'independent';\n\n    var i, j, xId, yId, subplotId, subplotsOut, yPos;\n\n    var axisMap = gridOut._axisMap = {};\n\n    if(hasSubplotGrid) {\n        var subplotsIn = gridIn.subplots || [];\n        subplotsOut = gridOut.subplots = new Array(rows);\n        var index = 1;\n\n        for(i = 0; i < rows; i++) {\n            var rowOut = subplotsOut[i] = new Array(columns);\n            var rowIn = subplotsIn[i] || [];\n            for(j = 0; j < columns; j++) {\n                if(useDefaultSubplots) {\n                    subplotId = (index === 1) ? 'xy' : ('x' + index + 'y' + index);\n                    index++;\n                } else subplotId = rowIn[j];\n\n                rowOut[j] = '';\n\n                if(subplots.cartesian.indexOf(subplotId) !== -1) {\n                    yPos = subplotId.indexOf('y');\n                    xId = subplotId.slice(0, yPos);\n                    yId = subplotId.slice(yPos);\n                    if((axisMap[xId] !== undefined && axisMap[xId] !== j) ||\n                        (axisMap[yId] !== undefined && axisMap[yId] !== i)\n                    ) {\n                        continue;\n                    }\n\n                    rowOut[j] = subplotId;\n                    axisMap[xId] = j;\n                    axisMap[yId] = i;\n                }\n            }\n        }\n    } else {\n        var xAxes = getAxes(layoutOut, gridIn, 'x');\n        var yAxes = getAxes(layoutOut, gridIn, 'y');\n        gridOut.xaxes = fillGridAxes(xAxes, subplots.xaxis, columns, axisMap, 'x');\n        gridOut.yaxes = fillGridAxes(yAxes, subplots.yaxis, rows, axisMap, 'y');\n    }\n\n    var anchors = gridOut._anchors = {};\n    var reversed = gridOut.roworder === 'top to bottom';\n\n    for(var axisId in axisMap) {\n        var axLetter = axisId.charAt(0);\n        var side = gridOut[axLetter + 'side'];\n\n        var i0, inc, iFinal;\n\n        if(side.length < 8) {\n            // grid edge -  ie not \"* plot\" - make these as free axes\n            // since we're not guaranteed to have a subplot there at all\n            anchors[axisId] = 'free';\n        } else if(axLetter === 'x') {\n            if((side.charAt(0) === 't') === reversed) {\n                i0 = 0;\n                inc = 1;\n                iFinal = rows;\n            } else {\n                i0 = rows - 1;\n                inc = -1;\n                iFinal = -1;\n            }\n            if(hasSubplotGrid) {\n                var column = axisMap[axisId];\n                for(i = i0; i !== iFinal; i += inc) {\n                    subplotId = subplotsOut[i][column];\n                    if(!subplotId) continue;\n                    yPos = subplotId.indexOf('y');\n                    if(subplotId.slice(0, yPos) === axisId) {\n                        anchors[axisId] = subplotId.slice(yPos);\n                        break;\n                    }\n                }\n            } else {\n                for(i = i0; i !== iFinal; i += inc) {\n                    yId = gridOut.yaxes[i];\n                    if(subplots.cartesian.indexOf(axisId + yId) !== -1) {\n                        anchors[axisId] = yId;\n                        break;\n                    }\n                }\n            }\n        } else {\n            if((side.charAt(0) === 'l')) {\n                i0 = 0;\n                inc = 1;\n                iFinal = columns;\n            } else {\n                i0 = columns - 1;\n                inc = -1;\n                iFinal = -1;\n            }\n            if(hasSubplotGrid) {\n                var row = axisMap[axisId];\n                for(i = i0; i !== iFinal; i += inc) {\n                    subplotId = subplotsOut[row][i];\n                    if(!subplotId) continue;\n                    yPos = subplotId.indexOf('y');\n                    if(subplotId.slice(yPos) === axisId) {\n                        anchors[axisId] = subplotId.slice(0, yPos);\n                        break;\n                    }\n                }\n            } else {\n                for(i = i0; i !== iFinal; i += inc) {\n                    xId = gridOut.xaxes[i];\n                    if(subplots.cartesian.indexOf(xId + axisId) !== -1) {\n                        anchors[axisId] = xId;\n                        break;\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction fillGridAxes(axesIn, axesAllowed, len, axisMap, axLetter) {\n    var out = new Array(len);\n    var i;\n\n    function fillOneAxis(i, axisId) {\n        if(axesAllowed.indexOf(axisId) !== -1 && axisMap[axisId] === undefined) {\n            out[i] = axisId;\n            axisMap[axisId] = i;\n        } else out[i] = '';\n    }\n\n    if(Array.isArray(axesIn)) {\n        for(i = 0; i < len; i++) {\n            fillOneAxis(i, axesIn[i]);\n        }\n    } else {\n        // default axis list is the first `len` axis ids\n        fillOneAxis(0, axLetter);\n        for(i = 1; i < len; i++) {\n            fillOneAxis(i, axLetter + (i + 1));\n        }\n    }\n\n    return out;\n}\n\nmodule.exports = {\n    moduleType: 'component',\n    name: 'grid',\n\n    schema: {\n        layout: {grid: gridAttrs}\n    },\n\n    layoutAttributes: gridAttrs,\n    sizeDefaults: sizeDefaults,\n    contentDefaults: contentDefaults\n};\n","'use strict';\n\nvar cartesianConstants = require('../../plots/cartesian/constants');\nvar templatedArray = require('../../plot_api/plot_template').templatedArray;\nvar axisPlaceableObjs = require('../../constants/axis_placeable_objects');\n\n\nmodule.exports = templatedArray('image', {\n    visible: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'arraydraw',\n        description: [\n            'Determines whether or not this image is visible.'\n        ].join(' ')\n    },\n\n    source: {\n        valType: 'string',\n        editType: 'arraydraw',\n        description: [\n            'Specifies the URL of the image to be used.',\n            'The URL must be accessible from the domain where the',\n            'plot code is run, and can be either relative or absolute.'\n\n        ].join(' ')\n    },\n\n    layer: {\n        valType: 'enumerated',\n        values: ['below', 'above'],\n        dflt: 'above',\n        editType: 'arraydraw',\n        description: [\n            'Specifies whether images are drawn below or above traces.',\n            'When `xref` and `yref` are both set to `paper`,',\n            'image is drawn below the entire plot area.'\n        ].join(' ')\n    },\n\n    sizex: {\n        valType: 'number',\n        dflt: 0,\n        editType: 'arraydraw',\n        description: [\n            'Sets the image container size horizontally.',\n            'The image will be sized based on the `position` value.',\n            'When `xref` is set to `paper`, units are sized relative',\n            'to the plot width.',\n            'When `xref` ends with ` domain`, units are sized relative',\n            'to the axis width.',\n        ].join(' ')\n    },\n\n    sizey: {\n        valType: 'number',\n        dflt: 0,\n        editType: 'arraydraw',\n        description: [\n            'Sets the image container size vertically.',\n            'The image will be sized based on the `position` value.',\n            'When `yref` is set to `paper`, units are sized relative',\n            'to the plot height.',\n            'When `yref` ends with ` domain`, units are sized relative',\n            'to the axis height.'\n        ].join(' ')\n    },\n\n    sizing: {\n        valType: 'enumerated',\n        values: ['fill', 'contain', 'stretch'],\n        dflt: 'contain',\n        editType: 'arraydraw',\n        description: [\n            'Specifies which dimension of the image to constrain.'\n        ].join(' ')\n    },\n\n    opacity: {\n        valType: 'number',\n        min: 0,\n        max: 1,\n        dflt: 1,\n        editType: 'arraydraw',\n        description: 'Sets the opacity of the image.'\n    },\n\n    x: {\n        valType: 'any',\n        dflt: 0,\n        editType: 'arraydraw',\n        description: [\n            'Sets the image\\'s x position.',\n            'When `xref` is set to `paper`, units are sized relative',\n            'to the plot height.',\n            'See `xref` for more info'\n        ].join(' ')\n    },\n\n    y: {\n        valType: 'any',\n        dflt: 0,\n        editType: 'arraydraw',\n        description: [\n            'Sets the image\\'s y position.',\n            'When `yref` is set to `paper`, units are sized relative',\n            'to the plot height.',\n            'See `yref` for more info'\n        ].join(' ')\n    },\n\n    xanchor: {\n        valType: 'enumerated',\n        values: ['left', 'center', 'right'],\n        dflt: 'left',\n        editType: 'arraydraw',\n        description: 'Sets the anchor for the x position'\n    },\n\n    yanchor: {\n        valType: 'enumerated',\n        values: ['top', 'middle', 'bottom'],\n        dflt: 'top',\n        editType: 'arraydraw',\n        description: 'Sets the anchor for the y position.'\n    },\n\n    xref: {\n        valType: 'enumerated',\n        values: [\n            'paper',\n            cartesianConstants.idRegex.x.toString()\n        ],\n        dflt: 'paper',\n        editType: 'arraydraw',\n        description: [\n            'Sets the images\\'s x coordinate axis.',\n            axisPlaceableObjs.axisRefDescription('x', 'left', 'right'),\n        ].join(' ')\n    },\n\n    yref: {\n        valType: 'enumerated',\n        values: [\n            'paper',\n            cartesianConstants.idRegex.y.toString()\n        ],\n        dflt: 'paper',\n        editType: 'arraydraw',\n        description: [\n            'Sets the images\\'s y coordinate axis.',\n            axisPlaceableObjs.axisRefDescription('y', 'bottom', 'top'),\n        ].join(' ')\n    },\n    editType: 'arraydraw'\n});\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar toLogRange = require('../../lib/to_log_range');\n\n/*\n * convertCoords: when converting an axis between log and linear\n * you need to alter any images on that axis to keep them\n * pointing at the same data point.\n * In v3.0 this will become obsolete (or perhaps size will still need conversion?)\n * we convert size by declaring that the maximum extent *in data units* should be\n * the same, assuming the image is anchored by its center (could remove that restriction\n * if we think it's important) even though the actual left and right values will not be\n * quite the same since the scale becomes nonlinear (and central anchor means the pixel\n * center of the image, not the data units center)\n *\n * gd: the plot div\n * ax: the axis being changed\n * newType: the type it's getting\n * doExtra: function(attr, val) from inside relayout that sets the attribute.\n *     Use this to make the changes as it's aware if any other changes in the\n *     same relayout call should override this conversion.\n */\nmodule.exports = function convertCoords(gd, ax, newType, doExtra) {\n    ax = ax || {};\n\n    var toLog = (newType === 'log') && (ax.type === 'linear');\n    var fromLog = (newType === 'linear') && (ax.type === 'log');\n\n    if(!(toLog || fromLog)) return;\n\n    var images = gd._fullLayout.images;\n    var axLetter = ax._id.charAt(0);\n    var image;\n    var attrPrefix;\n\n    for(var i = 0; i < images.length; i++) {\n        image = images[i];\n        attrPrefix = 'images[' + i + '].';\n\n        if(image[axLetter + 'ref'] === ax._id) {\n            var currentPos = image[axLetter];\n            var currentSize = image['size' + axLetter];\n            var newPos = null;\n            var newSize = null;\n\n            if(toLog) {\n                newPos = toLogRange(currentPos, ax.range);\n\n                // this is the inverse of the conversion we do in fromLog below\n                // so that the conversion is reversible (notice the fromLog conversion\n                // is like sinh, and this one looks like arcsinh)\n                var dx = currentSize / Math.pow(10, newPos) / 2;\n                newSize = 2 * Math.log(dx + Math.sqrt(1 + dx * dx)) / Math.LN10;\n            } else {\n                newPos = Math.pow(10, currentPos);\n                newSize = newPos * (Math.pow(10, currentSize / 2) - Math.pow(10, -currentSize / 2));\n            }\n\n            // if conversion failed, delete the value so it can get a default later on\n            if(!isNumeric(newPos)) {\n                newPos = null;\n                newSize = null;\n            } else if(!isNumeric(newSize)) newSize = null;\n\n            doExtra(attrPrefix + axLetter, newPos);\n            doExtra(attrPrefix + 'size' + axLetter, newSize);\n        }\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Axes = require('../../plots/cartesian/axes');\nvar handleArrayContainerDefaults = require('../../plots/array_container_defaults');\n\nvar attributes = require('./attributes');\nvar name = 'images';\n\nmodule.exports = function supplyLayoutDefaults(layoutIn, layoutOut) {\n    var opts = {\n        name: name,\n        handleItemDefaults: imageDefaults\n    };\n\n    handleArrayContainerDefaults(layoutIn, layoutOut, opts);\n};\n\n\nfunction imageDefaults(imageIn, imageOut, fullLayout) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(imageIn, imageOut, attributes, attr, dflt);\n    }\n\n    var source = coerce('source');\n    var visible = coerce('visible', !!source);\n\n    if(!visible) return imageOut;\n\n    coerce('layer');\n    coerce('xanchor');\n    coerce('yanchor');\n    coerce('sizex');\n    coerce('sizey');\n    coerce('sizing');\n    coerce('opacity');\n\n    var gdMock = { _fullLayout: fullLayout };\n    var axLetters = ['x', 'y'];\n\n    for(var i = 0; i < 2; i++) {\n        // 'paper' is the fallback axref\n        var axLetter = axLetters[i];\n        var axRef = Axes.coerceRef(imageIn, imageOut, gdMock, axLetter, 'paper', undefined);\n\n        if(axRef !== 'paper') {\n            var ax = Axes.getFromId(gdMock, axRef);\n            ax._imgIndices.push(imageOut._index);\n        }\n\n        Axes.coercePosition(imageOut, gdMock, coerce, axRef, axLetter, 0);\n    }\n\n    return imageOut;\n}\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar Drawing = require('../drawing');\nvar Axes = require('../../plots/cartesian/axes');\nvar axisIds = require('../../plots/cartesian/axis_ids');\nvar xmlnsNamespaces = require('../../constants/xmlns_namespaces');\n\nmodule.exports = function draw(gd) {\n    var fullLayout = gd._fullLayout;\n    var imageDataAbove = [];\n    var imageDataSubplot = {};\n    var imageDataBelow = [];\n    var subplot;\n    var i;\n\n    // Sort into top, subplot, and bottom layers\n    for(i = 0; i < fullLayout.images.length; i++) {\n        var img = fullLayout.images[i];\n\n        if(img.visible) {\n            if(img.layer === 'below' && img.xref !== 'paper' && img.yref !== 'paper') {\n                subplot = axisIds.ref2id(img.xref) + axisIds.ref2id(img.yref);\n\n                var plotinfo = fullLayout._plots[subplot];\n\n                if(!plotinfo) {\n                    // Fall back to _imageLowerLayer in case the requested subplot doesn't exist.\n                    // This can happen if you reference the image to an x / y axis combination\n                    // that doesn't have any data on it (and layer is below)\n                    imageDataBelow.push(img);\n                    continue;\n                }\n\n                if(plotinfo.mainplot) {\n                    subplot = plotinfo.mainplot.id;\n                }\n\n                if(!imageDataSubplot[subplot]) {\n                    imageDataSubplot[subplot] = [];\n                }\n                imageDataSubplot[subplot].push(img);\n            } else if(img.layer === 'above') {\n                imageDataAbove.push(img);\n            } else {\n                imageDataBelow.push(img);\n            }\n        }\n    }\n\n\n    var anchors = {\n        x: {\n            left: { sizing: 'xMin', offset: 0 },\n            center: { sizing: 'xMid', offset: -1 / 2 },\n            right: { sizing: 'xMax', offset: -1 }\n        },\n        y: {\n            top: { sizing: 'YMin', offset: 0 },\n            middle: { sizing: 'YMid', offset: -1 / 2 },\n            bottom: { sizing: 'YMax', offset: -1 }\n        }\n    };\n\n\n    // Images must be converted to dataURL's for exporting.\n    function setImage(d) {\n        var thisImage = d3.select(this);\n\n        if(this._imgSrc === d.source) {\n            return;\n        }\n\n        thisImage.attr('xmlns', xmlnsNamespaces.svg);\n\n        if(d.source && d.source.slice(0, 5) === 'data:') {\n            thisImage.attr('xlink:href', d.source);\n            this._imgSrc = d.source;\n        } else {\n            var imagePromise = new Promise(function(resolve) {\n                var img = new Image();\n                this.img = img;\n\n                // If not set, a `tainted canvas` error is thrown\n                img.setAttribute('crossOrigin', 'anonymous');\n                img.onerror = errorHandler;\n                img.onload = function() {\n                    var canvas = document.createElement('canvas');\n                    canvas.width = this.width;\n                    canvas.height = this.height;\n\n                    var ctx = canvas.getContext('2d');\n                    ctx.drawImage(this, 0, 0);\n\n                    var dataURL = canvas.toDataURL('image/png');\n\n                    thisImage.attr('xlink:href', dataURL);\n\n                    // resolve promise in onload handler instead of on 'load' to support IE11\n                    // see https://github.com/plotly/plotly.js/issues/1685\n                    // for more details\n                    resolve();\n                };\n\n                thisImage.on('error', errorHandler);\n\n                img.src = d.source;\n                this._imgSrc = d.source;\n\n                function errorHandler() {\n                    thisImage.remove();\n                    resolve();\n                }\n            }.bind(this));\n\n            gd._promises.push(imagePromise);\n        }\n    }\n\n    function applyAttributes(d) {\n        var thisImage = d3.select(this);\n\n        // Axes if specified\n        var xa = Axes.getFromId(gd, d.xref);\n        var ya = Axes.getFromId(gd, d.yref);\n        var xIsDomain = Axes.getRefType(d.xref) === 'domain';\n        var yIsDomain = Axes.getRefType(d.yref) === 'domain';\n\n        var size = fullLayout._size;\n        var width, height;\n        if(xa !== undefined) {\n            width = ((typeof(d.xref) === 'string') && xIsDomain) ?\n                xa._length * d.sizex :\n                Math.abs(xa.l2p(d.sizex) - xa.l2p(0));\n        } else {\n            width = d.sizex * size.w;\n        }\n        if(ya !== undefined) {\n            height = ((typeof(d.yref) === 'string') && yIsDomain) ?\n                ya._length * d.sizey :\n                Math.abs(ya.l2p(d.sizey) - ya.l2p(0));\n        } else {\n            height = d.sizey * size.h;\n        }\n\n        // Offsets for anchor positioning\n        var xOffset = width * anchors.x[d.xanchor].offset;\n        var yOffset = height * anchors.y[d.yanchor].offset;\n\n        var sizing = anchors.x[d.xanchor].sizing + anchors.y[d.yanchor].sizing;\n\n        // Final positions\n        var xPos, yPos;\n        if(xa !== undefined) {\n            xPos = ((typeof(d.xref) === 'string') && xIsDomain) ?\n                xa._length * d.x + xa._offset :\n                xa.r2p(d.x) + xa._offset;\n        } else {\n            xPos = d.x * size.w + size.l;\n        }\n        xPos += xOffset;\n        if(ya !== undefined) {\n            yPos = ((typeof(d.yref) === 'string') && yIsDomain) ?\n                // consistent with \"paper\" yref value, where positive values\n                // move up the page\n                ya._length * (1 - d.y) + ya._offset :\n                ya.r2p(d.y) + ya._offset;\n        } else {\n            yPos = size.h - d.y * size.h + size.t;\n        }\n        yPos += yOffset;\n\n        // Construct the proper aspectRatio attribute\n        switch(d.sizing) {\n            case 'fill':\n                sizing += ' slice';\n                break;\n\n            case 'stretch':\n                sizing = 'none';\n                break;\n        }\n\n        thisImage.attr({\n            x: xPos,\n            y: yPos,\n            width: width,\n            height: height,\n            preserveAspectRatio: sizing,\n            opacity: d.opacity\n        });\n\n\n        // Set proper clipping on images\n        var xId = xa && (Axes.getRefType(d.xref) !== 'domain') ? xa._id : '';\n        var yId = ya && (Axes.getRefType(d.yref) !== 'domain') ? ya._id : '';\n        var clipAxes = xId + yId;\n\n        Drawing.setClipUrl(\n            thisImage,\n            clipAxes ? ('clip' + fullLayout._uid + clipAxes) : null,\n            gd\n        );\n    }\n\n    var imagesBelow = fullLayout._imageLowerLayer.selectAll('image')\n        .data(imageDataBelow);\n    var imagesAbove = fullLayout._imageUpperLayer.selectAll('image')\n        .data(imageDataAbove);\n\n    imagesBelow.enter().append('image');\n    imagesAbove.enter().append('image');\n\n    imagesBelow.exit().remove();\n    imagesAbove.exit().remove();\n\n    imagesBelow.each(function(d) {\n        setImage.bind(this)(d);\n        applyAttributes.bind(this)(d);\n    });\n    imagesAbove.each(function(d) {\n        setImage.bind(this)(d);\n        applyAttributes.bind(this)(d);\n    });\n\n    var allSubplots = Object.keys(fullLayout._plots);\n    for(i = 0; i < allSubplots.length; i++) {\n        subplot = allSubplots[i];\n        var subplotObj = fullLayout._plots[subplot];\n\n        // filter out overlaid plots (which have their images on the main plot)\n        // and gl2d plots (which don't support below images, at least not yet)\n        if(!subplotObj.imagelayer) continue;\n\n        var imagesOnSubplot = subplotObj.imagelayer.selectAll('image')\n            // even if there are no images on this subplot, we need to run\n            // enter and exit in case there were previously\n            .data(imageDataSubplot[subplot] || []);\n\n        imagesOnSubplot.enter().append('image');\n        imagesOnSubplot.exit().remove();\n\n        imagesOnSubplot.each(function(d) {\n            setImage.bind(this)(d);\n            applyAttributes.bind(this)(d);\n        });\n    }\n};\n","'use strict';\n\nmodule.exports = {\n    moduleType: 'component',\n    name: 'images',\n\n    layoutAttributes: require('./attributes'),\n    supplyLayoutDefaults: require('./defaults'),\n    includeBasePlot: require('../../plots/cartesian/include_components')('images'),\n\n    draw: require('./draw'),\n\n    convertCoords: require('./convert_coords')\n};\n","'use strict';\n\nvar fontAttrs = require('../../plots/font_attributes');\nvar colorAttrs = require('../color/attributes');\n\n\nmodule.exports = {\n    bgcolor: {\n        valType: 'color',\n        editType: 'legend',\n        description: [\n            'Sets the legend background color.',\n            'Defaults to `layout.paper_bgcolor`.'\n        ].join(' ')\n    },\n    bordercolor: {\n        valType: 'color',\n        dflt: colorAttrs.defaultLine,\n        editType: 'legend',\n        description: 'Sets the color of the border enclosing the legend.'\n    },\n    borderwidth: {\n        valType: 'number',\n        min: 0,\n        dflt: 0,\n        editType: 'legend',\n        description: 'Sets the width (in px) of the border enclosing the legend.'\n    },\n    font: fontAttrs({\n        editType: 'legend',\n        description: 'Sets the font used to text the legend items.'\n    }),\n    orientation: {\n        valType: 'enumerated',\n        values: ['v', 'h'],\n        dflt: 'v',\n        editType: 'legend',\n        description: 'Sets the orientation of the legend.'\n    },\n    traceorder: {\n        valType: 'flaglist',\n        flags: ['reversed', 'grouped'],\n        extras: ['normal'],\n        editType: 'legend',\n        description: [\n            'Determines the order at which the legend items are displayed.',\n\n            'If *normal*, the items are displayed top-to-bottom in the same',\n            'order as the input data.',\n\n            'If *reversed*, the items are displayed in the opposite order',\n            'as *normal*.',\n\n            'If *grouped*, the items are displayed in groups',\n            '(when a trace `legendgroup` is provided).',\n\n            'if *grouped+reversed*, the items are displayed in the opposite order',\n            'as *grouped*.'\n        ].join(' ')\n    },\n    tracegroupgap: {\n        valType: 'number',\n        min: 0,\n        dflt: 10,\n        editType: 'legend',\n        description: [\n            'Sets the amount of vertical space (in px) between legend groups.'\n        ].join(' ')\n    },\n    itemsizing: {\n        valType: 'enumerated',\n        values: ['trace', 'constant'],\n        dflt: 'trace',\n        editType: 'legend',\n        description: [\n            'Determines if the legend items symbols scale with their corresponding *trace* attributes',\n            'or remain *constant* independent of the symbol size on the graph.'\n        ].join(' ')\n    },\n    itemwidth: {\n        valType: 'number',\n        min: 30,\n        dflt: 30,\n        editType: 'legend',\n        description: 'Sets the width (in px) of the legend item symbols (the part other than the title.text).',\n    },\n\n    itemclick: {\n        valType: 'enumerated',\n        values: ['toggle', 'toggleothers', false],\n        dflt: 'toggle',\n        editType: 'legend',\n        description: [\n            'Determines the behavior on legend item click.',\n            '*toggle* toggles the visibility of the item clicked on the graph.',\n            '*toggleothers* makes the clicked item the sole visible item on the graph.',\n            '*false* disable legend item click interactions.'\n        ].join(' ')\n    },\n    itemdoubleclick: {\n        valType: 'enumerated',\n        values: ['toggle', 'toggleothers', false],\n        dflt: 'toggleothers',\n        editType: 'legend',\n        description: [\n            'Determines the behavior on legend item double-click.',\n            '*toggle* toggles the visibility of the item clicked on the graph.',\n            '*toggleothers* makes the clicked item the sole visible item on the graph.',\n            '*false* disable legend item double-click interactions.'\n        ].join(' ')\n    },\n\n    x: {\n        valType: 'number',\n        min: -2,\n        max: 3,\n        editType: 'legend',\n        description: [\n            'Sets the x position (in normalized coordinates) of the legend.',\n            'Defaults to *1.02* for vertical legends and',\n            'defaults to *0* for horizontal legends.'\n        ].join(' ')\n    },\n    xanchor: {\n        valType: 'enumerated',\n        values: ['auto', 'left', 'center', 'right'],\n        dflt: 'left',\n        editType: 'legend',\n        description: [\n            'Sets the legend\\'s horizontal position anchor.',\n            'This anchor binds the `x` position to the *left*, *center*',\n            'or *right* of the legend.',\n            'Value *auto* anchors legends to the right for `x` values greater than or equal to 2/3,',\n            'anchors legends to the left for `x` values less than or equal to 1/3 and',\n            'anchors legends with respect to their center otherwise.'\n        ].join(' ')\n    },\n    y: {\n        valType: 'number',\n        min: -2,\n        max: 3,\n        editType: 'legend',\n        description: [\n            'Sets the y position (in normalized coordinates) of the legend.',\n            'Defaults to *1* for vertical legends,',\n            'defaults to *-0.1* for horizontal legends on graphs w/o range sliders and',\n            'defaults to *1.1* for horizontal legends on graph with one or multiple range sliders.'\n        ].join(' ')\n    },\n    yanchor: {\n        valType: 'enumerated',\n        values: ['auto', 'top', 'middle', 'bottom'],\n        editType: 'legend',\n        description: [\n            'Sets the legend\\'s vertical position anchor',\n            'This anchor binds the `y` position to the *top*, *middle*',\n            'or *bottom* of the legend.',\n            'Value *auto* anchors legends at their bottom for `y` values less than or equal to 1/3,',\n            'anchors legends to at their top for `y` values greater than or equal to 2/3 and',\n            'anchors legends with respect to their middle otherwise.'\n        ].join(' ')\n    },\n    uirevision: {\n        valType: 'any',\n        editType: 'none',\n        description: [\n            'Controls persistence of legend-driven changes in trace and pie label',\n            'visibility. Defaults to `layout.uirevision`.'\n        ].join(' ')\n    },\n    valign: {\n        valType: 'enumerated',\n        values: ['top', 'middle', 'bottom'],\n        dflt: 'middle',\n        editType: 'legend',\n        description: [\n            'Sets the vertical alignment of the symbols with respect to their associated text.',\n        ].join(' ')\n    },\n    title: {\n        text: {\n            valType: 'string',\n            dflt: '',\n            editType: 'legend',\n            description: [\n                'Sets the title of the legend.'\n            ].join(' ')\n        },\n        font: fontAttrs({\n            editType: 'legend',\n            description: [\n                'Sets this legend\\'s title font.',\n                'Defaults to `legend.font` with its size increased about 20%.'\n            ].join(' '),\n        }),\n        side: {\n            valType: 'enumerated',\n            values: ['top', 'left', 'top left'],\n            editType: 'legend',\n            description: [\n                'Determines the location of legend\\'s title',\n                'with respect to the legend items.',\n                'Defaulted to *top* with `orientation` is *h*.',\n                'Defaulted to *left* with `orientation` is *v*.',\n                'The *top left* options could be used to expand',\n                'legend area in both x and y sides.'\n            ].join(' ')\n        },\n        editType: 'legend',\n    },\n\n    editType: 'legend'\n};\n","'use strict';\n\nmodule.exports = {\n    scrollBarWidth: 6,\n    scrollBarMinHeight: 20,\n    scrollBarColor: '#808BA4',\n    scrollBarMargin: 4,\n    scrollBarEnterAttrs: {rx: 20, ry: 3, width: 0, height: 0},\n\n    // number of px between legend title and (left) side of legend (always in x direction and from inner border)\n    titlePad: 2,\n    // number of px between each legend item (x and/or y direction)\n    itemGap: 5\n};\n","'use strict';\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar Template = require('../../plot_api/plot_template');\n\nvar attributes = require('./attributes');\nvar basePlotLayoutAttributes = require('../../plots/layout_attributes');\nvar helpers = require('./helpers');\n\n\nmodule.exports = function legendDefaults(layoutIn, layoutOut, fullData) {\n    var containerIn = layoutIn.legend || {};\n\n    var legendTraceCount = 0;\n    var legendReallyHasATrace = false;\n    var defaultOrder = 'normal';\n\n    for(var i = 0; i < fullData.length; i++) {\n        var trace = fullData[i];\n\n        if(!trace.visible) continue;\n\n        // Note that we explicitly count any trace that is either shown or\n        // *would* be shown by default, toward the two traces you need to\n        // ensure the legend is shown by default, because this can still help\n        // disambiguate.\n        if(trace.showlegend || (\n            trace._dfltShowLegend && !(\n                trace._module &&\n                trace._module.attributes &&\n                trace._module.attributes.showlegend &&\n                trace._module.attributes.showlegend.dflt === false\n            )\n        )) {\n            legendTraceCount++;\n            if(trace.showlegend) {\n                legendReallyHasATrace = true;\n                // Always show the legend by default if there's a pie,\n                // or if there's only one trace but it's explicitly shown\n                if(Registry.traceIs(trace, 'pie-like') ||\n                    trace._input.showlegend === true\n                ) {\n                    legendTraceCount++;\n                }\n            }\n        }\n\n        if((Registry.traceIs(trace, 'bar') && layoutOut.barmode === 'stack') ||\n                ['tonextx', 'tonexty'].indexOf(trace.fill) !== -1) {\n            defaultOrder = helpers.isGrouped({traceorder: defaultOrder}) ?\n                'grouped+reversed' : 'reversed';\n        }\n\n        if(trace.legendgroup !== undefined && trace.legendgroup !== '') {\n            defaultOrder = helpers.isReversed({traceorder: defaultOrder}) ?\n                'reversed+grouped' : 'grouped';\n        }\n    }\n\n    var showLegend = Lib.coerce(layoutIn, layoutOut,\n        basePlotLayoutAttributes, 'showlegend',\n        legendReallyHasATrace && legendTraceCount > 1);\n\n    if(showLegend === false && !containerIn.uirevision) return;\n\n    var containerOut = Template.newContainer(layoutOut, 'legend');\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(containerIn, containerOut, attributes, attr, dflt);\n    }\n\n    coerce('uirevision', layoutOut.uirevision);\n\n    if(showLegend === false) return;\n\n    coerce('bgcolor', layoutOut.paper_bgcolor);\n    coerce('bordercolor');\n    coerce('borderwidth');\n    var itemFont = Lib.coerceFont(coerce, 'font', layoutOut.font);\n\n    var orientation = coerce('orientation');\n    var isHorizontal = orientation === 'h';\n    var defaultX, defaultY, defaultYAnchor;\n\n    if(isHorizontal) {\n        defaultX = 0;\n\n        if(Registry.getComponentMethod('rangeslider', 'isVisible')(layoutIn.xaxis)) {\n            defaultY = 1.1;\n            defaultYAnchor = 'bottom';\n        } else {\n            // maybe use y=1.1 / yanchor=bottom as above\n            //   to avoid https://github.com/plotly/plotly.js/issues/1199\n            //   in v3\n            defaultY = -0.1;\n            defaultYAnchor = 'top';\n        }\n    } else {\n        defaultX = 1.02;\n        defaultY = 1;\n        defaultYAnchor = 'auto';\n    }\n\n    coerce('traceorder', defaultOrder);\n    if(helpers.isGrouped(layoutOut.legend)) coerce('tracegroupgap');\n\n    coerce('itemsizing');\n    coerce('itemwidth');\n\n    coerce('itemclick');\n    coerce('itemdoubleclick');\n\n    coerce('x', defaultX);\n    coerce('xanchor');\n    coerce('y', defaultY);\n    coerce('yanchor', defaultYAnchor);\n    coerce('valign');\n    Lib.noneOrAll(containerIn, containerOut, ['x', 'y']);\n\n    var titleText = coerce('title.text');\n    if(titleText) {\n        coerce('title.side', isHorizontal ? 'left' : 'top');\n        var dfltTitleFont = Lib.extendFlat({}, itemFont, {\n            size: Lib.bigFont(itemFont.size)\n        });\n\n        Lib.coerceFont(coerce, 'title.font', dfltTitleFont);\n    }\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Lib = require('../../lib');\nvar Plots = require('../../plots/plots');\nvar Registry = require('../../registry');\nvar Events = require('../../lib/events');\nvar dragElement = require('../dragelement');\nvar Drawing = require('../drawing');\nvar Color = require('../color');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar handleClick = require('./handle_click');\n\nvar constants = require('./constants');\nvar alignmentConstants = require('../../constants/alignment');\nvar LINE_SPACING = alignmentConstants.LINE_SPACING;\nvar FROM_TL = alignmentConstants.FROM_TL;\nvar FROM_BR = alignmentConstants.FROM_BR;\n\nvar getLegendData = require('./get_legend_data');\nvar style = require('./style');\nvar helpers = require('./helpers');\n\nvar MAIN_TITLE = 1;\n\nmodule.exports = function draw(gd, opts) {\n    if(!opts) opts = gd._fullLayout.legend || {};\n    return _draw(gd, opts);\n};\n\nfunction _draw(gd, legendObj) {\n    var fullLayout = gd._fullLayout;\n    var clipId = 'legend' + fullLayout._uid;\n    var layer;\n\n    var inHover = legendObj._inHover;\n    if(inHover) {\n        layer = legendObj.layer;\n        clipId += '-hover';\n    } else {\n        layer = fullLayout._infolayer;\n    }\n\n    if(!layer) return;\n\n    if(!gd._legendMouseDownTime) gd._legendMouseDownTime = 0;\n\n    var legendData;\n    if(!inHover) {\n        if(!gd.calcdata) return;\n        legendData = fullLayout.showlegend && getLegendData(gd.calcdata, legendObj);\n    } else {\n        if(!legendObj.entries) return;\n        legendData = getLegendData(legendObj.entries, legendObj);\n    }\n\n    var hiddenSlices = fullLayout.hiddenlabels || [];\n\n    if(!inHover && (!fullLayout.showlegend || !legendData.length)) {\n        layer.selectAll('.legend').remove();\n        fullLayout._topdefs.select('#' + clipId).remove();\n        return Plots.autoMargin(gd, 'legend');\n    }\n\n    var legend = Lib.ensureSingle(layer, 'g', 'legend', function(s) {\n        if(!inHover) s.attr('pointer-events', 'all');\n    });\n\n    var clipPath = Lib.ensureSingleById(fullLayout._topdefs, 'clipPath', clipId, function(s) {\n        s.append('rect');\n    });\n\n    var bg = Lib.ensureSingle(legend, 'rect', 'bg', function(s) {\n        s.attr('shape-rendering', 'crispEdges');\n    });\n    bg.call(Color.stroke, legendObj.bordercolor)\n        .call(Color.fill, legendObj.bgcolor)\n        .style('stroke-width', legendObj.borderwidth + 'px');\n\n    var scrollBox = Lib.ensureSingle(legend, 'g', 'scrollbox');\n\n    var title = legendObj.title;\n    legendObj._titleWidth = 0;\n    legendObj._titleHeight = 0;\n    if(title.text) {\n        var titleEl = Lib.ensureSingle(scrollBox, 'text', 'legendtitletext');\n        titleEl.attr('text-anchor', 'start')\n            .call(Drawing.font, title.font)\n            .text(title.text);\n\n        textLayout(titleEl, scrollBox, gd, legendObj, MAIN_TITLE); // handle mathjax or multi-line text and compute title height\n    } else {\n        scrollBox.selectAll('.legendtitletext').remove();\n    }\n\n    var scrollBar = Lib.ensureSingle(legend, 'rect', 'scrollbar', function(s) {\n        s.attr(constants.scrollBarEnterAttrs)\n         .call(Color.fill, constants.scrollBarColor);\n    });\n\n    var groups = scrollBox.selectAll('g.groups').data(legendData);\n    groups.enter().append('g').attr('class', 'groups');\n    groups.exit().remove();\n\n    var traces = groups.selectAll('g.traces').data(Lib.identity);\n    traces.enter().append('g').attr('class', 'traces');\n    traces.exit().remove();\n\n    traces.style('opacity', function(d) {\n        var trace = d[0].trace;\n        if(Registry.traceIs(trace, 'pie-like')) {\n            return hiddenSlices.indexOf(d[0].label) !== -1 ? 0.5 : 1;\n        } else {\n            return trace.visible === 'legendonly' ? 0.5 : 1;\n        }\n    })\n    .each(function() { d3.select(this).call(drawTexts, gd, legendObj); })\n    .call(style, gd, legendObj)\n    .each(function() { if(!inHover) d3.select(this).call(setupTraceToggle, gd); });\n\n    Lib.syncOrAsync([\n        Plots.previousPromises,\n        function() { return computeLegendDimensions(gd, groups, traces, legendObj); },\n        function() {\n            // IF expandMargin return a Promise (which is truthy),\n            // we're under a doAutoMargin redraw, so we don't have to\n            // draw the remaining pieces below\n            if(!inHover && expandMargin(gd)) return;\n\n            var gs = fullLayout._size;\n            var bw = legendObj.borderwidth;\n\n            var lx = gs.l + gs.w * legendObj.x - FROM_TL[getXanchor(legendObj)] * legendObj._width;\n            var ly = gs.t + gs.h * (1 - legendObj.y) - FROM_TL[getYanchor(legendObj)] * legendObj._effHeight;\n\n            if(!inHover && fullLayout.margin.autoexpand) {\n                var lx0 = lx;\n                var ly0 = ly;\n\n                lx = Lib.constrain(lx, 0, fullLayout.width - legendObj._width);\n                ly = Lib.constrain(ly, 0, fullLayout.height - legendObj._effHeight);\n\n                if(lx !== lx0) {\n                    Lib.log('Constrain legend.x to make legend fit inside graph');\n                }\n                if(ly !== ly0) {\n                    Lib.log('Constrain legend.y to make legend fit inside graph');\n                }\n            }\n\n            // Set size and position of all the elements that make up a legend:\n            // legend, background and border, scroll box and scroll bar as well as title\n            if(!inHover) Drawing.setTranslate(legend, lx, ly);\n\n            // to be safe, remove previous listeners\n            scrollBar.on('.drag', null);\n            legend.on('wheel', null);\n\n            if(inHover || legendObj._height <= legendObj._maxHeight || gd._context.staticPlot) {\n                // if scrollbar should not be shown.\n                var height = legendObj._effHeight;\n\n                // if unified hover, let it be its full size\n                if(inHover) height = legendObj._height;\n\n                bg.attr({\n                    width: legendObj._width - bw,\n                    height: height - bw,\n                    x: bw / 2,\n                    y: bw / 2\n                });\n\n                Drawing.setTranslate(scrollBox, 0, 0);\n\n                clipPath.select('rect').attr({\n                    width: legendObj._width - 2 * bw,\n                    height: height - 2 * bw,\n                    x: bw,\n                    y: bw\n                });\n\n                Drawing.setClipUrl(scrollBox, clipId, gd);\n\n                Drawing.setRect(scrollBar, 0, 0, 0, 0);\n                delete legendObj._scrollY;\n            } else {\n                var scrollBarHeight = Math.max(constants.scrollBarMinHeight,\n                    legendObj._effHeight * legendObj._effHeight / legendObj._height);\n                var scrollBarYMax = legendObj._effHeight -\n                    scrollBarHeight -\n                    2 * constants.scrollBarMargin;\n                var scrollBoxYMax = legendObj._height - legendObj._effHeight;\n                var scrollRatio = scrollBarYMax / scrollBoxYMax;\n\n                var scrollBoxY = Math.min(legendObj._scrollY || 0, scrollBoxYMax);\n\n                // increase the background and clip-path width\n                // by the scrollbar width and margin\n                bg.attr({\n                    width: legendObj._width -\n                        2 * bw +\n                        constants.scrollBarWidth +\n                        constants.scrollBarMargin,\n                    height: legendObj._effHeight - bw,\n                    x: bw / 2,\n                    y: bw / 2\n                });\n\n                clipPath.select('rect').attr({\n                    width: legendObj._width -\n                        2 * bw +\n                        constants.scrollBarWidth +\n                        constants.scrollBarMargin,\n                    height: legendObj._effHeight - 2 * bw,\n                    x: bw,\n                    y: bw + scrollBoxY\n                });\n\n                Drawing.setClipUrl(scrollBox, clipId, gd);\n\n                scrollHandler(scrollBoxY, scrollBarHeight, scrollRatio);\n\n                // scroll legend by mousewheel or touchpad swipe up/down\n                legend.on('wheel', function() {\n                    scrollBoxY = Lib.constrain(\n                        legendObj._scrollY +\n                            ((d3.event.deltaY / scrollBarYMax) * scrollBoxYMax),\n                        0, scrollBoxYMax);\n                    scrollHandler(scrollBoxY, scrollBarHeight, scrollRatio);\n                    if(scrollBoxY !== 0 && scrollBoxY !== scrollBoxYMax) {\n                        d3.event.preventDefault();\n                    }\n                });\n\n                var eventY0, eventY1, scrollBoxY0;\n\n                var getScrollBarDragY = function(scrollBoxY0, eventY0, eventY1) {\n                    var y = ((eventY1 - eventY0) / scrollRatio) + scrollBoxY0;\n                    return Lib.constrain(y, 0, scrollBoxYMax);\n                };\n\n                var getNaturalDragY = function(scrollBoxY0, eventY0, eventY1) {\n                    var y = ((eventY0 - eventY1) / scrollRatio) + scrollBoxY0;\n                    return Lib.constrain(y, 0, scrollBoxYMax);\n                };\n\n                // scroll legend by dragging scrollBAR\n                var scrollBarDrag = d3.behavior.drag()\n                .on('dragstart', function() {\n                    var e = d3.event.sourceEvent;\n                    if(e.type === 'touchstart') {\n                        eventY0 = e.changedTouches[0].clientY;\n                    } else {\n                        eventY0 = e.clientY;\n                    }\n                    scrollBoxY0 = scrollBoxY;\n                })\n                .on('drag', function() {\n                    var e = d3.event.sourceEvent;\n                    if(e.buttons === 2 || e.ctrlKey) return;\n                    if(e.type === 'touchmove') {\n                        eventY1 = e.changedTouches[0].clientY;\n                    } else {\n                        eventY1 = e.clientY;\n                    }\n                    scrollBoxY = getScrollBarDragY(scrollBoxY0, eventY0, eventY1);\n                    scrollHandler(scrollBoxY, scrollBarHeight, scrollRatio);\n                });\n                scrollBar.call(scrollBarDrag);\n\n                // scroll legend by touch-dragging scrollBOX\n                var scrollBoxTouchDrag = d3.behavior.drag()\n                .on('dragstart', function() {\n                    var e = d3.event.sourceEvent;\n                    if(e.type === 'touchstart') {\n                        eventY0 = e.changedTouches[0].clientY;\n                        scrollBoxY0 = scrollBoxY;\n                    }\n                })\n                .on('drag', function() {\n                    var e = d3.event.sourceEvent;\n                    if(e.type === 'touchmove') {\n                        eventY1 = e.changedTouches[0].clientY;\n                        scrollBoxY = getNaturalDragY(scrollBoxY0, eventY0, eventY1);\n                        scrollHandler(scrollBoxY, scrollBarHeight, scrollRatio);\n                    }\n                });\n                scrollBox.call(scrollBoxTouchDrag);\n            }\n\n            function scrollHandler(scrollBoxY, scrollBarHeight, scrollRatio) {\n                legendObj._scrollY = gd._fullLayout.legend._scrollY = scrollBoxY;\n                Drawing.setTranslate(scrollBox, 0, -scrollBoxY);\n\n                Drawing.setRect(\n                    scrollBar,\n                    legendObj._width,\n                    constants.scrollBarMargin + scrollBoxY * scrollRatio,\n                    constants.scrollBarWidth,\n                    scrollBarHeight\n                );\n                clipPath.select('rect').attr('y', bw + scrollBoxY);\n            }\n\n            if(gd._context.edits.legendPosition) {\n                var xf, yf, x0, y0;\n\n                legend.classed('cursor-move', true);\n\n                dragElement.init({\n                    element: legend.node(),\n                    gd: gd,\n                    prepFn: function() {\n                        var transform = Drawing.getTranslate(legend);\n                        x0 = transform.x;\n                        y0 = transform.y;\n                    },\n                    moveFn: function(dx, dy) {\n                        var newX = x0 + dx;\n                        var newY = y0 + dy;\n\n                        Drawing.setTranslate(legend, newX, newY);\n\n                        xf = dragElement.align(newX, 0, gs.l, gs.l + gs.w, legendObj.xanchor);\n                        yf = dragElement.align(newY, 0, gs.t + gs.h, gs.t, legendObj.yanchor);\n                    },\n                    doneFn: function() {\n                        if(xf !== undefined && yf !== undefined) {\n                            Registry.call('_guiRelayout', gd, {'legend.x': xf, 'legend.y': yf});\n                        }\n                    },\n                    clickFn: function(numClicks, e) {\n                        var clickedTrace = layer.selectAll('g.traces').filter(function() {\n                            var bbox = this.getBoundingClientRect();\n                            return (\n                                e.clientX >= bbox.left && e.clientX <= bbox.right &&\n                                e.clientY >= bbox.top && e.clientY <= bbox.bottom\n                            );\n                        });\n                        if(clickedTrace.size() > 0) {\n                            clickOrDoubleClick(gd, legend, clickedTrace, numClicks, e);\n                        }\n                    }\n                });\n            }\n        }], gd);\n}\n\nfunction clickOrDoubleClick(gd, legend, legendItem, numClicks, evt) {\n    var trace = legendItem.data()[0][0].trace;\n    var evtData = {\n        event: evt,\n        node: legendItem.node(),\n        curveNumber: trace.index,\n        expandedIndex: trace._expandedIndex,\n        data: gd.data,\n        layout: gd.layout,\n        frames: gd._transitionData._frames,\n        config: gd._context,\n        fullData: gd._fullData,\n        fullLayout: gd._fullLayout\n    };\n\n    if(trace._group) {\n        evtData.group = trace._group;\n    }\n    if(Registry.traceIs(trace, 'pie-like')) {\n        evtData.label = legendItem.datum()[0].label;\n    }\n\n    var clickVal = Events.triggerHandler(gd, 'plotly_legendclick', evtData);\n    if(clickVal === false) return;\n\n    if(numClicks === 1) {\n        legend._clickTimeout = setTimeout(function() {\n            if(!gd._fullLayout) return;\n            handleClick(legendItem, gd, numClicks);\n        }, gd._context.doubleClickDelay);\n    } else if(numClicks === 2) {\n        if(legend._clickTimeout) clearTimeout(legend._clickTimeout);\n        gd._legendMouseDownTime = 0;\n\n        var dblClickVal = Events.triggerHandler(gd, 'plotly_legenddoubleclick', evtData);\n        if(dblClickVal !== false) handleClick(legendItem, gd, numClicks);\n    }\n}\n\nfunction drawTexts(g, gd, legendObj) {\n    var legendItem = g.data()[0][0];\n    var trace = legendItem.trace;\n    var isPieLike = Registry.traceIs(trace, 'pie-like');\n    var isEditable = !legendObj._inHover && gd._context.edits.legendText && !isPieLike;\n    var maxNameLength = legendObj._maxNameLength;\n\n    var name, font;\n    if(legendItem.groupTitle) {\n        name = legendItem.groupTitle.text;\n        font = legendItem.groupTitle.font;\n    } else {\n        font = legendObj.font;\n        if(!legendObj.entries) {\n            name = isPieLike ? legendItem.label : trace.name;\n            if(trace._meta) {\n                name = Lib.templateString(name, trace._meta);\n            }\n        } else {\n            name = legendItem.text;\n        }\n    }\n\n    var textEl = Lib.ensureSingle(g, 'text', 'legendtext');\n\n    textEl.attr('text-anchor', 'start')\n        .call(Drawing.font, font)\n        .text(isEditable ? ensureLength(name, maxNameLength) : name);\n\n    var textGap = legendObj.itemwidth + constants.itemGap * 2;\n    svgTextUtils.positionText(textEl, textGap, 0);\n\n    if(isEditable) {\n        textEl.call(svgTextUtils.makeEditable, {gd: gd, text: name})\n            .call(textLayout, g, gd, legendObj)\n            .on('edit', function(newName) {\n                this.text(ensureLength(newName, maxNameLength))\n                    .call(textLayout, g, gd, legendObj);\n\n                var fullInput = legendItem.trace._fullInput || {};\n                var update = {};\n\n                if(Registry.hasTransform(fullInput, 'groupby')) {\n                    var groupbyIndices = Registry.getTransformIndices(fullInput, 'groupby');\n                    var index = groupbyIndices[groupbyIndices.length - 1];\n\n                    var kcont = Lib.keyedContainer(fullInput, 'transforms[' + index + '].styles', 'target', 'value.name');\n\n                    kcont.set(legendItem.trace._group, newName);\n\n                    update = kcont.constructUpdate();\n                } else {\n                    update.name = newName;\n                }\n\n                return Registry.call('_guiRestyle', gd, update, trace.index);\n            });\n    } else {\n        textLayout(textEl, g, gd, legendObj);\n    }\n}\n\n/*\n * Make sure we have a reasonably clickable region.\n * If this string is missing or very short, pad it with spaces out to at least\n * 4 characters, up to the max length of other labels, on the assumption that\n * most characters are wider than spaces so a string of spaces will usually be\n * no wider than the real labels.\n */\nfunction ensureLength(str, maxLength) {\n    var targetLength = Math.max(4, maxLength);\n    if(str && str.trim().length >= targetLength / 2) return str;\n    str = str || '';\n    for(var i = targetLength - str.length; i > 0; i--) str += ' ';\n    return str;\n}\n\nfunction setupTraceToggle(g, gd) {\n    var doubleClickDelay = gd._context.doubleClickDelay;\n    var newMouseDownTime;\n    var numClicks = 1;\n\n    var traceToggle = Lib.ensureSingle(g, 'rect', 'legendtoggle', function(s) {\n        if(!gd._context.staticPlot) {\n            s.style('cursor', 'pointer').attr('pointer-events', 'all');\n        }\n        s.call(Color.fill, 'rgba(0,0,0,0)');\n    });\n\n    if(gd._context.staticPlot) return;\n\n    traceToggle.on('mousedown', function() {\n        newMouseDownTime = (new Date()).getTime();\n        if(newMouseDownTime - gd._legendMouseDownTime < doubleClickDelay) {\n            // in a click train\n            numClicks += 1;\n        } else {\n            // new click train\n            numClicks = 1;\n            gd._legendMouseDownTime = newMouseDownTime;\n        }\n    });\n    traceToggle.on('mouseup', function() {\n        if(gd._dragged || gd._editing) return;\n        var legend = gd._fullLayout.legend;\n\n        if((new Date()).getTime() - gd._legendMouseDownTime > doubleClickDelay) {\n            numClicks = Math.max(numClicks - 1, 1);\n        }\n\n        clickOrDoubleClick(gd, legend, g, numClicks, d3.event);\n    });\n}\n\nfunction textLayout(s, g, gd, legendObj, aTitle) {\n    if(legendObj._inHover) s.attr('data-notex', true); // do not process MathJax for unified hover\n    svgTextUtils.convertToTspans(s, gd, function() {\n        computeTextDimensions(g, gd, legendObj, aTitle);\n    });\n}\n\nfunction computeTextDimensions(g, gd, legendObj, aTitle) {\n    var legendItem = g.data()[0][0];\n    if(!legendObj._inHover && legendItem && !legendItem.trace.showlegend) {\n        g.remove();\n        return;\n    }\n\n    var mathjaxGroup = g.select('g[class*=math-group]');\n    var mathjaxNode = mathjaxGroup.node();\n    if(!legendObj) legendObj = gd._fullLayout.legend;\n    var bw = legendObj.borderwidth;\n    var font;\n    if(aTitle === MAIN_TITLE) {\n        font = legendObj.title.font;\n    } else if(legendItem.groupTitle) {\n        font = legendItem.groupTitle.font;\n    } else {\n        font = legendObj.font;\n    }\n    var lineHeight = font.size * LINE_SPACING;\n    var height, width;\n\n    if(mathjaxNode) {\n        var mathjaxBB = Drawing.bBox(mathjaxNode);\n\n        height = mathjaxBB.height;\n        width = mathjaxBB.width;\n\n        if(aTitle === MAIN_TITLE) {\n            Drawing.setTranslate(mathjaxGroup, bw, bw + height * 0.75);\n        } else { // legend item\n            Drawing.setTranslate(mathjaxGroup, 0, height * 0.25);\n        }\n    } else {\n        var textEl = g.select(aTitle === MAIN_TITLE ?\n            '.legendtitletext' : '.legendtext'\n        );\n        var textLines = svgTextUtils.lineCount(textEl);\n        var textNode = textEl.node();\n\n        height = lineHeight * textLines;\n        width = textNode ? Drawing.bBox(textNode).width : 0;\n\n        // approximation to height offset to center the font\n        // to avoid getBoundingClientRect\n        if(aTitle === MAIN_TITLE) {\n            if(legendObj.title.side === 'left') {\n                // add extra space between legend title and itmes\n                width += constants.itemGap * 2;\n            }\n\n            svgTextUtils.positionText(textEl,\n                bw + constants.titlePad,\n                bw + lineHeight\n            );\n        } else { // legend item\n            var x = constants.itemGap * 2 + legendObj.itemwidth;\n            if(legendItem.groupTitle) {\n                x = constants.itemGap;\n                width -= legendObj.itemwidth;\n            }\n\n            svgTextUtils.positionText(textEl,\n                x,\n                -lineHeight * ((textLines - 1) / 2 - 0.3)\n            );\n        }\n    }\n\n    if(aTitle === MAIN_TITLE) {\n        legendObj._titleWidth = width;\n        legendObj._titleHeight = height;\n    } else { // legend item\n        legendItem.lineHeight = lineHeight;\n        legendItem.height = Math.max(height, 16) + 3;\n        legendItem.width = width;\n    }\n}\n\nfunction getTitleSize(legendObj) {\n    var w = 0;\n    var h = 0;\n\n    var side = legendObj.title.side;\n    if(side) {\n        if(side.indexOf('left') !== -1) {\n            w = legendObj._titleWidth;\n        }\n        if(side.indexOf('top') !== -1) {\n            h = legendObj._titleHeight;\n        }\n    }\n\n    return [w, h];\n}\n\n/*\n * Computes in fullLayout.legend:\n *\n *  - _height: legend height including items past scrollbox height\n *  - _maxHeight: maximum legend height before scrollbox is required\n *  - _effHeight: legend height w/ or w/o scrollbox\n *\n *  - _width: legend width\n *  - _maxWidth (for orientation:h only): maximum width before starting new row\n */\nfunction computeLegendDimensions(gd, groups, traces, legendObj) {\n    var fullLayout = gd._fullLayout;\n    if(!legendObj) legendObj = fullLayout.legend;\n    var gs = fullLayout._size;\n\n    var isVertical = helpers.isVertical(legendObj);\n    var isGrouped = helpers.isGrouped(legendObj);\n\n    var bw = legendObj.borderwidth;\n    var bw2 = 2 * bw;\n    var itemGap = constants.itemGap;\n    var textGap = legendObj.itemwidth + itemGap * 2;\n    var endPad = 2 * (bw + itemGap);\n\n    var yanchor = getYanchor(legendObj);\n    var isBelowPlotArea = legendObj.y < 0 || (legendObj.y === 0 && yanchor === 'top');\n    var isAbovePlotArea = legendObj.y > 1 || (legendObj.y === 1 && yanchor === 'bottom');\n\n    var traceGroupGap = legendObj.tracegroupgap;\n\n    // - if below/above plot area, give it the maximum potential margin-push value\n    // - otherwise, extend the height of the plot area\n    legendObj._maxHeight = Math.max(\n        (isBelowPlotArea || isAbovePlotArea) ? fullLayout.height / 2 : gs.h,\n        30\n    );\n\n    var toggleRectWidth = 0;\n    legendObj._width = 0;\n    legendObj._height = 0;\n    var titleSize = getTitleSize(legendObj);\n\n    if(isVertical) {\n        traces.each(function(d) {\n            var h = d[0].height;\n            Drawing.setTranslate(this,\n                bw + titleSize[0],\n                bw + titleSize[1] + legendObj._height + h / 2 + itemGap\n            );\n            legendObj._height += h;\n            legendObj._width = Math.max(legendObj._width, d[0].width);\n        });\n\n        toggleRectWidth = textGap + legendObj._width;\n        legendObj._width += itemGap + textGap + bw2;\n        legendObj._height += endPad;\n\n        if(isGrouped) {\n            groups.each(function(d, i) {\n                Drawing.setTranslate(this, 0, i * legendObj.tracegroupgap);\n            });\n            legendObj._height += (legendObj._lgroupsLength - 1) * legendObj.tracegroupgap;\n        }\n    } else {\n        var xanchor = getXanchor(legendObj);\n        var isLeftOfPlotArea = legendObj.x < 0 || (legendObj.x === 0 && xanchor === 'right');\n        var isRightOfPlotArea = legendObj.x > 1 || (legendObj.x === 1 && xanchor === 'left');\n        var isBeyondPlotAreaY = isAbovePlotArea || isBelowPlotArea;\n        var hw = fullLayout.width / 2;\n\n        // - if placed within x-margins, extend the width of the plot area\n        // - else if below/above plot area and anchored in the margin, extend to opposite margin,\n        // - otherwise give it the maximum potential margin-push value\n        legendObj._maxWidth = Math.max(\n            isLeftOfPlotArea ? ((isBeyondPlotAreaY && xanchor === 'left') ? gs.l + gs.w : hw) :\n            isRightOfPlotArea ? ((isBeyondPlotAreaY && xanchor === 'right') ? gs.r + gs.w : hw) :\n            gs.w,\n        2 * textGap);\n        var maxItemWidth = 0;\n        var combinedItemWidth = 0;\n        traces.each(function(d) {\n            var w = d[0].width + textGap;\n            maxItemWidth = Math.max(maxItemWidth, w);\n            combinedItemWidth += w;\n        });\n\n        toggleRectWidth = null;\n        var maxRowWidth = 0;\n\n        if(isGrouped) {\n            var maxGroupHeightInRow = 0;\n            var groupOffsetX = 0;\n            var groupOffsetY = 0;\n            groups.each(function() {\n                var maxWidthInGroup = 0;\n                var offsetY = 0;\n                d3.select(this).selectAll('g.traces').each(function(d) {\n                    var h = d[0].height;\n                    Drawing.setTranslate(this,\n                        titleSize[0],\n                        titleSize[1] + bw + itemGap + h / 2 + offsetY\n                    );\n                    offsetY += h;\n                    maxWidthInGroup = Math.max(maxWidthInGroup, textGap + d[0].width);\n                });\n                maxGroupHeightInRow = Math.max(maxGroupHeightInRow, offsetY);\n\n                var next = maxWidthInGroup + itemGap;\n\n                if((next + bw + groupOffsetX) > legendObj._maxWidth) {\n                    maxRowWidth = Math.max(maxRowWidth, groupOffsetX);\n                    groupOffsetX = 0;\n                    groupOffsetY += maxGroupHeightInRow + traceGroupGap;\n                    maxGroupHeightInRow = offsetY;\n                }\n\n                Drawing.setTranslate(this, groupOffsetX, groupOffsetY);\n\n                groupOffsetX += next;\n            });\n\n            legendObj._width = Math.max(maxRowWidth, groupOffsetX) + bw;\n            legendObj._height = groupOffsetY + maxGroupHeightInRow + endPad;\n        } else {\n            var nTraces = traces.size();\n            var oneRowLegend = (combinedItemWidth + bw2 + (nTraces - 1) * itemGap) < legendObj._maxWidth;\n\n            var maxItemHeightInRow = 0;\n            var offsetX = 0;\n            var offsetY = 0;\n            var rowWidth = 0;\n            traces.each(function(d) {\n                var h = d[0].height;\n                var w = textGap + d[0].width;\n                var next = (oneRowLegend ? w : maxItemWidth) + itemGap;\n\n                if((next + bw + offsetX - itemGap) >= legendObj._maxWidth) {\n                    maxRowWidth = Math.max(maxRowWidth, rowWidth);\n                    offsetX = 0;\n                    offsetY += maxItemHeightInRow;\n                    legendObj._height += maxItemHeightInRow;\n                    maxItemHeightInRow = 0;\n                }\n\n                Drawing.setTranslate(this,\n                    titleSize[0] + bw + offsetX,\n                    titleSize[1] + bw + offsetY + h / 2 + itemGap\n                );\n\n                rowWidth = offsetX + w + itemGap;\n                offsetX += next;\n                maxItemHeightInRow = Math.max(maxItemHeightInRow, h);\n            });\n\n            if(oneRowLegend) {\n                legendObj._width = offsetX + bw2;\n                legendObj._height = maxItemHeightInRow + endPad;\n            } else {\n                legendObj._width = Math.max(maxRowWidth, rowWidth) + bw2;\n                legendObj._height += maxItemHeightInRow + endPad;\n            }\n        }\n    }\n\n    legendObj._width = Math.ceil(\n        Math.max(\n            legendObj._width + titleSize[0],\n            legendObj._titleWidth + 2 * (bw + constants.titlePad)\n        )\n    );\n\n    legendObj._height = Math.ceil(\n        Math.max(\n            legendObj._height + titleSize[1],\n            legendObj._titleHeight + 2 * (bw + constants.itemGap)\n        )\n    );\n\n    legendObj._effHeight = Math.min(legendObj._height, legendObj._maxHeight);\n\n    var edits = gd._context.edits;\n    var isEditable = edits.legendText || edits.legendPosition;\n    traces.each(function(d) {\n        var traceToggle = d3.select(this).select('.legendtoggle');\n        var h = d[0].height;\n        var w = isEditable ? textGap : (toggleRectWidth || (textGap + d[0].width));\n        if(!isVertical) w += itemGap / 2;\n        Drawing.setRect(traceToggle, 0, -h / 2, w, h);\n    });\n}\n\nfunction expandMargin(gd) {\n    var fullLayout = gd._fullLayout;\n    var legendObj = fullLayout.legend;\n    var xanchor = getXanchor(legendObj);\n    var yanchor = getYanchor(legendObj);\n\n    return Plots.autoMargin(gd, 'legend', {\n        x: legendObj.x,\n        y: legendObj.y,\n        l: legendObj._width * (FROM_TL[xanchor]),\n        r: legendObj._width * (FROM_BR[xanchor]),\n        b: legendObj._effHeight * (FROM_BR[yanchor]),\n        t: legendObj._effHeight * (FROM_TL[yanchor])\n    });\n}\n\nfunction getXanchor(legendObj) {\n    return Lib.isRightAnchor(legendObj) ? 'right' :\n        Lib.isCenterAnchor(legendObj) ? 'center' :\n        'left';\n}\n\nfunction getYanchor(legendObj) {\n    return Lib.isBottomAnchor(legendObj) ? 'bottom' :\n        Lib.isMiddleAnchor(legendObj) ? 'middle' :\n        'top';\n}\n","'use strict';\n\nvar Registry = require('../../registry');\nvar helpers = require('./helpers');\n\nmodule.exports = function getLegendData(calcdata, opts) {\n    var grouped = helpers.isGrouped(opts);\n    var reversed = helpers.isReversed(opts);\n\n    var lgroupToTraces = {};\n    var lgroups = [];\n    var hasOneNonBlankGroup = false;\n    var slicesShown = {};\n    var lgroupi = 0;\n    var maxNameLength = 0;\n    var i, j;\n\n    function addOneItem(legendGroup, legendItem) {\n        // each '' legend group is treated as a separate group\n        if(legendGroup === '' || !helpers.isGrouped(opts)) {\n            // TODO: check this against fullData legendgroups?\n            var uniqueGroup = '~~i' + lgroupi;\n            lgroups.push(uniqueGroup);\n            lgroupToTraces[uniqueGroup] = [legendItem];\n            lgroupi++;\n        } else if(lgroups.indexOf(legendGroup) === -1) {\n            lgroups.push(legendGroup);\n            hasOneNonBlankGroup = true;\n            lgroupToTraces[legendGroup] = [legendItem];\n        } else {\n            lgroupToTraces[legendGroup].push(legendItem);\n        }\n    }\n\n    // build an { legendgroup: [cd0, cd0], ... } object\n    for(i = 0; i < calcdata.length; i++) {\n        var cd = calcdata[i];\n        var cd0 = cd[0];\n        var trace = cd0.trace;\n        var lgroup = trace.legendgroup;\n\n        if(!opts._inHover && (!trace.visible || !trace.showlegend)) continue;\n\n        if(Registry.traceIs(trace, 'pie-like')) {\n            if(!slicesShown[lgroup]) slicesShown[lgroup] = {};\n\n            for(j = 0; j < cd.length; j++) {\n                var labelj = cd[j].label;\n\n                if(!slicesShown[lgroup][labelj]) {\n                    addOneItem(lgroup, {\n                        label: labelj,\n                        color: cd[j].color,\n                        i: cd[j].i,\n                        trace: trace,\n                        pts: cd[j].pts\n                    });\n\n                    slicesShown[lgroup][labelj] = true;\n                    maxNameLength = Math.max(maxNameLength, (labelj || '').length);\n                }\n            }\n        } else {\n            addOneItem(lgroup, cd0);\n            maxNameLength = Math.max(maxNameLength, (trace.name || '').length);\n        }\n    }\n\n    // won't draw a legend in this case\n    if(!lgroups.length) return [];\n\n    // collapse all groups into one if all groups are blank\n    var shouldCollapse = !hasOneNonBlankGroup || !grouped;\n\n    var legendData = [];\n    for(i = 0; i < lgroups.length; i++) {\n        var t = lgroupToTraces[lgroups[i]];\n        if(shouldCollapse) {\n            legendData.push(t[0]);\n        } else {\n            legendData.push(t);\n        }\n    }\n    if(shouldCollapse) legendData = [legendData];\n\n    for(i = 0; i < legendData.length; i++) {\n        // find minimum rank within group\n        var groupMinRank = Infinity;\n        for(j = 0; j < legendData[i].length; j++) {\n            var rank = legendData[i][j].trace.legendrank;\n            if(groupMinRank > rank) groupMinRank = rank;\n        }\n\n        // record on first group element\n        legendData[i][0]._groupMinRank = groupMinRank;\n        legendData[i][0]._preGroupSort = i;\n    }\n\n    var orderFn1 = function(a, b) {\n        return (\n            (a[0]._groupMinRank - b[0]._groupMinRank) ||\n            (a[0]._preGroupSort - b[0]._preGroupSort) // fallback for old Chrome < 70 https://bugs.chromium.org/p/v8/issues/detail?id=90\n        );\n    };\n\n    var orderFn2 = function(a, b) {\n        return (\n            (a.trace.legendrank - b.trace.legendrank) ||\n            (a._preSort - b._preSort) // fallback for old Chrome < 70 https://bugs.chromium.org/p/v8/issues/detail?id=90\n        );\n    };\n\n    // sort considering minimum group legendrank\n    legendData.forEach(function(a, k) { a[0]._preGroupSort = k; });\n    legendData.sort(orderFn1);\n    for(i = 0; i < legendData.length; i++) {\n        // sort considering trace.legendrank and legend.traceorder\n        legendData[i].forEach(function(a, k) { a._preSort = k; });\n        legendData[i].sort(orderFn2);\n\n        var firstItem = legendData[i][0];\n\n        var groupTitle = null;\n        // get group title text\n        for(j = 0; j < legendData[i].length; j++) {\n            var gt = legendData[i][j].trace.legendgrouptitle;\n            if(gt && gt.text) {\n                groupTitle = gt;\n                break;\n            }\n        }\n\n        // reverse order\n        if(reversed) legendData[i].reverse();\n\n        if(groupTitle) {\n            // set group title text\n            legendData[i].unshift({\n                i: -1,\n                groupTitle: groupTitle,\n                trace: {\n                    showlegend: firstItem.trace.showlegend\n                }\n            });\n        }\n\n        // rearrange lgroupToTraces into a d3-friendly array of arrays\n        for(j = 0; j < legendData[i].length; j++) {\n            legendData[i][j] = [\n                legendData[i][j]\n            ];\n        }\n    }\n\n    // number of legend groups - needed in legend/draw.js\n    opts._lgroupsLength = legendData.length;\n    // maximum name/label length - needed in legend/draw.js\n    opts._maxNameLength = maxNameLength;\n\n    return legendData;\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Registry = require('../../registry');\n\nvar SHOWISOLATETIP = true;\n\nmodule.exports = function handleClick(g, gd, numClicks) {\n    var fullLayout = gd._fullLayout;\n\n    if(gd._dragged || gd._editing) return;\n\n    var itemClick = fullLayout.legend.itemclick;\n    var itemDoubleClick = fullLayout.legend.itemdoubleclick;\n\n    if(numClicks === 1 && itemClick === 'toggle' && itemDoubleClick === 'toggleothers' &&\n        SHOWISOLATETIP && gd.data && gd._context.showTips\n    ) {\n        Lib.notifier(Lib._(gd, 'Double-click on legend to isolate one trace'), 'long');\n        SHOWISOLATETIP = false;\n    } else {\n        SHOWISOLATETIP = false;\n    }\n\n    var mode;\n    if(numClicks === 1) mode = itemClick;\n    else if(numClicks === 2) mode = itemDoubleClick;\n    if(!mode) return;\n\n    var hiddenSlices = fullLayout.hiddenlabels ?\n        fullLayout.hiddenlabels.slice() :\n        [];\n\n    var legendItem = g.data()[0][0];\n    if(legendItem.groupTitle) return; // no click on group legends for now\n\n    var fullData = gd._fullData;\n    var fullTrace = legendItem.trace;\n    var legendgroup = fullTrace.legendgroup;\n\n    var i, j, kcont, key, keys, val;\n    var attrUpdate = {};\n    var attrIndices = [];\n    var carrs = [];\n    var carrIdx = [];\n\n    function insertUpdate(traceIndex, key, value) {\n        var attrIndex = attrIndices.indexOf(traceIndex);\n        var valueArray = attrUpdate[key];\n        if(!valueArray) {\n            valueArray = attrUpdate[key] = [];\n        }\n\n        if(attrIndices.indexOf(traceIndex) === -1) {\n            attrIndices.push(traceIndex);\n            attrIndex = attrIndices.length - 1;\n        }\n\n        valueArray[attrIndex] = value;\n\n        return attrIndex;\n    }\n\n    function setVisibility(fullTrace, visibility) {\n        var fullInput = fullTrace._fullInput;\n        if(Registry.hasTransform(fullInput, 'groupby')) {\n            var kcont = carrs[fullInput.index];\n            if(!kcont) {\n                var groupbyIndices = Registry.getTransformIndices(fullInput, 'groupby');\n                var lastGroupbyIndex = groupbyIndices[groupbyIndices.length - 1];\n                kcont = Lib.keyedContainer(fullInput, 'transforms[' + lastGroupbyIndex + '].styles', 'target', 'value.visible');\n                carrs[fullInput.index] = kcont;\n            }\n\n            var curState = kcont.get(fullTrace._group);\n\n            // If not specified, assume visible. This happens if there are other style\n            // properties set for a group but not the visibility. There are many similar\n            // ways to do this (e.g. why not just `curState = fullTrace.visible`??? The\n            // answer is: because it breaks other things like groupby trace names in\n            // subtle ways.)\n            if(curState === undefined) {\n                curState = true;\n            }\n\n            if(curState !== false) {\n                // true -> legendonly. All others toggle to true:\n                kcont.set(fullTrace._group, visibility);\n            }\n            carrIdx[fullInput.index] = insertUpdate(fullInput.index, 'visible', fullInput.visible === false ? false : true);\n        } else {\n            // false -> false (not possible since will not be visible in legend)\n            // true -> legendonly\n            // legendonly -> true\n            var nextVisibility = fullInput.visible === false ? false : visibility;\n\n            insertUpdate(fullInput.index, 'visible', nextVisibility);\n        }\n    }\n\n    if(Registry.traceIs(fullTrace, 'pie-like')) {\n        var thisLabel = legendItem.label;\n        var thisLabelIndex = hiddenSlices.indexOf(thisLabel);\n\n        if(mode === 'toggle') {\n            if(thisLabelIndex === -1) hiddenSlices.push(thisLabel);\n            else hiddenSlices.splice(thisLabelIndex, 1);\n        } else if(mode === 'toggleothers') {\n            hiddenSlices = [];\n            gd.calcdata[0].forEach(function(d) {\n                if(thisLabel !== d.label) {\n                    hiddenSlices.push(d.label);\n                }\n            });\n            if(gd._fullLayout.hiddenlabels && gd._fullLayout.hiddenlabels.length === hiddenSlices.length && thisLabelIndex === -1) {\n                hiddenSlices = [];\n            }\n        }\n\n        Registry.call('_guiRelayout', gd, 'hiddenlabels', hiddenSlices);\n    } else {\n        var hasLegendgroup = legendgroup && legendgroup.length;\n        var traceIndicesInGroup = [];\n        var tracei;\n        if(hasLegendgroup) {\n            for(i = 0; i < fullData.length; i++) {\n                tracei = fullData[i];\n                if(!tracei.visible) continue;\n                if(tracei.legendgroup === legendgroup) {\n                    traceIndicesInGroup.push(i);\n                }\n            }\n        }\n\n        if(mode === 'toggle') {\n            var nextVisibility;\n\n            switch(fullTrace.visible) {\n                case true:\n                    nextVisibility = 'legendonly';\n                    break;\n                case false:\n                    nextVisibility = false;\n                    break;\n                case 'legendonly':\n                    nextVisibility = true;\n                    break;\n            }\n\n            if(hasLegendgroup) {\n                for(i = 0; i < fullData.length; i++) {\n                    if(fullData[i].visible !== false && fullData[i].legendgroup === legendgroup) {\n                        setVisibility(fullData[i], nextVisibility);\n                    }\n                }\n            } else {\n                setVisibility(fullTrace, nextVisibility);\n            }\n        } else if(mode === 'toggleothers') {\n            // Compute the clicked index. expandedIndex does what we want for expanded traces\n            // but also culls hidden traces. That means we have some work to do.\n            var isClicked, isInGroup, notInLegend, otherState;\n            var isIsolated = true;\n            for(i = 0; i < fullData.length; i++) {\n                isClicked = fullData[i] === fullTrace;\n                notInLegend = fullData[i].showlegend !== true;\n                if(isClicked || notInLegend) continue;\n\n                isInGroup = (hasLegendgroup && fullData[i].legendgroup === legendgroup);\n\n                if(!isInGroup && fullData[i].visible === true && !Registry.traceIs(fullData[i], 'notLegendIsolatable')) {\n                    isIsolated = false;\n                    break;\n                }\n            }\n\n            for(i = 0; i < fullData.length; i++) {\n                // False is sticky; we don't change it.\n                if(fullData[i].visible === false) continue;\n\n                if(Registry.traceIs(fullData[i], 'notLegendIsolatable')) {\n                    continue;\n                }\n\n                switch(fullTrace.visible) {\n                    case 'legendonly':\n                        setVisibility(fullData[i], true);\n                        break;\n                    case true:\n                        otherState = isIsolated ? true : 'legendonly';\n                        isClicked = fullData[i] === fullTrace;\n                        // N.B. consider traces that have a set legendgroup as toggleable\n                        notInLegend = (fullData[i].showlegend !== true && !fullData[i].legendgroup);\n                        isInGroup = isClicked || (hasLegendgroup && fullData[i].legendgroup === legendgroup);\n                        setVisibility(fullData[i], (isInGroup || notInLegend) ? true : otherState);\n                        break;\n                }\n            }\n        }\n\n        for(i = 0; i < carrs.length; i++) {\n            kcont = carrs[i];\n            if(!kcont) continue;\n            var update = kcont.constructUpdate();\n\n            var updateKeys = Object.keys(update);\n            for(j = 0; j < updateKeys.length; j++) {\n                key = updateKeys[j];\n                val = attrUpdate[key] = attrUpdate[key] || [];\n                val[carrIdx[i]] = update[key];\n            }\n        }\n\n        // The length of the value arrays should be equal and any unspecified\n        // values should be explicitly undefined for them to get properly culled\n        // as updates and not accidentally reset to the default value. This fills\n        // out sparse arrays with the required number of undefined values:\n        keys = Object.keys(attrUpdate);\n        for(i = 0; i < keys.length; i++) {\n            key = keys[i];\n            for(j = 0; j < attrIndices.length; j++) {\n                // Use hasOwnPropety to protect against falsey values:\n                if(!attrUpdate[key].hasOwnProperty(j)) {\n                    attrUpdate[key][j] = undefined;\n                }\n            }\n        }\n\n        Registry.call('_guiRestyle', gd, attrUpdate, attrIndices);\n    }\n};\n","'use strict';\n\nexports.isGrouped = function isGrouped(legendLayout) {\n    return (legendLayout.traceorder || '').indexOf('grouped') !== -1;\n};\n\nexports.isVertical = function isVertical(legendLayout) {\n    return legendLayout.orientation !== 'h';\n};\n\nexports.isReversed = function isReversed(legendLayout) {\n    return (legendLayout.traceorder || '').indexOf('reversed') !== -1;\n};\n","'use strict';\n\n\nmodule.exports = {\n    moduleType: 'component',\n    name: 'legend',\n\n    layoutAttributes: require('./attributes'),\n    supplyLayoutDefaults: require('./defaults'),\n\n    draw: require('./draw'),\n    style: require('./style')\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar Drawing = require('../drawing');\nvar Color = require('../color');\nvar extractOpts = require('../colorscale/helpers').extractOpts;\n\nvar subTypes = require('../../traces/scatter/subtypes');\nvar stylePie = require('../../traces/pie/style_one');\nvar pieCastOption = require('../../traces/pie/helpers').castOption;\n\nvar constants = require('./constants');\n\nvar CST_MARKER_SIZE = 12;\nvar CST_LINE_WIDTH = 5;\nvar CST_MARKER_LINE_WIDTH = 2;\nvar MAX_LINE_WIDTH = 10;\nvar MAX_MARKER_LINE_WIDTH = 5;\n\nmodule.exports = function style(s, gd, legend) {\n    var fullLayout = gd._fullLayout;\n    if(!legend) legend = fullLayout.legend;\n    var constantItemSizing = legend.itemsizing === 'constant';\n    var itemWidth = legend.itemwidth;\n    var centerPos = (itemWidth + constants.itemGap * 2) / 2;\n    var centerTransform = strTranslate(centerPos, 0);\n\n    var boundLineWidth = function(mlw, cont, max, cst) {\n        var v;\n        if(mlw + 1) {\n            v = mlw;\n        } else if(cont && cont.width > 0) {\n            v = cont.width;\n        } else {\n            return 0;\n        }\n        return constantItemSizing ? cst : Math.min(v, max);\n    };\n\n    s.each(function(d) {\n        var traceGroup = d3.select(this);\n\n        var layers = Lib.ensureSingle(traceGroup, 'g', 'layers');\n        layers.style('opacity', d[0].trace.opacity);\n\n        var valign = legend.valign;\n        var lineHeight = d[0].lineHeight;\n        var height = d[0].height;\n\n        if(valign === 'middle' || !lineHeight || !height) {\n            layers.attr('transform', null);\n        } else {\n            var factor = {top: 1, bottom: -1}[valign];\n            var markerOffsetY = factor * (0.5 * (lineHeight - height + 3));\n            layers.attr('transform', strTranslate(0, markerOffsetY));\n        }\n\n        var fill = layers\n            .selectAll('g.legendfill')\n                .data([d]);\n        fill.enter().append('g')\n            .classed('legendfill', true);\n\n        var line = layers\n            .selectAll('g.legendlines')\n                .data([d]);\n        line.enter().append('g')\n            .classed('legendlines', true);\n\n        var symbol = layers\n            .selectAll('g.legendsymbols')\n                .data([d]);\n        symbol.enter().append('g')\n            .classed('legendsymbols', true);\n\n        symbol.selectAll('g.legendpoints')\n            .data([d])\n          .enter().append('g')\n            .classed('legendpoints', true);\n    })\n    .each(styleSpatial)\n    .each(styleWaterfalls)\n    .each(styleFunnels)\n    .each(styleBars)\n    .each(styleBoxes)\n    .each(styleFunnelareas)\n    .each(stylePies)\n    .each(styleLines)\n    .each(stylePoints)\n    .each(styleCandles)\n    .each(styleOHLC);\n\n    function styleLines(d) {\n        var styleGuide = getStyleGuide(d);\n        var showFill = styleGuide.showFill;\n        var showLine = styleGuide.showLine;\n        var showGradientLine = styleGuide.showGradientLine;\n        var showGradientFill = styleGuide.showGradientFill;\n        var anyFill = styleGuide.anyFill;\n        var anyLine = styleGuide.anyLine;\n\n        var d0 = d[0];\n        var trace = d0.trace;\n        var dMod, tMod;\n\n        var cOpts = extractOpts(trace);\n        var colorscale = cOpts.colorscale;\n        var reversescale = cOpts.reversescale;\n\n        var fillGradient = function(s) {\n            if(s.size()) {\n                var gradientID = 'legendfill-' + trace.uid;\n                Drawing.gradient(s, gd, gradientID,\n                    getGradientDirection(reversescale),\n                    colorscale, 'fill');\n            }\n        };\n\n        var lineGradient = function(s) {\n            if(s.size()) {\n                var gradientID = 'legendline-' + trace.uid;\n                Drawing.lineGroupStyle(s);\n                Drawing.gradient(s, gd, gradientID,\n                    getGradientDirection(reversescale),\n                    colorscale, 'stroke');\n            }\n        };\n\n        // with fill and no markers or text, move the line and fill up a bit\n        // so it's more centered\n\n        var pathStart = (subTypes.hasMarkers(trace) || !anyFill) ? 'M5,0' :\n            // with a line leave it slightly below center, to leave room for the\n            // line thickness and because the line is usually more prominent\n            anyLine ? 'M5,-2' : 'M5,-3';\n\n        var this3 = d3.select(this);\n\n        var fill = this3.select('.legendfill').selectAll('path')\n            .data(showFill || showGradientFill ? [d] : []);\n        fill.enter().append('path').classed('js-fill', true);\n        fill.exit().remove();\n        fill.attr('d', pathStart + 'h' + itemWidth + 'v6h-' + itemWidth + 'z')\n            .call(showFill ? Drawing.fillGroupStyle : fillGradient);\n\n        if(showLine || showGradientLine) {\n            var lw = boundLineWidth(undefined, trace.line, MAX_LINE_WIDTH, CST_LINE_WIDTH);\n            tMod = Lib.minExtend(trace, {line: {width: lw}});\n            dMod = [Lib.minExtend(d0, {trace: tMod})];\n        }\n\n        var line = this3.select('.legendlines').selectAll('path')\n            .data(showLine || showGradientLine ? [dMod] : []);\n        line.enter().append('path').classed('js-line', true);\n        line.exit().remove();\n\n        // this is ugly... but you can't apply a gradient to a perfectly\n        // horizontal or vertical line. Presumably because then\n        // the system doesn't know how to scale vertical variation, even\n        // though there *is* no vertical variation in this case.\n        // so add an invisibly small angle to the line\n        // This issue (and workaround) exist across (Mac) Chrome, FF, and Safari\n        line.attr('d', pathStart + (showGradientLine ? 'l' + itemWidth + ',0.0001' : 'h' + itemWidth))\n            .call(showLine ? Drawing.lineGroupStyle : lineGradient);\n    }\n\n    function stylePoints(d) {\n        var styleGuide = getStyleGuide(d);\n        var anyFill = styleGuide.anyFill;\n        var anyLine = styleGuide.anyLine;\n        var showLine = styleGuide.showLine;\n        var showMarker = styleGuide.showMarker;\n\n        var d0 = d[0];\n        var trace = d0.trace;\n        var showText = !showMarker && !anyLine && !anyFill && subTypes.hasText(trace);\n        var dMod, tMod;\n\n        // 'scatter3d' don't use gd.calcdata,\n        // use d0.trace to infer arrayOk attributes\n\n        function boundVal(attrIn, arrayToValFn, bounds, cst) {\n            var valIn = Lib.nestedProperty(trace, attrIn).get();\n            var valToBound = (Lib.isArrayOrTypedArray(valIn) && arrayToValFn) ?\n                arrayToValFn(valIn) :\n                valIn;\n\n            if(constantItemSizing && valToBound && cst !== undefined) {\n                valToBound = cst;\n            }\n\n            if(bounds) {\n                if(valToBound < bounds[0]) return bounds[0];\n                else if(valToBound > bounds[1]) return bounds[1];\n            }\n            return valToBound;\n        }\n\n        function pickFirst(array) {\n            if(d0._distinct && d0.index && array[d0.index]) return array[d0.index];\n            return array[0];\n        }\n\n        // constrain text, markers, etc so they'll fit on the legend\n        if(showMarker || showText || showLine) {\n            var dEdit = {};\n            var tEdit = {};\n\n            if(showMarker) {\n                dEdit.mc = boundVal('marker.color', pickFirst);\n                dEdit.mx = boundVal('marker.symbol', pickFirst);\n                dEdit.mo = boundVal('marker.opacity', Lib.mean, [0.2, 1]);\n                dEdit.mlc = boundVal('marker.line.color', pickFirst);\n                dEdit.mlw = boundVal('marker.line.width', Lib.mean, [0, 5], CST_MARKER_LINE_WIDTH);\n                tEdit.marker = {\n                    sizeref: 1,\n                    sizemin: 1,\n                    sizemode: 'diameter'\n                };\n\n                var ms = boundVal('marker.size', Lib.mean, [2, 16], CST_MARKER_SIZE);\n                dEdit.ms = ms;\n                tEdit.marker.size = ms;\n            }\n\n            if(showLine) {\n                tEdit.line = {\n                    width: boundVal('line.width', pickFirst, [0, 10], CST_LINE_WIDTH)\n                };\n            }\n\n            if(showText) {\n                dEdit.tx = 'Aa';\n                dEdit.tp = boundVal('textposition', pickFirst);\n                dEdit.ts = 10;\n                dEdit.tc = boundVal('textfont.color', pickFirst);\n                dEdit.tf = boundVal('textfont.family', pickFirst);\n            }\n\n            dMod = [Lib.minExtend(d0, dEdit)];\n            tMod = Lib.minExtend(trace, tEdit);\n\n            // always show legend items in base state\n            tMod.selectedpoints = null;\n\n            // never show texttemplate\n            tMod.texttemplate = null;\n        }\n\n        var ptgroup = d3.select(this).select('g.legendpoints');\n\n        var pts = ptgroup.selectAll('path.scatterpts')\n            .data(showMarker ? dMod : []);\n        // make sure marker is on the bottom, in case it enters after text\n        pts.enter().insert('path', ':first-child')\n            .classed('scatterpts', true)\n            .attr('transform', centerTransform);\n        pts.exit().remove();\n        pts.call(Drawing.pointStyle, tMod, gd);\n\n        // 'mrc' is set in pointStyle and used in textPointStyle:\n        // constrain it here\n        if(showMarker) dMod[0].mrc = 3;\n\n        var txt = ptgroup.selectAll('g.pointtext')\n            .data(showText ? dMod : []);\n        txt.enter()\n            .append('g').classed('pointtext', true)\n                .append('text').attr('transform', centerTransform);\n        txt.exit().remove();\n        txt.selectAll('text').call(Drawing.textPointStyle, tMod, gd);\n    }\n\n    function styleWaterfalls(d) {\n        var trace = d[0].trace;\n        var isWaterfall = trace.type === 'waterfall';\n\n        if(d[0]._distinct && isWaterfall) {\n            var cont = d[0].trace[d[0].dir].marker;\n            d[0].mc = cont.color;\n            d[0].mlw = cont.line.width;\n            d[0].mlc = cont.line.color;\n            return styleBarLike(d, this, 'waterfall');\n        }\n\n        var ptsData = [];\n        if(trace.visible && isWaterfall) {\n            ptsData = d[0].hasTotals ?\n                [['increasing', 'M-6,-6V6H0Z'], ['totals', 'M6,6H0L-6,-6H-0Z'], ['decreasing', 'M6,6V-6H0Z']] :\n                [['increasing', 'M-6,-6V6H6Z'], ['decreasing', 'M6,6V-6H-6Z']];\n        }\n\n        var pts = d3.select(this).select('g.legendpoints')\n            .selectAll('path.legendwaterfall')\n            .data(ptsData);\n        pts.enter().append('path').classed('legendwaterfall', true)\n            .attr('transform', centerTransform)\n            .style('stroke-miterlimit', 1);\n        pts.exit().remove();\n\n        pts.each(function(dd) {\n            var pt = d3.select(this);\n            var cont = trace[dd[0]].marker;\n            var lw = boundLineWidth(undefined, cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n            pt.attr('d', dd[1])\n                .style('stroke-width', lw + 'px')\n                .call(Color.fill, cont.color);\n\n            if(lw) {\n                pt.call(Color.stroke, cont.line.color);\n            }\n        });\n    }\n\n    function styleBars(d) {\n        styleBarLike(d, this);\n    }\n\n    function styleFunnels(d) {\n        styleBarLike(d, this, 'funnel');\n    }\n\n    function styleBarLike(d, lThis, desiredType) {\n        var trace = d[0].trace;\n        var marker = trace.marker || {};\n        var markerLine = marker.line || {};\n\n        var isVisible = (!desiredType) ? Registry.traceIs(trace, 'bar') :\n            (trace.visible && trace.type === desiredType);\n\n        var barpath = d3.select(lThis).select('g.legendpoints')\n            .selectAll('path.legend' + desiredType)\n            .data(isVisible ? [d] : []);\n        barpath.enter().append('path').classed('legend' + desiredType, true)\n            .attr('d', 'M6,6H-6V-6H6Z')\n            .attr('transform', centerTransform);\n        barpath.exit().remove();\n\n        barpath.each(function(d) {\n            var p = d3.select(this);\n            var d0 = d[0];\n            var w = boundLineWidth(d0.mlw, marker.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n            p.style('stroke-width', w + 'px');\n\n            var mcc = d0.mcc;\n            if(!legend._inHover && 'mc' in d0) {\n                // not in unified hover but\n                // for legend use the color in the middle of scale\n                var cOpts = extractOpts(marker);\n                var mid = cOpts.mid;\n                if(mid === undefined) mid = (cOpts.max + cOpts.min) / 2;\n                mcc = Drawing.tryColorscale(marker, '')(mid);\n            }\n            var fillColor = mcc || d0.mc || marker.color;\n\n            var markerPattern = marker.pattern;\n            var patternShape = markerPattern && Drawing.getPatternAttr(markerPattern.shape, 0, '');\n\n            if(patternShape) {\n                var patternBGColor = Drawing.getPatternAttr(markerPattern.bgcolor, 0, null);\n                var patternFGColor = Drawing.getPatternAttr(markerPattern.fgcolor, 0, null);\n                var patternFGOpacity = markerPattern.fgopacity;\n                var patternSize = dimAttr(markerPattern.size, 8, 10);\n                var patternSolidity = dimAttr(markerPattern.solidity, 0.5, 1);\n                var patternID = 'legend-' + trace.uid;\n                p.call(\n                    Drawing.pattern, 'legend', gd, patternID,\n                    patternShape, patternSize, patternSolidity,\n                    mcc, markerPattern.fillmode,\n                    patternBGColor, patternFGColor, patternFGOpacity\n                );\n            } else {\n                p.call(Color.fill, fillColor);\n            }\n\n            if(w) Color.stroke(p, d0.mlc || markerLine.color);\n        });\n    }\n\n    function styleBoxes(d) {\n        var trace = d[0].trace;\n\n        var pts = d3.select(this).select('g.legendpoints')\n            .selectAll('path.legendbox')\n            .data(trace.visible && Registry.traceIs(trace, 'box-violin') ? [d] : []);\n        pts.enter().append('path').classed('legendbox', true)\n            // if we want the median bar, prepend M6,0H-6\n            .attr('d', 'M6,6H-6V-6H6Z')\n            .attr('transform', centerTransform);\n        pts.exit().remove();\n\n        pts.each(function() {\n            var p = d3.select(this);\n\n            if((trace.boxpoints === 'all' || trace.points === 'all') &&\n                Color.opacity(trace.fillcolor) === 0 && Color.opacity((trace.line || {}).color) === 0\n            ) {\n                var tMod = Lib.minExtend(trace, {\n                    marker: {\n                        size: constantItemSizing ? CST_MARKER_SIZE : Lib.constrain(trace.marker.size, 2, 16),\n                        sizeref: 1,\n                        sizemin: 1,\n                        sizemode: 'diameter'\n                    }\n                });\n                pts.call(Drawing.pointStyle, tMod, gd);\n            } else {\n                var w = boundLineWidth(undefined, trace.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n                p.style('stroke-width', w + 'px')\n                    .call(Color.fill, trace.fillcolor);\n\n                if(w) Color.stroke(p, trace.line.color);\n            }\n        });\n    }\n\n    function styleCandles(d) {\n        var trace = d[0].trace;\n\n        var pts = d3.select(this).select('g.legendpoints')\n            .selectAll('path.legendcandle')\n            .data(trace.visible && trace.type === 'candlestick' ? [d, d] : []);\n        pts.enter().append('path').classed('legendcandle', true)\n            .attr('d', function(_, i) {\n                if(i) return 'M-15,0H-8M-8,6V-6H8Z'; // increasing\n                return 'M15,0H8M8,-6V6H-8Z'; // decreasing\n            })\n            .attr('transform', centerTransform)\n            .style('stroke-miterlimit', 1);\n        pts.exit().remove();\n\n        pts.each(function(_, i) {\n            var p = d3.select(this);\n            var cont = trace[i ? 'increasing' : 'decreasing'];\n            var w = boundLineWidth(undefined, cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n            p.style('stroke-width', w + 'px')\n                .call(Color.fill, cont.fillcolor);\n\n            if(w) Color.stroke(p, cont.line.color);\n        });\n    }\n\n    function styleOHLC(d) {\n        var trace = d[0].trace;\n\n        var pts = d3.select(this).select('g.legendpoints')\n            .selectAll('path.legendohlc')\n            .data(trace.visible && trace.type === 'ohlc' ? [d, d] : []);\n        pts.enter().append('path').classed('legendohlc', true)\n            .attr('d', function(_, i) {\n                if(i) return 'M-15,0H0M-8,-6V0'; // increasing\n                return 'M15,0H0M8,6V0'; // decreasing\n            })\n            .attr('transform', centerTransform)\n            .style('stroke-miterlimit', 1);\n        pts.exit().remove();\n\n        pts.each(function(_, i) {\n            var p = d3.select(this);\n            var cont = trace[i ? 'increasing' : 'decreasing'];\n            var w = boundLineWidth(undefined, cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n            p.style('fill', 'none')\n                .call(Drawing.dashLine, cont.line.dash, w);\n\n            if(w) Color.stroke(p, cont.line.color);\n        });\n    }\n\n    function stylePies(d) {\n        stylePieLike(d, this, 'pie');\n    }\n\n    function styleFunnelareas(d) {\n        stylePieLike(d, this, 'funnelarea');\n    }\n\n    function stylePieLike(d, lThis, desiredType) {\n        var d0 = d[0];\n        var trace = d0.trace;\n\n        var isVisible = (!desiredType) ? Registry.traceIs(trace, desiredType) :\n            (trace.visible && trace.type === desiredType);\n\n        var pts = d3.select(lThis).select('g.legendpoints')\n            .selectAll('path.legend' + desiredType)\n            .data(isVisible ? [d] : []);\n        pts.enter().append('path').classed('legend' + desiredType, true)\n            .attr('d', 'M6,6H-6V-6H6Z')\n            .attr('transform', centerTransform);\n        pts.exit().remove();\n\n        if(pts.size()) {\n            var cont = (trace.marker || {}).line;\n            var lw = boundLineWidth(pieCastOption(cont.width, d0.pts), cont, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n            var tMod = Lib.minExtend(trace, {marker: {line: {width: lw}}});\n            // since minExtend do not slice more than 3 items we need to patch line.color here\n            tMod.marker.line.color = cont.color;\n\n            var d0Mod = Lib.minExtend(d0, {trace: tMod});\n\n            stylePie(pts, d0Mod, tMod);\n        }\n    }\n\n    function styleSpatial(d) { // i.e. maninly traces having z and colorscale\n        var trace = d[0].trace;\n\n        var useGradient;\n        var ptsData = [];\n        if(trace.visible) {\n            switch(trace.type) {\n                case 'histogram2d' :\n                case 'heatmap' :\n                    ptsData = [\n                        ['M-15,-2V4H15V-2Z'] // similar to contour\n                    ];\n                    useGradient = true;\n                    break;\n                case 'choropleth' :\n                case 'choroplethmapbox' :\n                    ptsData = [\n                        ['M-6,-6V6H6V-6Z']\n                    ];\n                    useGradient = true;\n                    break;\n                case 'densitymapbox' :\n                    ptsData = [\n                        ['M-6,0 a6,6 0 1,0 12,0 a 6,6 0 1,0 -12,0']\n                    ];\n                    useGradient = 'radial';\n                    break;\n                case 'cone' :\n                    ptsData = [\n                        ['M-6,2 A2,2 0 0,0 -6,6 V6L6,4Z'],\n                        ['M-6,-6 A2,2 0 0,0 -6,-2 L6,-4Z'],\n                        ['M-6,-2 A2,2 0 0,0 -6,2 L6,0Z']\n                    ];\n                    useGradient = false;\n                    break;\n                case 'streamtube' :\n                    ptsData = [\n                        ['M-6,2 A2,2 0 0,0 -6,6 H6 A2,2 0 0,1 6,2 Z'],\n                        ['M-6,-6 A2,2 0 0,0 -6,-2 H6 A2,2 0 0,1 6,-6 Z'],\n                        ['M-6,-2 A2,2 0 0,0 -6,2 H6 A2,2 0 0,1 6,-2 Z']\n                    ];\n                    useGradient = false;\n                    break;\n                case 'surface' :\n                    ptsData = [\n                        ['M-6,-6 A2,3 0 0,0 -6,0 H6 A2,3 0 0,1 6,-6 Z'],\n                        ['M-6,1 A2,3 0 0,1 -6,6 H6 A2,3 0 0,0 6,0 Z']\n                    ];\n                    useGradient = true;\n                    break;\n                case 'mesh3d' :\n                    ptsData = [\n                        ['M-6,6H0L-6,-6Z'],\n                        ['M6,6H0L6,-6Z'],\n                        ['M-6,-6H6L0,6Z']\n                    ];\n                    useGradient = false;\n                    break;\n                case 'volume' :\n                    ptsData = [\n                        ['M-6,6H0L-6,-6Z'],\n                        ['M6,6H0L6,-6Z'],\n                        ['M-6,-6H6L0,6Z']\n                    ];\n                    useGradient = true;\n                    break;\n                case 'isosurface':\n                    ptsData = [\n                        ['M-6,6H0L-6,-6Z'],\n                        ['M6,6H0L6,-6Z'],\n                        ['M-6,-6 A12,24 0 0,0 6,-6 L0,6Z']\n                    ];\n                    useGradient = false;\n                    break;\n            }\n        }\n\n        var pts = d3.select(this).select('g.legendpoints')\n            .selectAll('path.legend3dandfriends')\n            .data(ptsData);\n        pts.enter().append('path').classed('legend3dandfriends', true)\n            .attr('transform', centerTransform)\n            .style('stroke-miterlimit', 1);\n        pts.exit().remove();\n\n        pts.each(function(dd, i) {\n            var pt = d3.select(this);\n\n            var cOpts = extractOpts(trace);\n            var colorscale = cOpts.colorscale;\n            var reversescale = cOpts.reversescale;\n            var fillGradient = function(s) {\n                if(s.size()) {\n                    var gradientID = 'legendfill-' + trace.uid;\n                    Drawing.gradient(s, gd, gradientID,\n                        getGradientDirection(reversescale, useGradient === 'radial'),\n                        colorscale, 'fill');\n                }\n            };\n\n            var fillColor;\n            if(!colorscale) {\n                var color = trace.vertexcolor || trace.facecolor || trace.color;\n                fillColor = Lib.isArrayOrTypedArray(color) ? (color[i] || color[0]) : color;\n            } else {\n                if(!useGradient) {\n                    var len = colorscale.length;\n                    fillColor =\n                        i === 0 ? colorscale[reversescale ? len - 1 : 0][1] : // minimum\n                        i === 1 ? colorscale[reversescale ? 0 : len - 1][1] : // maximum\n                            colorscale[Math.floor((len - 1) / 2)][1]; // middle\n                }\n            }\n\n            pt.attr('d', dd[0]);\n            if(fillColor) {\n                pt.call(Color.fill, fillColor);\n            } else {\n                pt.call(fillGradient);\n            }\n        });\n    }\n};\n\nfunction getGradientDirection(reversescale, isRadial) {\n    var str = isRadial ? 'radial' : 'horizontal';\n    return str + (reversescale ? '' : 'reversed');\n}\n\nfunction getStyleGuide(d) {\n    var trace = d[0].trace;\n    var contours = trace.contours;\n    var showLine = subTypes.hasLines(trace);\n    var showMarker = subTypes.hasMarkers(trace);\n\n    var showFill = trace.visible && trace.fill && trace.fill !== 'none';\n    var showGradientLine = false;\n    var showGradientFill = false;\n\n    if(contours) {\n        var coloring = contours.coloring;\n\n        if(coloring === 'lines') {\n            showGradientLine = true;\n        } else {\n            showLine = coloring === 'none' || coloring === 'heatmap' || contours.showlines;\n        }\n\n        if(contours.type === 'constraint') {\n            showFill = contours._operation !== '=';\n        } else if(coloring === 'fill' || coloring === 'heatmap') {\n            showGradientFill = true;\n        }\n    }\n\n    return {\n        showMarker: showMarker,\n        showLine: showLine,\n        showFill: showFill,\n        showGradientLine: showGradientLine,\n        showGradientFill: showGradientFill,\n        anyLine: showLine || showGradientLine,\n        anyFill: showFill || showGradientFill,\n    };\n}\n\nfunction dimAttr(v, dflt, max) {\n    if(v && Lib.isArrayOrTypedArray(v)) return dflt;\n    if(v > max) return max;\n    return v;\n}\n","'use strict';\n\nvar constants = require('./constants');\n\nmodule.exports = {\n    editType: 'modebar',\n\n    orientation: {\n        valType: 'enumerated',\n        values: ['v', 'h'],\n        dflt: 'h',\n        editType: 'modebar',\n        description: 'Sets the orientation of the modebar.'\n    },\n    bgcolor: {\n        valType: 'color',\n        editType: 'modebar',\n        description: 'Sets the background color of the modebar.'\n    },\n    color: {\n        valType: 'color',\n        editType: 'modebar',\n        description: 'Sets the color of the icons in the modebar.'\n    },\n    activecolor: {\n        valType: 'color',\n        editType: 'modebar',\n        description: 'Sets the color of the active or hovered on icons in the modebar.'\n    },\n    uirevision: {\n        valType: 'any',\n        editType: 'none',\n        description: [\n            'Controls persistence of user-driven changes related to the modebar,',\n            'including `hovermode`, `dragmode`, and `showspikes` at both the',\n            'root level and inside subplots. Defaults to `layout.uirevision`.'\n        ].join(' ')\n    },\n    add: {\n        valType: 'string',\n        arrayOk: true,\n        dflt: '',\n        editType: 'modebar',\n        description: [\n            'Determines which predefined modebar buttons to add.',\n            'Please note that these buttons will only be shown if they are',\n            'compatible with all trace types used in a graph.',\n            'Similar to `config.modeBarButtonsToAdd` option.',\n            'This may include *' + constants.backButtons.join('*, *') + '*.'\n        ].join(' ')\n    },\n    remove: {\n        valType: 'string',\n        arrayOk: true,\n        dflt: '',\n        editType: 'modebar',\n        description: [\n            'Determines which predefined modebar buttons to remove.',\n            'Similar to `config.modeBarButtonsToRemove` option.',\n            'This may include *' + constants.foreButtons.join('*, *') + '*.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar Registry = require('../../registry');\nvar Plots = require('../../plots/plots');\nvar axisIds = require('../../plots/cartesian/axis_ids');\nvar Icons = require('../../fonts/ploticon');\nvar eraseActiveShape = require('../shapes/draw').eraseActiveShape;\nvar Lib = require('../../lib');\nvar _ = Lib._;\n\nvar modeBarButtons = module.exports = {};\n\n/**\n * ModeBar buttons configuration\n *\n * @param {string} name\n *      name / id of the buttons (for tracking)\n * @param {string} title\n *      text that appears while hovering over the button,\n *      enter null, false or '' for no hover text\n * @param {string} icon\n *      svg icon object associated with the button\n *      can be linked to Plotly.Icons to use the default plotly icons\n * @param {string} [gravity]\n *      icon positioning\n * @param {function} click\n *      click handler associated with the button, a function of\n *      'gd' (the main graph object) and\n *      'ev' (the event object)\n * @param {string} [attr]\n *      attribute associated with button,\n *      use this with 'val' to keep track of the state\n * @param {*} [val]\n *      initial 'attr' value, can be a function of gd\n * @param {boolean} [toggle]\n *      is the button a toggle button?\n */\nmodeBarButtons.toImage = {\n    name: 'toImage',\n    title: function(gd) {\n        var opts = gd._context.toImageButtonOptions || {};\n        var format = opts.format || 'png';\n        return format === 'png' ?\n            _(gd, 'Download plot as a png') : // legacy text\n            _(gd, 'Download plot'); // generic non-PNG text\n    },\n    icon: Icons.camera,\n    click: function(gd) {\n        var toImageButtonOptions = gd._context.toImageButtonOptions;\n        var opts = {format: toImageButtonOptions.format || 'png'};\n\n        Lib.notifier(_(gd, 'Taking snapshot - this may take a few seconds'), 'long');\n\n        if(opts.format !== 'svg' && Lib.isIE()) {\n            Lib.notifier(_(gd, 'IE only supports svg.  Changing format to svg.'), 'long');\n            opts.format = 'svg';\n        }\n\n        ['filename', 'width', 'height', 'scale'].forEach(function(key) {\n            if(key in toImageButtonOptions) {\n                opts[key] = toImageButtonOptions[key];\n            }\n        });\n\n        Registry.call('downloadImage', gd, opts)\n          .then(function(filename) {\n              Lib.notifier(_(gd, 'Snapshot succeeded') + ' - ' + filename, 'long');\n          })\n          .catch(function() {\n              Lib.notifier(_(gd, 'Sorry, there was a problem downloading your snapshot!'), 'long');\n          });\n    }\n};\n\nmodeBarButtons.sendDataToCloud = {\n    name: 'sendDataToCloud',\n    title: function(gd) { return _(gd, 'Edit in Chart Studio'); },\n    icon: Icons.disk,\n    click: function(gd) {\n        Plots.sendDataToCloud(gd);\n    }\n};\n\nmodeBarButtons.editInChartStudio = {\n    name: 'editInChartStudio',\n    title: function(gd) { return _(gd, 'Edit in Chart Studio'); },\n    icon: Icons.pencil,\n    click: function(gd) {\n        Plots.sendDataToCloud(gd);\n    }\n};\n\nmodeBarButtons.zoom2d = {\n    name: 'zoom2d',\n    _cat: 'zoom',\n    title: function(gd) { return _(gd, 'Zoom'); },\n    attr: 'dragmode',\n    val: 'zoom',\n    icon: Icons.zoombox,\n    click: handleCartesian\n};\n\nmodeBarButtons.pan2d = {\n    name: 'pan2d',\n    _cat: 'pan',\n    title: function(gd) { return _(gd, 'Pan'); },\n    attr: 'dragmode',\n    val: 'pan',\n    icon: Icons.pan,\n    click: handleCartesian\n};\n\nmodeBarButtons.select2d = {\n    name: 'select2d',\n    _cat: 'select',\n    title: function(gd) { return _(gd, 'Box Select'); },\n    attr: 'dragmode',\n    val: 'select',\n    icon: Icons.selectbox,\n    click: handleCartesian\n};\n\nmodeBarButtons.lasso2d = {\n    name: 'lasso2d',\n    _cat: 'lasso',\n    title: function(gd) { return _(gd, 'Lasso Select'); },\n    attr: 'dragmode',\n    val: 'lasso',\n    icon: Icons.lasso,\n    click: handleCartesian\n};\n\nmodeBarButtons.drawclosedpath = {\n    name: 'drawclosedpath',\n    title: function(gd) { return _(gd, 'Draw closed freeform'); },\n    attr: 'dragmode',\n    val: 'drawclosedpath',\n    icon: Icons.drawclosedpath,\n    click: handleCartesian\n};\n\nmodeBarButtons.drawopenpath = {\n    name: 'drawopenpath',\n    title: function(gd) { return _(gd, 'Draw open freeform'); },\n    attr: 'dragmode',\n    val: 'drawopenpath',\n    icon: Icons.drawopenpath,\n    click: handleCartesian\n};\n\nmodeBarButtons.drawline = {\n    name: 'drawline',\n    title: function(gd) { return _(gd, 'Draw line'); },\n    attr: 'dragmode',\n    val: 'drawline',\n    icon: Icons.drawline,\n    click: handleCartesian\n};\n\nmodeBarButtons.drawrect = {\n    name: 'drawrect',\n    title: function(gd) { return _(gd, 'Draw rectangle'); },\n    attr: 'dragmode',\n    val: 'drawrect',\n    icon: Icons.drawrect,\n    click: handleCartesian\n};\n\nmodeBarButtons.drawcircle = {\n    name: 'drawcircle',\n    title: function(gd) { return _(gd, 'Draw circle'); },\n    attr: 'dragmode',\n    val: 'drawcircle',\n    icon: Icons.drawcircle,\n    click: handleCartesian\n};\n\nmodeBarButtons.eraseshape = {\n    name: 'eraseshape',\n    title: function(gd) { return _(gd, 'Erase active shape'); },\n    icon: Icons.eraseshape,\n    click: eraseActiveShape\n};\n\nmodeBarButtons.zoomIn2d = {\n    name: 'zoomIn2d',\n    _cat: 'zoomin',\n    title: function(gd) { return _(gd, 'Zoom in'); },\n    attr: 'zoom',\n    val: 'in',\n    icon: Icons.zoom_plus,\n    click: handleCartesian\n};\n\nmodeBarButtons.zoomOut2d = {\n    name: 'zoomOut2d',\n    _cat: 'zoomout',\n    title: function(gd) { return _(gd, 'Zoom out'); },\n    attr: 'zoom',\n    val: 'out',\n    icon: Icons.zoom_minus,\n    click: handleCartesian\n};\n\nmodeBarButtons.autoScale2d = {\n    name: 'autoScale2d',\n    _cat: 'autoscale',\n    title: function(gd) { return _(gd, 'Autoscale'); },\n    attr: 'zoom',\n    val: 'auto',\n    icon: Icons.autoscale,\n    click: handleCartesian\n};\n\nmodeBarButtons.resetScale2d = {\n    name: 'resetScale2d',\n    _cat: 'resetscale',\n    title: function(gd) { return _(gd, 'Reset axes'); },\n    attr: 'zoom',\n    val: 'reset',\n    icon: Icons.home,\n    click: handleCartesian\n};\n\nmodeBarButtons.hoverClosestCartesian = {\n    name: 'hoverClosestCartesian',\n    _cat: 'hoverclosest',\n    title: function(gd) { return _(gd, 'Show closest data on hover'); },\n    attr: 'hovermode',\n    val: 'closest',\n    icon: Icons.tooltip_basic,\n    gravity: 'ne',\n    click: handleCartesian\n};\n\nmodeBarButtons.hoverCompareCartesian = {\n    name: 'hoverCompareCartesian',\n    _cat: 'hoverCompare',\n    title: function(gd) { return _(gd, 'Compare data on hover'); },\n    attr: 'hovermode',\n    val: function(gd) {\n        return gd._fullLayout._isHoriz ? 'y' : 'x';\n    },\n    icon: Icons.tooltip_compare,\n    gravity: 'ne',\n    click: handleCartesian\n};\n\nfunction handleCartesian(gd, ev) {\n    var button = ev.currentTarget;\n    var astr = button.getAttribute('data-attr');\n    var val = button.getAttribute('data-val') || true;\n    var fullLayout = gd._fullLayout;\n    var aobj = {};\n    var axList = axisIds.list(gd, null, true);\n    var allSpikesEnabled = fullLayout._cartesianSpikesEnabled;\n\n    var ax, i;\n\n    if(astr === 'zoom') {\n        var mag = (val === 'in') ? 0.5 : 2;\n        var r0 = (1 + mag) / 2;\n        var r1 = (1 - mag) / 2;\n        var axName;\n\n        for(i = 0; i < axList.length; i++) {\n            ax = axList[i];\n\n            if(!ax.fixedrange) {\n                axName = ax._name;\n                if(val === 'auto') {\n                    aobj[axName + '.autorange'] = true;\n                } else if(val === 'reset') {\n                    if(ax._rangeInitial === undefined) {\n                        aobj[axName + '.autorange'] = true;\n                    } else {\n                        var rangeInitial = ax._rangeInitial.slice();\n                        aobj[axName + '.range[0]'] = rangeInitial[0];\n                        aobj[axName + '.range[1]'] = rangeInitial[1];\n                    }\n\n                    // N.B. \"reset\" also resets showspikes\n                    if(ax._showSpikeInitial !== undefined) {\n                        aobj[axName + '.showspikes'] = ax._showSpikeInitial;\n                        if(allSpikesEnabled === 'on' && !ax._showSpikeInitial) {\n                            allSpikesEnabled = 'off';\n                        }\n                    }\n                } else {\n                    var rangeNow = [\n                        ax.r2l(ax.range[0]),\n                        ax.r2l(ax.range[1]),\n                    ];\n\n                    var rangeNew = [\n                        r0 * rangeNow[0] + r1 * rangeNow[1],\n                        r0 * rangeNow[1] + r1 * rangeNow[0]\n                    ];\n\n                    aobj[axName + '.range[0]'] = ax.l2r(rangeNew[0]);\n                    aobj[axName + '.range[1]'] = ax.l2r(rangeNew[1]);\n                }\n            }\n        }\n    } else {\n        // if ALL traces have orientation 'h', 'hovermode': 'x' otherwise: 'y'\n        if(astr === 'hovermode' && (val === 'x' || val === 'y')) {\n            val = fullLayout._isHoriz ? 'y' : 'x';\n            button.setAttribute('data-val', val);\n        }\n\n        aobj[astr] = val;\n    }\n\n    fullLayout._cartesianSpikesEnabled = allSpikesEnabled;\n\n    Registry.call('_guiRelayout', gd, aobj);\n}\n\nmodeBarButtons.zoom3d = {\n    name: 'zoom3d',\n    _cat: 'zoom',\n    title: function(gd) { return _(gd, 'Zoom'); },\n    attr: 'scene.dragmode',\n    val: 'zoom',\n    icon: Icons.zoombox,\n    click: handleDrag3d\n};\n\nmodeBarButtons.pan3d = {\n    name: 'pan3d',\n    _cat: 'pan',\n    title: function(gd) { return _(gd, 'Pan'); },\n    attr: 'scene.dragmode',\n    val: 'pan',\n    icon: Icons.pan,\n    click: handleDrag3d\n};\n\nmodeBarButtons.orbitRotation = {\n    name: 'orbitRotation',\n    title: function(gd) { return _(gd, 'Orbital rotation'); },\n    attr: 'scene.dragmode',\n    val: 'orbit',\n    icon: Icons['3d_rotate'],\n    click: handleDrag3d\n};\n\nmodeBarButtons.tableRotation = {\n    name: 'tableRotation',\n    title: function(gd) { return _(gd, 'Turntable rotation'); },\n    attr: 'scene.dragmode',\n    val: 'turntable',\n    icon: Icons['z-axis'],\n    click: handleDrag3d\n};\n\nfunction handleDrag3d(gd, ev) {\n    var button = ev.currentTarget;\n    var attr = button.getAttribute('data-attr');\n    var val = button.getAttribute('data-val') || true;\n    var sceneIds = gd._fullLayout._subplots.gl3d || [];\n    var layoutUpdate = {};\n\n    var parts = attr.split('.');\n\n    for(var i = 0; i < sceneIds.length; i++) {\n        layoutUpdate[sceneIds[i] + '.' + parts[1]] = val;\n    }\n\n    // for multi-type subplots\n    var val2d = (val === 'pan') ? val : 'zoom';\n    layoutUpdate.dragmode = val2d;\n\n    Registry.call('_guiRelayout', gd, layoutUpdate);\n}\n\nmodeBarButtons.resetCameraDefault3d = {\n    name: 'resetCameraDefault3d',\n    _cat: 'resetCameraDefault',\n    title: function(gd) { return _(gd, 'Reset camera to default'); },\n    attr: 'resetDefault',\n    icon: Icons.home,\n    click: handleCamera3d\n};\n\nmodeBarButtons.resetCameraLastSave3d = {\n    name: 'resetCameraLastSave3d',\n    _cat: 'resetCameraLastSave',\n    title: function(gd) { return _(gd, 'Reset camera to last save'); },\n    attr: 'resetLastSave',\n    icon: Icons.movie,\n    click: handleCamera3d\n};\n\nfunction handleCamera3d(gd, ev) {\n    var button = ev.currentTarget;\n    var attr = button.getAttribute('data-attr');\n    var resetLastSave = attr === 'resetLastSave';\n    var resetDefault = attr === 'resetDefault';\n\n    var fullLayout = gd._fullLayout;\n    var sceneIds = fullLayout._subplots.gl3d || [];\n    var aobj = {};\n\n    for(var i = 0; i < sceneIds.length; i++) {\n        var sceneId = sceneIds[i];\n        var camera = sceneId + '.camera';\n        var aspectratio = sceneId + '.aspectratio';\n        var aspectmode = sceneId + '.aspectmode';\n        var scene = fullLayout[sceneId]._scene;\n        var didUpdate;\n\n        if(resetLastSave) {\n            aobj[camera + '.up'] = scene.viewInitial.up;\n            aobj[camera + '.eye'] = scene.viewInitial.eye;\n            aobj[camera + '.center'] = scene.viewInitial.center;\n            didUpdate = true;\n        } else if(resetDefault) {\n            aobj[camera + '.up'] = null;\n            aobj[camera + '.eye'] = null;\n            aobj[camera + '.center'] = null;\n            didUpdate = true;\n        }\n\n        if(didUpdate) {\n            aobj[aspectratio + '.x'] = scene.viewInitial.aspectratio.x;\n            aobj[aspectratio + '.y'] = scene.viewInitial.aspectratio.y;\n            aobj[aspectratio + '.z'] = scene.viewInitial.aspectratio.z;\n            aobj[aspectmode] = scene.viewInitial.aspectmode;\n        }\n    }\n\n    Registry.call('_guiRelayout', gd, aobj);\n}\n\nmodeBarButtons.hoverClosest3d = {\n    name: 'hoverClosest3d',\n    _cat: 'hoverclosest',\n    title: function(gd) { return _(gd, 'Toggle show closest data on hover'); },\n    attr: 'hovermode',\n    val: null,\n    toggle: true,\n    icon: Icons.tooltip_basic,\n    gravity: 'ne',\n    click: handleHover3d\n};\n\nfunction getNextHover3d(gd, ev) {\n    var button = ev.currentTarget;\n    var val = button._previousVal;\n    var fullLayout = gd._fullLayout;\n    var sceneIds = fullLayout._subplots.gl3d || [];\n\n    var axes = ['xaxis', 'yaxis', 'zaxis'];\n\n    // initialize 'current spike' object to be stored in the DOM\n    var currentSpikes = {};\n    var layoutUpdate = {};\n\n    if(val) {\n        layoutUpdate = val;\n        button._previousVal = null;\n    } else {\n        for(var i = 0; i < sceneIds.length; i++) {\n            var sceneId = sceneIds[i];\n            var sceneLayout = fullLayout[sceneId];\n\n            var hovermodeAStr = sceneId + '.hovermode';\n            currentSpikes[hovermodeAStr] = sceneLayout.hovermode;\n            layoutUpdate[hovermodeAStr] = false;\n\n            // copy all the current spike attrs\n            for(var j = 0; j < 3; j++) {\n                var axis = axes[j];\n                var spikeAStr = sceneId + '.' + axis + '.showspikes';\n                layoutUpdate[spikeAStr] = false;\n                currentSpikes[spikeAStr] = sceneLayout[axis].showspikes;\n            }\n        }\n\n        button._previousVal = currentSpikes;\n    }\n    return layoutUpdate;\n}\n\nfunction handleHover3d(gd, ev) {\n    var layoutUpdate = getNextHover3d(gd, ev);\n    Registry.call('_guiRelayout', gd, layoutUpdate);\n}\n\nmodeBarButtons.zoomInGeo = {\n    name: 'zoomInGeo',\n    _cat: 'zoomin',\n    title: function(gd) { return _(gd, 'Zoom in'); },\n    attr: 'zoom',\n    val: 'in',\n    icon: Icons.zoom_plus,\n    click: handleGeo\n};\n\nmodeBarButtons.zoomOutGeo = {\n    name: 'zoomOutGeo',\n    _cat: 'zoomout',\n    title: function(gd) { return _(gd, 'Zoom out'); },\n    attr: 'zoom',\n    val: 'out',\n    icon: Icons.zoom_minus,\n    click: handleGeo\n};\n\nmodeBarButtons.resetGeo = {\n    name: 'resetGeo',\n    _cat: 'reset',\n    title: function(gd) { return _(gd, 'Reset'); },\n    attr: 'reset',\n    val: null,\n    icon: Icons.autoscale,\n    click: handleGeo\n};\n\nmodeBarButtons.hoverClosestGeo = {\n    name: 'hoverClosestGeo',\n    _cat: 'hoverclosest',\n    title: function(gd) { return _(gd, 'Toggle show closest data on hover'); },\n    attr: 'hovermode',\n    val: null,\n    toggle: true,\n    icon: Icons.tooltip_basic,\n    gravity: 'ne',\n    click: toggleHover\n};\n\nfunction handleGeo(gd, ev) {\n    var button = ev.currentTarget;\n    var attr = button.getAttribute('data-attr');\n    var val = button.getAttribute('data-val') || true;\n    var fullLayout = gd._fullLayout;\n    var geoIds = fullLayout._subplots.geo || [];\n\n    for(var i = 0; i < geoIds.length; i++) {\n        var id = geoIds[i];\n        var geoLayout = fullLayout[id];\n\n        if(attr === 'zoom') {\n            var scale = geoLayout.projection.scale;\n            var newScale = (val === 'in') ? 2 * scale : 0.5 * scale;\n\n            Registry.call('_guiRelayout', gd, id + '.projection.scale', newScale);\n        }\n    }\n\n    if(attr === 'reset') {\n        resetView(gd, 'geo');\n    }\n}\n\nmodeBarButtons.hoverClosestGl2d = {\n    name: 'hoverClosestGl2d',\n    _cat: 'hoverclosest',\n    title: function(gd) { return _(gd, 'Toggle show closest data on hover'); },\n    attr: 'hovermode',\n    val: null,\n    toggle: true,\n    icon: Icons.tooltip_basic,\n    gravity: 'ne',\n    click: toggleHover\n};\n\nmodeBarButtons.hoverClosestPie = {\n    name: 'hoverClosestPie',\n    _cat: 'hoverclosest',\n    title: function(gd) { return _(gd, 'Toggle show closest data on hover'); },\n    attr: 'hovermode',\n    val: 'closest',\n    icon: Icons.tooltip_basic,\n    gravity: 'ne',\n    click: toggleHover\n};\n\nfunction getNextHover(gd) {\n    var fullLayout = gd._fullLayout;\n\n    if(fullLayout.hovermode) return false;\n\n    if(fullLayout._has('cartesian')) {\n        return fullLayout._isHoriz ? 'y' : 'x';\n    }\n    return 'closest';\n}\n\nfunction toggleHover(gd) {\n    var newHover = getNextHover(gd);\n    Registry.call('_guiRelayout', gd, 'hovermode', newHover);\n}\n\nmodeBarButtons.resetViewSankey = {\n    name: 'resetSankeyGroup',\n    title: function(gd) { return _(gd, 'Reset view'); },\n    icon: Icons.home,\n    click: function(gd) {\n        var aObj = {\n            'node.groups': [],\n            'node.x': [],\n            'node.y': []\n        };\n        for(var i = 0; i < gd._fullData.length; i++) {\n            var viewInitial = gd._fullData[i]._viewInitial;\n            aObj['node.groups'].push(viewInitial.node.groups.slice());\n            aObj['node.x'].push(viewInitial.node.x.slice());\n            aObj['node.y'].push(viewInitial.node.y.slice());\n        }\n        Registry.call('restyle', gd, aObj);\n    }\n};\n\n// buttons when more then one plot types are present\n\nmodeBarButtons.toggleHover = {\n    name: 'toggleHover',\n    title: function(gd) { return _(gd, 'Toggle show closest data on hover'); },\n    attr: 'hovermode',\n    val: null,\n    toggle: true,\n    icon: Icons.tooltip_basic,\n    gravity: 'ne',\n    click: function(gd, ev) {\n        var layoutUpdate = getNextHover3d(gd, ev);\n        layoutUpdate.hovermode = getNextHover(gd);\n\n        Registry.call('_guiRelayout', gd, layoutUpdate);\n    }\n};\n\nmodeBarButtons.resetViews = {\n    name: 'resetViews',\n    title: function(gd) { return _(gd, 'Reset views'); },\n    icon: Icons.home,\n    click: function(gd, ev) {\n        var button = ev.currentTarget;\n\n        button.setAttribute('data-attr', 'zoom');\n        button.setAttribute('data-val', 'reset');\n        handleCartesian(gd, ev);\n\n        button.setAttribute('data-attr', 'resetLastSave');\n        handleCamera3d(gd, ev);\n\n        resetView(gd, 'geo');\n        resetView(gd, 'mapbox');\n    }\n};\n\nmodeBarButtons.toggleSpikelines = {\n    name: 'toggleSpikelines',\n    title: function(gd) { return _(gd, 'Toggle Spike Lines'); },\n    icon: Icons.spikeline,\n    attr: '_cartesianSpikesEnabled',\n    val: 'on',\n    click: function(gd) {\n        var fullLayout = gd._fullLayout;\n        var allSpikesEnabled = fullLayout._cartesianSpikesEnabled;\n\n        fullLayout._cartesianSpikesEnabled = allSpikesEnabled === 'on' ? 'off' : 'on';\n        Registry.call('_guiRelayout', gd, setSpikelineVisibility(gd));\n    }\n};\n\nfunction setSpikelineVisibility(gd) {\n    var fullLayout = gd._fullLayout;\n    var areSpikesOn = fullLayout._cartesianSpikesEnabled === 'on';\n    var axList = axisIds.list(gd, null, true);\n    var aobj = {};\n\n    for(var i = 0; i < axList.length; i++) {\n        var ax = axList[i];\n        aobj[ax._name + '.showspikes'] = areSpikesOn ? true : ax._showSpikeInitial;\n    }\n\n    return aobj;\n}\n\nmodeBarButtons.resetViewMapbox = {\n    name: 'resetViewMapbox',\n    _cat: 'resetView',\n    title: function(gd) { return _(gd, 'Reset view'); },\n    attr: 'reset',\n    icon: Icons.home,\n    click: function(gd) {\n        resetView(gd, 'mapbox');\n    }\n};\n\nmodeBarButtons.zoomInMapbox = {\n    name: 'zoomInMapbox',\n    _cat: 'zoomin',\n    title: function(gd) { return _(gd, 'Zoom in'); },\n    attr: 'zoom',\n    val: 'in',\n    icon: Icons.zoom_plus,\n    click: handleMapboxZoom\n};\n\nmodeBarButtons.zoomOutMapbox = {\n    name: 'zoomOutMapbox',\n    _cat: 'zoomout',\n    title: function(gd) { return _(gd, 'Zoom out'); },\n    attr: 'zoom',\n    val: 'out',\n    icon: Icons.zoom_minus,\n    click: handleMapboxZoom\n};\n\nfunction handleMapboxZoom(gd, ev) {\n    var button = ev.currentTarget;\n    var val = button.getAttribute('data-val');\n    var fullLayout = gd._fullLayout;\n    var subplotIds = fullLayout._subplots.mapbox || [];\n    var scalar = 1.05;\n    var aObj = {};\n\n    for(var i = 0; i < subplotIds.length; i++) {\n        var id = subplotIds[i];\n        var current = fullLayout[id].zoom;\n        var next = (val === 'in') ? scalar * current : current / scalar;\n        aObj[id + '.zoom'] = next;\n    }\n\n    Registry.call('_guiRelayout', gd, aObj);\n}\n\nfunction resetView(gd, subplotType) {\n    var fullLayout = gd._fullLayout;\n    var subplotIds = fullLayout._subplots[subplotType] || [];\n    var aObj = {};\n\n    for(var i = 0; i < subplotIds.length; i++) {\n        var id = subplotIds[i];\n        var subplotObj = fullLayout[id]._subplot;\n        var viewInitial = subplotObj.viewInitial;\n        var viewKeys = Object.keys(viewInitial);\n\n        for(var j = 0; j < viewKeys.length; j++) {\n            var key = viewKeys[j];\n            aObj[id + '.' + key] = viewInitial[key];\n        }\n    }\n\n    Registry.call('_guiRelayout', gd, aObj);\n}\n","'use strict';\n\nvar modeBarButtons = require('./buttons');\nvar buttonList = Object.keys(modeBarButtons);\n\nvar DRAW_MODES = [\n    'drawline',\n    'drawopenpath',\n    'drawclosedpath',\n    'drawcircle',\n    'drawrect',\n    'eraseshape'\n];\n\nvar backButtons = [\n    'v1hovermode',\n    'hoverclosest',\n    'hovercompare',\n    'togglehover',\n    'togglespikelines'\n].concat(DRAW_MODES);\n\nvar foreButtons = [];\nvar addToForeButtons = function(b) {\n    if(backButtons.indexOf(b._cat || b.name) !== -1) return;\n    // for convenience add lowercase shotname e.g. zoomin as well fullname zoomInGeo\n    var name = b.name;\n    var _cat = (b._cat || b.name).toLowerCase();\n    if(foreButtons.indexOf(name) === -1) foreButtons.push(name);\n    if(foreButtons.indexOf(_cat) === -1) foreButtons.push(_cat);\n};\nbuttonList.forEach(function(k) {\n    addToForeButtons(modeBarButtons[k]);\n});\nforeButtons.sort();\n\nmodule.exports = {\n    DRAW_MODES: DRAW_MODES,\n    backButtons: backButtons,\n    foreButtons: foreButtons\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Color = require('../color');\nvar Template = require('../../plot_api/plot_template');\nvar attributes = require('./attributes');\n\nmodule.exports = function supplyLayoutDefaults(layoutIn, layoutOut) {\n    var containerIn = layoutIn.modebar || {};\n    var containerOut = Template.newContainer(layoutOut, 'modebar');\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(containerIn, containerOut, attributes, attr, dflt);\n    }\n\n    coerce('orientation');\n    coerce('bgcolor', Color.addOpacity(layoutOut.paper_bgcolor, 0.5));\n    var defaultColor = Color.contrast(Color.rgb(layoutOut.modebar.bgcolor));\n    coerce('color', Color.addOpacity(defaultColor, 0.3));\n    coerce('activecolor', Color.addOpacity(defaultColor, 0.7));\n    coerce('uirevision', layoutOut.uirevision);\n    coerce('add');\n    coerce('remove');\n};\n","'use strict';\n\nmodule.exports = {\n    moduleType: 'component',\n    name: 'modebar',\n\n    layoutAttributes: require('./attributes'),\n    supplyLayoutDefaults: require('./defaults'),\n\n    manage: require('./manage')\n};\n","'use strict';\n\nvar axisIds = require('../../plots/cartesian/axis_ids');\nvar scatterSubTypes = require('../../traces/scatter/subtypes');\nvar Registry = require('../../registry');\nvar isUnifiedHover = require('../fx/helpers').isUnifiedHover;\n\nvar createModeBar = require('./modebar');\nvar modeBarButtons = require('./buttons');\nvar DRAW_MODES = require('./constants').DRAW_MODES;\n\n/**\n * ModeBar wrapper around 'create' and 'update',\n * chooses buttons to pass to ModeBar constructor based on\n * plot type and plot config.\n *\n * @param {object} gd main plot object\n *\n */\nmodule.exports = function manageModeBar(gd) {\n    var fullLayout = gd._fullLayout;\n    var context = gd._context;\n    var modeBar = fullLayout._modeBar;\n\n    if(!context.displayModeBar && !context.watermark) {\n        if(modeBar) {\n            modeBar.destroy();\n            delete fullLayout._modeBar;\n        }\n        return;\n    }\n\n    if(!Array.isArray(context.modeBarButtonsToRemove)) {\n        throw new Error([\n            '*modeBarButtonsToRemove* configuration options',\n            'must be an array.'\n        ].join(' '));\n    }\n\n    if(!Array.isArray(context.modeBarButtonsToAdd)) {\n        throw new Error([\n            '*modeBarButtonsToAdd* configuration options',\n            'must be an array.'\n        ].join(' '));\n    }\n\n    var customButtons = context.modeBarButtons;\n    var buttonGroups;\n\n    if(Array.isArray(customButtons) && customButtons.length) {\n        buttonGroups = fillCustomButton(customButtons);\n    } else if(!context.displayModeBar && context.watermark) {\n        buttonGroups = [];\n    } else {\n        buttonGroups = getButtonGroups(gd);\n    }\n\n    if(modeBar) modeBar.update(gd, buttonGroups);\n    else fullLayout._modeBar = createModeBar(gd, buttonGroups);\n};\n\n// logic behind which buttons are displayed by default\nfunction getButtonGroups(gd) {\n    var fullLayout = gd._fullLayout;\n    var fullData = gd._fullData;\n    var context = gd._context;\n\n    function match(name, B) {\n        if(typeof B === 'string') {\n            if(B.toLowerCase() === name.toLowerCase()) return true;\n        } else {\n            var v0 = B.name;\n            var v1 = (B._cat || B.name);\n\n            if(v0 === name || v1 === name.toLowerCase()) return true;\n        }\n        return false;\n    }\n\n    var layoutAdd = fullLayout.modebar.add;\n    if(typeof layoutAdd === 'string') layoutAdd = [layoutAdd];\n\n    var layoutRemove = fullLayout.modebar.remove;\n    if(typeof layoutRemove === 'string') layoutRemove = [layoutRemove];\n\n    var buttonsToAdd = context.modeBarButtonsToAdd.concat(\n        layoutAdd.filter(function(e) {\n            for(var i = 0; i < context.modeBarButtonsToRemove.length; i++) {\n                if(match(e, context.modeBarButtonsToRemove[i])) return false;\n            }\n            return true;\n        })\n    );\n\n    var buttonsToRemove = context.modeBarButtonsToRemove.concat(\n        layoutRemove.filter(function(e) {\n            for(var i = 0; i < context.modeBarButtonsToAdd.length; i++) {\n                if(match(e, context.modeBarButtonsToAdd[i])) return false;\n            }\n            return true;\n        })\n    );\n\n    var hasCartesian = fullLayout._has('cartesian');\n    var hasGL3D = fullLayout._has('gl3d');\n    var hasGeo = fullLayout._has('geo');\n    var hasPie = fullLayout._has('pie');\n    var hasFunnelarea = fullLayout._has('funnelarea');\n    var hasGL2D = fullLayout._has('gl2d');\n    var hasTernary = fullLayout._has('ternary');\n    var hasMapbox = fullLayout._has('mapbox');\n    var hasPolar = fullLayout._has('polar');\n    var hasSankey = fullLayout._has('sankey');\n    var allAxesFixed = areAllAxesFixed(fullLayout);\n    var hasUnifiedHoverLabel = isUnifiedHover(fullLayout.hovermode);\n\n    var groups = [];\n\n    function addGroup(newGroup) {\n        if(!newGroup.length) return;\n\n        var out = [];\n\n        for(var i = 0; i < newGroup.length; i++) {\n            var name = newGroup[i];\n            var B = modeBarButtons[name];\n            var v0 = B.name.toLowerCase();\n            var v1 = (B._cat || B.name).toLowerCase();\n            var found = false;\n            for(var q = 0; q < buttonsToRemove.length; q++) {\n                var t = buttonsToRemove[q].toLowerCase();\n                if(t === v0 || t === v1) {\n                    found = true;\n                    break;\n                }\n            }\n            if(found) continue;\n            out.push(modeBarButtons[name]);\n        }\n\n        groups.push(out);\n    }\n\n    // buttons common to all plot types\n    var commonGroup = ['toImage'];\n    if(context.showEditInChartStudio) commonGroup.push('editInChartStudio');\n    else if(context.showSendToCloud) commonGroup.push('sendDataToCloud');\n    addGroup(commonGroup);\n\n    var zoomGroup = [];\n    var hoverGroup = [];\n    var resetGroup = [];\n    var dragModeGroup = [];\n\n    if((hasCartesian || hasGL2D || hasPie || hasFunnelarea || hasTernary) + hasGeo + hasGL3D + hasMapbox + hasPolar > 1) {\n        // graphs with more than one plot types get 'union buttons'\n        // which reset the view or toggle hover labels across all subplots.\n        hoverGroup = ['toggleHover'];\n        resetGroup = ['resetViews'];\n    } else if(hasGeo) {\n        zoomGroup = ['zoomInGeo', 'zoomOutGeo'];\n        hoverGroup = ['hoverClosestGeo'];\n        resetGroup = ['resetGeo'];\n    } else if(hasGL3D) {\n        hoverGroup = ['hoverClosest3d'];\n        resetGroup = ['resetCameraDefault3d', 'resetCameraLastSave3d'];\n    } else if(hasMapbox) {\n        zoomGroup = ['zoomInMapbox', 'zoomOutMapbox'];\n        hoverGroup = ['toggleHover'];\n        resetGroup = ['resetViewMapbox'];\n    } else if(hasGL2D) {\n        hoverGroup = ['hoverClosestGl2d'];\n    } else if(hasPie) {\n        hoverGroup = ['hoverClosestPie'];\n    } else if(hasSankey) {\n        hoverGroup = ['hoverClosestCartesian', 'hoverCompareCartesian'];\n        resetGroup = ['resetViewSankey'];\n    } else { // hasPolar, hasTernary\n        // always show at least one hover icon.\n        hoverGroup = ['toggleHover'];\n    }\n    // if we have cartesian, allow switching between closest and compare\n    // regardless of what other types are on the plot, since they'll all\n    // just treat any truthy hovermode as 'closest'\n    if(hasCartesian) {\n        hoverGroup = ['toggleSpikelines', 'hoverClosestCartesian', 'hoverCompareCartesian'];\n    }\n    if(hasNoHover(fullData) || hasUnifiedHoverLabel) {\n        hoverGroup = [];\n    }\n\n    if((hasCartesian || hasGL2D) && !allAxesFixed) {\n        zoomGroup = ['zoomIn2d', 'zoomOut2d', 'autoScale2d'];\n        if(resetGroup[0] !== 'resetViews') resetGroup = ['resetScale2d'];\n    }\n\n    if(hasGL3D) {\n        dragModeGroup = ['zoom3d', 'pan3d', 'orbitRotation', 'tableRotation'];\n    } else if(((hasCartesian || hasGL2D) && !allAxesFixed) || hasTernary) {\n        dragModeGroup = ['zoom2d', 'pan2d'];\n    } else if(hasMapbox || hasGeo) {\n        dragModeGroup = ['pan2d'];\n    } else if(hasPolar) {\n        dragModeGroup = ['zoom2d'];\n    }\n    if(isSelectable(fullData)) {\n        dragModeGroup.push('select2d', 'lasso2d');\n    }\n\n    var enabledHoverGroup = [];\n    var enableHover = function(a) {\n        // return if already added\n        if(enabledHoverGroup.indexOf(a) !== -1) return;\n        // should be in hoverGroup\n        if(hoverGroup.indexOf(a) !== -1) {\n            enabledHoverGroup.push(a);\n        }\n    };\n    if(Array.isArray(buttonsToAdd)) {\n        var newList = [];\n        for(var i = 0; i < buttonsToAdd.length; i++) {\n            var b = buttonsToAdd[i];\n            if(typeof b === 'string') {\n                b = b.toLowerCase();\n\n                if(DRAW_MODES.indexOf(b) !== -1) {\n                    // accept pre-defined drag modes i.e. shape drawing features as string\n                    if(\n                        fullLayout._has('mapbox') || // draw shapes in paper coordinate (could be improved in future to support data coordinate, when there is no pitch)\n                        fullLayout._has('cartesian') // draw shapes in data coordinate\n                    ) {\n                        dragModeGroup.push(b);\n                    }\n                } else if(b === 'togglespikelines') {\n                    enableHover('toggleSpikelines');\n                } else if(b === 'togglehover') {\n                    enableHover('toggleHover');\n                } else if(b === 'hovercompare') {\n                    enableHover('hoverCompareCartesian');\n                } else if(b === 'hoverclosest') {\n                    enableHover('hoverClosestCartesian');\n                    enableHover('hoverClosestGeo');\n                    enableHover('hoverClosest3d');\n                    enableHover('hoverClosestGl2d');\n                    enableHover('hoverClosestPie');\n                } else if(b === 'v1hovermode') {\n                    enableHover('toggleHover');\n                    enableHover('hoverClosestCartesian');\n                    enableHover('hoverCompareCartesian');\n                    enableHover('hoverClosestGeo');\n                    enableHover('hoverClosest3d');\n                    enableHover('hoverClosestGl2d');\n                    enableHover('hoverClosestPie');\n                }\n            } else newList.push(b);\n        }\n        buttonsToAdd = newList;\n    }\n\n    addGroup(dragModeGroup);\n    addGroup(zoomGroup.concat(resetGroup));\n    addGroup(enabledHoverGroup);\n\n    return appendButtonsToGroups(groups, buttonsToAdd);\n}\n\nfunction areAllAxesFixed(fullLayout) {\n    var axList = axisIds.list({_fullLayout: fullLayout}, null, true);\n\n    for(var i = 0; i < axList.length; i++) {\n        if(!axList[i].fixedrange) {\n            return false;\n        }\n    }\n\n    return true;\n}\n\n// look for traces that support selection\n// to be updated as we add more selectPoints handlers\nfunction isSelectable(fullData) {\n    var selectable = false;\n\n    for(var i = 0; i < fullData.length; i++) {\n        if(selectable) break;\n\n        var trace = fullData[i];\n\n        if(!trace._module || !trace._module.selectPoints) continue;\n\n        if(Registry.traceIs(trace, 'scatter-like')) {\n            if(scatterSubTypes.hasMarkers(trace) || scatterSubTypes.hasText(trace)) {\n                selectable = true;\n            }\n        } else if(Registry.traceIs(trace, 'box-violin')) {\n            if(trace.boxpoints === 'all' || trace.points === 'all') {\n                selectable = true;\n            }\n        } else {\n            // assume that in general if the trace module has selectPoints,\n            // then it's selectable. Scatter is an exception to this because it must\n            // have markers or text, not just be a scatter type.\n\n            selectable = true;\n        }\n    }\n\n    return selectable;\n}\n\n// check whether all trace are 'noHover'\nfunction hasNoHover(fullData) {\n    for(var i = 0; i < fullData.length; i++) {\n        if(!Registry.traceIs(fullData[i], 'noHover')) return false;\n    }\n    return true;\n}\n\nfunction appendButtonsToGroups(groups, buttons) {\n    if(buttons.length) {\n        if(Array.isArray(buttons[0])) {\n            for(var i = 0; i < buttons.length; i++) {\n                groups.push(buttons[i]);\n            }\n        } else groups.push(buttons);\n    }\n\n    return groups;\n}\n\n// fill in custom buttons referring to default mode bar buttons\nfunction fillCustomButton(customButtons) {\n    for(var i = 0; i < customButtons.length; i++) {\n        var buttonGroup = customButtons[i];\n\n        for(var j = 0; j < buttonGroup.length; j++) {\n            var button = buttonGroup[j];\n\n            if(typeof button === 'string') {\n                if(modeBarButtons[button] !== undefined) {\n                    customButtons[i][j] = modeBarButtons[button];\n                } else {\n                    throw new Error([\n                        '*modeBarButtons* configuration options',\n                        'invalid button name'\n                    ].join(' '));\n                }\n            }\n        }\n    }\n\n    return customButtons;\n}\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar isNumeric = require('fast-isnumeric');\n\nvar Lib = require('../../lib');\nvar Icons = require('../../fonts/ploticon');\nvar Parser = new DOMParser();\n\n/**\n * UI controller for interactive plots\n * @Class\n * @Param {object} opts\n * @Param {object} opts.buttons    nested arrays of grouped buttons config objects\n * @Param {object} opts.container  container div to append modeBar\n * @Param {object} opts.graphInfo  primary plot object containing data and layout\n */\nfunction ModeBar(opts) {\n    this.container = opts.container;\n    this.element = document.createElement('div');\n\n    this.update(opts.graphInfo, opts.buttons);\n\n    this.container.appendChild(this.element);\n}\n\nvar proto = ModeBar.prototype;\n\n/**\n * Update modeBar (buttons and logo)\n *\n * @param {object} graphInfo  primary plot object containing data and layout\n * @param {array of arrays} buttons nested arrays of grouped buttons to initialize\n *\n */\nproto.update = function(graphInfo, buttons) {\n    this.graphInfo = graphInfo;\n\n    var context = this.graphInfo._context;\n    var fullLayout = this.graphInfo._fullLayout;\n    var modeBarId = 'modebar-' + fullLayout._uid;\n\n    this.element.setAttribute('id', modeBarId);\n    this._uid = modeBarId;\n\n    this.element.className = 'modebar';\n    if(context.displayModeBar === 'hover') this.element.className += ' modebar--hover ease-bg';\n\n    if(fullLayout.modebar.orientation === 'v') {\n        this.element.className += ' vertical';\n        buttons = buttons.reverse();\n    }\n\n    var style = fullLayout.modebar;\n    var bgSelector = context.displayModeBar === 'hover' ? '.js-plotly-plot .plotly:hover ' : '';\n\n    Lib.deleteRelatedStyleRule(modeBarId);\n    Lib.addRelatedStyleRule(modeBarId, bgSelector + '#' + modeBarId + ' .modebar-group', 'background-color: ' + style.bgcolor);\n    Lib.addRelatedStyleRule(modeBarId, '#' + modeBarId + ' .modebar-btn .icon path', 'fill: ' + style.color);\n    Lib.addRelatedStyleRule(modeBarId, '#' + modeBarId + ' .modebar-btn:hover .icon path', 'fill: ' + style.activecolor);\n    Lib.addRelatedStyleRule(modeBarId, '#' + modeBarId + ' .modebar-btn.active .icon path', 'fill: ' + style.activecolor);\n\n    // if buttons or logo have changed, redraw modebar interior\n    var needsNewButtons = !this.hasButtons(buttons);\n    var needsNewLogo = (this.hasLogo !== context.displaylogo);\n    var needsNewLocale = (this.locale !== context.locale);\n\n    this.locale = context.locale;\n\n    if(needsNewButtons || needsNewLogo || needsNewLocale) {\n        this.removeAllButtons();\n\n        this.updateButtons(buttons);\n\n        if(context.watermark || context.displaylogo) {\n            var logoGroup = this.getLogo();\n            if(context.watermark) {\n                logoGroup.className = logoGroup.className + ' watermark';\n            }\n\n            if(fullLayout.modebar.orientation === 'v') {\n                this.element.insertBefore(logoGroup, this.element.childNodes[0]);\n            } else {\n                this.element.appendChild(logoGroup);\n            }\n\n            this.hasLogo = true;\n        }\n    }\n\n    this.updateActiveButton();\n};\n\nproto.updateButtons = function(buttons) {\n    var _this = this;\n\n    this.buttons = buttons;\n    this.buttonElements = [];\n    this.buttonsNames = [];\n\n    this.buttons.forEach(function(buttonGroup) {\n        var group = _this.createGroup();\n\n        buttonGroup.forEach(function(buttonConfig) {\n            var buttonName = buttonConfig.name;\n            if(!buttonName) {\n                throw new Error('must provide button \\'name\\' in button config');\n            }\n            if(_this.buttonsNames.indexOf(buttonName) !== -1) {\n                throw new Error('button name \\'' + buttonName + '\\' is taken');\n            }\n            _this.buttonsNames.push(buttonName);\n\n            var button = _this.createButton(buttonConfig);\n            _this.buttonElements.push(button);\n            group.appendChild(button);\n        });\n\n        _this.element.appendChild(group);\n    });\n};\n\n/**\n * Empty div for containing a group of buttons\n * @Return {HTMLelement}\n */\nproto.createGroup = function() {\n    var group = document.createElement('div');\n    group.className = 'modebar-group';\n    return group;\n};\n\n/**\n * Create a new button div and set constant and configurable attributes\n * @Param {object} config (see ./buttons.js for more info)\n * @Return {HTMLelement}\n */\nproto.createButton = function(config) {\n    var _this = this;\n    var button = document.createElement('a');\n\n    button.setAttribute('rel', 'tooltip');\n    button.className = 'modebar-btn';\n\n    var title = config.title;\n    if(title === undefined) title = config.name;\n    // for localization: allow title to be a callable that takes gd as arg\n    else if(typeof title === 'function') title = title(this.graphInfo);\n\n    if(title || title === 0) button.setAttribute('data-title', title);\n\n    if(config.attr !== undefined) button.setAttribute('data-attr', config.attr);\n\n    var val = config.val;\n    if(val !== undefined) {\n        if(typeof val === 'function') val = val(this.graphInfo);\n        button.setAttribute('data-val', val);\n    }\n\n    var click = config.click;\n    if(typeof click !== 'function') {\n        throw new Error('must provide button \\'click\\' function in button config');\n    } else {\n        button.addEventListener('click', function(ev) {\n            config.click(_this.graphInfo, ev);\n\n            // only needed for 'hoverClosestGeo' which does not call relayout\n            _this.updateActiveButton(ev.currentTarget);\n        });\n    }\n\n    button.setAttribute('data-toggle', config.toggle || false);\n    if(config.toggle) d3.select(button).classed('active', true);\n\n    var icon = config.icon;\n    if(typeof icon === 'function') {\n        button.appendChild(icon());\n    } else {\n        button.appendChild(this.createIcon(icon || Icons.question));\n    }\n    button.setAttribute('data-gravity', config.gravity || 'n');\n\n    return button;\n};\n\n/**\n * Add an icon to a button\n * @Param {object} thisIcon\n * @Param {number} thisIcon.width\n * @Param {string} thisIcon.path\n * @Param {string} thisIcon.color\n * @Return {HTMLelement}\n */\nproto.createIcon = function(thisIcon) {\n    var iconHeight = isNumeric(thisIcon.height) ?\n        Number(thisIcon.height) :\n        thisIcon.ascent - thisIcon.descent;\n    var svgNS = 'http://www.w3.org/2000/svg';\n    var icon;\n\n    if(thisIcon.path) {\n        icon = document.createElementNS(svgNS, 'svg');\n        icon.setAttribute('viewBox', [0, 0, thisIcon.width, iconHeight].join(' '));\n        icon.setAttribute('class', 'icon');\n\n        var path = document.createElementNS(svgNS, 'path');\n        path.setAttribute('d', thisIcon.path);\n\n        if(thisIcon.transform) {\n            path.setAttribute('transform', thisIcon.transform);\n        } else if(thisIcon.ascent !== undefined) {\n            // Legacy icon transform calculation\n            path.setAttribute('transform', 'matrix(1 0 0 -1 0 ' + thisIcon.ascent + ')');\n        }\n\n        icon.appendChild(path);\n    }\n\n    if(thisIcon.svg) {\n        var svgDoc = Parser.parseFromString(thisIcon.svg, 'application/xml');\n        icon = svgDoc.childNodes[0];\n    }\n\n    icon.setAttribute('height', '1em');\n    icon.setAttribute('width', '1em');\n\n    return icon;\n};\n\n/**\n * Updates active button with attribute specified in layout\n * @Param {object} graphInfo plot object containing data and layout\n * @Return {HTMLelement}\n */\nproto.updateActiveButton = function(buttonClicked) {\n    var fullLayout = this.graphInfo._fullLayout;\n    var dataAttrClicked = (buttonClicked !== undefined) ?\n        buttonClicked.getAttribute('data-attr') :\n        null;\n\n    this.buttonElements.forEach(function(button) {\n        var thisval = button.getAttribute('data-val') || true;\n        var dataAttr = button.getAttribute('data-attr');\n        var isToggleButton = (button.getAttribute('data-toggle') === 'true');\n        var button3 = d3.select(button);\n\n        // Use 'data-toggle' and 'buttonClicked' to toggle buttons\n        // that have no one-to-one equivalent in fullLayout\n        if(isToggleButton) {\n            if(dataAttr === dataAttrClicked) {\n                button3.classed('active', !button3.classed('active'));\n            }\n        } else {\n            var val = (dataAttr === null) ?\n                dataAttr :\n                Lib.nestedProperty(fullLayout, dataAttr).get();\n\n            button3.classed('active', val === thisval);\n        }\n    });\n};\n\n/**\n * Check if modeBar is configured as button configuration argument\n *\n * @Param {object} buttons 2d array of grouped button config objects\n * @Return {boolean}\n */\nproto.hasButtons = function(buttons) {\n    var currentButtons = this.buttons;\n\n    if(!currentButtons) return false;\n\n    if(buttons.length !== currentButtons.length) return false;\n\n    for(var i = 0; i < buttons.length; ++i) {\n        if(buttons[i].length !== currentButtons[i].length) return false;\n        for(var j = 0; j < buttons[i].length; j++) {\n            if(buttons[i][j].name !== currentButtons[i][j].name) return false;\n        }\n    }\n\n    return true;\n};\n\n/**\n * @return {HTMLDivElement} The logo image wrapped in a group\n */\nproto.getLogo = function() {\n    var group = this.createGroup();\n    var a = document.createElement('a');\n\n    a.href = 'https://plotly.com/';\n    a.target = '_blank';\n    a.setAttribute('data-title', Lib._(this.graphInfo, 'Produced with Plotly'));\n    a.className = 'modebar-btn plotlyjsicon modebar-btn--logo';\n\n    a.appendChild(this.createIcon(Icons.newplotlylogo));\n\n    group.appendChild(a);\n    return group;\n};\n\nproto.removeAllButtons = function() {\n    while(this.element.firstChild) {\n        this.element.removeChild(this.element.firstChild);\n    }\n\n    this.hasLogo = false;\n};\n\nproto.destroy = function() {\n    Lib.removeElement(this.container.querySelector('.modebar'));\n    Lib.deleteRelatedStyleRule(this._uid);\n};\n\nfunction createModeBar(gd, buttons) {\n    var fullLayout = gd._fullLayout;\n\n    var modeBar = new ModeBar({\n        graphInfo: gd,\n        container: fullLayout._modebardiv.node(),\n        buttons: buttons\n    });\n\n    if(fullLayout._privateplot) {\n        d3.select(modeBar.element).append('span')\n            .classed('badge-private float--left', true)\n            .text('PRIVATE');\n    }\n\n    return modeBar;\n}\n\nmodule.exports = createModeBar;\n","'use strict';\n\nvar fontAttrs = require('../../plots/font_attributes');\nvar colorAttrs = require('../color/attributes');\nvar templatedArray = require('../../plot_api/plot_template').templatedArray;\n\nvar buttonAttrs = templatedArray('button', {\n    visible: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'plot',\n        description: 'Determines whether or not this button is visible.'\n    },\n    step: {\n        valType: 'enumerated',\n        values: ['month', 'year', 'day', 'hour', 'minute', 'second', 'all'],\n        dflt: 'month',\n        editType: 'plot',\n        description: [\n            'The unit of measurement that the `count` value will set the range by.'\n        ].join(' ')\n    },\n    stepmode: {\n        valType: 'enumerated',\n        values: ['backward', 'todate'],\n        dflt: 'backward',\n        editType: 'plot',\n        description: [\n            'Sets the range update mode.',\n            'If *backward*, the range update shifts the start of range',\n            'back *count* times *step* milliseconds.',\n            'If *todate*, the range update shifts the start of range',\n            'back to the first timestamp from *count* times',\n            '*step* milliseconds back.',\n            'For example, with `step` set to *year* and `count` set to *1*',\n            'the range update shifts the start of the range back to',\n            'January 01 of the current year.',\n            'Month and year *todate* are currently available only',\n            'for the built-in (Gregorian) calendar.'\n        ].join(' ')\n    },\n    count: {\n        valType: 'number',\n        min: 0,\n        dflt: 1,\n        editType: 'plot',\n        description: [\n            'Sets the number of steps to take to update the range.',\n            'Use with `step` to specify the update interval.'\n        ].join(' ')\n    },\n    label: {\n        valType: 'string',\n        editType: 'plot',\n        description: 'Sets the text label to appear on the button.'\n    },\n    editType: 'plot',\n    description: [\n        'Sets the specifications for each buttons.',\n        'By default, a range selector comes with no buttons.'\n    ].join(' ')\n});\n\nmodule.exports = {\n    visible: {\n        valType: 'boolean',\n        editType: 'plot',\n        description: [\n            'Determines whether or not this range selector is visible.',\n            'Note that range selectors are only available for x axes of',\n            '`type` set to or auto-typed to *date*.'\n        ].join(' ')\n    },\n\n    buttons: buttonAttrs,\n\n    x: {\n        valType: 'number',\n        min: -2,\n        max: 3,\n        editType: 'plot',\n        description: 'Sets the x position (in normalized coordinates) of the range selector.'\n    },\n    xanchor: {\n        valType: 'enumerated',\n        values: ['auto', 'left', 'center', 'right'],\n        dflt: 'left',\n        editType: 'plot',\n        description: [\n            'Sets the range selector\\'s horizontal position anchor.',\n            'This anchor binds the `x` position to the *left*, *center*',\n            'or *right* of the range selector.'\n        ].join(' ')\n    },\n    y: {\n        valType: 'number',\n        min: -2,\n        max: 3,\n        editType: 'plot',\n        description: 'Sets the y position (in normalized coordinates) of the range selector.'\n    },\n    yanchor: {\n        valType: 'enumerated',\n        values: ['auto', 'top', 'middle', 'bottom'],\n        dflt: 'bottom',\n        editType: 'plot',\n        description: [\n            'Sets the range selector\\'s vertical position anchor',\n            'This anchor binds the `y` position to the *top*, *middle*',\n            'or *bottom* of the range selector.'\n        ].join(' ')\n    },\n\n    font: fontAttrs({\n        editType: 'plot',\n        description: 'Sets the font of the range selector button text.'\n    }),\n\n    bgcolor: {\n        valType: 'color',\n        dflt: colorAttrs.lightLine,\n        editType: 'plot',\n        description: 'Sets the background color of the range selector buttons.'\n    },\n    activecolor: {\n        valType: 'color',\n        editType: 'plot',\n        description: 'Sets the background color of the active range selector button.'\n    },\n    bordercolor: {\n        valType: 'color',\n        dflt: colorAttrs.defaultLine,\n        editType: 'plot',\n        description: 'Sets the color of the border enclosing the range selector.'\n    },\n    borderwidth: {\n        valType: 'number',\n        min: 0,\n        dflt: 0,\n        editType: 'plot',\n        description: 'Sets the width (in px) of the border enclosing the range selector.'\n    },\n    editType: 'plot'\n};\n","'use strict';\n\n\nmodule.exports = {\n\n    // 'y' position pad above counter axis domain\n    yPad: 0.02,\n\n    // minimum button width (regardless of text size)\n    minButtonWidth: 30,\n\n    // buttons rect radii\n    rx: 3,\n    ry: 3,\n\n    // light fraction used to compute the 'activecolor' default\n    lightAmount: 25,\n    darkAmount: 10\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Color = require('../color');\nvar Template = require('../../plot_api/plot_template');\nvar handleArrayContainerDefaults = require('../../plots/array_container_defaults');\n\nvar attributes = require('./attributes');\nvar constants = require('./constants');\n\n\nmodule.exports = function handleDefaults(containerIn, containerOut, layout, counterAxes, calendar) {\n    var selectorIn = containerIn.rangeselector || {};\n    var selectorOut = Template.newContainer(containerOut, 'rangeselector');\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(selectorIn, selectorOut, attributes, attr, dflt);\n    }\n\n    var buttons = handleArrayContainerDefaults(selectorIn, selectorOut, {\n        name: 'buttons',\n        handleItemDefaults: buttonDefaults,\n        calendar: calendar\n    });\n\n    var visible = coerce('visible', buttons.length > 0);\n    if(visible) {\n        var posDflt = getPosDflt(containerOut, layout, counterAxes);\n        coerce('x', posDflt[0]);\n        coerce('y', posDflt[1]);\n        Lib.noneOrAll(containerIn, containerOut, ['x', 'y']);\n\n        coerce('xanchor');\n        coerce('yanchor');\n\n        Lib.coerceFont(coerce, 'font', layout.font);\n\n        var bgColor = coerce('bgcolor');\n        coerce('activecolor', Color.contrast(bgColor, constants.lightAmount, constants.darkAmount));\n        coerce('bordercolor');\n        coerce('borderwidth');\n    }\n};\n\nfunction buttonDefaults(buttonIn, buttonOut, selectorOut, opts) {\n    var calendar = opts.calendar;\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(buttonIn, buttonOut, attributes.buttons, attr, dflt);\n    }\n\n    var visible = coerce('visible');\n\n    if(visible) {\n        var step = coerce('step');\n        if(step !== 'all') {\n            if(calendar && calendar !== 'gregorian' && (step === 'month' || step === 'year')) {\n                buttonOut.stepmode = 'backward';\n            } else {\n                coerce('stepmode');\n            }\n\n            coerce('count');\n        }\n\n        coerce('label');\n    }\n}\n\nfunction getPosDflt(containerOut, layout, counterAxes) {\n    var anchoredList = counterAxes.filter(function(ax) {\n        return layout[ax].anchor === containerOut._id;\n    });\n\n    var posY = 0;\n    for(var i = 0; i < anchoredList.length; i++) {\n        var domain = layout[anchoredList[i]].domain;\n        if(domain) posY = Math.max(domain[1], posY);\n    }\n\n    return [containerOut.domain[0], posY + constants.yPad];\n}\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Registry = require('../../registry');\nvar Plots = require('../../plots/plots');\nvar Color = require('../color');\nvar Drawing = require('../drawing');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar axisIds = require('../../plots/cartesian/axis_ids');\n\nvar alignmentConstants = require('../../constants/alignment');\nvar LINE_SPACING = alignmentConstants.LINE_SPACING;\nvar FROM_TL = alignmentConstants.FROM_TL;\nvar FROM_BR = alignmentConstants.FROM_BR;\n\nvar constants = require('./constants');\nvar getUpdateObject = require('./get_update_object');\n\nmodule.exports = function draw(gd) {\n    var fullLayout = gd._fullLayout;\n\n    var selectors = fullLayout._infolayer.selectAll('.rangeselector')\n        .data(makeSelectorData(gd), selectorKeyFunc);\n\n    selectors.enter().append('g')\n        .classed('rangeselector', true);\n\n    selectors.exit().remove();\n\n    selectors.style({\n        cursor: 'pointer',\n        'pointer-events': 'all'\n    });\n\n    selectors.each(function(d) {\n        var selector = d3.select(this);\n        var axisLayout = d;\n        var selectorLayout = axisLayout.rangeselector;\n\n        var buttons = selector.selectAll('g.button')\n            .data(Lib.filterVisible(selectorLayout.buttons));\n\n        buttons.enter().append('g')\n            .classed('button', true);\n\n        buttons.exit().remove();\n\n        buttons.each(function(d) {\n            var button = d3.select(this);\n            var update = getUpdateObject(axisLayout, d);\n\n            d._isActive = isActive(axisLayout, d, update);\n\n            button.call(drawButtonRect, selectorLayout, d);\n            button.call(drawButtonText, selectorLayout, d, gd);\n\n            button.on('click', function() {\n                if(gd._dragged) return;\n\n                Registry.call('_guiRelayout', gd, update);\n            });\n\n            button.on('mouseover', function() {\n                d._isHovered = true;\n                button.call(drawButtonRect, selectorLayout, d);\n            });\n\n            button.on('mouseout', function() {\n                d._isHovered = false;\n                button.call(drawButtonRect, selectorLayout, d);\n            });\n        });\n\n        reposition(gd, buttons, selectorLayout, axisLayout._name, selector);\n    });\n};\n\nfunction makeSelectorData(gd) {\n    var axes = axisIds.list(gd, 'x', true);\n    var data = [];\n\n    for(var i = 0; i < axes.length; i++) {\n        var axis = axes[i];\n\n        if(axis.rangeselector && axis.rangeselector.visible) {\n            data.push(axis);\n        }\n    }\n\n    return data;\n}\n\nfunction selectorKeyFunc(d) {\n    return d._id;\n}\n\nfunction isActive(axisLayout, opts, update) {\n    if(opts.step === 'all') {\n        return axisLayout.autorange === true;\n    } else {\n        var keys = Object.keys(update);\n\n        return (\n            axisLayout.range[0] === update[keys[0]] &&\n            axisLayout.range[1] === update[keys[1]]\n        );\n    }\n}\n\nfunction drawButtonRect(button, selectorLayout, d) {\n    var rect = Lib.ensureSingle(button, 'rect', 'selector-rect', function(s) {\n        s.attr('shape-rendering', 'crispEdges');\n    });\n\n    rect.attr({\n        'rx': constants.rx,\n        'ry': constants.ry\n    });\n\n    rect.call(Color.stroke, selectorLayout.bordercolor)\n        .call(Color.fill, getFillColor(selectorLayout, d))\n        .style('stroke-width', selectorLayout.borderwidth + 'px');\n}\n\nfunction getFillColor(selectorLayout, d) {\n    return (d._isActive || d._isHovered) ?\n        selectorLayout.activecolor :\n        selectorLayout.bgcolor;\n}\n\nfunction drawButtonText(button, selectorLayout, d, gd) {\n    function textLayout(s) {\n        svgTextUtils.convertToTspans(s, gd);\n    }\n\n    var text = Lib.ensureSingle(button, 'text', 'selector-text', function(s) {\n        s.attr('text-anchor', 'middle');\n    });\n\n    text.call(Drawing.font, selectorLayout.font)\n        .text(getLabel(d, gd._fullLayout._meta))\n        .call(textLayout);\n}\n\nfunction getLabel(opts, _meta) {\n    if(opts.label) {\n        return _meta ?\n            Lib.templateString(opts.label, _meta) :\n            opts.label;\n    }\n\n    if(opts.step === 'all') return 'all';\n\n    return opts.count + opts.step.charAt(0);\n}\n\nfunction reposition(gd, buttons, opts, axName, selector) {\n    var width = 0;\n    var height = 0;\n\n    var borderWidth = opts.borderwidth;\n\n    buttons.each(function() {\n        var button = d3.select(this);\n        var text = button.select('.selector-text');\n\n        var tHeight = opts.font.size * LINE_SPACING;\n        var hEff = Math.max(tHeight * svgTextUtils.lineCount(text), 16) + 3;\n\n        height = Math.max(height, hEff);\n    });\n\n    buttons.each(function() {\n        var button = d3.select(this);\n        var rect = button.select('.selector-rect');\n        var text = button.select('.selector-text');\n\n        var tWidth = text.node() && Drawing.bBox(text.node()).width;\n        var tHeight = opts.font.size * LINE_SPACING;\n        var tLines = svgTextUtils.lineCount(text);\n\n        var wEff = Math.max(tWidth + 10, constants.minButtonWidth);\n\n        // TODO add MathJax support\n\n        // TODO add buttongap attribute\n\n        button.attr('transform', strTranslate(borderWidth + width, borderWidth));\n\n        rect.attr({\n            x: 0,\n            y: 0,\n            width: wEff,\n            height: height\n        });\n\n        svgTextUtils.positionText(text, wEff / 2,\n            height / 2 - ((tLines - 1) * tHeight / 2) + 3);\n\n        width += wEff + 5;\n    });\n\n    var graphSize = gd._fullLayout._size;\n    var lx = graphSize.l + graphSize.w * opts.x;\n    var ly = graphSize.t + graphSize.h * (1 - opts.y);\n\n    var xanchor = 'left';\n    if(Lib.isRightAnchor(opts)) {\n        lx -= width;\n        xanchor = 'right';\n    }\n    if(Lib.isCenterAnchor(opts)) {\n        lx -= width / 2;\n        xanchor = 'center';\n    }\n\n    var yanchor = 'top';\n    if(Lib.isBottomAnchor(opts)) {\n        ly -= height;\n        yanchor = 'bottom';\n    }\n    if(Lib.isMiddleAnchor(opts)) {\n        ly -= height / 2;\n        yanchor = 'middle';\n    }\n\n    width = Math.ceil(width);\n    height = Math.ceil(height);\n    lx = Math.round(lx);\n    ly = Math.round(ly);\n\n    Plots.autoMargin(gd, axName + '-range-selector', {\n        x: opts.x,\n        y: opts.y,\n        l: width * FROM_TL[xanchor],\n        r: width * FROM_BR[xanchor],\n        b: height * FROM_BR[yanchor],\n        t: height * FROM_TL[yanchor]\n    });\n\n    selector.attr('transform', strTranslate(lx, ly));\n}\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nmodule.exports = function getUpdateObject(axisLayout, buttonLayout) {\n    var axName = axisLayout._name;\n    var update = {};\n\n    if(buttonLayout.step === 'all') {\n        update[axName + '.autorange'] = true;\n    } else {\n        var xrange = getXRange(axisLayout, buttonLayout);\n\n        update[axName + '.range[0]'] = xrange[0];\n        update[axName + '.range[1]'] = xrange[1];\n    }\n\n    return update;\n};\n\nfunction getXRange(axisLayout, buttonLayout) {\n    var currentRange = axisLayout.range;\n    var base = new Date(axisLayout.r2l(currentRange[1]));\n    var step = buttonLayout.step;\n    var count = buttonLayout.count;\n    var range0;\n\n    switch(buttonLayout.stepmode) {\n        case 'backward':\n            range0 = axisLayout.l2r(+d3.time[step].utc.offset(base, -count));\n            break;\n\n        case 'todate':\n            var base2 = d3.time[step].utc.offset(base, -count);\n\n            range0 = axisLayout.l2r(+d3.time[step].utc.ceil(base2));\n            break;\n    }\n\n    var range1 = currentRange[1];\n\n    return [range0, range1];\n}\n","'use strict';\n\nmodule.exports = {\n    moduleType: 'component',\n    name: 'rangeselector',\n\n    schema: {\n        subplots: {\n            xaxis: {rangeselector: require('./attributes')}\n        }\n    },\n\n    layoutAttributes: require('./attributes'),\n    handleDefaults: require('./defaults'),\n\n    draw: require('./draw')\n};\n","'use strict';\n\nvar colorAttributes = require('../color/attributes');\n\nmodule.exports = {\n    bgcolor: {\n        valType: 'color',\n        dflt: colorAttributes.background,\n        editType: 'plot',\n        description: 'Sets the background color of the range slider.'\n    },\n    bordercolor: {\n        valType: 'color',\n        dflt: colorAttributes.defaultLine,\n        editType: 'plot',\n        description: 'Sets the border color of the range slider.'\n    },\n    borderwidth: {\n        valType: 'integer',\n        dflt: 0,\n        min: 0,\n        editType: 'plot',\n        description: 'Sets the border width of the range slider.'\n    },\n    autorange: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'calc',\n        impliedEdits: {'range[0]': undefined, 'range[1]': undefined},\n        description: [\n            'Determines whether or not the range slider range is',\n            'computed in relation to the input data.',\n            'If `range` is provided, then `autorange` is set to *false*.'\n        ].join(' ')\n    },\n    range: {\n        valType: 'info_array',\n        items: [\n            {valType: 'any', editType: 'calc', impliedEdits: {'^autorange': false}},\n            {valType: 'any', editType: 'calc', impliedEdits: {'^autorange': false}}\n        ],\n        editType: 'calc',\n        impliedEdits: {'autorange': false},\n        description: [\n            'Sets the range of the range slider.',\n            'If not set, defaults to the full xaxis range.',\n            'If the axis `type` is *log*, then you must take the',\n            'log of your desired range.',\n            'If the axis `type` is *date*, it should be date strings,',\n            'like date data, though Date objects and unix milliseconds',\n            'will be accepted and converted to strings.',\n            'If the axis `type` is *category*, it should be numbers,',\n            'using the scale where each category is assigned a serial',\n            'number from zero in the order it appears.'\n        ].join(' ')\n    },\n    thickness: {\n        valType: 'number',\n        dflt: 0.15,\n        min: 0,\n        max: 1,\n        editType: 'plot',\n        description: [\n            'The height of the range slider as a fraction of the',\n            'total plot area height.'\n        ].join(' ')\n    },\n    visible: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'calc',\n        description: [\n            'Determines whether or not the range slider will be visible.',\n            'If visible, perpendicular axes will be set to `fixedrange`'\n        ].join(' ')\n    },\n    editType: 'calc'\n};\n","'use strict';\n\nvar listAxes = require('../../plots/cartesian/axis_ids').list;\nvar getAutoRange = require('../../plots/cartesian/autorange').getAutoRange;\nvar constants = require('./constants');\n\nmodule.exports = function calcAutorange(gd) {\n    var axes = listAxes(gd, 'x', true);\n\n    // Compute new slider range using axis autorange if necessary.\n    //\n    // Copy back range to input range slider container to skip\n    // this step in subsequent draw calls.\n\n    for(var i = 0; i < axes.length; i++) {\n        var ax = axes[i];\n        var opts = ax[constants.name];\n\n        if(opts && opts.visible && opts.autorange) {\n            opts._input.autorange = true;\n            opts._input.range = opts.range = getAutoRange(gd, ax);\n        }\n    }\n};\n","'use strict';\n\nmodule.exports = {\n\n    // attribute container name\n    name: 'rangeslider',\n\n    // class names\n\n    containerClassName: 'rangeslider-container',\n    bgClassName: 'rangeslider-bg',\n    rangePlotClassName: 'rangeslider-rangeplot',\n\n    maskMinClassName: 'rangeslider-mask-min',\n    maskMaxClassName: 'rangeslider-mask-max',\n    slideBoxClassName: 'rangeslider-slidebox',\n\n    grabberMinClassName: 'rangeslider-grabber-min',\n    grabAreaMinClassName: 'rangeslider-grabarea-min',\n    handleMinClassName: 'rangeslider-handle-min',\n\n    grabberMaxClassName: 'rangeslider-grabber-max',\n    grabAreaMaxClassName: 'rangeslider-grabarea-max',\n    handleMaxClassName: 'rangeslider-handle-max',\n\n    maskMinOppAxisClassName: 'rangeslider-mask-min-opp-axis',\n    maskMaxOppAxisClassName: 'rangeslider-mask-max-opp-axis',\n\n    // style constants\n\n    maskColor: 'rgba(0,0,0,0.4)',\n    maskOppAxisColor: 'rgba(0,0,0,0.2)',\n\n    slideBoxFill: 'transparent',\n    slideBoxCursor: 'ew-resize',\n\n    grabAreaFill: 'transparent',\n    grabAreaCursor: 'col-resize',\n    grabAreaWidth: 10,\n\n    handleWidth: 4,\n    handleRadius: 1,\n    handleStrokeWidth: 1,\n\n    extraPad: 15\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Template = require('../../plot_api/plot_template');\nvar axisIds = require('../../plots/cartesian/axis_ids');\n\nvar attributes = require('./attributes');\nvar oppAxisAttrs = require('./oppaxis_attributes');\n\nmodule.exports = function handleDefaults(layoutIn, layoutOut, axName) {\n    var axIn = layoutIn[axName];\n    var axOut = layoutOut[axName];\n\n    if(!(axIn.rangeslider || layoutOut._requestRangeslider[axOut._id])) return;\n\n    // not super proud of this (maybe store _ in axis object instead\n    if(!Lib.isPlainObject(axIn.rangeslider)) {\n        axIn.rangeslider = {};\n    }\n\n    var containerIn = axIn.rangeslider;\n    var containerOut = Template.newContainer(axOut, 'rangeslider');\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(containerIn, containerOut, attributes, attr, dflt);\n    }\n\n    var rangeContainerIn, rangeContainerOut;\n    function coerceRange(attr, dflt) {\n        return Lib.coerce(rangeContainerIn, rangeContainerOut, oppAxisAttrs, attr, dflt);\n    }\n\n    var visible = coerce('visible');\n    if(!visible) return;\n\n    coerce('bgcolor', layoutOut.plot_bgcolor);\n    coerce('bordercolor');\n    coerce('borderwidth');\n    coerce('thickness');\n\n    coerce('autorange', !axOut.isValidRange(containerIn.range));\n    coerce('range');\n\n    var subplots = layoutOut._subplots;\n    if(subplots) {\n        var yIds = subplots.cartesian\n            .filter(function(subplotId) {\n                return subplotId.substr(0, subplotId.indexOf('y')) === axisIds.name2id(axName);\n            })\n            .map(function(subplotId) {\n                return subplotId.substr(subplotId.indexOf('y'), subplotId.length);\n            });\n        var yNames = Lib.simpleMap(yIds, axisIds.id2name);\n        for(var i = 0; i < yNames.length; i++) {\n            var yName = yNames[i];\n\n            rangeContainerIn = containerIn[yName] || {};\n            rangeContainerOut = Template.newContainer(containerOut, yName, 'yaxis');\n\n            var yAxOut = layoutOut[yName];\n\n            var rangemodeDflt;\n            if(rangeContainerIn.range && yAxOut.isValidRange(rangeContainerIn.range)) {\n                rangemodeDflt = 'fixed';\n            }\n\n            var rangeMode = coerceRange('rangemode', rangemodeDflt);\n            if(rangeMode !== 'match') {\n                coerceRange('range', yAxOut.range.slice());\n            }\n        }\n    }\n\n    // to map back range slider (auto) range\n    containerOut._input = containerIn;\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Registry = require('../../registry');\nvar Plots = require('../../plots/plots');\n\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar Drawing = require('../drawing');\nvar Color = require('../color');\nvar Titles = require('../titles');\n\nvar Cartesian = require('../../plots/cartesian');\nvar axisIDs = require('../../plots/cartesian/axis_ids');\n\nvar dragElement = require('../dragelement');\nvar setCursor = require('../../lib/setcursor');\n\nvar constants = require('./constants');\n\nmodule.exports = function(gd) {\n    var fullLayout = gd._fullLayout;\n    var rangeSliderData = fullLayout._rangeSliderData;\n    for(var i = 0; i < rangeSliderData.length; i++) {\n        var opts = rangeSliderData[i][constants.name];\n        // fullLayout._uid may not exist when we call makeData\n        opts._clipId = opts._id + '-' + fullLayout._uid;\n    }\n\n    /*\n     * <g container />\n     *  <rect bg />\n     *  < .... range plot />\n     *  <rect mask-min />\n     *  <rect mask-max />\n     *  <rect slidebox />\n     *  <g grabber-min />\n     *      <rect handle-min />\n     *      <rect grabare-min />\n     *  <g grabber-max />\n     *      <rect handle-max />\n     *      <rect grabare-max />\n     *\n     *  ...\n     */\n\n    function keyFunction(axisOpts) {\n        return axisOpts._name;\n    }\n\n    var rangeSliders = fullLayout._infolayer\n        .selectAll('g.' + constants.containerClassName)\n        .data(rangeSliderData, keyFunction);\n\n    // remove exiting sliders and their corresponding clip paths\n    rangeSliders.exit().each(function(axisOpts) {\n        var opts = axisOpts[constants.name];\n        fullLayout._topdefs.select('#' + opts._clipId).remove();\n    }).remove();\n\n    // return early if no range slider is visible\n    if(rangeSliderData.length === 0) return;\n\n    rangeSliders.enter().append('g')\n        .classed(constants.containerClassName, true)\n        .attr('pointer-events', 'all');\n\n    // for all present range sliders\n    rangeSliders.each(function(axisOpts) {\n        var rangeSlider = d3.select(this);\n        var opts = axisOpts[constants.name];\n        var oppAxisOpts = fullLayout[axisIDs.id2name(axisOpts.anchor)];\n        var oppAxisRangeOpts = opts[axisIDs.id2name(axisOpts.anchor)];\n\n        // update range\n        // Expand slider range to the axis range\n        if(opts.range) {\n            var rng = Lib.simpleMap(opts.range, axisOpts.r2l);\n            var axRng = Lib.simpleMap(axisOpts.range, axisOpts.r2l);\n            var newRng;\n\n            if(axRng[0] < axRng[1]) {\n                newRng = [\n                    Math.min(rng[0], axRng[0]),\n                    Math.max(rng[1], axRng[1])\n                ];\n            } else {\n                newRng = [\n                    Math.max(rng[0], axRng[0]),\n                    Math.min(rng[1], axRng[1])\n                ];\n            }\n\n            opts.range = opts._input.range = Lib.simpleMap(newRng, axisOpts.l2r);\n        }\n\n        axisOpts.cleanRange('rangeslider.range');\n\n        // update range slider dimensions\n\n        var gs = fullLayout._size;\n        var domain = axisOpts.domain;\n\n        opts._width = gs.w * (domain[1] - domain[0]);\n\n        var x = Math.round(gs.l + (gs.w * domain[0]));\n\n        var y = Math.round(\n            gs.t + gs.h * (1 - axisOpts._counterDomainMin) +\n            (axisOpts.side === 'bottom' ? axisOpts._depth : 0) +\n            opts._offsetShift + constants.extraPad\n        );\n\n        rangeSlider.attr('transform', strTranslate(x, y));\n\n        // update data <--> pixel coordinate conversion methods\n\n        opts._rl = Lib.simpleMap(opts.range, axisOpts.r2l);\n        var rl0 = opts._rl[0];\n        var rl1 = opts._rl[1];\n        var drl = rl1 - rl0;\n\n        opts.p2d = function(v) {\n            return (v / opts._width) * drl + rl0;\n        };\n\n        opts.d2p = function(v) {\n            return (v - rl0) / drl * opts._width;\n        };\n\n        if(axisOpts.rangebreaks) {\n            var rsBreaks = axisOpts.locateBreaks(rl0, rl1);\n\n            if(rsBreaks.length) {\n                var j, brk;\n\n                var lBreaks = 0;\n                for(j = 0; j < rsBreaks.length; j++) {\n                    brk = rsBreaks[j];\n                    lBreaks += (brk.max - brk.min);\n                }\n\n                // TODO fix for reversed-range axes !!!\n\n                // compute slope and piecewise offsets\n                var m2 = opts._width / (rl1 - rl0 - lBreaks);\n                var _B = [-m2 * rl0];\n                for(j = 0; j < rsBreaks.length; j++) {\n                    brk = rsBreaks[j];\n                    _B.push(_B[_B.length - 1] - m2 * (brk.max - brk.min));\n                }\n\n                opts.d2p = function(v) {\n                    var b = _B[0];\n                    for(var j = 0; j < rsBreaks.length; j++) {\n                        var brk = rsBreaks[j];\n                        if(v >= brk.max) b = _B[j + 1];\n                        else if(v < brk.min) break;\n                    }\n                    return b + m2 * v;\n                };\n\n                // fill pixel (i.e. 'p') min/max here,\n                // to not have to loop through the _rangebreaks twice during `p2d`\n                for(j = 0; j < rsBreaks.length; j++) {\n                    brk = rsBreaks[j];\n                    brk.pmin = opts.d2p(brk.min);\n                    brk.pmax = opts.d2p(brk.max);\n                }\n\n                opts.p2d = function(v) {\n                    var b = _B[0];\n                    for(var j = 0; j < rsBreaks.length; j++) {\n                        var brk = rsBreaks[j];\n                        if(v >= brk.pmax) b = _B[j + 1];\n                        else if(v < brk.pmin) break;\n                    }\n                    return (v - b) / m2;\n                };\n            }\n        }\n\n        if(oppAxisRangeOpts.rangemode !== 'match') {\n            var range0OppAxis = oppAxisOpts.r2l(oppAxisRangeOpts.range[0]);\n            var range1OppAxis = oppAxisOpts.r2l(oppAxisRangeOpts.range[1]);\n            var distOppAxis = range1OppAxis - range0OppAxis;\n\n            opts.d2pOppAxis = function(v) {\n                return (v - range0OppAxis) / distOppAxis * opts._height;\n            };\n        }\n\n        // update inner nodes\n\n        rangeSlider\n            .call(drawBg, gd, axisOpts, opts)\n            .call(addClipPath, gd, axisOpts, opts)\n            .call(drawRangePlot, gd, axisOpts, opts)\n            .call(drawMasks, gd, axisOpts, opts, oppAxisRangeOpts)\n            .call(drawSlideBox, gd, axisOpts, opts)\n            .call(drawGrabbers, gd, axisOpts, opts);\n\n        // setup drag element\n        setupDragElement(rangeSlider, gd, axisOpts, opts);\n\n        // update current range\n        setPixelRange(rangeSlider, gd, axisOpts, opts, oppAxisOpts, oppAxisRangeOpts);\n\n        // title goes next to range slider instead of tick labels, so\n        // just take it over and draw it from here\n        if(axisOpts.side === 'bottom') {\n            Titles.draw(gd, axisOpts._id + 'title', {\n                propContainer: axisOpts,\n                propName: axisOpts._name + '.title',\n                placeholder: fullLayout._dfltTitle.x,\n                attributes: {\n                    x: axisOpts._offset + axisOpts._length / 2,\n                    y: y + opts._height + opts._offsetShift + 10 + 1.5 * axisOpts.title.font.size,\n                    'text-anchor': 'middle'\n                }\n            });\n        }\n    });\n};\n\nfunction setupDragElement(rangeSlider, gd, axisOpts, opts) {\n    if(gd._context.staticPlot) return;\n\n    var slideBox = rangeSlider.select('rect.' + constants.slideBoxClassName).node();\n    var grabAreaMin = rangeSlider.select('rect.' + constants.grabAreaMinClassName).node();\n    var grabAreaMax = rangeSlider.select('rect.' + constants.grabAreaMaxClassName).node();\n\n    function mouseDownHandler() {\n        var event = d3.event;\n        var target = event.target;\n        var startX = event.clientX || event.touches[0].clientX;\n        var offsetX = startX - rangeSlider.node().getBoundingClientRect().left;\n        var minVal = opts.d2p(axisOpts._rl[0]);\n        var maxVal = opts.d2p(axisOpts._rl[1]);\n\n        var dragCover = dragElement.coverSlip();\n\n        this.addEventListener('touchmove', mouseMove);\n        this.addEventListener('touchend', mouseUp);\n        dragCover.addEventListener('mousemove', mouseMove);\n        dragCover.addEventListener('mouseup', mouseUp);\n\n        function mouseMove(e) {\n            var clientX = e.clientX || e.touches[0].clientX;\n            var delta = +clientX - startX;\n            var pixelMin, pixelMax, cursor;\n\n            switch(target) {\n                case slideBox:\n                    cursor = 'ew-resize';\n                    pixelMin = minVal + delta;\n                    pixelMax = maxVal + delta;\n                    break;\n\n                case grabAreaMin:\n                    cursor = 'col-resize';\n                    pixelMin = minVal + delta;\n                    pixelMax = maxVal;\n                    break;\n\n                case grabAreaMax:\n                    cursor = 'col-resize';\n                    pixelMin = minVal;\n                    pixelMax = maxVal + delta;\n                    break;\n\n                default:\n                    cursor = 'ew-resize';\n                    pixelMin = offsetX;\n                    pixelMax = offsetX + delta;\n                    break;\n            }\n\n            if(pixelMax < pixelMin) {\n                var tmp = pixelMax;\n                pixelMax = pixelMin;\n                pixelMin = tmp;\n            }\n\n            opts._pixelMin = pixelMin;\n            opts._pixelMax = pixelMax;\n\n            setCursor(d3.select(dragCover), cursor);\n            setDataRange(rangeSlider, gd, axisOpts, opts);\n        }\n\n        function mouseUp() {\n            dragCover.removeEventListener('mousemove', mouseMove);\n            dragCover.removeEventListener('mouseup', mouseUp);\n            this.removeEventListener('touchmove', mouseMove);\n            this.removeEventListener('touchend', mouseUp);\n            Lib.removeElement(dragCover);\n        }\n    }\n\n    rangeSlider.on('mousedown', mouseDownHandler);\n    rangeSlider.on('touchstart', mouseDownHandler);\n}\n\nfunction setDataRange(rangeSlider, gd, axisOpts, opts) {\n    function clamp(v) {\n        return axisOpts.l2r(Lib.constrain(v, opts._rl[0], opts._rl[1]));\n    }\n\n    var dataMin = clamp(opts.p2d(opts._pixelMin));\n    var dataMax = clamp(opts.p2d(opts._pixelMax));\n\n    window.requestAnimationFrame(function() {\n        Registry.call('_guiRelayout', gd, axisOpts._name + '.range', [dataMin, dataMax]);\n    });\n}\n\nfunction setPixelRange(rangeSlider, gd, axisOpts, opts, oppAxisOpts, oppAxisRangeOpts) {\n    var hw2 = constants.handleWidth / 2;\n\n    function clamp(v) {\n        return Lib.constrain(v, 0, opts._width);\n    }\n\n    function clampOppAxis(v) {\n        return Lib.constrain(v, 0, opts._height);\n    }\n\n    function clampHandle(v) {\n        return Lib.constrain(v, -hw2, opts._width + hw2);\n    }\n\n    var pixelMin = clamp(opts.d2p(axisOpts._rl[0]));\n    var pixelMax = clamp(opts.d2p(axisOpts._rl[1]));\n\n    rangeSlider.select('rect.' + constants.slideBoxClassName)\n        .attr('x', pixelMin)\n        .attr('width', pixelMax - pixelMin);\n\n    rangeSlider.select('rect.' + constants.maskMinClassName)\n        .attr('width', pixelMin);\n\n    rangeSlider.select('rect.' + constants.maskMaxClassName)\n        .attr('x', pixelMax)\n        .attr('width', opts._width - pixelMax);\n\n    if(oppAxisRangeOpts.rangemode !== 'match') {\n        var pixelMinOppAxis = opts._height - clampOppAxis(opts.d2pOppAxis(oppAxisOpts._rl[1]));\n        var pixelMaxOppAxis = opts._height - clampOppAxis(opts.d2pOppAxis(oppAxisOpts._rl[0]));\n\n        rangeSlider.select('rect.' + constants.maskMinOppAxisClassName)\n            .attr('x', pixelMin)\n            .attr('height', pixelMinOppAxis)\n            .attr('width', pixelMax - pixelMin);\n\n        rangeSlider.select('rect.' + constants.maskMaxOppAxisClassName)\n            .attr('x', pixelMin)\n            .attr('y', pixelMaxOppAxis)\n            .attr('height', opts._height - pixelMaxOppAxis)\n            .attr('width', pixelMax - pixelMin);\n\n        rangeSlider.select('rect.' + constants.slideBoxClassName)\n            .attr('y', pixelMinOppAxis)\n            .attr('height', pixelMaxOppAxis - pixelMinOppAxis);\n    }\n\n    // add offset for crispier corners\n    // https://github.com/plotly/plotly.js/pull/1409\n    var offset = 0.5;\n\n    var xMin = Math.round(clampHandle(pixelMin - hw2)) - offset;\n    var xMax = Math.round(clampHandle(pixelMax - hw2)) + offset;\n\n    rangeSlider.select('g.' + constants.grabberMinClassName)\n        .attr('transform', strTranslate(xMin, offset));\n\n    rangeSlider.select('g.' + constants.grabberMaxClassName)\n        .attr('transform', strTranslate(xMax, offset));\n}\n\nfunction drawBg(rangeSlider, gd, axisOpts, opts) {\n    var bg = Lib.ensureSingle(rangeSlider, 'rect', constants.bgClassName, function(s) {\n        s.attr({\n            x: 0,\n            y: 0,\n            'shape-rendering': 'crispEdges'\n        });\n    });\n\n    var borderCorrect = (opts.borderwidth % 2) === 0 ?\n        opts.borderwidth :\n        opts.borderwidth - 1;\n\n    var offsetShift = -opts._offsetShift;\n    var lw = Drawing.crispRound(gd, opts.borderwidth);\n\n    bg.attr({\n        width: opts._width + borderCorrect,\n        height: opts._height + borderCorrect,\n        transform: strTranslate(offsetShift, offsetShift),\n        fill: opts.bgcolor,\n        stroke: opts.bordercolor,\n        'stroke-width': lw\n    });\n}\n\nfunction addClipPath(rangeSlider, gd, axisOpts, opts) {\n    var fullLayout = gd._fullLayout;\n\n    var clipPath = Lib.ensureSingleById(fullLayout._topdefs, 'clipPath', opts._clipId, function(s) {\n        s.append('rect').attr({ x: 0, y: 0 });\n    });\n\n    clipPath.select('rect').attr({\n        width: opts._width,\n        height: opts._height\n    });\n}\n\nfunction drawRangePlot(rangeSlider, gd, axisOpts, opts) {\n    var calcData = gd.calcdata;\n\n    var rangePlots = rangeSlider.selectAll('g.' + constants.rangePlotClassName)\n        .data(axisOpts._subplotsWith, Lib.identity);\n\n    rangePlots.enter().append('g')\n        .attr('class', function(id) { return constants.rangePlotClassName + ' ' + id; })\n        .call(Drawing.setClipUrl, opts._clipId, gd);\n\n    rangePlots.order();\n\n    rangePlots.exit().remove();\n\n    var mainplotinfo;\n\n    rangePlots.each(function(id, i) {\n        var plotgroup = d3.select(this);\n        var isMainPlot = (i === 0);\n\n        var oppAxisOpts = axisIDs.getFromId(gd, id, 'y');\n        var oppAxisName = oppAxisOpts._name;\n        var oppAxisRangeOpts = opts[oppAxisName];\n\n        var mockFigure = {\n            data: [],\n            layout: {\n                xaxis: {\n                    type: axisOpts.type,\n                    domain: [0, 1],\n                    range: opts.range.slice(),\n                    calendar: axisOpts.calendar\n                },\n                width: opts._width,\n                height: opts._height,\n                margin: { t: 0, b: 0, l: 0, r: 0 }\n            },\n            _context: gd._context\n        };\n\n        if(axisOpts.rangebreaks) {\n            mockFigure.layout.xaxis.rangebreaks = axisOpts.rangebreaks;\n        }\n\n        mockFigure.layout[oppAxisName] = {\n            type: oppAxisOpts.type,\n            domain: [0, 1],\n            range: oppAxisRangeOpts.rangemode !== 'match' ? oppAxisRangeOpts.range.slice() : oppAxisOpts.range.slice(),\n            calendar: oppAxisOpts.calendar\n        };\n\n        if(oppAxisOpts.rangebreaks) {\n            mockFigure.layout[oppAxisName].rangebreaks = oppAxisOpts.rangebreaks;\n        }\n\n        Plots.supplyDefaults(mockFigure);\n\n        var xa = mockFigure._fullLayout.xaxis;\n        var ya = mockFigure._fullLayout[oppAxisName];\n\n        xa.clearCalc();\n        xa.setScale();\n        ya.clearCalc();\n        ya.setScale();\n\n        var plotinfo = {\n            id: id,\n            plotgroup: plotgroup,\n            xaxis: xa,\n            yaxis: ya,\n            isRangePlot: true\n        };\n\n        if(isMainPlot) mainplotinfo = plotinfo;\n        else {\n            plotinfo.mainplot = 'xy';\n            plotinfo.mainplotinfo = mainplotinfo;\n        }\n\n        Cartesian.rangePlot(gd, plotinfo, filterRangePlotCalcData(calcData, id));\n    });\n}\n\nfunction filterRangePlotCalcData(calcData, subplotId) {\n    var out = [];\n\n    for(var i = 0; i < calcData.length; i++) {\n        var calcTrace = calcData[i];\n        var trace = calcTrace[0].trace;\n\n        if(trace.xaxis + trace.yaxis === subplotId) {\n            out.push(calcTrace);\n        }\n    }\n\n    return out;\n}\n\nfunction drawMasks(rangeSlider, gd, axisOpts, opts, oppAxisRangeOpts) {\n    var maskMin = Lib.ensureSingle(rangeSlider, 'rect', constants.maskMinClassName, function(s) {\n        s.attr({\n            x: 0,\n            y: 0,\n            'shape-rendering': 'crispEdges'\n        });\n    });\n\n    maskMin\n        .attr('height', opts._height)\n        .call(Color.fill, constants.maskColor);\n\n    var maskMax = Lib.ensureSingle(rangeSlider, 'rect', constants.maskMaxClassName, function(s) {\n        s.attr({\n            y: 0,\n            'shape-rendering': 'crispEdges'\n        });\n    });\n\n    maskMax\n        .attr('height', opts._height)\n        .call(Color.fill, constants.maskColor);\n\n    // masks used for oppAxis zoom\n    if(oppAxisRangeOpts.rangemode !== 'match') {\n        var maskMinOppAxis = Lib.ensureSingle(rangeSlider, 'rect', constants.maskMinOppAxisClassName, function(s) {\n            s.attr({\n                y: 0,\n                'shape-rendering': 'crispEdges'\n            });\n        });\n\n        maskMinOppAxis\n            .attr('width', opts._width)\n            .call(Color.fill, constants.maskOppAxisColor);\n\n        var maskMaxOppAxis = Lib.ensureSingle(rangeSlider, 'rect', constants.maskMaxOppAxisClassName, function(s) {\n            s.attr({\n                y: 0,\n                'shape-rendering': 'crispEdges'\n            });\n        });\n\n        maskMaxOppAxis\n            .attr('width', opts._width)\n            .style('border-top', constants.maskOppBorder)\n            .call(Color.fill, constants.maskOppAxisColor);\n    }\n}\n\nfunction drawSlideBox(rangeSlider, gd, axisOpts, opts) {\n    if(gd._context.staticPlot) return;\n\n    var slideBox = Lib.ensureSingle(rangeSlider, 'rect', constants.slideBoxClassName, function(s) {\n        s.attr({\n            y: 0,\n            cursor: constants.slideBoxCursor,\n            'shape-rendering': 'crispEdges'\n        });\n    });\n\n    slideBox.attr({\n        height: opts._height,\n        fill: constants.slideBoxFill\n    });\n}\n\nfunction drawGrabbers(rangeSlider, gd, axisOpts, opts) {\n    // <g grabber />\n    var grabberMin = Lib.ensureSingle(rangeSlider, 'g', constants.grabberMinClassName);\n    var grabberMax = Lib.ensureSingle(rangeSlider, 'g', constants.grabberMaxClassName);\n\n    // <g handle />\n    var handleFixAttrs = {\n        x: 0,\n        width: constants.handleWidth,\n        rx: constants.handleRadius,\n        fill: Color.background,\n        stroke: Color.defaultLine,\n        'stroke-width': constants.handleStrokeWidth,\n        'shape-rendering': 'crispEdges'\n    };\n    var handleDynamicAttrs = {\n        y: Math.round(opts._height / 4),\n        height: Math.round(opts._height / 2),\n    };\n    var handleMin = Lib.ensureSingle(grabberMin, 'rect', constants.handleMinClassName, function(s) {\n        s.attr(handleFixAttrs);\n    });\n    handleMin.attr(handleDynamicAttrs);\n\n    var handleMax = Lib.ensureSingle(grabberMax, 'rect', constants.handleMaxClassName, function(s) {\n        s.attr(handleFixAttrs);\n    });\n    handleMax.attr(handleDynamicAttrs);\n\n    // <g grabarea />\n    var grabAreaFixAttrs = {\n        width: constants.grabAreaWidth,\n        x: 0,\n        y: 0,\n        fill: constants.grabAreaFill,\n        cursor: !gd._context.staticPlot ? constants.grabAreaCursor : undefined,\n    };\n\n    var grabAreaMin = Lib.ensureSingle(grabberMin, 'rect', constants.grabAreaMinClassName, function(s) {\n        s.attr(grabAreaFixAttrs);\n    });\n    grabAreaMin.attr('height', opts._height);\n\n    var grabAreaMax = Lib.ensureSingle(grabberMax, 'rect', constants.grabAreaMaxClassName, function(s) {\n        s.attr(grabAreaFixAttrs);\n    });\n    grabAreaMax.attr('height', opts._height);\n}\n","'use strict';\n\nvar axisIDs = require('../../plots/cartesian/axis_ids');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar constants = require('./constants');\nvar LINE_SPACING = require('../../constants/alignment').LINE_SPACING;\nvar name = constants.name;\n\nfunction isVisible(ax) {\n    var rangeSlider = ax && ax[name];\n    return rangeSlider && rangeSlider.visible;\n}\nexports.isVisible = isVisible;\n\nexports.makeData = function(fullLayout) {\n    var axes = axisIDs.list({ _fullLayout: fullLayout }, 'x', true);\n    var margin = fullLayout.margin;\n    var rangeSliderData = [];\n\n    if(!fullLayout._has('gl2d')) {\n        for(var i = 0; i < axes.length; i++) {\n            var ax = axes[i];\n\n            if(isVisible(ax)) {\n                rangeSliderData.push(ax);\n\n                var opts = ax[name];\n                opts._id = name + ax._id;\n                opts._height = (fullLayout.height - margin.b - margin.t) * opts.thickness;\n                opts._offsetShift = Math.floor(opts.borderwidth / 2);\n            }\n        }\n    }\n\n    fullLayout._rangeSliderData = rangeSliderData;\n};\n\nexports.autoMarginOpts = function(gd, ax) {\n    var fullLayout = gd._fullLayout;\n    var opts = ax[name];\n    var axLetter = ax._id.charAt(0);\n\n    var bottomDepth = 0;\n    var titleHeight = 0;\n    if(ax.side === 'bottom') {\n        bottomDepth = ax._depth;\n        if(ax.title.text !== fullLayout._dfltTitle[axLetter]) {\n            // as in rangeslider/draw.js\n            titleHeight = 1.5 * ax.title.font.size + 10 + opts._offsetShift;\n            // multi-line extra bump\n            var extraLines = (ax.title.text.match(svgTextUtils.BR_TAG_ALL) || []).length;\n            titleHeight += extraLines * ax.title.font.size * LINE_SPACING;\n        }\n    }\n\n    return {\n        x: 0,\n        y: ax._counterDomainMin,\n        l: 0,\n        r: 0,\n        t: 0,\n        b: opts._height + bottomDepth + Math.max(fullLayout.margin.b, titleHeight),\n        pad: constants.extraPad + opts._offsetShift * 2\n    };\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar attrs = require('./attributes');\nvar oppAxisAttrs = require('./oppaxis_attributes');\nvar helpers = require('./helpers');\n\nmodule.exports = {\n    moduleType: 'component',\n    name: 'rangeslider',\n\n    schema: {\n        subplots: {\n            xaxis: {\n                rangeslider: Lib.extendFlat({}, attrs, {\n                    yaxis: oppAxisAttrs\n                })\n            }\n        }\n    },\n\n    layoutAttributes: require('./attributes'),\n    handleDefaults: require('./defaults'),\n    calcAutorange: require('./calc_autorange'),\n    draw: require('./draw'),\n    isVisible: helpers.isVisible,\n    makeData: helpers.makeData,\n    autoMarginOpts: helpers.autoMarginOpts\n};\n","'use strict';\n\nmodule.exports = {\n    // not really a 'subplot' attribute container,\n    // but this is the flag we use to denote attributes that\n    // support yaxis, yaxis2, yaxis3, ... counters\n    _isSubplotObj: true,\n\n    rangemode: {\n        valType: 'enumerated',\n        values: ['auto', 'fixed', 'match'],\n        dflt: 'match',\n        editType: 'calc',\n        description: [\n            'Determines whether or not the range of this axis in',\n            'the rangeslider use the same value than in the main plot',\n            'when zooming in/out.',\n            'If *auto*, the autorange will be used.',\n            'If *fixed*, the `range` is used.',\n            'If *match*, the current range of the corresponding y-axis on the main subplot is used.'\n        ].join(' ')\n    },\n    range: {\n        valType: 'info_array',\n        items: [\n            {valType: 'any', editType: 'plot'},\n            {valType: 'any', editType: 'plot'}\n        ],\n        editType: 'plot',\n        description: [\n            'Sets the range of this axis for the rangeslider.'\n        ].join(' ')\n    },\n    editType: 'calc'\n};\n","'use strict';\n\nvar annAttrs = require('../annotations/attributes');\nvar scatterLineAttrs = require('../../traces/scatter/attributes').line;\nvar dash = require('../drawing/attributes').dash;\nvar extendFlat = require('../../lib/extend').extendFlat;\nvar templatedArray = require('../../plot_api/plot_template').templatedArray;\nvar axisPlaceableObjs = require('../../constants/axis_placeable_objects');\n\nmodule.exports = templatedArray('shape', {\n    visible: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'calc+arraydraw',\n        description: [\n            'Determines whether or not this shape is visible.'\n        ].join(' ')\n    },\n\n    type: {\n        valType: 'enumerated',\n        values: ['circle', 'rect', 'path', 'line'],\n        editType: 'calc+arraydraw',\n        description: [\n            'Specifies the shape type to be drawn.',\n\n            'If *line*, a line is drawn from (`x0`,`y0`) to (`x1`,`y1`)',\n            'with respect to the axes\\' sizing mode.',\n\n            'If *circle*, a circle is drawn from',\n            '((`x0`+`x1`)/2, (`y0`+`y1`)/2))',\n            'with radius',\n            '(|(`x0`+`x1`)/2 - `x0`|, |(`y0`+`y1`)/2 -`y0`)|)',\n            'with respect to the axes\\' sizing mode.',\n\n            'If *rect*, a rectangle is drawn linking',\n            '(`x0`,`y0`), (`x1`,`y0`), (`x1`,`y1`), (`x0`,`y1`), (`x0`,`y0`)',\n            'with respect to the axes\\' sizing mode.',\n\n            'If *path*, draw a custom SVG path using `path`.',\n            'with respect to the axes\\' sizing mode.'\n        ].join(' ')\n    },\n\n    layer: {\n        valType: 'enumerated',\n        values: ['below', 'above'],\n        dflt: 'above',\n        editType: 'arraydraw',\n        description: 'Specifies whether shapes are drawn below or above traces.'\n    },\n\n    xref: extendFlat({}, annAttrs.xref, {\n        description: [\n            'Sets the shape\\'s x coordinate axis.',\n            axisPlaceableObjs.axisRefDescription('x', 'left', 'right'),\n            'If the axis `type` is *log*, then you must take the',\n            'log of your desired range.',\n            'If the axis `type` is *date*, then you must convert',\n            'the date to unix time in milliseconds.'\n        ].join(' ')\n    }),\n    xsizemode: {\n        valType: 'enumerated',\n        values: ['scaled', 'pixel'],\n        dflt: 'scaled',\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets the shapes\\'s sizing mode along the x axis.',\n            'If set to *scaled*, `x0`, `x1` and x coordinates within `path` refer to',\n            'data values on the x axis or a fraction of the plot area\\'s width',\n            '(`xref` set to *paper*).',\n            'If set to *pixel*, `xanchor` specifies the x position in terms',\n            'of data or plot fraction but `x0`, `x1` and x coordinates within `path`',\n            'are pixels relative to `xanchor`. This way, the shape can have',\n            'a fixed width while maintaining a position relative to data or',\n            'plot fraction.'\n        ].join(' ')\n    },\n    xanchor: {\n        valType: 'any',\n        editType: 'calc+arraydraw',\n        description: [\n            'Only relevant in conjunction with `xsizemode` set to *pixel*.',\n            'Specifies the anchor point on the x axis to which `x0`, `x1`',\n            'and x coordinates within `path` are relative to.',\n            'E.g. useful to attach a pixel sized shape to a certain data value.',\n            'No effect when `xsizemode` not set to *pixel*.'\n        ].join(' ')\n    },\n    x0: {\n        valType: 'any',\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets the shape\\'s starting x position.',\n            'See `type` and `xsizemode` for more info.'\n        ].join(' ')\n    },\n    x1: {\n        valType: 'any',\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets the shape\\'s end x position.',\n            'See `type` and `xsizemode` for more info.'\n        ].join(' ')\n    },\n\n    yref: extendFlat({}, annAttrs.yref, {\n        description: [\n            'Sets the annotation\\'s y coordinate axis.',\n            axisPlaceableObjs.axisRefDescription('y', 'bottom', 'top'),\n        ].join(' ')\n    }),\n    ysizemode: {\n        valType: 'enumerated',\n        values: ['scaled', 'pixel'],\n        dflt: 'scaled',\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets the shapes\\'s sizing mode along the y axis.',\n            'If set to *scaled*, `y0`, `y1` and y coordinates within `path` refer to',\n            'data values on the y axis or a fraction of the plot area\\'s height',\n            '(`yref` set to *paper*).',\n            'If set to *pixel*, `yanchor` specifies the y position in terms',\n            'of data or plot fraction but `y0`, `y1` and y coordinates within `path`',\n            'are pixels relative to `yanchor`. This way, the shape can have',\n            'a fixed height while maintaining a position relative to data or',\n            'plot fraction.'\n        ].join(' ')\n    },\n    yanchor: {\n        valType: 'any',\n        editType: 'calc+arraydraw',\n        description: [\n            'Only relevant in conjunction with `ysizemode` set to *pixel*.',\n            'Specifies the anchor point on the y axis to which `y0`, `y1`',\n            'and y coordinates within `path` are relative to.',\n            'E.g. useful to attach a pixel sized shape to a certain data value.',\n            'No effect when `ysizemode` not set to *pixel*.'\n        ].join(' ')\n    },\n    y0: {\n        valType: 'any',\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets the shape\\'s starting y position.',\n            'See `type` and `ysizemode` for more info.'\n        ].join(' ')\n    },\n    y1: {\n        valType: 'any',\n        editType: 'calc+arraydraw',\n        description: [\n            'Sets the shape\\'s end y position.',\n            'See `type` and `ysizemode` for more info.'\n        ].join(' ')\n    },\n\n    path: {\n        valType: 'string',\n        editType: 'calc+arraydraw',\n        description: [\n            'For `type` *path* - a valid SVG path with the pixel values',\n            'replaced by data values in `xsizemode`/`ysizemode` being *scaled*',\n            'and taken unmodified as pixels relative to `xanchor` and `yanchor`',\n            'in case of *pixel* size mode.',\n            'There are a few restrictions / quirks',\n            'only absolute instructions, not relative. So the allowed segments',\n            'are: M, L, H, V, Q, C, T, S, and Z',\n            'arcs (A) are not allowed because radius rx and ry are relative.',\n\n            'In the future we could consider supporting relative commands,',\n            'but we would have to decide on how to handle date and log axes.',\n            'Note that even as is, Q and C Bezier paths that are smooth on',\n            'linear axes may not be smooth on log, and vice versa.',\n            'no chained \"polybezier\" commands - specify the segment type for',\n            'each one.',\n\n            'On category axes, values are numbers scaled to the serial numbers',\n            'of categories because using the categories themselves there would',\n            'be no way to describe fractional positions',\n            'On data axes: because space and T are both normal components of path',\n            'strings, we can\\'t use either to separate date from time parts.',\n            'Therefore we\\'ll use underscore for this purpose:',\n            '2015-02-21_13:45:56.789'\n        ].join(' ')\n    },\n\n    opacity: {\n        valType: 'number',\n        min: 0,\n        max: 1,\n        dflt: 1,\n        editType: 'arraydraw',\n        description: 'Sets the opacity of the shape.'\n    },\n    line: {\n        color: extendFlat({}, scatterLineAttrs.color, {editType: 'arraydraw'}),\n        width: extendFlat({}, scatterLineAttrs.width, {editType: 'calc+arraydraw'}),\n        dash: extendFlat({}, dash, {editType: 'arraydraw'}),\n        editType: 'calc+arraydraw'\n    },\n    fillcolor: {\n        valType: 'color',\n        dflt: 'rgba(0,0,0,0)',\n        editType: 'arraydraw',\n        description: [\n            'Sets the color filling the shape\\'s interior. Only applies to closed shapes.'\n        ].join(' ')\n    },\n    fillrule: {\n        valType: 'enumerated',\n        values: ['evenodd', 'nonzero'],\n        dflt: 'evenodd',\n        editType: 'arraydraw',\n        description: [\n            'Determines which regions of complex paths constitute the interior.',\n            'For more info please visit https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/fill-rule'\n        ].join(' ')\n    },\n    editable: {\n        valType: 'boolean',\n        dflt: false,\n        editType: 'calc+arraydraw',\n        description: [\n            'Determines whether the shape could be activated for edit or not.',\n            'Has no effect when the older editable shapes mode is enabled via',\n            '`config.editable` or `config.edits.shapePosition`.'\n        ].join(' ')\n    },\n\n    editType: 'arraydraw'\n});\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Axes = require('../../plots/cartesian/axes');\n\nvar constants = require('./constants');\nvar helpers = require('./helpers');\n\n\nmodule.exports = function calcAutorange(gd) {\n    var fullLayout = gd._fullLayout;\n    var shapeList = Lib.filterVisible(fullLayout.shapes);\n\n    if(!shapeList.length || !gd._fullData.length) return;\n\n    for(var i = 0; i < shapeList.length; i++) {\n        var shape = shapeList[i];\n        shape._extremes = {};\n\n        var ax; var bounds;\n        var xRefType = Axes.getRefType(shape.xref);\n        var yRefType = Axes.getRefType(shape.yref);\n\n        // paper and axis domain referenced shapes don't affect autorange\n        if(shape.xref !== 'paper' && xRefType !== 'domain') {\n            var vx0 = shape.xsizemode === 'pixel' ? shape.xanchor : shape.x0;\n            var vx1 = shape.xsizemode === 'pixel' ? shape.xanchor : shape.x1;\n            ax = Axes.getFromId(gd, shape.xref);\n\n            bounds = shapeBounds(ax, vx0, vx1, shape.path, constants.paramIsX);\n            if(bounds) {\n                shape._extremes[ax._id] = Axes.findExtremes(ax, bounds, calcXPaddingOptions(shape));\n            }\n        }\n\n        if(shape.yref !== 'paper' && yRefType !== 'domain') {\n            var vy0 = shape.ysizemode === 'pixel' ? shape.yanchor : shape.y0;\n            var vy1 = shape.ysizemode === 'pixel' ? shape.yanchor : shape.y1;\n            ax = Axes.getFromId(gd, shape.yref);\n\n            bounds = shapeBounds(ax, vy0, vy1, shape.path, constants.paramIsY);\n            if(bounds) {\n                shape._extremes[ax._id] = Axes.findExtremes(ax, bounds, calcYPaddingOptions(shape));\n            }\n        }\n    }\n};\n\nfunction calcXPaddingOptions(shape) {\n    return calcPaddingOptions(shape.line.width, shape.xsizemode, shape.x0, shape.x1, shape.path, false);\n}\n\nfunction calcYPaddingOptions(shape) {\n    return calcPaddingOptions(shape.line.width, shape.ysizemode, shape.y0, shape.y1, shape.path, true);\n}\n\nfunction calcPaddingOptions(lineWidth, sizeMode, v0, v1, path, isYAxis) {\n    var ppad = lineWidth / 2;\n    var axisDirectionReverted = isYAxis;\n\n    if(sizeMode === 'pixel') {\n        var coords = path ?\n            helpers.extractPathCoords(path, isYAxis ? constants.paramIsY : constants.paramIsX) :\n            [v0, v1];\n        var maxValue = Lib.aggNums(Math.max, null, coords);\n        var minValue = Lib.aggNums(Math.min, null, coords);\n        var beforePad = minValue < 0 ? Math.abs(minValue) + ppad : ppad;\n        var afterPad = maxValue > 0 ? maxValue + ppad : ppad;\n\n        return {\n            ppad: ppad,\n            ppadplus: axisDirectionReverted ? beforePad : afterPad,\n            ppadminus: axisDirectionReverted ? afterPad : beforePad\n        };\n    } else {\n        return {ppad: ppad};\n    }\n}\n\nfunction shapeBounds(ax, v0, v1, path, paramsToUse) {\n    var convertVal = (ax.type === 'category' || ax.type === 'multicategory') ? ax.r2c : ax.d2c;\n\n    if(v0 !== undefined) return [convertVal(v0), convertVal(v1)];\n    if(!path) return;\n\n    var min = Infinity;\n    var max = -Infinity;\n    var segments = path.match(constants.segmentRE);\n    var i;\n    var segment;\n    var drawnParam;\n    var params;\n    var val;\n\n    if(ax.type === 'date') convertVal = helpers.decodeDate(convertVal);\n\n    for(i = 0; i < segments.length; i++) {\n        segment = segments[i];\n        drawnParam = paramsToUse[segment.charAt(0)].drawn;\n        if(drawnParam === undefined) continue;\n\n        params = segments[i].substr(1).match(constants.paramRE);\n        if(!params || params.length < drawnParam) continue;\n\n        val = convertVal(params[drawnParam]);\n        if(val < min) min = val;\n        if(val > max) max = val;\n    }\n    if(max >= min) return [min, max];\n}\n","'use strict';\n\n\nmodule.exports = {\n    segmentRE: /[MLHVQCTSZ][^MLHVQCTSZ]*/g,\n    paramRE: /[^\\s,]+/g,\n\n    // which numbers in each path segment are x (or y) values\n    // drawn is which param is a drawn point, as opposed to a\n    // control point (which doesn't count toward autorange.\n    // TODO: this means curved paths could extend beyond the\n    // autorange bounds. This is a bit tricky to get right\n    // unless we revert to bounding boxes, but perhaps there's\n    // a calculation we could do...)\n    paramIsX: {\n        M: {0: true, drawn: 0},\n        L: {0: true, drawn: 0},\n        H: {0: true, drawn: 0},\n        V: {},\n        Q: {0: true, 2: true, drawn: 2},\n        C: {0: true, 2: true, 4: true, drawn: 4},\n        T: {0: true, drawn: 0},\n        S: {0: true, 2: true, drawn: 2},\n        // A: {0: true, 5: true},\n        Z: {}\n    },\n\n    paramIsY: {\n        M: {1: true, drawn: 1},\n        L: {1: true, drawn: 1},\n        H: {},\n        V: {0: true, drawn: 0},\n        Q: {1: true, 3: true, drawn: 3},\n        C: {1: true, 3: true, 5: true, drawn: 5},\n        T: {1: true, drawn: 1},\n        S: {1: true, 3: true, drawn: 5},\n        // A: {1: true, 6: true},\n        Z: {}\n    },\n\n    numParams: {\n        M: 2,\n        L: 2,\n        H: 1,\n        V: 1,\n        Q: 4,\n        C: 6,\n        T: 2,\n        S: 4,\n        // A: 7,\n        Z: 0\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Axes = require('../../plots/cartesian/axes');\nvar handleArrayContainerDefaults = require('../../plots/array_container_defaults');\n\nvar attributes = require('./attributes');\nvar helpers = require('./helpers');\n\n\nmodule.exports = function supplyLayoutDefaults(layoutIn, layoutOut) {\n    handleArrayContainerDefaults(layoutIn, layoutOut, {\n        name: 'shapes',\n        handleItemDefaults: handleShapeDefaults\n    });\n};\n\nfunction handleShapeDefaults(shapeIn, shapeOut, fullLayout) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(shapeIn, shapeOut, attributes, attr, dflt);\n    }\n\n    var visible = coerce('visible');\n    if(!visible) return;\n\n    var path = coerce('path');\n    var dfltType = path ? 'path' : 'rect';\n    var shapeType = coerce('type', dfltType);\n    if(shapeOut.type !== 'path') delete shapeOut.path;\n\n    coerce('editable');\n    coerce('layer');\n    coerce('opacity');\n    coerce('fillcolor');\n    coerce('fillrule');\n    var lineWidth = coerce('line.width');\n    if(lineWidth) {\n        coerce('line.color');\n        coerce('line.dash');\n    }\n\n    var xSizeMode = coerce('xsizemode');\n    var ySizeMode = coerce('ysizemode');\n\n    // positioning\n    var axLetters = ['x', 'y'];\n    for(var i = 0; i < 2; i++) {\n        var axLetter = axLetters[i];\n        var attrAnchor = axLetter + 'anchor';\n        var sizeMode = axLetter === 'x' ? xSizeMode : ySizeMode;\n        var gdMock = {_fullLayout: fullLayout};\n        var ax;\n        var pos2r;\n        var r2pos;\n\n        // xref, yref\n        var axRef = Axes.coerceRef(shapeIn, shapeOut, gdMock, axLetter, undefined,\n            'paper');\n        var axRefType = Axes.getRefType(axRef);\n\n        if(axRefType === 'range') {\n            ax = Axes.getFromId(gdMock, axRef);\n            ax._shapeIndices.push(shapeOut._index);\n            r2pos = helpers.rangeToShapePosition(ax);\n            pos2r = helpers.shapePositionToRange(ax);\n        } else {\n            pos2r = r2pos = Lib.identity;\n        }\n\n        // Coerce x0, x1, y0, y1\n        if(shapeType !== 'path') {\n            var dflt0 = 0.25;\n            var dflt1 = 0.75;\n\n            // hack until V3.0 when log has regular range behavior - make it look like other\n            // ranges to send to coerce, then put it back after\n            // this is all to give reasonable default position behavior on log axes, which is\n            // a pretty unimportant edge case so we could just ignore this.\n            var attr0 = axLetter + '0';\n            var attr1 = axLetter + '1';\n            var in0 = shapeIn[attr0];\n            var in1 = shapeIn[attr1];\n            shapeIn[attr0] = pos2r(shapeIn[attr0], true);\n            shapeIn[attr1] = pos2r(shapeIn[attr1], true);\n\n            if(sizeMode === 'pixel') {\n                coerce(attr0, 0);\n                coerce(attr1, 10);\n            } else {\n                Axes.coercePosition(shapeOut, gdMock, coerce, axRef, attr0, dflt0);\n                Axes.coercePosition(shapeOut, gdMock, coerce, axRef, attr1, dflt1);\n            }\n\n            // hack part 2\n            shapeOut[attr0] = r2pos(shapeOut[attr0]);\n            shapeOut[attr1] = r2pos(shapeOut[attr1]);\n            shapeIn[attr0] = in0;\n            shapeIn[attr1] = in1;\n        }\n\n        // Coerce xanchor and yanchor\n        if(sizeMode === 'pixel') {\n            // Hack for log axis described above\n            var inAnchor = shapeIn[attrAnchor];\n            shapeIn[attrAnchor] = pos2r(shapeIn[attrAnchor], true);\n\n            Axes.coercePosition(shapeOut, gdMock, coerce, axRef, attrAnchor, 0.25);\n\n            // Hack part 2\n            shapeOut[attrAnchor] = r2pos(shapeOut[attrAnchor]);\n            shapeIn[attrAnchor] = inAnchor;\n        }\n    }\n\n    if(shapeType === 'path') {\n        coerce('path');\n    } else {\n        Lib.noneOrAll(shapeIn, shapeOut, ['x0', 'x1', 'y0', 'y1']);\n    }\n}\n","'use strict';\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar Axes = require('../../plots/cartesian/axes');\n\nvar readPaths = require('./draw_newshape/helpers').readPaths;\nvar displayOutlines = require('./draw_newshape/display_outlines');\n\nvar clearOutlineControllers = require('../../plots/cartesian/handle_outline').clearOutlineControllers;\n\nvar Color = require('../color');\nvar Drawing = require('../drawing');\nvar arrayEditor = require('../../plot_api/plot_template').arrayEditor;\n\nvar dragElement = require('../dragelement');\nvar setCursor = require('../../lib/setcursor');\n\nvar constants = require('./constants');\nvar helpers = require('./helpers');\n\n\n// Shapes are stored in gd.layout.shapes, an array of objects\n// index can point to one item in this array,\n//  or non-numeric to simply add a new one\n//  or -1 to modify all existing\n// opt can be the full options object, or one key (to be set to value)\n//  or undefined to simply redraw\n// if opt is blank, val can be 'add' or a full options object to add a new\n//  annotation at that point in the array, or 'remove' to delete this one\n\nmodule.exports = {\n    draw: draw,\n    drawOne: drawOne,\n    eraseActiveShape: eraseActiveShape\n};\n\nfunction draw(gd) {\n    var fullLayout = gd._fullLayout;\n\n    // Remove previous shapes before drawing new in shapes in fullLayout.shapes\n    fullLayout._shapeUpperLayer.selectAll('path').remove();\n    fullLayout._shapeLowerLayer.selectAll('path').remove();\n\n    for(var k in fullLayout._plots) {\n        var shapelayer = fullLayout._plots[k].shapelayer;\n        if(shapelayer) shapelayer.selectAll('path').remove();\n    }\n\n    for(var i = 0; i < fullLayout.shapes.length; i++) {\n        if(fullLayout.shapes[i].visible) {\n            drawOne(gd, i);\n        }\n    }\n\n    // may need to resurrect this if we put text (LaTeX) in shapes\n    // return Plots.previousPromises(gd);\n}\n\nfunction shouldSkipEdits(gd) {\n    return !!gd._fullLayout._drawing;\n}\n\nfunction couldHaveActiveShape(gd) {\n    // for now keep config.editable: true as it was before shape-drawing PR\n    return !gd._context.edits.shapePosition;\n}\n\nfunction drawOne(gd, index) {\n    // remove the existing shape if there is one.\n    // because indices can change, we need to look in all shape layers\n    gd._fullLayout._paperdiv\n        .selectAll('.shapelayer [data-index=\"' + index + '\"]')\n        .remove();\n\n    var o = helpers.makeOptionsAndPlotinfo(gd, index);\n    var options = o.options;\n    var plotinfo = o.plotinfo;\n\n    // this shape is gone - quit now after deleting it\n    // TODO: use d3 idioms instead of deleting and redrawing every time\n    if(!options._input || options.visible === false) return;\n\n    if(options.layer !== 'below') {\n        drawShape(gd._fullLayout._shapeUpperLayer);\n    } else if(options.xref === 'paper' || options.yref === 'paper') {\n        drawShape(gd._fullLayout._shapeLowerLayer);\n    } else {\n        if(plotinfo._hadPlotinfo) {\n            var mainPlot = plotinfo.mainplotinfo || plotinfo;\n            drawShape(mainPlot.shapelayer);\n        } else {\n            // Fall back to _shapeLowerLayer in case the requested subplot doesn't exist.\n            // This can happen if you reference the shape to an x / y axis combination\n            // that doesn't have any data on it (and layer is below)\n            drawShape(gd._fullLayout._shapeLowerLayer);\n        }\n    }\n\n    function drawShape(shapeLayer) {\n        var d = getPathString(gd, options);\n        var attrs = {\n            'data-index': index,\n            'fill-rule': options.fillrule,\n            d: d\n        };\n\n        var opacity = options.opacity;\n        var fillColor = options.fillcolor;\n        var lineColor = options.line.width ? options.line.color : 'rgba(0,0,0,0)';\n        var lineWidth = options.line.width;\n        var lineDash = options.line.dash;\n        if(!lineWidth && options.editable === true) {\n            // ensure invisible border to activate the shape\n            lineWidth = 5;\n            lineDash = 'solid';\n        }\n\n        var isOpen = d[d.length - 1] !== 'Z';\n\n        var isActiveShape = couldHaveActiveShape(gd) &&\n            options.editable && gd._fullLayout._activeShapeIndex === index;\n\n        if(isActiveShape) {\n            fillColor = isOpen ? 'rgba(0,0,0,0)' :\n                gd._fullLayout.activeshape.fillcolor;\n\n            opacity = gd._fullLayout.activeshape.opacity;\n        }\n\n        var path = shapeLayer.append('path')\n            .attr(attrs)\n            .style('opacity', opacity)\n            .call(Color.stroke, lineColor)\n            .call(Color.fill, fillColor)\n            .call(Drawing.dashLine, lineDash, lineWidth);\n\n        setClipPath(path, gd, options);\n\n        var editHelpers;\n        if(isActiveShape || gd._context.edits.shapePosition) editHelpers = arrayEditor(gd.layout, 'shapes', options);\n\n        if(isActiveShape) {\n            path.style({\n                'cursor': 'move',\n            });\n\n            var dragOptions = {\n                element: path.node(),\n                plotinfo: plotinfo,\n                gd: gd,\n                editHelpers: editHelpers,\n                isActiveShape: true // i.e. to enable controllers\n            };\n\n            var polygons = readPaths(d, gd);\n            // display polygons on the screen\n            displayOutlines(polygons, path, dragOptions);\n        } else {\n            if(gd._context.edits.shapePosition) {\n                setupDragElement(gd, path, options, index, shapeLayer, editHelpers);\n            } else if(options.editable === true) {\n                path.style('pointer-events',\n                    (isOpen || Color.opacity(fillColor) * opacity <= 0.5) ? 'stroke' : 'all'\n                );\n            }\n        }\n\n        path.node().addEventListener('click', function() { return activateShape(gd, path); });\n    }\n}\n\nfunction setClipPath(shapePath, gd, shapeOptions) {\n    // note that for layer=\"below\" the clipAxes can be different from the\n    // subplot we're drawing this in. This could cause problems if the shape\n    // spans two subplots. See https://github.com/plotly/plotly.js/issues/1452\n    //\n    // if axis is 'paper' or an axis with \" domain\" appended, then there is no\n    // clip axis\n    var clipAxes = (shapeOptions.xref + shapeOptions.yref).replace(/paper/g, '').replace(/[xyz][1-9]* *domain/g, '');\n\n    Drawing.setClipUrl(\n        shapePath,\n        clipAxes ? 'clip' + gd._fullLayout._uid + clipAxes : null,\n        gd\n    );\n}\n\nfunction setupDragElement(gd, shapePath, shapeOptions, index, shapeLayer, editHelpers) {\n    var MINWIDTH = 10;\n    var MINHEIGHT = 10;\n\n    var xPixelSized = shapeOptions.xsizemode === 'pixel';\n    var yPixelSized = shapeOptions.ysizemode === 'pixel';\n    var isLine = shapeOptions.type === 'line';\n    var isPath = shapeOptions.type === 'path';\n\n    var modifyItem = editHelpers.modifyItem;\n\n    var x0, y0, x1, y1, xAnchor, yAnchor;\n    var n0, s0, w0, e0, optN, optS, optW, optE;\n    var pathIn;\n\n    // setup conversion functions\n    var xa = Axes.getFromId(gd, shapeOptions.xref);\n    var xRefType = Axes.getRefType(shapeOptions.xref);\n    var ya = Axes.getFromId(gd, shapeOptions.yref);\n    var yRefType = Axes.getRefType(shapeOptions.yref);\n    var x2p = helpers.getDataToPixel(gd, xa, false, xRefType);\n    var y2p = helpers.getDataToPixel(gd, ya, true, yRefType);\n    var p2x = helpers.getPixelToData(gd, xa, false, xRefType);\n    var p2y = helpers.getPixelToData(gd, ya, true, yRefType);\n\n    var sensoryElement = obtainSensoryElement();\n    var dragOptions = {\n        element: sensoryElement.node(),\n        gd: gd,\n        prepFn: startDrag,\n        doneFn: endDrag,\n        clickFn: abortDrag\n    };\n    var dragMode;\n\n    dragElement.init(dragOptions);\n\n    sensoryElement.node().onmousemove = updateDragMode;\n\n    function obtainSensoryElement() {\n        return isLine ? createLineDragHandles() : shapePath;\n    }\n\n    function createLineDragHandles() {\n        var minSensoryWidth = 10;\n        var sensoryWidth = Math.max(shapeOptions.line.width, minSensoryWidth);\n\n        // Helper shapes group\n        // Note that by setting the `data-index` attr, it is ensured that\n        // the helper group is purged in this modules `draw` function\n        var g = shapeLayer.append('g')\n          .attr('data-index', index);\n\n        // Helper path for moving\n        g.append('path')\n          .attr('d', shapePath.attr('d'))\n          .style({\n              'cursor': 'move',\n              'stroke-width': sensoryWidth,\n              'stroke-opacity': '0' // ensure not visible\n          });\n\n        // Helper circles for resizing\n        var circleStyle = {\n            'fill-opacity': '0' // ensure not visible\n        };\n        var circleRadius = Math.max(sensoryWidth / 2, minSensoryWidth);\n\n        g.append('circle')\n          .attr({\n              'data-line-point': 'start-point',\n              'cx': xPixelSized ? x2p(shapeOptions.xanchor) + shapeOptions.x0 : x2p(shapeOptions.x0),\n              'cy': yPixelSized ? y2p(shapeOptions.yanchor) - shapeOptions.y0 : y2p(shapeOptions.y0),\n              'r': circleRadius\n          })\n          .style(circleStyle)\n          .classed('cursor-grab', true);\n\n        g.append('circle')\n          .attr({\n              'data-line-point': 'end-point',\n              'cx': xPixelSized ? x2p(shapeOptions.xanchor) + shapeOptions.x1 : x2p(shapeOptions.x1),\n              'cy': yPixelSized ? y2p(shapeOptions.yanchor) - shapeOptions.y1 : y2p(shapeOptions.y1),\n              'r': circleRadius\n          })\n          .style(circleStyle)\n          .classed('cursor-grab', true);\n\n        return g;\n    }\n\n    function updateDragMode(evt) {\n        if(shouldSkipEdits(gd)) {\n            dragMode = null;\n            return;\n        }\n\n        if(isLine) {\n            if(evt.target.tagName === 'path') {\n                dragMode = 'move';\n            } else {\n                dragMode = evt.target.attributes['data-line-point'].value === 'start-point' ?\n                  'resize-over-start-point' : 'resize-over-end-point';\n            }\n        } else {\n            // element might not be on screen at time of setup,\n            // so obtain bounding box here\n            var dragBBox = dragOptions.element.getBoundingClientRect();\n\n            // choose 'move' or 'resize'\n            // based on initial position of cursor within the drag element\n            var w = dragBBox.right - dragBBox.left;\n            var h = dragBBox.bottom - dragBBox.top;\n            var x = evt.clientX - dragBBox.left;\n            var y = evt.clientY - dragBBox.top;\n            var cursor = (!isPath && w > MINWIDTH && h > MINHEIGHT && !evt.shiftKey) ?\n                dragElement.getCursor(x / w, 1 - y / h) :\n                'move';\n\n            setCursor(shapePath, cursor);\n\n            // possible values 'move', 'sw', 'w', 'se', 'e', 'ne', 'n', 'nw' and 'w'\n            dragMode = cursor.split('-')[0];\n        }\n    }\n\n    function startDrag(evt) {\n        if(shouldSkipEdits(gd)) return;\n\n        // setup update strings and initial values\n        if(xPixelSized) {\n            xAnchor = x2p(shapeOptions.xanchor);\n        }\n        if(yPixelSized) {\n            yAnchor = y2p(shapeOptions.yanchor);\n        }\n\n        if(shapeOptions.type === 'path') {\n            pathIn = shapeOptions.path;\n        } else {\n            x0 = xPixelSized ? shapeOptions.x0 : x2p(shapeOptions.x0);\n            y0 = yPixelSized ? shapeOptions.y0 : y2p(shapeOptions.y0);\n            x1 = xPixelSized ? shapeOptions.x1 : x2p(shapeOptions.x1);\n            y1 = yPixelSized ? shapeOptions.y1 : y2p(shapeOptions.y1);\n        }\n\n        if(x0 < x1) {\n            w0 = x0;\n            optW = 'x0';\n            e0 = x1;\n            optE = 'x1';\n        } else {\n            w0 = x1;\n            optW = 'x1';\n            e0 = x0;\n            optE = 'x0';\n        }\n\n        // For fixed size shapes take opposing direction of y-axis into account.\n        // Hint: For data sized shapes this is done by the y2p function.\n        if((!yPixelSized && y0 < y1) || (yPixelSized && y0 > y1)) {\n            n0 = y0;\n            optN = 'y0';\n            s0 = y1;\n            optS = 'y1';\n        } else {\n            n0 = y1;\n            optN = 'y1';\n            s0 = y0;\n            optS = 'y0';\n        }\n\n        // setup dragMode and the corresponding handler\n        updateDragMode(evt);\n        renderVisualCues(shapeLayer, shapeOptions);\n        deactivateClipPathTemporarily(shapePath, shapeOptions, gd);\n        dragOptions.moveFn = (dragMode === 'move') ? moveShape : resizeShape;\n        dragOptions.altKey = evt.altKey;\n    }\n\n    function endDrag() {\n        if(shouldSkipEdits(gd)) return;\n\n        setCursor(shapePath);\n        removeVisualCues(shapeLayer);\n\n        // Don't rely on clipPath being activated during re-layout\n        setClipPath(shapePath, gd, shapeOptions);\n        Registry.call('_guiRelayout', gd, editHelpers.getUpdateObj());\n    }\n\n    function abortDrag() {\n        if(shouldSkipEdits(gd)) return;\n\n        removeVisualCues(shapeLayer);\n    }\n\n    function moveShape(dx, dy) {\n        if(shapeOptions.type === 'path') {\n            var noOp = function(coord) { return coord; };\n            var moveX = noOp;\n            var moveY = noOp;\n\n            if(xPixelSized) {\n                modifyItem('xanchor', shapeOptions.xanchor = p2x(xAnchor + dx));\n            } else {\n                moveX = function moveX(x) { return p2x(x2p(x) + dx); };\n                if(xa && xa.type === 'date') moveX = helpers.encodeDate(moveX);\n            }\n\n            if(yPixelSized) {\n                modifyItem('yanchor', shapeOptions.yanchor = p2y(yAnchor + dy));\n            } else {\n                moveY = function moveY(y) { return p2y(y2p(y) + dy); };\n                if(ya && ya.type === 'date') moveY = helpers.encodeDate(moveY);\n            }\n\n            modifyItem('path', shapeOptions.path = movePath(pathIn, moveX, moveY));\n        } else {\n            if(xPixelSized) {\n                modifyItem('xanchor', shapeOptions.xanchor = p2x(xAnchor + dx));\n            } else {\n                modifyItem('x0', shapeOptions.x0 = p2x(x0 + dx));\n                modifyItem('x1', shapeOptions.x1 = p2x(x1 + dx));\n            }\n\n            if(yPixelSized) {\n                modifyItem('yanchor', shapeOptions.yanchor = p2y(yAnchor + dy));\n            } else {\n                modifyItem('y0', shapeOptions.y0 = p2y(y0 + dy));\n                modifyItem('y1', shapeOptions.y1 = p2y(y1 + dy));\n            }\n        }\n\n        shapePath.attr('d', getPathString(gd, shapeOptions));\n        renderVisualCues(shapeLayer, shapeOptions);\n    }\n\n    function resizeShape(dx, dy) {\n        if(isPath) {\n            // TODO: implement path resize, don't forget to update dragMode code\n            var noOp = function(coord) { return coord; };\n            var moveX = noOp;\n            var moveY = noOp;\n\n            if(xPixelSized) {\n                modifyItem('xanchor', shapeOptions.xanchor = p2x(xAnchor + dx));\n            } else {\n                moveX = function moveX(x) { return p2x(x2p(x) + dx); };\n                if(xa && xa.type === 'date') moveX = helpers.encodeDate(moveX);\n            }\n\n            if(yPixelSized) {\n                modifyItem('yanchor', shapeOptions.yanchor = p2y(yAnchor + dy));\n            } else {\n                moveY = function moveY(y) { return p2y(y2p(y) + dy); };\n                if(ya && ya.type === 'date') moveY = helpers.encodeDate(moveY);\n            }\n\n            modifyItem('path', shapeOptions.path = movePath(pathIn, moveX, moveY));\n        } else if(isLine) {\n            if(dragMode === 'resize-over-start-point') {\n                var newX0 = x0 + dx;\n                var newY0 = yPixelSized ? y0 - dy : y0 + dy;\n                modifyItem('x0', shapeOptions.x0 = xPixelSized ? newX0 : p2x(newX0));\n                modifyItem('y0', shapeOptions.y0 = yPixelSized ? newY0 : p2y(newY0));\n            } else if(dragMode === 'resize-over-end-point') {\n                var newX1 = x1 + dx;\n                var newY1 = yPixelSized ? y1 - dy : y1 + dy;\n                modifyItem('x1', shapeOptions.x1 = xPixelSized ? newX1 : p2x(newX1));\n                modifyItem('y1', shapeOptions.y1 = yPixelSized ? newY1 : p2y(newY1));\n            }\n        } else {\n            var has = function(str) { return dragMode.indexOf(str) !== -1; };\n            var hasN = has('n');\n            var hasS = has('s');\n            var hasW = has('w');\n            var hasE = has('e');\n\n            var newN = hasN ? n0 + dy : n0;\n            var newS = hasS ? s0 + dy : s0;\n            var newW = hasW ? w0 + dx : w0;\n            var newE = hasE ? e0 + dx : e0;\n\n            if(yPixelSized) {\n                // Do things in opposing direction for y-axis.\n                // Hint: for data-sized shapes the reversal of axis direction is done in p2y.\n                if(hasN) newN = n0 - dy;\n                if(hasS) newS = s0 - dy;\n            }\n\n            // Update shape eventually. Again, be aware of the\n            // opposing direction of the y-axis of fixed size shapes.\n            if(\n                (!yPixelSized && newS - newN > MINHEIGHT) ||\n                (yPixelSized && newN - newS > MINHEIGHT)\n            ) {\n                modifyItem(optN, shapeOptions[optN] = yPixelSized ? newN : p2y(newN));\n                modifyItem(optS, shapeOptions[optS] = yPixelSized ? newS : p2y(newS));\n            }\n            if(newE - newW > MINWIDTH) {\n                modifyItem(optW, shapeOptions[optW] = xPixelSized ? newW : p2x(newW));\n                modifyItem(optE, shapeOptions[optE] = xPixelSized ? newE : p2x(newE));\n            }\n        }\n\n        shapePath.attr('d', getPathString(gd, shapeOptions));\n        renderVisualCues(shapeLayer, shapeOptions);\n    }\n\n    function renderVisualCues(shapeLayer, shapeOptions) {\n        if(xPixelSized || yPixelSized) {\n            renderAnchor();\n        }\n\n        function renderAnchor() {\n            var isNotPath = shapeOptions.type !== 'path';\n\n            // d3 join with dummy data to satisfy d3 data-binding\n            var visualCues = shapeLayer.selectAll('.visual-cue').data([0]);\n\n            // Enter\n            var strokeWidth = 1;\n            visualCues.enter()\n              .append('path')\n              .attr({\n                  'fill': '#fff',\n                  'fill-rule': 'evenodd',\n                  'stroke': '#000',\n                  'stroke-width': strokeWidth\n              })\n              .classed('visual-cue', true);\n\n            // Update\n            var posX = x2p(\n              xPixelSized ?\n                shapeOptions.xanchor :\n                Lib.midRange(\n                  isNotPath ?\n                    [shapeOptions.x0, shapeOptions.x1] :\n                    helpers.extractPathCoords(shapeOptions.path, constants.paramIsX))\n            );\n            var posY = y2p(\n              yPixelSized ?\n                shapeOptions.yanchor :\n                Lib.midRange(\n                  isNotPath ?\n                    [shapeOptions.y0, shapeOptions.y1] :\n                    helpers.extractPathCoords(shapeOptions.path, constants.paramIsY))\n            );\n\n            posX = helpers.roundPositionForSharpStrokeRendering(posX, strokeWidth);\n            posY = helpers.roundPositionForSharpStrokeRendering(posY, strokeWidth);\n\n            if(xPixelSized && yPixelSized) {\n                var crossPath = 'M' + (posX - 1 - strokeWidth) + ',' + (posY - 1 - strokeWidth) +\n                  'h-8v2h8 v8h2v-8 h8v-2h-8 v-8h-2 Z';\n                visualCues.attr('d', crossPath);\n            } else if(xPixelSized) {\n                var vBarPath = 'M' + (posX - 1 - strokeWidth) + ',' + (posY - 9 - strokeWidth) +\n                  'v18 h2 v-18 Z';\n                visualCues.attr('d', vBarPath);\n            } else {\n                var hBarPath = 'M' + (posX - 9 - strokeWidth) + ',' + (posY - 1 - strokeWidth) +\n                  'h18 v2 h-18 Z';\n                visualCues.attr('d', hBarPath);\n            }\n        }\n    }\n\n    function removeVisualCues(shapeLayer) {\n        shapeLayer.selectAll('.visual-cue').remove();\n    }\n\n    function deactivateClipPathTemporarily(shapePath, shapeOptions, gd) {\n        var xref = shapeOptions.xref;\n        var yref = shapeOptions.yref;\n        var xa = Axes.getFromId(gd, xref);\n        var ya = Axes.getFromId(gd, yref);\n\n        var clipAxes = '';\n        if(xref !== 'paper' && !xa.autorange) clipAxes += xref;\n        if(yref !== 'paper' && !ya.autorange) clipAxes += yref;\n\n        Drawing.setClipUrl(\n            shapePath,\n            clipAxes ? 'clip' + gd._fullLayout._uid + clipAxes : null,\n            gd\n        );\n    }\n}\n\nfunction getPathString(gd, options) {\n    var type = options.type;\n    var xRefType = Axes.getRefType(options.xref);\n    var yRefType = Axes.getRefType(options.yref);\n    var xa = Axes.getFromId(gd, options.xref);\n    var ya = Axes.getFromId(gd, options.yref);\n    var gs = gd._fullLayout._size;\n    var x2r, x2p, y2r, y2p;\n    var x0, x1, y0, y1;\n\n    if(xa) {\n        if(xRefType === 'domain') {\n            x2p = function(v) { return xa._offset + xa._length * v; };\n        } else {\n            x2r = helpers.shapePositionToRange(xa);\n            x2p = function(v) { return xa._offset + xa.r2p(x2r(v, true)); };\n        }\n    } else {\n        x2p = function(v) { return gs.l + gs.w * v; };\n    }\n\n    if(ya) {\n        if(yRefType === 'domain') {\n            y2p = function(v) { return ya._offset + ya._length * (1 - v); };\n        } else {\n            y2r = helpers.shapePositionToRange(ya);\n            y2p = function(v) { return ya._offset + ya.r2p(y2r(v, true)); };\n        }\n    } else {\n        y2p = function(v) { return gs.t + gs.h * (1 - v); };\n    }\n\n    if(type === 'path') {\n        if(xa && xa.type === 'date') x2p = helpers.decodeDate(x2p);\n        if(ya && ya.type === 'date') y2p = helpers.decodeDate(y2p);\n        return convertPath(options, x2p, y2p);\n    }\n\n    if(options.xsizemode === 'pixel') {\n        var xAnchorPos = x2p(options.xanchor);\n        x0 = xAnchorPos + options.x0;\n        x1 = xAnchorPos + options.x1;\n    } else {\n        x0 = x2p(options.x0);\n        x1 = x2p(options.x1);\n    }\n\n    if(options.ysizemode === 'pixel') {\n        var yAnchorPos = y2p(options.yanchor);\n        y0 = yAnchorPos - options.y0;\n        y1 = yAnchorPos - options.y1;\n    } else {\n        y0 = y2p(options.y0);\n        y1 = y2p(options.y1);\n    }\n\n    if(type === 'line') return 'M' + x0 + ',' + y0 + 'L' + x1 + ',' + y1;\n    if(type === 'rect') return 'M' + x0 + ',' + y0 + 'H' + x1 + 'V' + y1 + 'H' + x0 + 'Z';\n\n    // circle\n    var cx = (x0 + x1) / 2;\n    var cy = (y0 + y1) / 2;\n    var rx = Math.abs(cx - x0);\n    var ry = Math.abs(cy - y0);\n    var rArc = 'A' + rx + ',' + ry;\n    var rightPt = (cx + rx) + ',' + cy;\n    var topPt = cx + ',' + (cy - ry);\n    return 'M' + rightPt + rArc + ' 0 1,1 ' + topPt +\n        rArc + ' 0 0,1 ' + rightPt + 'Z';\n}\n\n\nfunction convertPath(options, x2p, y2p) {\n    var pathIn = options.path;\n    var xSizemode = options.xsizemode;\n    var ySizemode = options.ysizemode;\n    var xAnchor = options.xanchor;\n    var yAnchor = options.yanchor;\n\n    return pathIn.replace(constants.segmentRE, function(segment) {\n        var paramNumber = 0;\n        var segmentType = segment.charAt(0);\n        var xParams = constants.paramIsX[segmentType];\n        var yParams = constants.paramIsY[segmentType];\n        var nParams = constants.numParams[segmentType];\n\n        var paramString = segment.substr(1).replace(constants.paramRE, function(param) {\n            if(xParams[paramNumber]) {\n                if(xSizemode === 'pixel') param = x2p(xAnchor) + Number(param);\n                else param = x2p(param);\n            } else if(yParams[paramNumber]) {\n                if(ySizemode === 'pixel') param = y2p(yAnchor) - Number(param);\n                else param = y2p(param);\n            }\n            paramNumber++;\n\n            if(paramNumber > nParams) param = 'X';\n            return param;\n        });\n\n        if(paramNumber > nParams) {\n            paramString = paramString.replace(/[\\s,]*X.*/, '');\n            Lib.log('Ignoring extra params in segment ' + segment);\n        }\n\n        return segmentType + paramString;\n    });\n}\n\nfunction movePath(pathIn, moveX, moveY) {\n    return pathIn.replace(constants.segmentRE, function(segment) {\n        var paramNumber = 0;\n        var segmentType = segment.charAt(0);\n        var xParams = constants.paramIsX[segmentType];\n        var yParams = constants.paramIsY[segmentType];\n        var nParams = constants.numParams[segmentType];\n\n        var paramString = segment.substr(1).replace(constants.paramRE, function(param) {\n            if(paramNumber >= nParams) return param;\n\n            if(xParams[paramNumber]) param = moveX(param);\n            else if(yParams[paramNumber]) param = moveY(param);\n\n            paramNumber++;\n\n            return param;\n        });\n\n        return segmentType + paramString;\n    });\n}\n\nfunction activateShape(gd, path) {\n    if(!couldHaveActiveShape(gd)) return;\n\n    var element = path.node();\n    var id = +element.getAttribute('data-index');\n    if(id >= 0) {\n        // deactivate if already active\n        if(id === gd._fullLayout._activeShapeIndex) {\n            deactivateShape(gd);\n            return;\n        }\n\n        gd._fullLayout._activeShapeIndex = id;\n        gd._fullLayout._deactivateShape = deactivateShape;\n        draw(gd);\n    }\n}\n\nfunction deactivateShape(gd) {\n    if(!couldHaveActiveShape(gd)) return;\n\n    var id = gd._fullLayout._activeShapeIndex;\n    if(id >= 0) {\n        clearOutlineControllers(gd);\n        delete gd._fullLayout._activeShapeIndex;\n        draw(gd);\n    }\n}\n\nfunction eraseActiveShape(gd) {\n    if(!couldHaveActiveShape(gd)) return;\n\n    clearOutlineControllers(gd);\n\n    var id = gd._fullLayout._activeShapeIndex;\n    var shapes = (gd.layout || {}).shapes || [];\n    if(id < shapes.length) {\n        var newShapes = [];\n        for(var q = 0; q < shapes.length; q++) {\n            if(q !== id) {\n                newShapes.push(shapes[q]);\n            }\n        }\n\n        delete gd._fullLayout._activeShapeIndex;\n\n        Registry.call('_guiRelayout', gd, {\n            shapes: newShapes\n        });\n    }\n}\n","'use strict';\n\nvar dash = require('../../drawing/attributes').dash;\nvar extendFlat = require('../../../lib/extend').extendFlat;\n\nmodule.exports = {\n    newshape: {\n        line: {\n            color: {\n                valType: 'color',\n                editType: 'none',\n                description: [\n                    'Sets the line color.',\n                    'By default uses either dark grey or white',\n                    'to increase contrast with background color.'\n                ].join(' ')\n            },\n            width: {\n                valType: 'number',\n                min: 0,\n                dflt: 4,\n                editType: 'none',\n                description: 'Sets the line width (in px).'\n            },\n            dash: extendFlat({}, dash, {\n                dflt: 'solid',\n                editType: 'none'\n            }),\n            editType: 'none'\n        },\n        fillcolor: {\n            valType: 'color',\n            dflt: 'rgba(0,0,0,0)',\n            editType: 'none',\n            description: [\n                'Sets the color filling new shapes\\' interior.',\n                'Please note that if using a fillcolor with alpha greater than half,',\n                'drag inside the active shape starts moving the shape underneath,',\n                'otherwise a new shape could be started over.'\n            ].join(' ')\n        },\n        fillrule: {\n            valType: 'enumerated',\n            values: ['evenodd', 'nonzero'],\n            dflt: 'evenodd',\n            editType: 'none',\n            description: [\n                'Determines the path\\'s interior.',\n                'For more info please visit https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/fill-rule'\n            ].join(' ')\n        },\n        opacity: {\n            valType: 'number',\n            min: 0,\n            max: 1,\n            dflt: 1,\n            editType: 'none',\n            description: 'Sets the opacity of new shapes.'\n        },\n        layer: {\n            valType: 'enumerated',\n            values: ['below', 'above'],\n            dflt: 'above',\n            editType: 'none',\n            description: 'Specifies whether new shapes are drawn below or above traces.'\n        },\n        drawdirection: {\n            valType: 'enumerated',\n            values: ['ortho', 'horizontal', 'vertical', 'diagonal'],\n            dflt: 'diagonal',\n            editType: 'none',\n            description: [\n                'When `dragmode` is set to *drawrect*, *drawline* or *drawcircle*',\n                'this limits the drag to be horizontal, vertical or diagonal.',\n                'Using *diagonal* there is no limit e.g. in drawing lines in any direction.',\n                '*ortho* limits the draw to be either horizontal or vertical.',\n                '*horizontal* allows horizontal extend.',\n                '*vertical* allows vertical extend.'\n            ].join(' ')\n        },\n\n        editType: 'none'\n    },\n\n    activeshape: {\n        fillcolor: {\n            valType: 'color',\n            dflt: 'rgb(255,0,255)',\n            editType: 'none',\n            description: 'Sets the color filling the active shape\\' interior.'\n        },\n        opacity: {\n            valType: 'number',\n            min: 0,\n            max: 1,\n            dflt: 0.5,\n            editType: 'none',\n            description: 'Sets the opacity of the active shape.'\n        },\n        editType: 'none'\n    }\n};\n","'use strict';\n\nvar CIRCLE_SIDES = 32;  // should be divisible by 4\n\nmodule.exports = {\n    CIRCLE_SIDES: CIRCLE_SIDES,\n    i000: 0,\n    i090: CIRCLE_SIDES / 4,\n    i180: CIRCLE_SIDES / 2,\n    i270: CIRCLE_SIDES / 4 * 3,\n    cos45: Math.cos(Math.PI / 4),\n    sin45: Math.sin(Math.PI / 4),\n    SQRT2: Math.sqrt(2)\n};\n","'use strict';\n\nvar Color = require('../../color');\n\n\nmodule.exports = function supplyDrawNewShapeDefaults(layoutIn, layoutOut, coerce) {\n    coerce('newshape.drawdirection');\n    coerce('newshape.layer');\n    coerce('newshape.fillcolor');\n    coerce('newshape.fillrule');\n    coerce('newshape.opacity');\n    var newshapeLineWidth = coerce('newshape.line.width');\n    if(newshapeLineWidth) {\n        var bgcolor = (layoutIn || {}).plot_bgcolor || '#FFF';\n        coerce('newshape.line.color', Color.contrast(bgcolor));\n        coerce('newshape.line.dash');\n    }\n\n    coerce('activeshape.fillcolor');\n    coerce('activeshape.opacity');\n};\n","'use strict';\n\nvar dragElement = require('../../dragelement');\nvar dragHelpers = require('../../dragelement/helpers');\nvar drawMode = dragHelpers.drawMode;\n\nvar Registry = require('../../../registry');\n\nvar constants = require('./constants');\nvar i000 = constants.i000;\nvar i090 = constants.i090;\nvar i180 = constants.i180;\nvar i270 = constants.i270;\n\nvar handleOutline = require('../../../plots/cartesian/handle_outline');\nvar clearOutlineControllers = handleOutline.clearOutlineControllers;\n\nvar helpers = require('./helpers');\nvar pointsShapeRectangle = helpers.pointsShapeRectangle;\nvar pointsShapeEllipse = helpers.pointsShapeEllipse;\nvar writePaths = helpers.writePaths;\nvar newShapes = require('./newshapes');\n\nmodule.exports = function displayOutlines(polygons, outlines, dragOptions, nCalls) {\n    if(!nCalls) nCalls = 0;\n\n    var gd = dragOptions.gd;\n\n    function redraw() {\n        // recursive call\n        displayOutlines(polygons, outlines, dragOptions, nCalls++);\n\n        if(pointsShapeEllipse(polygons[0])) {\n            update({redrawing: true});\n        }\n    }\n\n    function update(opts) {\n        dragOptions.isActiveShape = false; // i.e. to disable controllers\n\n        var updateObject = newShapes(outlines, dragOptions);\n        if(Object.keys(updateObject).length) {\n            Registry.call((opts || {}).redrawing ? 'relayout' : '_guiRelayout', gd, updateObject);\n        }\n    }\n\n\n    var isActiveShape = dragOptions.isActiveShape;\n    var fullLayout = gd._fullLayout;\n    var zoomLayer = fullLayout._zoomlayer;\n\n    var dragmode = dragOptions.dragmode;\n    var isDrawMode = drawMode(dragmode);\n\n    if(isDrawMode) gd._fullLayout._drawing = true;\n    else if(gd._fullLayout._activeShapeIndex >= 0) clearOutlineControllers(gd);\n\n    // make outline\n    outlines.attr('d', writePaths(polygons));\n\n    // add controllers\n    var vertexDragOptions;\n    var shapeDragOptions;\n    var indexI; // cell index\n    var indexJ; // vertex or cell-controller index\n    var copyPolygons;\n\n    if(isActiveShape && !nCalls) {\n        copyPolygons = recordPositions([], polygons);\n\n        var g = zoomLayer.append('g').attr('class', 'outline-controllers');\n        addVertexControllers(g);\n        addShapeControllers();\n    }\n\n    function startDragVertex(evt) {\n        indexI = +evt.srcElement.getAttribute('data-i');\n        indexJ = +evt.srcElement.getAttribute('data-j');\n\n        vertexDragOptions[indexI][indexJ].moveFn = moveVertexController;\n    }\n\n    function moveVertexController(dx, dy) {\n        if(!polygons.length) return;\n\n        var x0 = copyPolygons[indexI][indexJ][1];\n        var y0 = copyPolygons[indexI][indexJ][2];\n\n        var cell = polygons[indexI];\n        var len = cell.length;\n        if(pointsShapeRectangle(cell)) {\n            for(var q = 0; q < len; q++) {\n                if(q === indexJ) continue;\n\n                // move other corners of rectangle\n                var pos = cell[q];\n\n                if(pos[1] === cell[indexJ][1]) {\n                    pos[1] = x0 + dx;\n                }\n\n                if(pos[2] === cell[indexJ][2]) {\n                    pos[2] = y0 + dy;\n                }\n            }\n            // move the corner\n            cell[indexJ][1] = x0 + dx;\n            cell[indexJ][2] = y0 + dy;\n\n            if(!pointsShapeRectangle(cell)) {\n                // reject result to rectangles with ensure areas\n                for(var j = 0; j < len; j++) {\n                    for(var k = 0; k < cell[j].length; k++) {\n                        cell[j][k] = copyPolygons[indexI][j][k];\n                    }\n                }\n            }\n        } else { // other polylines\n            cell[indexJ][1] = x0 + dx;\n            cell[indexJ][2] = y0 + dy;\n        }\n\n        redraw();\n    }\n\n    function endDragVertexController() {\n        update();\n    }\n\n    function removeVertex() {\n        if(!polygons.length) return;\n        if(!polygons[indexI]) return;\n        if(!polygons[indexI].length) return;\n\n        var newPolygon = [];\n        for(var j = 0; j < polygons[indexI].length; j++) {\n            if(j !== indexJ) {\n                newPolygon.push(\n                    polygons[indexI][j]\n                );\n            }\n        }\n\n        if(newPolygon.length > 1 && !(\n            newPolygon.length === 2 && newPolygon[1][0] === 'Z')\n        ) {\n            if(indexJ === 0) {\n                newPolygon[0][0] = 'M';\n            }\n\n            polygons[indexI] = newPolygon;\n\n            redraw();\n            update();\n        }\n    }\n\n    function clickVertexController(numClicks, evt) {\n        if(numClicks === 2) {\n            indexI = +evt.srcElement.getAttribute('data-i');\n            indexJ = +evt.srcElement.getAttribute('data-j');\n\n            var cell = polygons[indexI];\n            if(\n                !pointsShapeRectangle(cell) &&\n                !pointsShapeEllipse(cell)\n            ) {\n                removeVertex();\n            }\n        }\n    }\n\n    function addVertexControllers(g) {\n        vertexDragOptions = [];\n\n        for(var i = 0; i < polygons.length; i++) {\n            var cell = polygons[i];\n\n            var onRect = pointsShapeRectangle(cell);\n            var onEllipse = !onRect && pointsShapeEllipse(cell);\n\n            vertexDragOptions[i] = [];\n            for(var j = 0; j < cell.length; j++) {\n                if(cell[j][0] === 'Z') continue;\n\n                if(onEllipse &&\n                    j !== i000 &&\n                    j !== i090 &&\n                    j !== i180 &&\n                    j !== i270\n                ) {\n                    continue;\n                }\n\n                var x = cell[j][1];\n                var y = cell[j][2];\n\n                var vertex = g.append('circle')\n                    .classed('cursor-grab', true)\n                    .attr('data-i', i)\n                    .attr('data-j', j)\n                    .attr('cx', x)\n                    .attr('cy', y)\n                    .attr('r', 4)\n                    .style({\n                        'mix-blend-mode': 'luminosity',\n                        fill: 'black',\n                        stroke: 'white',\n                        'stroke-width': 1\n                    });\n\n                vertexDragOptions[i][j] = {\n                    element: vertex.node(),\n                    gd: gd,\n                    prepFn: startDragVertex,\n                    doneFn: endDragVertexController,\n                    clickFn: clickVertexController\n                };\n\n                dragElement.init(vertexDragOptions[i][j]);\n            }\n        }\n    }\n\n    function moveShape(dx, dy) {\n        if(!polygons.length) return;\n\n        for(var i = 0; i < polygons.length; i++) {\n            for(var j = 0; j < polygons[i].length; j++) {\n                for(var k = 0; k + 2 < polygons[i][j].length; k += 2) {\n                    polygons[i][j][k + 1] = copyPolygons[i][j][k + 1] + dx;\n                    polygons[i][j][k + 2] = copyPolygons[i][j][k + 2] + dy;\n                }\n            }\n        }\n    }\n\n    function moveShapeController(dx, dy) {\n        moveShape(dx, dy);\n\n        redraw();\n    }\n\n    function startDragShapeController(evt) {\n        indexI = +evt.srcElement.getAttribute('data-i');\n        if(!indexI) indexI = 0; // ensure non-existing move button get zero index\n\n        shapeDragOptions[indexI].moveFn = moveShapeController;\n    }\n\n    function endDragShapeController() {\n        update();\n    }\n\n    function addShapeControllers() {\n        shapeDragOptions = [];\n\n        if(!polygons.length) return;\n\n        var i = 0;\n        shapeDragOptions[i] = {\n            element: outlines[0][0],\n            gd: gd,\n            prepFn: startDragShapeController,\n            doneFn: endDragShapeController\n        };\n\n        dragElement.init(shapeDragOptions[i]);\n    }\n};\n\nfunction recordPositions(polygonsOut, polygonsIn) {\n    for(var i = 0; i < polygonsIn.length; i++) {\n        var cell = polygonsIn[i];\n        polygonsOut[i] = [];\n        for(var j = 0; j < cell.length; j++) {\n            polygonsOut[i][j] = [];\n            for(var k = 0; k < cell[j].length; k++) {\n                polygonsOut[i][j][k] = cell[j][k];\n            }\n        }\n    }\n    return polygonsOut;\n}\n","'use strict';\n\nvar parseSvgPath = require('parse-svg-path');\n\nvar constants = require('./constants');\nvar CIRCLE_SIDES = constants.CIRCLE_SIDES;\nvar SQRT2 = constants.SQRT2;\n\nvar cartesianHelpers = require('../../../plots/cartesian/helpers');\nvar p2r = cartesianHelpers.p2r;\nvar r2p = cartesianHelpers.r2p;\n\nvar iC = [0, 3, 4, 5, 6, 1, 2];\nvar iQS = [0, 3, 4, 1, 2];\n\nexports.writePaths = function(polygons) {\n    var nI = polygons.length;\n    if(!nI) return 'M0,0Z';\n\n    var str = '';\n    for(var i = 0; i < nI; i++) {\n        var nJ = polygons[i].length;\n        for(var j = 0; j < nJ; j++) {\n            var w = polygons[i][j][0];\n            if(w === 'Z') {\n                str += 'Z';\n            } else {\n                var nK = polygons[i][j].length;\n                for(var k = 0; k < nK; k++) {\n                    var realK = k;\n                    if(w === 'Q' || w === 'S') {\n                        realK = iQS[k];\n                    } else if(w === 'C') {\n                        realK = iC[k];\n                    }\n\n                    str += polygons[i][j][realK];\n                    if(k > 0 && k < nK - 1) {\n                        str += ',';\n                    }\n                }\n            }\n        }\n    }\n\n    return str;\n};\n\nexports.readPaths = function(str, gd, plotinfo, isActiveShape) {\n    var cmd = parseSvgPath(str);\n\n    var polys = [];\n    var n = -1;\n    var newPoly = function() {\n        n++;\n        polys[n] = [];\n    };\n\n    var k;\n    var x = 0;\n    var y = 0;\n    var initX;\n    var initY;\n    var recStart = function() {\n        initX = x;\n        initY = y;\n    };\n\n    recStart();\n    for(var i = 0; i < cmd.length; i++) {\n        var newPos = [];\n\n        var x1, x2, y1, y2; // i.e. extra params for curves\n\n        var c = cmd[i][0];\n        var w = c;\n        switch(c) {\n            case 'M':\n                newPoly();\n                x = +cmd[i][1];\n                y = +cmd[i][2];\n                newPos.push([w, x, y]);\n\n                recStart();\n                break;\n\n            case 'Q':\n            case 'S':\n                x1 = +cmd[i][1];\n                y1 = +cmd[i][2];\n                x = +cmd[i][3];\n                y = +cmd[i][4];\n                newPos.push([w, x, y, x1, y1]); // -> iQS order\n                break;\n\n            case 'C':\n                x1 = +cmd[i][1];\n                y1 = +cmd[i][2];\n                x2 = +cmd[i][3];\n                y2 = +cmd[i][4];\n                x = +cmd[i][5];\n                y = +cmd[i][6];\n                newPos.push([w, x, y, x1, y1, x2, y2]); // -> iC order\n                break;\n\n            case 'T':\n            case 'L':\n                x = +cmd[i][1];\n                y = +cmd[i][2];\n                newPos.push([w, x, y]);\n                break;\n\n            case 'H':\n                w = 'L'; // convert to line (for now)\n                x = +cmd[i][1];\n                newPos.push([w, x, y]);\n                break;\n\n            case 'V':\n                w = 'L'; // convert to line (for now)\n                y = +cmd[i][1];\n                newPos.push([w, x, y]);\n                break;\n\n            case 'A':\n                w = 'L'; // convert to line to handle circle\n                var rx = +cmd[i][1];\n                var ry = +cmd[i][2];\n                if(!+cmd[i][4]) {\n                    rx = -rx;\n                    ry = -ry;\n                }\n\n                var cenX = x - rx;\n                var cenY = y;\n                for(k = 1; k <= CIRCLE_SIDES / 2; k++) {\n                    var t = 2 * Math.PI * k / CIRCLE_SIDES;\n                    newPos.push([\n                        w,\n                        cenX + rx * Math.cos(t),\n                        cenY + ry * Math.sin(t)\n                    ]);\n                }\n                break;\n\n            case 'Z':\n                if(x !== initX || y !== initY) {\n                    x = initX;\n                    y = initY;\n                    newPos.push([w, x, y]);\n                }\n                break;\n        }\n\n        var domain = (plotinfo || {}).domain;\n        var size = gd._fullLayout._size;\n        var xPixelSized = plotinfo && plotinfo.xsizemode === 'pixel';\n        var yPixelSized = plotinfo && plotinfo.ysizemode === 'pixel';\n        var noOffset = isActiveShape === false;\n\n        for(var j = 0; j < newPos.length; j++) {\n            for(k = 0; k + 2 < 7; k += 2) {\n                var _x = newPos[j][k + 1];\n                var _y = newPos[j][k + 2];\n\n                if(_x === undefined || _y === undefined) continue;\n                // keep track of end point for Z\n                x = _x;\n                y = _y;\n\n                if(plotinfo) {\n                    if(plotinfo.xaxis && plotinfo.xaxis.p2r) {\n                        if(noOffset) _x -= plotinfo.xaxis._offset;\n                        if(xPixelSized) {\n                            _x = r2p(plotinfo.xaxis, plotinfo.xanchor) + _x;\n                        } else {\n                            _x = p2r(plotinfo.xaxis, _x);\n                        }\n                    } else {\n                        if(noOffset) _x -= size.l;\n                        if(domain) _x = domain.x[0] + _x / size.w;\n                        else _x = _x / size.w;\n                    }\n\n                    if(plotinfo.yaxis && plotinfo.yaxis.p2r) {\n                        if(noOffset) _y -= plotinfo.yaxis._offset;\n                        if(yPixelSized) {\n                            _y = r2p(plotinfo.yaxis, plotinfo.yanchor) - _y;\n                        } else {\n                            _y = p2r(plotinfo.yaxis, _y);\n                        }\n                    } else {\n                        if(noOffset) _y -= size.t;\n                        if(domain) _y = domain.y[1] - _y / size.h;\n                        else _y = 1 - _y / size.h;\n                    }\n                }\n\n                newPos[j][k + 1] = _x;\n                newPos[j][k + 2] = _y;\n            }\n            polys[n].push(\n                newPos[j].slice()\n            );\n        }\n    }\n\n    return polys;\n};\n\nfunction almostEq(a, b) {\n    return Math.abs(a - b) <= 1e-6;\n}\n\nfunction dist(a, b) {\n    var dx = b[1] - a[1];\n    var dy = b[2] - a[2];\n    return Math.sqrt(\n        dx * dx +\n        dy * dy\n    );\n}\n\nexports.pointsShapeRectangle = function(cell) {\n    var len = cell.length;\n    if(len !== 5) return false;\n\n    for(var j = 1; j < 3; j++) {\n        var e01 = cell[0][j] - cell[1][j];\n        var e32 = cell[3][j] - cell[2][j];\n\n        if(!almostEq(e01, e32)) return false;\n\n        var e03 = cell[0][j] - cell[3][j];\n        var e12 = cell[1][j] - cell[2][j];\n        if(!almostEq(e03, e12)) return false;\n    }\n\n    // N.B. rotated rectangles are not valid rects since rotation is not supported in shapes for now.\n    if(\n        !almostEq(cell[0][1], cell[1][1]) &&\n        !almostEq(cell[0][1], cell[3][1])\n    ) return false;\n\n    // reject cases with zero area\n    return !!(\n        dist(cell[0], cell[1]) *\n        dist(cell[0], cell[3])\n    );\n};\n\nexports.pointsShapeEllipse = function(cell) {\n    var len = cell.length;\n    if(len !== CIRCLE_SIDES + 1) return false;\n\n    // opposite diagonals should be the same\n    len = CIRCLE_SIDES;\n    for(var i = 0; i < len; i++) {\n        var k = (len * 2 - i) % len;\n\n        var k2 = (len / 2 + k) % len;\n        var i2 = (len / 2 + i) % len;\n\n        if(!almostEq(\n            dist(cell[i], cell[i2]),\n            dist(cell[k], cell[k2])\n        )) return false;\n    }\n    return true;\n};\n\nexports.handleEllipse = function(isEllipse, start, end) {\n    if(!isEllipse) return [start, end]; // i.e. case of line\n\n    var pos = exports.ellipseOver({\n        x0: start[0],\n        y0: start[1],\n        x1: end[0],\n        y1: end[1]\n    });\n\n    var cx = (pos.x1 + pos.x0) / 2;\n    var cy = (pos.y1 + pos.y0) / 2;\n    var rx = (pos.x1 - pos.x0) / 2;\n    var ry = (pos.y1 - pos.y0) / 2;\n\n    // make a circle when one dimension is zero\n    if(!rx) rx = ry = ry / SQRT2;\n    if(!ry) ry = rx = rx / SQRT2;\n\n    var cell = [];\n    for(var i = 0; i < CIRCLE_SIDES; i++) {\n        var t = i * 2 * Math.PI / CIRCLE_SIDES;\n        cell.push([\n            cx + rx * Math.cos(t),\n            cy + ry * Math.sin(t),\n        ]);\n    }\n    return cell;\n};\n\nexports.ellipseOver = function(pos) {\n    var x0 = pos.x0;\n    var y0 = pos.y0;\n    var x1 = pos.x1;\n    var y1 = pos.y1;\n\n    var dx = x1 - x0;\n    var dy = y1 - y0;\n\n    x0 -= dx;\n    y0 -= dy;\n\n    var cx = (x0 + x1) / 2;\n    var cy = (y0 + y1) / 2;\n\n    var scale = SQRT2;\n    dx *= scale;\n    dy *= scale;\n\n    return {\n        x0: cx - dx,\n        y0: cy - dy,\n        x1: cx + dx,\n        y1: cy + dy\n    };\n};\n","'use strict';\n\nvar dragHelpers = require('../../dragelement/helpers');\nvar drawMode = dragHelpers.drawMode;\nvar openMode = dragHelpers.openMode;\n\nvar constants = require('./constants');\nvar i000 = constants.i000;\nvar i090 = constants.i090;\nvar i180 = constants.i180;\nvar i270 = constants.i270;\nvar cos45 = constants.cos45;\nvar sin45 = constants.sin45;\n\nvar cartesianHelpers = require('../../../plots/cartesian/helpers');\nvar p2r = cartesianHelpers.p2r;\nvar r2p = cartesianHelpers.r2p;\n\nvar handleOutline = require('../../../plots/cartesian/handle_outline');\nvar clearSelect = handleOutline.clearSelect;\n\nvar helpers = require('./helpers');\nvar readPaths = helpers.readPaths;\nvar writePaths = helpers.writePaths;\nvar ellipseOver = helpers.ellipseOver;\n\n\nmodule.exports = function newShapes(outlines, dragOptions) {\n    if(!outlines.length) return;\n    var e = outlines[0][0]; // pick first\n    if(!e) return;\n    var d = e.getAttribute('d');\n\n    var gd = dragOptions.gd;\n    var drwStyle = gd._fullLayout.newshape;\n\n    var plotinfo = dragOptions.plotinfo;\n    var xaxis = plotinfo.xaxis;\n    var yaxis = plotinfo.yaxis;\n    var xPaper = !!plotinfo.domain || !plotinfo.xaxis;\n    var yPaper = !!plotinfo.domain || !plotinfo.yaxis;\n\n    var isActiveShape = dragOptions.isActiveShape;\n    var dragmode = dragOptions.dragmode;\n\n    var shapes = (gd.layout || {}).shapes || [];\n\n    if(!drawMode(dragmode) && isActiveShape !== undefined) {\n        var id = gd._fullLayout._activeShapeIndex;\n        if(id < shapes.length) {\n            switch(gd._fullLayout.shapes[id].type) {\n                case 'rect':\n                    dragmode = 'drawrect';\n                    break;\n                case 'circle':\n                    dragmode = 'drawcircle';\n                    break;\n                case 'line':\n                    dragmode = 'drawline';\n                    break;\n                case 'path':\n                    var path = shapes[id].path || '';\n                    if(path[path.length - 1] === 'Z') {\n                        dragmode = 'drawclosedpath';\n                    } else {\n                        dragmode = 'drawopenpath';\n                    }\n                    break;\n            }\n        }\n    }\n\n    var isOpenMode = openMode(dragmode);\n\n    var polygons = readPaths(d, gd, plotinfo, isActiveShape);\n\n    var newShape = {\n        editable: true,\n\n        xref: xPaper ? 'paper' : xaxis._id,\n        yref: yPaper ? 'paper' : yaxis._id,\n\n        layer: drwStyle.layer,\n        opacity: drwStyle.opacity,\n        line: {\n            color: drwStyle.line.color,\n            width: drwStyle.line.width,\n            dash: drwStyle.line.dash\n        }\n    };\n\n    if(!isOpenMode) {\n        newShape.fillcolor = drwStyle.fillcolor;\n        newShape.fillrule = drwStyle.fillrule;\n    }\n\n    var cell;\n    // line, rect and circle can be in one cell\n    // only define cell if there is single cell\n    if(polygons.length === 1) cell = polygons[0];\n\n    if(\n        cell &&\n        dragmode === 'drawrect'\n    ) {\n        newShape.type = 'rect';\n        newShape.x0 = cell[0][1];\n        newShape.y0 = cell[0][2];\n        newShape.x1 = cell[2][1];\n        newShape.y1 = cell[2][2];\n    } else if(\n        cell &&\n        dragmode === 'drawline'\n    ) {\n        newShape.type = 'line';\n        newShape.x0 = cell[0][1];\n        newShape.y0 = cell[0][2];\n        newShape.x1 = cell[1][1];\n        newShape.y1 = cell[1][2];\n    } else if(\n        cell &&\n        dragmode === 'drawcircle'\n    ) {\n        newShape.type = 'circle'; // an ellipse!\n\n        var xA = cell[i000][1];\n        var xB = cell[i090][1];\n        var xC = cell[i180][1];\n        var xD = cell[i270][1];\n\n        var yA = cell[i000][2];\n        var yB = cell[i090][2];\n        var yC = cell[i180][2];\n        var yD = cell[i270][2];\n\n        var xDateOrLog = plotinfo.xaxis && (\n            plotinfo.xaxis.type === 'date' ||\n            plotinfo.xaxis.type === 'log'\n        );\n\n        var yDateOrLog = plotinfo.yaxis && (\n            plotinfo.yaxis.type === 'date' ||\n            plotinfo.yaxis.type === 'log'\n        );\n\n        if(xDateOrLog) {\n            xA = r2p(plotinfo.xaxis, xA);\n            xB = r2p(plotinfo.xaxis, xB);\n            xC = r2p(plotinfo.xaxis, xC);\n            xD = r2p(plotinfo.xaxis, xD);\n        }\n\n        if(yDateOrLog) {\n            yA = r2p(plotinfo.yaxis, yA);\n            yB = r2p(plotinfo.yaxis, yB);\n            yC = r2p(plotinfo.yaxis, yC);\n            yD = r2p(plotinfo.yaxis, yD);\n        }\n\n        var x0 = (xB + xD) / 2;\n        var y0 = (yA + yC) / 2;\n        var rx = (xD - xB + xC - xA) / 2;\n        var ry = (yD - yB + yC - yA) / 2;\n        var pos = ellipseOver({\n            x0: x0,\n            y0: y0,\n            x1: x0 + rx * cos45,\n            y1: y0 + ry * sin45\n        });\n\n        if(xDateOrLog) {\n            pos.x0 = p2r(plotinfo.xaxis, pos.x0);\n            pos.x1 = p2r(plotinfo.xaxis, pos.x1);\n        }\n\n        if(yDateOrLog) {\n            pos.y0 = p2r(plotinfo.yaxis, pos.y0);\n            pos.y1 = p2r(plotinfo.yaxis, pos.y1);\n        }\n\n        newShape.x0 = pos.x0;\n        newShape.y0 = pos.y0;\n        newShape.x1 = pos.x1;\n        newShape.y1 = pos.y1;\n    } else {\n        newShape.type = 'path';\n        if(xaxis && yaxis) fixDatesForPaths(polygons, xaxis, yaxis);\n        newShape.path = writePaths(polygons);\n        cell = null;\n    }\n\n    clearSelect(gd);\n\n    var editHelpers = dragOptions.editHelpers;\n    var modifyItem = (editHelpers || {}).modifyItem;\n\n    var allShapes = [];\n    for(var q = 0; q < shapes.length; q++) {\n        var beforeEdit = gd._fullLayout.shapes[q];\n        allShapes[q] = beforeEdit._input;\n\n        if(\n            isActiveShape !== undefined &&\n            q === gd._fullLayout._activeShapeIndex\n        ) {\n            var afterEdit = newShape;\n\n            switch(beforeEdit.type) {\n                case 'line':\n                case 'rect':\n                case 'circle':\n                    modifyItem('x0', afterEdit.x0);\n                    modifyItem('x1', afterEdit.x1);\n                    modifyItem('y0', afterEdit.y0);\n                    modifyItem('y1', afterEdit.y1);\n                    break;\n\n                case 'path':\n                    modifyItem('path', afterEdit.path);\n                    break;\n            }\n        }\n    }\n\n    if(isActiveShape === undefined) {\n        allShapes.push(newShape); // add new shape\n        return allShapes;\n    }\n\n    return editHelpers ? editHelpers.getUpdateObj() : {};\n};\n\nfunction fixDatesForPaths(polygons, xaxis, yaxis) {\n    var xIsDate = xaxis.type === 'date';\n    var yIsDate = yaxis.type === 'date';\n    if(!xIsDate && !yIsDate) return polygons;\n\n    for(var i = 0; i < polygons.length; i++) {\n        for(var j = 0; j < polygons[i].length; j++) {\n            for(var k = 0; k + 2 < polygons[i][j].length; k += 2) {\n                if(xIsDate) polygons[i][j][k + 1] = polygons[i][j][k + 1].replace(' ', '_');\n                if(yIsDate) polygons[i][j][k + 2] = polygons[i][j][k + 2].replace(' ', '_');\n            }\n        }\n    }\n\n    return polygons;\n}\n","'use strict';\n\nvar constants = require('./constants');\n\nvar Lib = require('../../lib');\n\n// special position conversion functions... category axis positions can't be\n// specified by their data values, because they don't make a continuous mapping.\n// so these have to be specified in terms of the category serial numbers,\n// but can take fractional values. Other axis types we specify position based on\n// the actual data values.\n// TODO: in V3.0 (when log axis ranges are in data units) range and shape position\n// will be identical, so rangeToShapePosition and shapePositionToRange can be\n// removed entirely.\n\nexports.rangeToShapePosition = function(ax) {\n    return (ax.type === 'log') ? ax.r2d : function(v) { return v; };\n};\n\nexports.shapePositionToRange = function(ax) {\n    return (ax.type === 'log') ? ax.d2r : function(v) { return v; };\n};\n\nexports.decodeDate = function(convertToPx) {\n    return function(v) {\n        if(v.replace) v = v.replace('_', ' ');\n        return convertToPx(v);\n    };\n};\n\nexports.encodeDate = function(convertToDate) {\n    return function(v) { return convertToDate(v).replace(' ', '_'); };\n};\n\nexports.extractPathCoords = function(path, paramsToUse) {\n    var extractedCoordinates = [];\n\n    var segments = path.match(constants.segmentRE);\n    segments.forEach(function(segment) {\n        var relevantParamIdx = paramsToUse[segment.charAt(0)].drawn;\n        if(relevantParamIdx === undefined) return;\n\n        var params = segment.substr(1).match(constants.paramRE);\n        if(!params || params.length < relevantParamIdx) return;\n\n        extractedCoordinates.push(Lib.cleanNumber(params[relevantParamIdx]));\n    });\n\n    return extractedCoordinates;\n};\n\nexports.getDataToPixel = function(gd, axis, isVertical, refType) {\n    var gs = gd._fullLayout._size;\n    var dataToPixel;\n\n    if(axis) {\n        if(refType === 'domain') {\n            dataToPixel = function(v) {\n                return axis._length * (isVertical ? (1 - v) : v) + axis._offset;\n            };\n        } else {\n            var d2r = exports.shapePositionToRange(axis);\n\n            dataToPixel = function(v) {\n                return axis._offset + axis.r2p(d2r(v, true));\n            };\n\n            if(axis.type === 'date') dataToPixel = exports.decodeDate(dataToPixel);\n        }\n    } else if(isVertical) {\n        dataToPixel = function(v) { return gs.t + gs.h * (1 - v); };\n    } else {\n        dataToPixel = function(v) { return gs.l + gs.w * v; };\n    }\n\n    return dataToPixel;\n};\n\nexports.getPixelToData = function(gd, axis, isVertical, opt) {\n    var gs = gd._fullLayout._size;\n    var pixelToData;\n\n    if(axis) {\n        if(opt === 'domain') {\n            pixelToData = function(p) {\n                var q = (p - axis._offset) / axis._length;\n                return isVertical ? 1 - q : q;\n            };\n        } else {\n            var r2d = exports.rangeToShapePosition(axis);\n            pixelToData = function(p) { return r2d(axis.p2r(p - axis._offset)); };\n        }\n    } else if(isVertical) {\n        pixelToData = function(p) { return 1 - (p - gs.t) / gs.h; };\n    } else {\n        pixelToData = function(p) { return (p - gs.l) / gs.w; };\n    }\n\n    return pixelToData;\n};\n\n/**\n * Based on the given stroke width, rounds the passed\n * position value to represent either a full or half pixel.\n *\n * In case of an odd stroke width (e.g. 1), this measure ensures\n * that a stroke positioned at the returned position isn't rendered\n * blurry due to anti-aliasing.\n *\n * In case of an even stroke width (e.g. 2), this measure ensures\n * that the position value is transformed to a full pixel value\n * so that anti-aliasing doesn't take effect either.\n *\n * @param {number} pos The raw position value to be transformed\n * @param {number} strokeWidth The stroke width\n * @returns {number} either an integer or a .5 decimal number\n */\nexports.roundPositionForSharpStrokeRendering = function(pos, strokeWidth) {\n    var strokeWidthIsOdd = Math.round(strokeWidth % 2) === 1;\n    var posValAsInt = Math.round(pos);\n\n    return strokeWidthIsOdd ? posValAsInt + 0.5 : posValAsInt;\n};\n\nexports.makeOptionsAndPlotinfo = function(gd, index) {\n    var options = gd._fullLayout.shapes[index] || {};\n\n    var plotinfo = gd._fullLayout._plots[options.xref + options.yref];\n    var hasPlotinfo = !!plotinfo;\n    if(hasPlotinfo) {\n        plotinfo._hadPlotinfo = true;\n    } else {\n        plotinfo = {};\n        if(options.xref && options.xref !== 'paper') plotinfo.xaxis = gd._fullLayout[options.xref + 'axis'];\n        if(options.yref && options.yref !== 'paper') plotinfo.yaxis = gd._fullLayout[options.yref + 'axis'];\n    }\n\n    plotinfo.xsizemode = options.xsizemode;\n    plotinfo.ysizemode = options.ysizemode;\n    plotinfo.xanchor = options.xanchor;\n    plotinfo.yanchor = options.yanchor;\n\n    return {\n        options: options,\n        plotinfo: plotinfo\n    };\n};\n","'use strict';\n\nvar drawModule = require('./draw');\n\nmodule.exports = {\n    moduleType: 'component',\n    name: 'shapes',\n\n    layoutAttributes: require('./attributes'),\n    supplyLayoutDefaults: require('./defaults'),\n    supplyDrawNewShapeDefaults: require('./draw_newshape/defaults'),\n    includeBasePlot: require('../../plots/cartesian/include_components')('shapes'),\n\n    calcAutorange: require('./calc_autorange'),\n    draw: drawModule.draw,\n    drawOne: drawModule.drawOne\n};\n","'use strict';\n\nvar fontAttrs = require('../../plots/font_attributes');\nvar padAttrs = require('../../plots/pad_attributes');\nvar extendDeepAll = require('../../lib/extend').extendDeepAll;\nvar overrideAll = require('../../plot_api/edit_types').overrideAll;\nvar animationAttrs = require('../../plots/animation_attributes');\nvar templatedArray = require('../../plot_api/plot_template').templatedArray;\nvar constants = require('./constants');\n\nvar stepsAttrs = templatedArray('step', {\n    visible: {\n        valType: 'boolean',\n        dflt: true,\n        description: [\n            'Determines whether or not this step is included in the slider.'\n        ].join(' ')\n    },\n    method: {\n        valType: 'enumerated',\n        values: ['restyle', 'relayout', 'animate', 'update', 'skip'],\n        dflt: 'restyle',\n        description: [\n            'Sets the Plotly method to be called when the slider value is changed.',\n            'If the `skip` method is used, the API slider will function as normal',\n            'but will perform no API calls and will not bind automatically to state',\n            'updates. This may be used to create a component interface and attach to',\n            'slider events manually via JavaScript.'\n        ].join(' ')\n    },\n    args: {\n        valType: 'info_array',\n        freeLength: true,\n        items: [\n            { valType: 'any' },\n            { valType: 'any' },\n            { valType: 'any' }\n        ],\n        description: [\n            'Sets the arguments values to be passed to the Plotly',\n            'method set in `method` on slide.'\n        ].join(' ')\n    },\n    label: {\n        valType: 'string',\n        description: 'Sets the text label to appear on the slider'\n    },\n    value: {\n        valType: 'string',\n        description: [\n            'Sets the value of the slider step, used to refer to the step programatically.',\n            'Defaults to the slider label if not provided.'\n        ].join(' ')\n    },\n    execute: {\n        valType: 'boolean',\n        dflt: true,\n        description: [\n            'When true, the API method is executed. When false, all other behaviors are the same',\n            'and command execution is skipped. This may be useful when hooking into, for example,',\n            'the `plotly_sliderchange` method and executing the API command manually without losing',\n            'the benefit of the slider automatically binding to the state of the plot through the',\n            'specification of `method` and `args`.'\n        ].join(' ')\n    }\n});\n\nmodule.exports = overrideAll(templatedArray('slider', {\n    visible: {\n        valType: 'boolean',\n        dflt: true,\n        description: [\n            'Determines whether or not the slider is visible.'\n        ].join(' ')\n    },\n\n    active: {\n        valType: 'number',\n        min: 0,\n        dflt: 0,\n        description: [\n            'Determines which button (by index starting from 0) is',\n            'considered active.'\n        ].join(' ')\n    },\n\n    steps: stepsAttrs,\n\n    lenmode: {\n        valType: 'enumerated',\n        values: ['fraction', 'pixels'],\n        dflt: 'fraction',\n        description: [\n            'Determines whether this slider length',\n            'is set in units of plot *fraction* or in *pixels.',\n            'Use `len` to set the value.'\n        ].join(' ')\n    },\n    len: {\n        valType: 'number',\n        min: 0,\n        dflt: 1,\n        description: [\n            'Sets the length of the slider',\n            'This measure excludes the padding of both ends.',\n            'That is, the slider\\'s length is this length minus the',\n            'padding on both ends.'\n        ].join(' ')\n    },\n    x: {\n        valType: 'number',\n        min: -2,\n        max: 3,\n        dflt: 0,\n        description: 'Sets the x position (in normalized coordinates) of the slider.'\n    },\n    pad: extendDeepAll(padAttrs({editType: 'arraydraw'}), {\n        description: 'Set the padding of the slider component along each side.'\n    }, {t: {dflt: 20}}),\n    xanchor: {\n        valType: 'enumerated',\n        values: ['auto', 'left', 'center', 'right'],\n        dflt: 'left',\n        description: [\n            'Sets the slider\\'s horizontal position anchor.',\n            'This anchor binds the `x` position to the *left*, *center*',\n            'or *right* of the range selector.'\n        ].join(' ')\n    },\n    y: {\n        valType: 'number',\n        min: -2,\n        max: 3,\n        dflt: 0,\n        description: 'Sets the y position (in normalized coordinates) of the slider.'\n    },\n    yanchor: {\n        valType: 'enumerated',\n        values: ['auto', 'top', 'middle', 'bottom'],\n        dflt: 'top',\n        description: [\n            'Sets the slider\\'s vertical position anchor',\n            'This anchor binds the `y` position to the *top*, *middle*',\n            'or *bottom* of the range selector.'\n        ].join(' ')\n    },\n\n    transition: {\n        duration: {\n            valType: 'number',\n            min: 0,\n            dflt: 150,\n            description: 'Sets the duration of the slider transition'\n        },\n        easing: {\n            valType: 'enumerated',\n            values: animationAttrs.transition.easing.values,\n            dflt: 'cubic-in-out',\n            description: 'Sets the easing function of the slider transition'\n        }\n    },\n\n    currentvalue: {\n        visible: {\n            valType: 'boolean',\n            dflt: true,\n            description: [\n                'Shows the currently-selected value above the slider.'\n            ].join(' ')\n        },\n\n        xanchor: {\n            valType: 'enumerated',\n            values: ['left', 'center', 'right'],\n            dflt: 'left',\n            description: [\n                'The alignment of the value readout relative to the length of the slider.'\n            ].join(' ')\n        },\n\n        offset: {\n            valType: 'number',\n            dflt: 10,\n            description: [\n                'The amount of space, in pixels, between the current value label',\n                'and the slider.'\n            ].join(' ')\n        },\n\n        prefix: {\n            valType: 'string',\n            description: 'When currentvalue.visible is true, this sets the prefix of the label.'\n        },\n\n        suffix: {\n            valType: 'string',\n            description: 'When currentvalue.visible is true, this sets the suffix of the label.'\n        },\n\n        font: fontAttrs({\n            description: 'Sets the font of the current value label text.'\n        })\n    },\n\n    font: fontAttrs({\n        description: 'Sets the font of the slider step labels.'\n    }),\n\n    activebgcolor: {\n        valType: 'color',\n        dflt: constants.gripBgActiveColor,\n        description: [\n            'Sets the background color of the slider grip',\n            'while dragging.'\n        ].join(' ')\n    },\n    bgcolor: {\n        valType: 'color',\n        dflt: constants.railBgColor,\n        description: 'Sets the background color of the slider.'\n    },\n    bordercolor: {\n        valType: 'color',\n        dflt: constants.railBorderColor,\n        description: 'Sets the color of the border enclosing the slider.'\n    },\n    borderwidth: {\n        valType: 'number',\n        min: 0,\n        dflt: constants.railBorderWidth,\n        description: 'Sets the width (in px) of the border enclosing the slider.'\n    },\n    ticklen: {\n        valType: 'number',\n        min: 0,\n        dflt: constants.tickLength,\n        description: 'Sets the length in pixels of step tick marks'\n    },\n    tickcolor: {\n        valType: 'color',\n        dflt: constants.tickColor,\n        description: 'Sets the color of the border enclosing the slider.'\n    },\n    tickwidth: {\n        valType: 'number',\n        min: 0,\n        dflt: 1,\n        description: 'Sets the tick width (in px).'\n    },\n    minorticklen: {\n        valType: 'number',\n        min: 0,\n        dflt: constants.minorTickLength,\n        description: 'Sets the length in pixels of minor step tick marks'\n    }\n}), 'arraydraw', 'from-root');\n","'use strict';\n\n\nmodule.exports = {\n\n    // layout attribute name\n    name: 'sliders',\n\n    // class names\n    containerClassName: 'slider-container',\n    groupClassName: 'slider-group',\n    inputAreaClass: 'slider-input-area',\n    railRectClass: 'slider-rail-rect',\n    railTouchRectClass: 'slider-rail-touch-rect',\n    gripRectClass: 'slider-grip-rect',\n    tickRectClass: 'slider-tick-rect',\n    inputProxyClass: 'slider-input-proxy',\n    labelsClass: 'slider-labels',\n    labelGroupClass: 'slider-label-group',\n    labelClass: 'slider-label',\n    currentValueClass: 'slider-current-value',\n\n    railHeight: 5,\n\n    // DOM attribute name in button group keeping track\n    // of active update menu\n    menuIndexAttrName: 'slider-active-index',\n\n    // id root pass to Plots.autoMargin\n    autoMarginIdRoot: 'slider-',\n\n    // min item width / height\n    minWidth: 30,\n    minHeight: 30,\n\n    // padding around item text\n    textPadX: 40,\n\n    // arrow offset off right edge\n    arrowOffsetX: 4,\n\n    railRadius: 2,\n    railWidth: 5,\n    railBorder: 4,\n    railBorderWidth: 1,\n    railBorderColor: '#bec8d9',\n    railBgColor: '#f8fafc',\n\n    // The distance of the rail from the edge of the touchable area\n    // Slightly less than the step inset because of the curved edges\n    // of the rail\n    railInset: 8,\n\n    // The distance from the extremal tick marks to the edge of the\n    // touchable area. This is basically the same as the grip radius,\n    // but for other styles it wouldn't really need to be.\n    stepInset: 10,\n\n    gripRadius: 10,\n    gripWidth: 20,\n    gripHeight: 20,\n    gripBorder: 20,\n    gripBorderWidth: 1,\n    gripBorderColor: '#bec8d9',\n    gripBgColor: '#f6f8fa',\n    gripBgActiveColor: '#dbdde0',\n\n    labelPadding: 8,\n    labelOffset: 0,\n\n    tickWidth: 1,\n    tickColor: '#333',\n    tickOffset: 25,\n    tickLength: 7,\n\n    minorTickOffset: 25,\n    minorTickColor: '#333',\n    minorTickLength: 4,\n\n    // Extra space below the current value label:\n    currentValuePadding: 8,\n    currentValueInset: 0,\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar handleArrayContainerDefaults = require('../../plots/array_container_defaults');\n\nvar attributes = require('./attributes');\nvar constants = require('./constants');\n\nvar name = constants.name;\nvar stepAttrs = attributes.steps;\n\n\nmodule.exports = function slidersDefaults(layoutIn, layoutOut) {\n    handleArrayContainerDefaults(layoutIn, layoutOut, {\n        name: name,\n        handleItemDefaults: sliderDefaults\n    });\n};\n\nfunction sliderDefaults(sliderIn, sliderOut, layoutOut) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(sliderIn, sliderOut, attributes, attr, dflt);\n    }\n\n    var steps = handleArrayContainerDefaults(sliderIn, sliderOut, {\n        name: 'steps',\n        handleItemDefaults: stepDefaults\n    });\n\n    var stepCount = 0;\n    for(var i = 0; i < steps.length; i++) {\n        if(steps[i].visible) stepCount++;\n    }\n\n    var visible;\n    // If it has fewer than two options, it's not really a slider\n    if(stepCount < 2) visible = sliderOut.visible = false;\n    else visible = coerce('visible');\n    if(!visible) return;\n\n    sliderOut._stepCount = stepCount;\n    var visSteps = sliderOut._visibleSteps = Lib.filterVisible(steps);\n\n    var active = coerce('active');\n    if(!(steps[active] || {}).visible) sliderOut.active = visSteps[0]._index;\n\n    coerce('x');\n    coerce('y');\n    Lib.noneOrAll(sliderIn, sliderOut, ['x', 'y']);\n\n    coerce('xanchor');\n    coerce('yanchor');\n\n    coerce('len');\n    coerce('lenmode');\n\n    coerce('pad.t');\n    coerce('pad.r');\n    coerce('pad.b');\n    coerce('pad.l');\n\n    Lib.coerceFont(coerce, 'font', layoutOut.font);\n\n    var currentValueIsVisible = coerce('currentvalue.visible');\n\n    if(currentValueIsVisible) {\n        coerce('currentvalue.xanchor');\n        coerce('currentvalue.prefix');\n        coerce('currentvalue.suffix');\n        coerce('currentvalue.offset');\n\n        Lib.coerceFont(coerce, 'currentvalue.font', sliderOut.font);\n    }\n\n    coerce('transition.duration');\n    coerce('transition.easing');\n\n    coerce('bgcolor');\n    coerce('activebgcolor');\n    coerce('bordercolor');\n    coerce('borderwidth');\n    coerce('ticklen');\n    coerce('tickwidth');\n    coerce('tickcolor');\n    coerce('minorticklen');\n}\n\nfunction stepDefaults(valueIn, valueOut) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(valueIn, valueOut, stepAttrs, attr, dflt);\n    }\n\n    var visible;\n    if(valueIn.method !== 'skip' && !Array.isArray(valueIn.args)) {\n        visible = valueOut.visible = false;\n    } else visible = coerce('visible');\n\n    if(visible) {\n        coerce('method');\n        coerce('args');\n        var label = coerce('label', 'step-' + valueOut._index);\n        coerce('value', label);\n        coerce('execute');\n    }\n}\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Plots = require('../../plots/plots');\nvar Color = require('../color');\nvar Drawing = require('../drawing');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar arrayEditor = require('../../plot_api/plot_template').arrayEditor;\n\nvar constants = require('./constants');\nvar alignmentConstants = require('../../constants/alignment');\nvar LINE_SPACING = alignmentConstants.LINE_SPACING;\nvar FROM_TL = alignmentConstants.FROM_TL;\nvar FROM_BR = alignmentConstants.FROM_BR;\n\nmodule.exports = function draw(gd) {\n    var fullLayout = gd._fullLayout;\n    var sliderData = makeSliderData(fullLayout, gd);\n\n    // draw a container for *all* sliders:\n    var sliders = fullLayout._infolayer\n        .selectAll('g.' + constants.containerClassName)\n        .data(sliderData.length > 0 ? [0] : []);\n\n    sliders.enter().append('g')\n        .classed(constants.containerClassName, true)\n        .style('cursor', 'ew-resize');\n\n    function clearSlider(sliderOpts) {\n        if(sliderOpts._commandObserver) {\n            sliderOpts._commandObserver.remove();\n            delete sliderOpts._commandObserver;\n        }\n\n        // Most components don't need to explicitly remove autoMargin, because\n        // marginPushers does this - but slider updates don't go through\n        // a full replot so we need to explicitly remove it.\n        Plots.autoMargin(gd, autoMarginId(sliderOpts));\n    }\n\n    sliders.exit().each(function() {\n        d3.select(this).selectAll('g.' + constants.groupClassName)\n            .each(clearSlider);\n    })\n    .remove();\n\n    // Return early if no menus visible:\n    if(sliderData.length === 0) return;\n\n    var sliderGroups = sliders.selectAll('g.' + constants.groupClassName)\n        .data(sliderData, keyFunction);\n\n    sliderGroups.enter().append('g')\n        .classed(constants.groupClassName, true);\n\n    sliderGroups.exit()\n        .each(clearSlider)\n        .remove();\n\n    // Find the dimensions of the sliders:\n    for(var i = 0; i < sliderData.length; i++) {\n        var sliderOpts = sliderData[i];\n        findDimensions(gd, sliderOpts);\n    }\n\n    sliderGroups.each(function(sliderOpts) {\n        var gSlider = d3.select(this);\n\n        computeLabelSteps(sliderOpts);\n\n        Plots.manageCommandObserver(gd, sliderOpts, sliderOpts._visibleSteps, function(data) {\n            // NB: Same as below. This is *not* always the same as sliderOpts since\n            // if a new set of steps comes in, the reference in this callback would\n            // be invalid. We need to refetch it from the slider group, which is\n            // the join data that creates this slider. So if this slider still exists,\n            // the group should be valid, *to the best of my knowledge.* If not,\n            // we'd have to look it up by d3 data join index/key.\n            var opts = gSlider.data()[0];\n\n            if(opts.active === data.index) return;\n            if(opts._dragging) return;\n\n            setActive(gd, gSlider, opts, data.index, false, true);\n        });\n\n        drawSlider(gd, d3.select(this), sliderOpts);\n    });\n};\n\nfunction autoMarginId(sliderOpts) {\n    return constants.autoMarginIdRoot + sliderOpts._index;\n}\n\n// This really only just filters by visibility:\nfunction makeSliderData(fullLayout, gd) {\n    var contOpts = fullLayout[constants.name];\n    var sliderData = [];\n\n    for(var i = 0; i < contOpts.length; i++) {\n        var item = contOpts[i];\n        if(!item.visible) continue;\n        item._gd = gd;\n        sliderData.push(item);\n    }\n\n    return sliderData;\n}\n\n// This is set in the defaults step:\nfunction keyFunction(opts) {\n    return opts._index;\n}\n\n// Compute the dimensions (mutates sliderOpts):\nfunction findDimensions(gd, sliderOpts) {\n    var sliderLabels = Drawing.tester.selectAll('g.' + constants.labelGroupClass)\n        .data(sliderOpts._visibleSteps);\n\n    sliderLabels.enter().append('g')\n        .classed(constants.labelGroupClass, true);\n\n    // loop over fake buttons to find width / height\n    var maxLabelWidth = 0;\n    var labelHeight = 0;\n    sliderLabels.each(function(stepOpts) {\n        var labelGroup = d3.select(this);\n\n        var text = drawLabel(labelGroup, {step: stepOpts}, sliderOpts);\n\n        var textNode = text.node();\n        if(textNode) {\n            var bBox = Drawing.bBox(textNode);\n            labelHeight = Math.max(labelHeight, bBox.height);\n            maxLabelWidth = Math.max(maxLabelWidth, bBox.width);\n        }\n    });\n\n    sliderLabels.remove();\n\n    var dims = sliderOpts._dims = {};\n\n    dims.inputAreaWidth = Math.max(\n        constants.railWidth,\n        constants.gripHeight\n    );\n\n    // calculate some overall dimensions - some of these are needed for\n    // calculating the currentValue dimensions\n    var graphSize = gd._fullLayout._size;\n    dims.lx = graphSize.l + graphSize.w * sliderOpts.x;\n    dims.ly = graphSize.t + graphSize.h * (1 - sliderOpts.y);\n\n    if(sliderOpts.lenmode === 'fraction') {\n        // fraction:\n        dims.outerLength = Math.round(graphSize.w * sliderOpts.len);\n    } else {\n        // pixels:\n        dims.outerLength = sliderOpts.len;\n    }\n\n    // The length of the rail, *excluding* padding on either end:\n    dims.inputAreaStart = 0;\n    dims.inputAreaLength = Math.round(dims.outerLength - sliderOpts.pad.l - sliderOpts.pad.r);\n\n    var textableInputLength = dims.inputAreaLength - 2 * constants.stepInset;\n    var availableSpacePerLabel = textableInputLength / (sliderOpts._stepCount - 1);\n    var computedSpacePerLabel = maxLabelWidth + constants.labelPadding;\n    dims.labelStride = Math.max(1, Math.ceil(computedSpacePerLabel / availableSpacePerLabel));\n    dims.labelHeight = labelHeight;\n\n    // loop over all possible values for currentValue to find the\n    // area we need for it\n    dims.currentValueMaxWidth = 0;\n    dims.currentValueHeight = 0;\n    dims.currentValueTotalHeight = 0;\n    dims.currentValueMaxLines = 1;\n\n    if(sliderOpts.currentvalue.visible) {\n        // Get the dimensions of the current value label:\n        var dummyGroup = Drawing.tester.append('g');\n\n        sliderLabels.each(function(stepOpts) {\n            var curValPrefix = drawCurrentValue(dummyGroup, sliderOpts, stepOpts.label);\n            var curValSize = (curValPrefix.node() && Drawing.bBox(curValPrefix.node())) || {width: 0, height: 0};\n            var lines = svgTextUtils.lineCount(curValPrefix);\n            dims.currentValueMaxWidth = Math.max(dims.currentValueMaxWidth, Math.ceil(curValSize.width));\n            dims.currentValueHeight = Math.max(dims.currentValueHeight, Math.ceil(curValSize.height));\n            dims.currentValueMaxLines = Math.max(dims.currentValueMaxLines, lines);\n        });\n\n        dims.currentValueTotalHeight = dims.currentValueHeight + sliderOpts.currentvalue.offset;\n\n        dummyGroup.remove();\n    }\n\n    dims.height = dims.currentValueTotalHeight + constants.tickOffset + sliderOpts.ticklen + constants.labelOffset + dims.labelHeight + sliderOpts.pad.t + sliderOpts.pad.b;\n\n    var xanchor = 'left';\n    if(Lib.isRightAnchor(sliderOpts)) {\n        dims.lx -= dims.outerLength;\n        xanchor = 'right';\n    }\n    if(Lib.isCenterAnchor(sliderOpts)) {\n        dims.lx -= dims.outerLength / 2;\n        xanchor = 'center';\n    }\n\n    var yanchor = 'top';\n    if(Lib.isBottomAnchor(sliderOpts)) {\n        dims.ly -= dims.height;\n        yanchor = 'bottom';\n    }\n    if(Lib.isMiddleAnchor(sliderOpts)) {\n        dims.ly -= dims.height / 2;\n        yanchor = 'middle';\n    }\n\n    dims.outerLength = Math.ceil(dims.outerLength);\n    dims.height = Math.ceil(dims.height);\n    dims.lx = Math.round(dims.lx);\n    dims.ly = Math.round(dims.ly);\n\n    var marginOpts = {\n        y: sliderOpts.y,\n        b: dims.height * FROM_BR[yanchor],\n        t: dims.height * FROM_TL[yanchor]\n    };\n\n    if(sliderOpts.lenmode === 'fraction') {\n        marginOpts.l = 0;\n        marginOpts.xl = sliderOpts.x - sliderOpts.len * FROM_TL[xanchor];\n        marginOpts.r = 0;\n        marginOpts.xr = sliderOpts.x + sliderOpts.len * FROM_BR[xanchor];\n    } else {\n        marginOpts.x = sliderOpts.x;\n        marginOpts.l = dims.outerLength * FROM_TL[xanchor];\n        marginOpts.r = dims.outerLength * FROM_BR[xanchor];\n    }\n\n    Plots.autoMargin(gd, autoMarginId(sliderOpts), marginOpts);\n}\n\nfunction drawSlider(gd, sliderGroup, sliderOpts) {\n    // This is related to the other long notes in this file regarding what happens\n    // when slider steps disappear. This particular fix handles what happens when\n    // the *current* slider step is removed. The drawing functions will error out\n    // when they fail to find it, so the fix for now is that it will just draw the\n    // slider in the first position but will not execute the command.\n    if(!((sliderOpts.steps[sliderOpts.active] || {}).visible)) {\n        sliderOpts.active = sliderOpts._visibleSteps[0]._index;\n    }\n\n    // These are carefully ordered for proper z-ordering:\n    sliderGroup\n        .call(drawCurrentValue, sliderOpts)\n        .call(drawRail, sliderOpts)\n        .call(drawLabelGroup, sliderOpts)\n        .call(drawTicks, sliderOpts)\n        .call(drawTouchRect, gd, sliderOpts)\n        .call(drawGrip, gd, sliderOpts);\n\n    var dims = sliderOpts._dims;\n\n    // Position the rectangle:\n    Drawing.setTranslate(sliderGroup, dims.lx + sliderOpts.pad.l, dims.ly + sliderOpts.pad.t);\n\n    sliderGroup.call(setGripPosition, sliderOpts, false);\n    sliderGroup.call(drawCurrentValue, sliderOpts);\n}\n\nfunction drawCurrentValue(sliderGroup, sliderOpts, valueOverride) {\n    if(!sliderOpts.currentvalue.visible) return;\n\n    var dims = sliderOpts._dims;\n    var x0, textAnchor;\n\n    switch(sliderOpts.currentvalue.xanchor) {\n        case 'right':\n            // This is anchored left and adjusted by the width of the longest label\n            // so that the prefix doesn't move. The goal of this is to emphasize\n            // what's actually changing and make the update less distracting.\n            x0 = dims.inputAreaLength - constants.currentValueInset - dims.currentValueMaxWidth;\n            textAnchor = 'left';\n            break;\n        case 'center':\n            x0 = dims.inputAreaLength * 0.5;\n            textAnchor = 'middle';\n            break;\n        default:\n            x0 = constants.currentValueInset;\n            textAnchor = 'left';\n    }\n\n    var text = Lib.ensureSingle(sliderGroup, 'text', constants.labelClass, function(s) {\n        s.attr({\n            'text-anchor': textAnchor,\n            'data-notex': 1\n        });\n    });\n\n    var str = sliderOpts.currentvalue.prefix ? sliderOpts.currentvalue.prefix : '';\n\n    if(typeof valueOverride === 'string') {\n        str += valueOverride;\n    } else {\n        var curVal = sliderOpts.steps[sliderOpts.active].label;\n        var _meta = sliderOpts._gd._fullLayout._meta;\n        if(_meta) curVal = Lib.templateString(curVal, _meta);\n        str += curVal;\n    }\n\n    if(sliderOpts.currentvalue.suffix) {\n        str += sliderOpts.currentvalue.suffix;\n    }\n\n    text.call(Drawing.font, sliderOpts.currentvalue.font)\n        .text(str)\n        .call(svgTextUtils.convertToTspans, sliderOpts._gd);\n\n    var lines = svgTextUtils.lineCount(text);\n\n    var y0 = (dims.currentValueMaxLines + 1 - lines) *\n        sliderOpts.currentvalue.font.size * LINE_SPACING;\n\n    svgTextUtils.positionText(text, x0, y0);\n\n    return text;\n}\n\nfunction drawGrip(sliderGroup, gd, sliderOpts) {\n    var grip = Lib.ensureSingle(sliderGroup, 'rect', constants.gripRectClass, function(s) {\n        s.call(attachGripEvents, gd, sliderGroup, sliderOpts)\n            .style('pointer-events', 'all');\n    });\n\n    grip.attr({\n        width: constants.gripWidth,\n        height: constants.gripHeight,\n        rx: constants.gripRadius,\n        ry: constants.gripRadius,\n    })\n    .call(Color.stroke, sliderOpts.bordercolor)\n    .call(Color.fill, sliderOpts.bgcolor)\n    .style('stroke-width', sliderOpts.borderwidth + 'px');\n}\n\nfunction drawLabel(item, data, sliderOpts) {\n    var text = Lib.ensureSingle(item, 'text', constants.labelClass, function(s) {\n        s.attr({\n            'text-anchor': 'middle',\n            'data-notex': 1\n        });\n    });\n\n    var tx = data.step.label;\n    var _meta = sliderOpts._gd._fullLayout._meta;\n    if(_meta) tx = Lib.templateString(tx, _meta);\n\n    text.call(Drawing.font, sliderOpts.font)\n        .text(tx)\n        .call(svgTextUtils.convertToTspans, sliderOpts._gd);\n\n    return text;\n}\n\nfunction drawLabelGroup(sliderGroup, sliderOpts) {\n    var labels = Lib.ensureSingle(sliderGroup, 'g', constants.labelsClass);\n    var dims = sliderOpts._dims;\n\n    var labelItems = labels.selectAll('g.' + constants.labelGroupClass)\n        .data(dims.labelSteps);\n\n    labelItems.enter().append('g')\n        .classed(constants.labelGroupClass, true);\n\n    labelItems.exit().remove();\n\n    labelItems.each(function(d) {\n        var item = d3.select(this);\n\n        item.call(drawLabel, d, sliderOpts);\n\n        Drawing.setTranslate(item,\n            normalizedValueToPosition(sliderOpts, d.fraction),\n            constants.tickOffset +\n                sliderOpts.ticklen +\n                // position is the baseline of the top line of text only, even\n                // if the label spans multiple lines\n                sliderOpts.font.size * LINE_SPACING +\n                constants.labelOffset +\n                dims.currentValueTotalHeight\n        );\n    });\n}\n\nfunction handleInput(gd, sliderGroup, sliderOpts, normalizedPosition, doTransition) {\n    var quantizedPosition = Math.round(normalizedPosition * (sliderOpts._stepCount - 1));\n    var quantizedIndex = sliderOpts._visibleSteps[quantizedPosition]._index;\n\n    if(quantizedIndex !== sliderOpts.active) {\n        setActive(gd, sliderGroup, sliderOpts, quantizedIndex, true, doTransition);\n    }\n}\n\nfunction setActive(gd, sliderGroup, sliderOpts, index, doCallback, doTransition) {\n    var previousActive = sliderOpts.active;\n    sliderOpts.active = index;\n\n    // due to templating, it's possible this slider doesn't even exist yet\n    arrayEditor(gd.layout, constants.name, sliderOpts)\n        .applyUpdate('active', index);\n\n    var step = sliderOpts.steps[sliderOpts.active];\n\n    sliderGroup.call(setGripPosition, sliderOpts, doTransition);\n    sliderGroup.call(drawCurrentValue, sliderOpts);\n\n    gd.emit('plotly_sliderchange', {\n        slider: sliderOpts,\n        step: sliderOpts.steps[sliderOpts.active],\n        interaction: doCallback,\n        previousActive: previousActive\n    });\n\n    if(step && step.method && doCallback) {\n        if(sliderGroup._nextMethod) {\n            // If we've already queued up an update, just overwrite it with the most recent:\n            sliderGroup._nextMethod.step = step;\n            sliderGroup._nextMethod.doCallback = doCallback;\n            sliderGroup._nextMethod.doTransition = doTransition;\n        } else {\n            sliderGroup._nextMethod = {step: step, doCallback: doCallback, doTransition: doTransition};\n            sliderGroup._nextMethodRaf = window.requestAnimationFrame(function() {\n                var _step = sliderGroup._nextMethod.step;\n                if(!_step.method) return;\n\n                if(_step.execute) {\n                    Plots.executeAPICommand(gd, _step.method, _step.args);\n                }\n\n                sliderGroup._nextMethod = null;\n                sliderGroup._nextMethodRaf = null;\n            });\n        }\n    }\n}\n\nfunction attachGripEvents(item, gd, sliderGroup) {\n    var node = sliderGroup.node();\n    var $gd = d3.select(gd);\n\n    // NB: This is *not* the same as sliderOpts itself! These callbacks\n    // are in a closure so this array won't actually be correct if the\n    // steps have changed since this was initialized. The sliderGroup,\n    // however, has not changed since that *is* the slider, so it must\n    // be present to receive mouse events.\n    function getSliderOpts() {\n        return sliderGroup.data()[0];\n    }\n\n    item.on('mousedown', function() {\n        var sliderOpts = getSliderOpts();\n        gd.emit('plotly_sliderstart', {slider: sliderOpts});\n\n        var grip = sliderGroup.select('.' + constants.gripRectClass);\n\n        d3.event.stopPropagation();\n        d3.event.preventDefault();\n        grip.call(Color.fill, sliderOpts.activebgcolor);\n\n        var normalizedPosition = positionToNormalizedValue(sliderOpts, d3.mouse(node)[0]);\n        handleInput(gd, sliderGroup, sliderOpts, normalizedPosition, true);\n        sliderOpts._dragging = true;\n\n        $gd.on('mousemove', function() {\n            var sliderOpts = getSliderOpts();\n            var normalizedPosition = positionToNormalizedValue(sliderOpts, d3.mouse(node)[0]);\n            handleInput(gd, sliderGroup, sliderOpts, normalizedPosition, false);\n        });\n\n        $gd.on('mouseup', function() {\n            var sliderOpts = getSliderOpts();\n            sliderOpts._dragging = false;\n            grip.call(Color.fill, sliderOpts.bgcolor);\n            $gd.on('mouseup', null);\n            $gd.on('mousemove', null);\n\n            gd.emit('plotly_sliderend', {\n                slider: sliderOpts,\n                step: sliderOpts.steps[sliderOpts.active]\n            });\n        });\n    });\n}\n\nfunction drawTicks(sliderGroup, sliderOpts) {\n    var tick = sliderGroup.selectAll('rect.' + constants.tickRectClass)\n        .data(sliderOpts._visibleSteps);\n    var dims = sliderOpts._dims;\n\n    tick.enter().append('rect')\n        .classed(constants.tickRectClass, true);\n\n    tick.exit().remove();\n\n    tick.attr({\n        width: sliderOpts.tickwidth + 'px',\n        'shape-rendering': 'crispEdges'\n    });\n\n    tick.each(function(d, i) {\n        var isMajor = i % dims.labelStride === 0;\n        var item = d3.select(this);\n\n        item\n            .attr({height: isMajor ? sliderOpts.ticklen : sliderOpts.minorticklen})\n            .call(Color.fill, isMajor ? sliderOpts.tickcolor : sliderOpts.tickcolor);\n\n        Drawing.setTranslate(item,\n            normalizedValueToPosition(sliderOpts, i / (sliderOpts._stepCount - 1)) - 0.5 * sliderOpts.tickwidth,\n            (isMajor ? constants.tickOffset : constants.minorTickOffset) + dims.currentValueTotalHeight\n        );\n    });\n}\n\nfunction computeLabelSteps(sliderOpts) {\n    var dims = sliderOpts._dims;\n    dims.labelSteps = [];\n    var nsteps = sliderOpts._stepCount;\n\n    for(var i = 0; i < nsteps; i += dims.labelStride) {\n        dims.labelSteps.push({\n            fraction: i / (nsteps - 1),\n            step: sliderOpts._visibleSteps[i]\n        });\n    }\n}\n\nfunction setGripPosition(sliderGroup, sliderOpts, doTransition) {\n    var grip = sliderGroup.select('rect.' + constants.gripRectClass);\n\n    var quantizedIndex = 0;\n    for(var i = 0; i < sliderOpts._stepCount; i++) {\n        if(sliderOpts._visibleSteps[i]._index === sliderOpts.active) {\n            quantizedIndex = i;\n            break;\n        }\n    }\n\n    var x = normalizedValueToPosition(sliderOpts, quantizedIndex / (sliderOpts._stepCount - 1));\n\n    // If this is true, then *this component* is already invoking its own command\n    // and has triggered its own animation.\n    if(sliderOpts._invokingCommand) return;\n\n    var el = grip;\n    if(doTransition && sliderOpts.transition.duration > 0) {\n        el = el.transition()\n            .duration(sliderOpts.transition.duration)\n            .ease(sliderOpts.transition.easing);\n    }\n\n    // Drawing.setTranslate doesn't work here because of the transition duck-typing.\n    // It's also not necessary because there are no other transitions to preserve.\n    el.attr('transform', strTranslate(x - constants.gripWidth * 0.5, sliderOpts._dims.currentValueTotalHeight));\n}\n\n// Convert a number from [0-1] to a pixel position relative to the slider group container:\nfunction normalizedValueToPosition(sliderOpts, normalizedPosition) {\n    var dims = sliderOpts._dims;\n    return dims.inputAreaStart + constants.stepInset +\n        (dims.inputAreaLength - 2 * constants.stepInset) * Math.min(1, Math.max(0, normalizedPosition));\n}\n\n// Convert a position relative to the slider group to a nubmer in [0, 1]\nfunction positionToNormalizedValue(sliderOpts, position) {\n    var dims = sliderOpts._dims;\n    return Math.min(1, Math.max(0, (position - constants.stepInset - dims.inputAreaStart) / (dims.inputAreaLength - 2 * constants.stepInset - 2 * dims.inputAreaStart)));\n}\n\nfunction drawTouchRect(sliderGroup, gd, sliderOpts) {\n    var dims = sliderOpts._dims;\n    var rect = Lib.ensureSingle(sliderGroup, 'rect', constants.railTouchRectClass, function(s) {\n        s.call(attachGripEvents, gd, sliderGroup, sliderOpts)\n            .style('pointer-events', 'all');\n    });\n\n    rect.attr({\n        width: dims.inputAreaLength,\n        height: Math.max(dims.inputAreaWidth, constants.tickOffset + sliderOpts.ticklen + dims.labelHeight)\n    })\n        .call(Color.fill, sliderOpts.bgcolor)\n        .attr('opacity', 0);\n\n    Drawing.setTranslate(rect, 0, dims.currentValueTotalHeight);\n}\n\nfunction drawRail(sliderGroup, sliderOpts) {\n    var dims = sliderOpts._dims;\n    var computedLength = dims.inputAreaLength - constants.railInset * 2;\n    var rect = Lib.ensureSingle(sliderGroup, 'rect', constants.railRectClass);\n\n    rect.attr({\n        width: computedLength,\n        height: constants.railWidth,\n        rx: constants.railRadius,\n        ry: constants.railRadius,\n        'shape-rendering': 'crispEdges'\n    })\n    .call(Color.stroke, sliderOpts.bordercolor)\n    .call(Color.fill, sliderOpts.bgcolor)\n    .style('stroke-width', sliderOpts.borderwidth + 'px');\n\n    Drawing.setTranslate(rect,\n        constants.railInset,\n        (dims.inputAreaWidth - constants.railWidth) * 0.5 + dims.currentValueTotalHeight\n    );\n}\n","'use strict';\n\nvar constants = require('./constants');\n\nmodule.exports = {\n    moduleType: 'component',\n    name: constants.name,\n\n    layoutAttributes: require('./attributes'),\n    supplyLayoutDefaults: require('./defaults'),\n\n    draw: require('./draw')\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar isNumeric = require('fast-isnumeric');\n\nvar Plots = require('../../plots/plots');\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar Drawing = require('../drawing');\nvar Color = require('../color');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar interactConstants = require('../../constants/interactions');\n\nvar OPPOSITE_SIDE = require('../../constants/alignment').OPPOSITE_SIDE;\nvar numStripRE = / [XY][0-9]* /;\n\n/**\n * Titles - (re)draw titles on the axes and plot:\n * @param {DOM element} gd - the graphDiv\n * @param {string} titleClass - the css class of this title\n * @param {object} options - how and what to draw\n *      propContainer - the layout object containing `title` and `titlefont`\n *          attributes that apply to this title\n *      propName - the full name of the title property (for Plotly.relayout)\n *      [traceIndex] - include only if this property applies to one trace\n *          (such as a colorbar title) - then editing pipes to Plotly.restyle\n *          instead of Plotly.relayout\n *      placeholder - placeholder text for an empty editable title\n *      [avoid] {object} - include if this title should move to avoid other elements\n *          selection - d3 selection of elements to avoid\n *          side - which direction to move if there is a conflict\n *          [offsetLeft] - if these elements are subject to a translation\n *              wrt the title element\n *          [offsetTop]\n *      attributes {object} - position and alignment attributes\n *          x - pixels\n *          y - pixels\n *          text-anchor - start|middle|end\n *      transform {object} - how to transform the title after positioning\n *          rotate - degrees\n *          offset - shift up/down in the rotated frame (unused?)\n *      containerGroup - if an svg <g> element already exists to hold this\n *          title, include here. Otherwise it will go in fullLayout._infolayer\n *      _meta {object (optional} - meta key-value to for title with\n *          Lib.templateString, default to fullLayout._meta, if not provided\n *\n *  @return {selection} d3 selection of title container group\n */\nfunction draw(gd, titleClass, options) {\n    var cont = options.propContainer;\n    var prop = options.propName;\n    var placeholder = options.placeholder;\n    var traceIndex = options.traceIndex;\n    var avoid = options.avoid || {};\n    var attributes = options.attributes;\n    var transform = options.transform;\n    var group = options.containerGroup;\n\n    var fullLayout = gd._fullLayout;\n\n    var opacity = 1;\n    var isplaceholder = false;\n    var title = cont.title;\n    var txt = (title && title.text ? title.text : '').trim();\n\n    var font = title && title.font ? title.font : {};\n    var fontFamily = font.family;\n    var fontSize = font.size;\n    var fontColor = font.color;\n\n    // only make this title editable if we positively identify its property\n    // as one that has editing enabled.\n    var editAttr;\n    if(prop === 'title.text') editAttr = 'titleText';\n    else if(prop.indexOf('axis') !== -1) editAttr = 'axisTitleText';\n    else if(prop.indexOf('colorbar' !== -1)) editAttr = 'colorbarTitleText';\n    var editable = gd._context.edits[editAttr];\n\n    if(txt === '') opacity = 0;\n    // look for placeholder text while stripping out numbers from eg X2, Y3\n    // this is just for backward compatibility with the old version that had\n    // \"Click to enter X2 title\" and may have gotten saved in some old plots,\n    // we don't want this to show up when these are displayed.\n    else if(txt.replace(numStripRE, ' % ') === placeholder.replace(numStripRE, ' % ')) {\n        opacity = 0.2;\n        isplaceholder = true;\n        if(!editable) txt = '';\n    }\n\n    if(options._meta) {\n        txt = Lib.templateString(txt, options._meta);\n    } else if(fullLayout._meta) {\n        txt = Lib.templateString(txt, fullLayout._meta);\n    }\n\n    var elShouldExist = txt || editable;\n\n    if(!group) {\n        group = Lib.ensureSingle(fullLayout._infolayer, 'g', 'g-' + titleClass);\n    }\n\n    var el = group.selectAll('text')\n        .data(elShouldExist ? [0] : []);\n    el.enter().append('text');\n    el.text(txt)\n        // this is hacky, but convertToTspans uses the class\n        // to determine whether to rotate mathJax...\n        // so we need to clear out any old class and put the\n        // correct one (only relevant for colorbars, at least\n        // for now) - ie don't use .classed\n        .attr('class', titleClass);\n    el.exit().remove();\n\n    if(!elShouldExist) return group;\n\n    function titleLayout(titleEl) {\n        Lib.syncOrAsync([drawTitle, scootTitle], titleEl);\n    }\n\n    function drawTitle(titleEl) {\n        var transformVal;\n\n        if(transform) {\n            transformVal = '';\n            if(transform.rotate) {\n                transformVal += 'rotate(' + [transform.rotate, attributes.x, attributes.y] + ')';\n            }\n            if(transform.offset) {\n                transformVal += strTranslate(0, transform.offset);\n            }\n        } else {\n            transformVal = null;\n        }\n\n        titleEl.attr('transform', transformVal);\n\n        titleEl.style({\n            'font-family': fontFamily,\n            'font-size': d3.round(fontSize, 2) + 'px',\n            fill: Color.rgb(fontColor),\n            opacity: opacity * Color.opacity(fontColor),\n            'font-weight': Plots.fontWeight\n        })\n        .attr(attributes)\n        .call(svgTextUtils.convertToTspans, gd);\n\n        return Plots.previousPromises(gd);\n    }\n\n    function scootTitle(titleElIn) {\n        var titleGroup = d3.select(titleElIn.node().parentNode);\n\n        if(avoid && avoid.selection && avoid.side && txt) {\n            titleGroup.attr('transform', null);\n\n            // move toward avoid.side (= left, right, top, bottom) if needed\n            // can include pad (pixels, default 2)\n            var backside = OPPOSITE_SIDE[avoid.side];\n            var shiftSign = (avoid.side === 'left' || avoid.side === 'top') ? -1 : 1;\n            var pad = isNumeric(avoid.pad) ? avoid.pad : 2;\n\n            var titlebb = Drawing.bBox(titleGroup.node());\n            var paperbb = {\n                left: 0,\n                top: 0,\n                right: fullLayout.width,\n                bottom: fullLayout.height\n            };\n\n            var maxshift = avoid.maxShift ||\n                shiftSign * (paperbb[avoid.side] - titlebb[avoid.side]);\n            var shift = 0;\n\n            // Prevent the title going off the paper\n            if(maxshift < 0) {\n                shift = maxshift;\n            } else {\n                // so we don't have to offset each avoided element,\n                // give the title the opposite offset\n                var offsetLeft = avoid.offsetLeft || 0;\n                var offsetTop = avoid.offsetTop || 0;\n                titlebb.left -= offsetLeft;\n                titlebb.right -= offsetLeft;\n                titlebb.top -= offsetTop;\n                titlebb.bottom -= offsetTop;\n\n                // iterate over a set of elements (avoid.selection)\n                // to avoid collisions with\n                avoid.selection.each(function() {\n                    var avoidbb = Drawing.bBox(this);\n\n                    if(Lib.bBoxIntersect(titlebb, avoidbb, pad)) {\n                        shift = Math.max(shift, shiftSign * (\n                            avoidbb[avoid.side] - titlebb[backside]) + pad);\n                    }\n                });\n                shift = Math.min(maxshift, shift);\n            }\n\n            if(shift > 0 || maxshift < 0) {\n                var shiftTemplate = {\n                    left: [-shift, 0],\n                    right: [shift, 0],\n                    top: [0, -shift],\n                    bottom: [0, shift]\n                }[avoid.side];\n                titleGroup.attr('transform', strTranslate(shiftTemplate[0], shiftTemplate[1]));\n            }\n        }\n    }\n\n    el.call(titleLayout);\n\n    function setPlaceholder() {\n        opacity = 0;\n        isplaceholder = true;\n        el.text(placeholder)\n            .on('mouseover.opacity', function() {\n                d3.select(this).transition()\n                    .duration(interactConstants.SHOW_PLACEHOLDER).style('opacity', 1);\n            })\n            .on('mouseout.opacity', function() {\n                d3.select(this).transition()\n                    .duration(interactConstants.HIDE_PLACEHOLDER).style('opacity', 0);\n            });\n    }\n\n    if(editable) {\n        if(!txt) setPlaceholder();\n        else el.on('.opacity', null);\n\n        el.call(svgTextUtils.makeEditable, {gd: gd})\n            .on('edit', function(text) {\n                if(traceIndex !== undefined) {\n                    Registry.call('_guiRestyle', gd, prop, text, traceIndex);\n                } else {\n                    Registry.call('_guiRelayout', gd, prop, text);\n                }\n            })\n            .on('cancel', function() {\n                this.text(this.attr('data-unformatted'))\n                    .call(titleLayout);\n            })\n            .on('input', function(d) {\n                this.text(d || ' ')\n                    .call(svgTextUtils.positionText, attributes.x, attributes.y);\n            });\n    }\n    el.classed('js-placeholder', isplaceholder);\n\n    return group;\n}\n\nmodule.exports = {\n    draw: draw\n};\n","'use strict';\n\nvar fontAttrs = require('../../plots/font_attributes');\nvar colorAttrs = require('../color/attributes');\nvar extendFlat = require('../../lib/extend').extendFlat;\nvar overrideAll = require('../../plot_api/edit_types').overrideAll;\nvar padAttrs = require('../../plots/pad_attributes');\nvar templatedArray = require('../../plot_api/plot_template').templatedArray;\n\nvar buttonsAttrs = templatedArray('button', {\n    visible: {\n        valType: 'boolean',\n        description: 'Determines whether or not this button is visible.'\n    },\n    method: {\n        valType: 'enumerated',\n        values: ['restyle', 'relayout', 'animate', 'update', 'skip'],\n        dflt: 'restyle',\n        description: [\n            'Sets the Plotly method to be called on click.',\n            'If the `skip` method is used, the API updatemenu will function as normal',\n            'but will perform no API calls and will not bind automatically to state',\n            'updates. This may be used to create a component interface and attach to',\n            'updatemenu events manually via JavaScript.'\n        ].join(' ')\n    },\n    args: {\n        valType: 'info_array',\n        freeLength: true,\n        items: [\n            {valType: 'any'},\n            {valType: 'any'},\n            {valType: 'any'}\n        ],\n        description: [\n            'Sets the arguments values to be passed to the Plotly',\n            'method set in `method` on click.'\n        ].join(' ')\n    },\n    args2: {\n        valType: 'info_array',\n        freeLength: true,\n        items: [\n            {valType: 'any'},\n            {valType: 'any'},\n            {valType: 'any'}\n        ],\n        description: [\n            'Sets a 2nd set of `args`,',\n            'these arguments values are passed to the Plotly',\n            'method set in `method` when clicking this button while in the active state.',\n            'Use this to create toggle buttons.'\n        ].join(' ')\n    },\n    label: {\n        valType: 'string',\n        dflt: '',\n        description: 'Sets the text label to appear on the button.'\n    },\n    execute: {\n        valType: 'boolean',\n        dflt: true,\n        description: [\n            'When true, the API method is executed. When false, all other behaviors are the same',\n            'and command execution is skipped. This may be useful when hooking into, for example,',\n            'the `plotly_buttonclicked` method and executing the API command manually without losing',\n            'the benefit of the updatemenu automatically binding to the state of the plot through the',\n            'specification of `method` and `args`.'\n        ].join(' ')\n    }\n});\n\nmodule.exports = overrideAll(templatedArray('updatemenu', {\n    _arrayAttrRegexps: [/^updatemenus\\[(0|[1-9][0-9]+)\\]\\.buttons/],\n\n    visible: {\n        valType: 'boolean',\n        description: [\n            'Determines whether or not the update menu is visible.'\n        ].join(' ')\n    },\n\n    type: {\n        valType: 'enumerated',\n        values: ['dropdown', 'buttons'],\n        dflt: 'dropdown',\n        description: [\n            'Determines whether the buttons are accessible via a dropdown menu',\n            'or whether the buttons are stacked horizontally or vertically'\n        ].join(' ')\n    },\n\n    direction: {\n        valType: 'enumerated',\n        values: ['left', 'right', 'up', 'down'],\n        dflt: 'down',\n        description: [\n            'Determines the direction in which the buttons are laid out, whether',\n            'in a dropdown menu or a row/column of buttons. For `left` and `up`,',\n            'the buttons will still appear in left-to-right or top-to-bottom order',\n            'respectively.'\n        ].join(' ')\n    },\n\n    active: {\n        valType: 'integer',\n        min: -1,\n        dflt: 0,\n        description: [\n            'Determines which button (by index starting from 0) is',\n            'considered active.'\n        ].join(' ')\n    },\n\n    showactive: {\n        valType: 'boolean',\n        dflt: true,\n        description: 'Highlights active dropdown item or active button if true.'\n    },\n\n    buttons: buttonsAttrs,\n\n    x: {\n        valType: 'number',\n        min: -2,\n        max: 3,\n        dflt: -0.05,\n        description: 'Sets the x position (in normalized coordinates) of the update menu.'\n    },\n    xanchor: {\n        valType: 'enumerated',\n        values: ['auto', 'left', 'center', 'right'],\n        dflt: 'right',\n        description: [\n            'Sets the update menu\\'s horizontal position anchor.',\n            'This anchor binds the `x` position to the *left*, *center*',\n            'or *right* of the range selector.'\n        ].join(' ')\n    },\n    y: {\n        valType: 'number',\n        min: -2,\n        max: 3,\n        dflt: 1,\n        description: 'Sets the y position (in normalized coordinates) of the update menu.'\n    },\n    yanchor: {\n        valType: 'enumerated',\n        values: ['auto', 'top', 'middle', 'bottom'],\n        dflt: 'top',\n        description: [\n            'Sets the update menu\\'s vertical position anchor',\n            'This anchor binds the `y` position to the *top*, *middle*',\n            'or *bottom* of the range selector.'\n        ].join(' ')\n    },\n\n    pad: extendFlat(padAttrs({editType: 'arraydraw'}), {\n        description: 'Sets the padding around the buttons or dropdown menu.'\n    }),\n\n    font: fontAttrs({\n        description: 'Sets the font of the update menu button text.'\n    }),\n\n    bgcolor: {\n        valType: 'color',\n        description: 'Sets the background color of the update menu buttons.'\n    },\n    bordercolor: {\n        valType: 'color',\n        dflt: colorAttrs.borderLine,\n        description: 'Sets the color of the border enclosing the update menu.'\n    },\n    borderwidth: {\n        valType: 'number',\n        min: 0,\n        dflt: 1,\n        editType: 'arraydraw',\n        description: 'Sets the width (in px) of the border enclosing the update menu.'\n    }\n}), 'arraydraw', 'from-root');\n","'use strict';\n\n\nmodule.exports = {\n\n    // layout attribute name\n    name: 'updatemenus',\n\n    // class names\n    containerClassName: 'updatemenu-container',\n    headerGroupClassName: 'updatemenu-header-group',\n    headerClassName: 'updatemenu-header',\n    headerArrowClassName: 'updatemenu-header-arrow',\n    dropdownButtonGroupClassName: 'updatemenu-dropdown-button-group',\n    dropdownButtonClassName: 'updatemenu-dropdown-button',\n    buttonClassName: 'updatemenu-button',\n    itemRectClassName: 'updatemenu-item-rect',\n    itemTextClassName: 'updatemenu-item-text',\n\n    // DOM attribute name in button group keeping track\n    // of active update menu\n    menuIndexAttrName: 'updatemenu-active-index',\n\n    // id root pass to Plots.autoMargin\n    autoMarginIdRoot: 'updatemenu-',\n\n    // options when 'active: -1'\n    blankHeaderOpts: { label: '  ' },\n\n    // min item width / height\n    minWidth: 30,\n    minHeight: 30,\n\n    // padding around item text\n    textPadX: 24,\n    arrowPadX: 16,\n\n    // item rect radii\n    rx: 2,\n    ry: 2,\n\n    // item  text x offset off left edge\n    textOffsetX: 12,\n\n    // item  text y offset (w.r.t. middle)\n    textOffsetY: 3,\n\n    // arrow offset off right edge\n    arrowOffsetX: 4,\n\n    // gap between header and buttons\n    gapButtonHeader: 5,\n\n    // gap between between buttons\n    gapButton: 2,\n\n    // color given to active buttons\n    activeColor: '#F4FAFF',\n\n    // color given to hovered buttons\n    hoverColor: '#F4FAFF',\n\n    // symbol for menu open arrow\n    arrowSymbol: {\n        left: '',\n        right: '',\n        up: '',\n        down: ''\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar handleArrayContainerDefaults = require('../../plots/array_container_defaults');\n\nvar attributes = require('./attributes');\nvar constants = require('./constants');\n\nvar name = constants.name;\nvar buttonAttrs = attributes.buttons;\n\n\nmodule.exports = function updateMenusDefaults(layoutIn, layoutOut) {\n    var opts = {\n        name: name,\n        handleItemDefaults: menuDefaults\n    };\n\n    handleArrayContainerDefaults(layoutIn, layoutOut, opts);\n};\n\nfunction menuDefaults(menuIn, menuOut, layoutOut) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(menuIn, menuOut, attributes, attr, dflt);\n    }\n\n    var buttons = handleArrayContainerDefaults(menuIn, menuOut, {\n        name: 'buttons',\n        handleItemDefaults: buttonDefaults\n    });\n\n    var visible = coerce('visible', buttons.length > 0);\n    if(!visible) return;\n\n    coerce('active');\n    coerce('direction');\n    coerce('type');\n    coerce('showactive');\n\n    coerce('x');\n    coerce('y');\n    Lib.noneOrAll(menuIn, menuOut, ['x', 'y']);\n\n    coerce('xanchor');\n    coerce('yanchor');\n\n    coerce('pad.t');\n    coerce('pad.r');\n    coerce('pad.b');\n    coerce('pad.l');\n\n    Lib.coerceFont(coerce, 'font', layoutOut.font);\n\n    coerce('bgcolor', layoutOut.paper_bgcolor);\n    coerce('bordercolor');\n    coerce('borderwidth');\n}\n\nfunction buttonDefaults(buttonIn, buttonOut) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(buttonIn, buttonOut, buttonAttrs, attr, dflt);\n    }\n\n    var visible = coerce('visible',\n        (buttonIn.method === 'skip' || Array.isArray(buttonIn.args)));\n    if(visible) {\n        coerce('method');\n        coerce('args');\n        coerce('args2');\n        coerce('label');\n        coerce('execute');\n    }\n}\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Plots = require('../../plots/plots');\nvar Color = require('../color');\nvar Drawing = require('../drawing');\nvar Lib = require('../../lib');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar arrayEditor = require('../../plot_api/plot_template').arrayEditor;\n\nvar LINE_SPACING = require('../../constants/alignment').LINE_SPACING;\n\nvar constants = require('./constants');\nvar ScrollBox = require('./scrollbox');\n\nmodule.exports = function draw(gd) {\n    var fullLayout = gd._fullLayout;\n    var menuData = Lib.filterVisible(fullLayout[constants.name]);\n\n    /* Update menu data is bound to the header-group.\n     * The items in the header group are always present.\n     *\n     * Upon clicking on a header its corresponding button\n     * data is bound to the button-group.\n     *\n     * We draw all headers in one group before all buttons\n     * so that the buttons *always* appear above the headers.\n     *\n     * Note that only one set of buttons are visible at once.\n     *\n     * <g container />\n     *\n     *     <g header-group />\n     *         <g item header />\n     *         <text item header-arrow />\n     *     <g header-group />\n     *         <g item header />\n     *         <text item header-arrow />\n     *     ...\n     *\n     *     <g button-group />\n     *         <g item button />\n     *         <g item button />\n     *         ...\n     */\n\n    function clearAutoMargin(menuOpts) {\n        Plots.autoMargin(gd, autoMarginId(menuOpts));\n    }\n\n    // draw update menu container\n    var menus = fullLayout._menulayer\n        .selectAll('g.' + constants.containerClassName)\n        .data(menuData.length > 0 ? [0] : []);\n\n    menus.enter().append('g')\n        .classed(constants.containerClassName, true)\n        .style('cursor', 'pointer');\n\n    menus.exit().each(function() {\n        // Most components don't need to explicitly remove autoMargin, because\n        // marginPushers does this - but updatemenu updates don't go through\n        // a full replot so we need to explicitly remove it.\n        // This is for removing *all* updatemenus, removing individuals is\n        // handled below, in headerGroups.exit\n        d3.select(this).selectAll('g.' + constants.headerGroupClassName)\n            .each(clearAutoMargin);\n    }).remove();\n\n    // return early if no update menus are visible\n    if(menuData.length === 0) return;\n\n    // join header group\n    var headerGroups = menus.selectAll('g.' + constants.headerGroupClassName)\n        .data(menuData, keyFunction);\n\n    headerGroups.enter().append('g')\n        .classed(constants.headerGroupClassName, true);\n\n    // draw dropdown button container\n    var gButton = Lib.ensureSingle(menus, 'g', constants.dropdownButtonGroupClassName, function(s) {\n        s.style('pointer-events', 'all');\n    });\n\n    // find dimensions before plotting anything (this mutates menuOpts)\n    for(var i = 0; i < menuData.length; i++) {\n        var menuOpts = menuData[i];\n        findDimensions(gd, menuOpts);\n    }\n\n    // setup scrollbox\n    var scrollBoxId = 'updatemenus' + fullLayout._uid;\n    var scrollBox = new ScrollBox(gd, gButton, scrollBoxId);\n\n    // remove exiting header, remove dropped buttons and reset margins\n    if(headerGroups.enter().size()) {\n        // make sure gButton is on top of all headers\n        gButton.node().parentNode.appendChild(gButton.node());\n        gButton.call(removeAllButtons);\n    }\n\n    headerGroups.exit().each(function(menuOpts) {\n        gButton.call(removeAllButtons);\n        clearAutoMargin(menuOpts);\n    }).remove();\n\n    // draw headers!\n    headerGroups.each(function(menuOpts) {\n        var gHeader = d3.select(this);\n\n        var _gButton = menuOpts.type === 'dropdown' ? gButton : null;\n\n        Plots.manageCommandObserver(gd, menuOpts, menuOpts.buttons, function(data) {\n            setActive(gd, menuOpts, menuOpts.buttons[data.index], gHeader, _gButton, scrollBox, data.index, true);\n        });\n\n        if(menuOpts.type === 'dropdown') {\n            drawHeader(gd, gHeader, gButton, scrollBox, menuOpts);\n\n            // if this menu is active, update the dropdown container\n            if(isActive(gButton, menuOpts)) {\n                drawButtons(gd, gHeader, gButton, scrollBox, menuOpts);\n            }\n        } else {\n            drawButtons(gd, gHeader, null, null, menuOpts);\n        }\n    });\n};\n\n// Note that '_index' is set at the default step,\n// it corresponds to the menu index in the user layout update menu container.\n// Because a menu can be set invisible,\n// this is a more 'consistent' field than the index in the menuData.\nfunction keyFunction(menuOpts) {\n    return menuOpts._index;\n}\n\nfunction isFolded(gButton) {\n    return +gButton.attr(constants.menuIndexAttrName) === -1;\n}\n\nfunction isActive(gButton, menuOpts) {\n    return +gButton.attr(constants.menuIndexAttrName) === menuOpts._index;\n}\n\nfunction setActive(gd, menuOpts, buttonOpts, gHeader, gButton, scrollBox, buttonIndex, isSilentUpdate) {\n    // update 'active' attribute in menuOpts\n    menuOpts.active = buttonIndex;\n\n    // due to templating, it's possible this slider doesn't even exist yet\n    arrayEditor(gd.layout, constants.name, menuOpts)\n        .applyUpdate('active', buttonIndex);\n\n    if(menuOpts.type === 'buttons') {\n        drawButtons(gd, gHeader, null, null, menuOpts);\n    } else if(menuOpts.type === 'dropdown') {\n        // fold up buttons and redraw header\n        gButton.attr(constants.menuIndexAttrName, '-1');\n\n        drawHeader(gd, gHeader, gButton, scrollBox, menuOpts);\n\n        if(!isSilentUpdate) {\n            drawButtons(gd, gHeader, gButton, scrollBox, menuOpts);\n        }\n    }\n}\n\nfunction drawHeader(gd, gHeader, gButton, scrollBox, menuOpts) {\n    var header = Lib.ensureSingle(gHeader, 'g', constants.headerClassName, function(s) {\n        s.style('pointer-events', 'all');\n    });\n\n    var dims = menuOpts._dims;\n    var active = menuOpts.active;\n    var headerOpts = menuOpts.buttons[active] || constants.blankHeaderOpts;\n    var posOpts = { y: menuOpts.pad.t, yPad: 0, x: menuOpts.pad.l, xPad: 0, index: 0 };\n    var positionOverrides = {\n        width: dims.headerWidth,\n        height: dims.headerHeight\n    };\n\n    header\n        .call(drawItem, menuOpts, headerOpts, gd)\n        .call(setItemPosition, menuOpts, posOpts, positionOverrides);\n\n    // draw drop arrow at the right edge\n    var arrow = Lib.ensureSingle(gHeader, 'text', constants.headerArrowClassName, function(s) {\n        s.attr('text-anchor', 'end')\n            .call(Drawing.font, menuOpts.font)\n            .text(constants.arrowSymbol[menuOpts.direction]);\n    });\n\n    arrow.attr({\n        x: dims.headerWidth - constants.arrowOffsetX + menuOpts.pad.l,\n        y: dims.headerHeight / 2 + constants.textOffsetY + menuOpts.pad.t\n    });\n\n    header.on('click', function() {\n        gButton.call(removeAllButtons,\n            String(isActive(gButton, menuOpts) ? -1 : menuOpts._index)\n        );\n\n        drawButtons(gd, gHeader, gButton, scrollBox, menuOpts);\n    });\n\n    header.on('mouseover', function() {\n        header.call(styleOnMouseOver);\n    });\n\n    header.on('mouseout', function() {\n        header.call(styleOnMouseOut, menuOpts);\n    });\n\n    // translate header group\n    Drawing.setTranslate(gHeader, dims.lx, dims.ly);\n}\n\nfunction drawButtons(gd, gHeader, gButton, scrollBox, menuOpts) {\n    // If this is a set of buttons, set pointer events = all since we play\n    // some minor games with which container is which in order to simplify\n    // the drawing of *either* buttons or menus\n    if(!gButton) {\n        gButton = gHeader;\n        gButton.attr('pointer-events', 'all');\n    }\n\n    var buttonData = (!isFolded(gButton) || menuOpts.type === 'buttons') ?\n        menuOpts.buttons :\n        [];\n\n    var klass = menuOpts.type === 'dropdown' ? constants.dropdownButtonClassName : constants.buttonClassName;\n\n    var buttons = gButton.selectAll('g.' + klass)\n        .data(Lib.filterVisible(buttonData));\n\n    var enter = buttons.enter().append('g')\n        .classed(klass, true);\n\n    var exit = buttons.exit();\n\n    if(menuOpts.type === 'dropdown') {\n        enter.attr('opacity', '0')\n            .transition()\n            .attr('opacity', '1');\n\n        exit.transition()\n            .attr('opacity', '0')\n            .remove();\n    } else {\n        exit.remove();\n    }\n\n    var x0 = 0;\n    var y0 = 0;\n    var dims = menuOpts._dims;\n\n    var isVertical = ['up', 'down'].indexOf(menuOpts.direction) !== -1;\n\n    if(menuOpts.type === 'dropdown') {\n        if(isVertical) {\n            y0 = dims.headerHeight + constants.gapButtonHeader;\n        } else {\n            x0 = dims.headerWidth + constants.gapButtonHeader;\n        }\n    }\n\n    if(menuOpts.type === 'dropdown' && menuOpts.direction === 'up') {\n        y0 = -constants.gapButtonHeader + constants.gapButton - dims.openHeight;\n    }\n\n    if(menuOpts.type === 'dropdown' && menuOpts.direction === 'left') {\n        x0 = -constants.gapButtonHeader + constants.gapButton - dims.openWidth;\n    }\n\n    var posOpts = {\n        x: dims.lx + x0 + menuOpts.pad.l,\n        y: dims.ly + y0 + menuOpts.pad.t,\n        yPad: constants.gapButton,\n        xPad: constants.gapButton,\n        index: 0,\n    };\n\n    var scrollBoxPosition = {\n        l: posOpts.x + menuOpts.borderwidth,\n        t: posOpts.y + menuOpts.borderwidth\n    };\n\n    buttons.each(function(buttonOpts, buttonIndex) {\n        var button = d3.select(this);\n\n        button\n            .call(drawItem, menuOpts, buttonOpts, gd)\n            .call(setItemPosition, menuOpts, posOpts);\n\n        button.on('click', function() {\n            // skip `dragend` events\n            if(d3.event.defaultPrevented) return;\n\n            if(buttonOpts.execute) {\n                if(buttonOpts.args2 && menuOpts.active === buttonIndex) {\n                    setActive(gd, menuOpts, buttonOpts, gHeader, gButton, scrollBox, -1);\n                    Plots.executeAPICommand(gd, buttonOpts.method, buttonOpts.args2);\n                } else {\n                    setActive(gd, menuOpts, buttonOpts, gHeader, gButton, scrollBox, buttonIndex);\n                    Plots.executeAPICommand(gd, buttonOpts.method, buttonOpts.args);\n                }\n            }\n\n            gd.emit('plotly_buttonclicked', {menu: menuOpts, button: buttonOpts, active: menuOpts.active});\n        });\n\n        button.on('mouseover', function() {\n            button.call(styleOnMouseOver);\n        });\n\n        button.on('mouseout', function() {\n            button.call(styleOnMouseOut, menuOpts);\n            buttons.call(styleButtons, menuOpts);\n        });\n    });\n\n    buttons.call(styleButtons, menuOpts);\n\n    if(isVertical) {\n        scrollBoxPosition.w = Math.max(dims.openWidth, dims.headerWidth);\n        scrollBoxPosition.h = posOpts.y - scrollBoxPosition.t;\n    } else {\n        scrollBoxPosition.w = posOpts.x - scrollBoxPosition.l;\n        scrollBoxPosition.h = Math.max(dims.openHeight, dims.headerHeight);\n    }\n\n    scrollBoxPosition.direction = menuOpts.direction;\n\n    if(scrollBox) {\n        if(buttons.size()) {\n            drawScrollBox(gd, gHeader, gButton, scrollBox, menuOpts, scrollBoxPosition);\n        } else {\n            hideScrollBox(scrollBox);\n        }\n    }\n}\n\nfunction drawScrollBox(gd, gHeader, gButton, scrollBox, menuOpts, position) {\n    // enable the scrollbox\n    var direction = menuOpts.direction;\n    var isVertical = (direction === 'up' || direction === 'down');\n    var dims = menuOpts._dims;\n\n    var active = menuOpts.active;\n    var translateX, translateY;\n    var i;\n    if(isVertical) {\n        translateY = 0;\n        for(i = 0; i < active; i++) {\n            translateY += dims.heights[i] + constants.gapButton;\n        }\n    } else {\n        translateX = 0;\n        for(i = 0; i < active; i++) {\n            translateX += dims.widths[i] + constants.gapButton;\n        }\n    }\n\n    scrollBox.enable(position, translateX, translateY);\n\n    if(scrollBox.hbar) {\n        scrollBox.hbar\n            .attr('opacity', '0')\n            .transition()\n            .attr('opacity', '1');\n    }\n\n    if(scrollBox.vbar) {\n        scrollBox.vbar\n            .attr('opacity', '0')\n            .transition()\n            .attr('opacity', '1');\n    }\n}\n\nfunction hideScrollBox(scrollBox) {\n    var hasHBar = !!scrollBox.hbar;\n    var hasVBar = !!scrollBox.vbar;\n\n    if(hasHBar) {\n        scrollBox.hbar\n            .transition()\n            .attr('opacity', '0')\n            .each('end', function() {\n                hasHBar = false;\n                if(!hasVBar) scrollBox.disable();\n            });\n    }\n\n    if(hasVBar) {\n        scrollBox.vbar\n            .transition()\n            .attr('opacity', '0')\n            .each('end', function() {\n                hasVBar = false;\n                if(!hasHBar) scrollBox.disable();\n            });\n    }\n}\n\nfunction drawItem(item, menuOpts, itemOpts, gd) {\n    item.call(drawItemRect, menuOpts)\n        .call(drawItemText, menuOpts, itemOpts, gd);\n}\n\nfunction drawItemRect(item, menuOpts) {\n    var rect = Lib.ensureSingle(item, 'rect', constants.itemRectClassName, function(s) {\n        s.attr({\n            rx: constants.rx,\n            ry: constants.ry,\n            'shape-rendering': 'crispEdges'\n        });\n    });\n\n    rect.call(Color.stroke, menuOpts.bordercolor)\n        .call(Color.fill, menuOpts.bgcolor)\n        .style('stroke-width', menuOpts.borderwidth + 'px');\n}\n\nfunction drawItemText(item, menuOpts, itemOpts, gd) {\n    var text = Lib.ensureSingle(item, 'text', constants.itemTextClassName, function(s) {\n        s.attr({\n            'text-anchor': 'start',\n            'data-notex': 1\n        });\n    });\n\n    var tx = itemOpts.label;\n    var _meta = gd._fullLayout._meta;\n    if(_meta) tx = Lib.templateString(tx, _meta);\n\n    text.call(Drawing.font, menuOpts.font)\n        .text(tx)\n        .call(svgTextUtils.convertToTspans, gd);\n}\n\nfunction styleButtons(buttons, menuOpts) {\n    var active = menuOpts.active;\n\n    buttons.each(function(buttonOpts, i) {\n        var button = d3.select(this);\n\n        if(i === active && menuOpts.showactive) {\n            button.select('rect.' + constants.itemRectClassName)\n                .call(Color.fill, constants.activeColor);\n        }\n    });\n}\n\nfunction styleOnMouseOver(item) {\n    item.select('rect.' + constants.itemRectClassName)\n        .call(Color.fill, constants.hoverColor);\n}\n\nfunction styleOnMouseOut(item, menuOpts) {\n    item.select('rect.' + constants.itemRectClassName)\n        .call(Color.fill, menuOpts.bgcolor);\n}\n\n// find item dimensions (this mutates menuOpts)\nfunction findDimensions(gd, menuOpts) {\n    var dims = menuOpts._dims = {\n        width1: 0,\n        height1: 0,\n        heights: [],\n        widths: [],\n        totalWidth: 0,\n        totalHeight: 0,\n        openWidth: 0,\n        openHeight: 0,\n        lx: 0,\n        ly: 0\n    };\n\n    var fakeButtons = Drawing.tester.selectAll('g.' + constants.dropdownButtonClassName)\n        .data(Lib.filterVisible(menuOpts.buttons));\n\n    fakeButtons.enter().append('g')\n        .classed(constants.dropdownButtonClassName, true);\n\n    var isVertical = ['up', 'down'].indexOf(menuOpts.direction) !== -1;\n\n    // loop over fake buttons to find width / height\n    fakeButtons.each(function(buttonOpts, i) {\n        var button = d3.select(this);\n\n        button.call(drawItem, menuOpts, buttonOpts, gd);\n\n        var text = button.select('.' + constants.itemTextClassName);\n\n        // width is given by max width of all buttons\n        var tWidth = text.node() && Drawing.bBox(text.node()).width;\n        var wEff = Math.max(tWidth + constants.textPadX, constants.minWidth);\n\n        // height is determined by item text\n        var tHeight = menuOpts.font.size * LINE_SPACING;\n        var tLines = svgTextUtils.lineCount(text);\n        var hEff = Math.max(tHeight * tLines, constants.minHeight) + constants.textOffsetY;\n\n        hEff = Math.ceil(hEff);\n        wEff = Math.ceil(wEff);\n\n        // Store per-item sizes since a row of horizontal buttons, for example,\n        // don't all need to be the same width:\n        dims.widths[i] = wEff;\n        dims.heights[i] = hEff;\n\n        // Height and width of individual element:\n        dims.height1 = Math.max(dims.height1, hEff);\n        dims.width1 = Math.max(dims.width1, wEff);\n\n        if(isVertical) {\n            dims.totalWidth = Math.max(dims.totalWidth, wEff);\n            dims.openWidth = dims.totalWidth;\n            dims.totalHeight += hEff + constants.gapButton;\n            dims.openHeight += hEff + constants.gapButton;\n        } else {\n            dims.totalWidth += wEff + constants.gapButton;\n            dims.openWidth += wEff + constants.gapButton;\n            dims.totalHeight = Math.max(dims.totalHeight, hEff);\n            dims.openHeight = dims.totalHeight;\n        }\n    });\n\n    if(isVertical) {\n        dims.totalHeight -= constants.gapButton;\n    } else {\n        dims.totalWidth -= constants.gapButton;\n    }\n\n\n    dims.headerWidth = dims.width1 + constants.arrowPadX;\n    dims.headerHeight = dims.height1;\n\n    if(menuOpts.type === 'dropdown') {\n        if(isVertical) {\n            dims.width1 += constants.arrowPadX;\n            dims.totalHeight = dims.height1;\n        } else {\n            dims.totalWidth = dims.width1;\n        }\n        dims.totalWidth += constants.arrowPadX;\n    }\n\n    fakeButtons.remove();\n\n    var paddedWidth = dims.totalWidth + menuOpts.pad.l + menuOpts.pad.r;\n    var paddedHeight = dims.totalHeight + menuOpts.pad.t + menuOpts.pad.b;\n\n    var graphSize = gd._fullLayout._size;\n    dims.lx = graphSize.l + graphSize.w * menuOpts.x;\n    dims.ly = graphSize.t + graphSize.h * (1 - menuOpts.y);\n\n    var xanchor = 'left';\n    if(Lib.isRightAnchor(menuOpts)) {\n        dims.lx -= paddedWidth;\n        xanchor = 'right';\n    }\n    if(Lib.isCenterAnchor(menuOpts)) {\n        dims.lx -= paddedWidth / 2;\n        xanchor = 'center';\n    }\n\n    var yanchor = 'top';\n    if(Lib.isBottomAnchor(menuOpts)) {\n        dims.ly -= paddedHeight;\n        yanchor = 'bottom';\n    }\n    if(Lib.isMiddleAnchor(menuOpts)) {\n        dims.ly -= paddedHeight / 2;\n        yanchor = 'middle';\n    }\n\n    dims.totalWidth = Math.ceil(dims.totalWidth);\n    dims.totalHeight = Math.ceil(dims.totalHeight);\n    dims.lx = Math.round(dims.lx);\n    dims.ly = Math.round(dims.ly);\n\n    Plots.autoMargin(gd, autoMarginId(menuOpts), {\n        x: menuOpts.x,\n        y: menuOpts.y,\n        l: paddedWidth * ({right: 1, center: 0.5}[xanchor] || 0),\n        r: paddedWidth * ({left: 1, center: 0.5}[xanchor] || 0),\n        b: paddedHeight * ({top: 1, middle: 0.5}[yanchor] || 0),\n        t: paddedHeight * ({bottom: 1, middle: 0.5}[yanchor] || 0)\n    });\n}\n\nfunction autoMarginId(menuOpts) {\n    return constants.autoMarginIdRoot + menuOpts._index;\n}\n\n// set item positions (mutates posOpts)\nfunction setItemPosition(item, menuOpts, posOpts, overrideOpts) {\n    overrideOpts = overrideOpts || {};\n    var rect = item.select('.' + constants.itemRectClassName);\n    var text = item.select('.' + constants.itemTextClassName);\n    var borderWidth = menuOpts.borderwidth;\n    var index = posOpts.index;\n    var dims = menuOpts._dims;\n\n    Drawing.setTranslate(item, borderWidth + posOpts.x, borderWidth + posOpts.y);\n\n    var isVertical = ['up', 'down'].indexOf(menuOpts.direction) !== -1;\n    var finalHeight = overrideOpts.height || (isVertical ? dims.heights[index] : dims.height1);\n\n    rect.attr({\n        x: 0,\n        y: 0,\n        width: overrideOpts.width || (isVertical ? dims.width1 : dims.widths[index]),\n        height: finalHeight\n    });\n\n    var tHeight = menuOpts.font.size * LINE_SPACING;\n    var tLines = svgTextUtils.lineCount(text);\n    var spanOffset = ((tLines - 1) * tHeight / 2);\n\n    svgTextUtils.positionText(text, constants.textOffsetX,\n        finalHeight / 2 - spanOffset + constants.textOffsetY);\n\n    if(isVertical) {\n        posOpts.y += dims.heights[index] + posOpts.yPad;\n    } else {\n        posOpts.x += dims.widths[index] + posOpts.xPad;\n    }\n\n    posOpts.index++;\n}\n\nfunction removeAllButtons(gButton, newMenuIndexAttr) {\n    gButton\n        .attr(constants.menuIndexAttrName, newMenuIndexAttr || '-1')\n        .selectAll('g.' + constants.dropdownButtonClassName).remove();\n}\n","'use strict';\n\nvar constants = require('./constants');\n\nmodule.exports = {\n    moduleType: 'component',\n    name: constants.name,\n\n    layoutAttributes: require('./attributes'),\n    supplyLayoutDefaults: require('./defaults'),\n\n    draw: require('./draw')\n};\n","'use strict';\n\nmodule.exports = ScrollBox;\n\nvar d3 = require('@plotly/d3');\n\nvar Color = require('../color');\nvar Drawing = require('../drawing');\n\nvar Lib = require('../../lib');\n\n/**\n * Helper class to setup a scroll box\n *\n * @class\n * @param           gd          Plotly's graph div\n * @param           container   Container to be scroll-boxed (as a D3 selection)\n * @param {string}  id          Id for the clip path to implement the scroll box\n */\nfunction ScrollBox(gd, container, id) {\n    this.gd = gd;\n    this.container = container;\n    this.id = id;\n\n    // See ScrollBox.prototype.enable for further definition\n    this.position = null;  // scrollbox position\n    this.translateX = null;  // scrollbox horizontal translation\n    this.translateY = null;  // scrollbox vertical translation\n    this.hbar = null;  // horizontal scrollbar D3 selection\n    this.vbar = null;  // vertical scrollbar D3 selection\n\n    // <rect> element to capture pointer events\n    this.bg = this.container.selectAll('rect.scrollbox-bg').data([0]);\n\n    this.bg.exit()\n        .on('.drag', null)\n        .on('wheel', null)\n        .remove();\n\n    this.bg.enter().append('rect')\n        .classed('scrollbox-bg', true)\n        .style('pointer-events', 'all')\n        .attr({\n            opacity: 0,\n            x: 0,\n            y: 0,\n            width: 0,\n            height: 0\n        });\n}\n\n// scroll bar dimensions\nScrollBox.barWidth = 2;\nScrollBox.barLength = 20;\nScrollBox.barRadius = 2;\nScrollBox.barPad = 1;\nScrollBox.barColor = '#808BA4';\n\n/**\n * If needed, setup a clip path and scrollbars\n *\n * @method\n * @param {Object}  position\n * @param {number}  position.l  Left side position (in pixels)\n * @param {number}  position.t  Top side (in pixels)\n * @param {number}  position.w  Width (in pixels)\n * @param {number}  position.h  Height (in pixels)\n * @param {string}  [position.direction='down']\n *                  Either 'down', 'left', 'right' or 'up'\n * @param {number}  [translateX=0]  Horizontal offset (in pixels)\n * @param {number}  [translateY=0]  Vertical offset (in pixels)\n */\nScrollBox.prototype.enable = function enable(position, translateX, translateY) {\n    var fullLayout = this.gd._fullLayout;\n    var fullWidth = fullLayout.width;\n    var fullHeight = fullLayout.height;\n\n    // compute position of scrollbox\n    this.position = position;\n\n    var l = this.position.l;\n    var w = this.position.w;\n    var t = this.position.t;\n    var h = this.position.h;\n    var direction = this.position.direction;\n    var isDown = (direction === 'down');\n    var isLeft = (direction === 'left');\n    var isRight = (direction === 'right');\n    var isUp = (direction === 'up');\n    var boxW = w;\n    var boxH = h;\n    var boxL, boxR;\n    var boxT, boxB;\n\n    if(!isDown && !isLeft && !isRight && !isUp) {\n        this.position.direction = 'down';\n        isDown = true;\n    }\n\n    var isVertical = isDown || isUp;\n    if(isVertical) {\n        boxL = l;\n        boxR = boxL + boxW;\n\n        if(isDown) {\n            // anchor to top side\n            boxT = t;\n            boxB = Math.min(boxT + boxH, fullHeight);\n            boxH = boxB - boxT;\n        } else {\n            // anchor to bottom side\n            boxB = t + boxH;\n            boxT = Math.max(boxB - boxH, 0);\n            boxH = boxB - boxT;\n        }\n    } else {\n        boxT = t;\n        boxB = boxT + boxH;\n\n        if(isLeft) {\n            // anchor to right side\n            boxR = l + boxW;\n            boxL = Math.max(boxR - boxW, 0);\n            boxW = boxR - boxL;\n        } else {\n            // anchor to left side\n            boxL = l;\n            boxR = Math.min(boxL + boxW, fullWidth);\n            boxW = boxR - boxL;\n        }\n    }\n\n    this._box = {\n        l: boxL,\n        t: boxT,\n        w: boxW,\n        h: boxH\n    };\n\n    // compute position of horizontal scroll bar\n    var needsHorizontalScrollBar = (w > boxW);\n    var hbarW = ScrollBox.barLength + 2 * ScrollBox.barPad;\n    var hbarH = ScrollBox.barWidth + 2 * ScrollBox.barPad;\n    // draw horizontal scrollbar on the bottom side\n    var hbarL = l;\n    var hbarT = t + h;\n\n    if(hbarT + hbarH > fullHeight) hbarT = fullHeight - hbarH;\n\n    var hbar = this.container.selectAll('rect.scrollbar-horizontal').data(\n            (needsHorizontalScrollBar) ? [0] : []);\n\n    hbar.exit()\n        .on('.drag', null)\n        .remove();\n\n    hbar.enter().append('rect')\n        .classed('scrollbar-horizontal', true)\n        .call(Color.fill, ScrollBox.barColor);\n\n    if(needsHorizontalScrollBar) {\n        this.hbar = hbar.attr({\n            'rx': ScrollBox.barRadius,\n            'ry': ScrollBox.barRadius,\n            'x': hbarL,\n            'y': hbarT,\n            'width': hbarW,\n            'height': hbarH\n        });\n\n        // hbar center moves between hbarXMin and hbarXMin + hbarTranslateMax\n        this._hbarXMin = hbarL + hbarW / 2;\n        this._hbarTranslateMax = boxW - hbarW;\n    } else {\n        delete this.hbar;\n        delete this._hbarXMin;\n        delete this._hbarTranslateMax;\n    }\n\n    // compute position of vertical scroll bar\n    var needsVerticalScrollBar = (h > boxH);\n    var vbarW = ScrollBox.barWidth + 2 * ScrollBox.barPad;\n    var vbarH = ScrollBox.barLength + 2 * ScrollBox.barPad;\n    // draw vertical scrollbar on the right side\n    var vbarL = l + w;\n    var vbarT = t;\n\n    if(vbarL + vbarW > fullWidth) vbarL = fullWidth - vbarW;\n\n    var vbar = this.container.selectAll('rect.scrollbar-vertical').data(\n            (needsVerticalScrollBar) ? [0] : []);\n\n    vbar.exit()\n        .on('.drag', null)\n        .remove();\n\n    vbar.enter().append('rect')\n        .classed('scrollbar-vertical', true)\n        .call(Color.fill, ScrollBox.barColor);\n\n    if(needsVerticalScrollBar) {\n        this.vbar = vbar.attr({\n            'rx': ScrollBox.barRadius,\n            'ry': ScrollBox.barRadius,\n            'x': vbarL,\n            'y': vbarT,\n            'width': vbarW,\n            'height': vbarH\n        });\n\n        // vbar center moves between vbarYMin and vbarYMin + vbarTranslateMax\n        this._vbarYMin = vbarT + vbarH / 2;\n        this._vbarTranslateMax = boxH - vbarH;\n    } else {\n        delete this.vbar;\n        delete this._vbarYMin;\n        delete this._vbarTranslateMax;\n    }\n\n    // setup a clip path (if scroll bars are needed)\n    var clipId = this.id;\n    var clipL = boxL - 0.5;\n    var clipR = (needsVerticalScrollBar) ? boxR + vbarW + 0.5 : boxR + 0.5;\n    var clipT = boxT - 0.5;\n    var clipB = (needsHorizontalScrollBar) ? boxB + hbarH + 0.5 : boxB + 0.5;\n\n    var clipPath = fullLayout._topdefs.selectAll('#' + clipId)\n        .data((needsHorizontalScrollBar || needsVerticalScrollBar) ? [0] : []);\n\n    clipPath.exit().remove();\n\n    clipPath.enter()\n        .append('clipPath').attr('id', clipId)\n        .append('rect');\n\n    if(needsHorizontalScrollBar || needsVerticalScrollBar) {\n        this._clipRect = clipPath.select('rect').attr({\n            x: Math.floor(clipL),\n            y: Math.floor(clipT),\n            width: Math.ceil(clipR) - Math.floor(clipL),\n            height: Math.ceil(clipB) - Math.floor(clipT)\n        });\n\n        this.container.call(Drawing.setClipUrl, clipId, this.gd);\n\n        this.bg.attr({\n            x: l,\n            y: t,\n            width: w,\n            height: h\n        });\n    } else {\n        this.bg.attr({\n            width: 0,\n            height: 0\n        });\n        this.container\n            .on('wheel', null)\n            .on('.drag', null)\n            .call(Drawing.setClipUrl, null);\n        delete this._clipRect;\n    }\n\n    // set up drag listeners (if scroll bars are needed)\n    if(needsHorizontalScrollBar || needsVerticalScrollBar) {\n        var onBoxDrag = d3.behavior.drag()\n            .on('dragstart', function() {\n                d3.event.sourceEvent.preventDefault();\n            })\n            .on('drag', this._onBoxDrag.bind(this));\n\n        this.container\n            .on('wheel', null)\n            .on('wheel', this._onBoxWheel.bind(this))\n            .on('.drag', null)\n            .call(onBoxDrag);\n\n        var onBarDrag = d3.behavior.drag()\n            .on('dragstart', function() {\n                d3.event.sourceEvent.preventDefault();\n                d3.event.sourceEvent.stopPropagation();\n            })\n            .on('drag', this._onBarDrag.bind(this));\n\n        if(needsHorizontalScrollBar) {\n            this.hbar\n                .on('.drag', null)\n                .call(onBarDrag);\n        }\n\n        if(needsVerticalScrollBar) {\n            this.vbar\n                .on('.drag', null)\n                .call(onBarDrag);\n        }\n    }\n\n    // set scrollbox translation\n    this.setTranslate(translateX, translateY);\n};\n\n/**\n * If present, remove clip-path and scrollbars\n *\n * @method\n */\nScrollBox.prototype.disable = function disable() {\n    if(this.hbar || this.vbar) {\n        this.bg.attr({\n            width: 0,\n            height: 0\n        });\n        this.container\n            .on('wheel', null)\n            .on('.drag', null)\n            .call(Drawing.setClipUrl, null);\n        delete this._clipRect;\n    }\n\n    if(this.hbar) {\n        this.hbar.on('.drag', null);\n        this.hbar.remove();\n        delete this.hbar;\n        delete this._hbarXMin;\n        delete this._hbarTranslateMax;\n    }\n\n    if(this.vbar) {\n        this.vbar.on('.drag', null);\n        this.vbar.remove();\n        delete this.vbar;\n        delete this._vbarYMin;\n        delete this._vbarTranslateMax;\n    }\n};\n\n/**\n * Handles scroll box drag events\n *\n * @method\n */\nScrollBox.prototype._onBoxDrag = function _onBoxDrag() {\n    var translateX = this.translateX;\n    var translateY = this.translateY;\n\n    if(this.hbar) {\n        translateX -= d3.event.dx;\n    }\n\n    if(this.vbar) {\n        translateY -= d3.event.dy;\n    }\n\n    this.setTranslate(translateX, translateY);\n};\n\n/**\n * Handles scroll box wheel events\n *\n * @method\n */\nScrollBox.prototype._onBoxWheel = function _onBoxWheel() {\n    var translateX = this.translateX;\n    var translateY = this.translateY;\n\n    if(this.hbar) {\n        translateX += d3.event.deltaY;\n    }\n\n    if(this.vbar) {\n        translateY += d3.event.deltaY;\n    }\n\n    this.setTranslate(translateX, translateY);\n};\n\n/**\n * Handles scroll bar drag events\n *\n * @method\n */\nScrollBox.prototype._onBarDrag = function _onBarDrag() {\n    var translateX = this.translateX;\n    var translateY = this.translateY;\n\n    if(this.hbar) {\n        var xMin = translateX + this._hbarXMin;\n        var xMax = xMin + this._hbarTranslateMax;\n        var x = Lib.constrain(d3.event.x, xMin, xMax);\n        var xf = (x - xMin) / (xMax - xMin);\n\n        var translateXMax = this.position.w - this._box.w;\n\n        translateX = xf * translateXMax;\n    }\n\n    if(this.vbar) {\n        var yMin = translateY + this._vbarYMin;\n        var yMax = yMin + this._vbarTranslateMax;\n        var y = Lib.constrain(d3.event.y, yMin, yMax);\n        var yf = (y - yMin) / (yMax - yMin);\n\n        var translateYMax = this.position.h - this._box.h;\n\n        translateY = yf * translateYMax;\n    }\n\n    this.setTranslate(translateX, translateY);\n};\n\n/**\n * Set clip path and scroll bar translate transform\n *\n * @method\n * @param {number}  [translateX=0]  Horizontal offset (in pixels)\n * @param {number}  [translateY=0]  Vertical offset (in pixels)\n */\nScrollBox.prototype.setTranslate = function setTranslate(translateX, translateY) {\n    // store translateX and translateY (needed by mouse event handlers)\n    var translateXMax = this.position.w - this._box.w;\n    var translateYMax = this.position.h - this._box.h;\n\n    translateX = Lib.constrain(translateX || 0, 0, translateXMax);\n    translateY = Lib.constrain(translateY || 0, 0, translateYMax);\n\n    this.translateX = translateX;\n    this.translateY = translateY;\n\n    this.container.call(Drawing.setTranslate,\n        this._box.l - this.position.l - translateX,\n        this._box.t - this.position.t - translateY);\n\n    if(this._clipRect) {\n        this._clipRect.attr({\n            x: Math.floor(this.position.l + translateX - 0.5),\n            y: Math.floor(this.position.t + translateY - 0.5)\n        });\n    }\n\n    if(this.hbar) {\n        var xf = translateX / translateXMax;\n\n        this.hbar.call(Drawing.setTranslate,\n            translateX + xf * this._hbarTranslateMax,\n            translateY);\n    }\n\n    if(this.vbar) {\n        var yf = translateY / translateYMax;\n\n        this.vbar.call(Drawing.setTranslate,\n            translateX,\n            translateY + yf * this._vbarTranslateMax);\n    }\n};\n","'use strict';\n\n// fraction of some size to get to a named position\nmodule.exports = {\n    // from bottom left: this is the origin of our paper-reference\n    // positioning system\n    FROM_BL: {\n        left: 0,\n        center: 0.5,\n        right: 1,\n        bottom: 0,\n        middle: 0.5,\n        top: 1\n    },\n    // from top left: this is the screen pixel positioning origin\n    FROM_TL: {\n        left: 0,\n        center: 0.5,\n        right: 1,\n        bottom: 1,\n        middle: 0.5,\n        top: 0\n    },\n    // from bottom right: sometimes you just need the opposite of ^^\n    FROM_BR: {\n        left: 1,\n        center: 0.5,\n        right: 0,\n        bottom: 0,\n        middle: 0.5,\n        top: 1\n    },\n    // multiple of fontSize to get the vertical offset between lines\n    LINE_SPACING: 1.3,\n\n    // multiple of fontSize to shift from the baseline\n    // to the cap (captical letter) line\n    // (to use when we don't calculate this shift from Drawing.bBox)\n    // This is an approximation since in reality cap height can differ\n    // from font to font. However, according to Wikipedia\n    //   an \"average\" font might have a cap height of 70% of the em\n    // https://en.wikipedia.org/wiki/Em_(typography)#History\n    CAP_SHIFT: 0.70,\n\n    // half the cap height (distance between baseline and cap line)\n    // of an \"average\" font (for more info see above).\n    MID_SHIFT: 0.35,\n\n    OPPOSITE_SIDE: {\n        left: 'right',\n        right: 'left',\n        top: 'bottom',\n        bottom: 'top'\n    }\n};\n","'use strict';\n\nmodule.exports = {\n    axisRefDescription: function(axisname, lower, upper) {\n        return [\n            'If set to a', axisname, 'axis id (e.g. *' + axisname + '* or',\n            '*' + axisname + '2*), the `' + axisname + '` position refers to a',\n            axisname, 'coordinate. If set to *paper*, the `' + axisname + '`',\n            'position refers to the distance from the', lower, 'of the plotting',\n            'area in normalized coordinates where *0* (*1*) corresponds to the',\n            lower, '(' + upper + '). If set to a', axisname, 'axis ID followed by',\n            '*domain* (separated by a space), the position behaves like for',\n            '*paper*, but refers to the distance in fractions of the domain',\n            'length from the', lower, 'of the domain of that axis: e.g.,',\n            '*' + axisname + '2 domain* refers to the domain of the second',\n            axisname, ' axis and a', axisname, 'position of 0.5 refers to the',\n            'point between the', lower, 'and the', upper, 'of the domain of the',\n            'second', axisname, 'axis.',\n        ].join(' ');\n    }\n};\n","'use strict';\n\nmodule.exports = {\n    FORMAT_LINK: 'https://github.com/d3/d3-3.x-api-reference/blob/master/Formatting.md#d3_format',\n    DATE_FORMAT_LINK: 'https://github.com/d3/d3-time-format#locale_format'\n};\n","'use strict';\n\nmodule.exports = {\n    COMPARISON_OPS: ['=', '!=', '<', '>=', '>', '<='],\n    COMPARISON_OPS2: ['=', '<', '>=', '>', '<='],\n    INTERVAL_OPS: ['[]', '()', '[)', '(]', '][', ')(', '](', ')['],\n    SET_OPS: ['{}', '}{'],\n    CONSTRAINT_REDUCTION: {\n        // for contour constraints, open/closed endpoints are equivalent\n        '=': '=',\n\n        '<': '<',\n        '<=': '<',\n\n        '>': '>',\n        '>=': '>',\n\n        '[]': '[]',\n        '()': '[]',\n        '[)': '[]',\n        '(]': '[]',\n\n        '][': '][',\n        ')(': '][',\n        '](': '][',\n        ')[': ']['\n    }\n};\n","'use strict';\n\n\nmodule.exports = {\n    /**\n     * Timing information for interactive elements\n     */\n    SHOW_PLACEHOLDER: 100,\n    HIDE_PLACEHOLDER: 1000,\n\n    // opacity dimming fraction for points that are not in selection\n    DESELECTDIM: 0.2\n};\n","'use strict';\n\n\nmodule.exports = {\n    /**\n     * Standardize all missing data in calcdata to use undefined\n     * never null or NaN.\n     * That way we can use !==undefined, or !== BADNUM,\n     * to test for real data\n     */\n    BADNUM: undefined,\n\n    /*\n     * Limit certain operations to well below floating point max value\n     * to avoid glitches: Make sure that even when you multiply it by the\n     * number of pixels on a giant screen it still works\n     */\n    FP_SAFE: Number.MAX_VALUE * 1e-4,\n\n    /*\n     * conversion of date units to milliseconds\n     * year and month constants are marked \"AVG\"\n     * to remind us that not all years and months\n     * have the same length\n     */\n    ONEMAXYEAR: 31622400000, // 366 * ONEDAY\n    ONEAVGYEAR: 31557600000, // 365.25 days\n    ONEMINYEAR: 31536000000, // 365 * ONEDAY\n    ONEMAXQUARTER: 7948800000, // 92 * ONEDAY\n    ONEAVGQUARTER: 7889400000, // 1/4 of ONEAVGYEAR\n    ONEMINQUARTER: 7689600000, // 89 * ONEDAY\n    ONEMAXMONTH: 2678400000, // 31 * ONEDAY\n    ONEAVGMONTH: 2629800000, // 1/12 of ONEAVGYEAR\n    ONEMINMONTH: 2419200000, // 28 * ONEDAY\n    ONEWEEK: 604800000, // 7 * ONEDAY\n    ONEDAY: 86400000, // 24 * ONEHOUR\n    ONEHOUR: 3600000,\n    ONEMIN: 60000,\n    ONESEC: 1000,\n\n    /*\n     * For fast conversion btwn world calendars and epoch ms, the Julian Day Number\n     * of the unix epoch. From calendars.instance().newDate(1970, 1, 1).toJD()\n     */\n    EPOCHJD: 2440587.5,\n\n    /*\n     * Are two values nearly equal? Compare to 1PPM\n     */\n    ALMOST_EQUAL: 1 - 1e-6,\n\n    /*\n     * If we're asked to clip a non-positive log value, how far off-screen\n     * do we put it?\n     */\n    LOG_CLIP: 10,\n\n    /*\n     * not a number, but for displaying numbers: the \"minus sign\" symbol is\n     * wider than the regular ascii dash \"-\"\n     */\n    MINUS_SIGN: '\\u2212'\n};\n","'use strict';\n\n\nexports.xmlns = 'http://www.w3.org/2000/xmlns/';\nexports.svg = 'http://www.w3.org/2000/svg';\nexports.xlink = 'http://www.w3.org/1999/xlink';\n\n// the 'old' d3 quirk got fix in v3.5.7\n// https://github.com/mbostock/d3/commit/a6f66e9dd37f764403fc7c1f26be09ab4af24fed\nexports.svgAttrs = {\n    xmlns: exports.svg,\n    'xmlns:xlink': exports.xlink\n};\n","'use strict';\n\nexports.version = require('./version').version;\n\n// inject promise polyfill\nrequire('native-promise-only');\n\n// inject plot css\nrequire('../build/plotcss');\n\n// include registry module and expose register method\nvar Registry = require('./registry');\nvar register = exports.register = Registry.register;\n\n// expose plot api methods\nvar plotApi = require('./plot_api');\nvar methodNames = Object.keys(plotApi);\nfor(var i = 0; i < methodNames.length; i++) {\n    var name = methodNames[i];\n    // _ -> private API methods, but still registered for internal use\n    if(name.charAt(0) !== '_') exports[name] = plotApi[name];\n    register({\n        moduleType: 'apiMethod',\n        name: name,\n        fn: plotApi[name]\n    });\n}\n\n// scatter is the only trace included by default\nregister(require('./traces/scatter'));\n\n// register all registrable components modules\nregister([\n    require('./components/legend'),\n    require('./components/fx'), // fx needs to come after legend\n    require('./components/annotations'),\n    require('./components/annotations3d'),\n    require('./components/shapes'),\n    require('./components/images'),\n    require('./components/updatemenus'),\n    require('./components/sliders'),\n    require('./components/rangeslider'),\n    require('./components/rangeselector'),\n    require('./components/grid'),\n    require('./components/errorbars'),\n    require('./components/colorscale'),\n    require('./components/colorbar'),\n    require('./components/modebar')\n]);\n\n// locales en and en-US are required for default behavior\nregister([\n    require('./locale-en'),\n    require('./locale-en-us')\n]);\n\n// locales that are present in the window should be loaded\nif(window.PlotlyLocales && Array.isArray(window.PlotlyLocales)) {\n    register(window.PlotlyLocales);\n    delete window.PlotlyLocales;\n}\n\n// plot icons\nexports.Icons = require('./fonts/ploticon');\n\n// unofficial 'beta' plot methods, use at your own risk\nvar Fx = require('./components/fx');\nvar Plots = require('./plots/plots');\n\nexports.Plots = {\n    resize: Plots.resize,\n    graphJson: Plots.graphJson,\n    sendDataToCloud: Plots.sendDataToCloud\n};\nexports.Fx = {\n    hover: Fx.hover,\n    unhover: Fx.unhover,\n    loneHover: Fx.loneHover,\n    loneUnhover: Fx.loneUnhover\n};\nexports.Snapshot = require('./snapshot');\nexports.PlotSchema = require('./plot_api/plot_schema');\n","'use strict';\n\nmodule.exports = {\n    'undo': {\n        'width': 857.1,\n        'height': 1000,\n        'path': 'm857 350q0-87-34-166t-91-137-137-92-166-34q-96 0-183 41t-147 114q-4 6-4 13t5 11l76 77q6 5 14 5 9-1 13-7 41-53 100-82t126-29q58 0 110 23t92 61 61 91 22 111-22 111-61 91-92 61-110 23q-55 0-105-20t-90-57l77-77q17-16 8-38-10-23-33-23h-250q-15 0-25 11t-11 25v250q0 24 22 33 22 10 39-8l72-72q60 57 137 88t159 31q87 0 166-34t137-92 91-137 34-166z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'home': {\n        'width': 928.6,\n        'height': 1000,\n        'path': 'm786 296v-267q0-15-11-26t-25-10h-214v214h-143v-214h-214q-15 0-25 10t-11 26v267q0 1 0 2t0 2l321 264 321-264q1-1 1-4z m124 39l-34-41q-5-5-12-6h-2q-7 0-12 3l-386 322-386-322q-7-4-13-4-7 2-12 7l-35 41q-4 5-3 13t6 12l401 334q18 15 42 15t43-15l136-114v109q0 8 5 13t13 5h107q8 0 13-5t5-13v-227l122-102q5-5 6-12t-4-13z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'camera-retro': {\n        'width': 1000,\n        'height': 1000,\n        'path': 'm518 386q0 8-5 13t-13 5q-37 0-63-27t-26-63q0-8 5-13t13-5 12 5 5 13q0 23 16 38t38 16q8 0 13 5t5 13z m125-73q0-59-42-101t-101-42-101 42-42 101 42 101 101 42 101-42 42-101z m-572-320h858v71h-858v-71z m643 320q0 89-62 152t-152 62-151-62-63-152 63-151 151-63 152 63 62 151z m-571 358h214v72h-214v-72z m-72-107h858v143h-462l-36-71h-360v-72z m929 143v-714q0-30-21-51t-50-21h-858q-29 0-50 21t-21 51v714q0 30 21 51t50 21h858q29 0 50-21t21-51z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'zoombox': {\n        'width': 1000,\n        'height': 1000,\n        'path': 'm1000-25l-250 251c40 63 63 138 63 218 0 224-182 406-407 406-224 0-406-182-406-406s183-406 407-406c80 0 155 22 218 62l250-250 125 125z m-812 250l0 438 437 0 0-438-437 0z m62 375l313 0 0-312-313 0 0 312z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'pan': {\n        'width': 1000,\n        'height': 1000,\n        'path': 'm1000 350l-187 188 0-125-250 0 0 250 125 0-188 187-187-187 125 0 0-250-250 0 0 125-188-188 186-187 0 125 252 0 0-250-125 0 187-188 188 188-125 0 0 250 250 0 0-126 187 188z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'zoom_plus': {\n        'width': 875,\n        'height': 1000,\n        'path': 'm1 787l0-875 875 0 0 875-875 0z m687-500l-187 0 0-187-125 0 0 187-188 0 0 125 188 0 0 187 125 0 0-187 187 0 0-125z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'zoom_minus': {\n        'width': 875,\n        'height': 1000,\n        'path': 'm0 788l0-876 875 0 0 876-875 0z m688-500l-500 0 0 125 500 0 0-125z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'autoscale': {\n        'width': 1000,\n        'height': 1000,\n        'path': 'm250 850l-187 0-63 0 0-62 0-188 63 0 0 188 187 0 0 62z m688 0l-188 0 0-62 188 0 0-188 62 0 0 188 0 62-62 0z m-875-938l0 188-63 0 0-188 0-62 63 0 187 0 0 62-187 0z m875 188l0-188-188 0 0-62 188 0 62 0 0 62 0 188-62 0z m-125 188l-1 0-93-94-156 156 156 156 92-93 2 0 0 250-250 0 0-2 93-92-156-156-156 156 94 92 0 2-250 0 0-250 0 0 93 93 157-156-157-156-93 94 0 0 0-250 250 0 0 0-94 93 156 157 156-157-93-93 0 0 250 0 0 250z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'tooltip_basic': {\n        'width': 1500,\n        'height': 1000,\n        'path': 'm375 725l0 0-375-375 375-374 0-1 1125 0 0 750-1125 0z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'tooltip_compare': {\n        'width': 1125,\n        'height': 1000,\n        'path': 'm187 786l0 2-187-188 188-187 0 0 937 0 0 373-938 0z m0-499l0 1-187-188 188-188 0 0 937 0 0 376-938-1z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'plotlylogo': {\n        'width': 1542,\n        'height': 1000,\n        'path': 'm0-10h182v-140h-182v140z m228 146h183v-286h-183v286z m225 714h182v-1000h-182v1000z m225-285h182v-715h-182v715z m225 142h183v-857h-183v857z m231-428h182v-429h-182v429z m225-291h183v-138h-183v138z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'z-axis': {\n        'width': 1000,\n        'height': 1000,\n        'path': 'm833 5l-17 108v41l-130-65 130-66c0 0 0 38 0 39 0-1 36-14 39-25 4-15-6-22-16-30-15-12-39-16-56-20-90-22-187-23-279-23-261 0-341 34-353 59 3 60 228 110 228 110-140-8-351-35-351-116 0-120 293-142 474-142 155 0 477 22 477 142 0 50-74 79-163 96z m-374 94c-58-5-99-21-99-40 0-24 65-43 144-43 79 0 143 19 143 43 0 19-42 34-98 40v216h87l-132 135-133-135h88v-216z m167 515h-136v1c16 16 31 34 46 52l84 109v54h-230v-71h124v-1c-16-17-28-32-44-51l-89-114v-51h245v72z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    '3d_rotate': {\n        'width': 1000,\n        'height': 1000,\n        'path': 'm922 660c-5 4-9 7-14 11-359 263-580-31-580-31l-102 28 58-400c0 1 1 1 2 2 118 108 351 249 351 249s-62 27-100 42c88 83 222 183 347 122 16-8 30-17 44-27-2 1-4 2-6 4z m36-329c0 0 64 229-88 296-62 27-124 14-175-11 157-78 225-208 249-266 8-19 11-31 11-31 2 5 6 15 11 32-5-13-8-20-8-20z m-775-239c70-31 117-50 198-32-121 80-199 346-199 346l-96-15-58-12c0 0 55-226 155-287z m603 133l-317-139c0 0 4-4 19-14 7-5 24-15 24-15s-177-147-389 4c235-287 536-112 536-112l31-22 100 299-4-1z m-298-153c6-4 14-9 24-15 0 0-17 10-24 15z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'camera': {\n        'width': 1000,\n        'height': 1000,\n        'path': 'm500 450c-83 0-150-67-150-150 0-83 67-150 150-150 83 0 150 67 150 150 0 83-67 150-150 150z m400 150h-120c-16 0-34 13-39 29l-31 93c-6 15-23 28-40 28h-340c-16 0-34-13-39-28l-31-94c-6-15-23-28-40-28h-120c-55 0-100-45-100-100v-450c0-55 45-100 100-100h800c55 0 100 45 100 100v450c0 55-45 100-100 100z m-400-550c-138 0-250 112-250 250 0 138 112 250 250 250 138 0 250-112 250-250 0-138-112-250-250-250z m365 380c-19 0-35 16-35 35 0 19 16 35 35 35 19 0 35-16 35-35 0-19-16-35-35-35z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'movie': {\n        'width': 1000,\n        'height': 1000,\n        'path': 'm938 413l-188-125c0 37-17 71-44 94 64 38 107 107 107 187 0 121-98 219-219 219-121 0-219-98-219-219 0-61 25-117 66-156h-115c30 33 49 76 49 125 0 103-84 187-187 187s-188-84-188-187c0-57 26-107 65-141-38-22-65-62-65-109v-250c0-70 56-126 125-126h500c69 0 125 56 125 126l188-126c34 0 62 28 62 63v375c0 35-28 63-62 63z m-750 0c-69 0-125 56-125 125s56 125 125 125 125-56 125-125-56-125-125-125z m406-1c-87 0-157 70-157 157 0 86 70 156 157 156s156-70 156-156-70-157-156-157z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'question': {\n        'width': 857.1,\n        'height': 1000,\n        'path': 'm500 82v107q0 8-5 13t-13 5h-107q-8 0-13-5t-5-13v-107q0-8 5-13t13-5h107q8 0 13 5t5 13z m143 375q0 49-31 91t-77 65-95 23q-136 0-207-119-9-14 4-24l74-55q4-4 10-4 9 0 14 7 30 38 48 51 19 14 48 14 27 0 48-15t21-33q0-21-11-34t-38-25q-35-16-65-48t-29-70v-20q0-8 5-13t13-5h107q8 0 13 5t5 13q0 10 12 27t30 28q18 10 28 16t25 19 25 27 16 34 7 45z m214-107q0-117-57-215t-156-156-215-58-216 58-155 156-58 215 58 215 155 156 216 58 215-58 156-156 57-215z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'disk': {\n        'width': 857.1,\n        'height': 1000,\n        'path': 'm214-7h429v214h-429v-214z m500 0h72v500q0 8-6 21t-11 20l-157 156q-5 6-19 12t-22 5v-232q0-22-15-38t-38-16h-322q-22 0-37 16t-16 38v232h-72v-714h72v232q0 22 16 38t37 16h465q22 0 38-16t15-38v-232z m-214 518v178q0 8-5 13t-13 5h-107q-7 0-13-5t-5-13v-178q0-8 5-13t13-5h107q7 0 13 5t5 13z m357-18v-518q0-22-15-38t-38-16h-750q-23 0-38 16t-16 38v750q0 22 16 38t38 16h517q23 0 50-12t42-26l156-157q16-15 27-42t11-49z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'drawopenpath': {\n        'width': 70,\n        'height': 70,\n        'path': 'M33.21,85.65a7.31,7.31,0,0,1-2.59-.48c-8.16-3.11-9.27-19.8-9.88-41.3-.1-3.58-.19-6.68-.35-9-.15-2.1-.67-3.48-1.43-3.79-2.13-.88-7.91,2.32-12,5.86L3,32.38c1.87-1.64,11.55-9.66,18.27-6.9,2.13.87,4.75,3.14,5.17,9,.17,2.43.26,5.59.36,9.25a224.17,224.17,0,0,0,1.5,23.4c1.54,10.76,4,12.22,4.48,12.4.84.32,2.79-.46,5.76-3.59L43,80.07C41.53,81.57,37.68,85.64,33.21,85.65ZM74.81,69a11.34,11.34,0,0,0,6.09-6.72L87.26,44.5,74.72,32,56.9,38.35c-2.37.86-5.57,3.42-6.61,6L38.65,72.14l8.42,8.43ZM55,46.27a7.91,7.91,0,0,1,3.64-3.17l14.8-5.3,8,8L76.11,60.6l-.06.19a6.37,6.37,0,0,1-3,3.43L48.25,74.59,44.62,71Zm16.57,7.82A6.9,6.9,0,1,0,64.64,61,6.91,6.91,0,0,0,71.54,54.09Zm-4.05,0a2.85,2.85,0,1,1-2.85-2.85A2.86,2.86,0,0,1,67.49,54.09Zm-4.13,5.22L60.5,56.45,44.26,72.7l2.86,2.86ZM97.83,35.67,84.14,22l-8.57,8.57L89.26,44.24Zm-13.69-8,8,8-2.85,2.85-8-8Z',\n        'transform': 'matrix(1 0 0 1 -15 -15)'\n    },\n    'drawclosedpath': {\n        'width': 90,\n        'height': 90,\n        'path': 'M88.41,21.12a26.56,26.56,0,0,0-36.18,0l-2.07,2-2.07-2a26.57,26.57,0,0,0-36.18,0,23.74,23.74,0,0,0,0,34.8L48,90.12a3.22,3.22,0,0,0,4.42,0l36-34.21a23.73,23.73,0,0,0,0-34.79ZM84,51.24,50.16,83.35,16.35,51.25a17.28,17.28,0,0,1,0-25.47,20,20,0,0,1,27.3,0l4.29,4.07a3.23,3.23,0,0,0,4.44,0l4.29-4.07a20,20,0,0,1,27.3,0,17.27,17.27,0,0,1,0,25.46ZM66.76,47.68h-33v6.91h33ZM53.35,35H46.44V68h6.91Z',\n        'transform': 'matrix(1 0 0 1 -5 -5)'\n    },\n    'lasso': {\n        'width': 1031,\n        'height': 1000,\n        'path': 'm1018 538c-36 207-290 336-568 286-277-48-473-256-436-463 10-57 36-108 76-151-13-66 11-137 68-183 34-28 75-41 114-42l-55-70 0 0c-2-1-3-2-4-3-10-14-8-34 5-45 14-11 34-8 45 4 1 1 2 3 2 5l0 0 113 140c16 11 31 24 45 40 4 3 6 7 8 11 48-3 100 0 151 9 278 48 473 255 436 462z m-624-379c-80 14-149 48-197 96 42 42 109 47 156 9 33-26 47-66 41-105z m-187-74c-19 16-33 37-39 60 50-32 109-55 174-68-42-25-95-24-135 8z m360 75c-34-7-69-9-102-8 8 62-16 128-68 170-73 59-175 54-244-5-9 20-16 40-20 61-28 159 121 317 333 354s407-60 434-217c28-159-121-318-333-355z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'selectbox': {\n        'width': 1000,\n        'height': 1000,\n        'path': 'm0 850l0-143 143 0 0 143-143 0z m286 0l0-143 143 0 0 143-143 0z m285 0l0-143 143 0 0 143-143 0z m286 0l0-143 143 0 0 143-143 0z m-857-286l0-143 143 0 0 143-143 0z m857 0l0-143 143 0 0 143-143 0z m-857-285l0-143 143 0 0 143-143 0z m857 0l0-143 143 0 0 143-143 0z m-857-286l0-143 143 0 0 143-143 0z m286 0l0-143 143 0 0 143-143 0z m285 0l0-143 143 0 0 143-143 0z m286 0l0-143 143 0 0 143-143 0z',\n        'transform': 'matrix(1 0 0 -1 0 850)'\n    },\n    'drawline': {\n        'width': 70,\n        'height': 70,\n        'path': 'M60.64,62.3a11.29,11.29,0,0,0,6.09-6.72l6.35-17.72L60.54,25.31l-17.82,6.4c-2.36.86-5.57,3.41-6.6,6L24.48,65.5l8.42,8.42ZM40.79,39.63a7.89,7.89,0,0,1,3.65-3.17l14.79-5.31,8,8L61.94,54l-.06.19a6.44,6.44,0,0,1-3,3.43L34.07,68l-3.62-3.63Zm16.57,7.81a6.9,6.9,0,1,0-6.89,6.9A6.9,6.9,0,0,0,57.36,47.44Zm-4,0a2.86,2.86,0,1,1-2.85-2.85A2.86,2.86,0,0,1,53.32,47.44Zm-4.13,5.22L46.33,49.8,30.08,66.05l2.86,2.86ZM83.65,29,70,15.34,61.4,23.9,75.09,37.59ZM70,21.06l8,8-2.84,2.85-8-8ZM87,80.49H10.67V87H87Z',\n        'transform': 'matrix(1 0 0 1 -15 -15)'\n    },\n    'drawrect': {\n        'width': 80,\n        'height': 80,\n        'path': 'M78,22V79H21V22H78m9-9H12V88H87V13ZM68,46.22H31V54H68ZM53,32H45.22V69H53Z',\n        'transform': 'matrix(1 0 0 1 -10 -10)'\n    },\n    'drawcircle': {\n        'width': 80,\n        'height': 80,\n        'path': 'M50,84.72C26.84,84.72,8,69.28,8,50.3S26.84,15.87,50,15.87,92,31.31,92,50.3,73.16,84.72,50,84.72Zm0-60.59c-18.6,0-33.74,11.74-33.74,26.17S31.4,76.46,50,76.46,83.74,64.72,83.74,50.3,68.6,24.13,50,24.13Zm17.15,22h-34v7.11h34Zm-13.8-13H46.24v34h7.11Z',\n        'transform': 'matrix(1 0 0 1 -10 -10)'\n    },\n    'eraseshape': {\n        'width': 80,\n        'height': 80,\n        'path': 'M82.77,78H31.85L6,49.57,31.85,21.14H82.77a8.72,8.72,0,0,1,8.65,8.77V69.24A8.72,8.72,0,0,1,82.77,78ZM35.46,69.84H82.77a.57.57,0,0,0,.49-.6V29.91a.57.57,0,0,0-.49-.61H35.46L17,49.57Zm32.68-34.7-24,24,5,5,24-24Zm-19,.53-5,5,24,24,5-5Z',\n        'transform': 'matrix(1 0 0 1 -10 -10)'\n    },\n    'spikeline': {\n        'width': 1000,\n        'height': 1000,\n        'path': 'M512 409c0-57-46-104-103-104-57 0-104 47-104 104 0 57 47 103 104 103 57 0 103-46 103-103z m-327-39l92 0 0 92-92 0z m-185 0l92 0 0 92-92 0z m370-186l92 0 0 93-92 0z m0-184l92 0 0 92-92 0z',\n        'transform': 'matrix(1.5 0 0 -1.5 0 850)'\n    },\n    'pencil': {\n        'width': 1792,\n        'height': 1792,\n        'path': 'M491 1536l91-91-235-235-91 91v107h128v128h107zm523-928q0-22-22-22-10 0-17 7l-542 542q-7 7-7 17 0 22 22 22 10 0 17-7l542-542q7-7 7-17zm-54-192l416 416-832 832h-416v-416zm683 96q0 53-37 90l-166 166-416-416 166-165q36-38 90-38 53 0 91 38l235 234q37 39 37 91z',\n        'transform': 'matrix(1 0 0 1 0 1)'\n    },\n    'newplotlylogo': {\n        'name': 'newplotlylogo',\n        'svg': '<svg xmlns=\\'http://www.w3.org/2000/svg\\' viewBox=\\'0 0 132 132\\'><defs><style>.cls-1 {fill: #3f4f75;} .cls-2 {fill: #80cfbe;} .cls-3 {fill: #fff;}</style></defs><title>plotly-logomark</title><g id=\\'symbol\\'><rect class=\\'cls-1\\' width=\\'132\\' height=\\'132\\' rx=\\'6\\' ry=\\'6\\'/><circle class=\\'cls-2\\' cx=\\'78\\' cy=\\'54\\' r=\\'6\\'/><circle class=\\'cls-2\\' cx=\\'102\\' cy=\\'30\\' r=\\'6\\'/><circle class=\\'cls-2\\' cx=\\'78\\' cy=\\'30\\' r=\\'6\\'/><circle class=\\'cls-2\\' cx=\\'54\\' cy=\\'30\\' r=\\'6\\'/><circle class=\\'cls-2\\' cx=\\'30\\' cy=\\'30\\' r=\\'6\\'/><circle class=\\'cls-2\\' cx=\\'30\\' cy=\\'54\\' r=\\'6\\'/><path class=\\'cls-3\\' d=\\'M30,72a6,6,0,0,0-6,6v24a6,6,0,0,0,12,0V78A6,6,0,0,0,30,72Z\\'/><path class=\\'cls-3\\' d=\\'M78,72a6,6,0,0,0-6,6v24a6,6,0,0,0,12,0V78A6,6,0,0,0,78,72Z\\'/><path class=\\'cls-3\\' d=\\'M54,48a6,6,0,0,0-6,6v48a6,6,0,0,0,12,0V54A6,6,0,0,0,54,48Z\\'/><path class=\\'cls-3\\' d=\\'M102,48a6,6,0,0,0-6,6v48a6,6,0,0,0,12,0V54A6,6,0,0,0,102,48Z\\'/></g></svg>'\n    }\n};\n","'use strict';\n\n\n/**\n * Determine the position anchor property of x/y xanchor/yanchor components.\n *\n * - values < 1/3 align the low side at that fraction,\n * - values [1/3, 2/3] align the center at that fraction,\n * - values > 2/3 align the right at that fraction.\n */\n\n\nexports.isLeftAnchor = function isLeftAnchor(opts) {\n    return (\n      opts.xanchor === 'left' ||\n      (opts.xanchor === 'auto' && opts.x <= 1 / 3)\n    );\n};\n\nexports.isCenterAnchor = function isCenterAnchor(opts) {\n    return (\n        opts.xanchor === 'center' ||\n        (opts.xanchor === 'auto' && opts.x > 1 / 3 && opts.x < 2 / 3)\n    );\n};\n\nexports.isRightAnchor = function isRightAnchor(opts) {\n    return (\n      opts.xanchor === 'right' ||\n      (opts.xanchor === 'auto' && opts.x >= 2 / 3)\n    );\n};\n\nexports.isTopAnchor = function isTopAnchor(opts) {\n    return (\n        opts.yanchor === 'top' ||\n        (opts.yanchor === 'auto' && opts.y >= 2 / 3)\n    );\n};\n\nexports.isMiddleAnchor = function isMiddleAnchor(opts) {\n    return (\n        opts.yanchor === 'middle' ||\n        (opts.yanchor === 'auto' && opts.y > 1 / 3 && opts.y < 2 / 3)\n    );\n};\n\nexports.isBottomAnchor = function isBottomAnchor(opts) {\n    return (\n      opts.yanchor === 'bottom' ||\n      (opts.yanchor === 'auto' && opts.y <= 1 / 3)\n    );\n};\n","'use strict';\n\nvar modModule = require('./mod');\nvar mod = modModule.mod;\nvar modHalf = modModule.modHalf;\n\nvar PI = Math.PI;\nvar twoPI = 2 * PI;\n\nfunction deg2rad(deg) { return deg / 180 * PI; }\n\nfunction rad2deg(rad) { return rad / PI * 180; }\n\n/**\n * is sector a full circle?\n * ... this comes up a lot in SVG path-drawing routines\n *\n * N.B. we consider all sectors that span more that 2pi 'full' circles\n *\n * @param {2-item array} aBnds : angular bounds in *radians*\n * @return {boolean}\n */\nfunction isFullCircle(aBnds) {\n    return Math.abs(aBnds[1] - aBnds[0]) > twoPI - 1e-14;\n}\n\n/**\n * angular delta between angle 'a' and 'b'\n * solution taken from: https://stackoverflow.com/a/2007279\n *\n * @param {number} a : first angle in *radians*\n * @param {number} b : second angle in *radians*\n * @return {number} angular delta in *radians*\n */\nfunction angleDelta(a, b) {\n    return modHalf(b - a, twoPI);\n}\n\n/**\n * angular distance between angle 'a' and 'b'\n *\n * @param {number} a : first angle in *radians*\n * @param {number} b : second angle in *radians*\n * @return {number} angular distance in *radians*\n */\nfunction angleDist(a, b) {\n    return Math.abs(angleDelta(a, b));\n}\n\n/**\n * is angle inside sector?\n *\n * @param {number} a : angle to test in *radians*\n * @param {2-item array} aBnds : sector's angular bounds in *radians*\n * @param {boolean}\n */\nfunction isAngleInsideSector(a, aBnds) {\n    if(isFullCircle(aBnds)) return true;\n\n    var s0, s1;\n\n    if(aBnds[0] < aBnds[1]) {\n        s0 = aBnds[0];\n        s1 = aBnds[1];\n    } else {\n        s0 = aBnds[1];\n        s1 = aBnds[0];\n    }\n\n    s0 = mod(s0, twoPI);\n    s1 = mod(s1, twoPI);\n    if(s0 > s1) s1 += twoPI;\n\n    var a0 = mod(a, twoPI);\n    var a1 = a0 + twoPI;\n\n    return (a0 >= s0 && a0 <= s1) || (a1 >= s0 && a1 <= s1);\n}\n\n/**\n * is pt (r,a) inside sector?\n *\n * @param {number} r : pt's radial coordinate\n * @param {number} a : pt's angular coordinate in *radians*\n * @param {2-item array} rBnds : sector's radial bounds\n * @param {2-item array} aBnds : sector's angular bounds in *radians*\n * @return {boolean}\n */\nfunction isPtInsideSector(r, a, rBnds, aBnds) {\n    if(!isAngleInsideSector(a, aBnds)) return false;\n\n    var r0, r1;\n\n    if(rBnds[0] < rBnds[1]) {\n        r0 = rBnds[0];\n        r1 = rBnds[1];\n    } else {\n        r0 = rBnds[1];\n        r1 = rBnds[0];\n    }\n\n    return r >= r0 && r <= r1;\n}\n\n// common to pathArc, pathSector and pathAnnulus\nfunction _path(r0, r1, a0, a1, cx, cy, isClosed) {\n    cx = cx || 0;\n    cy = cy || 0;\n\n    var isCircle = isFullCircle([a0, a1]);\n    var aStart, aMid, aEnd;\n    var rStart, rEnd;\n\n    if(isCircle) {\n        aStart = 0;\n        aMid = PI;\n        aEnd = twoPI;\n    } else {\n        if(a0 < a1) {\n            aStart = a0;\n            aEnd = a1;\n        } else {\n            aStart = a1;\n            aEnd = a0;\n        }\n    }\n\n    if(r0 < r1) {\n        rStart = r0;\n        rEnd = r1;\n    } else {\n        rStart = r1;\n        rEnd = r0;\n    }\n\n    // N.B. svg coordinates here, where y increases downward\n    function pt(r, a) {\n        return [r * Math.cos(a) + cx, cy - r * Math.sin(a)];\n    }\n\n    var largeArc = Math.abs(aEnd - aStart) <= PI ? 0 : 1;\n    function arc(r, a, cw) {\n        return 'A' + [r, r] + ' ' + [0, largeArc, cw] + ' ' + pt(r, a);\n    }\n\n    var p;\n\n    if(isCircle) {\n        if(rStart === null) {\n            p = 'M' + pt(rEnd, aStart) +\n                arc(rEnd, aMid, 0) +\n                arc(rEnd, aEnd, 0) + 'Z';\n        } else {\n            p = 'M' + pt(rStart, aStart) +\n                arc(rStart, aMid, 0) +\n                arc(rStart, aEnd, 0) + 'Z' +\n                'M' + pt(rEnd, aStart) +\n                arc(rEnd, aMid, 1) +\n                arc(rEnd, aEnd, 1) + 'Z';\n        }\n    } else {\n        if(rStart === null) {\n            p = 'M' + pt(rEnd, aStart) + arc(rEnd, aEnd, 0);\n            if(isClosed) p += 'L0,0Z';\n        } else {\n            p = 'M' + pt(rStart, aStart) +\n                'L' + pt(rEnd, aStart) +\n                arc(rEnd, aEnd, 0) +\n                'L' + pt(rStart, aEnd) +\n                arc(rStart, aStart, 1) + 'Z';\n        }\n    }\n\n    return p;\n}\n\n/**\n * path an arc\n *\n * @param {number} r : radius\n * @param {number} a0 : first angular coordinate in *radians*\n * @param {number} a1 : second angular coordinate in *radians*\n * @param {number (optional)} cx : x coordinate of center\n * @param {number (optional)} cy : y coordinate of center\n * @return {string} svg path\n */\nfunction pathArc(r, a0, a1, cx, cy) {\n    return _path(null, r, a0, a1, cx, cy, 0);\n}\n\n/**\n * path a sector\n *\n * @param {number} r : radius\n * @param {number} a0 : first angular coordinate in *radians*\n * @param {number} a1 : second angular coordinate in *radians*\n * @param {number (optional)} cx : x coordinate of center\n * @param {number (optional)} cy : y coordinate of center\n * @return {string} svg path\n */\nfunction pathSector(r, a0, a1, cx, cy) {\n    return _path(null, r, a0, a1, cx, cy, 1);\n}\n\n/**\n * path an annulus\n *\n * @param {number} r0 : first radial coordinate\n * @param {number} r1 : second radial coordinate\n * @param {number} a0 : first angular coordinate in *radians*\n * @param {number} a1 : second angular coordinate in *radians*\n * @param {number (optional)} cx : x coordinate of center\n * @param {number (optional)} cy : y coordinate of center\n * @return {string} svg path\n */\nfunction pathAnnulus(r0, r1, a0, a1, cx, cy) {\n    return _path(r0, r1, a0, a1, cx, cy, 1);\n}\n\nmodule.exports = {\n    deg2rad: deg2rad,\n    rad2deg: rad2deg,\n    angleDelta: angleDelta,\n    angleDist: angleDist,\n    isFullCircle: isFullCircle,\n    isAngleInsideSector: isAngleInsideSector,\n    isPtInsideSector: isPtInsideSector,\n    pathArc: pathArc,\n    pathSector: pathSector,\n    pathAnnulus: pathAnnulus\n};\n","'use strict';\n\nvar isArray = Array.isArray;\n\nvar ab = ArrayBuffer;\nvar dv = DataView;\n\nfunction isTypedArray(a) {\n    return ab.isView(a) && !(a instanceof dv);\n}\nexports.isTypedArray = isTypedArray;\n\nfunction isArrayOrTypedArray(a) {\n    return isArray(a) || isTypedArray(a);\n}\nexports.isArrayOrTypedArray = isArrayOrTypedArray;\n\n/*\n * Test whether an input object is 1D.\n *\n * Assumes we already know the object is an array.\n *\n * Looks only at the first element, if the dimensionality is\n * not consistent we won't figure that out here.\n */\nfunction isArray1D(a) {\n    return !isArrayOrTypedArray(a[0]);\n}\nexports.isArray1D = isArray1D;\n\n/*\n * Ensures an array has the right amount of storage space. If it doesn't\n * exist, it creates an array. If it does exist, it returns it if too\n * short or truncates it in-place.\n *\n * The goal is to just reuse memory to avoid a bit of excessive garbage\n * collection.\n */\nexports.ensureArray = function(out, n) {\n    // TODO: typed array support here? This is only used in\n    // traces/carpet/compute_control_points\n    if(!isArray(out)) out = [];\n\n    // If too long, truncate. (If too short, it will grow\n    // automatically so we don't care about that case)\n    out.length = n;\n\n    return out;\n};\n\n/*\n * TypedArray-compatible concatenation of n arrays\n * if all arrays are the same type it will preserve that type,\n * otherwise it falls back on Array.\n * Also tries to avoid copying, in case one array has zero length\n * But never mutates an existing array\n */\nexports.concat = function() {\n    var args = [];\n    var allArray = true;\n    var totalLen = 0;\n\n    var _constructor, arg0, i, argi, posi, leni, out, j;\n\n    for(i = 0; i < arguments.length; i++) {\n        argi = arguments[i];\n        leni = argi.length;\n        if(leni) {\n            if(arg0) args.push(argi);\n            else {\n                arg0 = argi;\n                posi = leni;\n            }\n\n            if(isArray(argi)) {\n                _constructor = false;\n            } else {\n                allArray = false;\n                if(!totalLen) {\n                    _constructor = argi.constructor;\n                } else if(_constructor !== argi.constructor) {\n                    // TODO: in principle we could upgrade here,\n                    // ie keep typed array but convert all to Float64Array?\n                    _constructor = false;\n                }\n            }\n\n            totalLen += leni;\n        }\n    }\n\n    if(!totalLen) return [];\n    if(!args.length) return arg0;\n\n    if(allArray) return arg0.concat.apply(arg0, args);\n    if(_constructor) {\n        // matching typed arrays\n        out = new _constructor(totalLen);\n        out.set(arg0);\n        for(i = 0; i < args.length; i++) {\n            argi = args[i];\n            out.set(argi, posi);\n            posi += argi.length;\n        }\n        return out;\n    }\n\n    // mismatched types or Array + typed\n    out = new Array(totalLen);\n    for(j = 0; j < arg0.length; j++) out[j] = arg0[j];\n    for(i = 0; i < args.length; i++) {\n        argi = args[i];\n        for(j = 0; j < argi.length; j++) out[posi + j] = argi[j];\n        posi += j;\n    }\n    return out;\n};\n\nexports.maxRowLength = function(z) {\n    return _rowLength(z, Math.max, 0);\n};\n\nexports.minRowLength = function(z) {\n    return _rowLength(z, Math.min, Infinity);\n};\n\nfunction _rowLength(z, fn, len0) {\n    if(isArrayOrTypedArray(z)) {\n        if(isArrayOrTypedArray(z[0])) {\n            var len = len0;\n            for(var i = 0; i < z.length; i++) {\n                len = fn(len, z[i].length);\n            }\n            return len;\n        } else {\n            return z.length;\n        }\n    }\n    return 0;\n}\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\nvar BADNUM = require('../constants/numerical').BADNUM;\n\n// precompile for speed\nvar JUNK = /^['\"%,$#\\s']+|[, ]|['\"%,$#\\s']+$/g;\n\n/**\n * cleanNumber: remove common leading and trailing cruft\n * Always returns either a number or BADNUM.\n */\nmodule.exports = function cleanNumber(v) {\n    if(typeof v === 'string') {\n        v = v.replace(JUNK, '');\n    }\n\n    if(isNumeric(v)) return Number(v);\n\n    return BADNUM;\n};\n","'use strict';\n\n/**\n * Clear gl frame (if any). This is a common pattern as\n * we usually set `preserveDrawingBuffer: true` during\n * gl context creation (e.g. via `reglUtils.prepare`).\n *\n * @param {DOM node or object} gd : graph div object\n */\nmodule.exports = function clearGlCanvases(gd) {\n    var fullLayout = gd._fullLayout;\n\n    if(fullLayout._glcanvas && fullLayout._glcanvas.size()) {\n        fullLayout._glcanvas.each(function(d) {\n            if(d.regl) d.regl.clear({color: true, depth: true});\n        });\n    }\n};\n","'use strict';\n\n/**\n * Clear responsive handlers (if any).\n *\n * @param {DOM node or object} gd : graph div object\n */\nmodule.exports = function clearResponsive(gd) {\n    if(gd._responsiveChartHandler) {\n        window.removeEventListener('resize', gd._responsiveChartHandler);\n        delete gd._responsiveChartHandler;\n    }\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar tinycolor = require('tinycolor2');\n\nvar baseTraceAttrs = require('../plots/attributes');\nvar colorscales = require('../components/colorscale/scales');\nvar Color = require('../components/color');\nvar DESELECTDIM = require('../constants/interactions').DESELECTDIM;\n\nvar nestedProperty = require('./nested_property');\nvar counterRegex = require('./regex').counter;\nvar modHalf = require('./mod').modHalf;\nvar isArrayOrTypedArray = require('./array').isArrayOrTypedArray;\n\nexports.valObjectMeta = {\n    data_array: {\n        // You can use *dflt=[] to force said array to exist though.\n        description: [\n            'An {array} of data.',\n            'The value MUST be an {array}, or we ignore it.',\n            'Note that typed arrays (e.g. Float32Array) are supported.'\n        ].join(' '),\n        requiredOpts: [],\n        otherOpts: ['dflt'],\n        coerceFunction: function(v, propOut, dflt) {\n            // TODO maybe `v: {type: 'float32', vals: [/* ... */]}` also\n            if(isArrayOrTypedArray(v)) propOut.set(v);\n            else if(dflt !== undefined) propOut.set(dflt);\n        }\n    },\n    enumerated: {\n        description: [\n            'Enumerated value type. The available values are listed',\n            'in `values`.'\n        ].join(' '),\n        requiredOpts: ['values'],\n        otherOpts: ['dflt', 'coerceNumber', 'arrayOk'],\n        coerceFunction: function(v, propOut, dflt, opts) {\n            if(opts.coerceNumber) v = +v;\n            if(opts.values.indexOf(v) === -1) propOut.set(dflt);\n            else propOut.set(v);\n        },\n        validateFunction: function(v, opts) {\n            if(opts.coerceNumber) v = +v;\n\n            var values = opts.values;\n            for(var i = 0; i < values.length; i++) {\n                var k = String(values[i]);\n\n                if((k.charAt(0) === '/' && k.charAt(k.length - 1) === '/')) {\n                    var regex = new RegExp(k.substr(1, k.length - 2));\n                    if(regex.test(v)) return true;\n                } else if(v === values[i]) return true;\n            }\n            return false;\n        }\n    },\n    'boolean': {\n        description: 'A boolean (true/false) value.',\n        requiredOpts: [],\n        otherOpts: ['dflt'],\n        coerceFunction: function(v, propOut, dflt) {\n            if(v === true || v === false) propOut.set(v);\n            else propOut.set(dflt);\n        }\n    },\n    number: {\n        description: [\n            'A number or a numeric value',\n            '(e.g. a number inside a string).',\n            'When applicable, values greater (less) than `max` (`min`)',\n            'are coerced to the `dflt`.'\n        ].join(' '),\n        requiredOpts: [],\n        otherOpts: ['dflt', 'min', 'max', 'arrayOk'],\n        coerceFunction: function(v, propOut, dflt, opts) {\n            if(!isNumeric(v) ||\n                    (opts.min !== undefined && v < opts.min) ||\n                    (opts.max !== undefined && v > opts.max)) {\n                propOut.set(dflt);\n            } else propOut.set(+v);\n        }\n    },\n    integer: {\n        description: [\n            'An integer or an integer inside a string.',\n            'When applicable, values greater (less) than `max` (`min`)',\n            'are coerced to the `dflt`.'\n        ].join(' '),\n        requiredOpts: [],\n        otherOpts: ['dflt', 'min', 'max', 'arrayOk'],\n        coerceFunction: function(v, propOut, dflt, opts) {\n            if(v % 1 || !isNumeric(v) ||\n                    (opts.min !== undefined && v < opts.min) ||\n                    (opts.max !== undefined && v > opts.max)) {\n                propOut.set(dflt);\n            } else propOut.set(+v);\n        }\n    },\n    string: {\n        description: [\n            'A string value.',\n            'Numbers are converted to strings except for attributes with',\n            '`strict` set to true.'\n        ].join(' '),\n        requiredOpts: [],\n        // TODO 'values shouldn't be in there (edge case: 'dash' in Scatter)\n        otherOpts: ['dflt', 'noBlank', 'strict', 'arrayOk', 'values'],\n        coerceFunction: function(v, propOut, dflt, opts) {\n            if(typeof v !== 'string') {\n                var okToCoerce = (typeof v === 'number');\n\n                if(opts.strict === true || !okToCoerce) propOut.set(dflt);\n                else propOut.set(String(v));\n            } else if(opts.noBlank && !v) propOut.set(dflt);\n            else propOut.set(v);\n        }\n    },\n    color: {\n        description: [\n            'A string describing color.',\n            'Supported formats:',\n            '- hex (e.g. \\'#d3d3d3\\')',\n            '- rgb (e.g. \\'rgb(255, 0, 0)\\')',\n            '- rgba (e.g. \\'rgb(255, 0, 0, 0.5)\\')',\n            '- hsl (e.g. \\'hsl(0, 100%, 50%)\\')',\n            '- hsv (e.g. \\'hsv(0, 100%, 100%)\\')',\n            '- named colors (full list: http://www.w3.org/TR/css3-color/#svg-color)'\n        ].join(' '),\n        requiredOpts: [],\n        otherOpts: ['dflt', 'arrayOk'],\n        coerceFunction: function(v, propOut, dflt) {\n            if(tinycolor(v).isValid()) propOut.set(v);\n            else propOut.set(dflt);\n        }\n    },\n    colorlist: {\n        description: [\n            'A list of colors.',\n            'Must be an {array} containing valid colors.',\n        ].join(' '),\n        requiredOpts: [],\n        otherOpts: ['dflt'],\n        coerceFunction: function(v, propOut, dflt) {\n            function isColor(color) {\n                return tinycolor(color).isValid();\n            }\n            if(!Array.isArray(v) || !v.length) propOut.set(dflt);\n            else if(v.every(isColor)) propOut.set(v);\n            else propOut.set(dflt);\n        }\n    },\n    colorscale: {\n        description: [\n            'A Plotly colorscale either picked by a name:',\n            '(any of', Object.keys(colorscales.scales).join(', '), ')',\n            'customized as an {array} of 2-element {arrays} where',\n            'the first element is the normalized color level value',\n            '(starting at *0* and ending at *1*),',\n            'and the second item is a valid color string.'\n        ].join(' '),\n        requiredOpts: [],\n        otherOpts: ['dflt'],\n        coerceFunction: function(v, propOut, dflt) {\n            propOut.set(colorscales.get(v, dflt));\n        }\n    },\n    angle: {\n        description: [\n            'A number (in degree) between -180 and 180.'\n        ].join(' '),\n        requiredOpts: [],\n        otherOpts: ['dflt'],\n        coerceFunction: function(v, propOut, dflt) {\n            if(v === 'auto') propOut.set('auto');\n            else if(!isNumeric(v)) propOut.set(dflt);\n            else propOut.set(modHalf(+v, 360));\n        }\n    },\n    subplotid: {\n        description: [\n            'An id string of a subplot type (given by dflt), optionally',\n            'followed by an integer >1. e.g. if dflt=\\'geo\\', we can have',\n            '\\'geo\\', \\'geo2\\', \\'geo3\\', ...'\n        ].join(' '),\n        requiredOpts: ['dflt'],\n        otherOpts: ['regex'],\n        coerceFunction: function(v, propOut, dflt, opts) {\n            var regex = opts.regex || counterRegex(dflt);\n            if(typeof v === 'string' && regex.test(v)) {\n                propOut.set(v);\n                return;\n            }\n            propOut.set(dflt);\n        },\n        validateFunction: function(v, opts) {\n            var dflt = opts.dflt;\n\n            if(v === dflt) return true;\n            if(typeof v !== 'string') return false;\n            if(counterRegex(dflt).test(v)) return true;\n\n            return false;\n        }\n    },\n    flaglist: {\n        description: [\n            'A string representing a combination of flags',\n            '(order does not matter here).',\n            'Combine any of the available `flags` with *+*.',\n            '(e.g. (\\'lines+markers\\')).',\n            'Values in `extras` cannot be combined.'\n        ].join(' '),\n        requiredOpts: ['flags'],\n        otherOpts: ['dflt', 'extras', 'arrayOk'],\n        coerceFunction: function(v, propOut, dflt, opts) {\n            if(typeof v !== 'string') {\n                propOut.set(dflt);\n                return;\n            }\n            if((opts.extras || []).indexOf(v) !== -1) {\n                propOut.set(v);\n                return;\n            }\n            var vParts = v.split('+');\n            var i = 0;\n            while(i < vParts.length) {\n                var vi = vParts[i];\n                if(opts.flags.indexOf(vi) === -1 || vParts.indexOf(vi) < i) {\n                    vParts.splice(i, 1);\n                } else i++;\n            }\n            if(!vParts.length) propOut.set(dflt);\n            else propOut.set(vParts.join('+'));\n        }\n    },\n    any: {\n        description: 'Any type.',\n        requiredOpts: [],\n        otherOpts: ['dflt', 'values', 'arrayOk'],\n        coerceFunction: function(v, propOut, dflt) {\n            if(v === undefined) propOut.set(dflt);\n            else propOut.set(v);\n        }\n    },\n    info_array: {\n        description: [\n            'An {array} of plot information.'\n        ].join(' '),\n        requiredOpts: ['items'],\n        // set `dimensions=2` for a 2D array or '1-2' for either\n        // `items` may be a single object instead of an array, in which case\n        // `freeLength` must be true.\n        // if `dimensions='1-2'` and items is a 1D array, then the value can\n        // either be a matching 1D array or an array of such matching 1D arrays\n        otherOpts: ['dflt', 'freeLength', 'dimensions'],\n        coerceFunction: function(v, propOut, dflt, opts) {\n            // simplified coerce function just for array items\n            function coercePart(v, opts, dflt) {\n                var out;\n                var propPart = {set: function(v) { out = v; }};\n\n                if(dflt === undefined) dflt = opts.dflt;\n\n                exports.valObjectMeta[opts.valType].coerceFunction(v, propPart, dflt, opts);\n\n                return out;\n            }\n\n            var twoD = opts.dimensions === 2 || (opts.dimensions === '1-2' && Array.isArray(v) && Array.isArray(v[0]));\n\n            if(!Array.isArray(v)) {\n                propOut.set(dflt);\n                return;\n            }\n\n            var items = opts.items;\n            var vOut = [];\n            var arrayItems = Array.isArray(items);\n            var arrayItems2D = arrayItems && twoD && Array.isArray(items[0]);\n            var innerItemsOnly = twoD && arrayItems && !arrayItems2D;\n            var len = (arrayItems && !innerItemsOnly) ? items.length : v.length;\n\n            var i, j, row, item, len2, vNew;\n\n            dflt = Array.isArray(dflt) ? dflt : [];\n\n            if(twoD) {\n                for(i = 0; i < len; i++) {\n                    vOut[i] = [];\n                    row = Array.isArray(v[i]) ? v[i] : [];\n                    if(innerItemsOnly) len2 = items.length;\n                    else if(arrayItems) len2 = items[i].length;\n                    else len2 = row.length;\n\n                    for(j = 0; j < len2; j++) {\n                        if(innerItemsOnly) item = items[j];\n                        else if(arrayItems) item = items[i][j];\n                        else item = items;\n\n                        vNew = coercePart(row[j], item, (dflt[i] || [])[j]);\n                        if(vNew !== undefined) vOut[i][j] = vNew;\n                    }\n                }\n            } else {\n                for(i = 0; i < len; i++) {\n                    vNew = coercePart(v[i], arrayItems ? items[i] : items, dflt[i]);\n                    if(vNew !== undefined) vOut[i] = vNew;\n                }\n            }\n\n            propOut.set(vOut);\n        },\n        validateFunction: function(v, opts) {\n            if(!Array.isArray(v)) return false;\n\n            var items = opts.items;\n            var arrayItems = Array.isArray(items);\n            var twoD = opts.dimensions === 2;\n\n            // when free length is off, input and declared lengths must match\n            if(!opts.freeLength && v.length !== items.length) return false;\n\n            // valid when all input items are valid\n            for(var i = 0; i < v.length; i++) {\n                if(twoD) {\n                    if(!Array.isArray(v[i]) || (!opts.freeLength && v[i].length !== items[i].length)) {\n                        return false;\n                    }\n                    for(var j = 0; j < v[i].length; j++) {\n                        if(!validate(v[i][j], arrayItems ? items[i][j] : items)) {\n                            return false;\n                        }\n                    }\n                } else if(!validate(v[i], arrayItems ? items[i] : items)) return false;\n            }\n\n            return true;\n        }\n    }\n};\n\n/**\n * Ensures that container[attribute] has a valid value.\n *\n * attributes[attribute] is an object with possible keys:\n * - valType: data_array, enumerated, boolean, ... as in valObjectMeta\n * - values: (enumerated only) array of allowed vals\n * - min, max: (number, integer only) inclusive bounds on allowed vals\n *      either or both may be omitted\n * - dflt: if attribute is invalid or missing, use this default\n *      if dflt is provided as an argument to lib.coerce it takes precedence\n *      as a convenience, returns the value it finally set\n */\nexports.coerce = function(containerIn, containerOut, attributes, attribute, dflt) {\n    var opts = nestedProperty(attributes, attribute).get();\n    var propIn = nestedProperty(containerIn, attribute);\n    var propOut = nestedProperty(containerOut, attribute);\n    var v = propIn.get();\n\n    var template = containerOut._template;\n    if(v === undefined && template) {\n        v = nestedProperty(template, attribute).get();\n        // already used the template value, so short-circuit the second check\n        template = 0;\n    }\n\n    if(dflt === undefined) dflt = opts.dflt;\n\n    /**\n     * arrayOk: value MAY be an array, then we do no value checking\n     * at this point, because it can be more complicated than the\n     * individual form (eg. some array vals can be numbers, even if the\n     * single values must be color strings)\n     */\n    if(opts.arrayOk && isArrayOrTypedArray(v)) {\n        propOut.set(v);\n        return v;\n    }\n\n    var coerceFunction = exports.valObjectMeta[opts.valType].coerceFunction;\n    coerceFunction(v, propOut, dflt, opts);\n\n    var out = propOut.get();\n    // in case v was provided but invalid, try the template again so it still\n    // overrides the regular default\n    if(template && out === dflt && !validate(v, opts)) {\n        v = nestedProperty(template, attribute).get();\n        coerceFunction(v, propOut, dflt, opts);\n        out = propOut.get();\n    }\n    return out;\n};\n\n/**\n * Variation on coerce\n *\n * Uses coerce to get attribute value if user input is valid,\n * returns attribute default if user input it not valid or\n * returns false if there is no user input.\n */\nexports.coerce2 = function(containerIn, containerOut, attributes, attribute, dflt) {\n    var propIn = nestedProperty(containerIn, attribute);\n    var propOut = exports.coerce(containerIn, containerOut, attributes, attribute, dflt);\n    var valIn = propIn.get();\n\n    return (valIn !== undefined && valIn !== null) ? propOut : false;\n};\n\n/*\n * Shortcut to coerce the three font attributes\n *\n * 'coerce' is a lib.coerce wrapper with implied first three arguments\n */\nexports.coerceFont = function(coerce, attr, dfltObj) {\n    var out = {};\n\n    dfltObj = dfltObj || {};\n\n    out.family = coerce(attr + '.family', dfltObj.family);\n    out.size = coerce(attr + '.size', dfltObj.size);\n    out.color = coerce(attr + '.color', dfltObj.color);\n\n    return out;\n};\n\n/*\n * Shortcut to coerce the pattern attributes\n */\nexports.coercePattern = function(coerce, attr, markerColor, hasMarkerColorscale) {\n    var shape = coerce(attr + '.shape');\n    if(shape) {\n        coerce(attr + '.solidity');\n        coerce(attr + '.size');\n        var fillmode = coerce(attr + '.fillmode');\n        var isOverlay = fillmode === 'overlay';\n\n        if(!hasMarkerColorscale) {\n            var bgcolor = coerce(attr + '.bgcolor', isOverlay ?\n                markerColor :\n                undefined\n            );\n\n            coerce(attr + '.fgcolor', isOverlay ?\n                Color.contrast(bgcolor) :\n                markerColor\n            );\n        }\n\n        coerce(attr + '.fgopacity', isOverlay ?\n            0.5 :\n            1\n        );\n    }\n};\n\n/** Coerce shortcut for 'hoverinfo'\n * handling 1-vs-multi-trace dflt logic\n *\n * @param {object} traceIn : user trace object\n * @param {object} traceOut : full trace object (requires _module ref)\n * @param {object} layoutOut : full layout object (require _dataLength ref)\n * @return {any} : the coerced value\n */\nexports.coerceHoverinfo = function(traceIn, traceOut, layoutOut) {\n    var moduleAttrs = traceOut._module.attributes;\n    var attrs = moduleAttrs.hoverinfo ? moduleAttrs : baseTraceAttrs;\n\n    var valObj = attrs.hoverinfo;\n    var dflt;\n\n    if(layoutOut._dataLength === 1) {\n        var flags = valObj.dflt === 'all' ?\n            valObj.flags.slice() :\n            valObj.dflt.split('+');\n\n        flags.splice(flags.indexOf('name'), 1);\n        dflt = flags.join('+');\n    }\n\n    return exports.coerce(traceIn, traceOut, attrs, 'hoverinfo', dflt);\n};\n\n/** Coerce shortcut for [un]selected.marker.opacity,\n *  which has special default logic, to ensure that it corresponds to the\n *  default selection behavior while allowing to be overtaken by any other\n *  [un]selected attribute.\n *\n *  N.B. This must be called *after* coercing all the other [un]selected attrs,\n *  to give the intended result.\n *\n * @param {object} traceOut : fullData item\n * @param {function} coerce : lib.coerce wrapper with implied first three arguments\n */\nexports.coerceSelectionMarkerOpacity = function(traceOut, coerce) {\n    if(!traceOut.marker) return;\n\n    var mo = traceOut.marker.opacity;\n    // you can still have a `marker` container with no markers if there's text\n    if(mo === undefined) return;\n\n    var smoDflt;\n    var usmoDflt;\n\n    // Don't give [un]selected.marker.opacity a default value if\n    // marker.opacity is an array: handle this during style step.\n    //\n    // Only give [un]selected.marker.opacity a default value if you don't\n    // set any other [un]selected attributes.\n    if(!isArrayOrTypedArray(mo) && !traceOut.selected && !traceOut.unselected) {\n        smoDflt = mo;\n        usmoDflt = DESELECTDIM * mo;\n    }\n\n    coerce('selected.marker.opacity', smoDflt);\n    coerce('unselected.marker.opacity', usmoDflt);\n};\n\nfunction validate(value, opts) {\n    var valObjectDef = exports.valObjectMeta[opts.valType];\n\n    if(opts.arrayOk && isArrayOrTypedArray(value)) return true;\n\n    if(valObjectDef.validateFunction) {\n        return valObjectDef.validateFunction(value, opts);\n    }\n\n    var failed = {};\n    var out = failed;\n    var propMock = { set: function(v) { out = v; } };\n\n    // 'failed' just something mutable that won't be === anything else\n\n    valObjectDef.coerceFunction(value, propMock, failed, opts);\n    return out !== failed;\n}\nexports.validate = validate;\n","'use strict';\n\nvar timeFormat = require('d3-time-format').timeFormat;\nvar isNumeric = require('fast-isnumeric');\n\nvar Loggers = require('./loggers');\nvar mod = require('./mod').mod;\n\nvar constants = require('../constants/numerical');\nvar BADNUM = constants.BADNUM;\nvar ONEDAY = constants.ONEDAY;\nvar ONEHOUR = constants.ONEHOUR;\nvar ONEMIN = constants.ONEMIN;\nvar ONESEC = constants.ONESEC;\nvar EPOCHJD = constants.EPOCHJD;\n\nvar Registry = require('../registry');\n\nvar utcFormat = require('d3-time-format').utcFormat;\n\nvar DATETIME_REGEXP = /^\\s*(-?\\d\\d\\d\\d|\\d\\d)(-(\\d?\\d)(-(\\d?\\d)([ Tt]([01]?\\d|2[0-3])(:([0-5]\\d)(:([0-5]\\d(\\.\\d+)?))?(Z|z|[+\\-]\\d\\d(:?\\d\\d)?)?)?)?)?)?\\s*$/m;\n// special regex for chinese calendars to support yyyy-mmi-dd etc for intercalary months\nvar DATETIME_REGEXP_CN = /^\\s*(-?\\d\\d\\d\\d|\\d\\d)(-(\\d?\\di?)(-(\\d?\\d)([ Tt]([01]?\\d|2[0-3])(:([0-5]\\d)(:([0-5]\\d(\\.\\d+)?))?(Z|z|[+\\-]\\d\\d(:?\\d\\d)?)?)?)?)?)?\\s*$/m;\n\n// for 2-digit years, the first year we map them onto\nvar YFIRST = new Date().getFullYear() - 70;\n\nfunction isWorldCalendar(calendar) {\n    return (\n        calendar &&\n        Registry.componentsRegistry.calendars &&\n        typeof calendar === 'string' && calendar !== 'gregorian'\n    );\n}\n\n/*\n * dateTick0: get the canonical tick for this calendar\n *\n * integer weekdays : Saturday: 0, Sunday: 1, Monday: 2, etc.\n */\nexports.dateTick0 = function(calendar, dayOfWeek) {\n    var tick0 = _dateTick0(calendar, !!dayOfWeek);\n    if(dayOfWeek < 2) return tick0;\n\n    var v = exports.dateTime2ms(tick0, calendar);\n    v += ONEDAY * (dayOfWeek - 1); // shift Sunday to Monday, etc.\n    return exports.ms2DateTime(v, 0, calendar);\n};\n\n/*\n * _dateTick0: get the canonical tick for this calendar\n *\n * bool sunday is for week ticks, shift it to a Sunday.\n */\nfunction _dateTick0(calendar, sunday) {\n    if(isWorldCalendar(calendar)) {\n        return sunday ?\n            Registry.getComponentMethod('calendars', 'CANONICAL_SUNDAY')[calendar] :\n            Registry.getComponentMethod('calendars', 'CANONICAL_TICK')[calendar];\n    } else {\n        return sunday ? '2000-01-02' : '2000-01-01';\n    }\n}\n\n/*\n * dfltRange: for each calendar, give a valid default range\n */\nexports.dfltRange = function(calendar) {\n    if(isWorldCalendar(calendar)) {\n        return Registry.getComponentMethod('calendars', 'DFLTRANGE')[calendar];\n    } else {\n        return ['2000-01-01', '2001-01-01'];\n    }\n};\n\n// is an object a javascript date?\nexports.isJSDate = function(v) {\n    return typeof v === 'object' && v !== null && typeof v.getTime === 'function';\n};\n\n// The absolute limits of our date-time system\n// This is a little weird: we use MIN_MS and MAX_MS in dateTime2ms\n// but we use dateTime2ms to calculate them (after defining it!)\nvar MIN_MS, MAX_MS;\n\n/**\n * dateTime2ms - turn a date object or string s into milliseconds\n * (relative to 1970-01-01, per javascript standard)\n * optional calendar (string) to use a non-gregorian calendar\n *\n * Returns BADNUM if it doesn't find a date\n *\n * strings should have the form:\n *\n *    -?YYYY-mm-dd<sep>HH:MM:SS.sss<tzInfo>?\n *\n * <sep>: space (our normal standard) or T or t (ISO-8601)\n * <tzInfo>: Z, z, [+\\-]HH:?MM or [+\\-]HH and we THROW IT AWAY\n * this format comes from https://tools.ietf.org/html/rfc3339#section-5.6\n * and 4.2.5.1 Difference between local time and UTC of day (ISO-8601)\n * but we allow it even with a space as the separator\n *\n * May truncate after any full field, and sss can be any length\n * even >3 digits, though javascript dates truncate to milliseconds,\n * we keep as much as javascript numeric precision can hold, but we only\n * report back up to 100 microsecond precision, because most dates support\n * this precision (close to 1970 support more, very far away support less)\n *\n * Expanded to support negative years to -9999 but you must always\n * give 4 digits, except for 2-digit positive years which we assume are\n * near the present time.\n * Note that we follow ISO 8601:2004: there *is* a year 0, which\n * is 1BC/BCE, and -1===2BC etc.\n *\n * World calendars: not all of these *have* agreed extensions to this full range,\n * if you have another calendar system but want a date range outside its validity,\n * you can use a gregorian date string prefixed with 'G' or 'g'.\n *\n * Where to cut off 2-digit years between 1900s and 2000s?\n * from https://docs.microsoft.com/en-us/office/troubleshoot/excel/two-digit-year-numbers#the-2029-rule:\n *   1930-2029 (the most retro of all...)\n * but in my mac chrome from eg. d=new Date(Date.parse('8/19/50')):\n *   1950-2049\n * by Java, from http://stackoverflow.com/questions/2024273/:\n *   now-80 - now+19\n * or FileMaker Pro, from\n *      https://fmhelp.filemaker.com/help/18/fmp/en/index.html#page/FMP_Help/dates-with-two-digit-years.html:\n *   now-70 - now+29\n * but python strptime etc, via\n *      http://docs.python.org/py3k/library/time.html:\n *   1969-2068 (super forward-looking, but static, not sliding!)\n *\n * lets go with now-70 to now+29, and if anyone runs into this problem\n * they can learn the hard way not to use 2-digit years, as no choice we\n * make now will cover all possibilities. mostly this will all be taken\n * care of in initial parsing, should only be an issue for hand-entered data\n * currently (2016) this range is:\n *   1946-2045\n */\nexports.dateTime2ms = function(s, calendar) {\n    // first check if s is a date object\n    if(exports.isJSDate(s)) {\n        // Convert to the UTC milliseconds that give the same\n        // hours as this date has in the local timezone\n        var tzOffset = s.getTimezoneOffset() * ONEMIN;\n        var offsetTweak = (s.getUTCMinutes() - s.getMinutes()) * ONEMIN +\n            (s.getUTCSeconds() - s.getSeconds()) * ONESEC +\n            (s.getUTCMilliseconds() - s.getMilliseconds());\n\n        if(offsetTweak) {\n            var comb = 3 * ONEMIN;\n            tzOffset = tzOffset - comb / 2 + mod(offsetTweak - tzOffset + comb / 2, comb);\n        }\n        s = Number(s) - tzOffset;\n        if(s >= MIN_MS && s <= MAX_MS) return s;\n        return BADNUM;\n    }\n    // otherwise only accept strings and numbers\n    if(typeof s !== 'string' && typeof s !== 'number') return BADNUM;\n\n    s = String(s);\n\n    var isWorld = isWorldCalendar(calendar);\n\n    // to handle out-of-range dates in international calendars, accept\n    // 'G' as a prefix to force the built-in gregorian calendar.\n    var s0 = s.charAt(0);\n    if(isWorld && (s0 === 'G' || s0 === 'g')) {\n        s = s.substr(1);\n        calendar = '';\n    }\n\n    var isChinese = isWorld && calendar.substr(0, 7) === 'chinese';\n\n    var match = s.match(isChinese ? DATETIME_REGEXP_CN : DATETIME_REGEXP);\n    if(!match) return BADNUM;\n    var y = match[1];\n    var m = match[3] || '1';\n    var d = Number(match[5] || 1);\n    var H = Number(match[7] || 0);\n    var M = Number(match[9] || 0);\n    var S = Number(match[11] || 0);\n\n    if(isWorld) {\n        // disallow 2-digit years for world calendars\n        if(y.length === 2) return BADNUM;\n        y = Number(y);\n\n        var cDate;\n        try {\n            var calInstance = Registry.getComponentMethod('calendars', 'getCal')(calendar);\n            if(isChinese) {\n                var isIntercalary = m.charAt(m.length - 1) === 'i';\n                m = parseInt(m, 10);\n                cDate = calInstance.newDate(y, calInstance.toMonthIndex(y, m, isIntercalary), d);\n            } else {\n                cDate = calInstance.newDate(y, Number(m), d);\n            }\n        } catch(e) { return BADNUM; } // Invalid ... date\n\n        if(!cDate) return BADNUM;\n\n        return ((cDate.toJD() - EPOCHJD) * ONEDAY) +\n            (H * ONEHOUR) + (M * ONEMIN) + (S * ONESEC);\n    }\n\n    if(y.length === 2) {\n        y = (Number(y) + 2000 - YFIRST) % 100 + YFIRST;\n    } else y = Number(y);\n\n    // new Date uses months from 0; subtract 1 here just so we\n    // don't have to do it again during the validity test below\n    m -= 1;\n\n    // javascript takes new Date(0..99,m,d) to mean 1900-1999, so\n    // to support years 0-99 we need to use setFullYear explicitly\n    // Note that 2000 is a leap year.\n    var date = new Date(Date.UTC(2000, m, d, H, M));\n    date.setUTCFullYear(y);\n\n    if(date.getUTCMonth() !== m) return BADNUM;\n    if(date.getUTCDate() !== d) return BADNUM;\n\n    return date.getTime() + S * ONESEC;\n};\n\nMIN_MS = exports.MIN_MS = exports.dateTime2ms('-9999');\nMAX_MS = exports.MAX_MS = exports.dateTime2ms('9999-12-31 23:59:59.9999');\n\n// is string s a date? (see above)\nexports.isDateTime = function(s, calendar) {\n    return (exports.dateTime2ms(s, calendar) !== BADNUM);\n};\n\n// pad a number with zeroes, to given # of digits before the decimal point\nfunction lpad(val, digits) {\n    return String(val + Math.pow(10, digits)).substr(1);\n}\n\n/**\n * Turn ms into string of the form YYYY-mm-dd HH:MM:SS.ssss\n * Crop any trailing zeros in time, except never stop right after hours\n * (we could choose to crop '-01' from date too but for now we always\n * show the whole date)\n * Optional range r is the data range that applies, also in ms.\n * If rng is big, the later parts of time will be omitted\n */\nvar NINETYDAYS = 90 * ONEDAY;\nvar THREEHOURS = 3 * ONEHOUR;\nvar FIVEMIN = 5 * ONEMIN;\nexports.ms2DateTime = function(ms, r, calendar) {\n    if(typeof ms !== 'number' || !(ms >= MIN_MS && ms <= MAX_MS)) return BADNUM;\n\n    if(!r) r = 0;\n\n    var msecTenths = Math.floor(mod(ms + 0.05, 1) * 10);\n    var msRounded = Math.round(ms - msecTenths / 10);\n    var dateStr, h, m, s, msec10, d;\n\n    if(isWorldCalendar(calendar)) {\n        var dateJD = Math.floor(msRounded / ONEDAY) + EPOCHJD;\n        var timeMs = Math.floor(mod(ms, ONEDAY));\n        try {\n            dateStr = Registry.getComponentMethod('calendars', 'getCal')(calendar)\n                .fromJD(dateJD).formatDate('yyyy-mm-dd');\n        } catch(e) {\n            // invalid date in this calendar - fall back to Gyyyy-mm-dd\n            dateStr = utcFormat('G%Y-%m-%d')(new Date(msRounded));\n        }\n\n        // yyyy does NOT guarantee 4-digit years. YYYY mostly does, but does\n        // other things for a few calendars, so we can't trust it. Just pad\n        // it manually (after the '-' if there is one)\n        if(dateStr.charAt(0) === '-') {\n            while(dateStr.length < 11) dateStr = '-0' + dateStr.substr(1);\n        } else {\n            while(dateStr.length < 10) dateStr = '0' + dateStr;\n        }\n\n        // TODO: if this is faster, we could use this block for extracting\n        // the time components of regular gregorian too\n        h = (r < NINETYDAYS) ? Math.floor(timeMs / ONEHOUR) : 0;\n        m = (r < NINETYDAYS) ? Math.floor((timeMs % ONEHOUR) / ONEMIN) : 0;\n        s = (r < THREEHOURS) ? Math.floor((timeMs % ONEMIN) / ONESEC) : 0;\n        msec10 = (r < FIVEMIN) ? (timeMs % ONESEC) * 10 + msecTenths : 0;\n    } else {\n        d = new Date(msRounded);\n\n        dateStr = utcFormat('%Y-%m-%d')(d);\n\n        // <90 days: add hours and minutes - never *only* add hours\n        h = (r < NINETYDAYS) ? d.getUTCHours() : 0;\n        m = (r < NINETYDAYS) ? d.getUTCMinutes() : 0;\n        // <3 hours: add seconds\n        s = (r < THREEHOURS) ? d.getUTCSeconds() : 0;\n        // <5 minutes: add ms (plus one extra digit, this is msec*10)\n        msec10 = (r < FIVEMIN) ? d.getUTCMilliseconds() * 10 + msecTenths : 0;\n    }\n\n    return includeTime(dateStr, h, m, s, msec10);\n};\n\n// For converting old-style milliseconds to date strings,\n// we use the local timezone rather than UTC like we use\n// everywhere else, both for backward compatibility and\n// because that's how people mostly use javasript date objects.\n// Clip one extra day off our date range though so we can't get\n// thrown beyond the range by the timezone shift.\nexports.ms2DateTimeLocal = function(ms) {\n    if(!(ms >= MIN_MS + ONEDAY && ms <= MAX_MS - ONEDAY)) return BADNUM;\n\n    var msecTenths = Math.floor(mod(ms + 0.05, 1) * 10);\n    var d = new Date(Math.round(ms - msecTenths / 10));\n    var dateStr = timeFormat('%Y-%m-%d')(d);\n    var h = d.getHours();\n    var m = d.getMinutes();\n    var s = d.getSeconds();\n    var msec10 = d.getUTCMilliseconds() * 10 + msecTenths;\n\n    return includeTime(dateStr, h, m, s, msec10);\n};\n\nfunction includeTime(dateStr, h, m, s, msec10) {\n    // include each part that has nonzero data in or after it\n    if(h || m || s || msec10) {\n        dateStr += ' ' + lpad(h, 2) + ':' + lpad(m, 2);\n        if(s || msec10) {\n            dateStr += ':' + lpad(s, 2);\n            if(msec10) {\n                var digits = 4;\n                while(msec10 % 10 === 0) {\n                    digits -= 1;\n                    msec10 /= 10;\n                }\n                dateStr += '.' + lpad(msec10, digits);\n            }\n        }\n    }\n    return dateStr;\n}\n\n// normalize date format to date string, in case it starts as\n// a Date object or milliseconds\n// optional dflt is the return value if cleaning fails\nexports.cleanDate = function(v, dflt, calendar) {\n    // let us use cleanDate to provide a missing default without an error\n    if(v === BADNUM) return dflt;\n    if(exports.isJSDate(v) || (typeof v === 'number' && isFinite(v))) {\n        // do not allow milliseconds (old) or jsdate objects (inherently\n        // described as gregorian dates) with world calendars\n        if(isWorldCalendar(calendar)) {\n            Loggers.error('JS Dates and milliseconds are incompatible with world calendars', v);\n            return dflt;\n        }\n\n        // NOTE: if someone puts in a year as a number rather than a string,\n        // this will mistakenly convert it thinking it's milliseconds from 1970\n        // that is: '2012' -> Jan. 1, 2012, but 2012 -> 2012 epoch milliseconds\n        v = exports.ms2DateTimeLocal(+v);\n        if(!v && dflt !== undefined) return dflt;\n    } else if(!exports.isDateTime(v, calendar)) {\n        Loggers.error('unrecognized date', v);\n        return dflt;\n    }\n    return v;\n};\n\n/*\n *  Date formatting for ticks and hovertext\n */\n\n/*\n * modDateFormat: Support world calendars, and add two items to\n * d3's vocabulary:\n * %{n}f where n is the max number of digits of fractional seconds\n * %h formats: half of the year as a decimal number [1,2]\n */\nvar fracMatch = /%\\d?f/g;\nvar halfYearMatch = /%h/g;\nvar quarterToHalfYear = {\n    '1': '1',\n    '2': '1',\n    '3': '2',\n    '4': '2',\n};\nfunction modDateFormat(fmt, x, formatter, calendar) {\n    fmt = fmt.replace(fracMatch, function(match) {\n        var digits = Math.min(+(match.charAt(1)) || 6, 6);\n        var fracSecs = ((x / 1000 % 1) + 2)\n            .toFixed(digits)\n            .substr(2).replace(/0+$/, '') || '0';\n        return fracSecs;\n    });\n\n    var d = new Date(Math.floor(x + 0.05));\n\n    fmt = fmt.replace(halfYearMatch, function() {\n        return quarterToHalfYear[formatter('%q')(d)];\n    });\n\n    if(isWorldCalendar(calendar)) {\n        try {\n            fmt = Registry.getComponentMethod('calendars', 'worldCalFmt')(fmt, x, calendar);\n        } catch(e) {\n            return 'Invalid';\n        }\n    }\n    return formatter(fmt)(d);\n}\n\n/*\n * formatTime: create a time string from:\n *   x: milliseconds\n *   tr: tickround ('M', 'S', or # digits)\n * only supports UTC times (where every day is 24 hours and 0 is at midnight)\n */\nvar MAXSECONDS = [59, 59.9, 59.99, 59.999, 59.9999];\nfunction formatTime(x, tr) {\n    var timePart = mod(x + 0.05, ONEDAY);\n\n    var timeStr = lpad(Math.floor(timePart / ONEHOUR), 2) + ':' +\n        lpad(mod(Math.floor(timePart / ONEMIN), 60), 2);\n\n    if(tr !== 'M') {\n        if(!isNumeric(tr)) tr = 0; // should only be 'S'\n\n        /*\n         * this is a weird one - and shouldn't come up unless people\n         * monkey with tick0 in weird ways, but we need to do something!\n         * IN PARTICULAR we had better not display garbage (see below)\n         * for numbers we always round to the nearest increment of the\n         * precision we're showing, and this seems like the right way to\n         * handle seconds and milliseconds, as they have a decimal point\n         * and people will interpret that to mean rounding like numbers.\n         * but for larger increments we floor the value: it's always\n         * 2013 until the ball drops on the new year. We could argue about\n         * which field it is where we start rounding (should 12:08:59\n         * round to 12:09 if we're stopping at minutes?) but for now I'll\n         * say we round seconds but floor everything else. BUT that means\n         * we need to never round up to 60 seconds, ie 23:59:60\n         */\n        var sec = Math.min(mod(x / ONESEC, 60), MAXSECONDS[tr]);\n\n        var secStr = (100 + sec).toFixed(tr).substr(1);\n        if(tr > 0) {\n            secStr = secStr.replace(/0+$/, '').replace(/[\\.]$/, '');\n        }\n\n        timeStr += ':' + secStr;\n    }\n    return timeStr;\n}\n\n/*\n * formatDate: turn a date into tick or hover label text.\n *\n *   x: milliseconds, the value to convert\n *   fmt: optional, an explicit format string (d3 format, even for world calendars)\n *   tr: tickround ('y', 'm', 'd', 'M', 'S', or # digits)\n *      used if no explicit fmt is provided\n *   formatter: locale-aware d3 date formatter for standard gregorian calendars\n *      should be the result of exports.getD3DateFormat(gd)\n *   calendar: optional string, the world calendar system to use\n *\n * returns the date/time as a string, potentially with the leading portion\n * on a separate line (after '\\n')\n * Note that this means if you provide an explicit format which includes '\\n'\n * the axis may choose to strip things after it when they don't change from\n * one tick to the next (as it does with automatic formatting)\n */\nexports.formatDate = function(x, fmt, tr, formatter, calendar, extraFormat) {\n    calendar = isWorldCalendar(calendar) && calendar;\n\n    if(!fmt) {\n        if(tr === 'y') fmt = extraFormat.year;\n        else if(tr === 'm') fmt = extraFormat.month;\n        else if(tr === 'd') {\n            fmt = extraFormat.dayMonth + '\\n' + extraFormat.year;\n        } else {\n            return formatTime(x, tr) + '\\n' + modDateFormat(extraFormat.dayMonthYear, x, formatter, calendar);\n        }\n    }\n\n    return modDateFormat(fmt, x, formatter, calendar);\n};\n\n/*\n * incrementMonth: make a new milliseconds value from the given one,\n * having changed the month\n *\n * special case for world calendars: multiples of 12 are treated as years,\n * even for calendar systems that don't have (always or ever) 12 months/year\n * TODO: perhaps we need a different code for year increments to support this?\n *\n * ms (number): the initial millisecond value\n * dMonth (int): the (signed) number of months to shift\n * calendar (string): the calendar system to use\n *\n * changing month does not (and CANNOT) always preserve day, since\n * months have different lengths. The worst example of this is:\n *   d = new Date(1970,0,31); d.setMonth(1) -> Feb 31 turns into Mar 3\n *\n * But we want to be able to iterate over the last day of each month,\n * regardless of what its number is.\n * So shift 3 days forward, THEN set the new month, then unshift:\n *   1/31 -> 2/28 (or 29) -> 3/31 -> 4/30 -> ...\n *\n * Note that odd behavior still exists if you start from the 26th-28th:\n *   1/28 -> 2/28 -> 3/31\n * but at least you can't shift any dates into the wrong month,\n * and ticks on these days incrementing by month would be very unusual\n */\nvar THREEDAYS = 3 * ONEDAY;\nexports.incrementMonth = function(ms, dMonth, calendar) {\n    calendar = isWorldCalendar(calendar) && calendar;\n\n    // pull time out and operate on pure dates, then add time back at the end\n    // this gives maximum precision - not that we *normally* care if we're\n    // incrementing by month, but better to be safe!\n    var timeMs = mod(ms, ONEDAY);\n    ms = Math.round(ms - timeMs);\n\n    if(calendar) {\n        try {\n            var dateJD = Math.round(ms / ONEDAY) + EPOCHJD;\n            var calInstance = Registry.getComponentMethod('calendars', 'getCal')(calendar);\n            var cDate = calInstance.fromJD(dateJD);\n\n            if(dMonth % 12) calInstance.add(cDate, dMonth, 'm');\n            else calInstance.add(cDate, dMonth / 12, 'y');\n\n            return (cDate.toJD() - EPOCHJD) * ONEDAY + timeMs;\n        } catch(e) {\n            Loggers.error('invalid ms ' + ms + ' in calendar ' + calendar);\n            // then keep going in gregorian even though the result will be 'Invalid'\n        }\n    }\n\n    var y = new Date(ms + THREEDAYS);\n    return y.setUTCMonth(y.getUTCMonth() + dMonth) + timeMs - THREEDAYS;\n};\n\n/*\n * findExactDates: what fraction of data is exact days, months, or years?\n *\n * data: array of millisecond values\n * calendar (string) the calendar to test against\n */\nexports.findExactDates = function(data, calendar) {\n    var exactYears = 0;\n    var exactMonths = 0;\n    var exactDays = 0;\n    var blankCount = 0;\n    var d;\n    var di;\n\n    var calInstance = (\n        isWorldCalendar(calendar) &&\n        Registry.getComponentMethod('calendars', 'getCal')(calendar)\n    );\n\n    for(var i = 0; i < data.length; i++) {\n        di = data[i];\n\n        // not date data at all\n        if(!isNumeric(di)) {\n            blankCount ++;\n            continue;\n        }\n\n        // not an exact date\n        if(di % ONEDAY) continue;\n\n        if(calInstance) {\n            try {\n                d = calInstance.fromJD(di / ONEDAY + EPOCHJD);\n                if(d.day() === 1) {\n                    if(d.month() === 1) exactYears++;\n                    else exactMonths++;\n                } else exactDays++;\n            } catch(e) {\n                // invalid date in this calendar - ignore it here.\n            }\n        } else {\n            d = new Date(di);\n            if(d.getUTCDate() === 1) {\n                if(d.getUTCMonth() === 0) exactYears++;\n                else exactMonths++;\n            } else exactDays++;\n        }\n    }\n    exactMonths += exactYears;\n    exactDays += exactMonths;\n\n    var dataCount = data.length - blankCount;\n\n    return {\n        exactYears: exactYears / dataCount,\n        exactMonths: exactMonths / dataCount,\n        exactDays: exactDays / dataCount\n    };\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar loggers = require('./loggers');\nvar matrix = require('./matrix');\nvar mat4X4 = require('gl-mat4');\n\n/**\n * Allow referencing a graph DOM element either directly\n * or by its id string\n *\n * @param {HTMLDivElement|string} gd: a graph element or its id\n *\n * @returns {HTMLDivElement} the DOM element of the graph\n */\nfunction getGraphDiv(gd) {\n    var gdElement;\n\n    if(typeof gd === 'string') {\n        gdElement = document.getElementById(gd);\n\n        if(gdElement === null) {\n            throw new Error('No DOM element with id \\'' + gd + '\\' exists on the page.');\n        }\n\n        return gdElement;\n    } else if(gd === null || gd === undefined) {\n        throw new Error('DOM element provided is null or undefined');\n    }\n\n    // otherwise assume that gd is a DOM element\n    return gd;\n}\n\nfunction isPlotDiv(el) {\n    var el3 = d3.select(el);\n    return el3.node() instanceof HTMLElement &&\n        el3.size() &&\n        el3.classed('js-plotly-plot');\n}\n\nfunction removeElement(el) {\n    var elParent = el && el.parentNode;\n    if(elParent) elParent.removeChild(el);\n}\n\n/**\n * for dynamically adding style rules\n * makes one stylesheet that contains all rules added\n * by all calls to this function\n */\nfunction addStyleRule(selector, styleString) {\n    addRelatedStyleRule('global', selector, styleString);\n}\n\n/**\n * for dynamically adding style rules\n * to a stylesheet uniquely identified by a uid\n */\nfunction addRelatedStyleRule(uid, selector, styleString) {\n    var id = 'plotly.js-style-' + uid;\n    var style = document.getElementById(id);\n    if(!style) {\n        style = document.createElement('style');\n        style.setAttribute('id', id);\n        // WebKit hack :(\n        style.appendChild(document.createTextNode(''));\n        document.head.appendChild(style);\n    }\n    var styleSheet = style.sheet;\n\n    if(styleSheet.insertRule) {\n        styleSheet.insertRule(selector + '{' + styleString + '}', 0);\n    } else if(styleSheet.addRule) {\n        styleSheet.addRule(selector, styleString, 0);\n    } else loggers.warn('addStyleRule failed');\n}\n\n/**\n * to remove from the page a stylesheet identified by a given uid\n */\nfunction deleteRelatedStyleRule(uid) {\n    var id = 'plotly.js-style-' + uid;\n    var style = document.getElementById(id);\n    if(style) removeElement(style);\n}\n\nfunction getFullTransformMatrix(element) {\n    var allElements = getElementAndAncestors(element);\n    // the identity matrix\n    var out = [\n        1, 0, 0, 0,\n        0, 1, 0, 0,\n        0, 0, 1, 0,\n        0, 0, 0, 1\n    ];\n    allElements.forEach(function(e) {\n        var t = getElementTransformMatrix(e);\n        if(t) {\n            var m = matrix.convertCssMatrix(t);\n            out = mat4X4.multiply(out, out, m);\n        }\n    });\n    return out;\n}\n\n/**\n * extracts and parses the 2d css style transform matrix from some element\n */\nfunction getElementTransformMatrix(element) {\n    var style = window.getComputedStyle(element, null);\n    var transform = (\n      style.getPropertyValue('-webkit-transform') ||\n      style.getPropertyValue('-moz-transform') ||\n      style.getPropertyValue('-ms-transform') ||\n      style.getPropertyValue('-o-transform') ||\n      style.getPropertyValue('transform')\n    );\n\n    if(transform === 'none') return null;\n    // the transform is a string in the form of matrix(a, b, ...) or matrix3d(...)\n    return transform\n        .replace('matrix', '')\n        .replace('3d', '')\n        .slice(1, -1)\n        .split(',')\n        .map(function(n) { return +n; });\n}\n/**\n * retrieve all DOM elements that are ancestors of the specified one (including itself)\n */\nfunction getElementAndAncestors(element) {\n    var allElements = [];\n    while(isTransformableElement(element)) {\n        allElements.push(element);\n        element = element.parentNode;\n    }\n    return allElements;\n}\n\nfunction isTransformableElement(element) {\n    return element && (element instanceof Element || element instanceof HTMLElement);\n}\n\nfunction equalDomRects(a, b) {\n    return (\n        a && b &&\n        a.x === b.x &&\n        a.y === b.y &&\n        a.top === b.top &&\n        a.left === b.left &&\n        a.right === b.right &&\n        a.bottom === b.bottom\n    );\n}\n\nmodule.exports = {\n    getGraphDiv: getGraphDiv,\n    isPlotDiv: isPlotDiv,\n    removeElement: removeElement,\n    addStyleRule: addStyleRule,\n    addRelatedStyleRule: addRelatedStyleRule,\n    deleteRelatedStyleRule: deleteRelatedStyleRule,\n    getFullTransformMatrix: getFullTransformMatrix,\n    getElementTransformMatrix: getElementTransformMatrix,\n    getElementAndAncestors: getElementAndAncestors,\n    equalDomRects: equalDomRects\n};\n","'use strict';\n\n/* global jQuery:false */\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar Events = {\n\n    init: function(plotObj) {\n        /*\n         * If we have already instantiated an emitter for this plot\n         * return early.\n         */\n        if(plotObj._ev instanceof EventEmitter) return plotObj;\n\n        var ev = new EventEmitter();\n        var internalEv = new EventEmitter();\n\n        /*\n         * Assign to plot._ev while we still live in a land\n         * where plot is a DOM element with stuff attached to it.\n         * In the future we can make plot the event emitter itself.\n         */\n        plotObj._ev = ev;\n\n        /*\n         * Create a second event handler that will manage events *internally*.\n         * This allows parts of plotly to respond to thing like relayout without\n         * having to use the user-facing event handler. They cannot peacefully\n         * coexist on the same handler because a user invoking\n         * plotObj.removeAllListeners() would detach internal events, breaking\n         * plotly.\n         */\n        plotObj._internalEv = internalEv;\n\n        /*\n         * Assign bound methods from the ev to the plot object. These methods\n         * will reference the 'this' of plot._ev even though they are methods\n         * of plot. This will keep the event machinery away from the plot object\n         * which currently is often a DOM element but presents an API that will\n         * continue to function when plot becomes an emitter. Not all EventEmitter\n         * methods have been bound to `plot` as some do not currently add value to\n         * the Plotly event API.\n         */\n        plotObj.on = ev.on.bind(ev);\n        plotObj.once = ev.once.bind(ev);\n        plotObj.removeListener = ev.removeListener.bind(ev);\n        plotObj.removeAllListeners = ev.removeAllListeners.bind(ev);\n\n        /*\n         * Create functions for managing internal events. These are *only* triggered\n         * by the mirroring of external events via the emit function.\n         */\n        plotObj._internalOn = internalEv.on.bind(internalEv);\n        plotObj._internalOnce = internalEv.once.bind(internalEv);\n        plotObj._removeInternalListener = internalEv.removeListener.bind(internalEv);\n        plotObj._removeAllInternalListeners = internalEv.removeAllListeners.bind(internalEv);\n\n        /*\n         * We must wrap emit to continue to support JQuery events. The idea\n         * is to check to see if the user is using JQuery events, if they are\n         * we emit JQuery events to trigger user handlers as well as the EventEmitter\n         * events.\n         */\n        plotObj.emit = function(event, data) {\n            if(typeof jQuery !== 'undefined') {\n                jQuery(plotObj).trigger(event, data);\n            }\n\n            ev.emit(event, data);\n            internalEv.emit(event, data);\n        };\n\n        return plotObj;\n    },\n\n    /*\n     * This function behaves like jQuery's triggerHandler. It calls\n     * all handlers for a particular event and returns the return value\n     * of the LAST handler. This function also triggers jQuery's\n     * triggerHandler for backwards compatibility.\n     */\n    triggerHandler: function(plotObj, event, data) {\n        var jQueryHandlerValue;\n        var nodeEventHandlerValue;\n\n        /*\n         * If jQuery exists run all its handlers for this event and\n         * collect the return value of the LAST handler function\n         */\n        if(typeof jQuery !== 'undefined') {\n            jQueryHandlerValue = jQuery(plotObj).triggerHandler(event, data);\n        }\n\n        /*\n         * Now run all the node style event handlers\n         */\n        var ev = plotObj._ev;\n        if(!ev) return jQueryHandlerValue;\n\n        var handlers = ev._events[event];\n        if(!handlers) return jQueryHandlerValue;\n\n        // making sure 'this' is the EventEmitter instance\n        function apply(handler) {\n            // The 'once' case, we can't just call handler() as we need\n            // the return value here. So,\n            // - remove handler\n            // - call listener and grab return value!\n            // - stash 'fired' key to not call handler twice\n            if(handler.listener) {\n                ev.removeListener(event, handler.listener);\n                if(!handler.fired) {\n                    handler.fired = true;\n                    return handler.listener.apply(ev, [data]);\n                }\n            } else {\n                return handler.apply(ev, [data]);\n            }\n        }\n\n        // handlers can be function or an array of functions\n        handlers = Array.isArray(handlers) ? handlers : [handlers];\n\n        var i;\n        for(i = 0; i < handlers.length - 1; i++) {\n            apply(handlers[i]);\n        }\n        // now call the final handler and collect its value\n        nodeEventHandlerValue = apply(handlers[i]);\n\n        /*\n         * Return either the jQuery handler value if it exists or the\n         * nodeEventHandler value. jQuery event value supersedes nodejs\n         * events for backwards compatibility reasons.\n         */\n        return jQueryHandlerValue !== undefined ?\n            jQueryHandlerValue :\n            nodeEventHandlerValue;\n    },\n\n    purge: function(plotObj) {\n        delete plotObj._ev;\n        delete plotObj.on;\n        delete plotObj.once;\n        delete plotObj.removeListener;\n        delete plotObj.removeAllListeners;\n        delete plotObj.emit;\n\n        delete plotObj._ev;\n        delete plotObj._internalEv;\n        delete plotObj._internalOn;\n        delete plotObj._internalOnce;\n        delete plotObj._removeInternalListener;\n        delete plotObj._removeAllInternalListeners;\n\n        return plotObj;\n    }\n\n};\n\nmodule.exports = Events;\n","'use strict';\n\nvar isPlainObject = require('./is_plain_object.js');\nvar isArray = Array.isArray;\n\nfunction primitivesLoopSplice(source, target) {\n    var i, value;\n    for(i = 0; i < source.length; i++) {\n        value = source[i];\n        if(value !== null && typeof(value) === 'object') {\n            return false;\n        }\n        if(value !== void(0)) {\n            target[i] = value;\n        }\n    }\n    return true;\n}\n\nexports.extendFlat = function() {\n    return _extend(arguments, false, false, false);\n};\n\nexports.extendDeep = function() {\n    return _extend(arguments, true, false, false);\n};\n\nexports.extendDeepAll = function() {\n    return _extend(arguments, true, true, false);\n};\n\nexports.extendDeepNoArrays = function() {\n    return _extend(arguments, true, false, true);\n};\n\n/*\n * Inspired by https://github.com/justmoon/node-extend/blob/master/index.js\n * All credit to the jQuery authors for perfecting this amazing utility.\n *\n * API difference with jQuery version:\n * - No optional boolean (true -> deep extend) first argument,\n *   use `extendFlat` for first-level only extend and\n *   use `extendDeep` for a deep extend.\n *\n * Other differences with jQuery version:\n * - Uses a modern (and faster) isPlainObject routine.\n * - Expected to work with object {} and array [] arguments only.\n * - Does not check for circular structure.\n *   FYI: jQuery only does a check across one level.\n *   Warning: this might result in infinite loops.\n *\n */\nfunction _extend(inputs, isDeep, keepAllKeys, noArrayCopies) {\n    var target = inputs[0];\n    var length = inputs.length;\n\n    var input, key, src, copy, copyIsArray, clone, allPrimitives;\n\n    // TODO does this do the right thing for typed arrays?\n\n    if(length === 2 && isArray(target) && isArray(inputs[1]) && target.length === 0) {\n        allPrimitives = primitivesLoopSplice(inputs[1], target);\n\n        if(allPrimitives) {\n            return target;\n        } else {\n            target.splice(0, target.length); // reset target and continue to next block\n        }\n    }\n\n    for(var i = 1; i < length; i++) {\n        input = inputs[i];\n\n        for(key in input) {\n            src = target[key];\n            copy = input[key];\n\n            if(noArrayCopies && isArray(copy)) {\n                // Stop early and just transfer the array if array copies are disallowed:\n\n                target[key] = copy;\n            } else if(isDeep && copy && (isPlainObject(copy) || (copyIsArray = isArray(copy)))) {\n                // recurse if we're merging plain objects or arrays\n\n                if(copyIsArray) {\n                    copyIsArray = false;\n                    clone = src && isArray(src) ? src : [];\n                } else {\n                    clone = src && isPlainObject(src) ? src : {};\n                }\n\n                // never move original objects, clone them\n                target[key] = _extend([clone, copy], isDeep, keepAllKeys, noArrayCopies);\n            } else if(typeof copy !== 'undefined' || keepAllKeys) {\n                // don't bring in undefined values, except for extendDeepAll\n\n                target[key] = copy;\n            }\n        }\n    }\n\n    return target;\n}\n","'use strict';\n\n\n/**\n * Return news array containing only the unique items\n * found in input array.\n *\n * IMPORTANT: Note that items are considered unique\n * if `String({})` is unique. For example;\n *\n *  Lib.filterUnique([ { a: 1 }, { b: 2 } ])\n *\n *  returns [{ a: 1 }]\n *\n * and\n *\n *  Lib.filterUnique([ '1', 1 ])\n *\n *  returns ['1']\n *\n *\n * @param {array} array base array\n * @return {array} new filtered array\n */\nmodule.exports = function filterUnique(array) {\n    var seen = {};\n    var out = [];\n    var j = 0;\n\n    for(var i = 0; i < array.length; i++) {\n        var item = array[i];\n\n        if(seen[item] !== 1) {\n            seen[item] = 1;\n            out[j++] = item;\n        }\n    }\n\n    return out;\n};\n","'use strict';\n\n/** Filter out object items with visible !== true\n *  insider array container.\n *\n *  @param {array of objects} container\n *  @return {array of objects} of length <= container\n *\n */\nmodule.exports = function filterVisible(container) {\n    var filterFn = isCalcData(container) ? calcDataFilter : baseFilter;\n    var out = [];\n\n    for(var i = 0; i < container.length; i++) {\n        var item = container[i];\n        if(filterFn(item)) out.push(item);\n    }\n\n    return out;\n};\n\nfunction baseFilter(item) {\n    return item.visible === true;\n}\n\nfunction calcDataFilter(item) {\n    var trace = item[0].trace;\n    return trace.visible === true && trace._length !== 0;\n}\n\nfunction isCalcData(cont) {\n    return (\n        Array.isArray(cont) &&\n        Array.isArray(cont[0]) &&\n        cont[0][0] &&\n        cont[0][0].trace\n    );\n}\n","'use strict';\n\nvar mod = require('./mod').mod;\n\n/*\n * look for intersection of two line segments\n *   (1->2 and 3->4) - returns array [x,y] if they do, null if not\n */\nexports.segmentsIntersect = segmentsIntersect;\nfunction segmentsIntersect(x1, y1, x2, y2, x3, y3, x4, y4) {\n    var a = x2 - x1;\n    var b = x3 - x1;\n    var c = x4 - x3;\n    var d = y2 - y1;\n    var e = y3 - y1;\n    var f = y4 - y3;\n    var det = a * f - c * d;\n    // parallel lines? intersection is undefined\n    // ignore the case where they are colinear\n    if(det === 0) return null;\n    var t = (b * f - c * e) / det;\n    var u = (b * d - a * e) / det;\n    // segments do not intersect?\n    if(u < 0 || u > 1 || t < 0 || t > 1) return null;\n\n    return {x: x1 + a * t, y: y1 + d * t};\n}\n\n/*\n * find the minimum distance between two line segments (1->2 and 3->4)\n */\nexports.segmentDistance = function segmentDistance(x1, y1, x2, y2, x3, y3, x4, y4) {\n    if(segmentsIntersect(x1, y1, x2, y2, x3, y3, x4, y4)) return 0;\n\n    // the two segments and their lengths squared\n    var x12 = x2 - x1;\n    var y12 = y2 - y1;\n    var x34 = x4 - x3;\n    var y34 = y4 - y3;\n    var ll12 = x12 * x12 + y12 * y12;\n    var ll34 = x34 * x34 + y34 * y34;\n\n    // calculate distance squared, then take the sqrt at the very end\n    var dist2 = Math.min(\n        perpDistance2(x12, y12, ll12, x3 - x1, y3 - y1),\n        perpDistance2(x12, y12, ll12, x4 - x1, y4 - y1),\n        perpDistance2(x34, y34, ll34, x1 - x3, y1 - y3),\n        perpDistance2(x34, y34, ll34, x2 - x3, y2 - y3)\n    );\n\n    return Math.sqrt(dist2);\n};\n\n/*\n * distance squared from segment ab to point c\n * [xab, yab] is the vector b-a\n * [xac, yac] is the vector c-a\n * llab is the length squared of (b-a), just to simplify calculation\n */\nfunction perpDistance2(xab, yab, llab, xac, yac) {\n    var fcAB = (xac * xab + yac * yab);\n    if(fcAB < 0) {\n        // point c is closer to point a\n        return xac * xac + yac * yac;\n    } else if(fcAB > llab) {\n        // point c is closer to point b\n        var xbc = xac - xab;\n        var ybc = yac - yab;\n        return xbc * xbc + ybc * ybc;\n    } else {\n        // perpendicular distance is the shortest\n        var crossProduct = xac * yab - yac * xab;\n        return crossProduct * crossProduct / llab;\n    }\n}\n\n// a very short-term cache for getTextLocation, just because\n// we're often looping over the same locations multiple times\n// invalidated as soon as we look at a different path\nvar locationCache, workingPath, workingTextWidth;\n\n// turn a path and position along it into x, y, and angle for the given text\nexports.getTextLocation = function getTextLocation(path, totalPathLen, positionOnPath, textWidth) {\n    if(path !== workingPath || textWidth !== workingTextWidth) {\n        locationCache = {};\n        workingPath = path;\n        workingTextWidth = textWidth;\n    }\n    if(locationCache[positionOnPath]) {\n        return locationCache[positionOnPath];\n    }\n\n    // for the angle, use points on the path separated by the text width\n    // even though due to curvature, the text will cover a bit more than that\n    var p0 = path.getPointAtLength(mod(positionOnPath - textWidth / 2, totalPathLen));\n    var p1 = path.getPointAtLength(mod(positionOnPath + textWidth / 2, totalPathLen));\n    // note: atan handles 1/0 nicely\n    var theta = Math.atan((p1.y - p0.y) / (p1.x - p0.x));\n    // center the text at 2/3 of the center position plus 1/3 the p0/p1 midpoint\n    // that's the average position of this segment, assuming it's roughly quadratic\n    var pCenter = path.getPointAtLength(mod(positionOnPath, totalPathLen));\n    var x = (pCenter.x * 4 + p0.x + p1.x) / 6;\n    var y = (pCenter.y * 4 + p0.y + p1.y) / 6;\n\n    var out = {x: x, y: y, theta: theta};\n    locationCache[positionOnPath] = out;\n    return out;\n};\n\nexports.clearLocationCache = function() {\n    workingPath = null;\n};\n\n/*\n * Find the segment of `path` that's within the visible area\n * given by `bounds` {left, right, top, bottom}, to within a\n * precision of `buffer` px\n *\n * returns: undefined if nothing is visible, else object:\n * {\n *   min: position where the path first enters bounds, or 0 if it\n *        starts within bounds\n *   max: position where the path last exits bounds, or the path length\n *        if it finishes within bounds\n *   len: max - min, ie the length of visible path\n *   total: the total path length - just included so the caller doesn't\n *        need to call path.getTotalLength() again\n *   isClosed: true iff the start and end points of the path are both visible\n *        and are at the same point\n * }\n *\n * Works by starting from either end and repeatedly finding the distance from\n * that point to the plot area, and if it's outside the plot, moving along the\n * path by that distance (because the plot must be at least that far away on\n * the path). Note that if a path enters, exits, and re-enters the plot, we\n * will not capture this behavior.\n */\nexports.getVisibleSegment = function getVisibleSegment(path, bounds, buffer) {\n    var left = bounds.left;\n    var right = bounds.right;\n    var top = bounds.top;\n    var bottom = bounds.bottom;\n\n    var pMin = 0;\n    var pTotal = path.getTotalLength();\n    var pMax = pTotal;\n\n    var pt0, ptTotal;\n\n    function getDistToPlot(len) {\n        var pt = path.getPointAtLength(len);\n\n        // hold on to the start and end points for `closed`\n        if(len === 0) pt0 = pt;\n        else if(len === pTotal) ptTotal = pt;\n\n        var dx = (pt.x < left) ? left - pt.x : (pt.x > right ? pt.x - right : 0);\n        var dy = (pt.y < top) ? top - pt.y : (pt.y > bottom ? pt.y - bottom : 0);\n        return Math.sqrt(dx * dx + dy * dy);\n    }\n\n    var distToPlot = getDistToPlot(pMin);\n    while(distToPlot) {\n        pMin += distToPlot + buffer;\n        if(pMin > pMax) return;\n        distToPlot = getDistToPlot(pMin);\n    }\n\n    distToPlot = getDistToPlot(pMax);\n    while(distToPlot) {\n        pMax -= distToPlot + buffer;\n        if(pMin > pMax) return;\n        distToPlot = getDistToPlot(pMax);\n    }\n\n    return {\n        min: pMin,\n        max: pMax,\n        len: pMax - pMin,\n        total: pTotal,\n        isClosed: pMin === 0 && pMax === pTotal &&\n            Math.abs(pt0.x - ptTotal.x) < 0.1 &&\n            Math.abs(pt0.y - ptTotal.y) < 0.1\n    };\n};\n\n/**\n * Find point on SVG path corresponding to a given constraint coordinate\n *\n * @param {SVGPathElement} path\n * @param {Number} val : constraint coordinate value\n * @param {String} coord : 'x' or 'y' the constraint coordinate\n * @param {Object} opts :\n *  - {Number} pathLength : supply total path length before hand\n *  - {Number} tolerance\n *  - {Number} iterationLimit\n * @return {SVGPoint}\n */\nexports.findPointOnPath = function findPointOnPath(path, val, coord, opts) {\n    opts = opts || {};\n\n    var pathLength = opts.pathLength || path.getTotalLength();\n    var tolerance = opts.tolerance || 1e-3;\n    var iterationLimit = opts.iterationLimit || 30;\n\n    // if path starts at a val greater than the path tail (like on vertical violins),\n    // we must flip the sign of the computed diff.\n    var mul = path.getPointAtLength(0)[coord] > path.getPointAtLength(pathLength)[coord] ? -1 : 1;\n\n    var i = 0;\n    var b0 = 0;\n    var b1 = pathLength;\n    var mid;\n    var pt;\n    var diff;\n\n    while(i < iterationLimit) {\n        mid = (b0 + b1) / 2;\n        pt = path.getPointAtLength(mid);\n        diff = pt[coord] - val;\n\n        if(Math.abs(diff) < tolerance) {\n            return pt;\n        } else {\n            if(mul * diff > 0) {\n                b1 = mid;\n            } else {\n                b0 = mid;\n            }\n            i++;\n        }\n    }\n    return pt;\n};\n","'use strict';\n\n// Simple helper functions\n// none of these need any external deps\n\nmodule.exports = function identity(d) { return d; };\n","'use strict';\n\nmodule.exports = function incrementNumeric(x, delta) {\n    if(!delta) return x;\n\n    // Note 1:\n    // 0.3 != 0.1 + 0.2 == 0.30000000000000004\n    // but 0.3 == (10 * 0.1 + 10 * 0.2) / 10\n    // Attempt to use integer steps to increment\n    var scale = 1 / Math.abs(delta);\n    var newX = (scale > 1) ? (\n        scale * x +\n        scale * delta\n    ) / scale : x + delta;\n\n    // Note 2:\n    // now we may also consider rounding to cover few more edge cases\n    // e.g. 0.3 * 3 = 0.8999999999999999\n    var lenX1 = String(newX).length;\n    if(lenX1 > 16) {\n        var lenDt = String(delta).length;\n        var lenX0 = String(x).length;\n\n        if(lenX1 >= lenX0 + lenDt) { // likely a rounding error!\n            var s = parseFloat(newX).toPrecision(12);\n            if(s.indexOf('e+') === -1) newX = +s;\n        }\n    }\n\n    return newX;\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar utcFormat = require('d3-time-format').utcFormat;\nvar isNumeric = require('fast-isnumeric');\n\nvar numConstants = require('../constants/numerical');\nvar MAX_SAFE = numConstants.FP_SAFE;\nvar MIN_SAFE = -MAX_SAFE;\nvar BADNUM = numConstants.BADNUM;\n\nvar lib = module.exports = {};\n\nlib.nestedProperty = require('./nested_property');\nlib.keyedContainer = require('./keyed_container');\nlib.relativeAttr = require('./relative_attr');\nlib.isPlainObject = require('./is_plain_object');\nlib.toLogRange = require('./to_log_range');\nlib.relinkPrivateKeys = require('./relink_private');\n\nvar arrayModule = require('./array');\nlib.isTypedArray = arrayModule.isTypedArray;\nlib.isArrayOrTypedArray = arrayModule.isArrayOrTypedArray;\nlib.isArray1D = arrayModule.isArray1D;\nlib.ensureArray = arrayModule.ensureArray;\nlib.concat = arrayModule.concat;\nlib.maxRowLength = arrayModule.maxRowLength;\nlib.minRowLength = arrayModule.minRowLength;\n\nvar modModule = require('./mod');\nlib.mod = modModule.mod;\nlib.modHalf = modModule.modHalf;\n\nvar coerceModule = require('./coerce');\nlib.valObjectMeta = coerceModule.valObjectMeta;\nlib.coerce = coerceModule.coerce;\nlib.coerce2 = coerceModule.coerce2;\nlib.coerceFont = coerceModule.coerceFont;\nlib.coercePattern = coerceModule.coercePattern;\nlib.coerceHoverinfo = coerceModule.coerceHoverinfo;\nlib.coerceSelectionMarkerOpacity = coerceModule.coerceSelectionMarkerOpacity;\nlib.validate = coerceModule.validate;\n\nvar datesModule = require('./dates');\nlib.dateTime2ms = datesModule.dateTime2ms;\nlib.isDateTime = datesModule.isDateTime;\nlib.ms2DateTime = datesModule.ms2DateTime;\nlib.ms2DateTimeLocal = datesModule.ms2DateTimeLocal;\nlib.cleanDate = datesModule.cleanDate;\nlib.isJSDate = datesModule.isJSDate;\nlib.formatDate = datesModule.formatDate;\nlib.incrementMonth = datesModule.incrementMonth;\nlib.dateTick0 = datesModule.dateTick0;\nlib.dfltRange = datesModule.dfltRange;\nlib.findExactDates = datesModule.findExactDates;\nlib.MIN_MS = datesModule.MIN_MS;\nlib.MAX_MS = datesModule.MAX_MS;\n\nvar searchModule = require('./search');\nlib.findBin = searchModule.findBin;\nlib.sorterAsc = searchModule.sorterAsc;\nlib.sorterDes = searchModule.sorterDes;\nlib.distinctVals = searchModule.distinctVals;\nlib.roundUp = searchModule.roundUp;\nlib.sort = searchModule.sort;\nlib.findIndexOfMin = searchModule.findIndexOfMin;\n\nvar statsModule = require('./stats');\nlib.aggNums = statsModule.aggNums;\nlib.len = statsModule.len;\nlib.mean = statsModule.mean;\nlib.median = statsModule.median;\nlib.midRange = statsModule.midRange;\nlib.variance = statsModule.variance;\nlib.stdev = statsModule.stdev;\nlib.interp = statsModule.interp;\n\nvar matrixModule = require('./matrix');\nlib.init2dArray = matrixModule.init2dArray;\nlib.transposeRagged = matrixModule.transposeRagged;\nlib.dot = matrixModule.dot;\nlib.translationMatrix = matrixModule.translationMatrix;\nlib.rotationMatrix = matrixModule.rotationMatrix;\nlib.rotationXYMatrix = matrixModule.rotationXYMatrix;\nlib.apply3DTransform = matrixModule.apply3DTransform;\nlib.apply2DTransform = matrixModule.apply2DTransform;\nlib.apply2DTransform2 = matrixModule.apply2DTransform2;\nlib.convertCssMatrix = matrixModule.convertCssMatrix;\nlib.inverseTransformMatrix = matrixModule.inverseTransformMatrix;\n\nvar anglesModule = require('./angles');\nlib.deg2rad = anglesModule.deg2rad;\nlib.rad2deg = anglesModule.rad2deg;\nlib.angleDelta = anglesModule.angleDelta;\nlib.angleDist = anglesModule.angleDist;\nlib.isFullCircle = anglesModule.isFullCircle;\nlib.isAngleInsideSector = anglesModule.isAngleInsideSector;\nlib.isPtInsideSector = anglesModule.isPtInsideSector;\nlib.pathArc = anglesModule.pathArc;\nlib.pathSector = anglesModule.pathSector;\nlib.pathAnnulus = anglesModule.pathAnnulus;\n\nvar anchorUtils = require('./anchor_utils');\nlib.isLeftAnchor = anchorUtils.isLeftAnchor;\nlib.isCenterAnchor = anchorUtils.isCenterAnchor;\nlib.isRightAnchor = anchorUtils.isRightAnchor;\nlib.isTopAnchor = anchorUtils.isTopAnchor;\nlib.isMiddleAnchor = anchorUtils.isMiddleAnchor;\nlib.isBottomAnchor = anchorUtils.isBottomAnchor;\n\nvar geom2dModule = require('./geometry2d');\nlib.segmentsIntersect = geom2dModule.segmentsIntersect;\nlib.segmentDistance = geom2dModule.segmentDistance;\nlib.getTextLocation = geom2dModule.getTextLocation;\nlib.clearLocationCache = geom2dModule.clearLocationCache;\nlib.getVisibleSegment = geom2dModule.getVisibleSegment;\nlib.findPointOnPath = geom2dModule.findPointOnPath;\n\nvar extendModule = require('./extend');\nlib.extendFlat = extendModule.extendFlat;\nlib.extendDeep = extendModule.extendDeep;\nlib.extendDeepAll = extendModule.extendDeepAll;\nlib.extendDeepNoArrays = extendModule.extendDeepNoArrays;\n\nvar loggersModule = require('./loggers');\nlib.log = loggersModule.log;\nlib.warn = loggersModule.warn;\nlib.error = loggersModule.error;\n\nvar regexModule = require('./regex');\nlib.counterRegex = regexModule.counter;\n\nvar throttleModule = require('./throttle');\nlib.throttle = throttleModule.throttle;\nlib.throttleDone = throttleModule.done;\nlib.clearThrottle = throttleModule.clear;\n\nvar domModule = require('./dom');\nlib.getGraphDiv = domModule.getGraphDiv;\nlib.isPlotDiv = domModule.isPlotDiv;\nlib.removeElement = domModule.removeElement;\nlib.addStyleRule = domModule.addStyleRule;\nlib.addRelatedStyleRule = domModule.addRelatedStyleRule;\nlib.deleteRelatedStyleRule = domModule.deleteRelatedStyleRule;\nlib.getFullTransformMatrix = domModule.getFullTransformMatrix;\nlib.getElementTransformMatrix = domModule.getElementTransformMatrix;\nlib.getElementAndAncestors = domModule.getElementAndAncestors;\nlib.equalDomRects = domModule.equalDomRects;\n\nlib.clearResponsive = require('./clear_responsive');\nlib.preserveDrawingBuffer = require('./preserve_drawing_buffer');\n\nlib.makeTraceGroups = require('./make_trace_groups');\n\nlib._ = require('./localize');\n\nlib.notifier = require('./notifier');\n\nlib.filterUnique = require('./filter_unique');\nlib.filterVisible = require('./filter_visible');\nlib.pushUnique = require('./push_unique');\n\nlib.increment = require('./increment');\n\nlib.cleanNumber = require('./clean_number');\n\nlib.ensureNumber = function ensureNumber(v) {\n    if(!isNumeric(v)) return BADNUM;\n    v = Number(v);\n    return (v > MAX_SAFE || v < MIN_SAFE) ? BADNUM : v;\n};\n\n/**\n * Is v a valid array index? Accepts numeric strings as well as numbers.\n *\n * @param {any} v: the value to test\n * @param {Optional[integer]} len: the array length we are indexing\n *\n * @return {bool}: v is a valid array index\n */\nlib.isIndex = function(v, len) {\n    if(len !== undefined && v >= len) return false;\n    return isNumeric(v) && (v >= 0) && (v % 1 === 0);\n};\n\nlib.noop = require('./noop');\nlib.identity = require('./identity');\n\n/**\n * create an array of length 'cnt' filled with 'v' at all indices\n *\n * @param {any} v\n * @param {number} cnt\n * @return {array}\n */\nlib.repeat = function(v, cnt) {\n    var out = new Array(cnt);\n    for(var i = 0; i < cnt; i++) {\n        out[i] = v;\n    }\n    return out;\n};\n\n/**\n * swap x and y of the same attribute in container cont\n * specify attr with a ? in place of x/y\n * you can also swap other things than x/y by providing part1 and part2\n */\nlib.swapAttrs = function(cont, attrList, part1, part2) {\n    if(!part1) part1 = 'x';\n    if(!part2) part2 = 'y';\n    for(var i = 0; i < attrList.length; i++) {\n        var attr = attrList[i];\n        var xp = lib.nestedProperty(cont, attr.replace('?', part1));\n        var yp = lib.nestedProperty(cont, attr.replace('?', part2));\n        var temp = xp.get();\n        xp.set(yp.get());\n        yp.set(temp);\n    }\n};\n\n/**\n * SVG painter's algo worked around with reinsertion\n */\nlib.raiseToTop = function raiseToTop(elem) {\n    elem.parentNode.appendChild(elem);\n};\n\n/**\n * cancel a possibly pending transition; returned selection may be used by caller\n */\nlib.cancelTransition = function(selection) {\n    return selection.transition().duration(0);\n};\n\n// constrain - restrict a number v to be between v0 and v1\nlib.constrain = function(v, v0, v1) {\n    if(v0 > v1) return Math.max(v1, Math.min(v0, v));\n    return Math.max(v0, Math.min(v1, v));\n};\n\n/**\n * do two bounding boxes from getBoundingClientRect,\n * ie {left,right,top,bottom,width,height}, overlap?\n * takes optional padding pixels\n */\nlib.bBoxIntersect = function(a, b, pad) {\n    pad = pad || 0;\n    return (a.left <= b.right + pad &&\n            b.left <= a.right + pad &&\n            a.top <= b.bottom + pad &&\n            b.top <= a.bottom + pad);\n};\n\n/*\n * simpleMap: alternative to Array.map that only\n * passes on the element and up to 2 extra args you\n * provide (but not the array index or the whole array)\n *\n * array: the array to map it to\n * func: the function to apply\n * x1, x2: optional extra args\n */\nlib.simpleMap = function(array, func, x1, x2, opts) {\n    var len = array.length;\n    var out = new Array(len);\n    for(var i = 0; i < len; i++) out[i] = func(array[i], x1, x2, opts);\n    return out;\n};\n\n/**\n * Random string generator\n *\n * @param {object} existing\n *     pass in strings to avoid as keys with truthy values\n * @param {int} bits\n *     bits of information in the output string, default 24\n * @param {int} base\n *     base of string representation, default 16. Should be a power of 2.\n */\nlib.randstr = function randstr(existing, bits, base, _recursion) {\n    if(!base) base = 16;\n    if(bits === undefined) bits = 24;\n    if(bits <= 0) return '0';\n\n    var digits = Math.log(Math.pow(2, bits)) / Math.log(base);\n    var res = '';\n    var i, b, x;\n\n    for(i = 2; digits === Infinity; i *= 2) {\n        digits = Math.log(Math.pow(2, bits / i)) / Math.log(base) * i;\n    }\n\n    var rem = digits - Math.floor(digits);\n\n    for(i = 0; i < Math.floor(digits); i++) {\n        x = Math.floor(Math.random() * base).toString(base);\n        res = x + res;\n    }\n\n    if(rem) {\n        b = Math.pow(base, rem);\n        x = Math.floor(Math.random() * b).toString(base);\n        res = x + res;\n    }\n\n    var parsed = parseInt(res, base);\n    if((existing && existing[res]) ||\n         (parsed !== Infinity && parsed >= Math.pow(2, bits))) {\n        if(_recursion > 10) {\n            lib.warn('randstr failed uniqueness');\n            return res;\n        }\n        return randstr(existing, bits, base, (_recursion || 0) + 1);\n    } else return res;\n};\n\nlib.OptionControl = function(opt, optname) {\n    /*\n     * An environment to contain all option setters and\n     * getters that collectively modify opts.\n     *\n     * You can call up opts from any function in new object\n     * as this.optname || this.opt\n     *\n     * See FitOpts for example of usage\n     */\n    if(!opt) opt = {};\n    if(!optname) optname = 'opt';\n\n    var self = {};\n    self.optionList = [];\n\n    self._newoption = function(optObj) {\n        optObj[optname] = opt;\n        self[optObj.name] = optObj;\n        self.optionList.push(optObj);\n    };\n\n    self['_' + optname] = opt;\n    return self;\n};\n\n/**\n * lib.smooth: smooth arrayIn by convolving with\n * a hann window with given full width at half max\n * bounce the ends in, so the output has the same length as the input\n */\nlib.smooth = function(arrayIn, FWHM) {\n    FWHM = Math.round(FWHM) || 0; // only makes sense for integers\n    if(FWHM < 2) return arrayIn;\n\n    var alen = arrayIn.length;\n    var alen2 = 2 * alen;\n    var wlen = 2 * FWHM - 1;\n    var w = new Array(wlen);\n    var arrayOut = new Array(alen);\n    var i;\n    var j;\n    var k;\n    var v;\n\n    // first make the window array\n    for(i = 0; i < wlen; i++) {\n        w[i] = (1 - Math.cos(Math.PI * (i + 1) / FWHM)) / (2 * FWHM);\n    }\n\n    // now do the convolution\n    for(i = 0; i < alen; i++) {\n        v = 0;\n        for(j = 0; j < wlen; j++) {\n            k = i + j + 1 - FWHM;\n\n            // multibounce\n            if(k < -alen) k -= alen2 * Math.round(k / alen2);\n            else if(k >= alen2) k -= alen2 * Math.floor(k / alen2);\n\n            // single bounce\n            if(k < 0) k = - 1 - k;\n            else if(k >= alen) k = alen2 - 1 - k;\n\n            v += arrayIn[k] * w[j];\n        }\n        arrayOut[i] = v;\n    }\n\n    return arrayOut;\n};\n\n/**\n * syncOrAsync: run a sequence of functions synchronously\n * as long as its returns are not promises (ie have no .then)\n * includes one argument arg to send to all functions...\n * this is mainly just to prevent us having to make wrapper functions\n * when the only purpose of the wrapper is to reference gd\n * and a final step to be executed at the end\n * TODO: if there's an error and everything is sync,\n * this doesn't happen yet because we want to make sure\n * that it gets reported\n */\nlib.syncOrAsync = function(sequence, arg, finalStep) {\n    var ret, fni;\n\n    function continueAsync() {\n        return lib.syncOrAsync(sequence, arg, finalStep);\n    }\n\n    while(sequence.length) {\n        fni = sequence.splice(0, 1)[0];\n        ret = fni(arg);\n\n        if(ret && ret.then) {\n            return ret.then(continueAsync)\n                .then(undefined, lib.promiseError);\n        }\n    }\n\n    return finalStep && finalStep(arg);\n};\n\n\n/**\n * Helper to strip trailing slash, from\n * http://stackoverflow.com/questions/6680825/return-string-without-trailing-slash\n */\nlib.stripTrailingSlash = function(str) {\n    if(str.substr(-1) === '/') return str.substr(0, str.length - 1);\n    return str;\n};\n\nlib.noneOrAll = function(containerIn, containerOut, attrList) {\n    /**\n     * some attributes come together, so if you have one of them\n     * in the input, you should copy the default values of the others\n     * to the input as well.\n     */\n    if(!containerIn) return;\n\n    var hasAny = false;\n    var hasAll = true;\n    var i;\n    var val;\n\n    for(i = 0; i < attrList.length; i++) {\n        val = containerIn[attrList[i]];\n        if(val !== undefined && val !== null) hasAny = true;\n        else hasAll = false;\n    }\n\n    if(hasAny && !hasAll) {\n        for(i = 0; i < attrList.length; i++) {\n            containerIn[attrList[i]] = containerOut[attrList[i]];\n        }\n    }\n};\n\n/** merges calcdata field (given by cdAttr) with traceAttr values\n *\n * N.B. Loop over minimum of cd.length and traceAttr.length\n * i.e. it does not try to fill in beyond traceAttr.length-1\n *\n * @param {array} traceAttr : trace attribute\n * @param {object} cd : calcdata trace\n * @param {string} cdAttr : calcdata key\n */\nlib.mergeArray = function(traceAttr, cd, cdAttr, fn) {\n    var hasFn = typeof fn === 'function';\n    if(lib.isArrayOrTypedArray(traceAttr)) {\n        var imax = Math.min(traceAttr.length, cd.length);\n        for(var i = 0; i < imax; i++) {\n            var v = traceAttr[i];\n            cd[i][cdAttr] = hasFn ? fn(v) : v;\n        }\n    }\n};\n\n// cast numbers to positive numbers, returns 0 if not greater than 0\nlib.mergeArrayCastPositive = function(traceAttr, cd, cdAttr) {\n    return lib.mergeArray(traceAttr, cd, cdAttr, function(v) {\n        var w = +v;\n        return !isFinite(w) ? 0 : w > 0 ? w : 0;\n    });\n};\n\n/** fills calcdata field (given by cdAttr) with traceAttr values\n *  or function of traceAttr values (e.g. some fallback)\n *\n * N.B. Loops over all cd items.\n *\n * @param {array} traceAttr : trace attribute\n * @param {object} cd : calcdata trace\n * @param {string} cdAttr : calcdata key\n * @param {function} [fn] : optional function to apply to each array item\n */\nlib.fillArray = function(traceAttr, cd, cdAttr, fn) {\n    fn = fn || lib.identity;\n\n    if(lib.isArrayOrTypedArray(traceAttr)) {\n        for(var i = 0; i < cd.length; i++) {\n            cd[i][cdAttr] = fn(traceAttr[i]);\n        }\n    }\n};\n\n/** Handler for trace-wide vs per-point options\n *\n * @param {object} trace : (full) trace object\n * @param {number} ptNumber : index of the point in question\n * @param {string} astr : attribute string\n * @param {function} [fn] : optional function to apply to each array item\n *\n * @return {any}\n */\nlib.castOption = function(trace, ptNumber, astr, fn) {\n    fn = fn || lib.identity;\n\n    var val = lib.nestedProperty(trace, astr).get();\n\n    if(lib.isArrayOrTypedArray(val)) {\n        if(Array.isArray(ptNumber) && lib.isArrayOrTypedArray(val[ptNumber[0]])) {\n            return fn(val[ptNumber[0]][ptNumber[1]]);\n        } else {\n            return fn(val[ptNumber]);\n        }\n    } else {\n        return val;\n    }\n};\n\n/** Extract option from calcdata item, correctly falling back to\n *  trace value if not found.\n *\n *  @param {object} calcPt : calcdata[i][j] item\n *  @param {object} trace : (full) trace object\n *  @param {string} calcKey : calcdata key\n *  @param {string} traceKey : aka trace attribute string\n *  @return {any}\n */\nlib.extractOption = function(calcPt, trace, calcKey, traceKey) {\n    if(calcKey in calcPt) return calcPt[calcKey];\n\n    // fallback to trace value,\n    //   must check if value isn't itself an array\n    //   which means the trace attribute has a corresponding\n    //   calcdata key, but its value is falsy\n    var traceVal = lib.nestedProperty(trace, traceKey).get();\n    if(!Array.isArray(traceVal)) return traceVal;\n};\n\nfunction makePtIndex2PtNumber(indexToPoints) {\n    var ptIndex2ptNumber = {};\n    for(var k in indexToPoints) {\n        var pts = indexToPoints[k];\n        for(var j = 0; j < pts.length; j++) {\n            ptIndex2ptNumber[pts[j]] = +k;\n        }\n    }\n    return ptIndex2ptNumber;\n}\n\n/** Tag selected calcdata items\n *\n * N.B. note that point 'index' corresponds to input data array index\n *  whereas 'number' is its post-transform version.\n *\n * @param {array} calcTrace\n * @param {object} trace\n *  - selectedpoints {array}\n *  - _indexToPoints {object}\n * @param {ptNumber2cdIndex} ptNumber2cdIndex (optional)\n *  optional map object for trace types that do not have 1-to-1 point number to\n *  calcdata item index correspondence (e.g. histogram)\n */\nlib.tagSelected = function(calcTrace, trace, ptNumber2cdIndex) {\n    var selectedpoints = trace.selectedpoints;\n    var indexToPoints = trace._indexToPoints;\n    var ptIndex2ptNumber;\n\n    // make pt index-to-number map object, which takes care of transformed traces\n    if(indexToPoints) {\n        ptIndex2ptNumber = makePtIndex2PtNumber(indexToPoints);\n    }\n\n    function isCdIndexValid(v) {\n        return v !== undefined && v < calcTrace.length;\n    }\n\n    for(var i = 0; i < selectedpoints.length; i++) {\n        var ptIndex = selectedpoints[i];\n\n        if(lib.isIndex(ptIndex) ||\n           (lib.isArrayOrTypedArray(ptIndex) && lib.isIndex(ptIndex[0]) && lib.isIndex(ptIndex[1]))\n        ) {\n            var ptNumber = ptIndex2ptNumber ? ptIndex2ptNumber[ptIndex] : ptIndex;\n            var cdIndex = ptNumber2cdIndex ? ptNumber2cdIndex[ptNumber] : ptNumber;\n\n            if(isCdIndexValid(cdIndex)) {\n                calcTrace[cdIndex].selected = 1;\n            }\n        }\n    }\n};\n\nlib.selIndices2selPoints = function(trace) {\n    var selectedpoints = trace.selectedpoints;\n    var indexToPoints = trace._indexToPoints;\n\n    if(indexToPoints) {\n        var ptIndex2ptNumber = makePtIndex2PtNumber(indexToPoints);\n        var out = [];\n\n        for(var i = 0; i < selectedpoints.length; i++) {\n            var ptIndex = selectedpoints[i];\n            if(lib.isIndex(ptIndex)) {\n                var ptNumber = ptIndex2ptNumber[ptIndex];\n                if(lib.isIndex(ptNumber)) {\n                    out.push(ptNumber);\n                }\n            }\n        }\n\n        return out;\n    } else {\n        return selectedpoints;\n    }\n};\n\n/** Returns target as set by 'target' transform attribute\n *\n * @param {object} trace : full trace object\n * @param {object} transformOpts : transform option object\n *  - target (string} :\n *      either an attribute string referencing an array in the trace object, or\n *      a set array.\n *\n * @return {array or false} : the target array (NOT a copy!!) or false if invalid\n */\nlib.getTargetArray = function(trace, transformOpts) {\n    var target = transformOpts.target;\n\n    if(typeof target === 'string' && target) {\n        var array = lib.nestedProperty(trace, target).get();\n        return Array.isArray(array) ? array : false;\n    } else if(Array.isArray(target)) {\n        return target;\n    }\n\n    return false;\n};\n\n/**\n * modified version of jQuery's extend to strip out private objs and functions,\n * and cut arrays down to first <arraylen> or 1 elements\n * because extend-like algorithms are hella slow\n * obj2 is assumed to already be clean of these things (including no arrays)\n */\nlib.minExtend = function(obj1, obj2) {\n    var objOut = {};\n    if(typeof obj2 !== 'object') obj2 = {};\n    var arrayLen = 3;\n    var keys = Object.keys(obj1);\n    var i, k, v;\n\n    for(i = 0; i < keys.length; i++) {\n        k = keys[i];\n        v = obj1[k];\n        if(k.charAt(0) === '_' || typeof v === 'function') continue;\n        else if(k === 'module') objOut[k] = v;\n        else if(Array.isArray(v)) {\n            if(k === 'colorscale') {\n                objOut[k] = v.slice();\n            } else {\n                objOut[k] = v.slice(0, arrayLen);\n            }\n        } else if(lib.isTypedArray(v)) {\n            objOut[k] = v.subarray(0, arrayLen);\n        } else if(v && (typeof v === 'object')) objOut[k] = lib.minExtend(obj1[k], obj2[k]);\n        else objOut[k] = v;\n    }\n\n    keys = Object.keys(obj2);\n    for(i = 0; i < keys.length; i++) {\n        k = keys[i];\n        v = obj2[k];\n        if(typeof v !== 'object' || !(k in objOut) || typeof objOut[k] !== 'object') {\n            objOut[k] = v;\n        }\n    }\n\n    return objOut;\n};\n\nlib.titleCase = function(s) {\n    return s.charAt(0).toUpperCase() + s.substr(1);\n};\n\nlib.containsAny = function(s, fragments) {\n    for(var i = 0; i < fragments.length; i++) {\n        if(s.indexOf(fragments[i]) !== -1) return true;\n    }\n    return false;\n};\n\nlib.isIE = function() {\n    return typeof window.navigator.msSaveBlob !== 'undefined';\n};\n\nvar IS_SAFARI_REGEX = /Version\\/[\\d\\.]+.*Safari/;\nlib.isSafari = function() {\n    return IS_SAFARI_REGEX.test(window.navigator.userAgent);\n};\n\nvar IS_IOS_REGEX = /iPad|iPhone|iPod/;\nlib.isIOS = function() {\n    return IS_IOS_REGEX.test(window.navigator.userAgent);\n};\n\nvar FIREFOX_VERSION_REGEX = /Firefox\\/(\\d+)\\.\\d+/;\nlib.getFirefoxVersion = function() {\n    var match = FIREFOX_VERSION_REGEX.exec(window.navigator.userAgent);\n    if(match && match.length === 2) {\n        var versionInt = parseInt(match[1]);\n        if(!isNaN(versionInt)) {\n            return versionInt;\n        }\n    }\n    return null;\n};\n\nlib.isD3Selection = function(obj) {\n    return obj instanceof d3.selection;\n};\n\n/**\n * Append element to DOM only if not present.\n *\n * @param {d3 selection} parent : parent selection of the element in question\n * @param {string} nodeType : node type of element to append\n * @param {string} className (optional) : class name of element in question\n * @param {fn} enterFn (optional) : optional fn applied to entering elements only\n * @return {d3 selection} selection of new layer\n *\n * Previously, we were using the following pattern:\n *\n * ```\n * var sel = parent.selectAll('.' + className)\n *     .data([0]);\n *\n * sel.enter().append(nodeType)\n *     .classed(className, true);\n *\n * return sel;\n * ```\n *\n * in numerous places in our codebase to achieve the same behavior.\n *\n * The logic below performs much better, mostly as we are using\n * `.select` instead `.selectAll` that is `querySelector` instead of\n * `querySelectorAll`.\n *\n */\nlib.ensureSingle = function(parent, nodeType, className, enterFn) {\n    var sel = parent.select(nodeType + (className ? '.' + className : ''));\n    if(sel.size()) return sel;\n\n    var layer = parent.append(nodeType);\n    if(className) layer.classed(className, true);\n    if(enterFn) layer.call(enterFn);\n\n    return layer;\n};\n\n/**\n * Same as Lib.ensureSingle, but using id as selector.\n * This version is mostly used for clipPath nodes.\n *\n * @param {d3 selection} parent : parent selection of the element in question\n * @param {string} nodeType : node type of element to append\n * @param {string} id : id of element in question\n * @param {fn} enterFn (optional) : optional fn applied to entering elements only\n * @return {d3 selection} selection of new layer\n */\nlib.ensureSingleById = function(parent, nodeType, id, enterFn) {\n    var sel = parent.select(nodeType + '#' + id);\n    if(sel.size()) return sel;\n\n    var layer = parent.append(nodeType).attr('id', id);\n    if(enterFn) layer.call(enterFn);\n\n    return layer;\n};\n\n/**\n * Converts a string path to an object.\n *\n * When given a string containing an array element, it will create a `null`\n * filled array of the given size.\n *\n * @example\n * lib.objectFromPath('nested.test[2].path', 'value');\n * // returns { nested: { test: [null, null, { path: 'value' }]}\n *\n * @param   {string}    path to nested value\n * @param   {*}         any value to be set\n *\n * @return {Object} the constructed object with a full nested path\n */\nlib.objectFromPath = function(path, value) {\n    var keys = path.split('.');\n    var tmpObj;\n    var obj = tmpObj = {};\n\n    for(var i = 0; i < keys.length; i++) {\n        var key = keys[i];\n        var el = null;\n\n        var parts = keys[i].match(/(.*)\\[([0-9]+)\\]/);\n\n        if(parts) {\n            key = parts[1];\n            el = parts[2];\n\n            tmpObj = tmpObj[key] = [];\n\n            if(i === keys.length - 1) {\n                tmpObj[el] = value;\n            } else {\n                tmpObj[el] = {};\n            }\n\n            tmpObj = tmpObj[el];\n        } else {\n            if(i === keys.length - 1) {\n                tmpObj[key] = value;\n            } else {\n                tmpObj[key] = {};\n            }\n\n            tmpObj = tmpObj[key];\n        }\n    }\n\n    return obj;\n};\n\n/**\n * Iterate through an object in-place, converting dotted properties to objects.\n *\n * Examples:\n *\n *   lib.expandObjectPaths({'nested.test.path': 'value'});\n *     => { nested: { test: {path: 'value'}}}\n *\n * It also handles array notation, e.g.:\n *\n *   lib.expandObjectPaths({'foo[1].bar': 'value'});\n *     => { foo: [null, {bar: value}] }\n *\n * It handles merges the results when two properties are specified in parallel:\n *\n *   lib.expandObjectPaths({'foo[1].bar': 10, 'foo[0].bar': 20});\n *     => { foo: [{bar: 10}, {bar: 20}] }\n *\n * It does NOT, however, merge multiple multiply-nested arrays::\n *\n *   lib.expandObjectPaths({'marker[1].range[1]': 5, 'marker[1].range[0]': 4})\n *     => { marker: [null, {range: 4}] }\n */\n\n// Store this to avoid recompiling regex on *every* prop since this may happen many\n// many times for animations. Could maybe be inside the function. Not sure about\n// scoping vs. recompilation tradeoff, but at least it's not just inlining it into\n// the inner loop.\nvar dottedPropertyRegex = /^([^\\[\\.]+)\\.(.+)?/;\nvar indexedPropertyRegex = /^([^\\.]+)\\[([0-9]+)\\](\\.)?(.+)?/;\n\nlib.expandObjectPaths = function(data) {\n    var match, key, prop, datum, idx, dest, trailingPath;\n    if(typeof data === 'object' && !Array.isArray(data)) {\n        for(key in data) {\n            if(data.hasOwnProperty(key)) {\n                if((match = key.match(dottedPropertyRegex))) {\n                    datum = data[key];\n                    prop = match[1];\n\n                    delete data[key];\n\n                    data[prop] = lib.extendDeepNoArrays(data[prop] || {}, lib.objectFromPath(key, lib.expandObjectPaths(datum))[prop]);\n                } else if((match = key.match(indexedPropertyRegex))) {\n                    datum = data[key];\n\n                    prop = match[1];\n                    idx = parseInt(match[2]);\n\n                    delete data[key];\n\n                    data[prop] = data[prop] || [];\n\n                    if(match[3] === '.') {\n                        // This is the case where theere are subsequent properties into which\n                        // we must recurse, e.g. transforms[0].value\n                        trailingPath = match[4];\n                        dest = data[prop][idx] = data[prop][idx] || {};\n\n                        // NB: Extend deep no arrays prevents this from working on multiple\n                        // nested properties in the same object, e.g.\n                        //\n                        // {\n                        //   foo[0].bar[1].range\n                        //   foo[0].bar[0].range\n                        // }\n                        //\n                        // In this case, the extendDeepNoArrays will overwrite one array with\n                        // the other, so that both properties *will not* be present in the\n                        // result. Fixing this would require a more intelligent tracking\n                        // of changes and merging than extendDeepNoArrays currently accomplishes.\n                        lib.extendDeepNoArrays(dest, lib.objectFromPath(trailingPath, lib.expandObjectPaths(datum)));\n                    } else {\n                        // This is the case where this property is the end of the line,\n                        // e.g. xaxis.range[0]\n                        data[prop][idx] = lib.expandObjectPaths(datum);\n                    }\n                } else {\n                    data[key] = lib.expandObjectPaths(data[key]);\n                }\n            }\n        }\n    }\n\n    return data;\n};\n\n/**\n * Converts value to string separated by the provided separators.\n *\n * @example\n * lib.numSeparate(2016, '.,');\n * // returns '2016'\n *\n * @example\n * lib.numSeparate(3000, '.,', true);\n * // returns '3,000'\n *\n * @example\n * lib.numSeparate(1234.56, '|,')\n * // returns '1,234|56'\n *\n * @param   {string|number} value       the value to be converted\n * @param   {string}    separators  string of decimal, then thousands separators\n * @param   {boolean}    separatethousands  boolean, 4-digit integers are separated if true\n *\n * @return  {string}    the value that has been separated\n */\nlib.numSeparate = function(value, separators, separatethousands) {\n    if(!separatethousands) separatethousands = false;\n\n    if(typeof separators !== 'string' || separators.length === 0) {\n        throw new Error('Separator string required for formatting!');\n    }\n\n    if(typeof value === 'number') {\n        value = String(value);\n    }\n\n    var thousandsRe = /(\\d+)(\\d{3})/;\n    var decimalSep = separators.charAt(0);\n    var thouSep = separators.charAt(1);\n\n    var x = value.split('.');\n    var x1 = x[0];\n    var x2 = x.length > 1 ? decimalSep + x[1] : '';\n\n    // Years are ignored for thousands separators\n    if(thouSep && (x.length > 1 || x1.length > 4 || separatethousands)) {\n        while(thousandsRe.test(x1)) {\n            x1 = x1.replace(thousandsRe, '$1' + thouSep + '$2');\n        }\n    }\n\n    return x1 + x2;\n};\n\nlib.TEMPLATE_STRING_REGEX = /%{([^\\s%{}:]*)([:|\\|][^}]*)?}/g;\nvar SIMPLE_PROPERTY_REGEX = /^\\w*$/;\n\n/**\n * Substitute values from an object into a string\n *\n * Examples:\n *  Lib.templateString('name: %{trace}', {trace: 'asdf'}) --> 'name: asdf'\n *  Lib.templateString('name: %{trace[0].name}', {trace: [{name: 'asdf'}]}) --> 'name: asdf'\n *\n * @param {string}  input string containing %{...} template strings\n * @param {obj}     data object containing substitution values\n *\n * @return {string} templated string\n */\nlib.templateString = function(string, obj) {\n    // Not all that useful, but cache nestedProperty instantiation\n    // just in case it speeds things up *slightly*:\n    var getterCache = {};\n\n    return string.replace(lib.TEMPLATE_STRING_REGEX, function(dummy, key) {\n        var v;\n        if(SIMPLE_PROPERTY_REGEX.test(key)) {\n            v = obj[key];\n        } else {\n            getterCache[key] = getterCache[key] || lib.nestedProperty(obj, key).get;\n            v = getterCache[key]();\n        }\n        return lib.isValidTextValue(v) ? v : '';\n    });\n};\n\nvar hovertemplateWarnings = {\n    max: 10,\n    count: 0,\n    name: 'hovertemplate'\n};\nlib.hovertemplateString = function() {\n    return templateFormatString.apply(hovertemplateWarnings, arguments);\n};\n\nvar texttemplateWarnings = {\n    max: 10,\n    count: 0,\n    name: 'texttemplate'\n};\nlib.texttemplateString = function() {\n    return templateFormatString.apply(texttemplateWarnings, arguments);\n};\n\nvar TEMPLATE_STRING_FORMAT_SEPARATOR = /^[:|\\|]/;\n/**\n * Substitute values from an object into a string and optionally formats them using d3-format,\n * or fallback to associated labels.\n *\n * Examples:\n *  Lib.hovertemplateString('name: %{trace}', {trace: 'asdf'}) --> 'name: asdf'\n *  Lib.hovertemplateString('name: %{trace[0].name}', {trace: [{name: 'asdf'}]}) --> 'name: asdf'\n *  Lib.hovertemplateString('price: %{y:$.2f}', {y: 1}) --> 'price: $1.00'\n *\n * @param {string}  input string containing %{...:...} template strings\n * @param {obj}     data object containing fallback text when no formatting is specified, ex.: {yLabel: 'formattedYValue'}\n * @param {obj}     d3 locale\n * @param {obj}     data objects containing substitution values\n *\n * @return {string} templated string\n */\nfunction templateFormatString(string, labels, d3locale) {\n    var opts = this;\n    var args = arguments;\n    if(!labels) labels = {};\n    // Not all that useful, but cache nestedProperty instantiation\n    // just in case it speeds things up *slightly*:\n    var getterCache = {};\n\n    return string.replace(lib.TEMPLATE_STRING_REGEX, function(match, rawKey, format) {\n        var isOther =\n            rawKey === 'xother' ||\n            rawKey === 'yother';\n\n        var isSpaceOther =\n            rawKey === '_xother' ||\n            rawKey === '_yother';\n\n        var isSpaceOtherSpace =\n            rawKey === '_xother_' ||\n            rawKey === '_yother_';\n\n        var isOtherSpace =\n            rawKey === 'xother_' ||\n            rawKey === 'yother_';\n\n        var hasOther = isOther || isSpaceOther || isOtherSpace || isSpaceOtherSpace;\n\n        var key = rawKey;\n        if(isSpaceOther || isSpaceOtherSpace) key = key.substring(1);\n        if(isOtherSpace || isSpaceOtherSpace) key = key.substring(0, key.length - 1);\n\n        var value;\n        if(hasOther) {\n            value = labels[key];\n            if(value === undefined) return '';\n        } else {\n            var obj, i;\n            for(i = 3; i < args.length; i++) {\n                obj = args[i];\n                if(!obj) continue;\n                if(obj.hasOwnProperty(key)) {\n                    value = obj[key];\n                    break;\n                }\n\n                if(!SIMPLE_PROPERTY_REGEX.test(key)) {\n                    value = lib.nestedProperty(obj, key).get();\n                    value = getterCache[key] || lib.nestedProperty(obj, key).get();\n                    if(value) getterCache[key] = value;\n                }\n                if(value !== undefined) break;\n            }\n        }\n\n        if(value === undefined && opts) {\n            if(opts.count < opts.max) {\n                lib.warn('Variable \\'' + key + '\\' in ' + opts.name + ' could not be found!');\n                value = match;\n            }\n\n            if(opts.count === opts.max) {\n                lib.warn('Too many ' + opts.name + ' warnings - additional warnings will be suppressed');\n            }\n            opts.count++;\n\n            return match;\n        }\n\n        if(format) {\n            var fmt;\n            if(format[0] === ':') {\n                fmt = d3locale ? d3locale.numberFormat : d3.format;\n                value = fmt(format.replace(TEMPLATE_STRING_FORMAT_SEPARATOR, ''))(value);\n            }\n\n            if(format[0] === '|') {\n                fmt = d3locale ? d3locale.timeFormat : utcFormat;\n                var ms = lib.dateTime2ms(value);\n                value = lib.formatDate(ms, format.replace(TEMPLATE_STRING_FORMAT_SEPARATOR, ''), false, fmt);\n            }\n        } else {\n            var keyLabel = key + 'Label';\n            if(labels.hasOwnProperty(keyLabel)) value = labels[keyLabel];\n        }\n\n        if(hasOther) {\n            value = '(' + value + ')';\n            if(isSpaceOther || isSpaceOtherSpace) value = ' ' + value;\n            if(isOtherSpace || isSpaceOtherSpace) value = value + ' ';\n        }\n\n        return value;\n    });\n}\n\n/*\n * alphanumeric string sort, tailored for subplot IDs like scene2, scene10, x10y13 etc\n */\nvar char0 = 48;\nvar char9 = 57;\nlib.subplotSort = function(a, b) {\n    var l = Math.min(a.length, b.length) + 1;\n    var numA = 0;\n    var numB = 0;\n    for(var i = 0; i < l; i++) {\n        var charA = a.charCodeAt(i) || 0;\n        var charB = b.charCodeAt(i) || 0;\n        var isNumA = charA >= char0 && charA <= char9;\n        var isNumB = charB >= char0 && charB <= char9;\n\n        if(isNumA) numA = 10 * numA + charA - char0;\n        if(isNumB) numB = 10 * numB + charB - char0;\n\n        if(!isNumA || !isNumB) {\n            if(numA !== numB) return numA - numB;\n            if(charA !== charB) return charA - charB;\n        }\n    }\n    return numB - numA;\n};\n\n// repeatable pseudorandom generator\nvar randSeed = 2000000000;\n\nlib.seedPseudoRandom = function() {\n    randSeed = 2000000000;\n};\n\nlib.pseudoRandom = function() {\n    var lastVal = randSeed;\n    randSeed = (69069 * randSeed + 1) % 4294967296;\n    // don't let consecutive vals be too close together\n    // gets away from really trying to be random, in favor of better local uniformity\n    if(Math.abs(randSeed - lastVal) < 429496729) return lib.pseudoRandom();\n    return randSeed / 4294967296;\n};\n\n\n/** Fill hover 'pointData' container with 'correct' hover text value\n *\n * - If trace hoverinfo contains a 'text' flag and hovertext is not set,\n *   the text elements will be seen in the hover labels.\n *\n * - If trace hoverinfo contains a 'text' flag and hovertext is set,\n *   hovertext takes precedence over text\n *   i.e. the hoverinfo elements will be seen in the hover labels\n *\n *  @param {object} calcPt\n *  @param {object} trace\n *  @param {object || array} contOut (mutated here)\n */\nlib.fillText = function(calcPt, trace, contOut) {\n    var fill = Array.isArray(contOut) ?\n        function(v) { contOut.push(v); } :\n        function(v) { contOut.text = v; };\n\n    var htx = lib.extractOption(calcPt, trace, 'htx', 'hovertext');\n    if(lib.isValidTextValue(htx)) return fill(htx);\n\n    var tx = lib.extractOption(calcPt, trace, 'tx', 'text');\n    if(lib.isValidTextValue(tx)) return fill(tx);\n};\n\n// accept all truthy values and 0 (which gets cast to '0' in the hover labels)\nlib.isValidTextValue = function(v) {\n    return v || v === 0;\n};\n\n/**\n * @param {number} ratio\n * @param {number} n (number of decimal places)\n */\nlib.formatPercent = function(ratio, n) {\n    n = n || 0;\n    var str = (Math.round(100 * ratio * Math.pow(10, n)) * Math.pow(0.1, n)).toFixed(n) + '%';\n    for(var i = 0; i < n; i++) {\n        if(str.indexOf('.') !== -1) {\n            str = str.replace('0%', '%');\n            str = str.replace('.%', '%');\n        }\n    }\n    return str;\n};\n\nlib.isHidden = function(gd) {\n    var display = window.getComputedStyle(gd).display;\n    return !display || display === 'none';\n};\n\nlib.strTranslate = function(x, y) {\n    return (x || y) ? 'translate(' + x + ',' + y + ')' : '';\n};\n\nlib.strRotate = function(a) {\n    return a ? 'rotate(' + a + ')' : '';\n};\n\nlib.strScale = function(s) {\n    return s !== 1 ? 'scale(' + s + ')' : '';\n};\n\n/** Return transform text for bar bar-like rectangles and pie-like slices\n *  @param {object} transform\n *  - targetX: desired position on the x-axis\n *  - targetY: desired position on the y-axis\n *  - textX: text middle position on the x-axis\n *  - textY: text middle position on the y-axis\n *  - anchorX: (optional) text anchor position on the x-axis (computed from textX), zero for middle anchor\n *  - anchorY: (optional) text anchor position on the y-axis (computed from textY), zero for middle anchor\n *  - scale: (optional) scale applied after translate\n *  - rotate: (optional) rotation applied after scale\n *  - noCenter: when defined no extra arguments needed in rotation\n */\nlib.getTextTransform = function(transform) {\n    var noCenter = transform.noCenter;\n    var textX = transform.textX;\n    var textY = transform.textY;\n    var targetX = transform.targetX;\n    var targetY = transform.targetY;\n    var anchorX = transform.anchorX || 0;\n    var anchorY = transform.anchorY || 0;\n    var rotate = transform.rotate;\n    var scale = transform.scale;\n    if(!scale) scale = 0;\n    else if(scale > 1) scale = 1;\n\n    return (\n        lib.strTranslate(\n            targetX - scale * (textX + anchorX),\n            targetY - scale * (textY + anchorY)\n        ) +\n        lib.strScale(scale) +\n        (rotate ?\n            'rotate(' + rotate +\n                (noCenter ? '' : ' ' + textX + ' ' + textY) +\n            ')' : ''\n        )\n    );\n};\n\nlib.ensureUniformFontSize = function(gd, baseFont) {\n    var out = lib.extendFlat({}, baseFont);\n    out.size = Math.max(\n        baseFont.size,\n        gd._fullLayout.uniformtext.minsize || 0\n    );\n    return out;\n};\n\n/**\n * provide a human-readable list e.g. \"A, B, C and D\" with an ending separator\n *\n * @param {array} arr : the array to join\n * @param {string} mainSeparator : main separator\n * @param {string} lastSeparator : last separator\n *\n * @return {string} : joined list\n */\nlib.join2 = function(arr, mainSeparator, lastSeparator) {\n    var len = arr.length;\n    if(len > 1) {\n        return arr.slice(0, -1).join(mainSeparator) + lastSeparator + arr[len - 1];\n    }\n    return arr.join(mainSeparator);\n};\n\nlib.bigFont = function(size) {\n    return Math.round(1.2 * size);\n};\n\nvar firefoxVersion = lib.getFirefoxVersion();\n// see https://bugzilla.mozilla.org/show_bug.cgi?id=1684973\nvar isProblematicFirefox = firefoxVersion !== null && firefoxVersion < 86;\n\n/**\n * Return the mouse position from the last event registered by D3.\n * @returns An array with two numbers, representing the x and y coordinates of the mouse pointer\n *   at the event relative to the targeted node.\n */\nlib.getPositionFromD3Event = function() {\n    if(isProblematicFirefox) {\n        // layerX and layerY are non-standard, so we only fallback to them when we have to:\n        return [\n            d3.event.layerX,\n            d3.event.layerY\n        ];\n    } else {\n        return [\n            d3.event.offsetX,\n            d3.event.offsetY\n        ];\n    }\n};\n","'use strict';\n\n// more info: http://stackoverflow.com/questions/18531624/isplainobject-thing\nmodule.exports = function isPlainObject(obj) {\n    // We need to be a little less strict in the `imagetest` container because\n    // of how async image requests are handled.\n    //\n    // N.B. isPlainObject(new Constructor()) will return true in `imagetest`\n    if(window && window.process && window.process.versions) {\n        return Object.prototype.toString.call(obj) === '[object Object]';\n    }\n\n    return (\n        Object.prototype.toString.call(obj) === '[object Object]' &&\n        Object.getPrototypeOf(obj).hasOwnProperty('hasOwnProperty')\n    );\n};\n","'use strict';\n\nvar nestedProperty = require('./nested_property');\n\nvar SIMPLE_PROPERTY_REGEX = /^\\w*$/;\n\n// bitmask for deciding what's updated. Sometimes the name needs to be updated,\n// sometimes the value needs to be updated, and sometimes both do. This is just\n// a simple way to track what's updated such that it's a simple OR operation to\n// assimilate new updates.\n//\n// The only exception is the UNSET bit that tracks when we need to explicitly\n// unset and remove the property. This concrn arises because of the special\n// way in which nestedProperty handles null/undefined. When you specify `null`,\n// it prunes any unused items in the tree. I ran into some issues with it getting\n// null vs undefined confused, so UNSET is just a bit that forces the property\n// update to send `null`, removing the property explicitly rather than setting\n// it to undefined.\nvar NONE = 0;\nvar NAME = 1;\nvar VALUE = 2;\nvar BOTH = 3;\nvar UNSET = 4;\n\nmodule.exports = function keyedContainer(baseObj, path, keyName, valueName) {\n    keyName = keyName || 'name';\n    valueName = valueName || 'value';\n    var i, arr, baseProp;\n    var changeTypes = {};\n\n    if(path && path.length) {\n        baseProp = nestedProperty(baseObj, path);\n        arr = baseProp.get();\n    } else {\n        arr = baseObj;\n    }\n\n    path = path || '';\n\n    // Construct an index:\n    var indexLookup = {};\n    if(arr) {\n        for(i = 0; i < arr.length; i++) {\n            indexLookup[arr[i][keyName]] = i;\n        }\n    }\n\n    var isSimpleValueProp = SIMPLE_PROPERTY_REGEX.test(valueName);\n\n    var obj = {\n        set: function(name, value) {\n            var changeType = value === null ? UNSET : NONE;\n\n            // create the base array if necessary\n            if(!arr) {\n                if(!baseProp || changeType === UNSET) return;\n\n                arr = [];\n                baseProp.set(arr);\n            }\n\n            var idx = indexLookup[name];\n            if(idx === undefined) {\n                if(changeType === UNSET) return;\n\n                changeType = changeType | BOTH;\n                idx = arr.length;\n                indexLookup[name] = idx;\n            } else if(value !== (isSimpleValueProp ? arr[idx][valueName] : nestedProperty(arr[idx], valueName).get())) {\n                changeType = changeType | VALUE;\n            }\n\n            var newValue = arr[idx] = arr[idx] || {};\n            newValue[keyName] = name;\n\n            if(isSimpleValueProp) {\n                newValue[valueName] = value;\n            } else {\n                nestedProperty(newValue, valueName).set(value);\n            }\n\n            // If it's not an unset, force that bit to be unset. This is all related to the fact\n            // that undefined and null are a bit specially implemented in nestedProperties.\n            if(value !== null) {\n                changeType = changeType & ~UNSET;\n            }\n\n            changeTypes[idx] = changeTypes[idx] | changeType;\n\n            return obj;\n        },\n        get: function(name) {\n            if(!arr) return;\n\n            var idx = indexLookup[name];\n\n            if(idx === undefined) {\n                return undefined;\n            } else if(isSimpleValueProp) {\n                return arr[idx][valueName];\n            } else {\n                return nestedProperty(arr[idx], valueName).get();\n            }\n        },\n        rename: function(name, newName) {\n            var idx = indexLookup[name];\n\n            if(idx === undefined) return obj;\n            changeTypes[idx] = changeTypes[idx] | NAME;\n\n            indexLookup[newName] = idx;\n            delete indexLookup[name];\n\n            arr[idx][keyName] = newName;\n\n            return obj;\n        },\n        remove: function(name) {\n            var idx = indexLookup[name];\n\n            if(idx === undefined) return obj;\n\n            var object = arr[idx];\n            if(Object.keys(object).length > 2) {\n                // This object contains more than just the key/value, so unset\n                // the value without modifying the entry otherwise:\n                changeTypes[idx] = changeTypes[idx] | VALUE;\n                return obj.set(name, null);\n            }\n\n            if(isSimpleValueProp) {\n                for(i = idx; i < arr.length; i++) {\n                    changeTypes[i] = changeTypes[i] | BOTH;\n                }\n                for(i = idx; i < arr.length; i++) {\n                    indexLookup[arr[i][keyName]]--;\n                }\n                arr.splice(idx, 1);\n                delete(indexLookup[name]);\n            } else {\n                // Perform this update *strictly* so we can check whether the result's\n                // been pruned. If so, it's a removal. If not, it's a value unset only.\n                nestedProperty(object, valueName).set(null);\n\n                // Now check if the top level nested property has any keys left. If so,\n                // the object still has values so we only want to unset the key. If not,\n                // the entire object can be removed since there's no other data.\n                // var topLevelKeys = Object.keys(object[valueName.split('.')[0]] || []);\n\n                changeTypes[idx] = changeTypes[idx] | VALUE | UNSET;\n            }\n\n            return obj;\n        },\n        constructUpdate: function() {\n            var astr, idx;\n            var update = {};\n            var changed = Object.keys(changeTypes);\n            for(var i = 0; i < changed.length; i++) {\n                idx = changed[i];\n                astr = path + '[' + idx + ']';\n                if(arr[idx]) {\n                    if(changeTypes[idx] & NAME) {\n                        update[astr + '.' + keyName] = arr[idx][keyName];\n                    }\n                    if(changeTypes[idx] & VALUE) {\n                        if(isSimpleValueProp) {\n                            update[astr + '.' + valueName] = (changeTypes[idx] & UNSET) ? null : arr[idx][valueName];\n                        } else {\n                            update[astr + '.' + valueName] = (changeTypes[idx] & UNSET) ? null : nestedProperty(arr[idx], valueName).get();\n                        }\n                    }\n                } else {\n                    update[astr] = null;\n                }\n            }\n\n            return update;\n        }\n    };\n\n    return obj;\n};\n","'use strict';\n\nvar Registry = require('../registry');\n\n/**\n * localize: translate a string for the current locale\n *\n * @param {object} gd: the graphDiv for context\n *  gd._context.locale determines the language (& optional region/country)\n *  the dictionary for each locale may either be supplied in\n *  gd._context.locales or globally via Plotly.register\n * @param {string} s: the string to translate\n */\nmodule.exports = function localize(gd, s) {\n    var locale = gd._context.locale;\n\n    /*\n     * Priority of lookup:\n     *     contextDicts[locale],\n     *     registeredDicts[locale],\n     *     contextDicts[baseLocale], (if baseLocale is distinct)\n     *     registeredDicts[baseLocale]\n     * Return the first translation we find.\n     * This way if you have a regionalization you are allowed to specify\n     * only what's different from the base locale, everything else will\n     * fall back on the base.\n     */\n    for(var i = 0; i < 2; i++) {\n        var locales = gd._context.locales;\n        for(var j = 0; j < 2; j++) {\n            var dict = (locales[locale] || {}).dictionary;\n            if(dict) {\n                var out = dict[s];\n                if(out) return out;\n            }\n            locales = Registry.localeRegistry;\n        }\n\n        var baseLocale = locale.split('-')[0];\n        if(baseLocale === locale) break;\n        locale = baseLocale;\n    }\n\n    return s;\n};\n","'use strict';\n\n/* eslint-disable no-console */\n\nvar dfltConfig = require('../plot_api/plot_config').dfltConfig;\n\nvar notifier = require('./notifier');\n\nvar loggers = module.exports = {};\n\n/**\n * ------------------------------------------\n * debugging tools\n * ------------------------------------------\n */\n\nloggers.log = function() {\n    var i;\n\n    if(dfltConfig.logging > 1) {\n        var messages = ['LOG:'];\n        for(i = 0; i < arguments.length; i++) {\n            messages.push(arguments[i]);\n        }\n        console.trace.apply(console, messages);\n    }\n\n    if(dfltConfig.notifyOnLogging > 1) {\n        var lines = [];\n        for(i = 0; i < arguments.length; i++) {\n            lines.push(arguments[i]);\n        }\n        notifier(lines.join('<br>'), 'long');\n    }\n};\n\nloggers.warn = function() {\n    var i;\n\n    if(dfltConfig.logging > 0) {\n        var messages = ['WARN:'];\n        for(i = 0; i < arguments.length; i++) {\n            messages.push(arguments[i]);\n        }\n        console.trace.apply(console, messages);\n    }\n\n    if(dfltConfig.notifyOnLogging > 0) {\n        var lines = [];\n        for(i = 0; i < arguments.length; i++) {\n            lines.push(arguments[i]);\n        }\n        notifier(lines.join('<br>'), 'stick');\n    }\n};\n\nloggers.error = function() {\n    var i;\n\n    if(dfltConfig.logging > 0) {\n        var messages = ['ERROR:'];\n        for(i = 0; i < arguments.length; i++) {\n            messages.push(arguments[i]);\n        }\n        console.error.apply(console, messages);\n    }\n\n    if(dfltConfig.notifyOnLogging > 0) {\n        var lines = [];\n        for(i = 0; i < arguments.length; i++) {\n            lines.push(arguments[i]);\n        }\n        notifier(lines.join('<br>'), 'stick');\n    }\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\n/**\n * General helper to manage trace groups based on calcdata\n *\n * @param {d3.selection} traceLayer: a selection containing a single group\n *     to draw these traces into\n * @param {array} cdModule: array of calcdata items for this\n *     module and subplot combination. Assumes the calcdata item for each\n *     trace is an array with the fullData trace attached to the first item.\n * @param {string} cls: the class attribute to give each trace group\n *     so you can give multiple classes separated by spaces\n */\nmodule.exports = function makeTraceGroups(traceLayer, cdModule, cls) {\n    var traces = traceLayer.selectAll('g.' + cls.replace(/\\s/g, '.'))\n        .data(cdModule, function(cd) { return cd[0].trace.uid; });\n\n    traces.exit().remove();\n\n    traces.enter().append('g')\n        .attr('class', cls);\n\n    traces.order();\n\n    // stash ref node to trace group in calcdata,\n    // useful for (fast) styleOnSelect\n    var k = traceLayer.classed('rangeplot') ? 'nodeRangePlot3' : 'node3';\n    traces.each(function(cd) { cd[0][k] = d3.select(this); });\n\n    return traces;\n};\n","'use strict';\n\nvar mat4X4 = require('gl-mat4');\n\nexports.init2dArray = function(rowLength, colLength) {\n    var array = new Array(rowLength);\n    for(var i = 0; i < rowLength; i++) array[i] = new Array(colLength);\n    return array;\n};\n\n/**\n * transpose a (possibly ragged) 2d array z. inspired by\n * http://stackoverflow.com/questions/17428587/\n * transposing-a-2d-array-in-javascript\n */\nexports.transposeRagged = function(z) {\n    var maxlen = 0;\n    var zlen = z.length;\n    var i, j;\n    // Maximum row length:\n    for(i = 0; i < zlen; i++) maxlen = Math.max(maxlen, z[i].length);\n\n    var t = new Array(maxlen);\n    for(i = 0; i < maxlen; i++) {\n        t[i] = new Array(zlen);\n        for(j = 0; j < zlen; j++) t[i][j] = z[j][i];\n    }\n\n    return t;\n};\n\n// our own dot function so that we don't need to include numeric\nexports.dot = function(x, y) {\n    if(!(x.length && y.length) || x.length !== y.length) return null;\n\n    var len = x.length;\n    var out;\n    var i;\n\n    if(x[0].length) {\n        // mat-vec or mat-mat\n        out = new Array(len);\n        for(i = 0; i < len; i++) out[i] = exports.dot(x[i], y);\n    } else if(y[0].length) {\n        // vec-mat\n        var yTranspose = exports.transposeRagged(y);\n        out = new Array(yTranspose.length);\n        for(i = 0; i < yTranspose.length; i++) out[i] = exports.dot(x, yTranspose[i]);\n    } else {\n        // vec-vec\n        out = 0;\n        for(i = 0; i < len; i++) out += x[i] * y[i];\n    }\n\n    return out;\n};\n\n// translate by (x,y)\nexports.translationMatrix = function(x, y) {\n    return [[1, 0, x], [0, 1, y], [0, 0, 1]];\n};\n\n// rotate by alpha around (0,0)\nexports.rotationMatrix = function(alpha) {\n    var a = alpha * Math.PI / 180;\n    return [[Math.cos(a), -Math.sin(a), 0],\n            [Math.sin(a), Math.cos(a), 0],\n            [0, 0, 1]];\n};\n\n// rotate by alpha around (x,y)\nexports.rotationXYMatrix = function(a, x, y) {\n    return exports.dot(\n        exports.dot(exports.translationMatrix(x, y),\n                    exports.rotationMatrix(a)),\n        exports.translationMatrix(-x, -y));\n};\n\n// applies a 3D transformation matrix to either x, y and z params\n// Note: z is optional\nexports.apply3DTransform = function(transform) {\n    return function() {\n        var args = arguments;\n        var xyz = arguments.length === 1 ? args[0] : [args[0], args[1], args[2] || 0];\n        return exports.dot(transform, [xyz[0], xyz[1], xyz[2], 1]).slice(0, 3);\n    };\n};\n\n// applies a 2D transformation matrix to either x and y params or an [x,y] array\nexports.apply2DTransform = function(transform) {\n    return function() {\n        var args = arguments;\n        if(args.length === 3) {\n            args = args[0];\n        } // from map\n        var xy = arguments.length === 1 ? args[0] : [args[0], args[1]];\n        return exports.dot(transform, [xy[0], xy[1], 1]).slice(0, 2);\n    };\n};\n\n// applies a 2D transformation matrix to an [x1,y1,x2,y2] array (to transform a segment)\nexports.apply2DTransform2 = function(transform) {\n    var at = exports.apply2DTransform(transform);\n    return function(xys) {\n        return at(xys.slice(0, 2)).concat(at(xys.slice(2, 4)));\n    };\n};\n\nexports.convertCssMatrix = function(m) {\n    if(m) {\n        var len = m.length;\n        if(len === 16) return m;\n        if(len === 6) {\n            // converts a 2x3 css transform matrix to a 4x4 matrix see https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/matrix\n            return [\n                m[0], m[1], 0, 0,\n                m[2], m[3], 0, 0,\n                0, 0, 1, 0,\n                m[4], m[5], 0, 1\n            ];\n        }\n    }\n    return [\n        1, 0, 0, 0,\n        0, 1, 0, 0,\n        0, 0, 1, 0,\n        0, 0, 0, 1\n    ];\n};\n\n// find the inverse for a 4x4 affine transform matrix\nexports.inverseTransformMatrix = function(m) {\n    var out = [];\n    mat4X4.invert(out, m);\n    return [\n        [out[0], out[1], out[2], out[3]],\n        [out[4], out[5], out[6], out[7]],\n        [out[8], out[9], out[10], out[11]],\n        [out[12], out[13], out[14], out[15]]\n    ];\n};\n","'use strict';\n\n/**\n * sanitized modulus function that always returns in the range [0, d)\n * rather than (-d, 0] if v is negative\n */\nfunction mod(v, d) {\n    var out = v % d;\n    return out < 0 ? out + d : out;\n}\n\n/**\n * sanitized modulus function that always returns in the range [-d/2, d/2]\n * rather than (-d, 0] if v is negative\n */\nfunction modHalf(v, d) {\n    return Math.abs(v) > (d / 2) ?\n        v - Math.round(v / d) * d :\n        v;\n}\n\nmodule.exports = {\n    mod: mod,\n    modHalf: modHalf\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar isArrayOrTypedArray = require('./array').isArrayOrTypedArray;\n\n/**\n * convert a string s (such as 'xaxis.range[0]')\n * representing a property of nested object into set and get methods\n * also return the string and object so we don't have to keep track of them\n * allows [-1] for an array index, to set a property inside all elements\n * of an array\n * eg if obj = {arr: [{a: 1}, {a: 2}]}\n * you can do p = nestedProperty(obj, 'arr[-1].a')\n * but you cannot set the array itself this way, to do that\n * just set the whole array.\n * eg if obj = {arr: [1, 2, 3]}\n * you can't do nestedProperty(obj, 'arr[-1]').set(5)\n * but you can do nestedProperty(obj, 'arr').set([5, 5, 5])\n */\nmodule.exports = function nestedProperty(container, propStr) {\n    if(isNumeric(propStr)) propStr = String(propStr);\n    else if(typeof propStr !== 'string' ||\n            propStr.substr(propStr.length - 4) === '[-1]') {\n        throw 'bad property string';\n    }\n\n    var j = 0;\n    var propParts = propStr.split('.');\n    var indexed;\n    var indices;\n    var i;\n\n    // check for parts of the nesting hierarchy that are numbers (ie array elements)\n    while(j < propParts.length) {\n        // look for non-bracket chars, then any number of [##] blocks\n        indexed = String(propParts[j]).match(/^([^\\[\\]]*)((\\[\\-?[0-9]*\\])+)$/);\n        if(indexed) {\n            if(indexed[1]) propParts[j] = indexed[1];\n            // allow propStr to start with bracketed array indices\n            else if(j === 0) propParts.splice(0, 1);\n            else throw 'bad property string';\n\n            indices = indexed[2]\n                .substr(1, indexed[2].length - 2)\n                .split('][');\n\n            for(i = 0; i < indices.length; i++) {\n                j++;\n                propParts.splice(j, 0, Number(indices[i]));\n            }\n        }\n        j++;\n    }\n\n    if(typeof container !== 'object') {\n        return badContainer(container, propStr, propParts);\n    }\n\n    return {\n        set: npSet(container, propParts, propStr),\n        get: npGet(container, propParts),\n        astr: propStr,\n        parts: propParts,\n        obj: container\n    };\n};\n\nfunction npGet(cont, parts) {\n    return function() {\n        var curCont = cont;\n        var curPart;\n        var allSame;\n        var out;\n        var i;\n        var j;\n\n        for(i = 0; i < parts.length - 1; i++) {\n            curPart = parts[i];\n            if(curPart === -1) {\n                allSame = true;\n                out = [];\n                for(j = 0; j < curCont.length; j++) {\n                    out[j] = npGet(curCont[j], parts.slice(i + 1))();\n                    if(out[j] !== out[0]) allSame = false;\n                }\n                return allSame ? out[0] : out;\n            }\n            if(typeof curPart === 'number' && !isArrayOrTypedArray(curCont)) {\n                return undefined;\n            }\n            curCont = curCont[curPart];\n            if(typeof curCont !== 'object' || curCont === null) {\n                return undefined;\n            }\n        }\n\n        // only hit this if parts.length === 1\n        if(typeof curCont !== 'object' || curCont === null) return undefined;\n\n        out = curCont[parts[i]];\n        if(out === null) return undefined;\n        return out;\n    };\n}\n\n/*\n * Can this value be deleted? We can delete `undefined`, and `null` except INSIDE an\n * *args* array.\n *\n * Previously we also deleted some `{}` and `[]`, in order to try and make set/unset\n * a net noop; but this causes far more complication than it's worth, and still had\n * lots of exceptions. See https://github.com/plotly/plotly.js/issues/1410\n *\n * *args* arrays get passed directly to API methods and we should respect null if\n * the user put it there, but otherwise null is deleted as we use it as code\n * in restyle/relayout/update for \"delete this value\" whereas undefined means\n * \"ignore this edit\"\n */\nvar ARGS_PATTERN = /(^|\\.)args\\[/;\nfunction isDeletable(val, propStr) {\n    return (val === undefined) || (val === null && !propStr.match(ARGS_PATTERN));\n}\n\nfunction npSet(cont, parts, propStr) {\n    return function(val) {\n        var curCont = cont;\n        var propPart = '';\n        var containerLevels = [[cont, propPart]];\n        var toDelete = isDeletable(val, propStr);\n        var curPart;\n        var i;\n\n        for(i = 0; i < parts.length - 1; i++) {\n            curPart = parts[i];\n\n            if(typeof curPart === 'number' && !isArrayOrTypedArray(curCont)) {\n                throw 'array index but container is not an array';\n            }\n\n            // handle special -1 array index\n            if(curPart === -1) {\n                toDelete = !setArrayAll(curCont, parts.slice(i + 1), val, propStr);\n                if(toDelete) break;\n                else return;\n            }\n\n            if(!checkNewContainer(curCont, curPart, parts[i + 1], toDelete)) {\n                break;\n            }\n\n            curCont = curCont[curPart];\n\n            if(typeof curCont !== 'object' || curCont === null) {\n                throw 'container is not an object';\n            }\n\n            propPart = joinPropStr(propPart, curPart);\n\n            containerLevels.push([curCont, propPart]);\n        }\n\n        if(toDelete) {\n            if(i === parts.length - 1) {\n                delete curCont[parts[i]];\n\n                // The one bit of pruning we still do: drop `undefined` from the end of arrays.\n                // In case someone has already unset previous items, continue until we hit a\n                // non-undefined value.\n                if(Array.isArray(curCont) && +parts[i] === curCont.length - 1) {\n                    while(curCont.length && curCont[curCont.length - 1] === undefined) {\n                        curCont.pop();\n                    }\n                }\n            }\n        } else curCont[parts[i]] = val;\n    };\n}\n\nfunction joinPropStr(propStr, newPart) {\n    var toAdd = newPart;\n    if(isNumeric(newPart)) toAdd = '[' + newPart + ']';\n    else if(propStr) toAdd = '.' + newPart;\n\n    return propStr + toAdd;\n}\n\n// handle special -1 array index\nfunction setArrayAll(containerArray, innerParts, val, propStr) {\n    var arrayVal = isArrayOrTypedArray(val);\n    var allSet = true;\n    var thisVal = val;\n    var thisPropStr = propStr.replace('-1', 0);\n    var deleteThis = arrayVal ? false : isDeletable(val, thisPropStr);\n    var firstPart = innerParts[0];\n    var i;\n\n    for(i = 0; i < containerArray.length; i++) {\n        thisPropStr = propStr.replace('-1', i);\n        if(arrayVal) {\n            thisVal = val[i % val.length];\n            deleteThis = isDeletable(thisVal, thisPropStr);\n        }\n        if(deleteThis) allSet = false;\n        if(!checkNewContainer(containerArray, i, firstPart, deleteThis)) {\n            continue;\n        }\n        npSet(containerArray[i], innerParts, propStr.replace('-1', i))(thisVal);\n    }\n    return allSet;\n}\n\n/**\n * make new sub-container as needed.\n * returns false if there's no container and none is needed\n * because we're only deleting an attribute\n */\nfunction checkNewContainer(container, part, nextPart, toDelete) {\n    if(container[part] === undefined) {\n        if(toDelete) return false;\n\n        if(typeof nextPart === 'number') container[part] = [];\n        else container[part] = {};\n    }\n    return true;\n}\n\nfunction badContainer(container, propStr, propParts) {\n    return {\n        set: function() { throw 'bad container'; },\n        get: function() {},\n        astr: propStr,\n        parts: propParts,\n        obj: container\n    };\n}\n","'use strict';\n\n// Simple helper functions\n// none of these need any external deps\n\nmodule.exports = function noop() {};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar isNumeric = require('fast-isnumeric');\n\nvar NOTEDATA = [];\n\n/**\n * notifier\n * @param {String} text The person's user name\n * @param {Number} [delay=1000] The delay time in milliseconds\n *          or 'long' which provides 2000 ms delay time.\n * @return {undefined} this function does not return a value\n */\nmodule.exports = function(text, displayLength) {\n    if(NOTEDATA.indexOf(text) !== -1) return;\n\n    NOTEDATA.push(text);\n\n    var ts = 1000;\n    if(isNumeric(displayLength)) ts = displayLength;\n    else if(displayLength === 'long') ts = 3000;\n\n    var notifierContainer = d3.select('body')\n        .selectAll('.plotly-notifier')\n        .data([0]);\n    notifierContainer.enter()\n        .append('div')\n        .classed('plotly-notifier', true);\n\n    var notes = notifierContainer.selectAll('.notifier-note').data(NOTEDATA);\n\n    function killNote(transition) {\n        transition\n            .duration(700)\n            .style('opacity', 0)\n            .each('end', function(thisText) {\n                var thisIndex = NOTEDATA.indexOf(thisText);\n                if(thisIndex !== -1) NOTEDATA.splice(thisIndex, 1);\n                d3.select(this).remove();\n            });\n    }\n\n    notes.enter().append('div')\n        .classed('notifier-note', true)\n        .style('opacity', 0)\n        .each(function(thisText) {\n            var note = d3.select(this);\n\n            note.append('button')\n                .classed('notifier-close', true)\n                .html('&times;')\n                .on('click', function() {\n                    note.transition().call(killNote);\n                });\n\n            var p = note.append('p');\n            var lines = thisText.split(/<br\\s*\\/?>/g);\n            for(var i = 0; i < lines.length; i++) {\n                if(i) p.append('br');\n                p.append('span').text(lines[i]);\n            }\n\n            if(displayLength === 'stick') {\n                note.transition()\n                        .duration(350)\n                        .style('opacity', 1);\n            } else {\n                note.transition()\n                        .duration(700)\n                        .style('opacity', 1)\n                    .transition()\n                        .delay(ts)\n                        .call(killNote);\n            }\n        });\n};\n","'use strict';\n\nvar setCursor = require('./setcursor');\n\nvar STASHATTR = 'data-savedcursor';\nvar NO_CURSOR = '!!';\n\n/*\n * works with our CSS cursor classes (see css/_cursor.scss)\n * to override a previous cursor set on d3 single-element selections,\n * by moving the name of the original cursor to the data-savedcursor attr.\n * omit cursor to revert to the previously set value.\n */\nmodule.exports = function overrideCursor(el3, csr) {\n    var savedCursor = el3.attr(STASHATTR);\n    if(csr) {\n        if(!savedCursor) {\n            var classes = (el3.attr('class') || '').split(' ');\n            for(var i = 0; i < classes.length; i++) {\n                var cls = classes[i];\n                if(cls.indexOf('cursor-') === 0) {\n                    el3.attr(STASHATTR, cls.substr(7))\n                        .classed(cls, false);\n                }\n            }\n            if(!el3.attr(STASHATTR)) {\n                el3.attr(STASHATTR, NO_CURSOR);\n            }\n        }\n        setCursor(el3, csr);\n    } else if(savedCursor) {\n        el3.attr(STASHATTR, null);\n\n        if(savedCursor === NO_CURSOR) setCursor(el3);\n        else setCursor(el3, savedCursor);\n    }\n};\n","'use strict';\n\nvar dot = require('./matrix').dot;\nvar BADNUM = require('../constants/numerical').BADNUM;\n\nvar polygon = module.exports = {};\n\n/**\n * Turn an array of [x, y] pairs into a polygon object\n * that can test if points are inside it\n *\n * @param ptsIn Array of [x, y] pairs\n *\n * @returns polygon Object {xmin, xmax, ymin, ymax, pts, contains}\n *      (x|y)(min|max) are the bounding rect of the polygon\n *      pts is the original array, with the first pair repeated at the end\n *      contains is a function: (pt, omitFirstEdge)\n *          pt is the [x, y] pair to test\n *          omitFirstEdge truthy means points exactly on the first edge don't\n *              count. This is for use adding one polygon to another so we\n *              don't double-count the edge where they meet.\n *          returns boolean: is pt inside the polygon (including on its edges)\n */\npolygon.tester = function tester(ptsIn) {\n    var pts = ptsIn.slice();\n    var xmin = pts[0][0];\n    var xmax = xmin;\n    var ymin = pts[0][1];\n    var ymax = ymin;\n    var i;\n\n    pts.push(pts[0]);\n    for(i = 1; i < pts.length; i++) {\n        xmin = Math.min(xmin, pts[i][0]);\n        xmax = Math.max(xmax, pts[i][0]);\n        ymin = Math.min(ymin, pts[i][1]);\n        ymax = Math.max(ymax, pts[i][1]);\n    }\n\n    // do we have a rectangle? Handle this here, so we can use the same\n    // tester for the rectangular case without sacrificing speed\n\n    var isRect = false;\n    var rectFirstEdgeTest;\n\n    if(pts.length === 5) {\n        if(pts[0][0] === pts[1][0]) { // vert, horz, vert, horz\n            if(pts[2][0] === pts[3][0] &&\n                    pts[0][1] === pts[3][1] &&\n                    pts[1][1] === pts[2][1]) {\n                isRect = true;\n                rectFirstEdgeTest = function(pt) { return pt[0] === pts[0][0]; };\n            }\n        } else if(pts[0][1] === pts[1][1]) { // horz, vert, horz, vert\n            if(pts[2][1] === pts[3][1] &&\n                    pts[0][0] === pts[3][0] &&\n                    pts[1][0] === pts[2][0]) {\n                isRect = true;\n                rectFirstEdgeTest = function(pt) { return pt[1] === pts[0][1]; };\n            }\n        }\n    }\n\n    function rectContains(pt, omitFirstEdge) {\n        var x = pt[0];\n        var y = pt[1];\n\n        if(x === BADNUM || x < xmin || x > xmax || y === BADNUM || y < ymin || y > ymax) {\n            // pt is outside the bounding box of polygon\n            return false;\n        }\n        if(omitFirstEdge && rectFirstEdgeTest(pt)) return false;\n\n        return true;\n    }\n\n    function contains(pt, omitFirstEdge) {\n        var x = pt[0];\n        var y = pt[1];\n\n        if(x === BADNUM || x < xmin || x > xmax || y === BADNUM || y < ymin || y > ymax) {\n            // pt is outside the bounding box of polygon\n            return false;\n        }\n\n        var imax = pts.length;\n        var x1 = pts[0][0];\n        var y1 = pts[0][1];\n        var crossings = 0;\n        var i;\n        var x0;\n        var y0;\n        var xmini;\n        var ycross;\n\n        for(i = 1; i < imax; i++) {\n            // find all crossings of a vertical line upward from pt with\n            // polygon segments\n            // crossings exactly at xmax don't count, unless the point is\n            // exactly on the segment, then it counts as inside.\n            x0 = x1;\n            y0 = y1;\n            x1 = pts[i][0];\n            y1 = pts[i][1];\n            xmini = Math.min(x0, x1);\n\n            if(x < xmini || x > Math.max(x0, x1) || y > Math.max(y0, y1)) {\n                // outside the bounding box of this segment, it's only a crossing\n                // if it's below the box.\n\n                continue;\n            } else if(y < Math.min(y0, y1)) {\n                // don't count the left-most point of the segment as a crossing\n                // because we don't want to double-count adjacent crossings\n                // UNLESS the polygon turns past vertical at exactly this x\n                // Note that this is repeated below, but we can't factor it out\n                // because\n                if(x !== xmini) crossings++;\n            } else {\n                // inside the bounding box, check the actual line intercept\n\n                // vertical segment - we know already that the point is exactly\n                // on the segment, so mark the crossing as exactly at the point.\n                if(x1 === x0) ycross = y;\n                // any other angle\n                else ycross = y0 + (x - x0) * (y1 - y0) / (x1 - x0);\n\n                // exactly on the edge: counts as inside the polygon, unless it's the\n                // first edge and we're omitting it.\n                if(y === ycross) {\n                    if(i === 1 && omitFirstEdge) return false;\n                    return true;\n                }\n\n                if(y <= ycross && x !== xmini) crossings++;\n            }\n        }\n\n        // if we've gotten this far, odd crossings means inside, even is outside\n        return crossings % 2 === 1;\n    }\n\n    // detect if poly is degenerate\n    var degenerate = true;\n    var lastPt = pts[0];\n    for(i = 1; i < pts.length; i++) {\n        if(lastPt[0] !== pts[i][0] || lastPt[1] !== pts[i][1]) {\n            degenerate = false;\n            break;\n        }\n    }\n\n    return {\n        xmin: xmin,\n        xmax: xmax,\n        ymin: ymin,\n        ymax: ymax,\n        pts: pts,\n        contains: isRect ? rectContains : contains,\n        isRect: isRect,\n        degenerate: degenerate\n    };\n};\n\n/**\n * Test if a segment of a points array is bent or straight\n *\n * @param pts Array of [x, y] pairs\n * @param start the index of the proposed start of the straight section\n * @param end the index of the proposed end point\n * @param tolerance the max distance off the line connecting start and end\n *      before the line counts as bent\n * @returns boolean: true means this segment is bent, false means straight\n */\npolygon.isSegmentBent = function isSegmentBent(pts, start, end, tolerance) {\n    var startPt = pts[start];\n    var segment = [pts[end][0] - startPt[0], pts[end][1] - startPt[1]];\n    var segmentSquared = dot(segment, segment);\n    var segmentLen = Math.sqrt(segmentSquared);\n    var unitPerp = [-segment[1] / segmentLen, segment[0] / segmentLen];\n    var i;\n    var part;\n    var partParallel;\n\n    for(i = start + 1; i < end; i++) {\n        part = [pts[i][0] - startPt[0], pts[i][1] - startPt[1]];\n        partParallel = dot(part, segment);\n\n        if(partParallel < 0 || partParallel > segmentSquared ||\n            Math.abs(dot(part, unitPerp)) > tolerance) return true;\n    }\n    return false;\n};\n\n/**\n * Make a filtering polygon, to minimize the number of segments\n *\n * @param pts Array of [x, y] pairs (must start with at least 1 pair)\n * @param tolerance the maximum deviation from straight allowed for\n *      removing points to simplify the polygon\n *\n * @returns Object {addPt, raw, filtered}\n *      addPt is a function(pt: [x, y] pair) to add a raw point and\n *          continue filtering\n *      raw is all the input points\n *      filtered is the resulting filtered Array of [x, y] pairs\n */\npolygon.filter = function filter(pts, tolerance) {\n    var ptsFiltered = [pts[0]];\n    var doneRawIndex = 0;\n    var doneFilteredIndex = 0;\n\n    function addPt(pt) {\n        pts.push(pt);\n        var prevFilterLen = ptsFiltered.length;\n        var iLast = doneRawIndex;\n        ptsFiltered.splice(doneFilteredIndex + 1);\n\n        for(var i = iLast + 1; i < pts.length; i++) {\n            if(i === pts.length - 1 || polygon.isSegmentBent(pts, iLast, i + 1, tolerance)) {\n                ptsFiltered.push(pts[i]);\n                if(ptsFiltered.length < prevFilterLen - 2) {\n                    doneRawIndex = i;\n                    doneFilteredIndex = ptsFiltered.length - 1;\n                }\n                iLast = i;\n            }\n        }\n    }\n\n    if(pts.length > 1) {\n        var lastPt = pts.pop();\n        addPt(lastPt);\n    }\n\n    return {\n        addPt: addPt,\n        raw: pts,\n        filtered: ptsFiltered\n    };\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar isMobileOrTablet = require('is-mobile');\n\nmodule.exports = function preserveDrawingBuffer(opts) {\n    var ua;\n\n    if(opts && opts.hasOwnProperty('userAgent')) {\n        ua = opts.userAgent;\n    } else {\n        ua = getUserAgent();\n    }\n\n    if(typeof ua !== 'string') return true;\n\n    var enable = isMobileOrTablet({\n        ua: { headers: {'user-agent': ua }},\n        tablet: true,\n        featureDetect: false\n    });\n\n    if(!enable) {\n        var allParts = ua.split(' ');\n        for(var i = 1; i < allParts.length; i++) {\n            var part = allParts[i];\n            if(part.indexOf('Safari') !== -1) {\n                // find Safari version\n                for(var k = i - 1; k > -1; k--) {\n                    var prevPart = allParts[k];\n                    if(prevPart.substr(0, 8) === 'Version/') {\n                        var v = prevPart.substr(8).split('.')[0];\n                        if(isNumeric(v)) v = +v;\n                        if(v >= 13) return true;\n                    }\n                }\n            }\n        }\n    }\n\n    return enable;\n};\n\nfunction getUserAgent() {\n    // similar to https://github.com/juliangruber/is-mobile/blob/91ca39ccdd4cfc5edfb5391e2515b923a730fbea/index.js#L14-L17\n    var ua;\n    if(typeof navigator !== 'undefined') {\n        ua = navigator.userAgent;\n    }\n\n    if(\n        ua &&\n        ua.headers &&\n        typeof ua.headers['user-agent'] === 'string'\n    ) {\n        ua = ua.headers['user-agent'];\n    }\n\n    return ua;\n}\n","'use strict';\n\n/**\n * Push array with unique items\n *\n * Ignores falsy items, except 0 so we can use it to construct arrays of indices.\n *\n * @param {array} array\n *  array to be filled\n * @param {any} item\n *  item to be or not to be inserted\n * @return {array}\n *  ref to array (now possibly containing one more item)\n *\n */\nmodule.exports = function pushUnique(array, item) {\n    if(item instanceof RegExp) {\n        var itemStr = item.toString();\n        for(var i = 0; i < array.length; i++) {\n            if(array[i] instanceof RegExp && array[i].toString() === itemStr) {\n                return array;\n            }\n        }\n        array.push(item);\n    } else if((item || item === 0) && array.indexOf(item) === -1) array.push(item);\n\n    return array;\n};\n","'use strict';\n\nvar Lib = require('../lib');\nvar dfltConfig = require('../plot_api/plot_config').dfltConfig;\n\n/**\n * Copy arg array *without* removing `undefined` values from objects.\n *\n * @param gd\n * @param args\n * @returns {Array}\n */\nfunction copyArgArray(gd, args) {\n    var copy = [];\n    var arg;\n\n    for(var i = 0; i < args.length; i++) {\n        arg = args[i];\n\n        if(arg === gd) copy[i] = arg;\n        else if(typeof arg === 'object') {\n            copy[i] = Array.isArray(arg) ?\n                Lib.extendDeep([], arg) :\n                Lib.extendDeepAll({}, arg);\n        } else copy[i] = arg;\n    }\n\n    return copy;\n}\n\n\n// -----------------------------------------------------\n// Undo/Redo queue for plots\n// -----------------------------------------------------\n\n\nvar queue = {};\n\n// TODO: disable/enable undo and redo buttons appropriately\n\n/**\n * Add an item to the undoQueue for a graphDiv\n *\n * @param gd\n * @param undoFunc Function undo this operation\n * @param undoArgs Args to supply undoFunc with\n * @param redoFunc Function to redo this operation\n * @param redoArgs Args to supply redoFunc with\n */\nqueue.add = function(gd, undoFunc, undoArgs, redoFunc, redoArgs) {\n    var queueObj,\n        queueIndex;\n\n    // make sure we have the queue and our position in it\n    gd.undoQueue = gd.undoQueue || {index: 0, queue: [], sequence: false};\n    queueIndex = gd.undoQueue.index;\n\n    // if we're already playing an undo or redo, or if this is an auto operation\n    // (like pane resize... any others?) then we don't save this to the undo queue\n    if(gd.autoplay) {\n        if(!gd.undoQueue.inSequence) gd.autoplay = false;\n        return;\n    }\n\n    // if we're not in a sequence or are just starting, we need a new queue item\n    if(!gd.undoQueue.sequence || gd.undoQueue.beginSequence) {\n        queueObj = {undo: {calls: [], args: []}, redo: {calls: [], args: []}};\n        gd.undoQueue.queue.splice(queueIndex, gd.undoQueue.queue.length - queueIndex, queueObj);\n        gd.undoQueue.index += 1;\n    } else {\n        queueObj = gd.undoQueue.queue[queueIndex - 1];\n    }\n    gd.undoQueue.beginSequence = false;\n\n    // we unshift to handle calls for undo in a forward for loop later\n    if(queueObj) {\n        queueObj.undo.calls.unshift(undoFunc);\n        queueObj.undo.args.unshift(undoArgs);\n        queueObj.redo.calls.push(redoFunc);\n        queueObj.redo.args.push(redoArgs);\n    }\n\n    if(gd.undoQueue.queue.length > dfltConfig.queueLength) {\n        gd.undoQueue.queue.shift();\n        gd.undoQueue.index--;\n    }\n};\n\n/**\n * Begin a sequence of undoQueue changes\n *\n * @param gd\n */\nqueue.startSequence = function(gd) {\n    gd.undoQueue = gd.undoQueue || {index: 0, queue: [], sequence: false};\n    gd.undoQueue.sequence = true;\n    gd.undoQueue.beginSequence = true;\n};\n\n/**\n * Stop a sequence of undoQueue changes\n *\n * Call this *after* you're sure your undo chain has ended\n *\n * @param gd\n */\nqueue.stopSequence = function(gd) {\n    gd.undoQueue = gd.undoQueue || {index: 0, queue: [], sequence: false};\n    gd.undoQueue.sequence = false;\n    gd.undoQueue.beginSequence = false;\n};\n\n/**\n * Move one step back in the undo queue, and undo the object there.\n *\n * @param gd\n */\nqueue.undo = function undo(gd) {\n    var queueObj, i;\n\n    if(gd.undoQueue === undefined ||\n            isNaN(gd.undoQueue.index) ||\n            gd.undoQueue.index <= 0) {\n        return;\n    }\n\n    // index is pointing to next *forward* queueObj, point to the one we're undoing\n    gd.undoQueue.index--;\n\n    // get the queueObj for instructions on how to undo\n    queueObj = gd.undoQueue.queue[gd.undoQueue.index];\n\n    // this sequence keeps things from adding to the queue during undo/redo\n    gd.undoQueue.inSequence = true;\n    for(i = 0; i < queueObj.undo.calls.length; i++) {\n        queue.plotDo(gd, queueObj.undo.calls[i], queueObj.undo.args[i]);\n    }\n    gd.undoQueue.inSequence = false;\n    gd.autoplay = false;\n};\n\n/**\n * Redo the current object in the undo, then move forward in the queue.\n *\n * @param gd\n */\nqueue.redo = function redo(gd) {\n    var queueObj, i;\n\n    if(gd.undoQueue === undefined ||\n            isNaN(gd.undoQueue.index) ||\n            gd.undoQueue.index >= gd.undoQueue.queue.length) {\n        return;\n    }\n\n    // get the queueObj for instructions on how to undo\n    queueObj = gd.undoQueue.queue[gd.undoQueue.index];\n\n    // this sequence keeps things from adding to the queue during undo/redo\n    gd.undoQueue.inSequence = true;\n    for(i = 0; i < queueObj.redo.calls.length; i++) {\n        queue.plotDo(gd, queueObj.redo.calls[i], queueObj.redo.args[i]);\n    }\n    gd.undoQueue.inSequence = false;\n    gd.autoplay = false;\n\n    // index is pointing to the thing we just redid, move it\n    gd.undoQueue.index++;\n};\n\n/**\n * Called by undo/redo to make the actual changes.\n *\n * Not meant to be called publically, but included for mocking out in tests.\n *\n * @param gd\n * @param func\n * @param args\n */\nqueue.plotDo = function(gd, func, args) {\n    gd.autoplay = true;\n\n    // this *won't* copy gd and it preserves `undefined` properties!\n    args = copyArgArray(gd, args);\n\n    // call the supplied function\n    func.apply(null, args);\n};\n\nmodule.exports = queue;\n","'use strict';\n\n/*\n * make a regex for matching counter ids/names ie xaxis, xaxis2, xaxis10...\n *\n * @param {string} head: the head of the pattern, eg 'x' matches 'x', 'x2', 'x10' etc.\n *      'xy' is a special case for cartesian subplots: it matches 'x2y3' etc\n * @param {Optional(string)} tail: a fixed piece after the id\n *      eg counterRegex('scene', '.annotations') for scene2.annotations etc.\n * @param {boolean} openEnded: if true, the string may continue past the match.\n * @param {boolean} matchBeginning: if false, the string may start before the match.\n */\nexports.counter = function(head, tail, openEnded, matchBeginning) {\n    var fullTail = (tail || '') + (openEnded ? '' : '$');\n    var startWithPrefix = matchBeginning === false ? '' : '^';\n    if(head === 'xy') {\n        return new RegExp(startWithPrefix + 'x([2-9]|[1-9][0-9]+)?y([2-9]|[1-9][0-9]+)?' + fullTail);\n    }\n    return new RegExp(startWithPrefix + head + '([2-9]|[1-9][0-9]+)?' + fullTail);\n};\n","'use strict';\n\n// ASCEND: chop off the last nesting level - either [<n>] or .<key> - to ascend\n// the attribute tree. the remaining attrString is in match[1]\nvar ASCEND = /^(.*)(\\.[^\\.\\[\\]]+|\\[\\d\\])$/;\n\n// SIMPLEATTR: is this an un-nested attribute? (no dots or brackets)\nvar SIMPLEATTR = /^[^\\.\\[\\]]+$/;\n\n/*\n * calculate a relative attribute string, similar to a relative path\n *\n * @param {string} baseAttr:\n *   an attribute string, such as 'annotations[3].x'. The \"current location\"\n *   is the attribute string minus the last component ('annotations[3]')\n * @param {string} relativeAttr:\n *   a route to the desired attribute string, using '^' to ascend\n *\n * @return {string} attrString:\n *   for example:\n *     relativeAttr('annotations[3].x', 'y') = 'annotations[3].y'\n *     relativeAttr('annotations[3].x', '^[2].z') = 'annotations[2].z'\n *     relativeAttr('annotations[3].x', '^^margin') = 'margin'\n *     relativeAttr('annotations[3].x', '^^margin.r') = 'margin.r'\n */\nmodule.exports = function(baseAttr, relativeAttr) {\n    while(relativeAttr) {\n        var match = baseAttr.match(ASCEND);\n\n        if(match) baseAttr = match[1];\n        else if(baseAttr.match(SIMPLEATTR)) baseAttr = '';\n        else throw new Error('bad relativeAttr call:' + [baseAttr, relativeAttr]);\n\n        if(relativeAttr.charAt(0) === '^') relativeAttr = relativeAttr.slice(1);\n        else break;\n    }\n\n    if(baseAttr && relativeAttr.charAt(0) !== '[') {\n        return baseAttr + '.' + relativeAttr;\n    }\n    return baseAttr + relativeAttr;\n};\n","'use strict';\n\nvar isArrayOrTypedArray = require('./array').isArrayOrTypedArray;\nvar isPlainObject = require('./is_plain_object');\n\n/**\n * Relink private _keys and keys with a function value from one container\n * to the new container.\n * Relink means copying if object is pass-by-value and adding a reference\n * if object is pass-by-ref.\n * This prevents deepCopying massive structures like a webgl context.\n */\nmodule.exports = function relinkPrivateKeys(toContainer, fromContainer) {\n    for(var k in fromContainer) {\n        var fromVal = fromContainer[k];\n        var toVal = toContainer[k];\n\n        if(toVal === fromVal) continue;\n\n        if(k.charAt(0) === '_' || typeof fromVal === 'function') {\n            // if it already exists at this point, it's something\n            // that we recreate each time around, so ignore it\n            if(k in toContainer) continue;\n\n            toContainer[k] = fromVal;\n        } else if(isArrayOrTypedArray(fromVal) && isArrayOrTypedArray(toVal) && isPlainObject(fromVal[0])) {\n            // filter out data_array items that can contain user objects\n            // most of the time the toVal === fromVal check will catch these early\n            // but if the user makes new ones we also don't want to recurse in.\n            if(k === 'customdata' || k === 'ids') continue;\n\n            // recurse into arrays containers\n            var minLen = Math.min(fromVal.length, toVal.length);\n            for(var j = 0; j < minLen; j++) {\n                if((toVal[j] !== fromVal[j]) && isPlainObject(fromVal[j]) && isPlainObject(toVal[j])) {\n                    relinkPrivateKeys(toVal[j], fromVal[j]);\n                }\n            }\n        } else if(isPlainObject(fromVal) && isPlainObject(toVal)) {\n            // recurse into objects, but only if they still exist\n            relinkPrivateKeys(toVal, fromVal);\n\n            if(!Object.keys(toVal).length) delete toContainer[k];\n        }\n    }\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar loggers = require('./loggers');\nvar identity = require('./identity');\nvar BADNUM = require('../constants/numerical').BADNUM;\n\n// don't trust floating point equality - fraction of bin size to call\n// \"on the line\" and ensure that they go the right way specified by\n// linelow\nvar roundingError = 1e-9;\n\n\n/**\n * findBin - find the bin for val - note that it can return outside the\n * bin range any pos. or neg. integer for linear bins, or -1 or\n * bins.length-1 for explicit.\n * bins is either an object {start,size,end} or an array length #bins+1\n * bins can be either increasing or decreasing but must be monotonic\n * for linear bins, we can just calculate. For listed bins, run a binary\n * search linelow (truthy) says the bin boundary should be attributed to\n * the lower bin rather than the default upper bin\n */\nexports.findBin = function(val, bins, linelow) {\n    if(isNumeric(bins.start)) {\n        return linelow ?\n            Math.ceil((val - bins.start) / bins.size - roundingError) - 1 :\n            Math.floor((val - bins.start) / bins.size + roundingError);\n    } else {\n        var n1 = 0;\n        var n2 = bins.length;\n        var c = 0;\n        var binSize = (n2 > 1) ? (bins[n2 - 1] - bins[0]) / (n2 - 1) : 1;\n        var n, test;\n        if(binSize >= 0) {\n            test = linelow ? lessThan : lessOrEqual;\n        } else {\n            test = linelow ? greaterOrEqual : greaterThan;\n        }\n        val += binSize * roundingError * (linelow ? -1 : 1) * (binSize >= 0 ? 1 : -1);\n        // c is just to avoid infinite loops if there's an error\n        while(n1 < n2 && c++ < 100) {\n            n = Math.floor((n1 + n2) / 2);\n            if(test(bins[n], val)) n1 = n + 1;\n            else n2 = n;\n        }\n        if(c > 90) loggers.log('Long binary search...');\n        return n1 - 1;\n    }\n};\n\nfunction lessThan(a, b) { return a < b; }\nfunction lessOrEqual(a, b) { return a <= b; }\nfunction greaterThan(a, b) { return a > b; }\nfunction greaterOrEqual(a, b) { return a >= b; }\n\nexports.sorterAsc = function(a, b) { return a - b; };\nexports.sorterDes = function(a, b) { return b - a; };\n\n/**\n * find distinct values in an array, lumping together ones that appear to\n * just be off by a rounding error\n * return the distinct values and the minimum difference between any two\n */\nexports.distinctVals = function(valsIn) {\n    var vals = valsIn.slice();  // otherwise we sort the original array...\n    vals.sort(exports.sorterAsc); // undefined listed in the end - also works on IE11\n\n    var last;\n    for(last = vals.length - 1; last > -1; last--) {\n        if(vals[last] !== BADNUM) break;\n    }\n\n    var minDiff = (vals[last] - vals[0]) || 1;\n    var errDiff = minDiff / (last || 1) / 10000;\n    var newVals = [];\n    var preV;\n    for(var i = 0; i <= last; i++) {\n        var v = vals[i];\n\n        // make sure values aren't just off by a rounding error\n        var diff = v - preV;\n\n        if(preV === undefined) {\n            newVals.push(v);\n            preV = v;\n        } else if(diff > errDiff) {\n            minDiff = Math.min(minDiff, diff);\n\n            newVals.push(v);\n            preV = v;\n        }\n    }\n\n    return {vals: newVals, minDiff: minDiff};\n};\n\n/**\n * return the smallest element from (sorted) array arrayIn that's bigger than val,\n * or (reverse) the largest element smaller than val\n * used to find the best tick given the minimum (non-rounded) tick\n * particularly useful for date/time where things are not powers of 10\n * binary search is probably overkill here...\n */\nexports.roundUp = function(val, arrayIn, reverse) {\n    var low = 0;\n    var high = arrayIn.length - 1;\n    var mid;\n    var c = 0;\n    var dlow = reverse ? 0 : 1;\n    var dhigh = reverse ? 1 : 0;\n    var rounded = reverse ? Math.ceil : Math.floor;\n    // c is just to avoid infinite loops if there's an error\n    while(low < high && c++ < 100) {\n        mid = rounded((low + high) / 2);\n        if(arrayIn[mid] <= val) low = mid + dlow;\n        else high = mid - dhigh;\n    }\n    return arrayIn[low];\n};\n\n/**\n * Tweak to Array.sort(sortFn) that improves performance for pre-sorted arrays\n *\n * Note that newer browsers (such as Chrome v70+) are starting to pick up\n * on pre-sorted arrays which may render the following optimization unnecessary\n * in the future.\n *\n * Motivation: sometimes we need to sort arrays but the input is likely to\n * already be sorted. Browsers don't seem to pick up on pre-sorted arrays,\n * and in fact Chrome is actually *slower* sorting pre-sorted arrays than purely\n * random arrays. FF is at least faster if the array is pre-sorted, but still\n * not as fast as it could be.\n * Here's how this plays out sorting a length-1e6 array:\n *\n * Calls to Sort FN  |  Chrome bare  |  FF bare  |  Chrome tweak  |  FF tweak\n *                   |  v68.0 Mac    |  v61.0 Mac|                |\n * ------------------+---------------+-----------+----------------+------------\n * ordered           |  30.4e6       |  10.1e6   |  1e6           |  1e6\n * reversed          |  29.4e6       |  9.9e6    |  1e6 + reverse |  1e6 + reverse\n * random            |  ~21e6        |  ~18.7e6  |  ~21e6         |  ~18.7e6\n *\n * So this is a substantial win for pre-sorted (ordered or exactly reversed)\n * arrays. Including this wrapper on an unsorted array adds a penalty that will\n * in general be only a few calls to the sort function. The only case this\n * penalty will be significant is if the array is mostly sorted but there are\n * a few unsorted items near the end, but the penalty is still at most N calls\n * out of (for N=1e6) ~20N total calls\n *\n * @param {Array} array: the array, to be sorted in place\n * @param {function} sortFn: As in Array.sort, function(a, b) that puts\n *     item a before item b if the return is negative, a after b if positive,\n *     and no change if zero.\n * @return {Array}: the original array, sorted in place.\n */\nexports.sort = function(array, sortFn) {\n    var notOrdered = 0;\n    var notReversed = 0;\n    for(var i = 1; i < array.length; i++) {\n        var pairOrder = sortFn(array[i], array[i - 1]);\n        if(pairOrder < 0) notOrdered = 1;\n        else if(pairOrder > 0) notReversed = 1;\n        if(notOrdered && notReversed) return array.sort(sortFn);\n    }\n    return notReversed ? array : array.reverse();\n};\n\n/**\n * find index in array 'arr' that minimizes 'fn'\n *\n * @param {array} arr : array where to search\n * @param {fn (optional)} fn : function to minimize,\n *   if not given, fn is the identity function\n * @return {integer}\n */\nexports.findIndexOfMin = function(arr, fn) {\n    fn = fn || identity;\n\n    var min = Infinity;\n    var ind;\n\n    for(var i = 0; i < arr.length; i++) {\n        var v = fn(arr[i]);\n        if(v < min) {\n            min = v;\n            ind = i;\n        }\n    }\n    return ind;\n};\n","'use strict';\n\n// works with our CSS cursor classes (see css/_cursor.scss)\n// to apply cursors to d3 single-element selections.\n// omit cursor to revert to the default.\nmodule.exports = function setCursor(el3, csr) {\n    (el3.attr('class') || '').split(' ').forEach(function(cls) {\n        if(cls.indexOf('cursor-') === 0) el3.classed(cls, false);\n    });\n\n    if(csr) el3.classed('cursor-' + csr, true);\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar isArrayOrTypedArray = require('./array').isArrayOrTypedArray;\n\n/**\n * aggNums() returns the result of an aggregate function applied to an array of\n * values, where non-numerical values have been tossed out.\n *\n * @param {function} f - aggregation function (e.g., Math.min)\n * @param {Number} v - initial value (continuing from previous calls)\n *      if there's no continuing value, use null for selector-type\n *      functions (max,min), or 0 for summations\n * @param {Array} a - array to aggregate (may be nested, we will recurse,\n *                    but all elements must have the same dimension)\n * @param {Number} len - maximum length of a to aggregate\n * @return {Number} - result of f applied to a starting from v\n */\nexports.aggNums = function(f, v, a, len) {\n    var i,\n        b;\n    if(!len || len > a.length) len = a.length;\n    if(!isNumeric(v)) v = false;\n    if(isArrayOrTypedArray(a[0])) {\n        b = new Array(len);\n        for(i = 0; i < len; i++) b[i] = exports.aggNums(f, v, a[i]);\n        a = b;\n    }\n\n    for(i = 0; i < len; i++) {\n        if(!isNumeric(v)) v = a[i];\n        else if(isNumeric(a[i])) v = f(+v, +a[i]);\n    }\n    return v;\n};\n\n/**\n * mean & std dev functions using aggNums, so it handles non-numerics nicely\n * even need to use aggNums instead of .length, to toss out non-numerics\n */\nexports.len = function(data) {\n    return exports.aggNums(function(a) { return a + 1; }, 0, data);\n};\n\nexports.mean = function(data, len) {\n    if(!len) len = exports.len(data);\n    return exports.aggNums(function(a, b) { return a + b; }, 0, data) / len;\n};\n\nexports.midRange = function(numArr) {\n    if(numArr === undefined || numArr.length === 0) return undefined;\n    return (exports.aggNums(Math.max, null, numArr) + exports.aggNums(Math.min, null, numArr)) / 2;\n};\n\nexports.variance = function(data, len, mean) {\n    if(!len) len = exports.len(data);\n    if(!isNumeric(mean)) mean = exports.mean(data, len);\n\n    return exports.aggNums(function(a, b) {\n        return a + Math.pow(b - mean, 2);\n    }, 0, data) / len;\n};\n\nexports.stdev = function(data, len, mean) {\n    return Math.sqrt(exports.variance(data, len, mean));\n};\n\n/**\n * median of a finite set of numbers\n * reference page: https://en.wikipedia.org/wiki/Median#Finite_set_of_numbers\n**/\nexports.median = function(data) {\n    var b = data.slice().sort();\n    return exports.interp(b, 0.5);\n};\n\n/**\n * interp() computes a percentile (quantile) for a given distribution.\n * We interpolate the distribution (to compute quantiles, we follow method #10 here:\n * http://www.amstat.org/publications/jse/v14n3/langford.html).\n * Typically the index or rank (n * arr.length) may be non-integer.\n * For reference: ends are clipped to the extreme values in the array;\n * For box plots: index you get is half a point too high (see\n * http://en.wikipedia.org/wiki/Percentile#Nearest_rank) but note that this definition\n * indexes from 1 rather than 0, so we subtract 1/2 (instead of add).\n *\n * @param {Array} arr - This array contains the values that make up the distribution.\n * @param {Number} n - Between 0 and 1, n = p/100 is such that we compute the p^th percentile.\n * For example, the 50th percentile (or median) corresponds to n = 0.5\n * @return {Number} - percentile\n */\nexports.interp = function(arr, n) {\n    if(!isNumeric(n)) throw 'n should be a finite number';\n    n = n * arr.length - 0.5;\n    if(n < 0) return arr[0];\n    if(n > arr.length - 1) return arr[arr.length - 1];\n    var frac = n % 1;\n    return frac * arr[Math.ceil(n)] + (1 - frac) * arr[Math.floor(n)];\n};\n","'use strict';\n\n/* global MathJax:false */\n\nvar d3 = require('@plotly/d3');\n\nvar Lib = require('../lib');\nvar strTranslate = Lib.strTranslate;\nvar xmlnsNamespaces = require('../constants/xmlns_namespaces');\nvar LINE_SPACING = require('../constants/alignment').LINE_SPACING;\n\n// text converter\n\nfunction getSize(_selection, _dimension) {\n    return _selection.node().getBoundingClientRect()[_dimension];\n}\n\nvar FIND_TEX = /([^$]*)([$]+[^$]*[$]+)([^$]*)/;\n\nexports.convertToTspans = function(_context, gd, _callback) {\n    var str = _context.text();\n\n    // Until we get tex integrated more fully (so it can be used along with non-tex)\n    // allow some elements to prohibit it by attaching 'data-notex' to the original\n    var tex = (!_context.attr('data-notex')) &&\n        (typeof MathJax !== 'undefined') &&\n        str.match(FIND_TEX);\n\n    var parent = d3.select(_context.node().parentNode);\n    if(parent.empty()) return;\n    var svgClass = (_context.attr('class')) ? _context.attr('class').split(' ')[0] : 'text';\n    svgClass += '-math';\n    parent.selectAll('svg.' + svgClass).remove();\n    parent.selectAll('g.' + svgClass + '-group').remove();\n    _context.style('display', null)\n        .attr({\n            // some callers use data-unformatted *from the <text> element* in 'cancel'\n            // so we need it here even if we're going to turn it into math\n            // these two (plus style and text-anchor attributes) form the key we're\n            // going to use for Drawing.bBox\n            'data-unformatted': str,\n            'data-math': 'N'\n        });\n\n    function showText() {\n        if(!parent.empty()) {\n            svgClass = _context.attr('class') + '-math';\n            parent.select('svg.' + svgClass).remove();\n        }\n        _context.text('')\n            .style('white-space', 'pre');\n\n        var hasLink = buildSVGText(_context.node(), str);\n\n        if(hasLink) {\n            // at least in Chrome, pointer-events does not seem\n            // to be honored in children of <text> elements\n            // so if we have an anchor, we have to make the\n            // whole element respond\n            _context.style('pointer-events', 'all');\n        }\n\n        exports.positionText(_context);\n\n        if(_callback) _callback.call(_context);\n    }\n\n    if(tex) {\n        ((gd && gd._promises) || []).push(new Promise(function(resolve) {\n            _context.style('display', 'none');\n            var fontSize = parseInt(_context.node().style.fontSize, 10);\n            var config = {fontSize: fontSize};\n\n            texToSVG(tex[2], config, function(_svgEl, _glyphDefs, _svgBBox) {\n                parent.selectAll('svg.' + svgClass).remove();\n                parent.selectAll('g.' + svgClass + '-group').remove();\n\n                var newSvg = _svgEl && _svgEl.select('svg');\n                if(!newSvg || !newSvg.node()) {\n                    showText();\n                    resolve();\n                    return;\n                }\n\n                var mathjaxGroup = parent.append('g')\n                    .classed(svgClass + '-group', true)\n                    .attr({\n                        'pointer-events': 'none',\n                        'data-unformatted': str,\n                        'data-math': 'Y'\n                    });\n\n                mathjaxGroup.node().appendChild(newSvg.node());\n\n                // stitch the glyph defs\n                if(_glyphDefs && _glyphDefs.node()) {\n                    newSvg.node().insertBefore(_glyphDefs.node().cloneNode(true),\n                                               newSvg.node().firstChild);\n                }\n\n                newSvg.attr({\n                    'class': svgClass,\n                    height: _svgBBox.height,\n                    preserveAspectRatio: 'xMinYMin meet'\n                })\n                .style({overflow: 'visible', 'pointer-events': 'none'});\n\n                var fill = _context.node().style.fill || 'black';\n                var g = newSvg.select('g');\n                g.attr({fill: fill, stroke: fill});\n\n                var newSvgW = getSize(g, 'width');\n                var newSvgH = getSize(g, 'height');\n                var newX = +_context.attr('x') - newSvgW *\n                    {start: 0, middle: 0.5, end: 1}[_context.attr('text-anchor') || 'start'];\n                // font baseline is about 1/4 fontSize below centerline\n                var textHeight = fontSize || getSize(_context, 'height');\n                var dy = -textHeight / 4;\n\n                if(svgClass[0] === 'y') {\n                    mathjaxGroup.attr({\n                        transform: 'rotate(' + [-90, +_context.attr('x'), +_context.attr('y')] +\n                        ')' + strTranslate(-newSvgW / 2, dy - newSvgH / 2)\n                    });\n                    newSvg.attr({x: +_context.attr('x'), y: +_context.attr('y')});\n                } else if(svgClass[0] === 'l') {\n                    newSvg.attr({x: _context.attr('x'), y: dy - (newSvgH / 2)});\n                } else if(svgClass[0] === 'a' && svgClass.indexOf('atitle') !== 0) {\n                    newSvg.attr({x: 0, y: dy});\n                } else {\n                    newSvg.attr({x: newX, y: (+_context.attr('y') + dy - newSvgH / 2)});\n                }\n\n                if(_callback) _callback.call(_context, mathjaxGroup);\n                resolve(mathjaxGroup);\n            });\n        }));\n    } else showText();\n\n    return _context;\n};\n\n\n// MathJax\n\nvar LT_MATCH = /(<|&lt;|&#60;)/g;\nvar GT_MATCH = /(>|&gt;|&#62;)/g;\n\nfunction cleanEscapesForTex(s) {\n    return s.replace(LT_MATCH, '\\\\lt ')\n        .replace(GT_MATCH, '\\\\gt ');\n}\n\nfunction texToSVG(_texString, _config, _callback) {\n    var originalRenderer,\n        originalConfig,\n        originalProcessSectionDelay,\n        tmpDiv;\n\n    MathJax.Hub.Queue(\n    function() {\n        originalConfig = Lib.extendDeepAll({}, MathJax.Hub.config);\n\n        originalProcessSectionDelay = MathJax.Hub.processSectionDelay;\n        if(MathJax.Hub.processSectionDelay !== undefined) {\n            // MathJax 2.5+\n            MathJax.Hub.processSectionDelay = 0;\n        }\n\n        return MathJax.Hub.Config({\n            messageStyle: 'none',\n            tex2jax: {\n                inlineMath: [['$', '$'], ['\\\\(', '\\\\)']]\n            },\n            displayAlign: 'left',\n        });\n    },\n    function() {\n        // Get original renderer\n        originalRenderer = MathJax.Hub.config.menuSettings.renderer;\n        if(originalRenderer !== 'SVG') {\n            return MathJax.Hub.setRenderer('SVG');\n        }\n    },\n    function() {\n        var randomID = 'math-output-' + Lib.randstr({}, 64);\n        tmpDiv = d3.select('body').append('div')\n            .attr({id: randomID})\n            .style({visibility: 'hidden', position: 'absolute'})\n            .style({'font-size': _config.fontSize + 'px'})\n            .text(cleanEscapesForTex(_texString));\n\n        return MathJax.Hub.Typeset(tmpDiv.node());\n    },\n    function() {\n        var glyphDefs = d3.select('body').select('#MathJax_SVG_glyphs');\n\n        if(tmpDiv.select('.MathJax_SVG').empty() || !tmpDiv.select('svg').node()) {\n            Lib.log('There was an error in the tex syntax.', _texString);\n            _callback();\n        } else {\n            var svgBBox = tmpDiv.select('svg').node().getBoundingClientRect();\n            _callback(tmpDiv.select('.MathJax_SVG'), glyphDefs, svgBBox);\n        }\n\n        tmpDiv.remove();\n\n        if(originalRenderer !== 'SVG') {\n            return MathJax.Hub.setRenderer(originalRenderer);\n        }\n    },\n    function() {\n        if(originalProcessSectionDelay !== undefined) {\n            MathJax.Hub.processSectionDelay = originalProcessSectionDelay;\n        }\n        return MathJax.Hub.Config(originalConfig);\n    });\n}\n\nvar TAG_STYLES = {\n    // would like to use baseline-shift for sub/sup but FF doesn't support it\n    // so we need to use dy along with the uber hacky shift-back-to\n    // baseline below\n    sup: 'font-size:70%',\n    sub: 'font-size:70%',\n    b: 'font-weight:bold',\n    i: 'font-style:italic',\n    a: 'cursor:pointer',\n    span: '',\n    em: 'font-style:italic;font-weight:bold'\n};\n\n// baseline shifts for sub and sup\nvar SHIFT_DY = {\n    sub: '0.3em',\n    sup: '-0.6em'\n};\n// reset baseline by adding a tspan (empty except for a zero-width space)\n// with dy of -70% * SHIFT_DY (because font-size=70%)\nvar RESET_DY = {\n    sub: '-0.21em',\n    sup: '0.42em'\n};\nvar ZERO_WIDTH_SPACE = '\\u200b';\n\n/*\n * Whitelist of protocols in user-supplied urls. Mostly we want to avoid javascript\n * and related attack vectors. The empty items are there for IE, that in various\n * versions treats relative paths as having different flavors of no protocol, while\n * other browsers have these explicitly inherit the protocol of the page they're in.\n */\nvar PROTOCOLS = ['http:', 'https:', 'mailto:', '', undefined, ':'];\n\nvar NEWLINES = exports.NEWLINES = /(\\r\\n?|\\n)/g;\n\nvar SPLIT_TAGS = /(<[^<>]*>)/;\n\nvar ONE_TAG = /<(\\/?)([^ >]*)(\\s+(.*))?>/i;\n\nvar BR_TAG = /<br(\\s+.*)?>/i;\nexports.BR_TAG_ALL = /<br(\\s+.*)?>/gi;\n\n/*\n * style and href: pull them out of either single or double quotes. Also\n * - target: (_blank|_self|_parent|_top|framename)\n *     note that you can't use target to get a popup but if you use popup,\n *     a `framename` will be passed along as the name of the popup window.\n *     per the spec, cannot contain whitespace.\n *     for backward compatibility we default to '_blank'\n * - popup: a custom one for us to enable popup (new window) links. String\n *     for window.open -> strWindowFeatures, like 'menubar=yes,width=500,height=550'\n *     note that at least in Chrome, you need to give at least one property\n *     in this string or the page will open in a new tab anyway. We follow this\n *     convention and will not make a popup if this string is empty.\n *     per the spec, cannot contain whitespace.\n *\n * Because we hack in other attributes with style (sub & sup), drop any trailing\n * semicolon in user-supplied styles so we can consistently append the tag-dependent style\n *\n * These are for tag attributes; Chrome anyway will convert entities in\n * attribute values, but not in attribute names\n * you can test this by for example:\n * > p = document.createElement('p')\n * > p.innerHTML = '<span styl&#x65;=\"font-color:r&#x65;d;\">Hi</span>'\n * > p.innerHTML\n * <- '<span styl&#x65;=\"font-color:red;\">Hi</span>'\n */\nvar STYLEMATCH = /(^|[\\s\"'])style\\s*=\\s*(\"([^\"]*);?\"|'([^']*);?')/i;\nvar HREFMATCH = /(^|[\\s\"'])href\\s*=\\s*(\"([^\"]*)\"|'([^']*)')/i;\nvar TARGETMATCH = /(^|[\\s\"'])target\\s*=\\s*(\"([^\"\\s]*)\"|'([^'\\s]*)')/i;\nvar POPUPMATCH = /(^|[\\s\"'])popup\\s*=\\s*(\"([\\w=,]*)\"|'([\\w=,]*)')/i;\n\n// dedicated matcher for these quoted regexes, that can return their results\n// in two different places\nfunction getQuotedMatch(_str, re) {\n    if(!_str) return null;\n    var match = _str.match(re);\n    var result = match && (match[3] || match[4]);\n    return result && convertEntities(result);\n}\n\nvar COLORMATCH = /(^|;)\\s*color:/;\n\n/**\n * Strip string of tags\n *\n * @param {string} _str : input string\n * @param {object} opts :\n * - len {number} max length of output string\n * - allowedTags {array} list of pseudo-html tags to NOT strip\n * @return {string}\n */\nexports.plainText = function(_str, opts) {\n    opts = opts || {};\n\n    var len = (opts.len !== undefined && opts.len !== -1) ? opts.len : Infinity;\n    var allowedTags = opts.allowedTags !== undefined ? opts.allowedTags : ['br'];\n\n    var ellipsis = '...';\n    var eLen = ellipsis.length;\n\n    var oldParts = _str.split(SPLIT_TAGS);\n    var newParts = [];\n    var prevTag = '';\n    var l = 0;\n\n    for(var i = 0; i < oldParts.length; i++) {\n        var p = oldParts[i];\n        var match = p.match(ONE_TAG);\n        var tagType = match && match[2].toLowerCase();\n\n        if(tagType) {\n            // N.B. tags do not count towards string length\n            if(allowedTags.indexOf(tagType) !== -1) {\n                newParts.push(p);\n                prevTag = tagType;\n            }\n        } else {\n            var pLen = p.length;\n\n            if((l + pLen) < len) {\n                newParts.push(p);\n                l += pLen;\n            } else if(l < len) {\n                var pLen2 = len - l;\n\n                if(prevTag && (prevTag !== 'br' || pLen2 <= eLen || pLen <= eLen)) {\n                    newParts.pop();\n                }\n\n                if(len > eLen) {\n                    newParts.push(p.substr(0, pLen2 - eLen) + ellipsis);\n                } else {\n                    newParts.push(p.substr(0, pLen2));\n                }\n                break;\n            }\n\n            prevTag = '';\n        }\n    }\n\n    return newParts.join('');\n};\n\n/*\n * N.B. HTML entities are listed without the leading '&' and trailing ';'\n * https://www.freeformatter.com/html-entities.html\n *\n * FWIW if we wanted to support the full set, it has 2261 entries:\n * https://www.w3.org/TR/html5/entities.json\n * though I notice that some of these are duplicates and/or are missing \";\"\n * eg: \"&amp;\", \"&amp\", \"&AMP;\", and \"&AMP\" all map to \"&\"\n * We no longer need to include numeric entities here, these are now handled\n * by String.fromCodePoint/fromCharCode\n *\n * Anyway the only ones that are really important to allow are the HTML special\n * chars <, >, and &, because these ones can trigger special processing if not\n * replaced by the corresponding entity.\n */\nvar entityToUnicode = {\n    mu: '',\n    amp: '&',\n    lt: '<',\n    gt: '>',\n    nbsp: '',\n    times: '',\n    plusmn: '',\n    deg: ''\n};\n\n// NOTE: in general entities can contain uppercase too (so [a-zA-Z]) but all the\n// ones we support use only lowercase. If we ever change that, update the regex.\nvar ENTITY_MATCH = /&(#\\d+|#x[\\da-fA-F]+|[a-z]+);/g;\nfunction convertEntities(_str) {\n    return _str.replace(ENTITY_MATCH, function(fullMatch, innerMatch) {\n        var outChar;\n        if(innerMatch.charAt(0) === '#') {\n            // cannot use String.fromCodePoint in IE\n            outChar = fromCodePoint(\n                innerMatch.charAt(1) === 'x' ?\n                    parseInt(innerMatch.substr(2), 16) :\n                    parseInt(innerMatch.substr(1), 10)\n            );\n        } else outChar = entityToUnicode[innerMatch];\n\n        // as in regular HTML, if we didn't decode the entity just\n        // leave the raw text in place.\n        return outChar || fullMatch;\n    });\n}\nexports.convertEntities = convertEntities;\n\nfunction fromCodePoint(code) {\n    // Don't allow overflow. In Chrome this turns into  but I feel like it's\n    // more useful to just not convert it at all.\n    if(code > 0x10FFFF) return;\n    var stringFromCodePoint = String.fromCodePoint;\n    if(stringFromCodePoint) return stringFromCodePoint(code);\n\n    // IE doesn't have String.fromCodePoint\n    // see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/fromCodePoint\n    var stringFromCharCode = String.fromCharCode;\n    if(code <= 0xFFFF) return stringFromCharCode(code);\n    return stringFromCharCode(\n        (code >> 10) + 0xD7C0,\n        (code % 0x400) + 0xDC00\n    );\n}\n\n/*\n * buildSVGText: convert our pseudo-html into SVG tspan elements, and attach these\n * to containerNode\n *\n * @param {svg text element} containerNode: the <text> node to insert this text into\n * @param {string} str: the pseudo-html string to convert to svg\n *\n * @returns {bool}: does the result contain any links? We need to handle the text element\n *   somewhat differently if it does, so just keep track of this when it happens.\n */\nfunction buildSVGText(containerNode, str) {\n    /*\n     * Normalize behavior between IE and others wrt newlines and whitespace:pre\n     * this combination makes IE barf https://github.com/plotly/plotly.js/issues/746\n     * Chrome and FF display \\n, \\r, or \\r\\n as a space in this mode.\n     * I feel like at some point we turned these into <br> but currently we don't so\n     * I'm just going to cement what we do now in Chrome and FF\n     */\n    str = str.replace(NEWLINES, ' ');\n\n    var hasLink = false;\n\n    // as we're building the text, keep track of what elements we're nested inside\n    // nodeStack will be an array of {node, type, style, href, target, popup}\n    // where only type: 'a' gets the last 3 and node is only added when it's created\n    var nodeStack = [];\n    var currentNode;\n    var currentLine = -1;\n\n    function newLine() {\n        currentLine++;\n\n        var lineNode = document.createElementNS(xmlnsNamespaces.svg, 'tspan');\n        d3.select(lineNode).attr({\n            class: 'line',\n            dy: (currentLine * LINE_SPACING) + 'em'\n        });\n        containerNode.appendChild(lineNode);\n\n        currentNode = lineNode;\n\n        var oldNodeStack = nodeStack;\n        nodeStack = [{node: lineNode}];\n\n        if(oldNodeStack.length > 1) {\n            for(var i = 1; i < oldNodeStack.length; i++) {\n                enterNode(oldNodeStack[i]);\n            }\n        }\n    }\n\n    function enterNode(nodeSpec) {\n        var type = nodeSpec.type;\n        var nodeAttrs = {};\n        var nodeType;\n\n        if(type === 'a') {\n            nodeType = 'a';\n            var target = nodeSpec.target;\n            var href = nodeSpec.href;\n            var popup = nodeSpec.popup;\n            if(href) {\n                nodeAttrs = {\n                    'xlink:xlink:show': (target === '_blank' || target.charAt(0) !== '_') ? 'new' : 'replace',\n                    target: target,\n                    'xlink:xlink:href': href\n                };\n                if(popup) {\n                    // security: href and target are not inserted as code but\n                    // as attributes. popup is, but limited to /[A-Za-z0-9_=,]/\n                    nodeAttrs.onclick = 'window.open(this.href.baseVal,this.target.baseVal,\"' +\n                        popup + '\");return false;';\n                }\n            }\n        } else nodeType = 'tspan';\n\n        if(nodeSpec.style) nodeAttrs.style = nodeSpec.style;\n\n        var newNode = document.createElementNS(xmlnsNamespaces.svg, nodeType);\n\n        if(type === 'sup' || type === 'sub') {\n            addTextNode(currentNode, ZERO_WIDTH_SPACE);\n            currentNode.appendChild(newNode);\n\n            var resetter = document.createElementNS(xmlnsNamespaces.svg, 'tspan');\n            addTextNode(resetter, ZERO_WIDTH_SPACE);\n            d3.select(resetter).attr('dy', RESET_DY[type]);\n            nodeAttrs.dy = SHIFT_DY[type];\n\n            currentNode.appendChild(newNode);\n            currentNode.appendChild(resetter);\n        } else {\n            currentNode.appendChild(newNode);\n        }\n\n        d3.select(newNode).attr(nodeAttrs);\n\n        currentNode = nodeSpec.node = newNode;\n        nodeStack.push(nodeSpec);\n    }\n\n    function addTextNode(node, text) {\n        node.appendChild(document.createTextNode(text));\n    }\n\n    function exitNode(type) {\n        // A bare closing tag can't close the root node. If we encounter this it\n        // means there's an extra closing tag that can just be ignored:\n        if(nodeStack.length === 1) {\n            Lib.log('Ignoring unexpected end tag </' + type + '>.', str);\n            return;\n        }\n\n        var innerNode = nodeStack.pop();\n\n        if(type !== innerNode.type) {\n            Lib.log('Start tag <' + innerNode.type + '> doesnt match end tag <' +\n                type + '>. Pretending it did match.', str);\n        }\n        currentNode = nodeStack[nodeStack.length - 1].node;\n    }\n\n    var hasLines = BR_TAG.test(str);\n\n    if(hasLines) newLine();\n    else {\n        currentNode = containerNode;\n        nodeStack = [{node: containerNode}];\n    }\n\n    var parts = str.split(SPLIT_TAGS);\n    for(var i = 0; i < parts.length; i++) {\n        var parti = parts[i];\n        var match = parti.match(ONE_TAG);\n        var tagType = match && match[2].toLowerCase();\n        var tagStyle = TAG_STYLES[tagType];\n\n        if(tagType === 'br') {\n            newLine();\n        } else if(tagStyle === undefined) {\n            addTextNode(currentNode, convertEntities(parti));\n        } else {\n            // tag - open or close\n            if(match[1]) {\n                exitNode(tagType);\n            } else {\n                var extra = match[4];\n\n                var nodeSpec = {type: tagType};\n\n                // now add style, from both the tag name and any extra css\n                // Most of the svg css that users will care about is just like html,\n                // but font color is different (uses fill). Let our users ignore this.\n                var css = getQuotedMatch(extra, STYLEMATCH);\n                if(css) {\n                    css = css.replace(COLORMATCH, '$1 fill:');\n                    if(tagStyle) css += ';' + tagStyle;\n                } else if(tagStyle) css = tagStyle;\n\n                if(css) nodeSpec.style = css;\n\n                if(tagType === 'a') {\n                    hasLink = true;\n\n                    var href = getQuotedMatch(extra, HREFMATCH);\n\n                    if(href) {\n                        // check safe protocols\n                        var dummyAnchor = document.createElement('a');\n                        dummyAnchor.href = href;\n                        if(PROTOCOLS.indexOf(dummyAnchor.protocol) !== -1) {\n                            // Decode href to allow both already encoded and not encoded\n                            // URIs. Without decoding prior encoding, an already encoded\n                            // URI would be encoded twice producing a semantically different URI.\n                            nodeSpec.href = encodeURI(decodeURI(href));\n                            nodeSpec.target = getQuotedMatch(extra, TARGETMATCH) || '_blank';\n                            nodeSpec.popup = getQuotedMatch(extra, POPUPMATCH);\n                        }\n                    }\n                }\n\n                enterNode(nodeSpec);\n            }\n        }\n    }\n\n    return hasLink;\n}\n\n/*\n * sanitizeHTML: port of buildSVGText aimed at providing a clean subset of HTML\n * @param {string} str: the html string to clean\n * @returns {string}: a cleaned and normalized version of the input,\n *     supporting only a small subset of html\n */\nexports.sanitizeHTML = function sanitizeHTML(str) {\n    str = str.replace(NEWLINES, ' ');\n\n    var rootNode = document.createElement('p');\n    var currentNode = rootNode;\n    var nodeStack = [];\n\n    var parts = str.split(SPLIT_TAGS);\n    for(var i = 0; i < parts.length; i++) {\n        var parti = parts[i];\n        var match = parti.match(ONE_TAG);\n        var tagType = match && match[2].toLowerCase();\n\n        if(tagType in TAG_STYLES) {\n            if(match[1]) {\n                if(nodeStack.length) {\n                    currentNode = nodeStack.pop();\n                }\n            } else {\n                var extra = match[4];\n\n                var css = getQuotedMatch(extra, STYLEMATCH);\n                var nodeAttrs = css ? {style: css} : {};\n\n                if(tagType === 'a') {\n                    var href = getQuotedMatch(extra, HREFMATCH);\n\n                    if(href) {\n                        var dummyAnchor = document.createElement('a');\n                        dummyAnchor.href = href;\n                        if(PROTOCOLS.indexOf(dummyAnchor.protocol) !== -1) {\n                            nodeAttrs.href = encodeURI(decodeURI(href));\n                            var target = getQuotedMatch(extra, TARGETMATCH);\n                            if(target) {\n                                nodeAttrs.target = target;\n                            }\n                        }\n                    }\n                }\n\n                var newNode = document.createElement(tagType);\n                currentNode.appendChild(newNode);\n                d3.select(newNode).attr(nodeAttrs);\n\n                currentNode = newNode;\n                nodeStack.push(newNode);\n            }\n        } else {\n            currentNode.appendChild(\n                document.createTextNode(convertEntities(parti))\n            );\n        }\n    }\n    var key = 'innerHTML'; // i.e. to avoid pass test-syntax\n    return rootNode[key];\n};\n\nexports.lineCount = function lineCount(s) {\n    return s.selectAll('tspan.line').size() || 1;\n};\n\nexports.positionText = function positionText(s, x, y) {\n    return s.each(function() {\n        var text = d3.select(this);\n\n        function setOrGet(attr, val) {\n            if(val === undefined) {\n                val = text.attr(attr);\n                if(val === null) {\n                    text.attr(attr, 0);\n                    val = 0;\n                }\n            } else text.attr(attr, val);\n            return val;\n        }\n\n        var thisX = setOrGet('x', x);\n        var thisY = setOrGet('y', y);\n\n        if(this.nodeName === 'text') {\n            text.selectAll('tspan.line').attr({x: thisX, y: thisY});\n        }\n    });\n};\n\nfunction alignHTMLWith(_base, container, options) {\n    var alignH = options.horizontalAlign;\n    var alignV = options.verticalAlign || 'top';\n    var bRect = _base.node().getBoundingClientRect();\n    var cRect = container.node().getBoundingClientRect();\n    var thisRect;\n    var getTop;\n    var getLeft;\n\n    if(alignV === 'bottom') {\n        getTop = function() { return bRect.bottom - thisRect.height; };\n    } else if(alignV === 'middle') {\n        getTop = function() { return bRect.top + (bRect.height - thisRect.height) / 2; };\n    } else { // default: top\n        getTop = function() { return bRect.top; };\n    }\n\n    if(alignH === 'right') {\n        getLeft = function() { return bRect.right - thisRect.width; };\n    } else if(alignH === 'center') {\n        getLeft = function() { return bRect.left + (bRect.width - thisRect.width) / 2; };\n    } else { // default: left\n        getLeft = function() { return bRect.left; };\n    }\n\n    return function() {\n        thisRect = this.node().getBoundingClientRect();\n\n        var x0 = getLeft() - cRect.left;\n        var y0 = getTop() - cRect.top;\n        var gd = options.gd || {};\n        if(options.gd) {\n            gd._fullLayout._calcInverseTransform(gd);\n            var transformedCoords = Lib.apply3DTransform(gd._fullLayout._invTransform)(x0, y0);\n            x0 = transformedCoords[0];\n            y0 = transformedCoords[1];\n        }\n\n        this.style({\n            top: y0 + 'px',\n            left: x0 + 'px',\n            'z-index': 1000\n        });\n        return this;\n    };\n}\n\nvar onePx = '1px ';\n\nexports.makeTextShadow = function(color) {\n    var x = onePx;\n    var y = onePx;\n    var b = onePx;\n    return x + y + b + color + ', ' +\n        '-' + x + '-' + y + b + color + ', ' +\n        x + '-' + y + b + color + ', ' +\n        '-' + x + y + b + color;\n};\n\n/*\n * Editable title\n * @param {d3.selection} context: the element being edited. Normally text,\n *   but if it isn't, you should provide the styling options\n * @param {object} options:\n *   @param {div} options.gd: graphDiv\n *   @param {d3.selection} options.delegate: item to bind events to if not this\n *   @param {boolean} options.immediate: start editing now (true) or on click (false, default)\n *   @param {string} options.fill: font color if not as shown\n *   @param {string} options.background: background color if not as shown\n *   @param {string} options.text: initial text, if not as shown\n *   @param {string} options.horizontalAlign: alignment of the edit box wrt. the bound element\n *   @param {string} options.verticalAlign: alignment of the edit box wrt. the bound element\n */\n\nexports.makeEditable = function(context, options) {\n    var gd = options.gd;\n    var _delegate = options.delegate;\n    var dispatch = d3.dispatch('edit', 'input', 'cancel');\n    var handlerElement = _delegate || context;\n\n    context.style({'pointer-events': _delegate ? 'none' : 'all'});\n\n    if(context.size() !== 1) throw new Error('boo');\n\n    function handleClick() {\n        appendEditable();\n        context.style({opacity: 0});\n        // also hide any mathjax svg\n        var svgClass = handlerElement.attr('class');\n        var mathjaxClass;\n        if(svgClass) mathjaxClass = '.' + svgClass.split(' ')[0] + '-math-group';\n        else mathjaxClass = '[class*=-math-group]';\n        if(mathjaxClass) {\n            d3.select(context.node().parentNode).select(mathjaxClass).style({opacity: 0});\n        }\n    }\n\n    function selectElementContents(_el) {\n        var el = _el.node();\n        var range = document.createRange();\n        range.selectNodeContents(el);\n        var sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n        el.focus();\n    }\n\n    function appendEditable() {\n        var plotDiv = d3.select(gd);\n        var container = plotDiv.select('.svg-container');\n        var div = container.append('div');\n        var cStyle = context.node().style;\n        var fontSize = parseFloat(cStyle.fontSize || 12);\n\n        var initialText = options.text;\n        if(initialText === undefined) initialText = context.attr('data-unformatted');\n\n        div.classed('plugin-editable editable', true)\n            .style({\n                position: 'absolute',\n                'font-family': cStyle.fontFamily || 'Arial',\n                'font-size': fontSize,\n                color: options.fill || cStyle.fill || 'black',\n                opacity: 1,\n                'background-color': options.background || 'transparent',\n                outline: '#ffffff33 1px solid',\n                margin: [-fontSize / 8 + 1, 0, 0, -1].join('px ') + 'px',\n                padding: '0',\n                'box-sizing': 'border-box'\n            })\n            .attr({contenteditable: true})\n            .text(initialText)\n            .call(alignHTMLWith(context, container, options))\n            .on('blur', function() {\n                gd._editing = false;\n                context.text(this.textContent)\n                    .style({opacity: 1});\n                var svgClass = d3.select(this).attr('class');\n                var mathjaxClass;\n                if(svgClass) mathjaxClass = '.' + svgClass.split(' ')[0] + '-math-group';\n                else mathjaxClass = '[class*=-math-group]';\n                if(mathjaxClass) {\n                    d3.select(context.node().parentNode).select(mathjaxClass).style({opacity: 0});\n                }\n                var text = this.textContent;\n                d3.select(this).transition().duration(0).remove();\n                d3.select(document).on('mouseup', null);\n                dispatch.edit.call(context, text);\n            })\n            .on('focus', function() {\n                var editDiv = this;\n                gd._editing = true;\n                d3.select(document).on('mouseup', function() {\n                    if(d3.event.target === editDiv) return false;\n                    if(document.activeElement === div.node()) div.node().blur();\n                });\n            })\n            .on('keyup', function() {\n                if(d3.event.which === 27) {\n                    gd._editing = false;\n                    context.style({opacity: 1});\n                    d3.select(this)\n                        .style({opacity: 0})\n                        .on('blur', function() { return false; })\n                        .transition().remove();\n                    dispatch.cancel.call(context, this.textContent);\n                } else {\n                    dispatch.input.call(context, this.textContent);\n                    d3.select(this).call(alignHTMLWith(context, container, options));\n                }\n            })\n            .on('keydown', function() {\n                if(d3.event.which === 13) this.blur();\n            })\n            .call(selectElementContents);\n    }\n\n    if(options.immediate) handleClick();\n    else handlerElement.on('click', handleClick);\n\n    return d3.rebind(context, dispatch, 'on');\n};\n","'use strict';\n\nvar timerCache = {};\n\n/**\n * Throttle a callback. `callback` executes synchronously only if\n * more than `minInterval` milliseconds have already elapsed since the latest\n * call (if any). Otherwise we wait until `minInterval` is over and execute the\n * last callback received while waiting.\n * So the first and last events in a train are always executed (eventually)\n * but some of the events in the middle can be dropped.\n *\n * @param {string} id: an identifier to mark events to throttle together\n * @param {number} minInterval: minimum time, in milliseconds, between\n *   invocations of `callback`\n * @param {function} callback: the function to throttle. `callback` itself\n *   should be a purely synchronous function.\n */\nexports.throttle = function throttle(id, minInterval, callback) {\n    var cache = timerCache[id];\n    var now = Date.now();\n\n    if(!cache) {\n        /*\n         * Throw out old items before making a new one, to prevent the cache\n         * getting overgrown, for example from old plots that have been replaced.\n         * 1 minute age is arbitrary.\n         */\n        for(var idi in timerCache) {\n            if(timerCache[idi].ts < now - 60000) {\n                delete timerCache[idi];\n            }\n        }\n        cache = timerCache[id] = {ts: 0, timer: null};\n    }\n\n    _clearTimeout(cache);\n\n    function exec() {\n        callback();\n        cache.ts = Date.now();\n        if(cache.onDone) {\n            cache.onDone();\n            cache.onDone = null;\n        }\n    }\n\n    if(now > cache.ts + minInterval) {\n        exec();\n        return;\n    }\n\n    cache.timer = setTimeout(function() {\n        exec();\n        cache.timer = null;\n    }, minInterval);\n};\n\nexports.done = function(id) {\n    var cache = timerCache[id];\n    if(!cache || !cache.timer) return Promise.resolve();\n\n    return new Promise(function(resolve) {\n        var previousOnDone = cache.onDone;\n        cache.onDone = function onDone() {\n            if(previousOnDone) previousOnDone();\n            resolve();\n            cache.onDone = null;\n        };\n    });\n};\n\n/**\n * Clear the throttle cache for one or all timers\n * @param {optional string} id:\n *   if provided, clear just this timer\n *   if omitted, clear all timers (mainly useful for testing)\n */\nexports.clear = function(id) {\n    if(id) {\n        _clearTimeout(timerCache[id]);\n        delete timerCache[id];\n    } else {\n        for(var idi in timerCache) exports.clear(idi);\n    }\n};\n\nfunction _clearTimeout(cache) {\n    if(cache && cache.timer !== null) {\n        clearTimeout(cache.timer);\n        cache.timer = null;\n    }\n}\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\n/**\n * convert a linear value into a logged value, folding negative numbers into\n * the given range\n */\nmodule.exports = function toLogRange(val, range) {\n    if(val > 0) return Math.log(val) / Math.LN10;\n\n    // move a negative value reference to a log axis - just put the\n    // result at the lowest range value on the plot (or if the range also went negative,\n    // one millionth of the top of the range)\n    var newVal = Math.log(Math.min(range[0], range[1])) / Math.LN10;\n    if(!isNumeric(newVal)) newVal = Math.log(Math.max(range[0], range[1])) / Math.LN10 - 6;\n    return newVal;\n};\n","'use strict';\n\nmodule.exports = {\n    moduleType: 'locale',\n    name: 'en-US',\n    dictionary: {\n        'Click to enter Colorscale title': 'Click to enter Colorscale title'\n    },\n    format: {\n        date: '%m/%d/%Y'\n    }\n};\n","'use strict';\n\nmodule.exports = {\n    moduleType: 'locale',\n    name: 'en',\n    dictionary: {\n        'Click to enter Colorscale title': 'Click to enter Colourscale title'\n    },\n    format: {\n        days: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],\n        shortDays: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],\n        months: [\n            'January', 'February', 'March', 'April', 'May', 'June',\n            'July', 'August', 'September', 'October', 'November', 'December'\n        ],\n        shortMonths: [\n            'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',\n            'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'\n        ],\n        periods: ['AM', 'PM'],\n        dateTime: '%a %b %e %X %Y',\n        date: '%d/%m/%Y',\n        time: '%H:%M:%S',\n        decimal: '.',\n        thousands: ',',\n        grouping: [3],\n        currency: ['$', ''],\n        year: '%Y',\n        month: '%b %Y',\n        dayMonth: '%b %-d',\n        dayMonthYear: '%b %-d, %Y'\n    }\n};\n","'use strict';\n\nvar Registry = require('../registry');\n\n/*\n * containerArrayMatch: does this attribute string point into a\n * layout container array?\n *\n * @param {String} astr: an attribute string, like *annotations[2].text*\n *\n * @returns {Object | false} Returns false if `astr` doesn't match a container\n *  array. If it does, returns:\n *     {array: {String}, index: {Number}, property: {String}}\n *  ie the attribute string for the array, the index within the array (or ''\n *  if the whole array) and the property within that (or '' if the whole array\n *  or the whole object)\n */\nmodule.exports = function containerArrayMatch(astr) {\n    var rootContainers = Registry.layoutArrayContainers;\n    var regexpContainers = Registry.layoutArrayRegexes;\n    var rootPart = astr.split('[')[0];\n    var arrayStr;\n    var match;\n\n    // look for regexp matches first, because they may be nested inside root matches\n    // eg updatemenus[i].buttons is nested inside updatemenus\n    for(var i = 0; i < regexpContainers.length; i++) {\n        match = astr.match(regexpContainers[i]);\n        if(match && match.index === 0) {\n            arrayStr = match[0];\n            break;\n        }\n    }\n\n    // now look for root matches\n    if(!arrayStr) arrayStr = rootContainers[rootContainers.indexOf(rootPart)];\n\n    if(!arrayStr) return false;\n\n    var tail = astr.substr(arrayStr.length);\n    if(!tail) return {array: arrayStr, index: '', property: ''};\n\n    match = tail.match(/^\\[(0|[1-9][0-9]*)\\](\\.(.+))?$/);\n    if(!match) return false;\n\n    return {array: arrayStr, index: Number(match[1]), property: match[3] || ''};\n};\n","'use strict';\n\nvar Lib = require('../lib');\nvar extendFlat = Lib.extendFlat;\nvar isPlainObject = Lib.isPlainObject;\n\nvar traceOpts = {\n    valType: 'flaglist',\n    extras: ['none'],\n    flags: ['calc', 'clearAxisTypes', 'plot', 'style', 'markerSize', 'colorbars'],\n    description: [\n        'trace attributes should include an `editType` string matching this flaglist.',\n        '*calc* is the most extensive: a full (re)plot starting by clearing `gd.calcdata`',\n        'to force it to be regenerated',\n        '*clearAxisTypes* resets the types of the axes this trace is on, because new data could',\n        'cause the automatic axis type detection to change. Log type will not be cleared, as that',\n        'is never automatically chosen so must have been user-specified.',\n        '*plot* (re)plots but without first clearing `gd.calcdata`.',\n        '*style* only calls `module.style` (or module.editStyle) for all trace modules and redraws the legend.',\n        '*markerSize* is like *style*, but propagate axis-range changes due to scatter `marker.size`',\n        '*colorbars* only redraws colorbars.'\n    ].join(' ')\n};\n\nvar layoutOpts = {\n    valType: 'flaglist',\n    extras: ['none'],\n    flags: [\n        'calc', 'plot', 'legend', 'ticks', 'axrange',\n        'layoutstyle', 'modebar', 'camera', 'arraydraw', 'colorbars'\n    ],\n    description: [\n        'layout attributes should include an `editType` string matching this flaglist.',\n        '*calc* is the most extensive: a full (re)plot starting by clearing `gd.calcdata`',\n        'to force it to be regenerated',\n        '*plot* (re)plots but without first clearing `gd.calcdata`.',\n        '*legend* only redraws the legend.',\n        '*ticks* only redraws axis ticks, labels, and gridlines.',\n        '*axrange* minimal sequence when updating axis ranges.',\n        '*layoutstyle* reapplies global and SVG cartesian axis styles.',\n        '*modebar* just updates the modebar.',\n        '*camera* just updates the camera settings for gl3d scenes.',\n        '*arraydraw* allows component arrays to invoke the redraw routines just for the',\n        'component(s) that changed.',\n        '*colorbars* only redraws colorbars.'\n    ].join(' ')\n};\n\n// flags for inside restyle/relayout include a few extras\n// that shouldn't be used in attributes, to deal with certain\n// combinations and conditionals efficiently\nvar traceEditTypeFlags = traceOpts.flags.slice()\n    .concat(['fullReplot']);\n\nvar layoutEditTypeFlags = layoutOpts.flags.slice()\n    .concat('layoutReplot');\n\nmodule.exports = {\n    traces: traceOpts,\n    layout: layoutOpts,\n    /*\n     * default (all false) edit flags for restyle (traces)\n     * creates a new object each call, so the caller can mutate freely\n     */\n    traceFlags: function() { return falseObj(traceEditTypeFlags); },\n\n    /*\n     * default (all false) edit flags for relayout\n     * creates a new object each call, so the caller can mutate freely\n     */\n    layoutFlags: function() { return falseObj(layoutEditTypeFlags); },\n\n    /*\n     * update `flags` with the `editType` values found in `attr`\n     */\n    update: function(flags, attr) {\n        var editType = attr.editType;\n        if(editType && editType !== 'none') {\n            var editTypeParts = editType.split('+');\n            for(var i = 0; i < editTypeParts.length; i++) {\n                flags[editTypeParts[i]] = true;\n            }\n        }\n    },\n\n    overrideAll: overrideAll\n};\n\nfunction falseObj(keys) {\n    var out = {};\n    for(var i = 0; i < keys.length; i++) out[keys[i]] = false;\n    return out;\n}\n\n/**\n * For attributes that are largely copied from elsewhere into a plot type that doesn't\n * support partial redraws - overrides the editType field of all attributes in the object\n *\n * @param {object} attrs: the attributes to override. Will not be mutated.\n * @param {string} editTypeOverride: the new editType to use\n * @param {'nested'|'from-root'} overrideContainers:\n *   - 'nested' will override editType for nested containers but not the root.\n *   - 'from-root' will also override editType of the root container.\n *   Containers below the absolute top level (trace or layout root) DO need an\n *   editType even if they are not `valObject`s themselves (eg `scatter.marker`)\n *   to handle the case where you edit the whole container.\n *\n * @return {object} a new attributes object with `editType` modified as directed\n */\nfunction overrideAll(attrs, editTypeOverride, overrideContainers) {\n    var out = extendFlat({}, attrs);\n    for(var key in out) {\n        var attr = out[key];\n        if(isPlainObject(attr)) {\n            out[key] = overrideOne(attr, editTypeOverride, overrideContainers, key);\n        }\n    }\n    if(overrideContainers === 'from-root') out.editType = editTypeOverride;\n\n    return out;\n}\n\nfunction overrideOne(attr, editTypeOverride, overrideContainers, key) {\n    if(attr.valType) {\n        var out = extendFlat({}, attr);\n        out.editType = editTypeOverride;\n\n        if(Array.isArray(attr.items)) {\n            out.items = new Array(attr.items.length);\n            for(var i = 0; i < attr.items.length; i++) {\n                out.items[i] = overrideOne(attr.items[i], editTypeOverride, 'from-root');\n            }\n        }\n        return out;\n    } else {\n        // don't provide an editType for the _deprecated container\n        return overrideAll(attr, editTypeOverride,\n            (key.charAt(0) === '_') ? 'nested' : 'from-root');\n    }\n}\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar m4FromQuat = require('gl-mat4/fromQuat');\n\nvar Registry = require('../registry');\nvar Lib = require('../lib');\nvar Plots = require('../plots/plots');\nvar AxisIds = require('../plots/cartesian/axis_ids');\nvar Color = require('../components/color');\n\nvar cleanId = AxisIds.cleanId;\nvar getFromTrace = AxisIds.getFromTrace;\nvar traceIs = Registry.traceIs;\n\n// clear the promise queue if one of them got rejected\nexports.clearPromiseQueue = function(gd) {\n    if(Array.isArray(gd._promises) && gd._promises.length > 0) {\n        Lib.log('Clearing previous rejected promises from queue.');\n    }\n\n    gd._promises = [];\n};\n\n// make a few changes to the layout right away\n// before it gets used for anything\n// backward compatibility and cleanup of nonstandard options\nexports.cleanLayout = function(layout) {\n    var i, j;\n\n    if(!layout) layout = {};\n\n    // cannot have (x|y)axis1, numbering goes axis, axis2, axis3...\n    if(layout.xaxis1) {\n        if(!layout.xaxis) layout.xaxis = layout.xaxis1;\n        delete layout.xaxis1;\n    }\n    if(layout.yaxis1) {\n        if(!layout.yaxis) layout.yaxis = layout.yaxis1;\n        delete layout.yaxis1;\n    }\n    if(layout.scene1) {\n        if(!layout.scene) layout.scene = layout.scene1;\n        delete layout.scene1;\n    }\n\n    var axisAttrRegex = (Plots.subplotsRegistry.cartesian || {}).attrRegex;\n    var polarAttrRegex = (Plots.subplotsRegistry.polar || {}).attrRegex;\n    var ternaryAttrRegex = (Plots.subplotsRegistry.ternary || {}).attrRegex;\n    var sceneAttrRegex = (Plots.subplotsRegistry.gl3d || {}).attrRegex;\n\n    var keys = Object.keys(layout);\n    for(i = 0; i < keys.length; i++) {\n        var key = keys[i];\n\n        if(axisAttrRegex && axisAttrRegex.test(key)) {\n            // modifications to cartesian axes\n\n            var ax = layout[key];\n            if(ax.anchor && ax.anchor !== 'free') {\n                ax.anchor = cleanId(ax.anchor);\n            }\n            if(ax.overlaying) ax.overlaying = cleanId(ax.overlaying);\n\n            // old method of axis type - isdate and islog (before category existed)\n            if(!ax.type) {\n                if(ax.isdate) ax.type = 'date';\n                else if(ax.islog) ax.type = 'log';\n                else if(ax.isdate === false && ax.islog === false) ax.type = 'linear';\n            }\n            if(ax.autorange === 'withzero' || ax.autorange === 'tozero') {\n                ax.autorange = true;\n                ax.rangemode = 'tozero';\n            }\n            delete ax.islog;\n            delete ax.isdate;\n            delete ax.categories; // replaced by _categories\n\n            // prune empty domain arrays made before the new nestedProperty\n            if(emptyContainer(ax, 'domain')) delete ax.domain;\n\n            // autotick -> tickmode\n            if(ax.autotick !== undefined) {\n                if(ax.tickmode === undefined) {\n                    ax.tickmode = ax.autotick ? 'auto' : 'linear';\n                }\n                delete ax.autotick;\n            }\n\n            cleanTitle(ax);\n        } else if(polarAttrRegex && polarAttrRegex.test(key)) {\n            // modifications for polar\n\n            var polar = layout[key];\n            cleanTitle(polar.radialaxis);\n        } else if(ternaryAttrRegex && ternaryAttrRegex.test(key)) {\n            // modifications for ternary\n\n            var ternary = layout[key];\n            cleanTitle(ternary.aaxis);\n            cleanTitle(ternary.baxis);\n            cleanTitle(ternary.caxis);\n        } else if(sceneAttrRegex && sceneAttrRegex.test(key)) {\n            // modifications for 3D scenes\n\n            var scene = layout[key];\n\n            // clean old Camera coords\n            var cameraposition = scene.cameraposition;\n\n            if(Array.isArray(cameraposition) && cameraposition[0].length === 4) {\n                var rotation = cameraposition[0];\n                var center = cameraposition[1];\n                var radius = cameraposition[2];\n                var mat = m4FromQuat([], rotation);\n                var eye = [];\n\n                for(j = 0; j < 3; ++j) {\n                    eye[j] = center[j] + radius * mat[2 + 4 * j];\n                }\n\n                scene.camera = {\n                    eye: {x: eye[0], y: eye[1], z: eye[2]},\n                    center: {x: center[0], y: center[1], z: center[2]},\n                    up: {x: 0, y: 0, z: 1} // we just ignore calculating camera z up in this case\n                };\n\n                delete scene.cameraposition;\n            }\n\n            // clean axis titles\n            cleanTitle(scene.xaxis);\n            cleanTitle(scene.yaxis);\n            cleanTitle(scene.zaxis);\n        }\n    }\n\n    var annotationsLen = Array.isArray(layout.annotations) ? layout.annotations.length : 0;\n    for(i = 0; i < annotationsLen; i++) {\n        var ann = layout.annotations[i];\n\n        if(!Lib.isPlainObject(ann)) continue;\n\n        if(ann.ref) {\n            if(ann.ref === 'paper') {\n                ann.xref = 'paper';\n                ann.yref = 'paper';\n            } else if(ann.ref === 'data') {\n                ann.xref = 'x';\n                ann.yref = 'y';\n            }\n            delete ann.ref;\n        }\n\n        cleanAxRef(ann, 'xref');\n        cleanAxRef(ann, 'yref');\n    }\n\n    var shapesLen = Array.isArray(layout.shapes) ? layout.shapes.length : 0;\n    for(i = 0; i < shapesLen; i++) {\n        var shape = layout.shapes[i];\n\n        if(!Lib.isPlainObject(shape)) continue;\n\n        cleanAxRef(shape, 'xref');\n        cleanAxRef(shape, 'yref');\n    }\n\n    var imagesLen = Array.isArray(layout.images) ? layout.images.length : 0;\n    for(i = 0; i < imagesLen; i++) {\n        var image = layout.images[i];\n\n        if(!Lib.isPlainObject(image)) continue;\n\n        cleanAxRef(image, 'xref');\n        cleanAxRef(image, 'yref');\n    }\n\n    var legend = layout.legend;\n    if(legend) {\n        // check for old-style legend positioning (x or y is +/- 100)\n        if(legend.x > 3) {\n            legend.x = 1.02;\n            legend.xanchor = 'left';\n        } else if(legend.x < -2) {\n            legend.x = -0.02;\n            legend.xanchor = 'right';\n        }\n\n        if(legend.y > 3) {\n            legend.y = 1.02;\n            legend.yanchor = 'bottom';\n        } else if(legend.y < -2) {\n            legend.y = -0.02;\n            legend.yanchor = 'top';\n        }\n    }\n\n    // clean plot title\n    cleanTitle(layout);\n\n    /*\n     * Moved from rotate -> orbit for dragmode\n     */\n    if(layout.dragmode === 'rotate') layout.dragmode = 'orbit';\n\n    // sanitize rgb(fractions) and rgba(fractions) that old tinycolor\n    // supported, but new tinycolor does not because they're not valid css\n    Color.clean(layout);\n\n    // clean the layout container in layout.template\n    if(layout.template && layout.template.layout) {\n        exports.cleanLayout(layout.template.layout);\n    }\n\n    return layout;\n};\n\nfunction cleanAxRef(container, attr) {\n    var valIn = container[attr];\n    var axLetter = attr.charAt(0);\n    if(valIn && valIn !== 'paper') {\n        container[attr] = cleanId(valIn, axLetter, true);\n    }\n}\n\n/**\n * Cleans up old title attribute structure (flat) in favor of the new one (nested).\n *\n * @param {Object} titleContainer - an object potentially including deprecated title attributes\n */\nfunction cleanTitle(titleContainer) {\n    if(titleContainer) {\n        // title -> title.text\n        // (although title used to be a string attribute,\n        // numbers are accepted as well)\n        if(typeof titleContainer.title === 'string' || typeof titleContainer.title === 'number') {\n            titleContainer.title = {\n                text: titleContainer.title\n            };\n        }\n\n        rewireAttr('titlefont', 'font');\n        rewireAttr('titleposition', 'position');\n        rewireAttr('titleside', 'side');\n        rewireAttr('titleoffset', 'offset');\n    }\n\n    function rewireAttr(oldAttrName, newAttrName) {\n        var oldAttrSet = titleContainer[oldAttrName];\n        var newAttrSet = titleContainer.title && titleContainer.title[newAttrName];\n\n        if(oldAttrSet && !newAttrSet) {\n            // Ensure title object exists\n            if(!titleContainer.title) {\n                titleContainer.title = {};\n            }\n\n            titleContainer.title[newAttrName] = titleContainer[oldAttrName];\n            delete titleContainer[oldAttrName];\n        }\n    }\n}\n\n/*\n * cleanData: Make a few changes to the data for backward compatibility\n * before it gets used for anything. Modifies the data traces users provide.\n *\n * Important: if you're going to add something here that modifies a data array,\n * update it in place so the new array === the old one.\n */\nexports.cleanData = function(data) {\n    for(var tracei = 0; tracei < data.length; tracei++) {\n        var trace = data[tracei];\n        var i;\n\n        // use xbins to bin data in x, and ybins to bin data in y\n        if(trace.type === 'histogramy' && 'xbins' in trace && !('ybins' in trace)) {\n            trace.ybins = trace.xbins;\n            delete trace.xbins;\n        }\n\n        // error_y.opacity is obsolete - merge into color\n        if(trace.error_y && 'opacity' in trace.error_y) {\n            var dc = Color.defaults;\n            var yeColor = trace.error_y.color || (traceIs(trace, 'bar') ?\n                Color.defaultLine :\n                dc[tracei % dc.length]);\n            trace.error_y.color = Color.addOpacity(\n                Color.rgb(yeColor),\n                Color.opacity(yeColor) * trace.error_y.opacity);\n            delete trace.error_y.opacity;\n        }\n\n        // convert bardir to orientation, and put the data into\n        // the axes it's eventually going to be used with\n        if('bardir' in trace) {\n            if(trace.bardir === 'h' && (traceIs(trace, 'bar') ||\n                trace.type.substr(0, 9) === 'histogram')) {\n                trace.orientation = 'h';\n                exports.swapXYData(trace);\n            }\n            delete trace.bardir;\n        }\n\n        // now we have only one 1D histogram type, and whether\n        // it uses x or y data depends on trace.orientation\n        if(trace.type === 'histogramy') exports.swapXYData(trace);\n        if(trace.type === 'histogramx' || trace.type === 'histogramy') {\n            trace.type = 'histogram';\n        }\n\n        // scl->scale, reversescl->reversescale\n        if('scl' in trace && !('colorscale' in trace)) {\n            trace.colorscale = trace.scl;\n            delete trace.scl;\n        }\n        if('reversescl' in trace && !('reversescale' in trace)) {\n            trace.reversescale = trace.reversescl;\n            delete trace.reversescl;\n        }\n\n        // axis ids x1 -> x, y1-> y\n        if(trace.xaxis) trace.xaxis = cleanId(trace.xaxis, 'x');\n        if(trace.yaxis) trace.yaxis = cleanId(trace.yaxis, 'y');\n\n        // scene ids scene1 -> scene\n        if(traceIs(trace, 'gl3d') && trace.scene) {\n            trace.scene = Plots.subplotsRegistry.gl3d.cleanId(trace.scene);\n        }\n\n        if(!traceIs(trace, 'pie-like') && !traceIs(trace, 'bar-like')) {\n            if(Array.isArray(trace.textposition)) {\n                for(i = 0; i < trace.textposition.length; i++) {\n                    trace.textposition[i] = cleanTextPosition(trace.textposition[i]);\n                }\n            } else if(trace.textposition) {\n                trace.textposition = cleanTextPosition(trace.textposition);\n            }\n        }\n\n        // fix typo in colorscale definition\n        var _module = Registry.getModule(trace);\n        if(_module && _module.colorbar) {\n            var containerName = _module.colorbar.container;\n            var container = containerName ? trace[containerName] : trace;\n            if(container && container.colorscale) {\n                if(container.colorscale === 'YIGnBu') container.colorscale = 'YlGnBu';\n                if(container.colorscale === 'YIOrRd') container.colorscale = 'YlOrRd';\n            }\n        }\n\n        // fix typo in surface 'highlight*' definitions\n        if(trace.type === 'surface' && Lib.isPlainObject(trace.contours)) {\n            var dims = ['x', 'y', 'z'];\n\n            for(i = 0; i < dims.length; i++) {\n                var opts = trace.contours[dims[i]];\n\n                if(!Lib.isPlainObject(opts)) continue;\n\n                if(opts.highlightColor) {\n                    opts.highlightcolor = opts.highlightColor;\n                    delete opts.highlightColor;\n                }\n\n                if(opts.highlightWidth) {\n                    opts.highlightwidth = opts.highlightWidth;\n                    delete opts.highlightWidth;\n                }\n            }\n        }\n\n        // fixes from converting finance from transforms to real trace types\n        if(trace.type === 'candlestick' || trace.type === 'ohlc') {\n            var increasingShowlegend = (trace.increasing || {}).showlegend !== false;\n            var decreasingShowlegend = (trace.decreasing || {}).showlegend !== false;\n            var increasingName = cleanFinanceDir(trace.increasing);\n            var decreasingName = cleanFinanceDir(trace.decreasing);\n\n            // now figure out something smart to do with the separate direction\n            // names we removed\n            if((increasingName !== false) && (decreasingName !== false)) {\n                // both sub-names existed: base name previously had no effect\n                // so ignore it and try to find a shared part of the sub-names\n\n                var newName = commonPrefix(\n                    increasingName, decreasingName,\n                    increasingShowlegend, decreasingShowlegend\n                );\n                // if no common part, leave whatever name was (or wasn't) there\n                if(newName) trace.name = newName;\n            } else if((increasingName || decreasingName) && !trace.name) {\n                // one sub-name existed but not the base name - just use the sub-name\n                trace.name = increasingName || decreasingName;\n            }\n        }\n\n        // transforms backward compatibility fixes\n        if(Array.isArray(trace.transforms)) {\n            var transforms = trace.transforms;\n\n            for(i = 0; i < transforms.length; i++) {\n                var transform = transforms[i];\n\n                if(!Lib.isPlainObject(transform)) continue;\n\n                switch(transform.type) {\n                    case 'filter':\n                        if(transform.filtersrc) {\n                            transform.target = transform.filtersrc;\n                            delete transform.filtersrc;\n                        }\n\n                        if(transform.calendar) {\n                            if(!transform.valuecalendar) {\n                                transform.valuecalendar = transform.calendar;\n                            }\n                            delete transform.calendar;\n                        }\n                        break;\n\n                    case 'groupby':\n                        // Name has changed from `style` to `styles`, so use `style` but prefer `styles`:\n                        transform.styles = transform.styles || transform.style;\n\n                        if(transform.styles && !Array.isArray(transform.styles)) {\n                            var prevStyles = transform.styles;\n                            var styleKeys = Object.keys(prevStyles);\n\n                            transform.styles = [];\n                            for(var j = 0; j < styleKeys.length; j++) {\n                                transform.styles.push({\n                                    target: styleKeys[j],\n                                    value: prevStyles[styleKeys[j]]\n                                });\n                            }\n                        }\n                        break;\n                }\n            }\n        }\n\n        // prune empty containers made before the new nestedProperty\n        if(emptyContainer(trace, 'line')) delete trace.line;\n        if('marker' in trace) {\n            if(emptyContainer(trace.marker, 'line')) delete trace.marker.line;\n            if(emptyContainer(trace, 'marker')) delete trace.marker;\n        }\n\n        // sanitize rgb(fractions) and rgba(fractions) that old tinycolor\n        // supported, but new tinycolor does not because they're not valid css\n        Color.clean(trace);\n\n        // remove obsolete autobin(x|y) attributes, but only if true\n        // if false, this needs to happen in Histogram.calc because it\n        // can be a one-time autobin so we need to know the results before\n        // we can push them back into the trace.\n        if(trace.autobinx) {\n            delete trace.autobinx;\n            delete trace.xbins;\n        }\n        if(trace.autobiny) {\n            delete trace.autobiny;\n            delete trace.ybins;\n        }\n\n        cleanTitle(trace);\n        if(trace.colorbar) cleanTitle(trace.colorbar);\n        if(trace.marker && trace.marker.colorbar) cleanTitle(trace.marker.colorbar);\n        if(trace.line && trace.line.colorbar) cleanTitle(trace.line.colorbar);\n        if(trace.aaxis) cleanTitle(trace.aaxis);\n        if(trace.baxis) cleanTitle(trace.baxis);\n    }\n};\n\nfunction cleanFinanceDir(dirContainer) {\n    if(!Lib.isPlainObject(dirContainer)) return false;\n\n    var dirName = dirContainer.name;\n\n    delete dirContainer.name;\n    delete dirContainer.showlegend;\n\n    return (typeof dirName === 'string' || typeof dirName === 'number') && String(dirName);\n}\n\nfunction commonPrefix(name1, name2, show1, show2) {\n    // if only one is shown in the legend, use that\n    if(show1 && !show2) return name1;\n    if(show2 && !show1) return name2;\n\n    // if both or neither are in the legend, check if one is blank (or whitespace)\n    // and use the other one\n    // note that hover labels can still use the name even if the legend doesn't\n    if(!name1.trim()) return name2;\n    if(!name2.trim()) return name1;\n\n    var minLen = Math.min(name1.length, name2.length);\n    var i;\n    for(i = 0; i < minLen; i++) {\n        if(name1.charAt(i) !== name2.charAt(i)) break;\n    }\n\n    var out = name1.substr(0, i);\n    return out.trim();\n}\n\n// textposition - support partial attributes (ie just 'top')\n// and incorrect use of middle / center etc.\nfunction cleanTextPosition(textposition) {\n    var posY = 'middle';\n    var posX = 'center';\n\n    if(typeof textposition === 'string') {\n        if(textposition.indexOf('top') !== -1) posY = 'top';\n        else if(textposition.indexOf('bottom') !== -1) posY = 'bottom';\n\n        if(textposition.indexOf('left') !== -1) posX = 'left';\n        else if(textposition.indexOf('right') !== -1) posX = 'right';\n    }\n\n    return posY + ' ' + posX;\n}\n\nfunction emptyContainer(outer, innerStr) {\n    return (innerStr in outer) &&\n        (typeof outer[innerStr] === 'object') &&\n        (Object.keys(outer[innerStr]).length === 0);\n}\n\n\n// swap all the data and data attributes associated with x and y\nexports.swapXYData = function(trace) {\n    var i;\n    Lib.swapAttrs(trace, ['?', '?0', 'd?', '?bins', 'nbins?', 'autobin?', '?src', 'error_?']);\n    if(Array.isArray(trace.z) && Array.isArray(trace.z[0])) {\n        if(trace.transpose) delete trace.transpose;\n        else trace.transpose = true;\n    }\n    if(trace.error_x && trace.error_y) {\n        var errorY = trace.error_y;\n        var copyYstyle = ('copy_ystyle' in errorY) ?\n            errorY.copy_ystyle :\n            !(errorY.color || errorY.thickness || errorY.width);\n        Lib.swapAttrs(trace, ['error_?.copy_ystyle']);\n        if(copyYstyle) {\n            Lib.swapAttrs(trace, ['error_?.color', 'error_?.thickness', 'error_?.width']);\n        }\n    }\n    if(typeof trace.hoverinfo === 'string') {\n        var hoverInfoParts = trace.hoverinfo.split('+');\n        for(i = 0; i < hoverInfoParts.length; i++) {\n            if(hoverInfoParts[i] === 'x') hoverInfoParts[i] = 'y';\n            else if(hoverInfoParts[i] === 'y') hoverInfoParts[i] = 'x';\n        }\n        trace.hoverinfo = hoverInfoParts.join('+');\n    }\n};\n\n// coerce traceIndices input to array of trace indices\nexports.coerceTraceIndices = function(gd, traceIndices) {\n    if(isNumeric(traceIndices)) {\n        return [traceIndices];\n    } else if(!Array.isArray(traceIndices) || !traceIndices.length) {\n        return gd.data.map(function(_, i) { return i; });\n    } else if(Array.isArray(traceIndices)) {\n        var traceIndicesOut = [];\n        for(var i = 0; i < traceIndices.length; i++) {\n            if(Lib.isIndex(traceIndices[i], gd.data.length)) {\n                traceIndicesOut.push(traceIndices[i]);\n            } else {\n                Lib.warn('trace index (', traceIndices[i], ') is not a number or is out of bounds');\n            }\n        }\n        return traceIndicesOut;\n    }\n\n    return traceIndices;\n};\n\n/**\n * Manages logic around array container item creation / deletion / update\n * that nested property alone can't handle.\n *\n * @param {Object} np\n *  nested property of update attribute string about trace or layout object\n * @param {*} newVal\n *  update value passed to restyle / relayout / update\n * @param {Object} undoit\n *  undo hash (N.B. undoit may be mutated here).\n *\n */\nexports.manageArrayContainers = function(np, newVal, undoit) {\n    var obj = np.obj;\n    var parts = np.parts;\n    var pLength = parts.length;\n    var pLast = parts[pLength - 1];\n\n    var pLastIsNumber = isNumeric(pLast);\n\n    if(pLastIsNumber && newVal === null) {\n        // delete item\n\n        // Clear item in array container when new value is null\n        var contPath = parts.slice(0, pLength - 1).join('.');\n        var cont = Lib.nestedProperty(obj, contPath).get();\n        cont.splice(pLast, 1);\n\n        // Note that nested property clears null / undefined at end of\n        // array container, but not within them.\n    } else if(pLastIsNumber && np.get() === undefined) {\n        // create item\n\n        // When adding a new item, make sure undo command will remove it\n        if(np.get() === undefined) undoit[np.astr] = null;\n\n        np.set(newVal);\n    } else {\n        // update item\n\n        // If the last part of attribute string isn't a number,\n        // np.set is all we need.\n        np.set(newVal);\n    }\n};\n\n/*\n * Match the part to strip off to turn an attribute into its parent\n * really it should be either '.some_characters' or '[number]'\n * but we're a little more permissive here and match either\n * '.not_brackets_or_dot' or '[not_brackets_or_dot]'\n */\nvar ATTR_TAIL_RE = /(\\.[^\\[\\]\\.]+|\\[[^\\[\\]\\.]+\\])$/;\n\nfunction getParent(attr) {\n    var tail = attr.search(ATTR_TAIL_RE);\n    if(tail > 0) return attr.substr(0, tail);\n}\n\n/*\n * hasParent: does an attribute object contain a parent of the given attribute?\n * for example, given 'images[2].x' do we also have 'images' or 'images[2]'?\n *\n * @param {Object} aobj\n *  update object, whose keys are attribute strings and values are their new settings\n * @param {string} attr\n *  the attribute string to test against\n * @returns {Boolean}\n *  is a parent of attr present in aobj?\n */\nexports.hasParent = function(aobj, attr) {\n    var attrParent = getParent(attr);\n    while(attrParent) {\n        if(attrParent in aobj) return true;\n        attrParent = getParent(attrParent);\n    }\n    return false;\n};\n\n/**\n * Empty out types for all axes containing these traces so we auto-set them again\n *\n * @param {object} gd\n * @param {[integer]} traces: trace indices to search for axes to clear the types of\n * @param {object} layoutUpdate: any update being done concurrently to the layout,\n *   which may supercede clearing the axis types\n */\nvar axLetters = ['x', 'y', 'z'];\nexports.clearAxisTypes = function(gd, traces, layoutUpdate) {\n    for(var i = 0; i < traces.length; i++) {\n        var trace = gd._fullData[i];\n        for(var j = 0; j < 3; j++) {\n            var ax = getFromTrace(gd, trace, axLetters[j]);\n\n            // do not clear log type - that's never an auto result so must have been intentional\n            if(ax && ax.type !== 'log') {\n                var axAttr = ax._name;\n                var sceneName = ax._id.substr(1);\n                if(sceneName.substr(0, 5) === 'scene') {\n                    if(layoutUpdate[sceneName] !== undefined) continue;\n                    axAttr = sceneName + '.' + axAttr;\n                }\n                var typeAttr = axAttr + '.type';\n\n                if(layoutUpdate[axAttr] === undefined && layoutUpdate[typeAttr] === undefined) {\n                    Lib.nestedProperty(gd.layout, typeAttr).set(null);\n                }\n            }\n        }\n    }\n};\n","'use strict';\n\nvar main = require('./plot_api');\n\nexports._doPlot = main._doPlot;\nexports.newPlot = main.newPlot;\nexports.restyle = main.restyle;\nexports.relayout = main.relayout;\nexports.redraw = main.redraw;\nexports.update = main.update;\nexports._guiRestyle = main._guiRestyle;\nexports._guiRelayout = main._guiRelayout;\nexports._guiUpdate = main._guiUpdate;\nexports._storeDirectGUIEdit = main._storeDirectGUIEdit;\nexports.react = main.react;\nexports.extendTraces = main.extendTraces;\nexports.prependTraces = main.prependTraces;\nexports.addTraces = main.addTraces;\nexports.deleteTraces = main.deleteTraces;\nexports.moveTraces = main.moveTraces;\nexports.purge = main.purge;\nexports.addFrames = main.addFrames;\nexports.deleteFrames = main.deleteFrames;\nexports.animate = main.animate;\nexports.setPlotConfig = main.setPlotConfig;\n\nexports.toImage = require('./to_image');\nexports.validate = require('./validate');\nexports.downloadImage = require('../snapshot/download');\n\nvar templateApi = require('./template_api');\nexports.makeTemplate = templateApi.makeTemplate;\nexports.validateTemplate = templateApi.validateTemplate;\n","'use strict';\n\nvar isPlainObject = require('../lib/is_plain_object');\nvar noop = require('../lib/noop');\nvar Loggers = require('../lib/loggers');\nvar sorterAsc = require('../lib/search').sorterAsc;\nvar Registry = require('../registry');\n\n\nexports.containerArrayMatch = require('./container_array_match');\n\nvar isAddVal = exports.isAddVal = function isAddVal(val) {\n    return val === 'add' || isPlainObject(val);\n};\n\nvar isRemoveVal = exports.isRemoveVal = function isRemoveVal(val) {\n    return val === null || val === 'remove';\n};\n\n/*\n * applyContainerArrayChanges: for managing arrays of layout components in relayout\n * handles them all with a consistent interface.\n *\n * Here are the supported actions -> relayout calls -> edits we get here\n * (as prepared in _relayout):\n *\n * add an empty obj -> {'annotations[2]': 'add'} -> {2: {'': 'add'}}\n * add a specific obj -> {'annotations[2]': {attrs}} -> {2: {'': {attrs}}}\n * delete an obj -> {'annotations[2]': 'remove'} -> {2: {'': 'remove'}}\n *               -> {'annotations[2]': null} -> {2: {'': null}}\n * delete the whole array -> {'annotations': 'remove'} -> {'': {'': 'remove'}}\n *                        -> {'annotations': null} -> {'': {'': null}}\n * edit an object -> {'annotations[2].text': 'boo'} -> {2: {'text': 'boo'}}\n *\n * You can combine many edits to different objects. Objects are added and edited\n * in ascending order, then removed in descending order.\n * For example, starting with [a, b, c], if you want to:\n * - replace b with d:\n *   {'annotations[1]': d, 'annotations[2]': null} (b is item 2 after adding d)\n * - add a new item d between a and b, and edit b:\n *    {'annotations[1]': d, 'annotations[2].x': newX} (b is item 2 after adding d)\n * - delete b and edit c:\n *    {'annotations[1]': null, 'annotations[2].x': newX} (c is edited before b is removed)\n *\n * You CANNOT combine adding/deleting an item at index `i` with edits to the same index `i`\n * You CANNOT combine replacing/deleting the whole array with anything else (for the same array).\n *\n * @param {HTMLDivElement} gd\n *  the DOM element of the graph container div\n * @param {Lib.nestedProperty} componentType: the array we are editing\n * @param {Object} edits\n *  the changes to make; keys are indices to edit, values are themselves objects:\n *  {attr: newValue} of changes to make to that index (with add/remove behavior\n *  in special values of the empty attr)\n * @param {Object} flags\n *  the flags for which actions we're going to perform to display these (and\n *  any other) changes. If we're already `recalc`ing, we don't need to redraw\n *  individual items\n * @param {function} _nestedProperty\n *  a (possibly modified for gui edits) nestedProperty constructor\n *  The modified version takes a 3rd argument, for a prefix to the attribute\n *  string necessary for storing GUI edits\n *\n * @returns {bool} `true` if it managed to complete drawing of the changes\n *  `false` would mean the parent should replot.\n */\nexports.applyContainerArrayChanges = function applyContainerArrayChanges(gd, np, edits, flags, _nestedProperty) {\n    var componentType = np.astr;\n    var supplyComponentDefaults = Registry.getComponentMethod(componentType, 'supplyLayoutDefaults');\n    var draw = Registry.getComponentMethod(componentType, 'draw');\n    var drawOne = Registry.getComponentMethod(componentType, 'drawOne');\n    var replotLater = flags.replot || flags.recalc || (supplyComponentDefaults === noop) || (draw === noop);\n    var layout = gd.layout;\n    var fullLayout = gd._fullLayout;\n\n    if(edits['']) {\n        if(Object.keys(edits).length > 1) {\n            Loggers.warn('Full array edits are incompatible with other edits',\n                componentType);\n        }\n\n        var fullVal = edits[''][''];\n\n        if(isRemoveVal(fullVal)) np.set(null);\n        else if(Array.isArray(fullVal)) np.set(fullVal);\n        else {\n            Loggers.warn('Unrecognized full array edit value', componentType, fullVal);\n            return true;\n        }\n\n        if(replotLater) return false;\n\n        supplyComponentDefaults(layout, fullLayout);\n        draw(gd);\n        return true;\n    }\n\n    var componentNums = Object.keys(edits).map(Number).sort(sorterAsc);\n    var componentArrayIn = np.get();\n    var componentArray = componentArrayIn || [];\n    // componentArrayFull is used just to keep splices in line between\n    // full and input arrays, so private keys can be copied over after\n    // redoing supplyDefaults\n    // TODO: this assumes componentArray is in gd.layout - which will not be\n    // true after we extend this to restyle\n    var componentArrayFull = _nestedProperty(fullLayout, componentType).get();\n\n    var deletes = [];\n    var firstIndexChange = -1;\n    var maxIndex = componentArray.length;\n    var i;\n    var j;\n    var componentNum;\n    var objEdits;\n    var objKeys;\n    var objVal;\n    var adding, prefix;\n\n    // first make the add and edit changes\n    for(i = 0; i < componentNums.length; i++) {\n        componentNum = componentNums[i];\n        objEdits = edits[componentNum];\n        objKeys = Object.keys(objEdits);\n        objVal = objEdits[''],\n        adding = isAddVal(objVal);\n\n        if(componentNum < 0 || componentNum > componentArray.length - (adding ? 0 : 1)) {\n            Loggers.warn('index out of range', componentType, componentNum);\n            continue;\n        }\n\n        if(objVal !== undefined) {\n            if(objKeys.length > 1) {\n                Loggers.warn(\n                    'Insertion & removal are incompatible with edits to the same index.',\n                    componentType, componentNum);\n            }\n\n            if(isRemoveVal(objVal)) {\n                deletes.push(componentNum);\n            } else if(adding) {\n                if(objVal === 'add') objVal = {};\n                componentArray.splice(componentNum, 0, objVal);\n                if(componentArrayFull) componentArrayFull.splice(componentNum, 0, {});\n            } else {\n                Loggers.warn('Unrecognized full object edit value',\n                    componentType, componentNum, objVal);\n            }\n\n            if(firstIndexChange === -1) firstIndexChange = componentNum;\n        } else {\n            for(j = 0; j < objKeys.length; j++) {\n                prefix = componentType + '[' + componentNum + '].';\n                _nestedProperty(componentArray[componentNum], objKeys[j], prefix)\n                    .set(objEdits[objKeys[j]]);\n            }\n        }\n    }\n\n    // now do deletes\n    for(i = deletes.length - 1; i >= 0; i--) {\n        componentArray.splice(deletes[i], 1);\n        // TODO: this drops private keys that had been stored in componentArrayFull\n        // does this have any ill effects?\n        if(componentArrayFull) componentArrayFull.splice(deletes[i], 1);\n    }\n\n    if(!componentArray.length) np.set(null);\n    else if(!componentArrayIn) np.set(componentArray);\n\n    if(replotLater) return false;\n\n    supplyComponentDefaults(layout, fullLayout);\n\n    // finally draw all the components we need to\n    // if we added or removed any, redraw all after it\n    if(drawOne !== noop) {\n        var indicesToDraw;\n        if(firstIndexChange === -1) {\n            // there's no re-indexing to do, so only redraw components that changed\n            indicesToDraw = componentNums;\n        } else {\n            // in case the component array was shortened, we still need do call\n            // drawOne on the latter items so they get properly removed\n            maxIndex = Math.max(componentArray.length, maxIndex);\n            indicesToDraw = [];\n            for(i = 0; i < componentNums.length; i++) {\n                componentNum = componentNums[i];\n                if(componentNum >= firstIndexChange) break;\n                indicesToDraw.push(componentNum);\n            }\n            for(i = firstIndexChange; i < maxIndex; i++) {\n                indicesToDraw.push(i);\n            }\n        }\n        for(i = 0; i < indicesToDraw.length; i++) {\n            drawOne(gd, indicesToDraw[i]);\n        }\n    } else draw(gd);\n\n    return true;\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar isNumeric = require('fast-isnumeric');\nvar hasHover = require('has-hover');\n\nvar Lib = require('../lib');\nvar nestedProperty = Lib.nestedProperty;\n\nvar Events = require('../lib/events');\nvar Queue = require('../lib/queue');\n\nvar Registry = require('../registry');\nvar PlotSchema = require('./plot_schema');\nvar Plots = require('../plots/plots');\n\nvar Axes = require('../plots/cartesian/axes');\nvar Drawing = require('../components/drawing');\nvar Color = require('../components/color');\nvar initInteractions = require('../plots/cartesian/graph_interact').initInteractions;\nvar xmlnsNamespaces = require('../constants/xmlns_namespaces');\nvar clearSelect = require('../plots/cartesian/select').clearSelect;\n\nvar dfltConfig = require('./plot_config').dfltConfig;\nvar manageArrays = require('./manage_arrays');\nvar helpers = require('./helpers');\nvar subroutines = require('./subroutines');\nvar editTypes = require('./edit_types');\n\nvar AX_NAME_PATTERN = require('../plots/cartesian/constants').AX_NAME_PATTERN;\n\nvar numericNameWarningCount = 0;\nvar numericNameWarningCountLimit = 5;\n\n/**\n * Internal plot-creation function\n *\n * @param {string id or DOM element} gd\n *      the id or DOM element of the graph container div\n * @param {array of objects} data\n *      array of traces, containing the data and display information for each trace\n * @param {object} layout\n *      object describing the overall display of the plot,\n *      all the stuff that doesn't pertain to any individual trace\n * @param {object} config\n *      configuration options (see ./plot_config.js for more info)\n *\n * OR\n *\n * @param {string id or DOM element} gd\n *      the id or DOM element of the graph container div\n * @param {object} figure\n *      object containing `data`, `layout`, `config`, and `frames` members\n *\n */\nfunction _doPlot(gd, data, layout, config) {\n    var frames;\n\n    gd = Lib.getGraphDiv(gd);\n\n    // Events.init is idempotent and bails early if gd has already been init'd\n    Events.init(gd);\n\n    if(Lib.isPlainObject(data)) {\n        var obj = data;\n        data = obj.data;\n        layout = obj.layout;\n        config = obj.config;\n        frames = obj.frames;\n    }\n\n    var okToPlot = Events.triggerHandler(gd, 'plotly_beforeplot', [data, layout, config]);\n    if(okToPlot === false) return Promise.reject();\n\n    // if there's no data or layout, and this isn't yet a plotly plot\n    // container, log a warning to help plotly.js users debug\n    if(!data && !layout && !Lib.isPlotDiv(gd)) {\n        Lib.warn('Calling _doPlot as if redrawing ' +\n            'but this container doesn\\'t yet have a plot.', gd);\n    }\n\n    function addFrames() {\n        if(frames) {\n            return exports.addFrames(gd, frames);\n        }\n    }\n\n    // transfer configuration options to gd until we move over to\n    // a more OO like model\n    setPlotContext(gd, config);\n\n    if(!layout) layout = {};\n\n    // hook class for plots main container (in case of plotly.js\n    // this won't be #embedded-graph or .js-tab-contents)\n    d3.select(gd).classed('js-plotly-plot', true);\n\n    // off-screen getBoundingClientRect testing space,\n    // in #js-plotly-tester (and stored as Drawing.tester)\n    // so we can share cached text across tabs\n    Drawing.makeTester();\n\n    // collect promises for any async actions during plotting\n    // any part of the plotting code can push to gd._promises, then\n    // before we move to the next step, we check that they're all\n    // complete, and empty out the promise list again.\n    if(!Array.isArray(gd._promises)) gd._promises = [];\n\n    var graphWasEmpty = ((gd.data || []).length === 0 && Array.isArray(data));\n\n    // if there is already data on the graph, append the new data\n    // if you only want to redraw, pass a non-array for data\n    if(Array.isArray(data)) {\n        helpers.cleanData(data);\n\n        if(graphWasEmpty) gd.data = data;\n        else gd.data.push.apply(gd.data, data);\n\n        // for routines outside graph_obj that want a clean tab\n        // (rather than appending to an existing one) gd.empty\n        // is used to determine whether to make a new tab\n        gd.empty = false;\n    }\n\n    if(!gd.layout || graphWasEmpty) {\n        gd.layout = helpers.cleanLayout(layout);\n    }\n\n    Plots.supplyDefaults(gd);\n\n    var fullLayout = gd._fullLayout;\n    var hasCartesian = fullLayout._has('cartesian');\n\n    // so we don't try to re-call _doPlot from inside\n    // legend and colorbar, if margins changed\n    fullLayout._replotting = true;\n\n    // make or remake the framework if we need to\n    if(graphWasEmpty || fullLayout._shouldCreateBgLayer) {\n        makePlotFramework(gd);\n\n        if(fullLayout._shouldCreateBgLayer) {\n            delete fullLayout._shouldCreateBgLayer;\n        }\n    }\n\n    // clear gradient and pattern defs on each .plot call, because we know we'll loop through all traces\n    Drawing.initGradients(gd);\n    Drawing.initPatterns(gd);\n\n    // save initial show spikes once per graph\n    if(graphWasEmpty) Axes.saveShowSpikeInitial(gd);\n\n    // prepare the data and find the autorange\n\n    // generate calcdata, if we need to\n    // to force redoing calcdata, just delete it before calling _doPlot\n    var recalc = !gd.calcdata || gd.calcdata.length !== (gd._fullData || []).length;\n    if(recalc) Plots.doCalcdata(gd);\n\n    // in case it has changed, attach fullData traces to calcdata\n    for(var i = 0; i < gd.calcdata.length; i++) {\n        gd.calcdata[i][0].trace = gd._fullData[i];\n    }\n\n    // make the figure responsive\n    if(gd._context.responsive) {\n        if(!gd._responsiveChartHandler) {\n            // Keep a reference to the resize handler to purge it down the road\n            gd._responsiveChartHandler = function() { if(!Lib.isHidden(gd)) Plots.resize(gd); };\n\n            // Listen to window resize\n            window.addEventListener('resize', gd._responsiveChartHandler);\n        }\n    } else {\n        Lib.clearResponsive(gd);\n    }\n\n    /*\n     * start async-friendly code - now we're actually drawing things\n     */\n\n    var oldMargins = Lib.extendFlat({}, fullLayout._size);\n\n    // draw framework first so that margin-pushing\n    // components can position themselves correctly\n    var drawFrameworkCalls = 0;\n    function drawFramework() {\n        var basePlotModules = fullLayout._basePlotModules;\n\n        for(var i = 0; i < basePlotModules.length; i++) {\n            if(basePlotModules[i].drawFramework) {\n                basePlotModules[i].drawFramework(gd);\n            }\n        }\n\n        if(!fullLayout._glcanvas && fullLayout._has('gl')) {\n            fullLayout._glcanvas = fullLayout._glcontainer.selectAll('.gl-canvas').data([{\n                key: 'contextLayer',\n                context: true,\n                pick: false\n            }, {\n                key: 'focusLayer',\n                context: false,\n                pick: false\n            }, {\n                key: 'pickLayer',\n                context: false,\n                pick: true\n            }], function(d) { return d.key; });\n\n            fullLayout._glcanvas.enter().append('canvas')\n                .attr('class', function(d) {\n                    return 'gl-canvas gl-canvas-' + d.key.replace('Layer', '');\n                })\n                .style({\n                    position: 'absolute',\n                    top: 0,\n                    left: 0,\n                    overflow: 'visible',\n                    'pointer-events': 'none'\n                });\n        }\n\n        if(fullLayout._glcanvas) {\n            fullLayout._glcanvas\n                .attr('width', fullLayout.width)\n                .attr('height', fullLayout.height);\n\n            var regl = fullLayout._glcanvas.data()[0].regl;\n            if(regl) {\n                // Unfortunately, this can happen when relayouting to large\n                // width/height on some browsers.\n                if(Math.floor(fullLayout.width) !== regl._gl.drawingBufferWidth ||\n                    Math.floor(fullLayout.height) !== regl._gl.drawingBufferHeight\n                 ) {\n                    var msg = 'WebGL context buffer and canvas dimensions do not match due to browser/WebGL bug.';\n                    if(drawFrameworkCalls) {\n                        Lib.error(msg);\n                    } else {\n                        Lib.log(msg + ' Clearing graph and plotting again.');\n                        Plots.cleanPlot([], {}, gd._fullData, fullLayout);\n                        Plots.supplyDefaults(gd);\n                        fullLayout = gd._fullLayout;\n                        Plots.doCalcdata(gd);\n                        drawFrameworkCalls++;\n                        return drawFramework();\n                    }\n                }\n            }\n        }\n\n        if(fullLayout.modebar.orientation === 'h') {\n            fullLayout._modebardiv\n              .style('height', null)\n              .style('width', '100%');\n        } else {\n            fullLayout._modebardiv\n              .style('width', null)\n              .style('height', fullLayout.height + 'px');\n        }\n\n        return Plots.previousPromises(gd);\n    }\n\n    // draw anything that can affect margins.\n    function marginPushers() {\n        // First reset the list of things that are allowed to change the margins\n        // So any deleted traces or components will be wiped out of the\n        // automargin calculation.\n        // This means *every* margin pusher must be listed here, even if it\n        // doesn't actually try to push the margins until later.\n        Plots.clearAutoMarginIds(gd);\n\n        subroutines.drawMarginPushers(gd);\n        Axes.allowAutoMargin(gd);\n\n        // TODO can this be moved elsewhere?\n        if(fullLayout._has('pie')) {\n            var fullData = gd._fullData;\n            for(var i = 0; i < fullData.length; i++) {\n                var trace = fullData[i];\n                if(trace.type === 'pie' && trace.automargin) {\n                    Plots.allowAutoMargin(gd, 'pie.' + trace.uid + '.automargin');\n                }\n            }\n        }\n\n        Plots.doAutoMargin(gd);\n        return Plots.previousPromises(gd);\n    }\n\n    // in case the margins changed, draw margin pushers again\n    function marginPushersAgain() {\n        if(!Plots.didMarginChange(oldMargins, fullLayout._size)) return;\n\n        return Lib.syncOrAsync([\n            marginPushers,\n            subroutines.layoutStyles\n        ], gd);\n    }\n\n    function positionAndAutorange() {\n        if(!recalc) {\n            doAutoRangeAndConstraints();\n            return;\n        }\n\n        // TODO: autosize extra for text markers and images\n        // see https://github.com/plotly/plotly.js/issues/1111\n        return Lib.syncOrAsync([\n            Registry.getComponentMethod('shapes', 'calcAutorange'),\n            Registry.getComponentMethod('annotations', 'calcAutorange'),\n            doAutoRangeAndConstraints\n        ], gd);\n    }\n\n    function doAutoRangeAndConstraints() {\n        if(gd._transitioning) return;\n\n        subroutines.doAutoRangeAndConstraints(gd);\n\n        // store initial ranges *after* enforcing constraints, otherwise\n        // we will never look like we're at the initial ranges\n        if(graphWasEmpty) Axes.saveRangeInitial(gd);\n\n        // this one is different from shapes/annotations calcAutorange\n        // the others incorporate those components into ax._extremes,\n        // this one actually sets the ranges in rangesliders.\n        Registry.getComponentMethod('rangeslider', 'calcAutorange')(gd);\n    }\n\n    // draw ticks, titles, and calculate axis scaling (._b, ._m)\n    function drawAxes() {\n        return Axes.draw(gd, graphWasEmpty ? '' : 'redraw');\n    }\n\n    var seq = [\n        Plots.previousPromises,\n        addFrames,\n        drawFramework,\n        marginPushers,\n        marginPushersAgain\n    ];\n\n    if(hasCartesian) seq.push(positionAndAutorange);\n\n    seq.push(subroutines.layoutStyles);\n    if(hasCartesian) {\n        seq.push(\n            drawAxes,\n            function insideTickLabelsAutorange(gd) {\n                if(gd._fullLayout._insideTickLabelsAutorange) {\n                    relayout(gd, gd._fullLayout._insideTickLabelsAutorange).then(function() {\n                        gd._fullLayout._insideTickLabelsAutorange = undefined;\n                    });\n                }\n            }\n        );\n    }\n\n    seq.push(\n        subroutines.drawData,\n        subroutines.finalDraw,\n        initInteractions,\n        Plots.addLinks,\n        Plots.rehover,\n        Plots.redrag,\n        // TODO: doAutoMargin is only needed here for axis automargin, which\n        // happens outside of marginPushers where all the other automargins are\n        // calculated. Would be much better to separate margin calculations from\n        // component drawing - see https://github.com/plotly/plotly.js/issues/2704\n        Plots.doAutoMargin,\n        saveRangeInitialForInsideTickLabels,\n        Plots.previousPromises\n    );\n\n    function saveRangeInitialForInsideTickLabels(gd) {\n        if(gd._fullLayout._insideTickLabelsAutorange) {\n            if(graphWasEmpty) Axes.saveRangeInitial(gd, true);\n        }\n    }\n\n    // even if everything we did was synchronous, return a promise\n    // so that the caller doesn't care which route we took\n    var plotDone = Lib.syncOrAsync(seq, gd);\n    if(!plotDone || !plotDone.then) plotDone = Promise.resolve();\n\n    return plotDone.then(function() {\n        emitAfterPlot(gd);\n        return gd;\n    });\n}\n\nfunction emitAfterPlot(gd) {\n    var fullLayout = gd._fullLayout;\n\n    if(fullLayout._redrawFromAutoMarginCount) {\n        fullLayout._redrawFromAutoMarginCount--;\n    } else {\n        gd.emit('plotly_afterplot');\n    }\n}\n\nfunction setPlotConfig(obj) {\n    return Lib.extendFlat(dfltConfig, obj);\n}\n\nfunction setBackground(gd, bgColor) {\n    try {\n        gd._fullLayout._paper.style('background', bgColor);\n    } catch(e) {\n        Lib.error(e);\n    }\n}\n\nfunction opaqueSetBackground(gd, bgColor) {\n    var blend = Color.combine(bgColor, 'white');\n    setBackground(gd, blend);\n}\n\nfunction setPlotContext(gd, config) {\n    if(!gd._context) {\n        gd._context = Lib.extendDeep({}, dfltConfig);\n\n        // stash <base> href, used to make robust clipPath URLs\n        var base = d3.select('base');\n        gd._context._baseUrl = base.size() && base.attr('href') ?\n            window.location.href.split('#')[0] :\n            '';\n    }\n\n    var context = gd._context;\n\n    var i, keys, key;\n\n    if(config) {\n        keys = Object.keys(config);\n        for(i = 0; i < keys.length; i++) {\n            key = keys[i];\n            if(key === 'editable' || key === 'edits') continue;\n            if(key in context) {\n                if(key === 'setBackground' && config[key] === 'opaque') {\n                    context[key] = opaqueSetBackground;\n                } else {\n                    context[key] = config[key];\n                }\n            }\n        }\n\n        // map plot3dPixelRatio to plotGlPixelRatio for backward compatibility\n        if(config.plot3dPixelRatio && !context.plotGlPixelRatio) {\n            context.plotGlPixelRatio = context.plot3dPixelRatio;\n        }\n\n        // now deal with editable and edits - first editable overrides\n        // everything, then edits refines\n        var editable = config.editable;\n        if(editable !== undefined) {\n            // we're not going to *use* context.editable, we're only going to\n            // use context.edits... but keep it for the record\n            context.editable = editable;\n\n            keys = Object.keys(context.edits);\n            for(i = 0; i < keys.length; i++) {\n                context.edits[keys[i]] = editable;\n            }\n        }\n        if(config.edits) {\n            keys = Object.keys(config.edits);\n            for(i = 0; i < keys.length; i++) {\n                key = keys[i];\n                if(key in context.edits) {\n                    context.edits[key] = config.edits[key];\n                }\n            }\n        }\n\n        // not part of the user-facing config options\n        context._exportedPlot = config._exportedPlot;\n    }\n\n    // staticPlot forces a bunch of others:\n    if(context.staticPlot) {\n        context.editable = false;\n        context.edits = {};\n        context.autosizable = false;\n        context.scrollZoom = false;\n        context.doubleClick = false;\n        context.showTips = false;\n        context.showLink = false;\n        context.displayModeBar = false;\n    }\n\n    // make sure hover-only devices have mode bar visible\n    if(context.displayModeBar === 'hover' && !hasHover) {\n        context.displayModeBar = true;\n    }\n\n    // default and fallback for setBackground\n    if(context.setBackground === 'transparent' || typeof context.setBackground !== 'function') {\n        context.setBackground = setBackground;\n    }\n\n    // Check if gd has a specified widht/height to begin with\n    context._hasZeroHeight = context._hasZeroHeight || gd.clientHeight === 0;\n    context._hasZeroWidth = context._hasZeroWidth || gd.clientWidth === 0;\n\n    // fill context._scrollZoom helper to help manage scrollZoom flaglist\n    var szIn = context.scrollZoom;\n    var szOut = context._scrollZoom = {};\n    if(szIn === true) {\n        szOut.cartesian = 1;\n        szOut.gl3d = 1;\n        szOut.geo = 1;\n        szOut.mapbox = 1;\n    } else if(typeof szIn === 'string') {\n        var parts = szIn.split('+');\n        for(i = 0; i < parts.length; i++) {\n            szOut[parts[i]] = 1;\n        }\n    } else if(szIn !== false) {\n        szOut.gl3d = 1;\n        szOut.geo = 1;\n        szOut.mapbox = 1;\n    }\n}\n\n\n// convenience function to force a full redraw, mostly for use by plotly.js\nfunction redraw(gd) {\n    gd = Lib.getGraphDiv(gd);\n\n    if(!Lib.isPlotDiv(gd)) {\n        throw new Error('This element is not a Plotly plot: ' + gd);\n    }\n\n    helpers.cleanData(gd.data);\n    helpers.cleanLayout(gd.layout);\n\n    gd.calcdata = undefined;\n    return exports._doPlot(gd).then(function() {\n        gd.emit('plotly_redraw');\n        return gd;\n    });\n}\n\n/**\n * Convenience function to make idempotent plot option obvious to users.\n *\n * @param gd\n * @param {Object[]} data\n * @param {Object} layout\n * @param {Object} config\n */\nfunction newPlot(gd, data, layout, config) {\n    gd = Lib.getGraphDiv(gd);\n\n    // remove gl contexts\n    Plots.cleanPlot([], {}, gd._fullData || [], gd._fullLayout || {});\n\n    Plots.purge(gd);\n    return exports._doPlot(gd, data, layout, config);\n}\n\n/**\n * Wrap negative indicies to their positive counterparts.\n *\n * @param {Number[]} indices An array of indices\n * @param {Number} maxIndex The maximum index allowable (arr.length - 1)\n */\nfunction positivifyIndices(indices, maxIndex) {\n    var parentLength = maxIndex + 1;\n    var positiveIndices = [];\n    var i;\n    var index;\n\n    for(i = 0; i < indices.length; i++) {\n        index = indices[i];\n        if(index < 0) {\n            positiveIndices.push(parentLength + index);\n        } else {\n            positiveIndices.push(index);\n        }\n    }\n    return positiveIndices;\n}\n\n/**\n * Ensures that an index array for manipulating gd.data is valid.\n *\n * Intended for use with addTraces, deleteTraces, and moveTraces.\n *\n * @param gd\n * @param indices\n * @param arrayName\n */\nfunction assertIndexArray(gd, indices, arrayName) {\n    var i,\n        index;\n\n    for(i = 0; i < indices.length; i++) {\n        index = indices[i];\n\n        // validate that indices are indeed integers\n        if(index !== parseInt(index, 10)) {\n            throw new Error('all values in ' + arrayName + ' must be integers');\n        }\n\n        // check that all indices are in bounds for given gd.data array length\n        if(index >= gd.data.length || index < -gd.data.length) {\n            throw new Error(arrayName + ' must be valid indices for gd.data.');\n        }\n\n        // check that indices aren't repeated\n        if(indices.indexOf(index, i + 1) > -1 ||\n                index >= 0 && indices.indexOf(-gd.data.length + index) > -1 ||\n                index < 0 && indices.indexOf(gd.data.length + index) > -1) {\n            throw new Error('each index in ' + arrayName + ' must be unique.');\n        }\n    }\n}\n\n/**\n * Private function used by Plotly.moveTraces to check input args\n *\n * @param gd\n * @param currentIndices\n * @param newIndices\n */\nfunction checkMoveTracesArgs(gd, currentIndices, newIndices) {\n    // check that gd has attribute 'data' and 'data' is array\n    if(!Array.isArray(gd.data)) {\n        throw new Error('gd.data must be an array.');\n    }\n\n    // validate currentIndices array\n    if(typeof currentIndices === 'undefined') {\n        throw new Error('currentIndices is a required argument.');\n    } else if(!Array.isArray(currentIndices)) {\n        currentIndices = [currentIndices];\n    }\n    assertIndexArray(gd, currentIndices, 'currentIndices');\n\n    // validate newIndices array if it exists\n    if(typeof newIndices !== 'undefined' && !Array.isArray(newIndices)) {\n        newIndices = [newIndices];\n    }\n    if(typeof newIndices !== 'undefined') {\n        assertIndexArray(gd, newIndices, 'newIndices');\n    }\n\n    // check currentIndices and newIndices are the same length if newIdices exists\n    if(typeof newIndices !== 'undefined' && currentIndices.length !== newIndices.length) {\n        throw new Error('current and new indices must be of equal length.');\n    }\n}\n/**\n * A private function to reduce the type checking clutter in addTraces.\n *\n * @param gd\n * @param traces\n * @param newIndices\n */\nfunction checkAddTracesArgs(gd, traces, newIndices) {\n    var i, value;\n\n    // check that gd has attribute 'data' and 'data' is array\n    if(!Array.isArray(gd.data)) {\n        throw new Error('gd.data must be an array.');\n    }\n\n    // make sure traces exists\n    if(typeof traces === 'undefined') {\n        throw new Error('traces must be defined.');\n    }\n\n    // make sure traces is an array\n    if(!Array.isArray(traces)) {\n        traces = [traces];\n    }\n\n    // make sure each value in traces is an object\n    for(i = 0; i < traces.length; i++) {\n        value = traces[i];\n        if(typeof value !== 'object' || (Array.isArray(value) || value === null)) {\n            throw new Error('all values in traces array must be non-array objects');\n        }\n    }\n\n    // make sure we have an index for each trace\n    if(typeof newIndices !== 'undefined' && !Array.isArray(newIndices)) {\n        newIndices = [newIndices];\n    }\n    if(typeof newIndices !== 'undefined' && newIndices.length !== traces.length) {\n        throw new Error(\n            'if indices is specified, traces.length must equal indices.length'\n        );\n    }\n}\n\n/**\n * A private function to reduce the type checking clutter in spliceTraces.\n * Get all update Properties from gd.data. Validate inputs and outputs.\n * Used by prependTrace and extendTraces\n *\n * @param gd\n * @param update\n * @param indices\n * @param maxPoints\n */\nfunction assertExtendTracesArgs(gd, update, indices, maxPoints) {\n    var maxPointsIsObject = Lib.isPlainObject(maxPoints);\n\n    if(!Array.isArray(gd.data)) {\n        throw new Error('gd.data must be an array');\n    }\n    if(!Lib.isPlainObject(update)) {\n        throw new Error('update must be a key:value object');\n    }\n\n    if(typeof indices === 'undefined') {\n        throw new Error('indices must be an integer or array of integers');\n    }\n\n    assertIndexArray(gd, indices, 'indices');\n\n    for(var key in update) {\n        /*\n         * Verify that the attribute to be updated contains as many trace updates\n         * as indices. Failure must result in throw and no-op\n         */\n        if(!Array.isArray(update[key]) || update[key].length !== indices.length) {\n            throw new Error('attribute ' + key + ' must be an array of length equal to indices array length');\n        }\n\n        /*\n         * if maxPoints is an object it must match keys and array lengths of 'update' 1:1\n         */\n        if(maxPointsIsObject &&\n            (!(key in maxPoints) || !Array.isArray(maxPoints[key]) ||\n            maxPoints[key].length !== update[key].length)) {\n            throw new Error('when maxPoints is set as a key:value object it must contain a 1:1 ' +\n                            'corrispondence with the keys and number of traces in the update object');\n        }\n    }\n}\n\n/**\n * A private function to reduce the type checking clutter in spliceTraces.\n *\n * @param {Object|HTMLDivElement} gd\n * @param {Object} update\n * @param {Number[]} indices\n * @param {Number||Object} maxPoints\n * @return {Object[]}\n */\nfunction getExtendProperties(gd, update, indices, maxPoints) {\n    var maxPointsIsObject = Lib.isPlainObject(maxPoints);\n    var updateProps = [];\n    var trace, target, prop, insert, maxp;\n\n    // allow scalar index to represent a single trace position\n    if(!Array.isArray(indices)) indices = [indices];\n\n    // negative indices are wrapped around to their positive value. Equivalent to python indexing.\n    indices = positivifyIndices(indices, gd.data.length - 1);\n\n    // loop through all update keys and traces and harvest validated data.\n    for(var key in update) {\n        for(var j = 0; j < indices.length; j++) {\n            /*\n             * Choose the trace indexed by the indices map argument and get the prop setter-getter\n             * instance that references the key and value for this particular trace.\n             */\n            trace = gd.data[indices[j]];\n            prop = nestedProperty(trace, key);\n\n            /*\n             * Target is the existing gd.data.trace.dataArray value like \"x\" or \"marker.size\"\n             * Target must exist as an Array to allow the extend operation to be performed.\n             */\n            target = prop.get();\n            insert = update[key][j];\n\n            if(!Lib.isArrayOrTypedArray(insert)) {\n                throw new Error('attribute: ' + key + ' index: ' + j + ' must be an array');\n            }\n            if(!Lib.isArrayOrTypedArray(target)) {\n                throw new Error('cannot extend missing or non-array attribute: ' + key);\n            }\n            if(target.constructor !== insert.constructor) {\n                throw new Error('cannot extend array with an array of a different type: ' + key);\n            }\n\n            /*\n             * maxPoints may be an object map or a scalar. If object select the key:value, else\n             * Use the scalar maxPoints for all key and trace combinations.\n             */\n            maxp = maxPointsIsObject ? maxPoints[key][j] : maxPoints;\n\n            // could have chosen null here, -1 just tells us to not take a window\n            if(!isNumeric(maxp)) maxp = -1;\n\n            /*\n             * Wrap the nestedProperty in an object containing required data\n             * for lengthening and windowing this particular trace - key combination.\n             * Flooring maxp mirrors the behaviour of floats in the Array.slice JSnative function.\n             */\n            updateProps.push({\n                prop: prop,\n                target: target,\n                insert: insert,\n                maxp: Math.floor(maxp)\n            });\n        }\n    }\n\n    // all target and insertion data now validated\n    return updateProps;\n}\n\n/**\n * A private function to key Extend and Prepend traces DRY\n *\n * @param {Object|HTMLDivElement} gd\n * @param {Object} update\n * @param {Number[]} indices\n * @param {Number||Object} maxPoints\n * @param {Function} updateArray\n * @return {Object}\n */\nfunction spliceTraces(gd, update, indices, maxPoints, updateArray) {\n    assertExtendTracesArgs(gd, update, indices, maxPoints);\n\n    var updateProps = getExtendProperties(gd, update, indices, maxPoints);\n    var undoUpdate = {};\n    var undoPoints = {};\n\n    for(var i = 0; i < updateProps.length; i++) {\n        var prop = updateProps[i].prop;\n        var maxp = updateProps[i].maxp;\n\n        // return new array and remainder\n        var out = updateArray(updateProps[i].target, updateProps[i].insert, maxp);\n        prop.set(out[0]);\n\n        // build the inverse update object for the undo operation\n        if(!Array.isArray(undoUpdate[prop.astr])) undoUpdate[prop.astr] = [];\n        undoUpdate[prop.astr].push(out[1]);\n\n         // build the matching maxPoints undo object containing original trace lengths\n        if(!Array.isArray(undoPoints[prop.astr])) undoPoints[prop.astr] = [];\n        undoPoints[prop.astr].push(updateProps[i].target.length);\n    }\n\n    return {update: undoUpdate, maxPoints: undoPoints};\n}\n\nfunction concatTypedArray(arr0, arr1) {\n    var arr2 = new arr0.constructor(arr0.length + arr1.length);\n    arr2.set(arr0);\n    arr2.set(arr1, arr0.length);\n    return arr2;\n}\n\n/**\n * extend && prepend traces at indices with update arrays, window trace lengths to maxPoints\n *\n * Extend and Prepend have identical APIs. Prepend inserts an array at the head while Extend\n * inserts an array off the tail. Prepend truncates the tail of the array - counting maxPoints\n * from the head, whereas Extend truncates the head of the array, counting backward maxPoints\n * from the tail.\n *\n * If maxPoints is undefined, nonNumeric, negative or greater than extended trace length no\n * truncation / windowing will be performed. If its zero, well the whole trace is truncated.\n *\n * @param {Object|HTMLDivElement} gd The graph div\n * @param {Object} update The key:array map of target attributes to extend\n * @param {Number|Number[]} indices The locations of traces to be extended\n * @param {Number|Object} [maxPoints] Number of points for trace window after lengthening.\n *\n */\nfunction extendTraces(gd, update, indices, maxPoints) {\n    gd = Lib.getGraphDiv(gd);\n\n    function updateArray(target, insert, maxp) {\n        var newArray, remainder;\n\n        if(Lib.isTypedArray(target)) {\n            if(maxp < 0) {\n                var none = new target.constructor(0);\n                var both = concatTypedArray(target, insert);\n\n                if(maxp < 0) {\n                    newArray = both;\n                    remainder = none;\n                } else {\n                    newArray = none;\n                    remainder = both;\n                }\n            } else {\n                newArray = new target.constructor(maxp);\n                remainder = new target.constructor(target.length + insert.length - maxp);\n\n                if(maxp === insert.length) {\n                    newArray.set(insert);\n                    remainder.set(target);\n                } else if(maxp < insert.length) {\n                    var numberOfItemsFromInsert = insert.length - maxp;\n\n                    newArray.set(insert.subarray(numberOfItemsFromInsert));\n                    remainder.set(target);\n                    remainder.set(insert.subarray(0, numberOfItemsFromInsert), target.length);\n                } else {\n                    var numberOfItemsFromTarget = maxp - insert.length;\n                    var targetBegin = target.length - numberOfItemsFromTarget;\n\n                    newArray.set(target.subarray(targetBegin));\n                    newArray.set(insert, numberOfItemsFromTarget);\n                    remainder.set(target.subarray(0, targetBegin));\n                }\n            }\n        } else {\n            newArray = target.concat(insert);\n            remainder = (maxp >= 0 && maxp < newArray.length) ?\n                newArray.splice(0, newArray.length - maxp) :\n                [];\n        }\n\n        return [newArray, remainder];\n    }\n\n    var undo = spliceTraces(gd, update, indices, maxPoints, updateArray);\n    var promise = exports.redraw(gd);\n    var undoArgs = [gd, undo.update, indices, undo.maxPoints];\n    Queue.add(gd, exports.prependTraces, undoArgs, extendTraces, arguments);\n\n    return promise;\n}\n\nfunction prependTraces(gd, update, indices, maxPoints) {\n    gd = Lib.getGraphDiv(gd);\n\n    function updateArray(target, insert, maxp) {\n        var newArray, remainder;\n\n        if(Lib.isTypedArray(target)) {\n            if(maxp <= 0) {\n                var none = new target.constructor(0);\n                var both = concatTypedArray(insert, target);\n\n                if(maxp < 0) {\n                    newArray = both;\n                    remainder = none;\n                } else {\n                    newArray = none;\n                    remainder = both;\n                }\n            } else {\n                newArray = new target.constructor(maxp);\n                remainder = new target.constructor(target.length + insert.length - maxp);\n\n                if(maxp === insert.length) {\n                    newArray.set(insert);\n                    remainder.set(target);\n                } else if(maxp < insert.length) {\n                    var numberOfItemsFromInsert = insert.length - maxp;\n\n                    newArray.set(insert.subarray(0, numberOfItemsFromInsert));\n                    remainder.set(insert.subarray(numberOfItemsFromInsert));\n                    remainder.set(target, numberOfItemsFromInsert);\n                } else {\n                    var numberOfItemsFromTarget = maxp - insert.length;\n\n                    newArray.set(insert);\n                    newArray.set(target.subarray(0, numberOfItemsFromTarget), insert.length);\n                    remainder.set(target.subarray(numberOfItemsFromTarget));\n                }\n            }\n        } else {\n            newArray = insert.concat(target);\n            remainder = (maxp >= 0 && maxp < newArray.length) ?\n                newArray.splice(maxp, newArray.length) :\n                [];\n        }\n\n        return [newArray, remainder];\n    }\n\n    var undo = spliceTraces(gd, update, indices, maxPoints, updateArray);\n    var promise = exports.redraw(gd);\n    var undoArgs = [gd, undo.update, indices, undo.maxPoints];\n    Queue.add(gd, exports.extendTraces, undoArgs, prependTraces, arguments);\n\n    return promise;\n}\n\n/**\n * Add data traces to an existing graph div.\n *\n * @param {Object|HTMLDivElement} gd The graph div\n * @param {Object[]} gd.data The array of traces we're adding to\n * @param {Object[]|Object} traces The object or array of objects to add\n * @param {Number[]|Number} [newIndices=[gd.data.length]] Locations to add traces\n *\n */\nfunction addTraces(gd, traces, newIndices) {\n    gd = Lib.getGraphDiv(gd);\n\n    var currentIndices = [];\n    var undoFunc = exports.deleteTraces;\n    var redoFunc = addTraces;\n    var undoArgs = [gd, currentIndices];\n    var redoArgs = [gd, traces];  // no newIndices here\n    var i;\n    var promise;\n\n    // all validation is done elsewhere to remove clutter here\n    checkAddTracesArgs(gd, traces, newIndices);\n\n    // make sure traces is an array\n    if(!Array.isArray(traces)) {\n        traces = [traces];\n    }\n\n    // make sure traces do not repeat existing ones\n    traces = traces.map(function(trace) {\n        return Lib.extendFlat({}, trace);\n    });\n\n    helpers.cleanData(traces);\n\n    // add the traces to gd.data (no redrawing yet!)\n    for(i = 0; i < traces.length; i++) {\n        gd.data.push(traces[i]);\n    }\n\n    // to continue, we need to call moveTraces which requires currentIndices\n    for(i = 0; i < traces.length; i++) {\n        currentIndices.push(-traces.length + i);\n    }\n\n    // if the user didn't define newIndices, they just want the traces appended\n    // i.e., we can simply redraw and be done\n    if(typeof newIndices === 'undefined') {\n        promise = exports.redraw(gd);\n        Queue.add(gd, undoFunc, undoArgs, redoFunc, redoArgs);\n        return promise;\n    }\n\n    // make sure indices is property defined\n    if(!Array.isArray(newIndices)) {\n        newIndices = [newIndices];\n    }\n\n    try {\n        // this is redundant, but necessary to not catch later possible errors!\n        checkMoveTracesArgs(gd, currentIndices, newIndices);\n    } catch(error) {\n        // something went wrong, reset gd to be safe and rethrow error\n        gd.data.splice(gd.data.length - traces.length, traces.length);\n        throw error;\n    }\n\n    // if we're here, the user has defined specific places to place the new traces\n    // this requires some extra work that moveTraces will do\n    Queue.startSequence(gd);\n    Queue.add(gd, undoFunc, undoArgs, redoFunc, redoArgs);\n    promise = exports.moveTraces(gd, currentIndices, newIndices);\n    Queue.stopSequence(gd);\n    return promise;\n}\n\n/**\n * Delete traces at `indices` from gd.data array.\n *\n * @param {Object|HTMLDivElement} gd The graph div\n * @param {Object[]} gd.data The array of traces we're removing from\n * @param {Number|Number[]} indices The indices\n */\nfunction deleteTraces(gd, indices) {\n    gd = Lib.getGraphDiv(gd);\n\n    var traces = [];\n    var undoFunc = exports.addTraces;\n    var redoFunc = deleteTraces;\n    var undoArgs = [gd, traces, indices];\n    var redoArgs = [gd, indices];\n    var i;\n    var deletedTrace;\n\n    // make sure indices are defined\n    if(typeof indices === 'undefined') {\n        throw new Error('indices must be an integer or array of integers.');\n    } else if(!Array.isArray(indices)) {\n        indices = [indices];\n    }\n    assertIndexArray(gd, indices, 'indices');\n\n    // convert negative indices to positive indices\n    indices = positivifyIndices(indices, gd.data.length - 1);\n\n    // we want descending here so that splicing later doesn't affect indexing\n    indices.sort(Lib.sorterDes);\n    for(i = 0; i < indices.length; i += 1) {\n        deletedTrace = gd.data.splice(indices[i], 1)[0];\n        traces.push(deletedTrace);\n    }\n\n    var promise = exports.redraw(gd);\n    Queue.add(gd, undoFunc, undoArgs, redoFunc, redoArgs);\n\n    return promise;\n}\n\n/**\n * Move traces at currentIndices array to locations in newIndices array.\n *\n * If newIndices is omitted, currentIndices will be moved to the end. E.g.,\n * these are equivalent:\n *\n * Plotly.moveTraces(gd, [1, 2, 3], [-3, -2, -1])\n * Plotly.moveTraces(gd, [1, 2, 3])\n *\n * @param {Object|HTMLDivElement} gd The graph div\n * @param {Object[]} gd.data The array of traces we're removing from\n * @param {Number|Number[]} currentIndices The locations of traces to be moved\n * @param {Number|Number[]} [newIndices] The locations to move traces to\n *\n * Example calls:\n *\n *      // move trace i to location x\n *      Plotly.moveTraces(gd, i, x)\n *\n *      // move trace i to end of array\n *      Plotly.moveTraces(gd, i)\n *\n *      // move traces i, j, k to end of array (i != j != k)\n *      Plotly.moveTraces(gd, [i, j, k])\n *\n *      // move traces [i, j, k] to [x, y, z] (i != j != k) (x != y != z)\n *      Plotly.moveTraces(gd, [i, j, k], [x, y, z])\n *\n *      // reorder all traces (assume there are 5--a, b, c, d, e)\n *      Plotly.moveTraces(gd, [b, d, e, a, c])  // same as 'move to end'\n */\nfunction moveTraces(gd, currentIndices, newIndices) {\n    gd = Lib.getGraphDiv(gd);\n\n    var newData = [];\n    var movingTraceMap = [];\n    var undoFunc = moveTraces;\n    var redoFunc = moveTraces;\n    var undoArgs = [gd, newIndices, currentIndices];\n    var redoArgs = [gd, currentIndices, newIndices];\n    var i;\n\n    // to reduce complexity here, check args elsewhere\n    // this throws errors where appropriate\n    checkMoveTracesArgs(gd, currentIndices, newIndices);\n\n    // make sure currentIndices is an array\n    currentIndices = Array.isArray(currentIndices) ? currentIndices : [currentIndices];\n\n    // if undefined, define newIndices to point to the end of gd.data array\n    if(typeof newIndices === 'undefined') {\n        newIndices = [];\n        for(i = 0; i < currentIndices.length; i++) {\n            newIndices.push(-currentIndices.length + i);\n        }\n    }\n\n    // make sure newIndices is an array if it's user-defined\n    newIndices = Array.isArray(newIndices) ? newIndices : [newIndices];\n\n    // convert negative indices to positive indices (they're the same length)\n    currentIndices = positivifyIndices(currentIndices, gd.data.length - 1);\n    newIndices = positivifyIndices(newIndices, gd.data.length - 1);\n\n    // at this point, we've coerced the index arrays into predictable forms\n\n    // get the traces that aren't being moved around\n    for(i = 0; i < gd.data.length; i++) {\n        // if index isn't in currentIndices, include it in ignored!\n        if(currentIndices.indexOf(i) === -1) {\n            newData.push(gd.data[i]);\n        }\n    }\n\n    // get a mapping of indices to moving traces\n    for(i = 0; i < currentIndices.length; i++) {\n        movingTraceMap.push({newIndex: newIndices[i], trace: gd.data[currentIndices[i]]});\n    }\n\n    // reorder this mapping by newIndex, ascending\n    movingTraceMap.sort(function(a, b) {\n        return a.newIndex - b.newIndex;\n    });\n\n    // now, add the moving traces back in, in order!\n    for(i = 0; i < movingTraceMap.length; i += 1) {\n        newData.splice(movingTraceMap[i].newIndex, 0, movingTraceMap[i].trace);\n    }\n\n    gd.data = newData;\n\n    var promise = exports.redraw(gd);\n    Queue.add(gd, undoFunc, undoArgs, redoFunc, redoArgs);\n\n    return promise;\n}\n\n/**\n * restyle: update trace attributes of an existing plot\n *\n * Can be called two ways.\n *\n * Signature 1:\n * @param {String | HTMLDivElement} gd\n *  the id or DOM element of the graph container div\n * @param {String} astr\n *  attribute string (like `'marker.symbol'`) to update\n * @param {*} val\n *  value to give this attribute\n * @param {Number[] | Number} [traces]\n *  integer or array of integers for the traces to alter (all if omitted)\n *\n * Signature 2:\n * @param {String | HTMLDivElement} gd\n *  (as in signature 1)\n * @param {Object} aobj\n *  attribute object `{astr1: val1, astr2: val2 ...}`\n *  allows setting multiple attributes simultaneously\n * @param {Number[] | Number} [traces]\n *  (as in signature 1)\n *\n * `val` (or `val1`, `val2` ... in the object form) can be an array,\n * to apply different values to each trace.\n *\n * If the array is too short, it will wrap around (useful for\n * style files that want to specify cyclical default values).\n */\nfunction restyle(gd, astr, val, _traces) {\n    gd = Lib.getGraphDiv(gd);\n    helpers.clearPromiseQueue(gd);\n\n    var aobj = {};\n    if(typeof astr === 'string') aobj[astr] = val;\n    else if(Lib.isPlainObject(astr)) {\n        // the 3-arg form\n        aobj = Lib.extendFlat({}, astr);\n        if(_traces === undefined) _traces = val;\n    } else {\n        Lib.warn('Restyle fail.', astr, val, _traces);\n        return Promise.reject();\n    }\n\n    if(Object.keys(aobj).length) gd.changed = true;\n\n    var traces = helpers.coerceTraceIndices(gd, _traces);\n\n    var specs = _restyle(gd, aobj, traces);\n    var flags = specs.flags;\n\n    // clear calcdata and/or axis types if required so they get regenerated\n    if(flags.calc) gd.calcdata = undefined;\n    if(flags.clearAxisTypes) helpers.clearAxisTypes(gd, traces, {});\n\n    // fill in redraw sequence\n    var seq = [];\n\n    if(flags.fullReplot) {\n        seq.push(exports._doPlot);\n    } else {\n        seq.push(Plots.previousPromises);\n\n        // maybe only call Plots.supplyDataDefaults in the splom case,\n        // to skip over long and slow axes defaults\n        Plots.supplyDefaults(gd);\n\n        if(flags.markerSize) {\n            Plots.doCalcdata(gd);\n            addAxRangeSequence(seq);\n\n            // TODO\n            // if all axes have autorange:false, then\n            // proceed to subroutines.doTraceStyle(),\n            // otherwise we must go through addAxRangeSequence,\n            // which in general must redraws 'all' axes\n        }\n\n        if(flags.style) seq.push(subroutines.doTraceStyle);\n        if(flags.colorbars) seq.push(subroutines.doColorBars);\n\n        seq.push(emitAfterPlot);\n    }\n\n    seq.push(Plots.rehover, Plots.redrag);\n\n    Queue.add(gd,\n        restyle, [gd, specs.undoit, specs.traces],\n        restyle, [gd, specs.redoit, specs.traces]\n    );\n\n    var plotDone = Lib.syncOrAsync(seq, gd);\n    if(!plotDone || !plotDone.then) plotDone = Promise.resolve();\n\n    return plotDone.then(function() {\n        gd.emit('plotly_restyle', specs.eventData);\n        return gd;\n    });\n}\n\n// for undo: undefined initial vals must be turned into nulls\n// so that we unset rather than ignore them\nfunction undefinedToNull(val) {\n    if(val === undefined) return null;\n    return val;\n}\n\n/**\n * Factory function to wrap nestedProperty with GUI edits if necessary\n * with GUI edits we add an optional prefix to the nestedProperty constructor\n * to prepend to the attribute string in the preGUI store.\n */\nfunction makeNP(preGUI, guiEditFlag) {\n    if(!guiEditFlag) return nestedProperty;\n\n    return function(container, attr, prefix) {\n        var np = nestedProperty(container, attr);\n        var npSet = np.set;\n        np.set = function(val) {\n            var fullAttr = (prefix || '') + attr;\n            storeCurrent(fullAttr, np.get(), val, preGUI);\n            npSet(val);\n        };\n        return np;\n    };\n}\n\nfunction storeCurrent(attr, val, newVal, preGUI) {\n    if(Array.isArray(val) || Array.isArray(newVal)) {\n        var arrayVal = Array.isArray(val) ? val : [];\n        var arrayNew = Array.isArray(newVal) ? newVal : [];\n        var maxLen = Math.max(arrayVal.length, arrayNew.length);\n        for(var i = 0; i < maxLen; i++) {\n            storeCurrent(attr + '[' + i + ']', arrayVal[i], arrayNew[i], preGUI);\n        }\n    } else if(Lib.isPlainObject(val) || Lib.isPlainObject(newVal)) {\n        var objVal = Lib.isPlainObject(val) ? val : {};\n        var objNew = Lib.isPlainObject(newVal) ? newVal : {};\n        var objBoth = Lib.extendFlat({}, objVal, objNew);\n        for(var key in objBoth) {\n            storeCurrent(attr + '.' + key, objVal[key], objNew[key], preGUI);\n        }\n    } else if(preGUI[attr] === undefined) {\n        preGUI[attr] = undefinedToNull(val);\n    }\n}\n\n/**\n * storeDirectGUIEdit: for routines that skip restyle/relayout and mock it\n * by emitting a plotly_restyle or plotly_relayout event, this routine\n * keeps track of the initial state in _preGUI for use by uirevision\n * Does *not* apply these changes to data/layout - that's the responsibility\n * of the calling routine.\n *\n * @param {object} container: the input attributes container (eg `layout` or a `trace`)\n * @param {object} preGUI: where original values should be stored, either\n *     `layout._preGUI` or `layout._tracePreGUI[uid]`\n * @param {object} edits: the {attr: val} object as normally passed to `relayout` etc\n */\nfunction _storeDirectGUIEdit(container, preGUI, edits) {\n    for(var attr in edits) {\n        var np = nestedProperty(container, attr);\n        storeCurrent(attr, np.get(), edits[attr], preGUI);\n    }\n}\n\nfunction _restyle(gd, aobj, traces) {\n    var fullLayout = gd._fullLayout;\n    var fullData = gd._fullData;\n    var data = gd.data;\n    var guiEditFlag = fullLayout._guiEditing;\n    var layoutNP = makeNP(fullLayout._preGUI, guiEditFlag);\n    var eventData = Lib.extendDeepAll({}, aobj);\n    var i;\n\n    cleanDeprecatedAttributeKeys(aobj);\n\n    // initialize flags\n    var flags = editTypes.traceFlags();\n\n    // copies of the change (and previous values of anything affected)\n    // for the undo / redo queue\n    var redoit = {};\n    var undoit = {};\n    var axlist;\n\n    // make a new empty vals array for undoit\n    function a0() { return traces.map(function() { return undefined; }); }\n\n    // for autoranging multiple axes\n    function addToAxlist(axid) {\n        var axName = Axes.id2name(axid);\n        if(axlist.indexOf(axName) === -1) axlist.push(axName);\n    }\n\n    function autorangeAttr(axName) { return 'LAYOUT' + axName + '.autorange'; }\n\n    function rangeAttr(axName) { return 'LAYOUT' + axName + '.range'; }\n\n    function getFullTrace(traceIndex) {\n        // usually fullData maps 1:1 onto data, but with groupby transforms\n        // the fullData index can be greater. Take the *first* matching trace.\n        for(var j = traceIndex; j < fullData.length; j++) {\n            if(fullData[j]._input === data[traceIndex]) return fullData[j];\n        }\n        // should never get here - and if we *do* it should cause an error\n        // later on undefined fullTrace is passed to nestedProperty.\n    }\n\n    // for attrs that interact (like scales & autoscales), save the\n    // old vals before making the change\n    // val=undefined will not set a value, just record what the value was.\n    // val=null will delete the attribute\n    // attr can be an array to set several at once (all to the same val)\n    function doextra(attr, val, i) {\n        if(Array.isArray(attr)) {\n            attr.forEach(function(a) { doextra(a, val, i); });\n            return;\n        }\n        // quit if explicitly setting this elsewhere\n        if(attr in aobj || helpers.hasParent(aobj, attr)) return;\n\n        var extraparam;\n        if(attr.substr(0, 6) === 'LAYOUT') {\n            extraparam = layoutNP(gd.layout, attr.replace('LAYOUT', ''));\n        } else {\n            var tracei = traces[i];\n            var preGUI = fullLayout._tracePreGUI[getFullTrace(tracei)._fullInput.uid];\n            extraparam = makeNP(preGUI, guiEditFlag)(data[tracei], attr);\n        }\n\n        if(!(attr in undoit)) {\n            undoit[attr] = a0();\n        }\n        if(undoit[attr][i] === undefined) {\n            undoit[attr][i] = undefinedToNull(extraparam.get());\n        }\n        if(val !== undefined) {\n            extraparam.set(val);\n        }\n    }\n\n    function allBins(binAttr) {\n        return function(j) {\n            return fullData[j][binAttr];\n        };\n    }\n\n    function arrayBins(binAttr) {\n        return function(vij, j) {\n            return vij === false ? fullData[traces[j]][binAttr] : null;\n        };\n    }\n\n    // now make the changes to gd.data (and occasionally gd.layout)\n    // and figure out what kind of graphics update we need to do\n    for(var ai in aobj) {\n        if(helpers.hasParent(aobj, ai)) {\n            throw new Error('cannot set ' + ai + ' and a parent attribute simultaneously');\n        }\n\n        var vi = aobj[ai];\n        var cont;\n        var contFull;\n        var param;\n        var oldVal;\n        var newVal;\n        var valObject;\n\n        // Backward compatibility shim for turning histogram autobin on,\n        // or freezing previous autobinned values.\n        // Replace obsolete `autobin(x|y): true` with `(x|y)bins: null`\n        // and `autobin(x|y): false` with the `(x|y)bins` in `fullData`\n        if(ai === 'autobinx' || ai === 'autobiny') {\n            ai = ai.charAt(ai.length - 1) + 'bins';\n            if(Array.isArray(vi)) vi = vi.map(arrayBins(ai));\n            else if(vi === false) vi = traces.map(allBins(ai));\n            else vi = null;\n        }\n\n        redoit[ai] = vi;\n\n        if(ai.substr(0, 6) === 'LAYOUT') {\n            param = layoutNP(gd.layout, ai.replace('LAYOUT', ''));\n            undoit[ai] = [undefinedToNull(param.get())];\n            // since we're allowing val to be an array, allow it here too,\n            // even though that's meaningless\n            param.set(Array.isArray(vi) ? vi[0] : vi);\n            // ironically, the layout attrs in restyle only require replot,\n            // not relayout\n            flags.calc = true;\n            continue;\n        }\n\n        // set attribute in gd.data\n        undoit[ai] = a0();\n        for(i = 0; i < traces.length; i++) {\n            cont = data[traces[i]];\n            contFull = getFullTrace(traces[i]);\n            var preGUI = fullLayout._tracePreGUI[contFull._fullInput.uid];\n            param = makeNP(preGUI, guiEditFlag)(cont, ai);\n            oldVal = param.get();\n            newVal = Array.isArray(vi) ? vi[i % vi.length] : vi;\n\n            if(newVal === undefined) continue;\n\n            var finalPart = param.parts[param.parts.length - 1];\n            var prefix = ai.substr(0, ai.length - finalPart.length - 1);\n            var prefixDot = prefix ? prefix + '.' : '';\n            var innerContFull = prefix ?\n                nestedProperty(contFull, prefix).get() : contFull;\n\n            valObject = PlotSchema.getTraceValObject(contFull, param.parts);\n\n            if(valObject && valObject.impliedEdits && newVal !== null) {\n                for(var impliedKey in valObject.impliedEdits) {\n                    doextra(Lib.relativeAttr(ai, impliedKey), valObject.impliedEdits[impliedKey], i);\n                }\n            } else if((finalPart === 'thicknessmode' || finalPart === 'lenmode') &&\n                    oldVal !== newVal &&\n                    (newVal === 'fraction' || newVal === 'pixels') &&\n                    innerContFull\n            ) {\n                // changing colorbar size modes,\n                // make the resulting size not change\n                // note that colorbar fractional sizing is based on the\n                // original plot size, before anything (like a colorbar)\n                // increases the margins\n\n                var gs = fullLayout._size;\n                var orient = innerContFull.orient;\n                var topOrBottom = (orient === 'top') || (orient === 'bottom');\n                if(finalPart === 'thicknessmode') {\n                    var thicknorm = topOrBottom ? gs.h : gs.w;\n                    doextra(prefixDot + 'thickness', innerContFull.thickness *\n                        (newVal === 'fraction' ? 1 / thicknorm : thicknorm), i);\n                } else {\n                    var lennorm = topOrBottom ? gs.w : gs.h;\n                    doextra(prefixDot + 'len', innerContFull.len *\n                        (newVal === 'fraction' ? 1 / lennorm : lennorm), i);\n                }\n            } else if(ai === 'type' && (\n                (newVal === 'pie') !== (oldVal === 'pie') ||\n                (newVal === 'funnelarea') !== (oldVal === 'funnelarea')\n            )) {\n                var labelsTo = 'x';\n                var valuesTo = 'y';\n                if((newVal === 'bar' || oldVal === 'bar') && cont.orientation === 'h') {\n                    labelsTo = 'y';\n                    valuesTo = 'x';\n                }\n                Lib.swapAttrs(cont, ['?', '?src'], 'labels', labelsTo);\n                Lib.swapAttrs(cont, ['d?', '?0'], 'label', labelsTo);\n                Lib.swapAttrs(cont, ['?', '?src'], 'values', valuesTo);\n\n                if(oldVal === 'pie' || oldVal === 'funnelarea') {\n                    nestedProperty(cont, 'marker.color')\n                        .set(nestedProperty(cont, 'marker.colors').get());\n\n                    // super kludgy - but if all pies are gone we won't remove them otherwise\n                    fullLayout._pielayer.selectAll('g.trace').remove();\n                } else if(Registry.traceIs(cont, 'cartesian')) {\n                    nestedProperty(cont, 'marker.colors')\n                        .set(nestedProperty(cont, 'marker.color').get());\n                }\n            }\n\n            undoit[ai][i] = undefinedToNull(oldVal);\n            // set the new value - if val is an array, it's one el per trace\n            // first check for attributes that get more complex alterations\n            var swapAttrs = [\n                'swapxy', 'swapxyaxes', 'orientation', 'orientationaxes'\n            ];\n            if(swapAttrs.indexOf(ai) !== -1) {\n                // setting an orientation: make sure it's changing\n                // before we swap everything else\n                if(ai === 'orientation') {\n                    param.set(newVal);\n                    // obnoxious that we need this level of coupling... but in order to\n                    // properly handle setting orientation to `null` we need to mimic\n                    // the logic inside Bars.supplyDefaults for default orientation\n                    var defaultOrientation = (cont.x && !cont.y) ? 'h' : 'v';\n                    if((param.get() || defaultOrientation) === contFull.orientation) {\n                        continue;\n                    }\n                } else if(ai === 'orientationaxes') {\n                    // orientationaxes has no value,\n                    // it flips everything and the axes\n\n                    cont.orientation =\n                        {v: 'h', h: 'v'}[contFull.orientation];\n                }\n                helpers.swapXYData(cont);\n                flags.calc = flags.clearAxisTypes = true;\n            } else if(Plots.dataArrayContainers.indexOf(param.parts[0]) !== -1) {\n                // TODO: use manageArrays.applyContainerArrayChanges here too\n                helpers.manageArrayContainers(param, newVal, undoit);\n                flags.calc = true;\n            } else {\n                if(valObject) {\n                    // must redo calcdata when restyling array values of arrayOk attributes\n                    // ... but no need to this for regl-based traces\n                    if(valObject.arrayOk &&\n                        !Registry.traceIs(contFull, 'regl') &&\n                        (Lib.isArrayOrTypedArray(newVal) || Lib.isArrayOrTypedArray(oldVal))\n                    ) {\n                        flags.calc = true;\n                    } else editTypes.update(flags, valObject);\n                } else {\n                    /*\n                     * if we couldn't find valObject,  assume a full recalc.\n                     * This can happen if you're changing type and making\n                     * some other edits too, so the modules we're\n                     * looking at don't have these attributes in them.\n                     */\n                    flags.calc = true;\n                }\n\n                // all the other ones, just modify that one attribute\n                param.set(newVal);\n            }\n        }\n\n        // swap the data attributes of the relevant x and y axes?\n        if(['swapxyaxes', 'orientationaxes'].indexOf(ai) !== -1) {\n            Axes.swap(gd, traces);\n        }\n\n        // swap hovermode if set to \"compare x/y data\"\n        if(ai === 'orientationaxes') {\n            var hovermode = nestedProperty(gd.layout, 'hovermode');\n            var h = hovermode.get();\n            if(h === 'x') {\n                hovermode.set('y');\n            } else if(h === 'y') {\n                hovermode.set('x');\n            } else if(h === 'x unified') {\n                hovermode.set('y unified');\n            } else if(h === 'y unified') {\n                hovermode.set('x unified');\n            }\n        }\n\n        // Major enough changes deserve autoscale and\n        // non-reversed axes so people don't get confused\n        //\n        // Note: autobin (or its new analog bin clearing) is not included here\n        // since we're not pushing bins back to gd.data, so if we have bin\n        // info it was explicitly provided by the user.\n        if(['orientation', 'type'].indexOf(ai) !== -1) {\n            axlist = [];\n            for(i = 0; i < traces.length; i++) {\n                var trace = data[traces[i]];\n\n                if(Registry.traceIs(trace, 'cartesian')) {\n                    addToAxlist(trace.xaxis || 'x');\n                    addToAxlist(trace.yaxis || 'y');\n                }\n            }\n\n            doextra(axlist.map(autorangeAttr), true, 0);\n            doextra(axlist.map(rangeAttr), [0, 1], 0);\n        }\n    }\n\n    if(flags.calc || flags.plot) {\n        flags.fullReplot = true;\n    }\n\n    return {\n        flags: flags,\n        undoit: undoit,\n        redoit: redoit,\n        traces: traces,\n        eventData: Lib.extendDeepNoArrays([], [eventData, traces])\n    };\n}\n\n/**\n * Converts deprecated attribute keys to\n * the current API to ensure backwards compatibility.\n *\n * This is needed for the update mechanism to determine which\n * subroutines to run based on the actual attribute\n * definitions (that don't include the deprecated ones).\n *\n * E.g. Maps {'xaxis.title': 'A chart'} to {'xaxis.title.text': 'A chart'}\n * and {titlefont: {...}} to {'title.font': {...}}.\n *\n * @param aobj\n */\nfunction cleanDeprecatedAttributeKeys(aobj) {\n    var oldAxisTitleRegex = Lib.counterRegex('axis', '\\.title', false, false);\n    var colorbarRegex = /colorbar\\.title$/;\n    var keys = Object.keys(aobj);\n    var i, key, value;\n\n    for(i = 0; i < keys.length; i++) {\n        key = keys[i];\n        value = aobj[key];\n\n        if((key === 'title' || oldAxisTitleRegex.test(key) || colorbarRegex.test(key)) &&\n          (typeof value === 'string' || typeof value === 'number')) {\n            replace(key, key.replace('title', 'title.text'));\n        } else if(key.indexOf('titlefont') > -1) {\n            replace(key, key.replace('titlefont', 'title.font'));\n        } else if(key.indexOf('titleposition') > -1) {\n            replace(key, key.replace('titleposition', 'title.position'));\n        } else if(key.indexOf('titleside') > -1) {\n            replace(key, key.replace('titleside', 'title.side'));\n        } else if(key.indexOf('titleoffset') > -1) {\n            replace(key, key.replace('titleoffset', 'title.offset'));\n        }\n    }\n\n    function replace(oldAttrStr, newAttrStr) {\n        aobj[newAttrStr] = aobj[oldAttrStr];\n        delete aobj[oldAttrStr];\n    }\n}\n\n/**\n * relayout: update layout attributes of an existing plot\n *\n * Can be called two ways:\n *\n * Signature 1:\n * @param {String | HTMLDivElement} gd\n *  the id or dom element of the graph container div\n * @param {String} astr\n *  attribute string (like `'xaxis.range[0]'`) to update\n * @param {*} val\n *  value to give this attribute\n *\n * Signature 2:\n * @param {String | HTMLDivElement} gd\n *  (as in signature 1)\n * @param {Object} aobj\n *  attribute object `{astr1: val1, astr2: val2 ...}`\n *  allows setting multiple attributes simultaneously\n */\nfunction relayout(gd, astr, val) {\n    gd = Lib.getGraphDiv(gd);\n    helpers.clearPromiseQueue(gd);\n\n    var aobj = {};\n    if(typeof astr === 'string') {\n        aobj[astr] = val;\n    } else if(Lib.isPlainObject(astr)) {\n        aobj = Lib.extendFlat({}, astr);\n    } else {\n        Lib.warn('Relayout fail.', astr, val);\n        return Promise.reject();\n    }\n\n    if(Object.keys(aobj).length) gd.changed = true;\n\n    var specs = _relayout(gd, aobj);\n    var flags = specs.flags;\n\n    // clear calcdata if required\n    if(flags.calc) gd.calcdata = undefined;\n\n    // fill in redraw sequence\n\n    // even if we don't have anything left in aobj,\n    // something may have happened within relayout that we\n    // need to wait for\n    var seq = [Plots.previousPromises];\n\n    if(flags.layoutReplot) {\n        seq.push(subroutines.layoutReplot);\n    } else if(Object.keys(aobj).length) {\n        axRangeSupplyDefaultsByPass(gd, flags, specs) || Plots.supplyDefaults(gd);\n\n        if(flags.legend) seq.push(subroutines.doLegend);\n        if(flags.layoutstyle) seq.push(subroutines.layoutStyles);\n        if(flags.axrange) addAxRangeSequence(seq, specs.rangesAltered);\n        if(flags.ticks) seq.push(subroutines.doTicksRelayout);\n        if(flags.modebar) seq.push(subroutines.doModeBar);\n        if(flags.camera) seq.push(subroutines.doCamera);\n        if(flags.colorbars) seq.push(subroutines.doColorBars);\n\n        seq.push(emitAfterPlot);\n    }\n\n    seq.push(Plots.rehover, Plots.redrag);\n\n    Queue.add(gd,\n        relayout, [gd, specs.undoit],\n        relayout, [gd, specs.redoit]\n    );\n\n    var plotDone = Lib.syncOrAsync(seq, gd);\n    if(!plotDone || !plotDone.then) plotDone = Promise.resolve(gd);\n\n    return plotDone.then(function() {\n        gd.emit('plotly_relayout', specs.eventData);\n        return gd;\n    });\n}\n\n// Optimization mostly for large splom traces where\n// Plots.supplyDefaults can take > 100ms\nfunction axRangeSupplyDefaultsByPass(gd, flags, specs) {\n    var fullLayout = gd._fullLayout;\n\n    if(!flags.axrange) return false;\n\n    for(var k in flags) {\n        if(k !== 'axrange' && flags[k]) return false;\n    }\n\n    for(var axId in specs.rangesAltered) {\n        var axName = Axes.id2name(axId);\n        var axIn = gd.layout[axName];\n        var axOut = fullLayout[axName];\n        axOut.autorange = axIn.autorange;\n        if(axIn.range) {\n            axOut.range = axIn.range.slice();\n        }\n        axOut.cleanRange();\n\n        if(axOut._matchGroup) {\n            for(var axId2 in axOut._matchGroup) {\n                if(axId2 !== axId) {\n                    var ax2 = fullLayout[Axes.id2name(axId2)];\n                    ax2.autorange = axOut.autorange;\n                    ax2.range = axOut.range.slice();\n                    ax2._input.range = axOut.range.slice();\n                }\n            }\n        }\n    }\n\n    return true;\n}\n\nfunction addAxRangeSequence(seq, rangesAltered) {\n    // N.B. leave as sequence of subroutines (for now) instead of\n    // subroutine of its own so that finalDraw always gets\n    // executed after drawData\n    var drawAxes = rangesAltered ?\n        function(gd) {\n            var axIds = [];\n            var skipTitle = true;\n\n            for(var id in rangesAltered) {\n                var ax = Axes.getFromId(gd, id);\n                axIds.push(id);\n\n                if((ax.ticklabelposition || '').indexOf('inside') !== -1) {\n                    if(ax._anchorAxis) {\n                        axIds.push(ax._anchorAxis._id);\n                    }\n                }\n\n                if(ax._matchGroup) {\n                    for(var id2 in ax._matchGroup) {\n                        if(!rangesAltered[id2]) {\n                            axIds.push(id2);\n                        }\n                    }\n                }\n\n                if(ax.automargin) skipTitle = false;\n            }\n\n            return Axes.draw(gd, axIds, {skipTitle: skipTitle});\n        } :\n        function(gd) {\n            return Axes.draw(gd, 'redraw');\n        };\n\n    seq.push(\n        clearSelect,\n        subroutines.doAutoRangeAndConstraints,\n        drawAxes,\n        subroutines.drawData,\n        subroutines.finalDraw\n    );\n}\n\nvar AX_RANGE_RE = /^[xyz]axis[0-9]*\\.range(\\[[0|1]\\])?$/;\nvar AX_AUTORANGE_RE = /^[xyz]axis[0-9]*\\.autorange$/;\nvar AX_DOMAIN_RE = /^[xyz]axis[0-9]*\\.domain(\\[[0|1]\\])?$/;\n\nfunction _relayout(gd, aobj) {\n    var layout = gd.layout;\n    var fullLayout = gd._fullLayout;\n    var guiEditFlag = fullLayout._guiEditing;\n    var layoutNP = makeNP(fullLayout._preGUI, guiEditFlag);\n    var keys = Object.keys(aobj);\n    var axes = Axes.list(gd);\n    var eventData = Lib.extendDeepAll({}, aobj);\n    var arrayEdits = {};\n\n    var arrayStr, i, j;\n\n    cleanDeprecatedAttributeKeys(aobj);\n    keys = Object.keys(aobj);\n\n    // look for 'allaxes', split out into all axes\n    // in case of 3D the axis are nested within a scene which is held in _id\n    for(i = 0; i < keys.length; i++) {\n        if(keys[i].indexOf('allaxes') === 0) {\n            for(j = 0; j < axes.length; j++) {\n                var scene = axes[j]._id.substr(1);\n                var axisAttr = (scene.indexOf('scene') !== -1) ? (scene + '.') : '';\n                var newkey = keys[i].replace('allaxes', axisAttr + axes[j]._name);\n\n                if(!aobj[newkey]) aobj[newkey] = aobj[keys[i]];\n            }\n\n            delete aobj[keys[i]];\n        }\n    }\n\n    // initialize flags\n    var flags = editTypes.layoutFlags();\n\n    // copies of the change (and previous values of anything affected)\n    // for the undo / redo queue\n    var redoit = {};\n    var undoit = {};\n\n    // for attrs that interact (like scales & autoscales), save the\n    // old vals before making the change\n    // val=undefined will not set a value, just record what the value was.\n    // attr can be an array to set several at once (all to the same val)\n    function doextra(attr, val) {\n        if(Array.isArray(attr)) {\n            attr.forEach(function(a) { doextra(a, val); });\n            return;\n        }\n\n        // if we have another value for this attribute (explicitly or\n        // via a parent) do not override with this auto-generated extra\n        if(attr in aobj || helpers.hasParent(aobj, attr)) return;\n\n        var p = layoutNP(layout, attr);\n        if(!(attr in undoit)) {\n            undoit[attr] = undefinedToNull(p.get());\n        }\n        if(val !== undefined) p.set(val);\n    }\n\n    // for constraint enforcement: keep track of all axes (as {id: name})\n    // we're editing the (auto)range of, so we can tell the others constrained\n    // to scale with them that it's OK for them to shrink\n    var rangesAltered = {};\n    var ax;\n\n    function recordAlteredAxis(pleafPlus) {\n        var axId = Axes.name2id(pleafPlus.split('.')[0]);\n        rangesAltered[axId] = 1;\n        return axId;\n    }\n\n    // alter gd.layout\n    for(var ai in aobj) {\n        if(helpers.hasParent(aobj, ai)) {\n            throw new Error('cannot set ' + ai + ' and a parent attribute simultaneously');\n        }\n\n        var p = layoutNP(layout, ai);\n        var vi = aobj[ai];\n        var plen = p.parts.length;\n        // p.parts may end with an index integer if the property is an array\n        var pend = plen - 1;\n        while(pend > 0 && typeof p.parts[pend] !== 'string') pend--;\n        // last property in chain (leaf node)\n        var pleaf = p.parts[pend];\n        // leaf plus immediate parent\n        var pleafPlus = p.parts[pend - 1] + '.' + pleaf;\n        // trunk nodes (everything except the leaf)\n        var ptrunk = p.parts.slice(0, pend).join('.');\n        var parentIn = nestedProperty(gd.layout, ptrunk).get();\n        var parentFull = nestedProperty(fullLayout, ptrunk).get();\n        var vOld = p.get();\n\n        if(vi === undefined) continue;\n\n        redoit[ai] = vi;\n\n        // axis reverse is special - it is its own inverse\n        // op and has no flag.\n        undoit[ai] = (pleaf === 'reverse') ? vi : undefinedToNull(vOld);\n\n        var valObject = PlotSchema.getLayoutValObject(fullLayout, p.parts);\n\n        if(valObject && valObject.impliedEdits && vi !== null) {\n            for(var impliedKey in valObject.impliedEdits) {\n                doextra(Lib.relativeAttr(ai, impliedKey), valObject.impliedEdits[impliedKey]);\n            }\n        }\n\n        // Setting width or height to null must reset the graph's width / height\n        // back to its initial value as computed during the first pass in Plots.plotAutoSize.\n        //\n        // To do so, we must manually set them back here using the _initialAutoSize cache.\n        // can't use impliedEdits for this because behavior depends on vi\n        if(['width', 'height'].indexOf(ai) !== -1) {\n            if(vi) {\n                doextra('autosize', null);\n                // currently we don't support autosize one dim only - so\n                // explicitly set the other one. Note that doextra will\n                // ignore this if the same relayout call also provides oppositeAttr\n                var oppositeAttr = ai === 'height' ? 'width' : 'height';\n                doextra(oppositeAttr, fullLayout[oppositeAttr]);\n            } else {\n                fullLayout[ai] = gd._initialAutoSize[ai];\n            }\n        } else if(ai === 'autosize') {\n            // depends on vi here too, so again can't use impliedEdits\n            doextra('width', vi ? null : fullLayout.width);\n            doextra('height', vi ? null : fullLayout.height);\n        } else if(pleafPlus.match(AX_RANGE_RE)) {\n            // check autorange vs range\n\n            recordAlteredAxis(pleafPlus);\n            nestedProperty(fullLayout, ptrunk + '._inputRange').set(null);\n        } else if(pleafPlus.match(AX_AUTORANGE_RE)) {\n            recordAlteredAxis(pleafPlus);\n            nestedProperty(fullLayout, ptrunk + '._inputRange').set(null);\n            var axFull = nestedProperty(fullLayout, ptrunk).get();\n            if(axFull._inputDomain) {\n                // if we're autoranging and this axis has a constrained domain,\n                // reset it so we don't get locked into a shrunken size\n                axFull._input.domain = axFull._inputDomain.slice();\n            }\n        } else if(pleafPlus.match(AX_DOMAIN_RE)) {\n            nestedProperty(fullLayout, ptrunk + '._inputDomain').set(null);\n        }\n\n        // toggling axis type between log and linear: we need to convert\n        // positions for components that are still using linearized values,\n        // not data values like newer components.\n        // previously we did this for log <-> not-log, but now only do it\n        // for log <-> linear\n        if(pleaf === 'type') {\n            ax = parentIn;\n            var toLog = parentFull.type === 'linear' && vi === 'log';\n            var fromLog = parentFull.type === 'log' && vi === 'linear';\n\n            if(toLog || fromLog) {\n                if(!ax || !ax.range) {\n                    // 2D never gets here, but 3D does\n                    // I don't think this is needed, but left here in case there\n                    // are edge cases I'm not thinking of.\n                    doextra(ptrunk + '.autorange', true);\n                } else if(!parentFull.autorange) {\n                    // toggling log without autorange: need to also recalculate ranges\n                    // because log axes use linearized values for range endpoints\n                    var r0 = ax.range[0];\n                    var r1 = ax.range[1];\n                    if(toLog) {\n                        // if both limits are negative, autorange\n                        if(r0 <= 0 && r1 <= 0) {\n                            doextra(ptrunk + '.autorange', true);\n                        }\n                        // if one is negative, set it 6 orders below the other.\n                        if(r0 <= 0) r0 = r1 / 1e6;\n                        else if(r1 <= 0) r1 = r0 / 1e6;\n                        // now set the range values as appropriate\n                        doextra(ptrunk + '.range[0]', Math.log(r0) / Math.LN10);\n                        doextra(ptrunk + '.range[1]', Math.log(r1) / Math.LN10);\n                    } else {\n                        doextra(ptrunk + '.range[0]', Math.pow(10, r0));\n                        doextra(ptrunk + '.range[1]', Math.pow(10, r1));\n                    }\n                } else if(toLog) {\n                    // just make sure the range is positive and in the right\n                    // order, it'll get recalculated later\n                    ax.range = (ax.range[1] > ax.range[0]) ? [1, 2] : [2, 1];\n                }\n\n                // clear polar view initial stash for radial range so that\n                // value get recomputed in correct units\n                if(Array.isArray(fullLayout._subplots.polar) &&\n                    fullLayout._subplots.polar.length &&\n                    fullLayout[p.parts[0]] &&\n                    p.parts[1] === 'radialaxis'\n                ) {\n                    delete fullLayout[p.parts[0]]._subplot.viewInitial['radialaxis.range'];\n                }\n\n                // Annotations and images also need to convert to/from linearized coords\n                // Shapes do not need this :)\n                Registry.getComponentMethod('annotations', 'convertCoords')(gd, parentFull, vi, doextra);\n                Registry.getComponentMethod('images', 'convertCoords')(gd, parentFull, vi, doextra);\n            } else {\n                // any other type changes: the range from the previous type\n                // will not make sense, so autorange it.\n                doextra(ptrunk + '.autorange', true);\n                doextra(ptrunk + '.range', null);\n            }\n            nestedProperty(fullLayout, ptrunk + '._inputRange').set(null);\n        } else if(pleaf.match(AX_NAME_PATTERN)) {\n            var fullProp = nestedProperty(fullLayout, ai).get();\n            var newType = (vi || {}).type;\n\n            // This can potentially cause strange behavior if the autotype is not\n            // numeric (linear, because we don't auto-log) but the previous type\n            // was log. That's a very strange edge case though\n            if(!newType || newType === '-') newType = 'linear';\n            Registry.getComponentMethod('annotations', 'convertCoords')(gd, fullProp, newType, doextra);\n            Registry.getComponentMethod('images', 'convertCoords')(gd, fullProp, newType, doextra);\n        }\n\n        // alter gd.layout\n\n        // collect array component edits for execution all together\n        // so we can ensure consistent behavior adding/removing items\n        // and order-independence for add/remove/edit all together in\n        // one relayout call\n        var containerArrayMatch = manageArrays.containerArrayMatch(ai);\n        if(containerArrayMatch) {\n            arrayStr = containerArrayMatch.array;\n            i = containerArrayMatch.index;\n            var propStr = containerArrayMatch.property;\n            var updateValObject = valObject || {editType: 'calc'};\n\n            if(i !== '' && propStr === '') {\n                // special handling of undoit if we're adding or removing an element\n                // ie 'annotations[2]' which can be {...} (add) or null,\n                // does not work when replacing the entire array\n                if(manageArrays.isAddVal(vi)) {\n                    undoit[ai] = null;\n                } else if(manageArrays.isRemoveVal(vi)) {\n                    undoit[ai] = (nestedProperty(layout, arrayStr).get() || [])[i];\n                } else {\n                    Lib.warn('unrecognized full object value', aobj);\n                }\n            }\n            editTypes.update(flags, updateValObject);\n\n            // prepare the edits object we'll send to applyContainerArrayChanges\n            if(!arrayEdits[arrayStr]) arrayEdits[arrayStr] = {};\n            var objEdits = arrayEdits[arrayStr][i];\n            if(!objEdits) objEdits = arrayEdits[arrayStr][i] = {};\n            objEdits[propStr] = vi;\n\n            delete aobj[ai];\n        } else if(pleaf === 'reverse') {\n            // handle axis reversal explicitly, as there's no 'reverse' attribute\n\n            if(parentIn.range) parentIn.range.reverse();\n            else {\n                doextra(ptrunk + '.autorange', true);\n                parentIn.range = [1, 0];\n            }\n\n            if(parentFull.autorange) flags.calc = true;\n            else flags.plot = true;\n        } else {\n            if((fullLayout._has('scatter-like') && fullLayout._has('regl')) &&\n                (ai === 'dragmode' &&\n                (vi === 'lasso' || vi === 'select') &&\n                !(vOld === 'lasso' || vOld === 'select'))\n            ) {\n                flags.plot = true;\n            } else if(fullLayout._has('gl2d')) {\n                flags.plot = true;\n            } else if(valObject) editTypes.update(flags, valObject);\n            else flags.calc = true;\n\n            p.set(vi);\n        }\n    }\n\n    // now we've collected component edits - execute them all together\n    for(arrayStr in arrayEdits) {\n        var finished = manageArrays.applyContainerArrayChanges(gd,\n            layoutNP(layout, arrayStr), arrayEdits[arrayStr], flags, layoutNP);\n        if(!finished) flags.plot = true;\n    }\n\n    // figure out if we need to recalculate axis constraints\n    for(var axId in rangesAltered) {\n        ax = Axes.getFromId(gd, axId);\n        var group = ax && ax._constraintGroup;\n        if(group) {\n            // Always recalc if we're changing constrained ranges.\n            // Otherwise it's possible to violate the constraints by\n            // specifying arbitrary ranges for all axes in the group.\n            // this way some ranges may expand beyond what's specified,\n            // as they do at first draw, to satisfy the constraints.\n            flags.calc = true;\n            for(var groupAxId in group) {\n                if(!rangesAltered[groupAxId]) {\n                    Axes.getFromId(gd, groupAxId)._constraintShrinkable = true;\n                }\n            }\n        }\n    }\n\n    // If the autosize changed or height or width was explicitly specified,\n    // this triggers a redraw\n    // TODO: do we really need special aobj.height/width handling here?\n    // couldn't editType do this?\n    if(updateAutosize(gd) || aobj.height || aobj.width) flags.plot = true;\n\n    if(flags.plot || flags.calc) {\n        flags.layoutReplot = true;\n    }\n\n    // now all attribute mods are done, as are\n    // redo and undo so we can save them\n\n    return {\n        flags: flags,\n        rangesAltered: rangesAltered,\n        undoit: undoit,\n        redoit: redoit,\n        eventData: eventData\n    };\n}\n\n/*\n * updateAutosize: we made a change, does it change the autosize result?\n * puts the new size into fullLayout\n * returns true if either height or width changed\n */\nfunction updateAutosize(gd) {\n    var fullLayout = gd._fullLayout;\n    var oldWidth = fullLayout.width;\n    var oldHeight = fullLayout.height;\n\n    // calculate autosizing\n    if(gd.layout.autosize) Plots.plotAutoSize(gd, gd.layout, fullLayout);\n\n    return (fullLayout.width !== oldWidth) || (fullLayout.height !== oldHeight);\n}\n\n/**\n * update: update trace and layout attributes of an existing plot\n *\n * @param {String | HTMLDivElement} gd\n *  the id or DOM element of the graph container div\n * @param {Object} traceUpdate\n *  attribute object `{astr1: val1, astr2: val2 ...}`\n *  corresponding to updates in the plot's traces\n * @param {Object} layoutUpdate\n *  attribute object `{astr1: val1, astr2: val2 ...}`\n *  corresponding to updates in the plot's layout\n * @param {Number[] | Number} [traces]\n *  integer or array of integers for the traces to alter (all if omitted)\n *\n */\nfunction update(gd, traceUpdate, layoutUpdate, _traces) {\n    gd = Lib.getGraphDiv(gd);\n    helpers.clearPromiseQueue(gd);\n\n    if(!Lib.isPlainObject(traceUpdate)) traceUpdate = {};\n    if(!Lib.isPlainObject(layoutUpdate)) layoutUpdate = {};\n\n    if(Object.keys(traceUpdate).length) gd.changed = true;\n    if(Object.keys(layoutUpdate).length) gd.changed = true;\n\n    var traces = helpers.coerceTraceIndices(gd, _traces);\n\n    var restyleSpecs = _restyle(gd, Lib.extendFlat({}, traceUpdate), traces);\n    var restyleFlags = restyleSpecs.flags;\n\n    var relayoutSpecs = _relayout(gd, Lib.extendFlat({}, layoutUpdate));\n    var relayoutFlags = relayoutSpecs.flags;\n\n    // clear calcdata and/or axis types if required\n    if(restyleFlags.calc || relayoutFlags.calc) gd.calcdata = undefined;\n    if(restyleFlags.clearAxisTypes) helpers.clearAxisTypes(gd, traces, layoutUpdate);\n\n    // fill in redraw sequence\n    var seq = [];\n\n    if(relayoutFlags.layoutReplot) {\n        // N.B. works fine when both\n        // relayoutFlags.layoutReplot and restyleFlags.fullReplot are true\n        seq.push(subroutines.layoutReplot);\n    } else if(restyleFlags.fullReplot) {\n        seq.push(exports._doPlot);\n    } else {\n        seq.push(Plots.previousPromises);\n        axRangeSupplyDefaultsByPass(gd, relayoutFlags, relayoutSpecs) || Plots.supplyDefaults(gd);\n\n        if(restyleFlags.style) seq.push(subroutines.doTraceStyle);\n        if(restyleFlags.colorbars || relayoutFlags.colorbars) seq.push(subroutines.doColorBars);\n        if(relayoutFlags.legend) seq.push(subroutines.doLegend);\n        if(relayoutFlags.layoutstyle) seq.push(subroutines.layoutStyles);\n        if(relayoutFlags.axrange) addAxRangeSequence(seq, relayoutSpecs.rangesAltered);\n        if(relayoutFlags.ticks) seq.push(subroutines.doTicksRelayout);\n        if(relayoutFlags.modebar) seq.push(subroutines.doModeBar);\n        if(relayoutFlags.camera) seq.push(subroutines.doCamera);\n\n        seq.push(emitAfterPlot);\n    }\n\n    seq.push(Plots.rehover, Plots.redrag);\n\n    Queue.add(gd,\n        update, [gd, restyleSpecs.undoit, relayoutSpecs.undoit, restyleSpecs.traces],\n        update, [gd, restyleSpecs.redoit, relayoutSpecs.redoit, restyleSpecs.traces]\n    );\n\n    var plotDone = Lib.syncOrAsync(seq, gd);\n    if(!plotDone || !plotDone.then) plotDone = Promise.resolve(gd);\n\n    return plotDone.then(function() {\n        gd.emit('plotly_update', {\n            data: restyleSpecs.eventData,\n            layout: relayoutSpecs.eventData\n        });\n\n        return gd;\n    });\n}\n\n/*\n * internal-use-only restyle/relayout/update variants that record the initial\n * values in (fullLayout|fullTrace)._preGUI so changes can be persisted across\n * Plotly.react data updates, dependent on uirevision attributes\n */\nfunction guiEdit(func) {\n    return function wrappedEdit(gd) {\n        gd._fullLayout._guiEditing = true;\n        var p = func.apply(null, arguments);\n        gd._fullLayout._guiEditing = false;\n        return p;\n    };\n}\n\n// For connecting edited layout attributes to uirevision attrs\n// If no `attr` we use `match[1] + '.uirevision'`\n// Ordered by most common edits first, to minimize our search time\nvar layoutUIControlPatterns = [\n    {pattern: /^hiddenlabels/, attr: 'legend.uirevision'},\n    {pattern: /^((x|y)axis\\d*)\\.((auto)?range|title\\.text)/},\n\n    // showspikes and modes include those nested inside scenes\n    {pattern: /axis\\d*\\.showspikes$/, attr: 'modebar.uirevision'},\n    {pattern: /(hover|drag)mode$/, attr: 'modebar.uirevision'},\n\n    {pattern: /^(scene\\d*)\\.camera/},\n    {pattern: /^(geo\\d*)\\.(projection|center|fitbounds)/},\n    {pattern: /^(ternary\\d*\\.[abc]axis)\\.(min|title\\.text)$/},\n    {pattern: /^(polar\\d*\\.radialaxis)\\.((auto)?range|angle|title\\.text)/},\n    {pattern: /^(polar\\d*\\.angularaxis)\\.rotation/},\n    {pattern: /^(mapbox\\d*)\\.(center|zoom|bearing|pitch)/},\n\n    {pattern: /^legend\\.(x|y)$/, attr: 'editrevision'},\n    {pattern: /^(shapes|annotations)/, attr: 'editrevision'},\n    {pattern: /^title\\.text$/, attr: 'editrevision'}\n];\n\n// same for trace attributes: if `attr` is given it's in layout,\n// or with no `attr` we use `trace.uirevision`\nvar traceUIControlPatterns = [\n    {pattern: /^selectedpoints$/, attr: 'selectionrevision'},\n    // \"visible\" includes trace.transforms[i].styles[j].value.visible\n    {pattern: /(^|value\\.)visible$/, attr: 'legend.uirevision'},\n    {pattern: /^dimensions\\[\\d+\\]\\.constraintrange/},\n    {pattern: /^node\\.(x|y|groups)/}, // for Sankey nodes\n    {pattern: /^level$/}, // for Sunburst, Treemap and Icicle traces\n\n    // below this you must be in editable: true mode\n    // TODO: I still put name and title with `trace.uirevision`\n    // reasonable or should these be `editrevision`?\n    // Also applies to axis titles up in the layout section\n\n    // \"name\" also includes transform.styles\n    {pattern: /(^|value\\.)name$/},\n    // including nested colorbar attributes (ie marker.colorbar)\n    {pattern: /colorbar\\.title\\.text$/},\n    {pattern: /colorbar\\.(x|y)$/, attr: 'editrevision'}\n];\n\nfunction findUIPattern(key, patternSpecs) {\n    for(var i = 0; i < patternSpecs.length; i++) {\n        var spec = patternSpecs[i];\n        var match = key.match(spec.pattern);\n        if(match) {\n            return {head: match[1], attr: spec.attr};\n        }\n    }\n}\n\n// We're finding the new uirevision before supplyDefaults, so do the\n// inheritance manually. Note that only `undefined` inherits - other\n// falsy values are returned.\nfunction getNewRev(revAttr, container) {\n    var newRev = nestedProperty(container, revAttr).get();\n    if(newRev !== undefined) return newRev;\n\n    var parts = revAttr.split('.');\n    parts.pop();\n    while(parts.length > 1) {\n        parts.pop();\n        newRev = nestedProperty(container, parts.join('.') + '.uirevision').get();\n        if(newRev !== undefined) return newRev;\n    }\n\n    return container.uirevision;\n}\n\nfunction getFullTraceIndexFromUid(uid, fullData) {\n    for(var i = 0; i < fullData.length; i++) {\n        if(fullData[i]._fullInput.uid === uid) return i;\n    }\n    return -1;\n}\n\nfunction getTraceIndexFromUid(uid, data, tracei) {\n    for(var i = 0; i < data.length; i++) {\n        if(data[i].uid === uid) return i;\n    }\n    // fall back on trace order, but only if user didn't provide a uid for that trace\n    return (!data[tracei] || data[tracei].uid) ? -1 : tracei;\n}\n\nfunction valsMatch(v1, v2) {\n    var v1IsObj = Lib.isPlainObject(v1);\n    var v1IsArray = Array.isArray(v1);\n    if(v1IsObj || v1IsArray) {\n        return (\n            (v1IsObj && Lib.isPlainObject(v2)) ||\n            (v1IsArray && Array.isArray(v2))\n        ) && JSON.stringify(v1) === JSON.stringify(v2);\n    }\n    return v1 === v2;\n}\n\nfunction applyUIRevisions(data, layout, oldFullData, oldFullLayout) {\n    var layoutPreGUI = oldFullLayout._preGUI;\n    var key, revAttr, oldRev, newRev, match, preGUIVal, newNP, newVal;\n    var bothInheritAutorange = [];\n    var newRangeAccepted = {};\n    for(key in layoutPreGUI) {\n        match = findUIPattern(key, layoutUIControlPatterns);\n        if(match) {\n            revAttr = match.attr || (match.head + '.uirevision');\n            oldRev = nestedProperty(oldFullLayout, revAttr).get();\n            newRev = oldRev && getNewRev(revAttr, layout);\n            if(newRev && (newRev === oldRev)) {\n                preGUIVal = layoutPreGUI[key];\n                if(preGUIVal === null) preGUIVal = undefined;\n                newNP = nestedProperty(layout, key);\n                newVal = newNP.get();\n                if(valsMatch(newVal, preGUIVal)) {\n                    if(newVal === undefined && key.substr(key.length - 9) === 'autorange') {\n                        bothInheritAutorange.push(key.substr(0, key.length - 10));\n                    }\n                    newNP.set(undefinedToNull(nestedProperty(oldFullLayout, key).get()));\n                    continue;\n                }\n            }\n        } else {\n            Lib.warn('unrecognized GUI edit: ' + key);\n        }\n        // if we got this far, the new value was accepted as the new starting\n        // point (either because it changed or revision changed)\n        // so remove it from _preGUI for next time.\n        delete layoutPreGUI[key];\n\n        if(key.substr(key.length - 8, 6) === 'range[') {\n            newRangeAccepted[key.substr(0, key.length - 9)] = 1;\n        }\n    }\n\n    // Special logic for `autorange`, since it interacts with `range`:\n    // If the new figure's matching `range` was kept, and `autorange`\n    // wasn't supplied explicitly in either the original or the new figure,\n    // we shouldn't alter that - but we may just have done that, so fix it.\n    for(var i = 0; i < bothInheritAutorange.length; i++) {\n        var axAttr = bothInheritAutorange[i];\n        if(newRangeAccepted[axAttr]) {\n            var newAx = nestedProperty(layout, axAttr).get();\n            if(newAx) delete newAx.autorange;\n        }\n    }\n\n    // Now traces - try to match them up by uid (in case we added/deleted in\n    // the middle), then fall back on index.\n    var allTracePreGUI = oldFullLayout._tracePreGUI;\n    for(var uid in allTracePreGUI) {\n        var tracePreGUI = allTracePreGUI[uid];\n        var newTrace = null;\n        var fullInput;\n        for(key in tracePreGUI) {\n            // wait until we know we have preGUI values to look for traces\n            // but if we don't find both, stop looking at this uid\n            if(!newTrace) {\n                var fulli = getFullTraceIndexFromUid(uid, oldFullData);\n                if(fulli < 0) {\n                    // Somehow we didn't even have this trace in oldFullData...\n                    // I guess this could happen with `deleteTraces` or something\n                    delete allTracePreGUI[uid];\n                    break;\n                }\n                var fullTrace = oldFullData[fulli];\n                fullInput = fullTrace._fullInput;\n\n                var newTracei = getTraceIndexFromUid(uid, data, fullInput.index);\n                if(newTracei < 0) {\n                    // No match in new data\n                    delete allTracePreGUI[uid];\n                    break;\n                }\n                newTrace = data[newTracei];\n            }\n\n            match = findUIPattern(key, traceUIControlPatterns);\n            if(match) {\n                if(match.attr) {\n                    oldRev = nestedProperty(oldFullLayout, match.attr).get();\n                    newRev = oldRev && getNewRev(match.attr, layout);\n                } else {\n                    oldRev = fullInput.uirevision;\n                    // inheritance for trace.uirevision is simple, just layout.uirevision\n                    newRev = newTrace.uirevision;\n                    if(newRev === undefined) newRev = layout.uirevision;\n                }\n\n                if(newRev && newRev === oldRev) {\n                    preGUIVal = tracePreGUI[key];\n                    if(preGUIVal === null) preGUIVal = undefined;\n                    newNP = nestedProperty(newTrace, key);\n                    newVal = newNP.get();\n                    if(valsMatch(newVal, preGUIVal)) {\n                        newNP.set(undefinedToNull(nestedProperty(fullInput, key).get()));\n                        continue;\n                    }\n                }\n            } else {\n                Lib.warn('unrecognized GUI edit: ' + key + ' in trace uid ' + uid);\n            }\n            delete tracePreGUI[key];\n        }\n    }\n}\n\n/**\n * Plotly.react:\n * A plot/update method that takes the full plot state (same API as plot/newPlot)\n * and diffs to determine the minimal update pathway\n *\n * @param {string id or DOM element} gd\n *      the id or DOM element of the graph container div\n * @param {array of objects} data\n *      array of traces, containing the data and display information for each trace\n * @param {object} layout\n *      object describing the overall display of the plot,\n *      all the stuff that doesn't pertain to any individual trace\n * @param {object} config\n *      configuration options (see ./plot_config.js for more info)\n *\n * OR\n *\n * @param {string id or DOM element} gd\n *      the id or DOM element of the graph container div\n * @param {object} figure\n *      object containing `data`, `layout`, `config`, and `frames` members\n *\n */\nfunction react(gd, data, layout, config) {\n    var frames, plotDone;\n\n    function addFrames() { return exports.addFrames(gd, frames); }\n\n    gd = Lib.getGraphDiv(gd);\n    helpers.clearPromiseQueue(gd);\n\n    var oldFullData = gd._fullData;\n    var oldFullLayout = gd._fullLayout;\n\n    // you can use this as the initial draw as well as to update\n    if(!Lib.isPlotDiv(gd) || !oldFullData || !oldFullLayout) {\n        plotDone = exports.newPlot(gd, data, layout, config);\n    } else {\n        if(Lib.isPlainObject(data)) {\n            var obj = data;\n            data = obj.data;\n            layout = obj.layout;\n            config = obj.config;\n            frames = obj.frames;\n        }\n\n        var configChanged = false;\n        // assume that if there's a config at all, we're reacting to it too,\n        // and completely replace the previous config\n        if(config) {\n            var oldConfig = Lib.extendDeep({}, gd._context);\n            gd._context = undefined;\n            setPlotContext(gd, config);\n            configChanged = diffConfig(oldConfig, gd._context);\n        }\n\n        gd.data = data || [];\n        helpers.cleanData(gd.data);\n        gd.layout = layout || {};\n        helpers.cleanLayout(gd.layout);\n\n        applyUIRevisions(gd.data, gd.layout, oldFullData, oldFullLayout);\n\n        // \"true\" skips updating calcdata and remapping arrays from calcTransforms,\n        // which supplyDefaults usually does at the end, but we may need to NOT do\n        // if the diff (which we haven't determined yet) says we'll recalc\n        Plots.supplyDefaults(gd, {skipUpdateCalc: true});\n\n        var newFullData = gd._fullData;\n        var newFullLayout = gd._fullLayout;\n        var immutable = newFullLayout.datarevision === undefined;\n        var transition = newFullLayout.transition;\n\n        var relayoutFlags = diffLayout(gd, oldFullLayout, newFullLayout, immutable, transition);\n        var newDataRevision = relayoutFlags.newDataRevision;\n        var restyleFlags = diffData(gd, oldFullData, newFullData, immutable, transition, newDataRevision);\n\n        // TODO: how to translate this part of relayout to Plotly.react?\n        // // Setting width or height to null must reset the graph's width / height\n        // // back to its initial value as computed during the first pass in Plots.plotAutoSize.\n        // //\n        // // To do so, we must manually set them back here using the _initialAutoSize cache.\n        // if(['width', 'height'].indexOf(ai) !== -1 && vi === null) {\n        //     fullLayout[ai] = gd._initialAutoSize[ai];\n        // }\n\n        if(updateAutosize(gd)) relayoutFlags.layoutReplot = true;\n\n        // clear calcdata and empty categories if required\n        if(restyleFlags.calc || relayoutFlags.calc) {\n            gd.calcdata = undefined;\n            var allNames = Object.getOwnPropertyNames(newFullLayout);\n            for(var q = 0; q < allNames.length; q++) {\n                var name = allNames[q];\n                var start = name.substring(0, 5);\n                if(start === 'xaxis' || start === 'yaxis') {\n                    var emptyCategories = newFullLayout[name]._emptyCategories;\n                    if(emptyCategories) emptyCategories();\n                }\n            }\n        // otherwise do the calcdata updates and calcTransform array remaps that we skipped earlier\n        } else {\n            Plots.supplyDefaultsUpdateCalc(gd.calcdata, newFullData);\n        }\n\n        // Note: what restyle/relayout use impliedEdits and clearAxisTypes for\n        // must be handled by the user when using Plotly.react.\n\n        // fill in redraw sequence\n        var seq = [];\n\n        if(frames) {\n            gd._transitionData = {};\n            Plots.createTransitionData(gd);\n            seq.push(addFrames);\n        }\n\n        // Transition pathway,\n        // only used when 'transition' is set by user and\n        // when at least one animatable attribute has changed,\n        // N.B. config changed aren't animatable\n        if(newFullLayout.transition && !configChanged && (restyleFlags.anim || relayoutFlags.anim)) {\n            if(relayoutFlags.ticks) seq.push(subroutines.doTicksRelayout);\n\n            Plots.doCalcdata(gd);\n            subroutines.doAutoRangeAndConstraints(gd);\n\n            seq.push(function() {\n                return Plots.transitionFromReact(gd, restyleFlags, relayoutFlags, oldFullLayout);\n            });\n        } else if(restyleFlags.fullReplot || relayoutFlags.layoutReplot || configChanged) {\n            gd._fullLayout._skipDefaults = true;\n            seq.push(exports._doPlot);\n        } else {\n            for(var componentType in relayoutFlags.arrays) {\n                var indices = relayoutFlags.arrays[componentType];\n                if(indices.length) {\n                    var drawOne = Registry.getComponentMethod(componentType, 'drawOne');\n                    if(drawOne !== Lib.noop) {\n                        for(var i = 0; i < indices.length; i++) {\n                            drawOne(gd, indices[i]);\n                        }\n                    } else {\n                        var draw = Registry.getComponentMethod(componentType, 'draw');\n                        if(draw === Lib.noop) {\n                            throw new Error('cannot draw components: ' + componentType);\n                        }\n                        draw(gd);\n                    }\n                }\n            }\n\n            seq.push(Plots.previousPromises);\n            if(restyleFlags.style) seq.push(subroutines.doTraceStyle);\n            if(restyleFlags.colorbars || relayoutFlags.colorbars) seq.push(subroutines.doColorBars);\n            if(relayoutFlags.legend) seq.push(subroutines.doLegend);\n            if(relayoutFlags.layoutstyle) seq.push(subroutines.layoutStyles);\n            if(relayoutFlags.axrange) addAxRangeSequence(seq);\n            if(relayoutFlags.ticks) seq.push(subroutines.doTicksRelayout);\n            if(relayoutFlags.modebar) seq.push(subroutines.doModeBar);\n            if(relayoutFlags.camera) seq.push(subroutines.doCamera);\n            seq.push(emitAfterPlot);\n        }\n\n        seq.push(Plots.rehover, Plots.redrag);\n\n        plotDone = Lib.syncOrAsync(seq, gd);\n        if(!plotDone || !plotDone.then) plotDone = Promise.resolve(gd);\n    }\n\n    return plotDone.then(function() {\n        gd.emit('plotly_react', {\n            data: data,\n            layout: layout\n        });\n\n        return gd;\n    });\n}\n\nfunction diffData(gd, oldFullData, newFullData, immutable, transition, newDataRevision) {\n    var sameTraceLength = oldFullData.length === newFullData.length;\n\n    if(!transition && !sameTraceLength) {\n        return {\n            fullReplot: true,\n            calc: true\n        };\n    }\n\n    var flags = editTypes.traceFlags();\n    flags.arrays = {};\n    flags.nChanges = 0;\n    flags.nChangesAnim = 0;\n\n    var i, trace;\n\n    function getTraceValObject(parts) {\n        var out = PlotSchema.getTraceValObject(trace, parts);\n        if(!trace._module.animatable && out.anim) {\n            out.anim = false;\n        }\n        return out;\n    }\n\n    var diffOpts = {\n        getValObject: getTraceValObject,\n        flags: flags,\n        immutable: immutable,\n        transition: transition,\n        newDataRevision: newDataRevision,\n        gd: gd\n    };\n\n    var seenUIDs = {};\n\n    for(i = 0; i < oldFullData.length; i++) {\n        if(newFullData[i]) {\n            trace = newFullData[i]._fullInput;\n            if(Plots.hasMakesDataTransform(trace)) trace = newFullData[i];\n            if(seenUIDs[trace.uid]) continue;\n            seenUIDs[trace.uid] = 1;\n\n            getDiffFlags(oldFullData[i]._fullInput, trace, [], diffOpts);\n        }\n    }\n\n    if(flags.calc || flags.plot) {\n        flags.fullReplot = true;\n    }\n\n    if(transition && flags.nChanges && flags.nChangesAnim) {\n        flags.anim = (flags.nChanges === flags.nChangesAnim) && sameTraceLength ? 'all' : 'some';\n    }\n\n    return flags;\n}\n\nfunction diffLayout(gd, oldFullLayout, newFullLayout, immutable, transition) {\n    var flags = editTypes.layoutFlags();\n    flags.arrays = {};\n    flags.rangesAltered = {};\n    flags.nChanges = 0;\n    flags.nChangesAnim = 0;\n\n    function getLayoutValObject(parts) {\n        return PlotSchema.getLayoutValObject(newFullLayout, parts);\n    }\n\n    var diffOpts = {\n        getValObject: getLayoutValObject,\n        flags: flags,\n        immutable: immutable,\n        transition: transition,\n        gd: gd\n    };\n\n    getDiffFlags(oldFullLayout, newFullLayout, [], diffOpts);\n\n    if(flags.plot || flags.calc) {\n        flags.layoutReplot = true;\n    }\n\n    if(transition && flags.nChanges && flags.nChangesAnim) {\n        flags.anim = flags.nChanges === flags.nChangesAnim ? 'all' : 'some';\n    }\n\n    return flags;\n}\n\nfunction getDiffFlags(oldContainer, newContainer, outerparts, opts) {\n    var valObject, key, astr;\n\n    var getValObject = opts.getValObject;\n    var flags = opts.flags;\n    var immutable = opts.immutable;\n    var inArray = opts.inArray;\n    var arrayIndex = opts.arrayIndex;\n\n    function changed() {\n        var editType = valObject.editType;\n        if(inArray && editType.indexOf('arraydraw') !== -1) {\n            Lib.pushUnique(flags.arrays[inArray], arrayIndex);\n            return;\n        }\n        editTypes.update(flags, valObject);\n\n        if(editType !== 'none') {\n            flags.nChanges++;\n        }\n\n        // track animatable changes\n        if(opts.transition && valObject.anim) {\n            flags.nChangesAnim++;\n        }\n\n        // track cartesian axes with altered ranges\n        if(AX_RANGE_RE.test(astr) || AX_AUTORANGE_RE.test(astr)) {\n            flags.rangesAltered[outerparts[0]] = 1;\n        }\n\n        // clear _inputDomain on cartesian axes with altered domains\n        if(AX_DOMAIN_RE.test(astr)) {\n            nestedProperty(newContainer, '_inputDomain').set(null);\n        }\n\n        // track datarevision changes\n        if(key === 'datarevision') {\n            flags.newDataRevision = 1;\n        }\n    }\n\n    function valObjectCanBeDataArray(valObject) {\n        return valObject.valType === 'data_array' || valObject.arrayOk;\n    }\n\n    for(key in oldContainer) {\n        // short-circuit based on previous calls or previous keys that already maximized the pathway\n        if(flags.calc && !opts.transition) return;\n\n        var oldVal = oldContainer[key];\n        var newVal = newContainer[key];\n        var parts = outerparts.concat(key);\n        astr = parts.join('.');\n\n        if(key.charAt(0) === '_' || typeof oldVal === 'function' || oldVal === newVal) continue;\n\n        // FIXME: ax.tick0 and dtick get filled in during plotting (except for geo subplots),\n        // and unlike other auto values they don't make it back into the input,\n        // so newContainer won't have them.\n        if((key === 'tick0' || key === 'dtick') && outerparts[0] !== 'geo') {\n            var tickMode = newContainer.tickmode;\n            if(tickMode === 'auto' || tickMode === 'array' || !tickMode) continue;\n        }\n        // FIXME: Similarly for axis ranges for 3D\n        // contourcarpet doesn't HAVE zmin/zmax, they're just auto-added. It needs them.\n        if(key === 'range' && newContainer.autorange) continue;\n        if((key === 'zmin' || key === 'zmax') && newContainer.type === 'contourcarpet') continue;\n\n        valObject = getValObject(parts);\n\n        // in case type changed, we may not even *have* a valObject.\n        if(!valObject) continue;\n\n        if(valObject._compareAsJSON && JSON.stringify(oldVal) === JSON.stringify(newVal)) continue;\n\n        var valType = valObject.valType;\n        var i;\n\n        var canBeDataArray = valObjectCanBeDataArray(valObject);\n        var wasArray = Array.isArray(oldVal);\n        var nowArray = Array.isArray(newVal);\n\n        // hack for traces that modify the data in supplyDefaults, like\n        // converting 1D to 2D arrays, which will always create new objects\n        if(wasArray && nowArray) {\n            var inputKey = '_input_' + key;\n            var oldValIn = oldContainer[inputKey];\n            var newValIn = newContainer[inputKey];\n            if(Array.isArray(oldValIn) && oldValIn === newValIn) continue;\n        }\n\n        if(newVal === undefined) {\n            if(canBeDataArray && wasArray) flags.calc = true;\n            else changed();\n        } else if(valObject._isLinkedToArray) {\n            var arrayEditIndices = [];\n            var extraIndices = false;\n            if(!inArray) flags.arrays[key] = arrayEditIndices;\n\n            var minLen = Math.min(oldVal.length, newVal.length);\n            var maxLen = Math.max(oldVal.length, newVal.length);\n            if(minLen !== maxLen) {\n                if(valObject.editType === 'arraydraw') {\n                    extraIndices = true;\n                } else {\n                    changed();\n                    continue;\n                }\n            }\n\n            for(i = 0; i < minLen; i++) {\n                getDiffFlags(oldVal[i], newVal[i], parts.concat(i),\n                    // add array indices, but not if we're already in an array\n                    Lib.extendFlat({inArray: key, arrayIndex: i}, opts));\n            }\n\n            // put this at the end so that we know our collected array indices are sorted\n            // but the check for length changes happens up front so we can short-circuit\n            // diffing if appropriate\n            if(extraIndices) {\n                for(i = minLen; i < maxLen; i++) {\n                    arrayEditIndices.push(i);\n                }\n            }\n        } else if(!valType && Lib.isPlainObject(oldVal)) {\n            getDiffFlags(oldVal, newVal, parts, opts);\n        } else if(canBeDataArray) {\n            if(wasArray && nowArray) {\n                // don't try to diff two data arrays. If immutable we know the data changed,\n                // if not, assume it didn't and let `layout.datarevision` tell us if it did\n                if(immutable) {\n                    flags.calc = true;\n                }\n\n                // look for animatable attributes when the data changed\n                if(immutable || opts.newDataRevision) {\n                    changed();\n                }\n            } else if(wasArray !== nowArray) {\n                flags.calc = true;\n            } else changed();\n        } else if(wasArray && nowArray) {\n            // info array, colorscale, 'any' - these are short, just stringify.\n            // I don't *think* that covers up any real differences post-validation, does it?\n            // otherwise we need to dive in 1 (info_array) or 2 (colorscale) levels and compare\n            // all elements.\n            if(oldVal.length !== newVal.length || String(oldVal) !== String(newVal)) {\n                changed();\n            }\n        } else {\n            changed();\n        }\n    }\n\n    for(key in newContainer) {\n        if(!(key in oldContainer || key.charAt(0) === '_' || typeof newContainer[key] === 'function')) {\n            valObject = getValObject(outerparts.concat(key));\n\n            if(valObjectCanBeDataArray(valObject) && Array.isArray(newContainer[key])) {\n                flags.calc = true;\n                return;\n            } else changed();\n        }\n    }\n}\n\n/*\n * simple diff for config - for now, just treat all changes as equivalent\n */\nfunction diffConfig(oldConfig, newConfig) {\n    var key;\n\n    for(key in oldConfig) {\n        if(key.charAt(0) === '_') continue;\n        var oldVal = oldConfig[key];\n        var newVal = newConfig[key];\n        if(oldVal !== newVal) {\n            if(Lib.isPlainObject(oldVal) && Lib.isPlainObject(newVal)) {\n                if(diffConfig(oldVal, newVal)) {\n                    return true;\n                }\n            } else if(Array.isArray(oldVal) && Array.isArray(newVal)) {\n                if(oldVal.length !== newVal.length) {\n                    return true;\n                }\n                for(var i = 0; i < oldVal.length; i++) {\n                    if(oldVal[i] !== newVal[i]) {\n                        if(Lib.isPlainObject(oldVal[i]) && Lib.isPlainObject(newVal[i])) {\n                            if(diffConfig(oldVal[i], newVal[i])) {\n                                return true;\n                            }\n                        } else {\n                            return true;\n                        }\n                    }\n                }\n            } else {\n                return true;\n            }\n        }\n    }\n}\n\n/**\n * Animate to a frame, sequence of frame, frame group, or frame definition\n *\n * @param {string id or DOM element} gd\n *      the id or DOM element of the graph container div\n *\n * @param {string or object or array of strings or array of objects} frameOrGroupNameOrFrameList\n *      a single frame, array of frames, or group to which to animate. The intent is\n *      inferred by the type of the input. Valid inputs are:\n *\n *      - string, e.g. 'groupname': animate all frames of a given `group` in the order\n *            in which they are defined via `Plotly.addFrames`.\n *\n *      - array of strings, e.g. ['frame1', frame2']: a list of frames by name to which\n *            to animate in sequence\n *\n *      - object: {data: ...}: a frame definition to which to animate. The frame is not\n *            and does not need to be added via `Plotly.addFrames`. It may contain any of\n *            the properties of a frame, including `data`, `layout`, and `traces`. The\n *            frame is used as provided and does not use the `baseframe` property.\n *\n *      - array of objects, e.g. [{data: ...}, {data: ...}]: a list of frame objects,\n *            each following the same rules as a single `object`.\n *\n * @param {object} animationOpts\n *      configuration for the animation\n */\nfunction animate(gd, frameOrGroupNameOrFrameList, animationOpts) {\n    gd = Lib.getGraphDiv(gd);\n\n    if(!Lib.isPlotDiv(gd)) {\n        throw new Error(\n            'This element is not a Plotly plot: ' + gd + '. It\\'s likely that you\\'ve failed ' +\n            'to create a plot before animating it. For more details, see ' +\n            'https://plotly.com/javascript/animations/'\n        );\n    }\n\n    var trans = gd._transitionData;\n\n    // This is the queue of frames that will be animated as soon as possible. They\n    // are popped immediately upon the *start* of a transition:\n    if(!trans._frameQueue) {\n        trans._frameQueue = [];\n    }\n\n    animationOpts = Plots.supplyAnimationDefaults(animationOpts);\n    var transitionOpts = animationOpts.transition;\n    var frameOpts = animationOpts.frame;\n\n    // Since frames are popped immediately, an empty queue only means all frames have\n    // *started* to transition, not that the animation is complete. To solve that,\n    // track a separate counter that increments at the same time as frames are added\n    // to the queue, but decrements only when the transition is complete.\n    if(trans._frameWaitingCnt === undefined) {\n        trans._frameWaitingCnt = 0;\n    }\n\n    function getTransitionOpts(i) {\n        if(Array.isArray(transitionOpts)) {\n            if(i >= transitionOpts.length) {\n                return transitionOpts[0];\n            } else {\n                return transitionOpts[i];\n            }\n        } else {\n            return transitionOpts;\n        }\n    }\n\n    function getFrameOpts(i) {\n        if(Array.isArray(frameOpts)) {\n            if(i >= frameOpts.length) {\n                return frameOpts[0];\n            } else {\n                return frameOpts[i];\n            }\n        } else {\n            return frameOpts;\n        }\n    }\n\n    // Execute a callback after the wrapper function has been called n times.\n    // This is used to defer the resolution until a transition has resolved *and*\n    // the frame has completed. If it's not done this way, then we get a race\n    // condition in which the animation might resolve before a transition is complete\n    // or vice versa.\n    function callbackOnNthTime(cb, n) {\n        var cnt = 0;\n        return function() {\n            if(cb && ++cnt === n) {\n                return cb();\n            }\n        };\n    }\n\n    return new Promise(function(resolve, reject) {\n        function discardExistingFrames() {\n            if(trans._frameQueue.length === 0) {\n                return;\n            }\n\n            while(trans._frameQueue.length) {\n                var next = trans._frameQueue.pop();\n                if(next.onInterrupt) {\n                    next.onInterrupt();\n                }\n            }\n\n            gd.emit('plotly_animationinterrupted', []);\n        }\n\n        function queueFrames(frameList) {\n            if(frameList.length === 0) return;\n\n            for(var i = 0; i < frameList.length; i++) {\n                var computedFrame;\n\n                if(frameList[i].type === 'byname') {\n                    // If it's a named frame, compute it:\n                    computedFrame = Plots.computeFrame(gd, frameList[i].name);\n                } else {\n                    // Otherwise we must have been given a simple object, so treat\n                    // the input itself as the computed frame.\n                    computedFrame = frameList[i].data;\n                }\n\n                var frameOpts = getFrameOpts(i);\n                var transitionOpts = getTransitionOpts(i);\n\n                // It doesn't make much sense for the transition duration to be greater than\n                // the frame duration, so limit it:\n                transitionOpts.duration = Math.min(transitionOpts.duration, frameOpts.duration);\n\n                var nextFrame = {\n                    frame: computedFrame,\n                    name: frameList[i].name,\n                    frameOpts: frameOpts,\n                    transitionOpts: transitionOpts,\n                };\n                if(i === frameList.length - 1) {\n                    // The last frame in this .animate call stores the promise resolve\n                    // and reject callbacks. This is how we ensure that the animation\n                    // loop (which may exist as a result of a *different* .animate call)\n                    // still resolves or rejecdts this .animate call's promise. once it's\n                    // complete.\n                    nextFrame.onComplete = callbackOnNthTime(resolve, 2);\n                    nextFrame.onInterrupt = reject;\n                }\n\n                trans._frameQueue.push(nextFrame);\n            }\n\n            // Set it as never having transitioned to a frame. This will cause the animation\n            // loop to immediately transition to the next frame (which, for immediate mode,\n            // is the first frame in the list since all others would have been discarded\n            // below)\n            if(animationOpts.mode === 'immediate') {\n                trans._lastFrameAt = -Infinity;\n            }\n\n            // Only it's not already running, start a RAF loop. This could be avoided in the\n            // case that there's only one frame, but it significantly complicated the logic\n            // and only sped things up by about 5% or so for a lorenz attractor simulation.\n            // It would be a fine thing to implement, but the benefit of that optimization\n            // doesn't seem worth the extra complexity.\n            if(!trans._animationRaf) {\n                beginAnimationLoop();\n            }\n        }\n\n        function stopAnimationLoop() {\n            gd.emit('plotly_animated');\n\n            // Be sure to unset also since it's how we know whether a loop is already running:\n            window.cancelAnimationFrame(trans._animationRaf);\n            trans._animationRaf = null;\n        }\n\n        function nextFrame() {\n            if(trans._currentFrame && trans._currentFrame.onComplete) {\n                // Execute the callback and unset it to ensure it doesn't\n                // accidentally get called twice\n                trans._currentFrame.onComplete();\n            }\n\n            var newFrame = trans._currentFrame = trans._frameQueue.shift();\n\n            if(newFrame) {\n                // Since it's sometimes necessary to do deep digging into frame data,\n                // we'll consider it not 100% impossible for nulls or numbers to sneak through,\n                // so check when casting the name, just to be absolutely certain:\n                var stringName = newFrame.name ? newFrame.name.toString() : null;\n                gd._fullLayout._currentFrame = stringName;\n\n                trans._lastFrameAt = Date.now();\n                trans._timeToNext = newFrame.frameOpts.duration;\n\n                // This is simply called and it's left to .transition to decide how to manage\n                // interrupting current transitions. That means we don't need to worry about\n                // how it resolves or what happens after this:\n                Plots.transition(gd,\n                    newFrame.frame.data,\n                    newFrame.frame.layout,\n                    helpers.coerceTraceIndices(gd, newFrame.frame.traces),\n                    newFrame.frameOpts,\n                    newFrame.transitionOpts\n                ).then(function() {\n                    if(newFrame.onComplete) {\n                        newFrame.onComplete();\n                    }\n                });\n\n                gd.emit('plotly_animatingframe', {\n                    name: stringName,\n                    frame: newFrame.frame,\n                    animation: {\n                        frame: newFrame.frameOpts,\n                        transition: newFrame.transitionOpts,\n                    }\n                });\n            } else {\n                // If there are no more frames, then stop the RAF loop:\n                stopAnimationLoop();\n            }\n        }\n\n        function beginAnimationLoop() {\n            gd.emit('plotly_animating');\n\n            // If no timer is running, then set last frame = long ago so that the next\n            // frame is immediately transitioned:\n            trans._lastFrameAt = -Infinity;\n            trans._timeToNext = 0;\n            trans._runningTransitions = 0;\n            trans._currentFrame = null;\n\n            var doFrame = function() {\n                // This *must* be requested before nextFrame since nextFrame may decide\n                // to cancel it if there's nothing more to animated:\n                trans._animationRaf = window.requestAnimationFrame(doFrame);\n\n                // Check if we're ready for a new frame:\n                if(Date.now() - trans._lastFrameAt > trans._timeToNext) {\n                    nextFrame();\n                }\n            };\n\n            doFrame();\n        }\n\n        // This is an animate-local counter that helps match up option input list\n        // items with the particular frame.\n        var configCounter = 0;\n        function setTransitionConfig(frame) {\n            if(Array.isArray(transitionOpts)) {\n                if(configCounter >= transitionOpts.length) {\n                    frame.transitionOpts = transitionOpts[configCounter];\n                } else {\n                    frame.transitionOpts = transitionOpts[0];\n                }\n            } else {\n                frame.transitionOpts = transitionOpts;\n            }\n            configCounter++;\n            return frame;\n        }\n\n        // Disambiguate what's sort of frames have been received\n        var i, frame;\n        var frameList = [];\n        var allFrames = frameOrGroupNameOrFrameList === undefined || frameOrGroupNameOrFrameList === null;\n        var isFrameArray = Array.isArray(frameOrGroupNameOrFrameList);\n        var isSingleFrame = !allFrames && !isFrameArray && Lib.isPlainObject(frameOrGroupNameOrFrameList);\n\n        if(isSingleFrame) {\n            // In this case, a simple object has been passed to animate.\n            frameList.push({\n                type: 'object',\n                data: setTransitionConfig(Lib.extendFlat({}, frameOrGroupNameOrFrameList))\n            });\n        } else if(allFrames || ['string', 'number'].indexOf(typeof frameOrGroupNameOrFrameList) !== -1) {\n            // In this case, null or undefined has been passed so that we want to\n            // animate *all* currently defined frames\n            for(i = 0; i < trans._frames.length; i++) {\n                frame = trans._frames[i];\n\n                if(!frame) continue;\n\n                if(allFrames || String(frame.group) === String(frameOrGroupNameOrFrameList)) {\n                    frameList.push({\n                        type: 'byname',\n                        name: String(frame.name),\n                        data: setTransitionConfig({name: frame.name})\n                    });\n                }\n            }\n        } else if(isFrameArray) {\n            for(i = 0; i < frameOrGroupNameOrFrameList.length; i++) {\n                var frameOrName = frameOrGroupNameOrFrameList[i];\n                if(['number', 'string'].indexOf(typeof frameOrName) !== -1) {\n                    frameOrName = String(frameOrName);\n                    // In this case, there's an array and this frame is a string name:\n                    frameList.push({\n                        type: 'byname',\n                        name: frameOrName,\n                        data: setTransitionConfig({name: frameOrName})\n                    });\n                } else if(Lib.isPlainObject(frameOrName)) {\n                    frameList.push({\n                        type: 'object',\n                        data: setTransitionConfig(Lib.extendFlat({}, frameOrName))\n                    });\n                }\n            }\n        }\n\n        // Verify that all of these frames actually exist; return and reject if not:\n        for(i = 0; i < frameList.length; i++) {\n            frame = frameList[i];\n            if(frame.type === 'byname' && !trans._frameHash[frame.data.name]) {\n                Lib.warn('animate failure: frame not found: \"' + frame.data.name + '\"');\n                reject();\n                return;\n            }\n        }\n\n        // If the mode is either next or immediate, then all currently queued frames must\n        // be dumped and the corresponding .animate promises rejected.\n        if(['next', 'immediate'].indexOf(animationOpts.mode) !== -1) {\n            discardExistingFrames();\n        }\n\n        if(animationOpts.direction === 'reverse') {\n            frameList.reverse();\n        }\n\n        var currentFrame = gd._fullLayout._currentFrame;\n        if(currentFrame && animationOpts.fromcurrent) {\n            var idx = -1;\n            for(i = 0; i < frameList.length; i++) {\n                frame = frameList[i];\n                if(frame.type === 'byname' && frame.name === currentFrame) {\n                    idx = i;\n                    break;\n                }\n            }\n\n            if(idx > 0 && idx < frameList.length - 1) {\n                var filteredFrameList = [];\n                for(i = 0; i < frameList.length; i++) {\n                    frame = frameList[i];\n                    if(frameList[i].type !== 'byname' || i > idx) {\n                        filteredFrameList.push(frame);\n                    }\n                }\n                frameList = filteredFrameList;\n            }\n        }\n\n        if(frameList.length > 0) {\n            queueFrames(frameList);\n        } else {\n            // This is the case where there were simply no frames. It's a little strange\n            // since there's not much to do:\n            gd.emit('plotly_animated');\n            resolve();\n        }\n    });\n}\n\n/**\n * Register new frames\n *\n * @param {string id or DOM element} gd\n *      the id or DOM element of the graph container div\n *\n * @param {array of objects} frameList\n *      list of frame definitions, in which each object includes any of:\n *      - name: {string} name of frame to add\n *      - data: {array of objects} trace data\n *      - layout {object} layout definition\n *      - traces {array} trace indices\n *      - baseframe {string} name of frame from which this frame gets defaults\n *\n *  @param {array of integers} indices\n *      an array of integer indices matching the respective frames in `frameList`. If not\n *      provided, an index will be provided in serial order. If already used, the frame\n *      will be overwritten.\n */\nfunction addFrames(gd, frameList, indices) {\n    gd = Lib.getGraphDiv(gd);\n\n    if(frameList === null || frameList === undefined) {\n        return Promise.resolve();\n    }\n\n    if(!Lib.isPlotDiv(gd)) {\n        throw new Error(\n            'This element is not a Plotly plot: ' + gd + '. It\\'s likely that you\\'ve failed ' +\n            'to create a plot before adding frames. For more details, see ' +\n            'https://plotly.com/javascript/animations/'\n        );\n    }\n\n    var i, frame, j, idx;\n    var _frames = gd._transitionData._frames;\n    var _frameHash = gd._transitionData._frameHash;\n\n\n    if(!Array.isArray(frameList)) {\n        throw new Error('addFrames failure: frameList must be an Array of frame definitions' + frameList);\n    }\n\n    // Create a sorted list of insertions since we run into lots of problems if these\n    // aren't in ascending order of index:\n    //\n    // Strictly for sorting. Make sure this is guaranteed to never collide with any\n    // already-exisisting indices:\n    var bigIndex = _frames.length + frameList.length * 2;\n\n    var insertions = [];\n    var _frameHashLocal = {};\n    for(i = frameList.length - 1; i >= 0; i--) {\n        if(!Lib.isPlainObject(frameList[i])) continue;\n\n        // The entire logic for checking for this type of name collision can be removed once we migrate to ES6 and\n        // use a Map instead of an Object instance, as Map keys aren't converted to strings.\n        var lookupName = frameList[i].name;\n        var name = (_frameHash[lookupName] || _frameHashLocal[lookupName] || {}).name;\n        var newName = frameList[i].name;\n        var collisionPresent = _frameHash[name] || _frameHashLocal[name];\n\n        if(name && newName && typeof newName === 'number' && collisionPresent && numericNameWarningCount < numericNameWarningCountLimit) {\n            numericNameWarningCount++;\n\n            Lib.warn('addFrames: overwriting frame \"' + (_frameHash[name] || _frameHashLocal[name]).name +\n                '\" with a frame whose name of type \"number\" also equates to \"' +\n                name + '\". This is valid but may potentially lead to unexpected ' +\n                'behavior since all plotly.js frame names are stored internally ' +\n                'as strings.');\n\n            if(numericNameWarningCount === numericNameWarningCountLimit) {\n                Lib.warn('addFrames: This API call has yielded too many of these warnings. ' +\n                    'For the rest of this call, further warnings about numeric frame ' +\n                    'names will be suppressed.');\n            }\n        }\n\n        _frameHashLocal[lookupName] = {name: lookupName};\n\n        insertions.push({\n            frame: Plots.supplyFrameDefaults(frameList[i]),\n            index: (indices && indices[i] !== undefined && indices[i] !== null) ? indices[i] : bigIndex + i\n        });\n    }\n\n    // Sort this, taking note that undefined insertions end up at the end:\n    insertions.sort(function(a, b) {\n        if(a.index > b.index) return -1;\n        if(a.index < b.index) return 1;\n        return 0;\n    });\n\n    var ops = [];\n    var revops = [];\n    var frameCount = _frames.length;\n\n    for(i = insertions.length - 1; i >= 0; i--) {\n        frame = insertions[i].frame;\n\n        if(typeof frame.name === 'number') {\n            Lib.warn('Warning: addFrames accepts frames with numeric names, but the numbers are' +\n                'implicitly cast to strings');\n        }\n\n        if(!frame.name) {\n            // Repeatedly assign a default name, incrementing the counter each time until\n            // we get a name that's not in the hashed lookup table:\n            while(_frameHash[(frame.name = 'frame ' + gd._transitionData._counter++)]);\n        }\n\n        if(_frameHash[frame.name]) {\n            // If frame is present, overwrite its definition:\n            for(j = 0; j < _frames.length; j++) {\n                if((_frames[j] || {}).name === frame.name) break;\n            }\n            ops.push({type: 'replace', index: j, value: frame});\n            revops.unshift({type: 'replace', index: j, value: _frames[j]});\n        } else {\n            // Otherwise insert it at the end of the list:\n            idx = Math.max(0, Math.min(insertions[i].index, frameCount));\n\n            ops.push({type: 'insert', index: idx, value: frame});\n            revops.unshift({type: 'delete', index: idx});\n            frameCount++;\n        }\n    }\n\n    var undoFunc = Plots.modifyFrames;\n    var redoFunc = Plots.modifyFrames;\n    var undoArgs = [gd, revops];\n    var redoArgs = [gd, ops];\n\n    if(Queue) Queue.add(gd, undoFunc, undoArgs, redoFunc, redoArgs);\n\n    return Plots.modifyFrames(gd, ops);\n}\n\n/**\n * Delete frame\n *\n * @param {string id or DOM element} gd\n *      the id or DOM element of the graph container div\n *\n * @param {array of integers} frameList\n *      list of integer indices of frames to be deleted\n */\nfunction deleteFrames(gd, frameList) {\n    gd = Lib.getGraphDiv(gd);\n\n    if(!Lib.isPlotDiv(gd)) {\n        throw new Error('This element is not a Plotly plot: ' + gd);\n    }\n\n    var i, idx;\n    var _frames = gd._transitionData._frames;\n    var ops = [];\n    var revops = [];\n\n    if(!frameList) {\n        frameList = [];\n        for(i = 0; i < _frames.length; i++) {\n            frameList.push(i);\n        }\n    }\n\n    frameList = frameList.slice();\n    frameList.sort();\n\n    for(i = frameList.length - 1; i >= 0; i--) {\n        idx = frameList[i];\n        ops.push({type: 'delete', index: idx});\n        revops.unshift({type: 'insert', index: idx, value: _frames[idx]});\n    }\n\n    var undoFunc = Plots.modifyFrames;\n    var redoFunc = Plots.modifyFrames;\n    var undoArgs = [gd, revops];\n    var redoArgs = [gd, ops];\n\n    if(Queue) Queue.add(gd, undoFunc, undoArgs, redoFunc, redoArgs);\n\n    return Plots.modifyFrames(gd, ops);\n}\n\n/**\n * Purge a graph container div back to its initial pre-_doPlot state\n *\n * @param {string id or DOM element} gd\n *      the id or DOM element of the graph container div\n */\nfunction purge(gd) {\n    gd = Lib.getGraphDiv(gd);\n\n    var fullLayout = gd._fullLayout || {};\n    var fullData = gd._fullData || [];\n\n    // remove gl contexts\n    Plots.cleanPlot([], {}, fullData, fullLayout);\n\n    // purge properties\n    Plots.purge(gd);\n\n    // purge event emitter methods\n    Events.purge(gd);\n\n    // remove plot container\n    if(fullLayout._container) fullLayout._container.remove();\n\n    // in contrast to _doPlots.purge which does NOT clear _context!\n    delete gd._context;\n\n    return gd;\n}\n\n// determines if the graph div requires a recalculation of its inverse matrix transforms by comparing old + new bounding boxes.\nfunction calcInverseTransform(gd) {\n    var fullLayout = gd._fullLayout;\n\n    var newBBox = gd.getBoundingClientRect();\n    if(Lib.equalDomRects(newBBox, fullLayout._lastBBox)) return;\n\n    var m = fullLayout._invTransform = Lib.inverseTransformMatrix(Lib.getFullTransformMatrix(gd));\n    fullLayout._invScaleX = Math.sqrt(m[0][0] * m[0][0] + m[0][1] * m[0][1] + m[0][2] * m[0][2]);\n    fullLayout._invScaleY = Math.sqrt(m[1][0] * m[1][0] + m[1][1] * m[1][1] + m[1][2] * m[1][2]);\n    fullLayout._lastBBox = newBBox;\n}\n\n// -------------------------------------------------------\n// makePlotFramework: Create the plot container and axes\n// -------------------------------------------------------\nfunction makePlotFramework(gd) {\n    var gd3 = d3.select(gd);\n    var fullLayout = gd._fullLayout;\n\n    fullLayout._calcInverseTransform = calcInverseTransform;\n    fullLayout._calcInverseTransform(gd);\n\n    // Plot container\n    fullLayout._container = gd3.selectAll('.plot-container').data([0]);\n    fullLayout._container.enter()\n        .insert('div', ':first-child')\n        .classed('plot-container', true)\n        .classed('plotly', true);\n\n    // Make the svg container\n    fullLayout._paperdiv = fullLayout._container.selectAll('.svg-container').data([0]);\n    fullLayout._paperdiv.enter().append('div')\n        .classed('user-select-none', true)\n        .classed('svg-container', true)\n        .style('position', 'relative');\n\n    // Make the graph containers\n    // start fresh each time we get here, so we know the order comes out\n    // right, rather than enter/exit which can muck up the order\n    // TODO: sort out all the ordering so we don't have to\n    // explicitly delete anything\n    // FIXME: parcoords reuses this object, not the best pattern\n    fullLayout._glcontainer = fullLayout._paperdiv.selectAll('.gl-container')\n        .data([{}]);\n\n    fullLayout._glcontainer.enter().append('div')\n        .classed('gl-container', true);\n\n    fullLayout._paperdiv.selectAll('.main-svg').remove();\n    fullLayout._paperdiv.select('.modebar-container').remove();\n\n    fullLayout._paper = fullLayout._paperdiv.insert('svg', ':first-child')\n        .classed('main-svg', true);\n\n    fullLayout._toppaper = fullLayout._paperdiv.append('svg')\n        .classed('main-svg', true);\n\n    fullLayout._modebardiv = fullLayout._paperdiv.append('div');\n    delete fullLayout._modeBar;\n\n    fullLayout._hoverpaper = fullLayout._paperdiv.append('svg')\n        .classed('main-svg', true);\n\n    if(!fullLayout._uid) {\n        var otherUids = {};\n        d3.selectAll('defs').each(function() {\n            if(this.id) otherUids[this.id.split('-')[1]] = 1;\n        });\n        fullLayout._uid = Lib.randstr(otherUids);\n    }\n\n    fullLayout._paperdiv.selectAll('.main-svg')\n        .attr(xmlnsNamespaces.svgAttrs);\n\n    fullLayout._defs = fullLayout._paper.append('defs')\n        .attr('id', 'defs-' + fullLayout._uid);\n\n    fullLayout._clips = fullLayout._defs.append('g')\n        .classed('clips', true);\n\n    fullLayout._topdefs = fullLayout._toppaper.append('defs')\n        .attr('id', 'topdefs-' + fullLayout._uid);\n\n    fullLayout._topclips = fullLayout._topdefs.append('g')\n        .classed('clips', true);\n\n    fullLayout._bgLayer = fullLayout._paper.append('g')\n        .classed('bglayer', true);\n\n    fullLayout._draggers = fullLayout._paper.append('g')\n        .classed('draglayer', true);\n\n    // lower shape/image layer - note that this is behind\n    // all subplots data/grids but above the backgrounds\n    // except inset subplots, whose backgrounds are drawn\n    // inside their own group so that they appear above\n    // the data for the main subplot\n    // lower shapes and images which are fully referenced to\n    // a subplot still get drawn within the subplot's group\n    // so they will work correctly on insets\n    var layerBelow = fullLayout._paper.append('g')\n        .classed('layer-below', true);\n    fullLayout._imageLowerLayer = layerBelow.append('g')\n        .classed('imagelayer', true);\n    fullLayout._shapeLowerLayer = layerBelow.append('g')\n        .classed('shapelayer', true);\n\n    // single cartesian layer for the whole plot\n    fullLayout._cartesianlayer = fullLayout._paper.append('g').classed('cartesianlayer', true);\n\n    // single polar layer for the whole plot\n    fullLayout._polarlayer = fullLayout._paper.append('g').classed('polarlayer', true);\n\n    // single ternary layer for the whole plot\n    fullLayout._ternarylayer = fullLayout._paper.append('g').classed('ternarylayer', true);\n\n    // single geo layer for the whole plot\n    fullLayout._geolayer = fullLayout._paper.append('g').classed('geolayer', true);\n\n    // single funnelarea layer for the whole plot\n    fullLayout._funnelarealayer = fullLayout._paper.append('g').classed('funnelarealayer', true);\n\n    // single pie layer for the whole plot\n    fullLayout._pielayer = fullLayout._paper.append('g').classed('pielayer', true);\n\n    // single treemap layer for the whole plot\n    fullLayout._iciclelayer = fullLayout._paper.append('g').classed('iciclelayer', true);\n\n    // single treemap layer for the whole plot\n    fullLayout._treemaplayer = fullLayout._paper.append('g').classed('treemaplayer', true);\n\n    // single sunburst layer for the whole plot\n    fullLayout._sunburstlayer = fullLayout._paper.append('g').classed('sunburstlayer', true);\n\n    // single indicator layer for the whole plot\n    fullLayout._indicatorlayer = fullLayout._toppaper.append('g').classed('indicatorlayer', true);\n\n    // fill in image server scrape-svg\n    fullLayout._glimages = fullLayout._paper.append('g').classed('glimages', true);\n\n    // lastly upper shapes, info (legend, annotations) and hover layers go on top\n    // these are in a different svg element normally, but get collapsed into a single\n    // svg when exporting (after inserting 3D)\n    // upper shapes/images are only those drawn above the whole plot, including subplots\n    var layerAbove = fullLayout._toppaper.append('g')\n        .classed('layer-above', true);\n    fullLayout._imageUpperLayer = layerAbove.append('g')\n        .classed('imagelayer', true);\n    fullLayout._shapeUpperLayer = layerAbove.append('g')\n        .classed('shapelayer', true);\n\n    fullLayout._infolayer = fullLayout._toppaper.append('g').classed('infolayer', true);\n    fullLayout._menulayer = fullLayout._toppaper.append('g').classed('menulayer', true);\n    fullLayout._zoomlayer = fullLayout._toppaper.append('g').classed('zoomlayer', true);\n    fullLayout._hoverlayer = fullLayout._hoverpaper.append('g').classed('hoverlayer', true);\n\n    // Make the modebar container\n    fullLayout._modebardiv\n        .classed('modebar-container', true)\n        .style('position', 'absolute')\n        .style('top', '0px')\n        .style('right', '0px');\n\n    gd.emit('plotly_framework');\n}\n\nexports.animate = animate;\nexports.addFrames = addFrames;\nexports.deleteFrames = deleteFrames;\n\nexports.addTraces = addTraces;\nexports.deleteTraces = deleteTraces;\nexports.extendTraces = extendTraces;\nexports.moveTraces = moveTraces;\nexports.prependTraces = prependTraces;\n\nexports.newPlot = newPlot;\nexports._doPlot = _doPlot;\nexports.purge = purge;\n\nexports.react = react;\nexports.redraw = redraw;\nexports.relayout = relayout;\nexports.restyle = restyle;\n\nexports.setPlotConfig = setPlotConfig;\n\nexports.update = update;\n\nexports._guiRelayout = guiEdit(relayout);\nexports._guiRestyle = guiEdit(restyle);\nexports._guiUpdate = guiEdit(update);\n\nexports._storeDirectGUIEdit = _storeDirectGUIEdit;\n","'use strict';\n\n/**\n * This will be transferred over to gd and overridden by\n * config args to Plotly.newPlot.\n *\n * The defaults are the appropriate settings for plotly.js,\n * so we get the right experience without any config argument.\n *\n * N.B. the config options are not coerced using Lib.coerce so keys\n * like `valType` and `values` are only set for documentation purposes\n * at the moment.\n */\n\nvar configAttributes = {\n    staticPlot: {\n        valType: 'boolean',\n        dflt: false,\n        description: [\n            'Determines whether the graphs are interactive or not.',\n            'If *false*, no interactivity, for export or image generation.'\n        ].join(' ')\n    },\n\n    plotlyServerURL: {\n        valType: 'string',\n        dflt: '',\n        description: [\n            'When set it determines base URL for',\n            'the \\'Edit in Chart Studio\\' `showEditInChartStudio`/`showSendToCloud` mode bar button',\n            'and the showLink/sendData on-graph link.',\n            'To enable sending your data to Chart Studio Cloud, you need to',\n            'set both `plotlyServerURL` to \\'https://chart-studio.plotly.com\\' and',\n            'also set `showSendToCloud` to true.'\n        ].join(' ')\n    },\n\n    editable: {\n        valType: 'boolean',\n        dflt: false,\n        description: [\n            'Determines whether the graph is editable or not.',\n            'Sets all pieces of `edits`',\n            'unless a separate `edits` config item overrides individual parts.'\n        ].join(' ')\n    },\n    edits: {\n        annotationPosition: {\n            valType: 'boolean',\n            dflt: false,\n            description: [\n                'Determines if the main anchor of the annotation is editable.',\n                'The main anchor corresponds to the',\n                'text (if no arrow) or the arrow (which drags the whole thing leaving',\n                'the arrow length & direction unchanged).'\n            ].join(' ')\n        },\n        annotationTail: {\n            valType: 'boolean',\n            dflt: false,\n            description: [\n                'Has only an effect for annotations with arrows.',\n                'Enables changing the length and direction of the arrow.'\n            ].join(' ')\n        },\n        annotationText: {\n            valType: 'boolean',\n            dflt: false,\n            description: 'Enables editing annotation text.'\n        },\n        axisTitleText: {\n            valType: 'boolean',\n            dflt: false,\n            description: 'Enables editing axis title text.'\n        },\n        colorbarPosition: {\n            valType: 'boolean',\n            dflt: false,\n            description: 'Enables moving colorbars.'\n        },\n        colorbarTitleText: {\n            valType: 'boolean',\n            dflt: false,\n            description: 'Enables editing colorbar title text.'\n        },\n        legendPosition: {\n            valType: 'boolean',\n            dflt: false,\n            description: 'Enables moving the legend.'\n        },\n        legendText: {\n            valType: 'boolean',\n            dflt: false,\n            description: 'Enables editing the trace name fields from the legend'\n        },\n        shapePosition: {\n            valType: 'boolean',\n            dflt: false,\n            description: 'Enables moving shapes.'\n        },\n        titleText: {\n            valType: 'boolean',\n            dflt: false,\n            description: 'Enables editing the global layout title.'\n        }\n    },\n\n    autosizable: {\n        valType: 'boolean',\n        dflt: false,\n        description: [\n            'Determines whether the graphs are plotted with respect to',\n            'layout.autosize:true and infer its container size.'\n        ].join(' ')\n    },\n    responsive: {\n        valType: 'boolean',\n        dflt: false,\n        description: [\n            'Determines whether to change the layout size when window is resized.',\n            'In v3, this option will be removed and will always be true.'\n        ].join(' ')\n    },\n    fillFrame: {\n        valType: 'boolean',\n        dflt: false,\n        description: [\n            'When `layout.autosize` is turned on, determines whether the graph',\n            'fills the container (the default) or the screen (if set to *true*).'\n        ].join(' ')\n    },\n    frameMargins: {\n        valType: 'number',\n        dflt: 0,\n        min: 0,\n        max: 0.5,\n        description: [\n            'When `layout.autosize` is turned on, set the frame margins',\n            'in fraction of the graph size.'\n        ].join(' ')\n    },\n\n    scrollZoom: {\n        valType: 'flaglist',\n        flags: ['cartesian', 'gl3d', 'geo', 'mapbox'],\n        extras: [true, false],\n        dflt: 'gl3d+geo+mapbox',\n        description: [\n            'Determines whether mouse wheel or two-finger scroll zooms is enable.',\n            'Turned on by default for gl3d, geo and mapbox subplots',\n            '(as these subplot types do not have zoombox via pan),',\n            'but turned off by default for cartesian subplots.',\n            'Set `scrollZoom` to *false* to disable scrolling for all subplots.'\n        ].join(' ')\n    },\n    doubleClick: {\n        valType: 'enumerated',\n        values: [false, 'reset', 'autosize', 'reset+autosize'],\n        dflt: 'reset+autosize',\n        description: [\n            'Sets the double click interaction mode.',\n            'Has an effect only in cartesian plots.',\n            'If *false*, double click is disable.',\n            'If *reset*, double click resets the axis ranges to their initial values.',\n            'If *autosize*, double click set the axis ranges to their autorange values.',\n            'If *reset+autosize*, the odd double clicks resets the axis ranges',\n            'to their initial values and even double clicks set the axis ranges',\n            'to their autorange values.'\n        ].join(' ')\n    },\n    doubleClickDelay: {\n        valType: 'number',\n        dflt: 300,\n        min: 0,\n        description: [\n            'Sets the delay for registering a double-click in ms.',\n            'This is the time interval (in ms) between first mousedown and',\n            '2nd mouseup to constitute a double-click.',\n            'This setting propagates to all on-subplot double clicks',\n            '(except for geo and mapbox) and on-legend double clicks.'\n        ].join(' ')\n    },\n\n    showAxisDragHandles: {\n        valType: 'boolean',\n        dflt: true,\n        description: [\n            'Set to *false* to omit cartesian axis pan/zoom drag handles.'\n        ].join(' ')\n    },\n    showAxisRangeEntryBoxes: {\n        valType: 'boolean',\n        dflt: true,\n        description: [\n            'Set to *false* to omit direct range entry at the pan/zoom drag points,',\n            'note that `showAxisDragHandles` must be enabled to have an effect.'\n        ].join(' ')\n    },\n\n    showTips: {\n        valType: 'boolean',\n        dflt: true,\n        description: [\n            'Determines whether or not tips are shown while interacting',\n            'with the resulting graphs.'\n        ].join(' ')\n    },\n\n    showLink: {\n        valType: 'boolean',\n        dflt: false,\n        description: [\n            'Determines whether a link to Chart Studio Cloud is displayed',\n            'at the bottom right corner of resulting graphs.',\n            'Use with `sendData` and `linkText`.'\n        ].join(' ')\n    },\n    linkText: {\n        valType: 'string',\n        dflt: 'Edit chart',\n        noBlank: true,\n        description: [\n            'Sets the text appearing in the `showLink` link.'\n        ].join(' ')\n    },\n    sendData: {\n        valType: 'boolean',\n        dflt: true,\n        description: [\n            'If *showLink* is true, does it contain data',\n            'just link to a Chart Studio Cloud file?'\n        ].join(' ')\n    },\n    showSources: {\n        valType: 'any',\n        dflt: false,\n        description: [\n            'Adds a source-displaying function to show sources on',\n            'the resulting graphs.'\n        ].join(' ')\n    },\n\n    displayModeBar: {\n        valType: 'enumerated',\n        values: ['hover', true, false],\n        dflt: 'hover',\n        description: [\n            'Determines the mode bar display mode.',\n            'If *true*, the mode bar is always visible.',\n            'If *false*, the mode bar is always hidden.',\n            'If *hover*, the mode bar is visible while the mouse cursor',\n            'is on the graph container.'\n        ].join(' ')\n    },\n    showSendToCloud: {\n        valType: 'boolean',\n        dflt: false,\n        description: [\n            'Should we include a ModeBar button, labeled \"Edit in Chart Studio\",',\n            'that sends this chart to chart-studio.plotly.com (formerly plot.ly) or another plotly server',\n            'as specified by `plotlyServerURL` for editing, export, etc? Prior to version 1.43.0',\n            'this button was included by default, now it is opt-in using this flag.',\n            'Note that this button can (depending on `plotlyServerURL` being set) send your data',\n            'to an external server. However that server does not persist your data',\n            'until you arrive at the Chart Studio and explicitly click \"Save\".'\n        ].join(' ')\n    },\n    showEditInChartStudio: {\n        valType: 'boolean',\n        dflt: false,\n        description: [\n            'Same as `showSendToCloud`, but use a pencil icon instead of a floppy-disk.',\n            'Note that if both `showSendToCloud` and `showEditInChartStudio` are turned,',\n            'only `showEditInChartStudio` will be honored.'\n        ].join(' ')\n    },\n    modeBarButtonsToRemove: {\n        valType: 'any',\n        dflt: [],\n        description: [\n            'Remove mode bar buttons by name.',\n            'See ./components/modebar/buttons.js for the list of names.'\n        ].join(' ')\n    },\n    modeBarButtonsToAdd: {\n        valType: 'any',\n        dflt: [],\n        description: [\n            'Add mode bar button using config objects',\n            'See ./components/modebar/buttons.js for list of arguments.',\n            'To enable predefined modebar buttons e.g. shape drawing, hover and spikelines,',\n            'simply provide their string name(s). This could include:',\n            '*v1hovermode*, *hoverclosest*, *hovercompare*, *togglehover*, *togglespikelines*,',\n            '*drawline*, *drawopenpath*, *drawclosedpath*, *drawcircle*, *drawrect* and *eraseshape*.',\n            'Please note that these predefined buttons will only be shown if they are compatible',\n            'with all trace types used in a graph.'\n        ].join(' ')\n    },\n    modeBarButtons: {\n        valType: 'any',\n        dflt: false,\n        description: [\n            'Define fully custom mode bar buttons as nested array,',\n            'where the outer arrays represents button groups, and',\n            'the inner arrays have buttons config objects or names of default buttons',\n            'See ./components/modebar/buttons.js for more info.'\n        ].join(' ')\n    },\n    toImageButtonOptions: {\n        valType: 'any',\n        dflt: {},\n        description: [\n            'Statically override options for toImage modebar button',\n            'allowed keys are format, filename, width, height, scale',\n            'see ../components/modebar/buttons.js'\n        ].join(' ')\n    },\n    displaylogo: {\n        valType: 'boolean',\n        dflt: true,\n        description: [\n            'Determines whether or not the plotly logo is displayed',\n            'on the end of the mode bar.'\n        ].join(' ')\n    },\n    watermark: {\n        valType: 'boolean',\n        dflt: false,\n        description: 'watermark the images with the company\\'s logo'\n    },\n\n    plotGlPixelRatio: {\n        valType: 'number',\n        dflt: 2,\n        min: 1,\n        max: 4,\n        description: [\n            'Set the pixel ratio during WebGL image export.',\n            'This config option was formerly named `plot3dPixelRatio`',\n            'which is now deprecated.'\n        ].join(' ')\n    },\n\n    setBackground: {\n        valType: 'any',\n        dflt: 'transparent',\n        description: [\n            'Set function to add the background color (i.e. `layout.paper_color`)',\n            'to a different container.',\n            'This function take the graph div as first argument and the current background',\n            'color as second argument.',\n            'Alternatively, set to string *opaque* to ensure there is white behind it.'\n        ].join(' ')\n    },\n\n    topojsonURL: {\n        valType: 'string',\n        noBlank: true,\n        dflt: 'https://cdn.plot.ly/',\n        description: [\n            'Set the URL to topojson used in geo charts.',\n            'By default, the topojson files are fetched from cdn.plot.ly.',\n            'For example, set this option to:',\n            '<path-to-plotly.js>/dist/topojson/',\n            'to render geographical feature using the topojson files',\n            'that ship with the plotly.js module.'\n        ].join(' ')\n    },\n\n    mapboxAccessToken: {\n        valType: 'string',\n        dflt: null,\n        description: [\n            'Mapbox access token (required to plot mapbox trace types)',\n            'If using an Mapbox Atlas server, set this option to \\'\\'',\n            'so that plotly.js won\\'t attempt to authenticate to the public Mapbox server.'\n        ].join(' ')\n    },\n\n    logging: {\n        valType: 'integer',\n        min: 0,\n        max: 2,\n        dflt: 1,\n        description: [\n            'Turn all console logging on or off (errors will be thrown)',\n            'This should ONLY be set via Plotly.setPlotConfig',\n            'Available levels:',\n            '0: no logs',\n            '1: warnings and errors, but not informational messages',\n            '2: verbose logs'\n        ].join(' ')\n    },\n\n    notifyOnLogging: {\n        valType: 'integer',\n        min: 0,\n        max: 2,\n        dflt: 0,\n        description: [\n            'Set on-graph logging (notifier) level',\n            'This should ONLY be set via Plotly.setPlotConfig',\n            'Available levels:',\n            '0: no on-graph logs',\n            '1: warnings and errors, but not informational messages',\n            '2: verbose logs'\n        ].join(' ')\n    },\n\n    queueLength: {\n        valType: 'integer',\n        min: 0,\n        dflt: 0,\n        description: 'Sets the length of the undo/redo queue.'\n    },\n\n    globalTransforms: {\n        valType: 'any',\n        dflt: [],\n        description: [\n            'Set global transform to be applied to all traces with no',\n            'specification needed'\n        ].join(' ')\n    },\n\n    locale: {\n        valType: 'string',\n        dflt: 'en-US',\n        description: [\n            'Which localization should we use?',\n            'Should be a string like \\'en\\' or \\'en-US\\'.'\n        ].join(' ')\n    },\n\n    locales: {\n        valType: 'any',\n        dflt: {},\n        description: [\n            'Localization definitions',\n            'Locales can be provided either here (specific to one chart) or globally',\n            'by registering them as modules.',\n            'Should be an object of objects {locale: {dictionary: {...}, format: {...}}}',\n            '{',\n            '  da: {',\n            '      dictionary: {\\'Reset axes\\': \\'Nulstil aksler\\', ...},',\n            '      format: {months: [...], shortMonths: [...]}',\n            '  },',\n            '  ...',\n            '}',\n            'All parts are optional. When looking for translation or format fields, we',\n            'look first for an exact match in a config locale, then in a registered',\n            'module. If those fail, we strip off any regionalization (\\'en-US\\' -> \\'en\\')',\n            'and try each (config, registry) again. The final fallback for translation',\n            'is untranslated (which is US English) and for formats is the base English',\n            '(the only consequence being the last fallback date format %x is DD/MM/YYYY',\n            'instead of MM/DD/YYYY). Currently `grouping` and `currency` are ignored',\n            'for our automatic number formatting, but can be used in custom formats.'\n        ].join(' ')\n    }\n};\n\nvar dfltConfig = {};\n\nfunction crawl(src, target) {\n    for(var k in src) {\n        var obj = src[k];\n        if(obj.valType) {\n            target[k] = obj.dflt;\n        } else {\n            if(!target[k]) {\n                target[k] = {};\n            }\n            crawl(obj, target[k]);\n        }\n    }\n}\n\ncrawl(configAttributes, dfltConfig);\n\nmodule.exports = {\n    configAttributes: configAttributes,\n    dfltConfig: dfltConfig\n};\n","'use strict';\n\nvar Registry = require('../registry');\nvar Lib = require('../lib');\n\nvar baseAttributes = require('../plots/attributes');\nvar baseLayoutAttributes = require('../plots/layout_attributes');\nvar frameAttributes = require('../plots/frame_attributes');\nvar animationAttributes = require('../plots/animation_attributes');\nvar configAttributes = require('./plot_config').configAttributes;\n\nvar editTypes = require('./edit_types');\n\nvar extendDeepAll = Lib.extendDeepAll;\nvar isPlainObject = Lib.isPlainObject;\nvar isArrayOrTypedArray = Lib.isArrayOrTypedArray;\nvar nestedProperty = Lib.nestedProperty;\nvar valObjectMeta = Lib.valObjectMeta;\n\nvar IS_SUBPLOT_OBJ = '_isSubplotObj';\nvar IS_LINKED_TO_ARRAY = '_isLinkedToArray';\nvar ARRAY_ATTR_REGEXPS = '_arrayAttrRegexps';\nvar DEPRECATED = '_deprecated';\nvar UNDERSCORE_ATTRS = [IS_SUBPLOT_OBJ, IS_LINKED_TO_ARRAY, ARRAY_ATTR_REGEXPS, DEPRECATED];\n\nexports.IS_SUBPLOT_OBJ = IS_SUBPLOT_OBJ;\nexports.IS_LINKED_TO_ARRAY = IS_LINKED_TO_ARRAY;\nexports.DEPRECATED = DEPRECATED;\nexports.UNDERSCORE_ATTRS = UNDERSCORE_ATTRS;\n\n/** Outputs the full plotly.js plot schema\n *\n * @return {object}\n *  - defs\n *  - traces\n *  - layout\n *  - transforms\n *  - frames\n *  - animations\n *  - config\n */\nexports.get = function() {\n    var traces = {};\n\n    Registry.allTypes.forEach(function(type) {\n        traces[type] = getTraceAttributes(type);\n    });\n\n    var transforms = {};\n\n    Object.keys(Registry.transformsRegistry).forEach(function(type) {\n        transforms[type] = getTransformAttributes(type);\n    });\n\n    return {\n        defs: {\n            valObjects: valObjectMeta,\n            metaKeys: UNDERSCORE_ATTRS.concat(['description', 'role', 'editType', 'impliedEdits']),\n            editType: {\n                traces: editTypes.traces,\n                layout: editTypes.layout\n            },\n            impliedEdits: {\n                description: [\n                    'Sometimes when an attribute is changed, other attributes',\n                    'must be altered as well in order to achieve the intended',\n                    'result. For example, when `range` is specified, it is',\n                    'important to set `autorange` to `false` or the new `range`',\n                    'value would be lost in the redraw. `impliedEdits` is the',\n                    'mechanism to do this: `impliedEdits: {autorange: false}`.',\n                    'Each key is a relative paths to the attribute string to',\n                    'change, using *^* to ascend into the parent container,',\n                    'for example `range[0]` has `impliedEdits: {*^autorange*: false}`.',\n                    'A value of `undefined` means that the attribute will not be',\n                    'changed, but its previous value should be recorded in case',\n                    'we want to reverse this change later. For example, `autorange`',\n                    'has `impliedEdits: {*range[0]*: undefined, *range[1]*:undefined}',\n                    'because the range will likely be changed by redraw.'\n                ].join(' ')\n            }\n        },\n\n        traces: traces,\n        layout: getLayoutAttributes(),\n\n        transforms: transforms,\n\n        frames: getFramesAttributes(),\n        animation: formatAttributes(animationAttributes),\n\n        config: formatAttributes(configAttributes)\n    };\n};\n\n/**\n * Crawl the attribute tree, recursively calling a callback function\n *\n * @param {object} attrs\n *  The node of the attribute tree (e.g. the root) from which recursion originates\n * @param {Function} callback\n *  A callback function with the signature:\n *          @callback callback\n *          @param {object} attr an attribute\n *          @param {String} attrName name string\n *          @param {object[]} attrs all the attributes\n *          @param {Number} level the recursion level, 0 at the root\n *          @param {String} fullAttrString full attribute name (ie 'marker.line')\n * @param {Number} [specifiedLevel]\n *  The level in the tree, in order to let the callback function detect descend or backtrack,\n *  typically unsupplied (implied 0), just used by the self-recursive call.\n *  The necessity arises because the tree traversal is not controlled by callback return values.\n *  The decision to not use callback return values for controlling tree pruning arose from\n *  the goal of keeping the crawler backwards compatible. Observe that one of the pruning conditions\n *  precedes the callback call.\n * @param {string} [attrString]\n *  the path to the current attribute, as an attribute string (ie 'marker.line')\n *  typically unsupplied, but you may supply it if you want to disambiguate which attrs tree you\n *  are starting from\n *\n * @return {object} transformOut\n *  copy of transformIn that contains attribute defaults\n */\nexports.crawl = function(attrs, callback, specifiedLevel, attrString) {\n    var level = specifiedLevel || 0;\n    attrString = attrString || '';\n\n    Object.keys(attrs).forEach(function(attrName) {\n        var attr = attrs[attrName];\n\n        if(UNDERSCORE_ATTRS.indexOf(attrName) !== -1) return;\n\n        var fullAttrString = (attrString ? attrString + '.' : '') + attrName;\n        callback(attr, attrName, attrs, level, fullAttrString);\n\n        if(exports.isValObject(attr)) return;\n\n        if(isPlainObject(attr) && attrName !== 'impliedEdits') {\n            exports.crawl(attr, callback, level + 1, fullAttrString);\n        }\n    });\n};\n\n/** Is object a value object (or a container object)?\n *\n * @param {object} obj\n * @return {boolean}\n *  returns true for a valid value object and\n *  false for tree nodes in the attribute hierarchy\n */\nexports.isValObject = function(obj) {\n    return obj && obj.valType !== undefined;\n};\n\n/**\n * Find all data array attributes in a given trace object - including\n * `arrayOk` attributes.\n *\n * @param {object} trace\n *  full trace object that contains a reference to `_module.attributes`\n *\n * @return {array} arrayAttributes\n *  list of array attributes for the given trace\n */\nexports.findArrayAttributes = function(trace) {\n    var arrayAttributes = [];\n    var stack = [];\n    var isArrayStack = [];\n    var baseContainer, baseAttrName;\n\n    function callback(attr, attrName, attrs, level) {\n        stack = stack.slice(0, level).concat([attrName]);\n        isArrayStack = isArrayStack.slice(0, level).concat([attr && attr._isLinkedToArray]);\n\n        var splittableAttr = (\n            attr &&\n            (attr.valType === 'data_array' || attr.arrayOk === true) &&\n            !(stack[level - 1] === 'colorbar' && (attrName === 'ticktext' || attrName === 'tickvals'))\n        );\n\n        // Manually exclude 'colorbar.tickvals' and 'colorbar.ticktext' for now\n        // which are declared as `valType: 'data_array'` but scale independently of\n        // the coordinate arrays.\n        //\n        // Down the road, we might want to add a schema field (e.g `uncorrelatedArray: true`)\n        // to distinguish attributes of the likes.\n\n        if(!splittableAttr) return;\n\n        crawlIntoTrace(baseContainer, 0, '');\n    }\n\n    function crawlIntoTrace(container, i, astrPartial) {\n        var item = container[stack[i]];\n        var newAstrPartial = astrPartial + stack[i];\n        if(i === stack.length - 1) {\n            if(isArrayOrTypedArray(item)) {\n                arrayAttributes.push(baseAttrName + newAstrPartial);\n            }\n        } else {\n            if(isArrayStack[i]) {\n                if(Array.isArray(item)) {\n                    for(var j = 0; j < item.length; j++) {\n                        if(isPlainObject(item[j])) {\n                            crawlIntoTrace(item[j], i + 1, newAstrPartial + '[' + j + '].');\n                        }\n                    }\n                }\n            } else if(isPlainObject(item)) {\n                crawlIntoTrace(item, i + 1, newAstrPartial + '.');\n            }\n        }\n    }\n\n    baseContainer = trace;\n    baseAttrName = '';\n    exports.crawl(baseAttributes, callback);\n    if(trace._module && trace._module.attributes) {\n        exports.crawl(trace._module.attributes, callback);\n    }\n\n    var transforms = trace.transforms;\n    if(transforms) {\n        for(var i = 0; i < transforms.length; i++) {\n            var transform = transforms[i];\n            var module = transform._module;\n\n            if(module) {\n                baseAttrName = 'transforms[' + i + '].';\n                baseContainer = transform;\n\n                exports.crawl(module.attributes, callback);\n            }\n        }\n    }\n\n    return arrayAttributes;\n};\n\n/*\n * Find the valObject for one attribute in an existing trace\n *\n * @param {object} trace\n *  full trace object that contains a reference to `_module.attributes`\n * @param {object} parts\n *  an array of parts, like ['transforms', 1, 'value']\n *  typically from nestedProperty(...).parts\n *\n * @return {object|false}\n *  the valObject for this attribute, or the last found parent\n *  in some cases the innermost valObject will not exist, for example\n *  `valType: 'any'` attributes where we might set a part of the attribute.\n *  In that case, stop at the deepest valObject we *do* find.\n */\nexports.getTraceValObject = function(trace, parts) {\n    var head = parts[0];\n    var i = 1; // index to start recursing from\n    var moduleAttrs, valObject;\n\n    if(head === 'transforms') {\n        if(parts.length === 1) {\n            return baseAttributes.transforms;\n        }\n        var transforms = trace.transforms;\n        if(!Array.isArray(transforms) || !transforms.length) return false;\n        var tNum = parts[1];\n        if(!isIndex(tNum) || tNum >= transforms.length) {\n            return false;\n        }\n        moduleAttrs = (Registry.transformsRegistry[transforms[tNum].type] || {}).attributes;\n        valObject = moduleAttrs && moduleAttrs[parts[2]];\n        i = 3; // start recursing only inside the transform\n    } else {\n        // first look in the module for this trace\n        // components have already merged their trace attributes in here\n        var _module = trace._module;\n        if(!_module) _module = (Registry.modules[trace.type || baseAttributes.type.dflt] || {})._module;\n        if(!_module) return false;\n\n        moduleAttrs = _module.attributes;\n        valObject = moduleAttrs && moduleAttrs[head];\n\n        // then look in the subplot attributes\n        if(!valObject) {\n            var subplotModule = _module.basePlotModule;\n            if(subplotModule && subplotModule.attributes) {\n                valObject = subplotModule.attributes[head];\n            }\n        }\n\n        // finally look in the global attributes\n        if(!valObject) valObject = baseAttributes[head];\n    }\n\n    return recurseIntoValObject(valObject, parts, i);\n};\n\n/*\n * Find the valObject for one layout attribute\n *\n * @param {array} parts\n *  an array of parts, like ['annotations', 1, 'x']\n *  typically from nestedProperty(...).parts\n *\n * @return {object|false}\n *  the valObject for this attribute, or the last found parent\n *  in some cases the innermost valObject will not exist, for example\n *  `valType: 'any'` attributes where we might set a part of the attribute.\n *  In that case, stop at the deepest valObject we *do* find.\n */\nexports.getLayoutValObject = function(fullLayout, parts) {\n    var valObject = layoutHeadAttr(fullLayout, parts[0]);\n\n    return recurseIntoValObject(valObject, parts, 1);\n};\n\nfunction layoutHeadAttr(fullLayout, head) {\n    var i, key, _module, attributes;\n\n    // look for attributes of the subplot types used on the plot\n    var basePlotModules = fullLayout._basePlotModules;\n    if(basePlotModules) {\n        var out;\n        for(i = 0; i < basePlotModules.length; i++) {\n            _module = basePlotModules[i];\n            if(_module.attrRegex && _module.attrRegex.test(head)) {\n                // if a module defines overrides, these take precedence\n                // initially this is to allow gl2d different editTypes from svg cartesian\n                if(_module.layoutAttrOverrides) return _module.layoutAttrOverrides;\n\n                // otherwise take the first attributes we find\n                if(!out && _module.layoutAttributes) out = _module.layoutAttributes;\n            }\n\n            // a module can also override the behavior of base (and component) module layout attrs\n            // again see gl2d for initial use case\n            var baseOverrides = _module.baseLayoutAttrOverrides;\n            if(baseOverrides && head in baseOverrides) return baseOverrides[head];\n        }\n        if(out) return out;\n    }\n\n    // look for layout attributes contributed by traces on the plot\n    var modules = fullLayout._modules;\n    if(modules) {\n        for(i = 0; i < modules.length; i++) {\n            attributes = modules[i].layoutAttributes;\n            if(attributes && head in attributes) {\n                return attributes[head];\n            }\n        }\n    }\n\n    /*\n     * Next look in components.\n     * Components that define a schema have already merged this into\n     * base and subplot attribute defs, so ignore these.\n     * Others (older style) all put all their attributes\n     * inside a container matching the module `name`\n     * eg `attributes` (array) or `legend` (object)\n     */\n    for(key in Registry.componentsRegistry) {\n        _module = Registry.componentsRegistry[key];\n        if(_module.name === 'colorscale' && head.indexOf('coloraxis') === 0) {\n            return _module.layoutAttributes[head];\n        } else if(!_module.schema && (head === _module.name)) {\n            return _module.layoutAttributes;\n        }\n    }\n\n    if(head in baseLayoutAttributes) return baseLayoutAttributes[head];\n\n    return false;\n}\n\nfunction recurseIntoValObject(valObject, parts, i) {\n    if(!valObject) return false;\n\n    if(valObject._isLinkedToArray) {\n        // skip array index, abort if we try to dive into an array without an index\n        if(isIndex(parts[i])) i++;\n        else if(i < parts.length) return false;\n    }\n\n    // now recurse as far as we can. Occasionally we have an attribute\n    // setting an internal part below what's in the schema; just return\n    // the innermost schema item we find.\n    for(; i < parts.length; i++) {\n        var newValObject = valObject[parts[i]];\n        if(isPlainObject(newValObject)) valObject = newValObject;\n        else break;\n\n        if(i === parts.length - 1) break;\n\n        if(valObject._isLinkedToArray) {\n            i++;\n            if(!isIndex(parts[i])) return false;\n        } else if(valObject.valType === 'info_array') {\n            i++;\n            var index = parts[i];\n            if(!isIndex(index)) return false;\n\n            var items = valObject.items;\n            if(Array.isArray(items)) {\n                if(index >= items.length) return false;\n                if(valObject.dimensions === 2) {\n                    i++;\n                    if(parts.length === i) return valObject;\n                    var index2 = parts[i];\n                    if(!isIndex(index2)) return false;\n                    valObject = items[index][index2];\n                } else valObject = items[index];\n            } else {\n                valObject = items;\n            }\n        }\n    }\n\n    return valObject;\n}\n\n// note: this is different from Lib.isIndex, this one doesn't accept numeric\n// strings, only actual numbers.\nfunction isIndex(val) {\n    return val === Math.round(val) && val >= 0;\n}\n\nfunction getTraceAttributes(type) {\n    var _module, basePlotModule;\n\n    _module = Registry.modules[type]._module,\n    basePlotModule = _module.basePlotModule;\n\n    var attributes = {};\n\n    // make 'type' the first attribute in the object\n    attributes.type = null;\n\n    var copyBaseAttributes = extendDeepAll({}, baseAttributes);\n    var copyModuleAttributes = extendDeepAll({}, _module.attributes);\n\n    // prune global-level trace attributes that are already defined in a trace\n    exports.crawl(copyModuleAttributes, function(attr, attrName, attrs, level, fullAttrString) {\n        nestedProperty(copyBaseAttributes, fullAttrString).set(undefined);\n        // Prune undefined attributes\n        if(attr === undefined) nestedProperty(copyModuleAttributes, fullAttrString).set(undefined);\n    });\n\n    // base attributes (same for all trace types)\n    extendDeepAll(attributes, copyBaseAttributes);\n\n    // prune-out base attributes based on trace module categories\n    if(Registry.traceIs(type, 'noOpacity')) {\n        delete attributes.opacity;\n    }\n    if(!Registry.traceIs(type, 'showLegend')) {\n        delete attributes.showlegend;\n        delete attributes.legendgroup;\n    }\n    if(Registry.traceIs(type, 'noHover')) {\n        delete attributes.hoverinfo;\n        delete attributes.hoverlabel;\n    }\n    if(!_module.selectPoints) {\n        delete attributes.selectedpoints;\n    }\n\n    // module attributes\n    extendDeepAll(attributes, copyModuleAttributes);\n\n    // subplot attributes\n    if(basePlotModule.attributes) {\n        extendDeepAll(attributes, basePlotModule.attributes);\n    }\n\n    // 'type' gets overwritten by baseAttributes; reset it here\n    attributes.type = type;\n\n    var out = {\n        meta: _module.meta || {},\n        categories: _module.categories || {},\n        animatable: Boolean(_module.animatable),\n        type: type,\n        attributes: formatAttributes(attributes),\n    };\n\n    // trace-specific layout attributes\n    if(_module.layoutAttributes) {\n        var layoutAttributes = {};\n\n        extendDeepAll(layoutAttributes, _module.layoutAttributes);\n        out.layoutAttributes = formatAttributes(layoutAttributes);\n    }\n\n    // drop anim:true in non-animatable modules\n    if(!_module.animatable) {\n        exports.crawl(out, function(attr) {\n            if(exports.isValObject(attr) && 'anim' in attr) {\n                delete attr.anim;\n            }\n        });\n    }\n\n    return out;\n}\n\nfunction getLayoutAttributes() {\n    var layoutAttributes = {};\n    var key, _module;\n\n    // global layout attributes\n    extendDeepAll(layoutAttributes, baseLayoutAttributes);\n\n    // add base plot module layout attributes\n    for(key in Registry.subplotsRegistry) {\n        _module = Registry.subplotsRegistry[key];\n\n        if(!_module.layoutAttributes) continue;\n\n        if(Array.isArray(_module.attr)) {\n            for(var i = 0; i < _module.attr.length; i++) {\n                handleBasePlotModule(layoutAttributes, _module, _module.attr[i]);\n            }\n        } else {\n            var astr = _module.attr === 'subplot' ? _module.name : _module.attr;\n            handleBasePlotModule(layoutAttributes, _module, astr);\n        }\n    }\n\n    // add registered components layout attributes\n    for(key in Registry.componentsRegistry) {\n        _module = Registry.componentsRegistry[key];\n        var schema = _module.schema;\n\n        if(schema && (schema.subplots || schema.layout)) {\n            /*\n             * Components with defined schema have already been merged in at register time\n             * but a few components define attributes that apply only to xaxis\n             * not yaxis (rangeselector, rangeslider) - delete from y schema.\n             * Note that the input attributes for xaxis/yaxis are the same object\n             * so it's not possible to only add them to xaxis from the start.\n             * If we ever have such asymmetry the other way, or anywhere else,\n             * we will need to extend both this code and mergeComponentAttrsToSubplot\n             * (which will not find yaxis only for example)\n             */\n            var subplots = schema.subplots;\n            if(subplots && subplots.xaxis && !subplots.yaxis) {\n                for(var xkey in subplots.xaxis) {\n                    delete layoutAttributes.yaxis[xkey];\n                }\n            }\n        } else if(_module.name === 'colorscale') {\n            extendDeepAll(layoutAttributes, _module.layoutAttributes);\n        } else if(_module.layoutAttributes) {\n            // older style without schema need to be explicitly merged in now\n            insertAttrs(layoutAttributes, _module.layoutAttributes, _module.name);\n        }\n    }\n\n    return {\n        layoutAttributes: formatAttributes(layoutAttributes)\n    };\n}\n\nfunction getTransformAttributes(type) {\n    var _module = Registry.transformsRegistry[type];\n    var attributes = extendDeepAll({}, _module.attributes);\n\n    // add registered components transform attributes\n    Object.keys(Registry.componentsRegistry).forEach(function(k) {\n        var _module = Registry.componentsRegistry[k];\n\n        if(_module.schema && _module.schema.transforms && _module.schema.transforms[type]) {\n            Object.keys(_module.schema.transforms[type]).forEach(function(v) {\n                insertAttrs(attributes, _module.schema.transforms[type][v], v);\n            });\n        }\n    });\n\n    return {\n        attributes: formatAttributes(attributes)\n    };\n}\n\nfunction getFramesAttributes() {\n    var attrs = {\n        frames: extendDeepAll({}, frameAttributes)\n    };\n\n    formatAttributes(attrs);\n\n    return attrs.frames;\n}\n\nfunction formatAttributes(attrs) {\n    mergeValTypeAndRole(attrs);\n    formatArrayContainers(attrs);\n    stringify(attrs);\n\n    return attrs;\n}\n\nfunction mergeValTypeAndRole(attrs) {\n    function makeSrcAttr(attrName) {\n        return {\n            valType: 'string',\n            description: [\n                'Sets the source reference on Chart Studio Cloud for ',\n                attrName, '.'\n            ].join(' '),\n            editType: 'none'\n        };\n    }\n\n    function callback(attr, attrName, attrs) {\n        if(exports.isValObject(attr)) {\n            if(attr.arrayOk === true || attr.valType === 'data_array') {\n                // all 'arrayOk' and 'data_array' attrs have a corresponding 'src' attr\n                attrs[attrName + 'src'] = makeSrcAttr(attrName);\n            }\n        } else if(isPlainObject(attr)) {\n            // all attrs container objects get role 'object'\n            attr.role = 'object';\n        }\n    }\n\n    exports.crawl(attrs, callback);\n}\n\nfunction formatArrayContainers(attrs) {\n    function callback(attr, attrName, attrs) {\n        if(!attr) return;\n\n        var itemName = attr[IS_LINKED_TO_ARRAY];\n\n        if(!itemName) return;\n\n        delete attr[IS_LINKED_TO_ARRAY];\n\n        attrs[attrName] = { items: {} };\n        attrs[attrName].items[itemName] = attr;\n        attrs[attrName].role = 'object';\n    }\n\n    exports.crawl(attrs, callback);\n}\n\n// this can take around 10ms and should only be run from PlotSchema.get(),\n// to ensure JSON.stringify(PlotSchema.get()) gives the intended result.\nfunction stringify(attrs) {\n    function walk(attr) {\n        for(var k in attr) {\n            if(isPlainObject(attr[k])) {\n                walk(attr[k]);\n            } else if(Array.isArray(attr[k])) {\n                for(var i = 0; i < attr[k].length; i++) {\n                    walk(attr[k][i]);\n                }\n            } else {\n                // as JSON.stringify(/test/) // => {}\n                if(attr[k] instanceof RegExp) {\n                    attr[k] = attr[k].toString();\n                }\n            }\n        }\n    }\n\n    walk(attrs);\n}\n\n\nfunction handleBasePlotModule(layoutAttributes, _module, astr) {\n    var np = nestedProperty(layoutAttributes, astr);\n    var attrs = extendDeepAll({}, _module.layoutAttributes);\n\n    attrs[IS_SUBPLOT_OBJ] = true;\n    np.set(attrs);\n}\n\nfunction insertAttrs(baseAttrs, newAttrs, astr) {\n    var np = nestedProperty(baseAttrs, astr);\n\n    np.set(extendDeepAll(np.get() || {}, newAttrs));\n}\n","'use strict';\n\nvar Lib = require('../lib');\nvar plotAttributes = require('../plots/attributes');\n\nvar TEMPLATEITEMNAME = 'templateitemname';\n\nvar templateAttrs = {\n    name: {\n        valType: 'string',\n        editType: 'none',\n        description: [\n            'When used in a template, named items are created in the output figure',\n            'in addition to any items the figure already has in this array.',\n            'You can modify these items in the output figure by making your own',\n            'item with `templateitemname` matching this `name`',\n            'alongside your modifications (including `visible: false` or',\n            '`enabled: false` to hide it).',\n            'Has no effect outside of a template.'\n        ].join(' ')\n    }\n};\ntemplateAttrs[TEMPLATEITEMNAME] = {\n    valType: 'string',\n    editType: 'calc',\n    description: [\n        'Used to refer to a named item in this array in the template. Named',\n        'items from the template will be created even without a matching item',\n        'in the input figure, but you can modify one by making an item with',\n        '`templateitemname` matching its `name`, alongside your modifications',\n        '(including `visible: false` or `enabled: false` to hide it).',\n        'If there is no template or no matching item, this item will be',\n        'hidden unless you explicitly show it with `visible: true`.'\n    ].join(' ')\n};\n\n/**\n * templatedArray: decorate an attributes object with templating (and array)\n * properties.\n *\n * @param {string} name: the singular form of the array name. Sets\n *     `_isLinkedToArray` to this, so the schema knows to treat this as an array.\n * @param {object} attrs: the item attributes. Since all callers are expected\n *     to be constructing this object on the spot, we mutate it here for\n *     performance, rather than extending a new object with it.\n *\n * @returns {object}: the decorated `attrs` object\n */\nexports.templatedArray = function(name, attrs) {\n    attrs._isLinkedToArray = name;\n    attrs.name = templateAttrs.name;\n    attrs[TEMPLATEITEMNAME] = templateAttrs[TEMPLATEITEMNAME];\n    return attrs;\n};\n\n/**\n * traceTemplater: logic for matching traces to trace templates\n *\n * @param {object} dataTemplate: collection of {traceType: [{template}, ...]}\n *     ie each type the template applies to contains a list of template objects,\n *     to be provided cyclically to data traces of that type.\n *\n * @returns {object}: {newTrace}, a function:\n *     newTrace(traceIn): that takes the input traceIn, coerces its type, then\n *         uses that type to find the next template to apply. returns the output\n *         traceOut with template attached, ready to continue supplyDefaults.\n */\nexports.traceTemplater = function(dataTemplate) {\n    var traceCounts = {};\n    var traceType, typeTemplates;\n\n    for(traceType in dataTemplate) {\n        typeTemplates = dataTemplate[traceType];\n        if(Array.isArray(typeTemplates) && typeTemplates.length) {\n            traceCounts[traceType] = 0;\n        }\n    }\n\n    function newTrace(traceIn) {\n        traceType = Lib.coerce(traceIn, {}, plotAttributes, 'type');\n        var traceOut = {type: traceType, _template: null};\n        if(traceType in traceCounts) {\n            typeTemplates = dataTemplate[traceType];\n            // cycle through traces in the template set for this type\n            var typei = traceCounts[traceType] % typeTemplates.length;\n            traceCounts[traceType]++;\n            traceOut._template = typeTemplates[typei];\n        } else {\n            // TODO: anything we should do for types missing from the template?\n            // try to apply some other type? Or just bail as we do here?\n            // Actually I think yes, we should apply other types; would be nice\n            // if all scatter* could inherit from each other, and if histogram\n            // could inherit from bar, etc... but how to specify this? And do we\n            // compose them, or if a type is present require it to be complete?\n            // Actually this could apply to layout too - 3D annotations\n            // inheriting from 2D, axes of different types inheriting from each\n            // other...\n        }\n        return traceOut;\n    }\n\n    return {\n        newTrace: newTrace\n        // TODO: function to figure out what's left & what didn't work\n    };\n};\n\n/**\n * newContainer: Create a new sub-container inside `container` and propagate any\n * applicable template to it. If there's no template, still propagates\n * `undefined` so relinkPrivate will not retain an old template!\n *\n * @param {object} container: the outer container, should already have _template\n *     if there *is* a template for this plot\n * @param {string} name: the key of the new container to make\n * @param {string} baseName: if applicable, a base attribute to take the\n *     template from, ie for xaxis3 the base would be xaxis\n *\n * @returns {object}: an object for inclusion _full*, empty except for the\n *     appropriate template piece\n */\nexports.newContainer = function(container, name, baseName) {\n    var template = container._template;\n    var part = template && (template[name] || (baseName && template[baseName]));\n    if(!Lib.isPlainObject(part)) part = null;\n\n    var out = container[name] = {_template: part};\n    return out;\n};\n\n/**\n * arrayTemplater: special logic for templating both defaults and specific items\n * in a container array (annotations etc)\n *\n * @param {object} container: the outer container, should already have _template\n *     if there *is* a template for this plot\n * @param {string} name: the name of the array to template (ie 'annotations')\n *     will be used to find default ('annotationdefaults' object) and specific\n *     ('annotations' array) template specs.\n * @param {string} inclusionAttr: the attribute determining this item's\n *     inclusion in the output, usually 'visible' or 'enabled'\n *\n * @returns {object}: {newItem, defaultItems}, both functions:\n *     newItem(itemIn): create an output item, bare except for the correct\n *         template and name(s), as the base for supplyDefaults\n *     defaultItems(): to be called after all newItem calls, return any\n *         specific template items that have not already beeen included,\n *         also as bare output items ready for supplyDefaults.\n */\nexports.arrayTemplater = function(container, name, inclusionAttr) {\n    var template = container._template;\n    var defaultsTemplate = template && template[arrayDefaultKey(name)];\n    var templateItems = template && template[name];\n    if(!Array.isArray(templateItems) || !templateItems.length) {\n        templateItems = [];\n    }\n\n    var usedNames = {};\n\n    function newItem(itemIn) {\n        // include name and templateitemname in the output object for ALL\n        // container array items. Note: you could potentially use different\n        // name and templateitemname, if you're using one template to make\n        // another template. templateitemname would be the name in the original\n        // template, and name is the new \"subclassed\" item name.\n        var out = {name: itemIn.name, _input: itemIn};\n        var templateItemName = out[TEMPLATEITEMNAME] = itemIn[TEMPLATEITEMNAME];\n\n        // no itemname: use the default template\n        if(!validItemName(templateItemName)) {\n            out._template = defaultsTemplate;\n            return out;\n        }\n\n        // look for an item matching this itemname\n        // note these do not inherit from the default template, only the item.\n        for(var i = 0; i < templateItems.length; i++) {\n            var templateItem = templateItems[i];\n            if(templateItem.name === templateItemName) {\n                // Note: it's OK to use a template item more than once\n                // but using it at least once will stop it from generating\n                // a default item at the end.\n                usedNames[templateItemName] = 1;\n                out._template = templateItem;\n                return out;\n            }\n        }\n\n        // Didn't find a matching template item, so since this item is intended\n        // to only be modifications it's most likely broken. Hide it unless\n        // it's explicitly marked visible - in which case it gets NO template,\n        // not even the default.\n        out[inclusionAttr] = itemIn[inclusionAttr] || false;\n        // special falsy value we can look for in validateTemplate\n        out._template = false;\n        return out;\n    }\n\n    function defaultItems() {\n        var out = [];\n        for(var i = 0; i < templateItems.length; i++) {\n            var templateItem = templateItems[i];\n            var name = templateItem.name;\n            // only allow named items to be added as defaults,\n            // and only allow each name once\n            if(validItemName(name) && !usedNames[name]) {\n                var outi = {\n                    _template: templateItem,\n                    name: name,\n                    _input: {_templateitemname: name}\n                };\n                outi[TEMPLATEITEMNAME] = templateItem[TEMPLATEITEMNAME];\n                out.push(outi);\n                usedNames[name] = 1;\n            }\n        }\n        return out;\n    }\n\n    return {\n        newItem: newItem,\n        defaultItems: defaultItems\n    };\n};\n\nfunction validItemName(name) {\n    return name && typeof name === 'string';\n}\n\nfunction arrayDefaultKey(name) {\n    var lastChar = name.length - 1;\n    if(name.charAt(lastChar) !== 's') {\n        Lib.warn('bad argument to arrayDefaultKey: ' + name);\n    }\n    return name.substr(0, name.length - 1) + 'defaults';\n}\nexports.arrayDefaultKey = arrayDefaultKey;\n\n/**\n * arrayEditor: helper for editing array items that may have come from\n *     template defaults (in which case they will not exist in the input yet)\n *\n * @param {object} parentIn: the input container (eg gd.layout)\n * @param {string} containerStr: the attribute string for the container inside\n *     `parentIn`.\n * @param {object} itemOut: the _full* item (eg gd._fullLayout.annotations[0])\n *     that we'll be editing. Assumed to have been created by `arrayTemplater`.\n *\n * @returns {object}: {modifyBase, modifyItem, getUpdateObj, applyUpdate}, all functions:\n *     modifyBase(attr, value): Add an update that's *not* related to the item.\n *         `attr` is the full attribute string.\n *     modifyItem(attr, value): Add an update to the item. `attr` is just the\n *         portion of the attribute string inside the item.\n *     getUpdateObj(): Get the final constructed update object, to use in\n *         `restyle` or `relayout`. Also resets the update object in case this\n *         update was canceled.\n *     applyUpdate(attr, value): optionally add an update `attr: value`,\n *         then apply it to `parent` which should be the parent of `containerIn`,\n *         ie the object to which `containerStr` is the attribute string.\n */\nexports.arrayEditor = function(parentIn, containerStr, itemOut) {\n    var lengthIn = (Lib.nestedProperty(parentIn, containerStr).get() || []).length;\n    var index = itemOut._index;\n    // Check that we are indeed off the end of this container.\n    // Otherwise a devious user could put a key `_templateitemname` in their\n    // own input and break lots of things.\n    var templateItemName = (index >= lengthIn) && (itemOut._input || {})._templateitemname;\n    if(templateItemName) index = lengthIn;\n    var itemStr = containerStr + '[' + index + ']';\n\n    var update;\n    function resetUpdate() {\n        update = {};\n        if(templateItemName) {\n            update[itemStr] = {};\n            update[itemStr][TEMPLATEITEMNAME] = templateItemName;\n        }\n    }\n    resetUpdate();\n\n    function modifyBase(attr, value) {\n        update[attr] = value;\n    }\n\n    function modifyItem(attr, value) {\n        if(templateItemName) {\n            // we're making a new object: edit that object\n            Lib.nestedProperty(update[itemStr], attr).set(value);\n        } else {\n            // we're editing an existing object: include *just* the edit\n            update[itemStr + '.' + attr] = value;\n        }\n    }\n\n    function getUpdateObj() {\n        var updateOut = update;\n        resetUpdate();\n        return updateOut;\n    }\n\n    function applyUpdate(attr, value) {\n        if(attr) modifyItem(attr, value);\n        var updateToApply = getUpdateObj();\n        for(var key in updateToApply) {\n            Lib.nestedProperty(parentIn, key).set(updateToApply[key]);\n        }\n    }\n\n    return {\n        modifyBase: modifyBase,\n        modifyItem: modifyItem,\n        getUpdateObj: getUpdateObj,\n        applyUpdate: applyUpdate\n    };\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar Registry = require('../registry');\nvar Plots = require('../plots/plots');\n\nvar Lib = require('../lib');\nvar clearGlCanvases = require('../lib/clear_gl_canvases');\n\nvar Color = require('../components/color');\nvar Drawing = require('../components/drawing');\nvar Titles = require('../components/titles');\nvar ModeBar = require('../components/modebar');\n\nvar Axes = require('../plots/cartesian/axes');\nvar alignmentConstants = require('../constants/alignment');\nvar axisConstraints = require('../plots/cartesian/constraints');\nvar enforceAxisConstraints = axisConstraints.enforce;\nvar cleanAxisConstraints = axisConstraints.clean;\nvar doAutoRange = require('../plots/cartesian/autorange').doAutoRange;\n\nvar SVG_TEXT_ANCHOR_START = 'start';\nvar SVG_TEXT_ANCHOR_MIDDLE = 'middle';\nvar SVG_TEXT_ANCHOR_END = 'end';\n\nexports.layoutStyles = function(gd) {\n    return Lib.syncOrAsync([Plots.doAutoMargin, lsInner], gd);\n};\n\nfunction overlappingDomain(xDomain, yDomain, domains) {\n    for(var i = 0; i < domains.length; i++) {\n        var existingX = domains[i][0];\n        var existingY = domains[i][1];\n\n        if(existingX[0] >= xDomain[1] || existingX[1] <= xDomain[0]) {\n            continue;\n        }\n        if(existingY[0] < yDomain[1] && existingY[1] > yDomain[0]) {\n            return true;\n        }\n    }\n    return false;\n}\n\nfunction lsInner(gd) {\n    var fullLayout = gd._fullLayout;\n    var gs = fullLayout._size;\n    var pad = gs.p;\n    var axList = Axes.list(gd, '', true);\n    var i, subplot, plotinfo, ax, xa, ya;\n\n    fullLayout._paperdiv.style({\n        width: (gd._context.responsive && fullLayout.autosize && !gd._context._hasZeroWidth && !gd.layout.width) ? '100%' : fullLayout.width + 'px',\n        height: (gd._context.responsive && fullLayout.autosize && !gd._context._hasZeroHeight && !gd.layout.height) ? '100%' : fullLayout.height + 'px'\n    })\n    .selectAll('.main-svg')\n    .call(Drawing.setSize, fullLayout.width, fullLayout.height);\n    gd._context.setBackground(gd, fullLayout.paper_bgcolor);\n\n    exports.drawMainTitle(gd);\n    ModeBar.manage(gd);\n\n    // _has('cartesian') means SVG specifically, not GL2D - but GL2D\n    // can still get here because it makes some of the SVG structure\n    // for shared features like selections.\n    if(!fullLayout._has('cartesian')) {\n        return Plots.previousPromises(gd);\n    }\n\n    function getLinePosition(ax, counterAx, side) {\n        var lwHalf = ax._lw / 2;\n\n        if(ax._id.charAt(0) === 'x') {\n            if(!counterAx) return gs.t + gs.h * (1 - (ax.position || 0)) + (lwHalf % 1);\n            else if(side === 'top') return counterAx._offset - pad - lwHalf;\n            return counterAx._offset + counterAx._length + pad + lwHalf;\n        }\n\n        if(!counterAx) return gs.l + gs.w * (ax.position || 0) + (lwHalf % 1);\n        else if(side === 'right') return counterAx._offset + counterAx._length + pad + lwHalf;\n        return counterAx._offset - pad - lwHalf;\n    }\n\n    // some preparation of axis position info\n    for(i = 0; i < axList.length; i++) {\n        ax = axList[i];\n\n        var counterAx = ax._anchorAxis;\n\n        // clear axis line positions, to be set in the subplot loop below\n        ax._linepositions = {};\n\n        // stash crispRounded linewidth so we don't need to pass gd all over the place\n        ax._lw = Drawing.crispRound(gd, ax.linewidth, 1);\n\n        // figure out the main axis line and main mirror line position.\n        // it's easier to follow the logic if we handle these separately from\n        // ax._linepositions, which are only used by mirror=allticks\n        // for non-main-subplot ticks, and mirror=all(ticks)? for zero line\n        // hiding logic\n        ax._mainLinePosition = getLinePosition(ax, counterAx, ax.side);\n        ax._mainMirrorPosition = (ax.mirror && counterAx) ?\n            getLinePosition(ax, counterAx,\n                alignmentConstants.OPPOSITE_SIDE[ax.side]) : null;\n    }\n\n    // figure out which backgrounds we need to draw,\n    // and in which layers to put them\n    var lowerBackgroundIDs = [];\n    var backgroundIds = [];\n    var lowerDomains = [];\n    // no need to draw background when paper and plot color are the same color,\n    // activate mode just for large splom (which benefit the most from this\n    // optimization), but this could apply to all cartesian subplots.\n    var noNeedForBg = (\n        Color.opacity(fullLayout.paper_bgcolor) === 1 &&\n        Color.opacity(fullLayout.plot_bgcolor) === 1 &&\n        fullLayout.paper_bgcolor === fullLayout.plot_bgcolor\n    );\n\n    for(subplot in fullLayout._plots) {\n        plotinfo = fullLayout._plots[subplot];\n\n        if(plotinfo.mainplot) {\n            // mainplot is a reference to the main plot this one is overlaid on\n            // so if it exists, this is an overlaid plot and we don't need to\n            // give it its own background\n            if(plotinfo.bg) {\n                plotinfo.bg.remove();\n            }\n            plotinfo.bg = undefined;\n        } else {\n            var xDomain = plotinfo.xaxis.domain;\n            var yDomain = plotinfo.yaxis.domain;\n            var plotgroup = plotinfo.plotgroup;\n\n            if(overlappingDomain(xDomain, yDomain, lowerDomains)) {\n                var pgNode = plotgroup.node();\n                var plotgroupBg = plotinfo.bg = Lib.ensureSingle(plotgroup, 'rect', 'bg');\n                pgNode.insertBefore(plotgroupBg.node(), pgNode.childNodes[0]);\n                backgroundIds.push(subplot);\n            } else {\n                plotgroup.select('rect.bg').remove();\n                lowerDomains.push([xDomain, yDomain]);\n                if(!noNeedForBg) {\n                    lowerBackgroundIDs.push(subplot);\n                    backgroundIds.push(subplot);\n                }\n            }\n        }\n    }\n\n    // now create all the lower-layer backgrounds at once now that\n    // we have the list of subplots that need them\n    var lowerBackgrounds = fullLayout._bgLayer.selectAll('.bg')\n        .data(lowerBackgroundIDs);\n\n    lowerBackgrounds.enter().append('rect')\n        .classed('bg', true);\n\n    lowerBackgrounds.exit().remove();\n\n    lowerBackgrounds.each(function(subplot) {\n        fullLayout._plots[subplot].bg = d3.select(this);\n    });\n\n    // style all backgrounds\n    for(i = 0; i < backgroundIds.length; i++) {\n        plotinfo = fullLayout._plots[backgroundIds[i]];\n        xa = plotinfo.xaxis;\n        ya = plotinfo.yaxis;\n\n        if(plotinfo.bg && xa._offset !== undefined && ya._offset !== undefined) {\n            plotinfo.bg\n                .call(Drawing.setRect,\n                    xa._offset - pad, ya._offset - pad,\n                    xa._length + 2 * pad, ya._length + 2 * pad)\n                .call(Color.fill, fullLayout.plot_bgcolor)\n                .style('stroke-width', 0);\n        }\n    }\n\n    if(!fullLayout._hasOnlyLargeSploms) {\n        for(subplot in fullLayout._plots) {\n            plotinfo = fullLayout._plots[subplot];\n            xa = plotinfo.xaxis;\n            ya = plotinfo.yaxis;\n\n            // Clip so that data only shows up on the plot area.\n            var clipId = plotinfo.clipId = 'clip' + fullLayout._uid + subplot + 'plot';\n\n            var plotClip = Lib.ensureSingleById(fullLayout._clips, 'clipPath', clipId, function(s) {\n                s.classed('plotclip', true)\n                    .append('rect');\n            });\n\n            plotinfo.clipRect = plotClip.select('rect').attr({\n                width: xa._length,\n                height: ya._length\n            });\n\n            Drawing.setTranslate(plotinfo.plot, xa._offset, ya._offset);\n\n            var plotClipId;\n            var layerClipId;\n\n            if(plotinfo._hasClipOnAxisFalse) {\n                plotClipId = null;\n                layerClipId = clipId;\n            } else {\n                plotClipId = clipId;\n                layerClipId = null;\n            }\n\n            Drawing.setClipUrl(plotinfo.plot, plotClipId, gd);\n\n            // stash layer clipId value (null or same as clipId)\n            // to DRY up Drawing.setClipUrl calls on trace-module and trace layers\n            // downstream\n            plotinfo.layerClipId = layerClipId;\n        }\n    }\n\n    var xLinesXLeft, xLinesXRight, xLinesYBottom, xLinesYTop,\n        leftYLineWidth, rightYLineWidth;\n    var yLinesYBottom, yLinesYTop, yLinesXLeft, yLinesXRight,\n        connectYBottom, connectYTop;\n    var extraSubplot;\n\n    function xLinePath(y) {\n        return 'M' + xLinesXLeft + ',' + y + 'H' + xLinesXRight;\n    }\n\n    function xLinePathFree(y) {\n        return 'M' + xa._offset + ',' + y + 'h' + xa._length;\n    }\n\n    function yLinePath(x) {\n        return 'M' + x + ',' + yLinesYTop + 'V' + yLinesYBottom;\n    }\n\n    function yLinePathFree(x) {\n        return 'M' + x + ',' + ya._offset + 'v' + ya._length;\n    }\n\n    function mainPath(ax, pathFn, pathFnFree) {\n        if(!ax.showline || subplot !== ax._mainSubplot) return '';\n        if(!ax._anchorAxis) return pathFnFree(ax._mainLinePosition);\n        var out = pathFn(ax._mainLinePosition);\n        if(ax.mirror) out += pathFn(ax._mainMirrorPosition);\n        return out;\n    }\n\n    for(subplot in fullLayout._plots) {\n        plotinfo = fullLayout._plots[subplot];\n        xa = plotinfo.xaxis;\n        ya = plotinfo.yaxis;\n\n        /*\n         * x lines get longer where they meet y lines, to make a crisp corner.\n         * The x lines get the padding (margin.pad) plus the y line width to\n         * fill up the corner nicely. Free x lines are excluded - they always\n         * span exactly the data area of the plot\n         *\n         *  | XXXXX\n         *  | XXXXX\n         *  |\n         *  +------\n         *     x1\n         *    -----\n         *     x2\n         */\n        var xPath = 'M0,0';\n        if(shouldShowLinesOrTicks(xa, subplot)) {\n            leftYLineWidth = findCounterAxisLineWidth(xa, 'left', ya, axList);\n            xLinesXLeft = xa._offset - (leftYLineWidth ? (pad + leftYLineWidth) : 0);\n            rightYLineWidth = findCounterAxisLineWidth(xa, 'right', ya, axList);\n            xLinesXRight = xa._offset + xa._length + (rightYLineWidth ? (pad + rightYLineWidth) : 0);\n            xLinesYBottom = getLinePosition(xa, ya, 'bottom');\n            xLinesYTop = getLinePosition(xa, ya, 'top');\n\n            // save axis line positions for extra ticks to reference\n            // each subplot that gets ticks from \"allticks\" gets an entry:\n            //    [left or bottom, right or top]\n            extraSubplot = (!xa._anchorAxis || subplot !== xa._mainSubplot);\n            if(extraSubplot && (xa.mirror === 'allticks' || xa.mirror === 'all')) {\n                xa._linepositions[subplot] = [xLinesYBottom, xLinesYTop];\n            }\n\n            xPath = mainPath(xa, xLinePath, xLinePathFree);\n            if(extraSubplot && xa.showline && (xa.mirror === 'all' || xa.mirror === 'allticks')) {\n                xPath += xLinePath(xLinesYBottom) + xLinePath(xLinesYTop);\n            }\n\n            plotinfo.xlines\n                .style('stroke-width', xa._lw + 'px')\n                .call(Color.stroke, xa.showline ?\n                    xa.linecolor : 'rgba(0,0,0,0)');\n        }\n        plotinfo.xlines.attr('d', xPath);\n\n        /*\n         * y lines that meet x axes get longer only by margin.pad, because\n         * the x axes fill in the corner space. Free y axes, like free x axes,\n         * always span exactly the data area of the plot\n         *\n         *   |   | XXXX\n         * y2| y1| XXXX\n         *   |   | XXXX\n         *       |\n         *       +-----\n         */\n        var yPath = 'M0,0';\n        if(shouldShowLinesOrTicks(ya, subplot)) {\n            connectYBottom = findCounterAxisLineWidth(ya, 'bottom', xa, axList);\n            yLinesYBottom = ya._offset + ya._length + (connectYBottom ? pad : 0);\n            connectYTop = findCounterAxisLineWidth(ya, 'top', xa, axList);\n            yLinesYTop = ya._offset - (connectYTop ? pad : 0);\n            yLinesXLeft = getLinePosition(ya, xa, 'left');\n            yLinesXRight = getLinePosition(ya, xa, 'right');\n\n            extraSubplot = (!ya._anchorAxis || subplot !== ya._mainSubplot);\n            if(extraSubplot && (ya.mirror === 'allticks' || ya.mirror === 'all')) {\n                ya._linepositions[subplot] = [yLinesXLeft, yLinesXRight];\n            }\n\n            yPath = mainPath(ya, yLinePath, yLinePathFree);\n            if(extraSubplot && ya.showline && (ya.mirror === 'all' || ya.mirror === 'allticks')) {\n                yPath += yLinePath(yLinesXLeft) + yLinePath(yLinesXRight);\n            }\n\n            plotinfo.ylines\n                .style('stroke-width', ya._lw + 'px')\n                .call(Color.stroke, ya.showline ?\n                    ya.linecolor : 'rgba(0,0,0,0)');\n        }\n        plotinfo.ylines.attr('d', yPath);\n    }\n\n    Axes.makeClipPaths(gd);\n\n    return Plots.previousPromises(gd);\n}\n\nfunction shouldShowLinesOrTicks(ax, subplot) {\n    return (ax.ticks || ax.showline) &&\n        (subplot === ax._mainSubplot || ax.mirror === 'all' || ax.mirror === 'allticks');\n}\n\n/*\n * should we draw a line on counterAx at this side of ax?\n * It's assumed that counterAx is known to overlay the subplot we're working on\n * but it may not be its main axis.\n */\nfunction shouldShowLineThisSide(ax, side, counterAx) {\n    // does counterAx get a line at all?\n    if(!counterAx.showline || !counterAx._lw) return false;\n\n    // are we drawing *all* lines for counterAx?\n    if(counterAx.mirror === 'all' || counterAx.mirror === 'allticks') return true;\n\n    var anchorAx = counterAx._anchorAxis;\n\n    // is this a free axis? free axes can only have a subplot side-line with all(ticks)? mirroring\n    if(!anchorAx) return false;\n\n    // in order to handle cases where the user forgot to anchor this axis correctly\n    // (because its default anchor has the same domain on the relevant end)\n    // check whether the relevant position is the same.\n    var sideIndex = alignmentConstants.FROM_BL[side];\n    if(counterAx.side === side) {\n        return anchorAx.domain[sideIndex] === ax.domain[sideIndex];\n    }\n    return counterAx.mirror && anchorAx.domain[1 - sideIndex] === ax.domain[1 - sideIndex];\n}\n\n/*\n * Is there another axis intersecting `side` end of `ax`?\n * First look at `counterAx` (the axis for this subplot),\n * then at all other potential counteraxes on or overlaying this subplot.\n * Take the line width from the first one that has a line.\n */\nfunction findCounterAxisLineWidth(ax, side, counterAx, axList) {\n    if(shouldShowLineThisSide(ax, side, counterAx)) {\n        return counterAx._lw;\n    }\n    for(var i = 0; i < axList.length; i++) {\n        var axi = axList[i];\n        if(axi._mainAxis === counterAx._mainAxis && shouldShowLineThisSide(ax, side, axi)) {\n            return axi._lw;\n        }\n    }\n    return 0;\n}\n\nexports.drawMainTitle = function(gd) {\n    var fullLayout = gd._fullLayout;\n\n    var textAnchor = getMainTitleTextAnchor(fullLayout);\n    var dy = getMainTitleDy(fullLayout);\n\n    Titles.draw(gd, 'gtitle', {\n        propContainer: fullLayout,\n        propName: 'title.text',\n        placeholder: fullLayout._dfltTitle.plot,\n        attributes: {\n            x: getMainTitleX(fullLayout, textAnchor),\n            y: getMainTitleY(fullLayout, dy),\n            'text-anchor': textAnchor,\n            dy: dy\n        }\n    });\n};\n\nfunction getMainTitleX(fullLayout, textAnchor) {\n    var title = fullLayout.title;\n    var gs = fullLayout._size;\n    var hPadShift = 0;\n\n    if(textAnchor === SVG_TEXT_ANCHOR_START) {\n        hPadShift = title.pad.l;\n    } else if(textAnchor === SVG_TEXT_ANCHOR_END) {\n        hPadShift = -title.pad.r;\n    }\n\n    switch(title.xref) {\n        case 'paper':\n            return gs.l + gs.w * title.x + hPadShift;\n        case 'container':\n        default:\n            return fullLayout.width * title.x + hPadShift;\n    }\n}\n\nfunction getMainTitleY(fullLayout, dy) {\n    var title = fullLayout.title;\n    var gs = fullLayout._size;\n    var vPadShift = 0;\n\n    if(dy === '0em' || !dy) {\n        vPadShift = -title.pad.b;\n    } else if(dy === alignmentConstants.CAP_SHIFT + 'em') {\n        vPadShift = title.pad.t;\n    }\n\n    if(title.y === 'auto') {\n        return gs.t / 2;\n    } else {\n        switch(title.yref) {\n            case 'paper':\n                return gs.t + gs.h - gs.h * title.y + vPadShift;\n            case 'container':\n            default:\n                return fullLayout.height - fullLayout.height * title.y + vPadShift;\n        }\n    }\n}\n\nfunction getMainTitleTextAnchor(fullLayout) {\n    var title = fullLayout.title;\n\n    var textAnchor = SVG_TEXT_ANCHOR_MIDDLE;\n    if(Lib.isRightAnchor(title)) {\n        textAnchor = SVG_TEXT_ANCHOR_END;\n    } else if(Lib.isLeftAnchor(title)) {\n        textAnchor = SVG_TEXT_ANCHOR_START;\n    }\n\n    return textAnchor;\n}\n\nfunction getMainTitleDy(fullLayout) {\n    var title = fullLayout.title;\n\n    var dy = '0em';\n    if(Lib.isTopAnchor(title)) {\n        dy = alignmentConstants.CAP_SHIFT + 'em';\n    } else if(Lib.isMiddleAnchor(title)) {\n        dy = alignmentConstants.MID_SHIFT + 'em';\n    }\n\n    return dy;\n}\n\nexports.doTraceStyle = function(gd) {\n    var calcdata = gd.calcdata;\n    var editStyleCalls = [];\n    var i;\n\n    for(i = 0; i < calcdata.length; i++) {\n        var cd = calcdata[i];\n        var cd0 = cd[0] || {};\n        var trace = cd0.trace || {};\n        var _module = trace._module || {};\n\n        // See if we need to do arraysToCalcdata\n        // call it regardless of what change we made, in case\n        // supplyDefaults brought in an array that was already\n        // in gd.data but not in gd._fullData previously\n        var arraysToCalcdata = _module.arraysToCalcdata;\n        if(arraysToCalcdata) arraysToCalcdata(cd, trace);\n\n        var editStyle = _module.editStyle;\n        if(editStyle) editStyleCalls.push({fn: editStyle, cd0: cd0});\n    }\n\n    if(editStyleCalls.length) {\n        for(i = 0; i < editStyleCalls.length; i++) {\n            var edit = editStyleCalls[i];\n            edit.fn(gd, edit.cd0);\n        }\n        clearGlCanvases(gd);\n        exports.redrawReglTraces(gd);\n    }\n\n    Plots.style(gd);\n    Registry.getComponentMethod('legend', 'draw')(gd);\n\n    return Plots.previousPromises(gd);\n};\n\nexports.doColorBars = function(gd) {\n    Registry.getComponentMethod('colorbar', 'draw')(gd);\n    return Plots.previousPromises(gd);\n};\n\n// force plot() to redo the layout and replot with the modified layout\nexports.layoutReplot = function(gd) {\n    var layout = gd.layout;\n    gd.layout = undefined;\n    return Registry.call('_doPlot', gd, '', layout);\n};\n\nexports.doLegend = function(gd) {\n    Registry.getComponentMethod('legend', 'draw')(gd);\n    return Plots.previousPromises(gd);\n};\n\nexports.doTicksRelayout = function(gd) {\n    Axes.draw(gd, 'redraw');\n\n    if(gd._fullLayout._hasOnlyLargeSploms) {\n        Registry.subplotsRegistry.splom.updateGrid(gd);\n        clearGlCanvases(gd);\n        exports.redrawReglTraces(gd);\n    }\n\n    exports.drawMainTitle(gd);\n    return Plots.previousPromises(gd);\n};\n\nexports.doModeBar = function(gd) {\n    var fullLayout = gd._fullLayout;\n\n    ModeBar.manage(gd);\n\n    for(var i = 0; i < fullLayout._basePlotModules.length; i++) {\n        var updateFx = fullLayout._basePlotModules[i].updateFx;\n        if(updateFx) updateFx(gd);\n    }\n\n    return Plots.previousPromises(gd);\n};\n\nexports.doCamera = function(gd) {\n    var fullLayout = gd._fullLayout;\n    var sceneIds = fullLayout._subplots.gl3d;\n\n    for(var i = 0; i < sceneIds.length; i++) {\n        var sceneLayout = fullLayout[sceneIds[i]];\n        var scene = sceneLayout._scene;\n\n        scene.setViewport(sceneLayout);\n    }\n};\n\nexports.drawData = function(gd) {\n    var fullLayout = gd._fullLayout;\n\n    clearGlCanvases(gd);\n\n    // loop over the base plot modules present on graph\n    var basePlotModules = fullLayout._basePlotModules;\n    for(var i = 0; i < basePlotModules.length; i++) {\n        basePlotModules[i].plot(gd);\n    }\n\n    exports.redrawReglTraces(gd);\n\n    // styling separate from drawing\n    Plots.style(gd);\n\n    // draw components that can be drawn on axes,\n    // and that do not push the margins\n    Registry.getComponentMethod('shapes', 'draw')(gd);\n    Registry.getComponentMethod('annotations', 'draw')(gd);\n    Registry.getComponentMethod('images', 'draw')(gd);\n\n    // Mark the first render as complete\n    fullLayout._replotting = false;\n\n    return Plots.previousPromises(gd);\n};\n\n// Draw (or redraw) all regl-based traces in one go,\n// useful during drag and selection where buffers of targeted traces are updated,\n// but all traces need to be redrawn following clearGlCanvases.\n//\n// Note that _module.plot for regl trace does NOT draw things\n// on the canvas, they only update the buffers.\n// Drawing is perform here.\n//\n// TODO try adding per-subplot option using gl.SCISSOR_TEST for\n// non-overlaying, disjoint subplots.\n//\n// TODO try to include parcoords in here.\n// https://github.com/plotly/plotly.js/issues/3069\nexports.redrawReglTraces = function(gd) {\n    var fullLayout = gd._fullLayout;\n\n    if(fullLayout._has('regl')) {\n        var fullData = gd._fullData;\n        var cartesianIds = [];\n        var polarIds = [];\n        var i, sp;\n\n        if(fullLayout._hasOnlyLargeSploms) {\n            fullLayout._splomGrid.draw();\n        }\n\n        // N.B.\n        // - Loop over fullData (not _splomScenes) to preserve splom trace-to-trace ordering\n        // - Fill list if subplot ids (instead of fullLayout._subplots) to handle cases where all traces\n        //   of a given module are `visible !== true`\n        for(i = 0; i < fullData.length; i++) {\n            var trace = fullData[i];\n\n            if(trace.visible === true && trace._length !== 0) {\n                if(trace.type === 'splom') {\n                    fullLayout._splomScenes[trace.uid].draw();\n                } else if(trace.type === 'scattergl') {\n                    Lib.pushUnique(cartesianIds, trace.xaxis + trace.yaxis);\n                } else if(trace.type === 'scatterpolargl') {\n                    Lib.pushUnique(polarIds, trace.subplot);\n                }\n            }\n        }\n\n        for(i = 0; i < cartesianIds.length; i++) {\n            sp = fullLayout._plots[cartesianIds[i]];\n            if(sp._scene) sp._scene.draw();\n        }\n\n        for(i = 0; i < polarIds.length; i++) {\n            sp = fullLayout[polarIds[i]]._subplot;\n            if(sp._scene) sp._scene.draw();\n        }\n    }\n};\n\nexports.doAutoRangeAndConstraints = function(gd) {\n    var axList = Axes.list(gd, '', true);\n    var ax;\n\n    var autoRangeDone = {};\n\n    for(var i = 0; i < axList.length; i++) {\n        ax = axList[i];\n\n        if(!autoRangeDone[ax._id]) {\n            autoRangeDone[ax._id] = 1;\n            cleanAxisConstraints(gd, ax);\n            doAutoRange(gd, ax);\n\n            // For matching axes, just propagate this autorange to the group.\n            // The extra arg to doAutoRange avoids recalculating the range,\n            // since doAutoRange by itself accounts for all matching axes. but\n            // there are other side-effects of doAutoRange that we still want.\n            var matchGroup = ax._matchGroup;\n            if(matchGroup) {\n                for(var id2 in matchGroup) {\n                    var ax2 = Axes.getFromId(gd, id2);\n                    doAutoRange(gd, ax2, ax.range);\n                    autoRangeDone[id2] = 1;\n                }\n            }\n        }\n    }\n\n    enforceAxisConstraints(gd);\n};\n\n// An initial paint must be completed before these components can be\n// correctly sized and the whole plot re-margined. fullLayout._replotting must\n// be set to false before these will work properly.\nexports.finalDraw = function(gd) {\n    // TODO: rangesliders really belong in marginPushers but they need to be\n    // drawn after data - can we at least get the margin pushing part separated\n    // out and done earlier?\n    Registry.getComponentMethod('rangeslider', 'draw')(gd);\n    // TODO: rangeselector only needs to be here (in addition to drawMarginPushers)\n    // because the margins need to be fully determined before we can call\n    // autorange and update axis ranges (which rangeselector needs to know which\n    // button is active). Can we break out its automargin step from its draw step?\n    Registry.getComponentMethod('rangeselector', 'draw')(gd);\n};\n\nexports.drawMarginPushers = function(gd) {\n    Registry.getComponentMethod('legend', 'draw')(gd);\n    Registry.getComponentMethod('rangeselector', 'draw')(gd);\n    Registry.getComponentMethod('sliders', 'draw')(gd);\n    Registry.getComponentMethod('updatemenus', 'draw')(gd);\n    Registry.getComponentMethod('colorbar', 'draw')(gd);\n};\n","'use strict';\n\nvar Lib = require('../lib');\nvar isPlainObject = Lib.isPlainObject;\nvar PlotSchema = require('./plot_schema');\nvar Plots = require('../plots/plots');\nvar plotAttributes = require('../plots/attributes');\nvar Template = require('./plot_template');\nvar dfltConfig = require('./plot_config').dfltConfig;\n\n/**\n * Plotly.makeTemplate: create a template off an existing figure to reuse\n * style attributes on other figures.\n *\n * Note: separated from the rest of templates because otherwise we get circular\n * references due to PlotSchema.\n *\n * @param {object|DOM element|string} figure: The figure to base the template on\n *     should contain a trace array `figure.data`\n *     and a layout object `figure.layout`\n * @returns {object} template: the extracted template - can then be used as\n *     `layout.template` in another figure.\n */\nexports.makeTemplate = function(figure) {\n    figure = Lib.isPlainObject(figure) ? figure : Lib.getGraphDiv(figure);\n    figure = Lib.extendDeep({_context: dfltConfig}, {data: figure.data, layout: figure.layout});\n    Plots.supplyDefaults(figure);\n    var data = figure.data || [];\n    var layout = figure.layout || {};\n    // copy over a few items to help follow the schema\n    layout._basePlotModules = figure._fullLayout._basePlotModules;\n    layout._modules = figure._fullLayout._modules;\n\n    var template = {\n        data: {},\n        layout: {}\n    };\n\n    /*\n     * Note: we do NOT validate template values, we just take what's in the\n     * user inputs data and layout, not the validated values in fullData and\n     * fullLayout. Even if we were to validate here, there's no guarantee that\n     * these values would still be valid when applied to a new figure, which\n     * may contain different trace modes, different axes, etc. So it's\n     * important that when applying a template we still validate the template\n     * values, rather than just using them as defaults.\n     */\n\n    data.forEach(function(trace) {\n        // TODO: What if no style info is extracted for this trace. We may\n        // not want an empty object as the null value.\n        // TODO: allow transforms to contribute to templates?\n        // as it stands they are ignored, which may be for the best...\n\n        var traceTemplate = {};\n        walkStyleKeys(trace, traceTemplate, getTraceInfo.bind(null, trace));\n\n        var traceType = Lib.coerce(trace, {}, plotAttributes, 'type');\n        var typeTemplates = template.data[traceType];\n        if(!typeTemplates) typeTemplates = template.data[traceType] = [];\n        typeTemplates.push(traceTemplate);\n    });\n\n    walkStyleKeys(layout, template.layout, getLayoutInfo.bind(null, layout));\n\n    /*\n     * Compose the new template with an existing one to the same effect\n     *\n     * NOTE: there's a possibility of slightly different behavior: if the plot\n     * has an invalid value and the old template has a valid value for the same\n     * attribute, the plot will use the old template value but this routine\n     * will pull the invalid value (resulting in the original default).\n     * In the general case it's not possible to solve this with a single value,\n     * since valid options can be context-dependent. It could be solved with\n     * a *list* of values, but that would be huge complexity for little gain.\n     */\n    delete template.layout.template;\n    var oldTemplate = layout.template;\n    if(isPlainObject(oldTemplate)) {\n        var oldLayoutTemplate = oldTemplate.layout;\n\n        var i, traceType, oldTypeTemplates, oldTypeLen, typeTemplates, typeLen;\n\n        if(isPlainObject(oldLayoutTemplate)) {\n            mergeTemplates(oldLayoutTemplate, template.layout);\n        }\n        var oldDataTemplate = oldTemplate.data;\n        if(isPlainObject(oldDataTemplate)) {\n            for(traceType in template.data) {\n                oldTypeTemplates = oldDataTemplate[traceType];\n                if(Array.isArray(oldTypeTemplates)) {\n                    typeTemplates = template.data[traceType];\n                    typeLen = typeTemplates.length;\n                    oldTypeLen = oldTypeTemplates.length;\n                    for(i = 0; i < typeLen; i++) {\n                        mergeTemplates(oldTypeTemplates[i % oldTypeLen], typeTemplates[i]);\n                    }\n                    for(i = typeLen; i < oldTypeLen; i++) {\n                        typeTemplates.push(Lib.extendDeep({}, oldTypeTemplates[i]));\n                    }\n                }\n            }\n            for(traceType in oldDataTemplate) {\n                if(!(traceType in template.data)) {\n                    template.data[traceType] = Lib.extendDeep([], oldDataTemplate[traceType]);\n                }\n            }\n        }\n    }\n\n    return template;\n};\n\nfunction mergeTemplates(oldTemplate, newTemplate) {\n    // we don't care about speed here, just make sure we have a totally\n    // distinct object from the previous template\n    oldTemplate = Lib.extendDeep({}, oldTemplate);\n\n    // sort keys so we always get annotationdefaults before annotations etc\n    // so arrayTemplater will work right\n    var oldKeys = Object.keys(oldTemplate).sort();\n    var i, j;\n\n    function mergeOne(oldVal, newVal, key) {\n        if(isPlainObject(newVal) && isPlainObject(oldVal)) {\n            mergeTemplates(oldVal, newVal);\n        } else if(Array.isArray(newVal) && Array.isArray(oldVal)) {\n            // Note: omitted `inclusionAttr` from arrayTemplater here,\n            // it's irrelevant as we only want the resulting `_template`.\n            var templater = Template.arrayTemplater({_template: oldTemplate}, key);\n            for(j = 0; j < newVal.length; j++) {\n                var item = newVal[j];\n                var oldItem = templater.newItem(item)._template;\n                if(oldItem) mergeTemplates(oldItem, item);\n            }\n            var defaultItems = templater.defaultItems();\n            for(j = 0; j < defaultItems.length; j++) newVal.push(defaultItems[j]._template);\n\n            // templateitemname only applies to receiving plots\n            for(j = 0; j < newVal.length; j++) delete newVal[j].templateitemname;\n        }\n    }\n\n    for(i = 0; i < oldKeys.length; i++) {\n        var key = oldKeys[i];\n        var oldVal = oldTemplate[key];\n        if(key in newTemplate) {\n            mergeOne(oldVal, newTemplate[key], key);\n        } else newTemplate[key] = oldVal;\n\n        // if this is a base key from the old template (eg xaxis), look for\n        // extended keys (eg xaxis2) in the new template to merge into\n        if(getBaseKey(key) === key) {\n            for(var key2 in newTemplate) {\n                var baseKey2 = getBaseKey(key2);\n                if(key2 !== baseKey2 && baseKey2 === key && !(key2 in oldTemplate)) {\n                    mergeOne(oldVal, newTemplate[key2], key);\n                }\n            }\n        }\n    }\n}\n\nfunction getBaseKey(key) {\n    return key.replace(/[0-9]+$/, '');\n}\n\nfunction walkStyleKeys(parent, templateOut, getAttributeInfo, path, basePath) {\n    var pathAttr = basePath && getAttributeInfo(basePath);\n    for(var key in parent) {\n        var child = parent[key];\n        var nextPath = getNextPath(parent, key, path);\n        var nextBasePath = getNextPath(parent, key, basePath);\n        var attr = getAttributeInfo(nextBasePath);\n        if(!attr) {\n            var baseKey = getBaseKey(key);\n            if(baseKey !== key) {\n                nextBasePath = getNextPath(parent, baseKey, basePath);\n                attr = getAttributeInfo(nextBasePath);\n            }\n        }\n\n        // we'll get an attr if path starts with a valid part, then has an\n        // invalid ending. Make sure we got all the way to the end.\n        if(pathAttr && (pathAttr === attr)) continue;\n\n        if(!attr || attr._noTemplating ||\n            attr.valType === 'data_array' ||\n            (attr.arrayOk && Array.isArray(child))\n        ) {\n            continue;\n        }\n\n        if(!attr.valType && isPlainObject(child)) {\n            walkStyleKeys(child, templateOut, getAttributeInfo, nextPath, nextBasePath);\n        } else if(attr._isLinkedToArray && Array.isArray(child)) {\n            var dfltDone = false;\n            var namedIndex = 0;\n            var usedNames = {};\n            for(var i = 0; i < child.length; i++) {\n                var item = child[i];\n                if(isPlainObject(item)) {\n                    var name = item.name;\n                    if(name) {\n                        if(!usedNames[name]) {\n                            // named array items: allow all attributes except data arrays\n                            walkStyleKeys(item, templateOut, getAttributeInfo,\n                                getNextPath(child, namedIndex, nextPath),\n                                getNextPath(child, namedIndex, nextBasePath));\n                            namedIndex++;\n                            usedNames[name] = 1;\n                        }\n                    } else if(!dfltDone) {\n                        var dfltKey = Template.arrayDefaultKey(key);\n                        var dfltPath = getNextPath(parent, dfltKey, path);\n\n                        // getAttributeInfo will fail if we try to use dfltKey directly.\n                        // Instead put this item into the next array element, then\n                        // pull it out and move it to dfltKey.\n                        var pathInArray = getNextPath(child, namedIndex, nextPath);\n                        walkStyleKeys(item, templateOut, getAttributeInfo, pathInArray,\n                            getNextPath(child, namedIndex, nextBasePath));\n                        var itemPropInArray = Lib.nestedProperty(templateOut, pathInArray);\n                        var dfltProp = Lib.nestedProperty(templateOut, dfltPath);\n                        dfltProp.set(itemPropInArray.get());\n                        itemPropInArray.set(null);\n\n                        dfltDone = true;\n                    }\n                }\n            }\n        } else {\n            var templateProp = Lib.nestedProperty(templateOut, nextPath);\n            templateProp.set(child);\n        }\n    }\n}\n\nfunction getLayoutInfo(layout, path) {\n    return PlotSchema.getLayoutValObject(\n        layout, Lib.nestedProperty({}, path).parts\n    );\n}\n\nfunction getTraceInfo(trace, path) {\n    return PlotSchema.getTraceValObject(\n        trace, Lib.nestedProperty({}, path).parts\n    );\n}\n\nfunction getNextPath(parent, key, path) {\n    var nextPath;\n    if(!path) nextPath = key;\n    else if(Array.isArray(parent)) nextPath = path + '[' + key + ']';\n    else nextPath = path + '.' + key;\n\n    return nextPath;\n}\n\n/**\n * validateTemplate: Test for consistency between the given figure and\n * a template, either already included in the figure or given separately.\n * Note that not every issue we identify here is necessarily a problem,\n * it depends on what you're using the template for.\n *\n * @param {object|DOM element} figure: the plot, with {data, layout} members,\n *     to test the template against\n * @param {Optional(object)} template: the template, with its own {data, layout},\n *     to test. If omitted, we will look for a template already attached as the\n *     plot's `layout.template` attribute.\n *\n * @returns {array} array of error objects each containing:\n *  - {string} code\n *      error code ('missing', 'unused', 'reused', 'noLayout', 'noData')\n *  - {string} msg\n *      a full readable description of the issue.\n */\nexports.validateTemplate = function(figureIn, template) {\n    var figure = Lib.extendDeep({}, {\n        _context: dfltConfig,\n        data: figureIn.data,\n        layout: figureIn.layout\n    });\n    var layout = figure.layout || {};\n    if(!isPlainObject(template)) template = layout.template || {};\n    var layoutTemplate = template.layout;\n    var dataTemplate = template.data;\n    var errorList = [];\n\n    figure.layout = layout;\n    figure.layout.template = template;\n    Plots.supplyDefaults(figure);\n\n    var fullLayout = figure._fullLayout;\n    var fullData = figure._fullData;\n\n    var layoutPaths = {};\n    function crawlLayoutForContainers(obj, paths) {\n        for(var key in obj) {\n            if(key.charAt(0) !== '_' && isPlainObject(obj[key])) {\n                var baseKey = getBaseKey(key);\n                var nextPaths = [];\n                var i;\n                for(i = 0; i < paths.length; i++) {\n                    nextPaths.push(getNextPath(obj, key, paths[i]));\n                    if(baseKey !== key) nextPaths.push(getNextPath(obj, baseKey, paths[i]));\n                }\n                for(i = 0; i < nextPaths.length; i++) {\n                    layoutPaths[nextPaths[i]] = 1;\n                }\n                crawlLayoutForContainers(obj[key], nextPaths);\n            }\n        }\n    }\n\n    function crawlLayoutTemplateForContainers(obj, path) {\n        for(var key in obj) {\n            if(key.indexOf('defaults') === -1 && isPlainObject(obj[key])) {\n                var nextPath = getNextPath(obj, key, path);\n                if(layoutPaths[nextPath]) {\n                    crawlLayoutTemplateForContainers(obj[key], nextPath);\n                } else {\n                    errorList.push({code: 'unused', path: nextPath});\n                }\n            }\n        }\n    }\n\n    if(!isPlainObject(layoutTemplate)) {\n        errorList.push({code: 'layout'});\n    } else {\n        crawlLayoutForContainers(fullLayout, ['layout']);\n        crawlLayoutTemplateForContainers(layoutTemplate, 'layout');\n    }\n\n    if(!isPlainObject(dataTemplate)) {\n        errorList.push({code: 'data'});\n    } else {\n        var typeCount = {};\n        var traceType;\n        for(var i = 0; i < fullData.length; i++) {\n            var fullTrace = fullData[i];\n            traceType = fullTrace.type;\n            typeCount[traceType] = (typeCount[traceType] || 0) + 1;\n            if(!fullTrace._fullInput._template) {\n                // this takes care of the case of traceType in the data but not\n                // the template\n                errorList.push({\n                    code: 'missing',\n                    index: fullTrace._fullInput.index,\n                    traceType: traceType\n                });\n            }\n        }\n        for(traceType in dataTemplate) {\n            var templateCount = dataTemplate[traceType].length;\n            var dataCount = typeCount[traceType] || 0;\n            if(templateCount > dataCount) {\n                errorList.push({\n                    code: 'unused',\n                    traceType: traceType,\n                    templateCount: templateCount,\n                    dataCount: dataCount\n                });\n            } else if(dataCount > templateCount) {\n                errorList.push({\n                    code: 'reused',\n                    traceType: traceType,\n                    templateCount: templateCount,\n                    dataCount: dataCount\n                });\n            }\n        }\n    }\n\n    // _template: false is when someone tried to modify an array item\n    // but there was no template with matching name\n    function crawlForMissingTemplates(obj, path) {\n        for(var key in obj) {\n            if(key.charAt(0) === '_') continue;\n            var val = obj[key];\n            var nextPath = getNextPath(obj, key, path);\n            if(isPlainObject(val)) {\n                if(Array.isArray(obj) && val._template === false && val.templateitemname) {\n                    errorList.push({\n                        code: 'missing',\n                        path: nextPath,\n                        templateitemname: val.templateitemname\n                    });\n                }\n                crawlForMissingTemplates(val, nextPath);\n            } else if(Array.isArray(val) && hasPlainObject(val)) {\n                crawlForMissingTemplates(val, nextPath);\n            }\n        }\n    }\n    crawlForMissingTemplates({data: fullData, layout: fullLayout}, '');\n\n    if(errorList.length) return errorList.map(format);\n};\n\nfunction hasPlainObject(arr) {\n    for(var i = 0; i < arr.length; i++) {\n        if(isPlainObject(arr[i])) return true;\n    }\n}\n\nfunction format(opts) {\n    var msg;\n    switch(opts.code) {\n        case 'data':\n            msg = 'The template has no key data.';\n            break;\n        case 'layout':\n            msg = 'The template has no key layout.';\n            break;\n        case 'missing':\n            if(opts.path) {\n                msg = 'There are no templates for item ' + opts.path +\n                    ' with name ' + opts.templateitemname;\n            } else {\n                msg = 'There are no templates for trace ' + opts.index +\n                    ', of type ' + opts.traceType + '.';\n            }\n            break;\n        case 'unused':\n            if(opts.path) {\n                msg = 'The template item at ' + opts.path +\n                    ' was not used in constructing the plot.';\n            } else if(opts.dataCount) {\n                msg = 'Some of the templates of type ' + opts.traceType +\n                    ' were not used. The template has ' + opts.templateCount +\n                    ' traces, the data only has ' + opts.dataCount +\n                    ' of this type.';\n            } else {\n                msg = 'The template has ' + opts.templateCount +\n                    ' traces of type ' + opts.traceType +\n                    ' but there are none in the data.';\n            }\n            break;\n        case 'reused':\n            msg = 'Some of the templates of type ' + opts.traceType +\n                ' were used more than once. The template has ' +\n                opts.templateCount + ' traces, the data has ' +\n                opts.dataCount + ' of this type.';\n            break;\n    }\n    opts.msg = msg;\n\n    return opts;\n}\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\nvar plotApi = require('./plot_api');\nvar plots = require('../plots/plots');\nvar Lib = require('../lib');\n\nvar helpers = require('../snapshot/helpers');\nvar toSVG = require('../snapshot/tosvg');\nvar svgToImg = require('../snapshot/svgtoimg');\nvar version = require('../version').version;\n\nvar attrs = {\n    format: {\n        valType: 'enumerated',\n        values: ['png', 'jpeg', 'webp', 'svg', 'full-json'],\n        dflt: 'png',\n        description: 'Sets the format of exported image.'\n    },\n    width: {\n        valType: 'number',\n        min: 1,\n        description: [\n            'Sets the exported image width.',\n            'Defaults to the value found in `layout.width`',\n            'If set to *null*, the exported image width will match the current graph width.'\n        ].join(' ')\n    },\n    height: {\n        valType: 'number',\n        min: 1,\n        description: [\n            'Sets the exported image height.',\n            'Defaults to the value found in `layout.height`',\n            'If set to *null*, the exported image height will match the current graph height.'\n        ].join(' ')\n    },\n    scale: {\n        valType: 'number',\n        min: 0,\n        dflt: 1,\n        description: [\n            'Sets a scaling for the generated image.',\n            'If set, all features of a graphs (e.g. text, line width)',\n            'are scaled, unlike simply setting',\n            'a bigger *width* and *height*.'\n        ].join(' ')\n    },\n    setBackground: {\n        valType: 'any',\n        dflt: false,\n        description: [\n            'Sets the image background mode.',\n            'By default, the image background is determined by `layout.paper_bgcolor`,',\n            'the *transparent* mode.',\n            'One might consider setting `setBackground` to *opaque*',\n            'when exporting a *jpeg* image as JPEGs do not support opacity.'\n        ].join(' ')\n    },\n    imageDataOnly: {\n        valType: 'boolean',\n        dflt: false,\n        description: [\n            'Determines whether or not the return value is prefixed by',\n            'the image format\\'s corresponding \\'data:image;\\' spec.'\n        ].join(' ')\n    }\n};\n\n/** Plotly.toImage\n *\n * @param {object | string | HTML div} gd\n *   can either be a data/layout/config object\n *   or an existing graph <div>\n *   or an id to an existing graph <div>\n * @param {object} opts (see above)\n * @return {promise}\n */\nfunction toImage(gd, opts) {\n    opts = opts || {};\n\n    var data;\n    var layout;\n    var config;\n    var fullLayout;\n\n    if(Lib.isPlainObject(gd)) {\n        data = gd.data || [];\n        layout = gd.layout || {};\n        config = gd.config || {};\n        fullLayout = {};\n    } else {\n        gd = Lib.getGraphDiv(gd);\n        data = Lib.extendDeep([], gd.data);\n        layout = Lib.extendDeep({}, gd.layout);\n        config = gd._context;\n        fullLayout = gd._fullLayout || {};\n    }\n\n    function isImpliedOrValid(attr) {\n        return !(attr in opts) || Lib.validate(opts[attr], attrs[attr]);\n    }\n\n    if((!isImpliedOrValid('width') && opts.width !== null) ||\n        (!isImpliedOrValid('height') && opts.height !== null)) {\n        throw new Error('Height and width should be pixel values.');\n    }\n\n    if(!isImpliedOrValid('format')) {\n        throw new Error('Export format is not ' + Lib.join2(attrs.format.values, ', ', ' or ') + '.');\n    }\n\n    var fullOpts = {};\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(opts, fullOpts, attrs, attr, dflt);\n    }\n\n    var format = coerce('format');\n    var width = coerce('width');\n    var height = coerce('height');\n    var scale = coerce('scale');\n    var setBackground = coerce('setBackground');\n    var imageDataOnly = coerce('imageDataOnly');\n\n    // put the cloned div somewhere off screen before attaching to DOM\n    var clonedGd = document.createElement('div');\n    clonedGd.style.position = 'absolute';\n    clonedGd.style.left = '-5000px';\n    document.body.appendChild(clonedGd);\n\n    // extend layout with image options\n    var layoutImage = Lib.extendFlat({}, layout);\n    if(width) {\n        layoutImage.width = width;\n    } else if(opts.width === null && isNumeric(fullLayout.width)) {\n        layoutImage.width = fullLayout.width;\n    }\n    if(height) {\n        layoutImage.height = height;\n    } else if(opts.height === null && isNumeric(fullLayout.height)) {\n        layoutImage.height = fullLayout.height;\n    }\n\n    // extend config for static plot\n    var configImage = Lib.extendFlat({}, config, {\n        _exportedPlot: true,\n        staticPlot: true,\n        setBackground: setBackground\n    });\n\n    var redrawFunc = helpers.getRedrawFunc(clonedGd);\n\n    function wait() {\n        return new Promise(function(resolve) {\n            setTimeout(resolve, helpers.getDelay(clonedGd._fullLayout));\n        });\n    }\n\n    function convert() {\n        return new Promise(function(resolve, reject) {\n            var svg = toSVG(clonedGd, format, scale);\n            var width = clonedGd._fullLayout.width;\n            var height = clonedGd._fullLayout.height;\n\n            function cleanup() {\n                plotApi.purge(clonedGd);\n                document.body.removeChild(clonedGd);\n            }\n\n            if(format === 'full-json') {\n                var json = plots.graphJson(clonedGd, false, 'keepdata', 'object', true, true);\n                json.version = version;\n                json = JSON.stringify(json);\n                cleanup();\n                if(imageDataOnly) {\n                    return resolve(json);\n                } else {\n                    return resolve(helpers.encodeJSON(json));\n                }\n            }\n\n            cleanup();\n\n            if(format === 'svg') {\n                if(imageDataOnly) {\n                    return resolve(svg);\n                } else {\n                    return resolve(helpers.encodeSVG(svg));\n                }\n            }\n\n            var canvas = document.createElement('canvas');\n            canvas.id = Lib.randstr();\n\n            svgToImg({\n                format: format,\n                width: width,\n                height: height,\n                scale: scale,\n                canvas: canvas,\n                svg: svg,\n                // ask svgToImg to return a Promise\n                //  rather than EventEmitter\n                //  leave EventEmitter for backward\n                //  compatibility\n                promise: true\n            })\n            .then(resolve)\n            .catch(reject);\n        });\n    }\n\n    function urlToImageData(url) {\n        if(imageDataOnly) {\n            return url.replace(helpers.IMAGE_URL_PREFIX, '');\n        } else {\n            return url;\n        }\n    }\n\n    return new Promise(function(resolve, reject) {\n        plotApi.newPlot(clonedGd, data, layoutImage, configImage)\n            .then(redrawFunc)\n            .then(wait)\n            .then(convert)\n            .then(function(url) { resolve(urlToImageData(url)); })\n            .catch(function(err) { reject(err); });\n    });\n}\n\nmodule.exports = toImage;\n","'use strict';\n\nvar Lib = require('../lib');\nvar Plots = require('../plots/plots');\nvar PlotSchema = require('./plot_schema');\nvar dfltConfig = require('./plot_config').dfltConfig;\n\nvar isPlainObject = Lib.isPlainObject;\nvar isArray = Array.isArray;\nvar isArrayOrTypedArray = Lib.isArrayOrTypedArray;\n\n/**\n * Validate a data array and layout object.\n *\n * @param {array} data\n * @param {object} layout\n *\n * @return {array} array of error objects each containing:\n *  - {string} code\n *      error code ('object', 'array', 'schema', 'unused', 'invisible' or 'value')\n *  - {string} container\n *      container where the error occurs ('data' or 'layout')\n *  - {number} trace\n *      trace index of the 'data' container where the error occurs\n *  - {array} path\n *      nested path to the key that causes the error\n *  - {string} astr\n *      attribute string variant of 'path' compatible with Plotly.restyle and\n *      Plotly.relayout.\n *  - {string} msg\n *      error message (shown in console in logger config argument is enable)\n */\nmodule.exports = function validate(data, layout) {\n    if(data === undefined) data = [];\n    if(layout === undefined) layout = {};\n\n    var schema = PlotSchema.get();\n    var errorList = [];\n    var gd = {_context: Lib.extendFlat({}, dfltConfig)};\n\n    var dataIn, layoutIn;\n\n    if(isArray(data)) {\n        gd.data = Lib.extendDeep([], data);\n        dataIn = data;\n    } else {\n        gd.data = [];\n        dataIn = [];\n        errorList.push(format('array', 'data'));\n    }\n\n    if(isPlainObject(layout)) {\n        gd.layout = Lib.extendDeep({}, layout);\n        layoutIn = layout;\n    } else {\n        gd.layout = {};\n        layoutIn = {};\n        if(arguments.length > 1) {\n            errorList.push(format('object', 'layout'));\n        }\n    }\n\n    // N.B. dataIn and layoutIn are in general not the same as\n    // gd.data and gd.layout after supplyDefaults as some attributes\n    // in gd.data and gd.layout (still) get mutated during this step.\n\n    Plots.supplyDefaults(gd);\n\n    var dataOut = gd._fullData;\n    var len = dataIn.length;\n\n    for(var i = 0; i < len; i++) {\n        var traceIn = dataIn[i];\n        var base = ['data', i];\n\n        if(!isPlainObject(traceIn)) {\n            errorList.push(format('object', base));\n            continue;\n        }\n\n        var traceOut = dataOut[i];\n        var traceType = traceOut.type;\n        var traceSchema = schema.traces[traceType].attributes;\n\n        // PlotSchema does something fancy with trace 'type', reset it here\n        // to make the trace schema compatible with Lib.validate.\n        traceSchema.type = {\n            valType: 'enumerated',\n            values: [traceType]\n        };\n\n        if(traceOut.visible === false && traceIn.visible !== false) {\n            errorList.push(format('invisible', base));\n        }\n\n        crawl(traceIn, traceOut, traceSchema, errorList, base);\n\n        var transformsIn = traceIn.transforms;\n        var transformsOut = traceOut.transforms;\n\n        if(transformsIn) {\n            if(!isArray(transformsIn)) {\n                errorList.push(format('array', base, ['transforms']));\n            }\n\n            base.push('transforms');\n\n            for(var j = 0; j < transformsIn.length; j++) {\n                var path = ['transforms', j];\n                var transformType = transformsIn[j].type;\n\n                if(!isPlainObject(transformsIn[j])) {\n                    errorList.push(format('object', base, path));\n                    continue;\n                }\n\n                var transformSchema = schema.transforms[transformType] ?\n                    schema.transforms[transformType].attributes :\n                    {};\n\n                // add 'type' to transform schema to validate the transform type\n                transformSchema.type = {\n                    valType: 'enumerated',\n                    values: Object.keys(schema.transforms)\n                };\n\n                crawl(transformsIn[j], transformsOut[j], transformSchema, errorList, base, path);\n            }\n        }\n    }\n\n    var layoutOut = gd._fullLayout;\n    var layoutSchema = fillLayoutSchema(schema, dataOut);\n\n    crawl(layoutIn, layoutOut, layoutSchema, errorList, 'layout');\n\n    // return undefined if no validation errors were found\n    return (errorList.length === 0) ? void(0) : errorList;\n};\n\nfunction crawl(objIn, objOut, schema, list, base, path) {\n    path = path || [];\n\n    var keys = Object.keys(objIn);\n\n    for(var i = 0; i < keys.length; i++) {\n        var k = keys[i];\n\n        // transforms are handled separately\n        if(k === 'transforms') continue;\n\n        var p = path.slice();\n        p.push(k);\n\n        var valIn = objIn[k];\n        var valOut = objOut[k];\n\n        var nestedSchema = getNestedSchema(schema, k);\n        var nestedValType = (nestedSchema || {}).valType;\n        var isInfoArray = nestedValType === 'info_array';\n        var isColorscale = nestedValType === 'colorscale';\n        var items = (nestedSchema || {}).items;\n\n        if(!isInSchema(schema, k)) {\n            list.push(format('schema', base, p));\n        } else if(isPlainObject(valIn) && isPlainObject(valOut) && nestedValType !== 'any') {\n            crawl(valIn, valOut, nestedSchema, list, base, p);\n        } else if(isInfoArray && isArray(valIn)) {\n            if(valIn.length > valOut.length) {\n                list.push(format('unused', base, p.concat(valOut.length)));\n            }\n            var len = valOut.length;\n            var arrayItems = Array.isArray(items);\n            if(arrayItems) len = Math.min(len, items.length);\n            var m, n, item, valInPart, valOutPart;\n            if(nestedSchema.dimensions === 2) {\n                for(n = 0; n < len; n++) {\n                    if(isArray(valIn[n])) {\n                        if(valIn[n].length > valOut[n].length) {\n                            list.push(format('unused', base, p.concat(n, valOut[n].length)));\n                        }\n                        var len2 = valOut[n].length;\n                        for(m = 0; m < (arrayItems ? Math.min(len2, items[n].length) : len2); m++) {\n                            item = arrayItems ? items[n][m] : items;\n                            valInPart = valIn[n][m];\n                            valOutPart = valOut[n][m];\n                            if(!Lib.validate(valInPart, item)) {\n                                list.push(format('value', base, p.concat(n, m), valInPart));\n                            } else if(valOutPart !== valInPart && valOutPart !== +valInPart) {\n                                list.push(format('dynamic', base, p.concat(n, m), valInPart, valOutPart));\n                            }\n                        }\n                    } else {\n                        list.push(format('array', base, p.concat(n), valIn[n]));\n                    }\n                }\n            } else {\n                for(n = 0; n < len; n++) {\n                    item = arrayItems ? items[n] : items;\n                    valInPart = valIn[n];\n                    valOutPart = valOut[n];\n                    if(!Lib.validate(valInPart, item)) {\n                        list.push(format('value', base, p.concat(n), valInPart));\n                    } else if(valOutPart !== valInPart && valOutPart !== +valInPart) {\n                        list.push(format('dynamic', base, p.concat(n), valInPart, valOutPart));\n                    }\n                }\n            }\n        } else if(nestedSchema.items && !isInfoArray && isArray(valIn)) {\n            var _nestedSchema = items[Object.keys(items)[0]];\n            var indexList = [];\n\n            var j, _p;\n\n            // loop over valOut items while keeping track of their\n            // corresponding input container index (given by _index)\n            for(j = 0; j < valOut.length; j++) {\n                var _index = valOut[j]._index || j;\n\n                _p = p.slice();\n                _p.push(_index);\n\n                if(isPlainObject(valIn[_index]) && isPlainObject(valOut[j])) {\n                    indexList.push(_index);\n                    var valInj = valIn[_index];\n                    var valOutj = valOut[j];\n                    if(isPlainObject(valInj) && valInj.visible !== false && valOutj.visible === false) {\n                        list.push(format('invisible', base, _p));\n                    } else crawl(valInj, valOutj, _nestedSchema, list, base, _p);\n                }\n            }\n\n            // loop over valIn to determine where it went wrong for some items\n            for(j = 0; j < valIn.length; j++) {\n                _p = p.slice();\n                _p.push(j);\n\n                if(!isPlainObject(valIn[j])) {\n                    list.push(format('object', base, _p, valIn[j]));\n                } else if(indexList.indexOf(j) === -1) {\n                    list.push(format('unused', base, _p));\n                }\n            }\n        } else if(!isPlainObject(valIn) && isPlainObject(valOut)) {\n            list.push(format('object', base, p, valIn));\n        } else if(!isArrayOrTypedArray(valIn) && isArrayOrTypedArray(valOut) && !isInfoArray && !isColorscale) {\n            list.push(format('array', base, p, valIn));\n        } else if(!(k in objOut)) {\n            list.push(format('unused', base, p, valIn));\n        } else if(!Lib.validate(valIn, nestedSchema)) {\n            list.push(format('value', base, p, valIn));\n        } else if(nestedSchema.valType === 'enumerated' &&\n            ((nestedSchema.coerceNumber && valIn !== +valOut) || valIn !== valOut)\n        ) {\n            list.push(format('dynamic', base, p, valIn, valOut));\n        }\n    }\n\n    return list;\n}\n\n// the 'full' layout schema depends on the traces types presents\nfunction fillLayoutSchema(schema, dataOut) {\n    var layoutSchema = schema.layout.layoutAttributes;\n\n    for(var i = 0; i < dataOut.length; i++) {\n        var traceOut = dataOut[i];\n        var traceSchema = schema.traces[traceOut.type];\n        var traceLayoutAttr = traceSchema.layoutAttributes;\n\n        if(traceLayoutAttr) {\n            if(traceOut.subplot) {\n                Lib.extendFlat(layoutSchema[traceSchema.attributes.subplot.dflt], traceLayoutAttr);\n            } else {\n                Lib.extendFlat(layoutSchema, traceLayoutAttr);\n            }\n        }\n    }\n\n    return layoutSchema;\n}\n\n// validation error codes\nvar code2msgFunc = {\n    object: function(base, astr) {\n        var prefix;\n\n        if(base === 'layout' && astr === '') prefix = 'The layout argument';\n        else if(base[0] === 'data' && astr === '') {\n            prefix = 'Trace ' + base[1] + ' in the data argument';\n        } else prefix = inBase(base) + 'key ' + astr;\n\n        return prefix + ' must be linked to an object container';\n    },\n    array: function(base, astr) {\n        var prefix;\n\n        if(base === 'data') prefix = 'The data argument';\n        else prefix = inBase(base) + 'key ' + astr;\n\n        return prefix + ' must be linked to an array container';\n    },\n    schema: function(base, astr) {\n        return inBase(base) + 'key ' + astr + ' is not part of the schema';\n    },\n    unused: function(base, astr, valIn) {\n        var target = isPlainObject(valIn) ? 'container' : 'key';\n\n        return inBase(base) + target + ' ' + astr + ' did not get coerced';\n    },\n    dynamic: function(base, astr, valIn, valOut) {\n        return [\n            inBase(base) + 'key',\n            astr,\n            '(set to \\'' + valIn + '\\')',\n            'got reset to',\n            '\\'' + valOut + '\\'',\n            'during defaults.'\n        ].join(' ');\n    },\n    invisible: function(base, astr) {\n        return (\n            astr ? (inBase(base) + 'item ' + astr) : ('Trace ' + base[1])\n        ) + ' got defaulted to be not visible';\n    },\n    value: function(base, astr, valIn) {\n        return [\n            inBase(base) + 'key ' + astr,\n            'is set to an invalid value (' + valIn + ')'\n        ].join(' ');\n    }\n};\n\nfunction inBase(base) {\n    if(isArray(base)) return 'In data trace ' + base[1] + ', ';\n\n    return 'In ' + base + ', ';\n}\n\nfunction format(code, base, path, valIn, valOut) {\n    path = path || '';\n\n    var container, trace;\n\n    // container is either 'data' or 'layout\n    // trace is the trace index if 'data', null otherwise\n\n    if(isArray(base)) {\n        container = base[0];\n        trace = base[1];\n    } else {\n        container = base;\n        trace = null;\n    }\n\n    var astr = convertPathToAttributeString(path);\n    var msg = code2msgFunc[code](base, astr, valIn, valOut);\n\n    // log to console if logger config option is enabled\n    Lib.log(msg);\n\n    return {\n        code: code,\n        container: container,\n        trace: trace,\n        path: path,\n        astr: astr,\n        msg: msg\n    };\n}\n\nfunction isInSchema(schema, key) {\n    var parts = splitKey(key);\n    var keyMinusId = parts.keyMinusId;\n    var id = parts.id;\n\n    if((keyMinusId in schema) && schema[keyMinusId]._isSubplotObj && id) {\n        return true;\n    }\n\n    return (key in schema);\n}\n\nfunction getNestedSchema(schema, key) {\n    if(key in schema) return schema[key];\n\n    var parts = splitKey(key);\n\n    return schema[parts.keyMinusId];\n}\n\nvar idRegex = Lib.counterRegex('([a-z]+)');\n\nfunction splitKey(key) {\n    var idMatch = key.match(idRegex);\n\n    return {\n        keyMinusId: idMatch && idMatch[1],\n        id: idMatch && idMatch[2]\n    };\n}\n\nfunction convertPathToAttributeString(path) {\n    if(!isArray(path)) return String(path);\n\n    var astr = '';\n\n    for(var i = 0; i < path.length; i++) {\n        var p = path[i];\n\n        if(typeof p === 'number') {\n            astr = astr.substr(0, astr.length - 1) + '[' + p + ']';\n        } else {\n            astr += p;\n        }\n\n        if(i < path.length - 1) astr += '.';\n    }\n\n    return astr;\n}\n","'use strict';\n\nmodule.exports = {\n    mode: {\n        valType: 'enumerated',\n        dflt: 'afterall',\n        values: ['immediate', 'next', 'afterall'],\n        description: [\n            'Describes how a new animate call interacts with currently-running',\n            'animations. If `immediate`, current animations are interrupted and',\n            'the new animation is started. If `next`, the current frame is allowed',\n            'to complete, after which the new animation is started. If `afterall`',\n            'all existing frames are animated to completion before the new animation',\n            'is started.'\n        ].join(' ')\n    },\n    direction: {\n        valType: 'enumerated',\n        values: ['forward', 'reverse'],\n        dflt: 'forward',\n        description: [\n            'The direction in which to play the frames triggered by the animation call'\n        ].join(' ')\n    },\n    fromcurrent: {\n        valType: 'boolean',\n        dflt: false,\n        description: [\n            'Play frames starting at the current frame instead of the beginning.'\n        ].join(' ')\n    },\n    frame: {\n        duration: {\n            valType: 'number',\n            min: 0,\n            dflt: 500,\n            description: [\n                'The duration in milliseconds of each frame. If greater than the frame',\n                'duration, it will be limited to the frame duration.'\n            ].join(' ')\n        },\n        redraw: {\n            valType: 'boolean',\n            dflt: true,\n            description: [\n                'Redraw the plot at completion of the transition. This is desirable',\n                'for transitions that include properties that cannot be transitioned,',\n                'but may significantly slow down updates that do not require a full',\n                'redraw of the plot'\n            ].join(' ')\n        },\n    },\n    transition: {\n        duration: {\n            valType: 'number',\n            min: 0,\n            dflt: 500,\n            editType: 'none',\n            description: [\n                'The duration of the transition, in milliseconds. If equal to zero,',\n                'updates are synchronous.'\n            ].join(' ')\n        },\n        easing: {\n            valType: 'enumerated',\n            dflt: 'cubic-in-out',\n            values: [\n                'linear',\n                'quad',\n                'cubic',\n                'sin',\n                'exp',\n                'circle',\n                'elastic',\n                'back',\n                'bounce',\n                'linear-in',\n                'quad-in',\n                'cubic-in',\n                'sin-in',\n                'exp-in',\n                'circle-in',\n                'elastic-in',\n                'back-in',\n                'bounce-in',\n                'linear-out',\n                'quad-out',\n                'cubic-out',\n                'sin-out',\n                'exp-out',\n                'circle-out',\n                'elastic-out',\n                'back-out',\n                'bounce-out',\n                'linear-in-out',\n                'quad-in-out',\n                'cubic-in-out',\n                'sin-in-out',\n                'exp-in-out',\n                'circle-in-out',\n                'elastic-in-out',\n                'back-in-out',\n                'bounce-in-out'\n            ],\n            editType: 'none',\n            description: 'The easing function used for the transition'\n        },\n        ordering: {\n            valType: 'enumerated',\n            values: ['layout first', 'traces first'],\n            dflt: 'layout first',\n            editType: 'none',\n            description: [\n                'Determines whether the figure\\'s layout or traces smoothly transitions',\n                'during updates that make both traces and layout change.'\n            ].join(' ')\n        }\n    }\n};\n","'use strict';\n\nvar Lib = require('../lib');\nvar Template = require('../plot_api/plot_template');\n\n/** Convenience wrapper for making array container logic DRY and consistent\n *\n * @param {object} parentObjIn\n *  user input object where the container in question is linked\n *  (i.e. either a user trace object or the user layout object)\n *\n * @param {object} parentObjOut\n *  full object where the coerced container will be linked\n *  (i.e. either a full trace object or the full layout object)\n *\n * @param {object} opts\n *  options object:\n *   - name {string}\n *      name of the key linking the container in question\n *   - inclusionAttr {string}\n *      name of the item attribute for inclusion/exclusion. Default is 'visible'.\n *      Since inclusion is true, use eg 'enabled' instead of 'disabled'.\n *   - handleItemDefaults {function}\n *      defaults method to be called on each item in the array container in question\n *\n *      Its arguments are:\n *          - itemIn {object} item in user layout\n *          - itemOut {object} item in full layout\n *          - parentObj {object} (as in closure)\n *          - opts {object} (as in closure)\n * N.B.\n *\n *  - opts is passed to handleItemDefaults so it can also store\n *    links to supplementary data (e.g. fullData for layout components)\n *\n */\nmodule.exports = function handleArrayContainerDefaults(parentObjIn, parentObjOut, opts) {\n    var name = opts.name;\n    var inclusionAttr = opts.inclusionAttr || 'visible';\n\n    var previousContOut = parentObjOut[name];\n\n    var contIn = Lib.isArrayOrTypedArray(parentObjIn[name]) ? parentObjIn[name] : [];\n    var contOut = parentObjOut[name] = [];\n    var templater = Template.arrayTemplater(parentObjOut, name, inclusionAttr);\n    var i, itemOut;\n\n    for(i = 0; i < contIn.length; i++) {\n        var itemIn = contIn[i];\n\n        if(!Lib.isPlainObject(itemIn)) {\n            itemOut = templater.newItem({});\n            itemOut[inclusionAttr] = false;\n        } else {\n            itemOut = templater.newItem(itemIn);\n        }\n\n        itemOut._index = i;\n\n        if(itemOut[inclusionAttr] !== false) {\n            opts.handleItemDefaults(itemIn, itemOut, parentObjOut, opts);\n        }\n\n        contOut.push(itemOut);\n    }\n\n    var defaultItems = templater.defaultItems();\n    for(i = 0; i < defaultItems.length; i++) {\n        itemOut = defaultItems[i];\n        itemOut._index = contOut.length;\n        opts.handleItemDefaults({}, itemOut, parentObjOut, opts, {});\n        contOut.push(itemOut);\n    }\n\n    // in case this array gets its defaults rebuilt independent of the whole layout,\n    // relink the private keys just for this array.\n    if(Lib.isArrayOrTypedArray(previousContOut)) {\n        var len = Math.min(previousContOut.length, contOut.length);\n        for(i = 0; i < len; i++) {\n            Lib.relinkPrivateKeys(contOut[i], previousContOut[i]);\n        }\n    }\n\n    return contOut;\n};\n","'use strict';\n\nvar fontAttrs = require('./font_attributes');\nvar fxAttrs = require('../components/fx/attributes');\n\nmodule.exports = {\n    type: {\n        valType: 'enumerated',\n        values: [],     // listed dynamically\n        dflt: 'scatter',\n        editType: 'calc+clearAxisTypes',\n        _noTemplating: true // we handle this at a higher level\n    },\n    visible: {\n        valType: 'enumerated',\n        values: [true, false, 'legendonly'],\n        dflt: true,\n        editType: 'calc',\n        description: [\n            'Determines whether or not this trace is visible.',\n            'If *legendonly*, the trace is not drawn,',\n            'but can appear as a legend item',\n            '(provided that the legend itself is visible).'\n        ].join(' ')\n    },\n    showlegend: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'style',\n        description: [\n            'Determines whether or not an item corresponding to this',\n            'trace is shown in the legend.'\n        ].join(' ')\n    },\n    legendgroup: {\n        valType: 'string',\n        dflt: '',\n        editType: 'style',\n        description: [\n            'Sets the legend group for this trace.',\n            'Traces part of the same legend group hide/show at the same time',\n            'when toggling legend items.'\n        ].join(' ')\n    },\n    legendgrouptitle: {\n        text: {\n            valType: 'string',\n            dflt: '',\n            editType: 'style',\n            description: [\n                'Sets the title of the legend group.'\n            ].join(' ')\n        },\n        font: fontAttrs({\n            editType: 'style',\n            description: [\n                'Sets this legend group\\'s title font.'\n            ].join(' '),\n        }),\n        editType: 'style',\n    },\n    legendrank: {\n        valType: 'number',\n        dflt: 1000,\n        editType: 'style',\n        description: [\n            'Sets the legend rank for this trace.',\n            'Items and groups with smaller ranks are presented on top/left side while',\n            'with `*reversed* `legend.traceorder` they are on bottom/right side.',\n            'The default legendrank is 1000,',\n            'so that you can use ranks less than 1000 to place certain items before all unranked items,',\n            'and ranks greater than 1000 to go after all unranked items.'\n        ].join(' ')\n    },\n    opacity: {\n        valType: 'number',\n        min: 0,\n        max: 1,\n        dflt: 1,\n        editType: 'style',\n        description: 'Sets the opacity of the trace.'\n    },\n    name: {\n        valType: 'string',\n        editType: 'style',\n        description: [\n            'Sets the trace name.',\n            'The trace name appear as the legend item and on hover.'\n        ].join(' ')\n    },\n    uid: {\n        valType: 'string',\n        editType: 'plot',\n        anim: true,\n        description: [\n            'Assign an id to this trace,',\n            'Use this to provide object constancy between traces during animations',\n            'and transitions.'\n        ].join(' ')\n    },\n    ids: {\n        valType: 'data_array',\n        editType: 'calc',\n        anim: true,\n        description: [\n            'Assigns id labels to each datum.',\n            'These ids for object constancy of data points during animation.',\n            'Should be an array of strings, not numbers or any other type.'\n        ].join(' ')\n    },\n    customdata: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: [\n            'Assigns extra data each datum.',\n            'This may be useful when listening to hover, click and selection events.',\n            'Note that, *scatter* traces also appends customdata items in the markers',\n            'DOM elements'\n        ].join(' ')\n    },\n    meta: {\n        valType: 'any',\n        arrayOk: true,\n        editType: 'plot',\n        description: [\n            'Assigns extra meta information associated with this trace',\n            'that can be used in various text attributes.',\n            'Attributes such as trace `name`, graph, axis and colorbar `title.text`, annotation `text`',\n            '`rangeselector`, `updatemenues` and `sliders` `label` text',\n            'all support `meta`.',\n            'To access the trace `meta` values in an attribute in the same trace, simply use',\n            '`%{meta[i]}` where `i` is the index or key of the `meta`',\n            'item in question.',\n            'To access trace `meta` in layout attributes, use',\n            '`%{data[n[.meta[i]}` where `i` is the index or key of the `meta`',\n            'and `n` is the trace index.'\n        ].join(' ')\n    },\n\n    // N.B. these cannot be 'data_array' as they do not have the same length as\n    // other data arrays and arrayOk attributes in general\n    //\n    // Maybe add another valType:\n    // https://github.com/plotly/plotly.js/issues/1894\n    selectedpoints: {\n        valType: 'any',\n        editType: 'calc',\n        description: [\n            'Array containing integer indices of selected points.',\n            'Has an effect only for traces that support selections.',\n            'Note that an empty array means an empty selection where the `unselected`',\n            'are turned on for all points, whereas, any other non-array values means no',\n            'selection all where the `selected` and `unselected` styles have no effect.'\n        ].join(' ')\n    },\n\n    hoverinfo: {\n        valType: 'flaglist',\n        flags: ['x', 'y', 'z', 'text', 'name'],\n        extras: ['all', 'none', 'skip'],\n        arrayOk: true,\n        dflt: 'all',\n        editType: 'none',\n        description: [\n            'Determines which trace information appear on hover.',\n            'If `none` or `skip` are set, no information is displayed upon hovering.',\n            'But, if `none` is set, click and hover events are still fired.'\n        ].join(' ')\n    },\n    hoverlabel: fxAttrs.hoverlabel,\n    stream: {\n        token: {\n            valType: 'string',\n            noBlank: true,\n            strict: true,\n            editType: 'calc',\n            description: [\n                'The stream id number links a data trace on a plot with a stream.',\n                'See https://chart-studio.plotly.com/settings for more details.'\n            ].join(' ')\n        },\n        maxpoints: {\n            valType: 'number',\n            min: 0,\n            max: 10000,\n            dflt: 500,\n            editType: 'calc',\n            description: [\n                'Sets the maximum number of points to keep on the plots from an',\n                'incoming stream.',\n                'If `maxpoints` is set to *50*, only the newest 50 points will',\n                'be displayed on the plot.'\n            ].join(' ')\n        },\n        editType: 'calc'\n    },\n    transforms: {\n        _isLinkedToArray: 'transform',\n        editType: 'calc',\n        description: [\n            'WARNING: All transforms are deprecated and may be removed from the API in next major version.',\n            'An array of operations that manipulate the trace data,',\n            'for example filtering or sorting the data arrays.'\n        ].join(' ')\n    },\n    uirevision: {\n        valType: 'any',\n        editType: 'none',\n        description: [\n            'Controls persistence of some user-driven changes to the trace:',\n            '`constraintrange` in `parcoords` traces, as well as some',\n            '`editable: true` modifications such as `name` and `colorbar.title`.',\n            'Defaults to `layout.uirevision`.',\n            'Note that other user-driven trace attribute changes are controlled',\n            'by `layout` attributes:',\n            '`trace.visible` is controlled by `layout.legend.uirevision`,',\n            '`selectedpoints` is controlled by `layout.selectionrevision`,',\n            'and `colorbar.(x|y)` (accessible with `config: {editable: true}`)',\n            'is controlled by `layout.editrevision`.',\n            'Trace changes are tracked by `uid`, which only falls back on trace',\n            'index if no `uid` is provided. So if your app can add/remove traces',\n            'before the end of the `data` array, such that the same trace has a',\n            'different index, you can still preserve user-driven changes if you',\n            'give each trace a `uid` that stays with it as it moves.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar Lib = require('../../lib');\nvar dateTime2ms = Lib.dateTime2ms;\nvar incrementMonth = Lib.incrementMonth;\nvar constants = require('../../constants/numerical');\nvar ONEAVGMONTH = constants.ONEAVGMONTH;\n\nmodule.exports = function alignPeriod(trace, ax, axLetter, vals) {\n    if(ax.type !== 'date') return vals;\n\n    var alignment = trace[axLetter + 'periodalignment'];\n    if(!alignment) return vals;\n\n    var period = trace[axLetter + 'period'];\n    var mPeriod;\n    if(isNumeric(period)) {\n        period = +period;\n        if(period <= 0) return vals;\n    } else if(typeof period === 'string' && period.charAt(0) === 'M') {\n        var n = +(period.substring(1));\n        if(n > 0 && Math.round(n) === n) {\n            mPeriod = n;\n        } else return vals;\n    }\n\n    var calendar = ax.calendar;\n\n    var isStart = 'start' === alignment;\n    // var isMiddle = 'middle' === alignment;\n    var isEnd = 'end' === alignment;\n\n    var period0 = trace[axLetter + 'period0'];\n    var base = dateTime2ms(period0, calendar) || 0;\n\n    var newVals = [];\n    var len = vals.length;\n    for(var i = 0; i < len; i++) {\n        var v = vals[i];\n\n        var nEstimated, startTime, endTime;\n        if(mPeriod) {\n            // guess at how many periods away from base we are\n            nEstimated = Math.round((v - base) / (mPeriod * ONEAVGMONTH));\n            endTime = incrementMonth(base, mPeriod * nEstimated, calendar);\n\n            // iterate to get the exact bounds before and after v\n            // there may be ways to make this faster, but most of the time\n            // we'll only execute each loop zero or one time.\n            while(endTime > v) {\n                endTime = incrementMonth(endTime, -mPeriod, calendar);\n            }\n            while(endTime <= v) {\n                endTime = incrementMonth(endTime, mPeriod, calendar);\n            }\n\n            // now we know endTime is the boundary immediately after v\n            // so startTime is obtained by incrementing backward one period.\n            startTime = incrementMonth(endTime, -mPeriod, calendar);\n        } else { // case of ms\n            nEstimated = Math.round((v - base) / period);\n            endTime = base + nEstimated * period;\n\n            while(endTime > v) {\n                endTime -= period;\n            }\n            while(endTime <= v) {\n                endTime += period;\n            }\n\n            startTime = endTime - period;\n        }\n\n        newVals[i] = (\n            isStart ? startTime :\n            isEnd ? endTime :\n            (startTime + endTime) / 2\n        );\n    }\n    return newVals;\n};\n","'use strict';\n\n\nmodule.exports = {\n    xaxis: {\n        valType: 'subplotid',\n        dflt: 'x',\n        editType: 'calc+clearAxisTypes',\n        description: [\n            'Sets a reference between this trace\\'s x coordinates and',\n            'a 2D cartesian x axis.',\n            'If *x* (the default value), the x coordinates refer to',\n            '`layout.xaxis`.',\n            'If *x2*, the x coordinates refer to `layout.xaxis2`, and so on.'\n        ].join(' ')\n    },\n    yaxis: {\n        valType: 'subplotid',\n        dflt: 'y',\n        editType: 'calc+clearAxisTypes',\n        description: [\n            'Sets a reference between this trace\\'s y coordinates and',\n            'a 2D cartesian y axis.',\n            'If *y* (the default value), the y coordinates refer to',\n            '`layout.yaxis`.',\n            'If *y2*, the y coordinates refer to `layout.yaxis2`, and so on.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar isNumeric = require('fast-isnumeric');\n\nvar Lib = require('../../lib');\nvar FP_SAFE = require('../../constants/numerical').FP_SAFE;\nvar Registry = require('../../registry');\nvar Drawing = require('../../components/drawing');\n\nvar axIds = require('./axis_ids');\nvar getFromId = axIds.getFromId;\nvar isLinked = axIds.isLinked;\n\nmodule.exports = {\n    getAutoRange: getAutoRange,\n    makePadFn: makePadFn,\n    doAutoRange: doAutoRange,\n    findExtremes: findExtremes,\n    concatExtremes: concatExtremes\n};\n\n/**\n * getAutoRange\n *\n * Collects all _extremes values corresponding to a given axis\n * and computes its auto range.\n *\n * Note that getAutoRange uses return values from findExtremes.\n *\n * @param {object} gd:\n *   graph div object with filled-in fullData and fullLayout, in particular\n *   with filled-in '_extremes' containers:\n *   {\n *      val: calcdata value,\n *      pad: extra pixels beyond this value,\n *      extrapad: bool, does this point want 5% extra padding\n *   }\n * @param {object} ax:\n *   full axis object, in particular with filled-in '_traceIndices'\n *   and '_annIndices' / '_shapeIndices' if applicable\n * @return {array}\n *   an array of [min, max]. These are calcdata for log and category axes\n *   and data for linear and date axes.\n *\n * TODO: we want to change log to data as well, but it's hard to do this\n * maintaining backward compatibility. category will always have to use calcdata\n * though, because otherwise values between categories (or outside all categories)\n * would be impossible.\n */\nfunction getAutoRange(gd, ax) {\n    var i, j;\n    var newRange = [];\n\n    var fullLayout = gd._fullLayout;\n    var getPadMin = makePadFn(fullLayout, ax, 0);\n    var getPadMax = makePadFn(fullLayout, ax, 1);\n    var extremes = concatExtremes(gd, ax);\n    var minArray = extremes.min;\n    var maxArray = extremes.max;\n\n    if(minArray.length === 0 || maxArray.length === 0) {\n        return Lib.simpleMap(ax.range, ax.r2l);\n    }\n\n    var minmin = minArray[0].val;\n    var maxmax = maxArray[0].val;\n\n    for(i = 1; i < minArray.length; i++) {\n        if(minmin !== maxmax) break;\n        minmin = Math.min(minmin, minArray[i].val);\n    }\n    for(i = 1; i < maxArray.length; i++) {\n        if(minmin !== maxmax) break;\n        maxmax = Math.max(maxmax, maxArray[i].val);\n    }\n\n    var axReverse = false;\n\n    if(ax.range) {\n        var rng = Lib.simpleMap(ax.range, ax.r2l);\n        axReverse = rng[1] < rng[0];\n    }\n    // one-time setting to easily reverse the axis\n    // when plotting from code\n    if(ax.autorange === 'reversed') {\n        axReverse = true;\n        ax.autorange = true;\n    }\n\n    var rangeMode = ax.rangemode;\n    var toZero = rangeMode === 'tozero';\n    var nonNegative = rangeMode === 'nonnegative';\n    var axLen = ax._length;\n    // don't allow padding to reduce the data to < 10% of the length\n    var minSpan = axLen / 10;\n\n    var mbest = 0;\n    var minpt, maxpt, minbest, maxbest, dp, dv;\n\n    for(i = 0; i < minArray.length; i++) {\n        minpt = minArray[i];\n        for(j = 0; j < maxArray.length; j++) {\n            maxpt = maxArray[j];\n            dv = maxpt.val - minpt.val - calcBreaksLength(ax, minpt.val, maxpt.val);\n            if(dv > 0) {\n                dp = axLen - getPadMin(minpt) - getPadMax(maxpt);\n                if(dp > minSpan) {\n                    if(dv / dp > mbest) {\n                        minbest = minpt;\n                        maxbest = maxpt;\n                        mbest = dv / dp;\n                    }\n                } else if(dv / axLen > mbest) {\n                    // in case of padding longer than the axis\n                    // at least include the unpadded data values.\n                    minbest = {val: minpt.val, nopad: 1};\n                    maxbest = {val: maxpt.val, nopad: 1};\n                    mbest = dv / axLen;\n                }\n            }\n        }\n    }\n\n    function maximumPad(prev, pt) {\n        return Math.max(prev, getPadMax(pt));\n    }\n\n    if(minmin === maxmax) {\n        var lower = minmin - 1;\n        var upper = minmin + 1;\n        if(toZero) {\n            if(minmin === 0) {\n                // The only value we have on this axis is 0, and we want to\n                // autorange so zero is one end.\n                // In principle this could be [0, 1] or [-1, 0] but usually\n                // 'tozero' pins 0 to the low end, so follow that.\n                newRange = [0, 1];\n            } else {\n                var maxPad = (minmin > 0 ? maxArray : minArray).reduce(maximumPad, 0);\n                // we're pushing a single value away from the edge due to its\n                // padding, with the other end clamped at zero\n                // 0.5 means don't push it farther than the center.\n                var rangeEnd = minmin / (1 - Math.min(0.5, maxPad / axLen));\n                newRange = minmin > 0 ? [0, rangeEnd] : [rangeEnd, 0];\n            }\n        } else if(nonNegative) {\n            newRange = [Math.max(0, lower), Math.max(1, upper)];\n        } else {\n            newRange = [lower, upper];\n        }\n    } else {\n        if(toZero) {\n            if(minbest.val >= 0) {\n                minbest = {val: 0, nopad: 1};\n            }\n            if(maxbest.val <= 0) {\n                maxbest = {val: 0, nopad: 1};\n            }\n        } else if(nonNegative) {\n            if(minbest.val - mbest * getPadMin(minbest) < 0) {\n                minbest = {val: 0, nopad: 1};\n            }\n            if(maxbest.val <= 0) {\n                maxbest = {val: 1, nopad: 1};\n            }\n        }\n\n        // in case it changed again...\n        mbest = (maxbest.val - minbest.val - calcBreaksLength(ax, minpt.val, maxpt.val)) /\n            (axLen - getPadMin(minbest) - getPadMax(maxbest));\n\n        newRange = [\n            minbest.val - mbest * getPadMin(minbest),\n            maxbest.val + mbest * getPadMax(maxbest)\n        ];\n    }\n\n    // maintain reversal\n    if(axReverse) newRange.reverse();\n\n    return Lib.simpleMap(newRange, ax.l2r || Number);\n}\n\n// find axis rangebreaks in [v0,v1] and compute its length in value space\nfunction calcBreaksLength(ax, v0, v1) {\n    var lBreaks = 0;\n    if(ax.rangebreaks) {\n        var rangebreaksOut = ax.locateBreaks(v0, v1);\n        for(var i = 0; i < rangebreaksOut.length; i++) {\n            var brk = rangebreaksOut[i];\n            lBreaks += brk.max - brk.min;\n        }\n    }\n    return lBreaks;\n}\n\n/*\n * calculate the pixel padding for ax._min and ax._max entries with\n * optional extrapad as 5% of the total axis length\n */\nfunction makePadFn(fullLayout, ax, max) {\n    // 5% padding for points that specify extrapad: true\n    var extrappad = 0.05 * ax._length;\n\n    var anchorAxis = ax._anchorAxis || {};\n\n    if(\n        (ax.ticklabelposition || '').indexOf('inside') !== -1 ||\n        (anchorAxis.ticklabelposition || '').indexOf('inside') !== -1\n    ) {\n        var axReverse = ax.autorange === 'reversed';\n        if(!axReverse) {\n            var rng = Lib.simpleMap(ax.range, ax.r2l);\n            axReverse = rng[1] < rng[0];\n        }\n        if(axReverse) max = !max;\n    }\n\n    var zero = 0;\n    if(!isLinked(fullLayout, ax._id)) {\n        zero = padInsideLabelsOnAnchorAxis(fullLayout, ax, max);\n    }\n    extrappad = Math.max(zero, extrappad);\n\n    // domain-constrained axes: base extrappad on the unconstrained\n    // domain so it's consistent as the domain changes\n    if((ax.constrain === 'domain') && ax._inputDomain) {\n        extrappad *= (ax._inputDomain[1] - ax._inputDomain[0]) /\n            (ax.domain[1] - ax.domain[0]);\n    }\n\n    return function getPad(pt) {\n        if(pt.nopad) return 0;\n        return pt.pad + (pt.extrapad ? extrappad : zero);\n    };\n}\n\nvar TEXTPAD = 3;\n\nfunction padInsideLabelsOnAnchorAxis(fullLayout, ax, max) {\n    var pad = 0;\n\n    var isX = ax._id.charAt(0) === 'x';\n\n    for(var subplot in fullLayout._plots) {\n        var plotinfo = fullLayout._plots[subplot];\n\n        if(ax._id !== plotinfo.xaxis._id && ax._id !== plotinfo.yaxis._id) continue;\n\n        var anchorAxis = (isX ? plotinfo.yaxis : plotinfo.xaxis) || {};\n\n        if((anchorAxis.ticklabelposition || '').indexOf('inside') !== -1) {\n            // increase padding to make more room for inside tick labels of the counter axis\n            if((\n                !max && (\n                    anchorAxis.side === 'left' ||\n                    anchorAxis.side === 'bottom'\n                )\n            ) || (\n                max && (\n                    anchorAxis.side === 'top' ||\n                    anchorAxis.side === 'right'\n                )\n            )) {\n                if(anchorAxis._vals) {\n                    var rad = Lib.deg2rad(anchorAxis._tickAngles[anchorAxis._id + 'tick'] || 0);\n                    var cosA = Math.abs(Math.cos(rad));\n                    var sinA = Math.abs(Math.sin(rad));\n\n                    // no stashed bounding boxes - stash bounding boxes\n                    if(!anchorAxis._vals[0].bb) {\n                        var cls = anchorAxis._id + 'tick';\n                        var tickLabels = anchorAxis._selections[cls];\n                        tickLabels.each(function(d) {\n                            var thisLabel = d3.select(this);\n                            var mathjaxGroup = thisLabel.select('.text-math-group');\n                            if(mathjaxGroup.empty()) {\n                                d.bb = Drawing.bBox(thisLabel.node());\n                            }\n                        });\n                    }\n\n                    // use bounding boxes\n                    for(var i = 0; i < anchorAxis._vals.length; i++) {\n                        var t = anchorAxis._vals[i];\n                        var bb = t.bb;\n\n                        if(bb) {\n                            var w = 2 * TEXTPAD + bb.width;\n                            var h = 2 * TEXTPAD + bb.height;\n\n                            pad = Math.max(pad, isX ?\n                                Math.max(w * cosA, h * sinA) :\n                                Math.max(h * cosA, w * sinA)\n                            );\n                        }\n                    }\n                }\n\n                if(anchorAxis.ticks === 'inside' && anchorAxis.ticklabelposition === 'inside') {\n                    pad += anchorAxis.ticklen || 0;\n                }\n            }\n        }\n    }\n\n    return pad;\n}\n\nfunction concatExtremes(gd, ax, noMatch) {\n    var axId = ax._id;\n    var fullData = gd._fullData;\n    var fullLayout = gd._fullLayout;\n    var minArray = [];\n    var maxArray = [];\n    var i, j, d;\n\n    function _concat(cont, indices) {\n        for(i = 0; i < indices.length; i++) {\n            var item = cont[indices[i]];\n            var extremes = (item._extremes || {})[axId];\n            if(item.visible === true && extremes) {\n                for(j = 0; j < extremes.min.length; j++) {\n                    d = extremes.min[j];\n                    collapseMinArray(minArray, d.val, d.pad, {extrapad: d.extrapad});\n                }\n                for(j = 0; j < extremes.max.length; j++) {\n                    d = extremes.max[j];\n                    collapseMaxArray(maxArray, d.val, d.pad, {extrapad: d.extrapad});\n                }\n            }\n        }\n    }\n\n    _concat(fullData, ax._traceIndices);\n    _concat(fullLayout.annotations || [], ax._annIndices || []);\n    _concat(fullLayout.shapes || [], ax._shapeIndices || []);\n\n    // Include the extremes from other matched axes with this one\n    if(ax._matchGroup && !noMatch) {\n        for(var axId2 in ax._matchGroup) {\n            if(axId2 !== ax._id) {\n                var ax2 = getFromId(gd, axId2);\n                var extremes2 = concatExtremes(gd, ax2, true);\n                // convert padding on the second axis to the first with lenRatio\n                var lenRatio = ax._length / ax2._length;\n                for(j = 0; j < extremes2.min.length; j++) {\n                    d = extremes2.min[j];\n                    collapseMinArray(minArray, d.val, d.pad * lenRatio, {extrapad: d.extrapad});\n                }\n                for(j = 0; j < extremes2.max.length; j++) {\n                    d = extremes2.max[j];\n                    collapseMaxArray(maxArray, d.val, d.pad * lenRatio, {extrapad: d.extrapad});\n                }\n            }\n        }\n    }\n\n    return {min: minArray, max: maxArray};\n}\n\nfunction doAutoRange(gd, ax, presetRange) {\n    ax.setScale();\n\n    if(ax.autorange) {\n        ax.range = presetRange ? presetRange.slice() : getAutoRange(gd, ax);\n\n        ax._r = ax.range.slice();\n        ax._rl = Lib.simpleMap(ax._r, ax.r2l);\n\n        // doAutoRange will get called on fullLayout,\n        // but we want to report its results back to layout\n\n        var axIn = ax._input;\n\n        // before we edit _input, store preGUI values\n        var edits = {};\n        edits[ax._attr + '.range'] = ax.range;\n        edits[ax._attr + '.autorange'] = ax.autorange;\n        Registry.call('_storeDirectGUIEdit', gd.layout, gd._fullLayout._preGUI, edits);\n\n        axIn.range = ax.range.slice();\n        axIn.autorange = ax.autorange;\n    }\n\n    var anchorAx = ax._anchorAxis;\n\n    if(anchorAx && anchorAx.rangeslider) {\n        var axeRangeOpts = anchorAx.rangeslider[ax._name];\n        if(axeRangeOpts) {\n            if(axeRangeOpts.rangemode === 'auto') {\n                axeRangeOpts.range = getAutoRange(gd, ax);\n            }\n        }\n        anchorAx._input.rangeslider[ax._name] = Lib.extendFlat({}, axeRangeOpts);\n    }\n}\n\n/**\n * findExtremes\n *\n * Find min/max extremes of an array of coordinates on a given axis.\n *\n * Note that findExtremes is called during `calc`, when we don't yet know the axis\n * length; all the inputs should be based solely on the trace data, nothing\n * about the axis layout.\n *\n * Note that `ppad` and `vpad` as well as their asymmetric variants refer to\n * the before and after padding of the passed `data` array, not to the whole axis.\n *\n * @param {object} ax: full axis object\n *   relies on\n *   - ax.type\n *   - ax._m (just its sign)\n *   - ax.d2l\n * @param {array} data:\n *  array of numbers (i.e. already run though ax.d2c)\n * @param {object} opts:\n *  available keys are:\n *      vpad: (number or number array) pad values (data value +-vpad)\n *      ppad: (number or number array) pad pixels (pixel location +-ppad)\n *      ppadplus, ppadminus, vpadplus, vpadminus:\n *          separate padding for each side, overrides symmetric\n *      padded: (boolean) add 5% padding to both ends\n *          (unless one end is overridden by tozero)\n *      tozero: (boolean) make sure to include zero if axis is linear,\n *          and make it a tight bound if possible\n *      vpadLinearized: (boolean) whether or not vpad (or vpadplus/vpadminus)\n *          is linearized (for log scale axes)\n *\n * @return {object}\n *  - min {array of objects}\n *  - max {array of objects}\n *  each object item has fields:\n *    - val {number}\n *    - pad {number}\n *    - extrappad {number}\n *  - opts {object}: a ref to the passed \"options\" object\n */\nfunction findExtremes(ax, data, opts) {\n    if(!opts) opts = {};\n    if(!ax._m) ax.setScale();\n\n    var minArray = [];\n    var maxArray = [];\n\n    var len = data.length;\n    var extrapad = opts.padded || false;\n    var tozero = opts.tozero && (ax.type === 'linear' || ax.type === '-');\n    var isLog = ax.type === 'log';\n    var hasArrayOption = false;\n    var vpadLinearized = opts.vpadLinearized || false;\n    var i, v, di, dmin, dmax, ppadiplus, ppadiminus, vmin, vmax;\n\n    function makePadAccessor(item) {\n        if(Array.isArray(item)) {\n            hasArrayOption = true;\n            return function(i) { return Math.max(Number(item[i]||0), 0); };\n        } else {\n            var v = Math.max(Number(item||0), 0);\n            return function() { return v; };\n        }\n    }\n\n    var ppadplus = makePadAccessor((ax._m > 0 ?\n        opts.ppadplus : opts.ppadminus) || opts.ppad || 0);\n    var ppadminus = makePadAccessor((ax._m > 0 ?\n        opts.ppadminus : opts.ppadplus) || opts.ppad || 0);\n    var vpadplus = makePadAccessor(opts.vpadplus || opts.vpad);\n    var vpadminus = makePadAccessor(opts.vpadminus || opts.vpad);\n\n    if(!hasArrayOption) {\n        // with no arrays other than `data` we don't need to consider\n        // every point, only the extreme data points\n        vmin = Infinity;\n        vmax = -Infinity;\n\n        if(isLog) {\n            for(i = 0; i < len; i++) {\n                v = data[i];\n                // data is not linearized yet so we still have to filter out negative logs\n                if(v < vmin && v > 0) vmin = v;\n                if(v > vmax && v < FP_SAFE) vmax = v;\n            }\n        } else {\n            for(i = 0; i < len; i++) {\n                v = data[i];\n                if(v < vmin && v > -FP_SAFE) vmin = v;\n                if(v > vmax && v < FP_SAFE) vmax = v;\n            }\n        }\n\n        data = [vmin, vmax];\n        len = 2;\n    }\n\n    var collapseOpts = {tozero: tozero, extrapad: extrapad};\n\n    function addItem(i) {\n        di = data[i];\n        if(!isNumeric(di)) return;\n        ppadiplus = ppadplus(i);\n        ppadiminus = ppadminus(i);\n\n        if(vpadLinearized) {\n            dmin = ax.c2l(di) - vpadminus(i);\n            dmax = ax.c2l(di) + vpadplus(i);\n        } else {\n            vmin = di - vpadminus(i);\n            vmax = di + vpadplus(i);\n            // special case for log axes: if vpad makes this object span\n            // more than an order of mag, clip it to one order. This is so\n            // we don't have non-positive errors or absurdly large lower\n            // range due to rounding errors\n            if(isLog && vmin < vmax / 10) vmin = vmax / 10;\n\n            dmin = ax.c2l(vmin);\n            dmax = ax.c2l(vmax);\n        }\n\n        if(tozero) {\n            dmin = Math.min(0, dmin);\n            dmax = Math.max(0, dmax);\n        }\n        if(goodNumber(dmin)) {\n            collapseMinArray(minArray, dmin, ppadiminus, collapseOpts);\n        }\n        if(goodNumber(dmax)) {\n            collapseMaxArray(maxArray, dmax, ppadiplus, collapseOpts);\n        }\n    }\n\n    // For efficiency covering monotonic or near-monotonic data,\n    // check a few points at both ends first and then sweep\n    // through the middle\n    var iMax = Math.min(6, len);\n    for(i = 0; i < iMax; i++) addItem(i);\n    for(i = len - 1; i >= iMax; i--) addItem(i);\n\n    return {\n        min: minArray,\n        max: maxArray,\n        opts: opts\n    };\n}\n\nfunction collapseMinArray(array, newVal, newPad, opts) {\n    collapseArray(array, newVal, newPad, opts, lessOrEqual);\n}\n\nfunction collapseMaxArray(array, newVal, newPad, opts) {\n    collapseArray(array, newVal, newPad, opts, greaterOrEqual);\n}\n\n/**\n * collapseArray\n *\n * Takes items from 'array' and compares them to 'newVal', 'newPad'.\n *\n * @param {array} array:\n *  current set of min or max extremes\n * @param {number} newVal:\n *  new value to compare against\n * @param {number} newPad:\n *  pad value associated with 'newVal'\n * @param {object} opts:\n *  - tozero {boolean}\n *  - extrapad {number}\n * @param {function} atLeastAsExtreme:\n *  comparison function, use\n *  - lessOrEqual for min 'array' and\n *  - greaterOrEqual for max 'array'\n *\n * In practice, 'array' is either\n *  - 'extremes[ax._id].min' or\n *  - 'extremes[ax._id].max\n *  found in traces and layout items that affect autorange.\n *\n * Since we don't yet know the relationship between pixels and values\n * (that's what we're trying to figure out!) AND we don't yet know how\n * many pixels `extrapad` represents (it's going to be 5% of the length,\n * but we don't want to have to redo calc just because length changed)\n * two point must satisfy three criteria simultaneously for one to supersede the other:\n *  - at least as extreme a `val`\n *  - at least as big a `pad`\n *  - an unpadded point cannot supersede a padded point, but any other combination can\n *\n * Then:\n * - If the item supersedes the new point, set includeThis false\n * - If the new pt supersedes the item, delete it from 'array'\n */\nfunction collapseArray(array, newVal, newPad, opts, atLeastAsExtreme) {\n    var tozero = opts.tozero;\n    var extrapad = opts.extrapad;\n    var includeThis = true;\n\n    for(var j = 0; j < array.length && includeThis; j++) {\n        var v = array[j];\n        if(atLeastAsExtreme(v.val, newVal) && v.pad >= newPad && (v.extrapad || !extrapad)) {\n            includeThis = false;\n            break;\n        } else if(atLeastAsExtreme(newVal, v.val) && v.pad <= newPad && (extrapad || !v.extrapad)) {\n            array.splice(j, 1);\n            j--;\n        }\n    }\n    if(includeThis) {\n        var clipAtZero = (tozero && newVal === 0);\n        array.push({\n            val: newVal,\n            pad: clipAtZero ? 0 : newPad,\n            extrapad: clipAtZero ? false : extrapad\n        });\n    }\n}\n\n// In order to stop overflow errors, don't consider points\n// too close to the limits of js floating point\nfunction goodNumber(v) {\n    return isNumeric(v) && Math.abs(v) < FP_SAFE;\n}\n\nfunction lessOrEqual(v0, v1) { return v0 <= v1; }\nfunction greaterOrEqual(v0, v1) { return v0 >= v1; }\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar isNumeric = require('fast-isnumeric');\nvar Plots = require('../../plots/plots');\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar Titles = require('../../components/titles');\nvar Color = require('../../components/color');\nvar Drawing = require('../../components/drawing');\n\nvar axAttrs = require('./layout_attributes');\nvar cleanTicks = require('./clean_ticks');\n\nvar constants = require('../../constants/numerical');\nvar ONEMAXYEAR = constants.ONEMAXYEAR;\nvar ONEAVGYEAR = constants.ONEAVGYEAR;\nvar ONEMINYEAR = constants.ONEMINYEAR;\nvar ONEMAXQUARTER = constants.ONEMAXQUARTER;\nvar ONEAVGQUARTER = constants.ONEAVGQUARTER;\nvar ONEMINQUARTER = constants.ONEMINQUARTER;\nvar ONEMAXMONTH = constants.ONEMAXMONTH;\nvar ONEAVGMONTH = constants.ONEAVGMONTH;\nvar ONEMINMONTH = constants.ONEMINMONTH;\nvar ONEWEEK = constants.ONEWEEK;\nvar ONEDAY = constants.ONEDAY;\nvar HALFDAY = ONEDAY / 2;\nvar ONEHOUR = constants.ONEHOUR;\nvar ONEMIN = constants.ONEMIN;\nvar ONESEC = constants.ONESEC;\nvar MINUS_SIGN = constants.MINUS_SIGN;\nvar BADNUM = constants.BADNUM;\n\nvar ZERO_PATH = { K: 'zeroline' };\nvar GRID_PATH = { K: 'gridline', L: 'path' };\nvar TICK_PATH = { K: 'tick', L: 'path' };\nvar TICK_TEXT = { K: 'tick', L: 'text' };\n\nvar alignmentConstants = require('../../constants/alignment');\nvar MID_SHIFT = alignmentConstants.MID_SHIFT;\nvar CAP_SHIFT = alignmentConstants.CAP_SHIFT;\nvar LINE_SPACING = alignmentConstants.LINE_SPACING;\nvar OPPOSITE_SIDE = alignmentConstants.OPPOSITE_SIDE;\n\nvar TEXTPAD = 3;\n\nvar axes = module.exports = {};\n\naxes.setConvert = require('./set_convert');\nvar autoType = require('./axis_autotype');\n\nvar axisIds = require('./axis_ids');\nvar idSort = axisIds.idSort;\nvar isLinked = axisIds.isLinked;\n\n// tight coupling to chart studio\naxes.id2name = axisIds.id2name;\naxes.name2id = axisIds.name2id;\naxes.cleanId = axisIds.cleanId;\naxes.list = axisIds.list;\naxes.listIds = axisIds.listIds;\naxes.getFromId = axisIds.getFromId;\naxes.getFromTrace = axisIds.getFromTrace;\n\nvar autorange = require('./autorange');\naxes.getAutoRange = autorange.getAutoRange;\naxes.findExtremes = autorange.findExtremes;\n\nvar epsilon = 0.0001;\nfunction expandRange(range) {\n    var delta = (range[1] - range[0]) * epsilon;\n    return [\n        range[0] - delta,\n        range[1] + delta\n    ];\n}\n\n/*\n * find the list of possible axes to reference with an xref or yref attribute\n * and coerce it to that list\n *\n * attr: the attribute we're generating a reference for. Should end in 'x' or 'y'\n *     but can be prefixed, like 'ax' for annotation's arrow x\n * dflt: the default to coerce to, or blank to use the first axis (falling back on\n *     extraOption if there is no axis)\n * extraOption: aside from existing axes with this letter, what non-axis value is allowed?\n *     Only required if it's different from `dflt`\n */\naxes.coerceRef = function(containerIn, containerOut, gd, attr, dflt, extraOption) {\n    var axLetter = attr.charAt(attr.length - 1);\n    var axlist = gd._fullLayout._subplots[axLetter + 'axis'];\n    var refAttr = attr + 'ref';\n    var attrDef = {};\n\n    if(!dflt) dflt = axlist[0] || (typeof extraOption === 'string' ? extraOption : extraOption[0]);\n    if(!extraOption) extraOption = dflt;\n    axlist = axlist.concat(axlist.map(function(x) { return x + ' domain'; }));\n\n    // data-ref annotations are not supported in gl2d yet\n\n    attrDef[refAttr] = {\n        valType: 'enumerated',\n        values: axlist.concat(extraOption ?\n            (typeof extraOption === 'string' ? [extraOption] : extraOption) :\n            []),\n        dflt: dflt\n    };\n\n    // xref, yref\n    return Lib.coerce(containerIn, containerOut, attrDef, refAttr);\n};\n\n/*\n * Get the type of an axis reference. This can be 'range', 'domain', or 'paper'.\n * This assumes ar is a valid axis reference and returns 'range' if it doesn't\n * match the patterns for 'paper' or 'domain'.\n *\n * ar: the axis reference string\n *\n */\naxes.getRefType = function(ar) {\n    if(ar === undefined) { return ar; }\n    if(ar === 'paper') { return 'paper'; }\n    if(ar === 'pixel') { return 'pixel'; }\n    if(/( domain)$/.test(ar)) { return 'domain'; } else { return 'range'; }\n};\n\n/*\n * coerce position attributes (range-type) that can be either on axes or absolute\n * (paper or pixel) referenced. The biggest complication here is that we don't know\n * before looking at the axis whether the value must be a number or not (it may be\n * a date string), so we can't use the regular valType='number' machinery\n *\n * axRef (string): the axis this position is referenced to, or:\n *     paper: fraction of the plot area\n *     pixel: pixels relative to some starting position\n * attr (string): the attribute in containerOut we are coercing\n * dflt (number): the default position, as a fraction or pixels. If the attribute\n *     is to be axis-referenced, this will be converted to an axis data value\n *\n * Also cleans the values, since the attribute definition itself has to say\n * valType: 'any' to handle date axes. This allows us to accept:\n * - for category axes: category names, and convert them here into serial numbers.\n *   Note that this will NOT work for axis range endpoints, because we don't know\n *   the category list yet (it's set by ax.makeCalcdata during calc)\n *   but it works for component (note, shape, images) positions.\n * - for date axes: JS Dates or milliseconds, and convert to date strings\n * - for other types: coerce them to numbers\n */\naxes.coercePosition = function(containerOut, gd, coerce, axRef, attr, dflt) {\n    var cleanPos, pos;\n    var axRefType = axes.getRefType(axRef);\n    if(axRefType !== 'range') {\n        cleanPos = Lib.ensureNumber;\n        pos = coerce(attr, dflt);\n    } else {\n        var ax = axes.getFromId(gd, axRef);\n        dflt = ax.fraction2r(dflt);\n        pos = coerce(attr, dflt);\n        cleanPos = ax.cleanPos;\n    }\n    containerOut[attr] = cleanPos(pos);\n};\n\naxes.cleanPosition = function(pos, gd, axRef) {\n    var cleanPos = (axRef === 'paper' || axRef === 'pixel') ?\n        Lib.ensureNumber :\n        axes.getFromId(gd, axRef).cleanPos;\n\n    return cleanPos(pos);\n};\n\naxes.redrawComponents = function(gd, axIds) {\n    axIds = axIds ? axIds : axes.listIds(gd);\n\n    var fullLayout = gd._fullLayout;\n\n    function _redrawOneComp(moduleName, methodName, stashName, shortCircuit) {\n        var method = Registry.getComponentMethod(moduleName, methodName);\n        var stash = {};\n\n        for(var i = 0; i < axIds.length; i++) {\n            var ax = fullLayout[axes.id2name(axIds[i])];\n            var indices = ax[stashName];\n\n            for(var j = 0; j < indices.length; j++) {\n                var ind = indices[j];\n\n                if(!stash[ind]) {\n                    method(gd, ind);\n                    stash[ind] = 1;\n                    // once is enough for images (which doesn't use the `i` arg anyway)\n                    if(shortCircuit) return;\n                }\n            }\n        }\n    }\n\n    // annotations and shapes 'draw' method is slow,\n    // use the finer-grained 'drawOne' method instead\n    _redrawOneComp('annotations', 'drawOne', '_annIndices');\n    _redrawOneComp('shapes', 'drawOne', '_shapeIndices');\n    _redrawOneComp('images', 'draw', '_imgIndices', true);\n};\n\nvar getDataConversions = axes.getDataConversions = function(gd, trace, target, targetArray) {\n    var ax;\n\n    // If target points to an axis, use the type we already have for that\n    // axis to find the data type. Otherwise use the values to autotype.\n    var d2cTarget = (target === 'x' || target === 'y' || target === 'z') ?\n        target :\n        targetArray;\n\n    // In the case of an array target, make a mock data array\n    // and call supplyDefaults to the data type and\n    // setup the data-to-calc method.\n    if(Array.isArray(d2cTarget)) {\n        ax = {\n            type: autoType(targetArray, undefined, {\n                autotypenumbers: gd._fullLayout.autotypenumbers\n            }),\n            _categories: []\n        };\n        axes.setConvert(ax);\n\n        // build up ax._categories (usually done during ax.makeCalcdata()\n        if(ax.type === 'category') {\n            for(var i = 0; i < targetArray.length; i++) {\n                ax.d2c(targetArray[i]);\n            }\n        }\n        // TODO what to do for transforms?\n    } else {\n        ax = axes.getFromTrace(gd, trace, d2cTarget);\n    }\n\n    // if 'target' has corresponding axis\n    // -> use setConvert method\n    if(ax) return {d2c: ax.d2c, c2d: ax.c2d};\n\n    // special case for 'ids'\n    // -> cast to String\n    if(d2cTarget === 'ids') return {d2c: toString, c2d: toString};\n\n    // otherwise (e.g. numeric-array of 'marker.color' or 'marker.size')\n    // -> cast to Number\n\n    return {d2c: toNum, c2d: toNum};\n};\n\nfunction toNum(v) { return +v; }\nfunction toString(v) { return String(v); }\n\naxes.getDataToCoordFunc = function(gd, trace, target, targetArray) {\n    return getDataConversions(gd, trace, target, targetArray).d2c;\n};\n\n// get counteraxis letter for this axis (name or id)\n// this can also be used as the id for default counter axis\naxes.counterLetter = function(id) {\n    var axLetter = id.charAt(0);\n    if(axLetter === 'x') return 'y';\n    if(axLetter === 'y') return 'x';\n};\n\n// incorporate a new minimum difference and first tick into\n// forced\n// note that _forceTick0 is linearized, so needs to be turned into\n// a range value for setting tick0\naxes.minDtick = function(ax, newDiff, newFirst, allow) {\n    // doesn't make sense to do forced min dTick on log or category axes,\n    // and the plot itself may decide to cancel (ie non-grouped bars)\n    if(['log', 'category', 'multicategory'].indexOf(ax.type) !== -1 || !allow) {\n        ax._minDtick = 0;\n    } else if(ax._minDtick === undefined) {\n        // undefined means there's nothing there yet\n\n        ax._minDtick = newDiff;\n        ax._forceTick0 = newFirst;\n    } else if(ax._minDtick) {\n        if((ax._minDtick / newDiff + 1e-6) % 1 < 2e-6 &&\n            // existing minDtick is an integer multiple of newDiff\n            // (within rounding err)\n            // and forceTick0 can be shifted to newFirst\n\n                (((newFirst - ax._forceTick0) / newDiff % 1) +\n                    1.000001) % 1 < 2e-6) {\n            ax._minDtick = newDiff;\n            ax._forceTick0 = newFirst;\n        } else if((newDiff / ax._minDtick + 1e-6) % 1 > 2e-6 ||\n            // if the converse is true (newDiff is a multiple of minDtick and\n            // newFirst can be shifted to forceTick0) then do nothing - same\n            // forcing stands. Otherwise, cancel forced minimum\n\n                (((newFirst - ax._forceTick0) / ax._minDtick % 1) +\n                    1.000001) % 1 > 2e-6) {\n            ax._minDtick = 0;\n        }\n    }\n};\n\n// save a copy of the initial axis ranges in fullLayout\n// use them in mode bar and dblclick events\naxes.saveRangeInitial = function(gd, overwrite) {\n    var axList = axes.list(gd, '', true);\n    var hasOneAxisChanged = false;\n\n    for(var i = 0; i < axList.length; i++) {\n        var ax = axList[i];\n        var isNew = (ax._rangeInitial === undefined);\n        var hasChanged = isNew || !(\n            ax.range[0] === ax._rangeInitial[0] &&\n            ax.range[1] === ax._rangeInitial[1]\n        );\n\n        if((isNew && ax.autorange === false) || (overwrite && hasChanged)) {\n            ax._rangeInitial = ax.range.slice();\n            hasOneAxisChanged = true;\n        }\n    }\n\n    return hasOneAxisChanged;\n};\n\n// save a copy of the initial spike visibility\naxes.saveShowSpikeInitial = function(gd, overwrite) {\n    var axList = axes.list(gd, '', true);\n    var hasOneAxisChanged = false;\n    var allSpikesEnabled = 'on';\n\n    for(var i = 0; i < axList.length; i++) {\n        var ax = axList[i];\n        var isNew = (ax._showSpikeInitial === undefined);\n        var hasChanged = isNew || !(ax.showspikes === ax._showspikes);\n\n        if(isNew || (overwrite && hasChanged)) {\n            ax._showSpikeInitial = ax.showspikes;\n            hasOneAxisChanged = true;\n        }\n\n        if(allSpikesEnabled === 'on' && !ax.showspikes) {\n            allSpikesEnabled = 'off';\n        }\n    }\n    gd._fullLayout._cartesianSpikesEnabled = allSpikesEnabled;\n    return hasOneAxisChanged;\n};\n\naxes.autoBin = function(data, ax, nbins, is2d, calendar, size) {\n    var dataMin = Lib.aggNums(Math.min, null, data);\n    var dataMax = Lib.aggNums(Math.max, null, data);\n\n    if(ax.type === 'category' || ax.type === 'multicategory') {\n        return {\n            start: dataMin - 0.5,\n            end: dataMax + 0.5,\n            size: Math.max(1, Math.round(size) || 1),\n            _dataSpan: dataMax - dataMin,\n        };\n    }\n\n    if(!calendar) calendar = ax.calendar;\n\n    // piggyback off tick code to make \"nice\" bin sizes and edges\n    var dummyAx;\n    if(ax.type === 'log') {\n        dummyAx = {\n            type: 'linear',\n            range: [dataMin, dataMax]\n        };\n    } else {\n        dummyAx = {\n            type: ax.type,\n            range: Lib.simpleMap([dataMin, dataMax], ax.c2r, 0, calendar),\n            calendar: calendar\n        };\n    }\n    axes.setConvert(dummyAx);\n\n    size = size && cleanTicks.dtick(size, dummyAx.type);\n\n    if(size) {\n        dummyAx.dtick = size;\n        dummyAx.tick0 = cleanTicks.tick0(undefined, dummyAx.type, calendar);\n    } else {\n        var size0;\n        if(nbins) size0 = ((dataMax - dataMin) / nbins);\n        else {\n            // totally auto: scale off std deviation so the highest bin is\n            // somewhat taller than the total number of bins, but don't let\n            // the size get smaller than the 'nice' rounded down minimum\n            // difference between values\n            var distinctData = Lib.distinctVals(data);\n            var msexp = Math.pow(10, Math.floor(\n                Math.log(distinctData.minDiff) / Math.LN10));\n            var minSize = msexp * Lib.roundUp(\n                distinctData.minDiff / msexp, [0.9, 1.9, 4.9, 9.9], true);\n            size0 = Math.max(minSize, 2 * Lib.stdev(data) /\n                Math.pow(data.length, is2d ? 0.25 : 0.4));\n\n            // fallback if ax.d2c output BADNUMs\n            // e.g. when user try to plot categorical bins\n            // on a layout.xaxis.type: 'linear'\n            if(!isNumeric(size0)) size0 = 1;\n        }\n\n        axes.autoTicks(dummyAx, size0);\n    }\n\n    var finalSize = dummyAx.dtick;\n    var binStart = axes.tickIncrement(\n            axes.tickFirst(dummyAx), finalSize, 'reverse', calendar);\n    var binEnd, bincount;\n\n    // check for too many data points right at the edges of bins\n    // (>50% within 1% of bin edges) or all data points integral\n    // and offset the bins accordingly\n    if(typeof finalSize === 'number') {\n        binStart = autoShiftNumericBins(binStart, data, dummyAx, dataMin, dataMax);\n\n        bincount = 1 + Math.floor((dataMax - binStart) / finalSize);\n        binEnd = binStart + bincount * finalSize;\n    } else {\n        // month ticks - should be the only nonlinear kind we have at this point.\n        // dtick (as supplied by axes.autoTick) only has nonlinear values on\n        // date and log axes, but even if you display a histogram on a log axis\n        // we bin it on a linear axis (which one could argue against, but that's\n        // a separate issue)\n        if(dummyAx.dtick.charAt(0) === 'M') {\n            binStart = autoShiftMonthBins(binStart, data, finalSize, dataMin, calendar);\n        }\n\n        // calculate the endpoint for nonlinear ticks - you have to\n        // just increment until you're done\n        binEnd = binStart;\n        bincount = 0;\n        while(binEnd <= dataMax) {\n            binEnd = axes.tickIncrement(binEnd, finalSize, false, calendar);\n            bincount++;\n        }\n    }\n\n    return {\n        start: ax.c2r(binStart, 0, calendar),\n        end: ax.c2r(binEnd, 0, calendar),\n        size: finalSize,\n        _dataSpan: dataMax - dataMin\n    };\n};\n\n\nfunction autoShiftNumericBins(binStart, data, ax, dataMin, dataMax) {\n    var edgecount = 0;\n    var midcount = 0;\n    var intcount = 0;\n    var blankCount = 0;\n\n    function nearEdge(v) {\n        // is a value within 1% of a bin edge?\n        return (1 + (v - binStart) * 100 / ax.dtick) % 100 < 2;\n    }\n\n    for(var i = 0; i < data.length; i++) {\n        if(data[i] % 1 === 0) intcount++;\n        else if(!isNumeric(data[i])) blankCount++;\n\n        if(nearEdge(data[i])) edgecount++;\n        if(nearEdge(data[i] + ax.dtick / 2)) midcount++;\n    }\n    var dataCount = data.length - blankCount;\n\n    if(intcount === dataCount && ax.type !== 'date') {\n        if(ax.dtick < 1) {\n            // all integers: if bin size is <1, it's because\n            // that was specifically requested (large nbins)\n            // so respect that... but center the bins containing\n            // integers on those integers\n\n            binStart = dataMin - 0.5 * ax.dtick;\n        } else {\n            // otherwise start half an integer down regardless of\n            // the bin size, just enough to clear up endpoint\n            // ambiguity about which integers are in which bins.\n\n            binStart -= 0.5;\n            if(binStart + ax.dtick < dataMin) binStart += ax.dtick;\n        }\n    } else if(midcount < dataCount * 0.1) {\n        if(edgecount > dataCount * 0.3 ||\n                nearEdge(dataMin) || nearEdge(dataMax)) {\n            // lots of points at the edge, not many in the middle\n            // shift half a bin\n            var binshift = ax.dtick / 2;\n            binStart += (binStart + binshift < dataMin) ? binshift : -binshift;\n        }\n    }\n    return binStart;\n}\n\n\nfunction autoShiftMonthBins(binStart, data, dtick, dataMin, calendar) {\n    var stats = Lib.findExactDates(data, calendar);\n    // number of data points that needs to be an exact value\n    // to shift that increment to (near) the bin center\n    var threshold = 0.8;\n\n    if(stats.exactDays > threshold) {\n        var numMonths = Number(dtick.substr(1));\n\n        if((stats.exactYears > threshold) && (numMonths % 12 === 0)) {\n            // The exact middle of a non-leap-year is 1.5 days into July\n            // so if we start the bins here, all but leap years will\n            // get hover-labeled as exact years.\n            binStart = axes.tickIncrement(binStart, 'M6', 'reverse') + ONEDAY * 1.5;\n        } else if(stats.exactMonths > threshold) {\n            // Months are not as clean, but if we shift half the *longest*\n            // month (31/2 days) then 31-day months will get labeled exactly\n            // and shorter months will get labeled with the correct month\n            // but shifted 12-36 hours into it.\n            binStart = axes.tickIncrement(binStart, 'M1', 'reverse') + ONEDAY * 15.5;\n        } else {\n            // Shifting half a day is exact, but since these are month bins it\n            // will always give a somewhat odd-looking label, until we do something\n            // smarter like showing the bin boundaries (or the bounds of the actual\n            // data in each bin)\n            binStart -= HALFDAY;\n        }\n        var nextBinStart = axes.tickIncrement(binStart, dtick);\n\n        if(nextBinStart <= dataMin) return nextBinStart;\n    }\n    return binStart;\n}\n\n// ----------------------------------------------------\n// Ticks and grids\n// ----------------------------------------------------\n\n// ensure we have tick0, dtick, and tick rounding calculated\naxes.prepTicks = function(ax, opts) {\n    var rng = Lib.simpleMap(ax.range, ax.r2l, undefined, undefined, opts);\n\n    ax._dtickInit = ax.dtick;\n    ax._tick0Init = ax.tick0;\n\n    // calculate max number of (auto) ticks to display based on plot size\n    if(ax.tickmode === 'auto' || !ax.dtick) {\n        var nt = ax.nticks;\n        var minPx;\n\n        if(!nt) {\n            if(ax.type === 'category' || ax.type === 'multicategory') {\n                minPx = ax.tickfont ? Lib.bigFont(ax.tickfont.size || 12) : 15;\n                nt = ax._length / minPx;\n            } else {\n                minPx = ax._id.charAt(0) === 'y' ? 40 : 80;\n                nt = Lib.constrain(ax._length / minPx, 4, 9) + 1;\n            }\n\n            // radial axes span half their domain,\n            // multiply nticks value by two to get correct number of auto ticks.\n            if(ax._name === 'radialaxis') nt *= 2;\n        }\n\n        // add a couple of extra digits for filling in ticks when we\n        // have explicit tickvals without tick text\n        if(ax.tickmode === 'array') nt *= 100;\n\n\n        ax._roughDTick = Math.abs(rng[1] - rng[0]) / nt;\n        axes.autoTicks(ax, ax._roughDTick);\n\n        // check for a forced minimum dtick\n        if(ax._minDtick > 0 && ax.dtick < ax._minDtick * 2) {\n            ax.dtick = ax._minDtick;\n            ax.tick0 = ax.l2r(ax._forceTick0);\n        }\n    }\n\n    if(ax.ticklabelmode === 'period') {\n        adjustPeriodDelta(ax);\n    }\n\n    // check for missing tick0\n    if(!ax.tick0) {\n        ax.tick0 = (ax.type === 'date') ? '2000-01-01' : 0;\n    }\n\n    // ensure we don't try to make ticks below our minimum precision\n    // see https://github.com/plotly/plotly.js/issues/2892\n    if(ax.type === 'date' && ax.dtick < 0.1) ax.dtick = 0.1;\n\n    // now figure out rounding of tick values\n    autoTickRound(ax);\n};\n\nfunction nMonths(dtick) {\n    return +(dtick.substring(1));\n}\n\nfunction adjustPeriodDelta(ax) { // adjusts ax.dtick and sets ax._definedDelta\n    var definedDelta;\n\n    function mDate() {\n        return !(\n            isNumeric(ax.dtick) ||\n            ax.dtick.charAt(0) !== 'M'\n        );\n    }\n    var isMDate = mDate();\n    var tickformat = axes.getTickFormat(ax);\n    if(tickformat) {\n        var noDtick = ax._dtickInit !== ax.dtick;\n        if(\n            !(/%[fLQsSMX]/.test(tickformat))\n            // %f: microseconds as a decimal number [000000, 999999]\n            // %L: milliseconds as a decimal number [000, 999]\n            // %Q: milliseconds since UNIX epoch\n            // %s: seconds since UNIX epoch\n            // %S: second as a decimal number [00,61]\n            // %M: minute as a decimal number [00,59]\n            // %X: the locales time, such as %-I:%M:%S %p\n        ) {\n            if(\n                /%[HI]/.test(tickformat)\n                // %H: hour (24-hour clock) as a decimal number [00,23]\n                // %I: hour (12-hour clock) as a decimal number [01,12]\n            ) {\n                definedDelta = ONEHOUR;\n                if(noDtick && !isMDate && ax.dtick < ONEHOUR) ax.dtick = ONEHOUR;\n            } else if(\n                /%p/.test(tickformat) // %p: either AM or PM\n            ) {\n                definedDelta = HALFDAY;\n                if(noDtick && !isMDate && ax.dtick < HALFDAY) ax.dtick = HALFDAY;\n            } else if(\n                /%[Aadejuwx]/.test(tickformat)\n                // %A: full weekday name\n                // %a: abbreviated weekday name\n                // %d: zero-padded day of the month as a decimal number [01,31]\n                // %e: space-padded day of the month as a decimal number [ 1,31]\n                // %j: day of the year as a decimal number [001,366]\n                // %u: Monday-based (ISO 8601) weekday as a decimal number [1,7]\n                // %w: Sunday-based weekday as a decimal number [0,6]\n                // %x: the locales date, such as %-m/%-d/%Y\n            ) {\n                definedDelta = ONEDAY;\n                if(noDtick && !isMDate && ax.dtick < ONEDAY) ax.dtick = ONEDAY;\n            } else if(\n                /%[UVW]/.test(tickformat)\n                // %U: Sunday-based week of the year as a decimal number [00,53]\n                // %V: ISO 8601 week of the year as a decimal number [01, 53]\n                // %W: Monday-based week of the year as a decimal number [00,53]\n            ) {\n                definedDelta = ONEWEEK;\n                if(noDtick && !isMDate && ax.dtick < ONEWEEK) ax.dtick = ONEWEEK;\n            } else if(\n                /%[Bbm]/.test(tickformat)\n                // %B: full month name\n                // %b: abbreviated month name\n                // %m: month as a decimal number [01,12]\n            ) {\n                definedDelta = ONEAVGMONTH;\n                if(noDtick && (\n                    isMDate ? nMonths(ax.dtick) < 1 : ax.dtick < ONEMINMONTH)\n                ) ax.dtick = 'M1';\n            } else if(\n                /%[q]/.test(tickformat)\n                // %q: quarter of the year as a decimal number [1,4]\n            ) {\n                definedDelta = ONEAVGQUARTER;\n                if(noDtick && (\n                    isMDate ? nMonths(ax.dtick) < 3 : ax.dtick < ONEMINQUARTER)\n                ) ax.dtick = 'M3';\n            } else if(\n                /%[Yy]/.test(tickformat)\n                // %Y: year with century as a decimal number, such as 1999\n                // %y: year without century as a decimal number [00,99]\n            ) {\n                definedDelta = ONEAVGYEAR;\n                if(noDtick && (\n                    isMDate ? nMonths(ax.dtick) < 12 : ax.dtick < ONEMINYEAR)\n                ) ax.dtick = 'M12';\n            }\n        }\n    }\n\n    isMDate = mDate();\n    if(isMDate && ax.tick0 === ax._dowTick0) {\n        // discard Sunday/Monday tweaks\n        ax.tick0 = ax._rawTick0;\n    }\n\n    ax._definedDelta = definedDelta;\n}\n\nfunction positionPeriodTicks(tickVals, ax, definedDelta) {\n    for(var i = 0; i < tickVals.length; i++) {\n        var v = tickVals[i].value;\n\n        var a = i;\n        var b = i + 1;\n        if(i < tickVals.length - 1) {\n            a = i;\n            b = i + 1;\n        } else if(i > 0) {\n            a = i - 1;\n            b = i;\n        } else {\n            a = i;\n            b = i;\n        }\n\n        var A = tickVals[a].value;\n        var B = tickVals[b].value;\n        var actualDelta = Math.abs(B - A);\n        var delta = definedDelta || actualDelta;\n        var periodLength = 0;\n\n        if(delta >= ONEMINYEAR) {\n            if(actualDelta >= ONEMINYEAR && actualDelta <= ONEMAXYEAR) {\n                periodLength = actualDelta;\n            } else {\n                periodLength = ONEAVGYEAR;\n            }\n        } else if(definedDelta === ONEAVGQUARTER && delta >= ONEMINQUARTER) {\n            if(actualDelta >= ONEMINQUARTER && actualDelta <= ONEMAXQUARTER) {\n                periodLength = actualDelta;\n            } else {\n                periodLength = ONEAVGQUARTER;\n            }\n        } else if(delta >= ONEMINMONTH) {\n            if(actualDelta >= ONEMINMONTH && actualDelta <= ONEMAXMONTH) {\n                periodLength = actualDelta;\n            } else {\n                periodLength = ONEAVGMONTH;\n            }\n        } else if(definedDelta === ONEWEEK && delta >= ONEWEEK) {\n            periodLength = ONEWEEK;\n        } else if(delta >= ONEDAY) {\n            periodLength = ONEDAY;\n        } else if(definedDelta === HALFDAY && delta >= HALFDAY) {\n            periodLength = HALFDAY;\n        } else if(definedDelta === ONEHOUR && delta >= ONEHOUR) {\n            periodLength = ONEHOUR;\n        }\n\n        var inBetween;\n        if(periodLength >= actualDelta) {\n            // ensure new label positions remain between ticks\n            periodLength = actualDelta;\n            inBetween = true;\n        }\n\n        var endPeriod = v + periodLength;\n        if(ax.rangebreaks && periodLength > 0) {\n            var nAll = 84; // highly divisible 7 * 12\n            var n = 0;\n            for(var c = 0; c < nAll; c++) {\n                var r = (c + 0.5) / nAll;\n                if(ax.maskBreaks(v * (1 - r) + r * endPeriod) !== BADNUM) n++;\n            }\n            periodLength *= n / nAll;\n\n            if(!periodLength) {\n                tickVals[i].drop = true;\n            }\n\n            if(inBetween && actualDelta > ONEWEEK) periodLength = actualDelta; // center monthly & longer periods\n        }\n\n        if(\n            periodLength > 0 || // not instant\n            i === 0 // taking care first tick added\n        ) {\n            tickVals[i].periodX = v + periodLength / 2;\n        }\n    }\n}\n\n// calculate the ticks: text, values, positioning\n// if ticks are set to automatic, determine the right values (tick0,dtick)\n// in any case, set tickround to # of digits to round tick labels to,\n// or codes to this effect for log and date scales\naxes.calcTicks = function calcTicks(ax, opts) {\n    axes.prepTicks(ax, opts);\n    var rng = Lib.simpleMap(ax.range, ax.r2l, undefined, undefined, opts);\n\n    // now that we've figured out the auto values for formatting\n    // in case we're missing some ticktext, we can break out for array ticks\n    if(ax.tickmode === 'array') return arrayTicks(ax);\n\n    // add a tiny bit so we get ticks which may have rounded out\n    var exRng = expandRange(rng);\n    var startTick = exRng[0];\n    var endTick = exRng[1];\n    // check for reversed axis\n    var axrev = (rng[1] < rng[0]);\n    var minRange = Math.min(rng[0], rng[1]);\n    var maxRange = Math.max(rng[0], rng[1]);\n\n    var isDLog = (ax.type === 'log') && !(isNumeric(ax.dtick) || ax.dtick.charAt(0) === 'L');\n    var isPeriod = ax.ticklabelmode === 'period';\n\n    // find the first tick\n    ax._tmin = axes.tickFirst(ax, opts);\n\n    // No visible ticks? Quit.\n    // I've only seen this on category axes with all categories off the edge.\n    if((ax._tmin < startTick) !== axrev) return [];\n\n    // return the full set of tick vals\n    if(ax.type === 'category' || ax.type === 'multicategory') {\n        endTick = (axrev) ? Math.max(-0.5, endTick) :\n            Math.min(ax._categories.length - 0.5, endTick);\n    }\n\n    var x = ax._tmin;\n\n    if(ax.rangebreaks && ax._tick0Init !== ax.tick0) {\n        // adjust tick0\n        x = moveOutsideBreak(x, ax);\n        if(!axrev) {\n            x = axes.tickIncrement(x, ax.dtick, !axrev, ax.calendar);\n        }\n    }\n\n    if(isPeriod) {\n        // add one item to label period before tick0\n        x = axes.tickIncrement(x, ax.dtick, !axrev, ax.calendar);\n    }\n\n    var maxTicks = Math.max(1000, ax._length || 0);\n    var tickVals = [];\n    var xPrevious = null;\n    for(;\n        (axrev) ? (x >= endTick) : (x <= endTick);\n        x = axes.tickIncrement(x, ax.dtick, axrev, ax.calendar)\n    ) {\n        if(ax.rangebreaks) {\n            if(!axrev) {\n                if(x < startTick) continue;\n                if(ax.maskBreaks(x) === BADNUM && moveOutsideBreak(x, ax) >= maxRange) break;\n            }\n        }\n\n        // prevent infinite loops - no more than one tick per pixel,\n        // and make sure each value is different from the previous\n        if(tickVals.length > maxTicks || x === xPrevious) break;\n        xPrevious = x;\n\n        var minor = false;\n        if(isDLog && (x !== (x | 0))) {\n            minor = true;\n        }\n\n        tickVals.push({\n            minor: minor,\n            value: x\n        });\n    }\n\n    if(isPeriod) positionPeriodTicks(tickVals, ax, ax._definedDelta);\n\n    var i;\n    if(ax.rangebreaks) {\n        var flip = ax._id.charAt(0) === 'y';\n\n        var fontSize = 1; // one pixel minimum\n        if(ax.tickmode === 'auto') {\n            fontSize = ax.tickfont ? ax.tickfont.size : 12;\n        }\n\n        var prevL = NaN;\n        for(i = tickVals.length - 1; i > -1; i--) {\n            if(tickVals[i].drop) {\n                tickVals.splice(i, 1);\n                continue;\n            }\n\n            tickVals[i].value = moveOutsideBreak(tickVals[i].value, ax);\n\n            // avoid overlaps\n            var l = ax.c2p(tickVals[i].value);\n            if(flip ?\n                (prevL > l - fontSize) :\n                (prevL < l + fontSize)\n            ) { // ensure one pixel minimum\n                tickVals.splice(axrev ? i + 1 : i, 1);\n            } else {\n                prevL = l;\n            }\n        }\n    }\n\n    // If same angle over a full circle, the last tick vals is a duplicate.\n    // TODO must do something similar for angular date axes.\n    if(isAngular(ax) && Math.abs(rng[1] - rng[0]) === 360) {\n        tickVals.pop();\n    }\n\n    // save the last tick as well as first, so we can\n    // show the exponent only on the last one\n    ax._tmax = (tickVals[tickVals.length - 1] || {}).value;\n\n    // for showing the rest of a date when the main tick label is only the\n    // latter part: ax._prevDateHead holds what we showed most recently.\n    // Start with it cleared and mark that we're in calcTicks (ie calculating a\n    // whole string of these so we should care what the previous date head was!)\n    ax._prevDateHead = '';\n    ax._inCalcTicks = true;\n\n    var ticksOut = [];\n    var t, p;\n    for(i = 0; i < tickVals.length; i++) {\n        var _minor = tickVals[i].minor;\n        var _value = tickVals[i].value;\n\n        t = axes.tickText(\n            ax,\n            _value,\n            false, // hover\n            _minor // noSuffixPrefix\n        );\n\n        p = tickVals[i].periodX;\n        if(p !== undefined) {\n            t.periodX = p;\n            if(p > maxRange || p < minRange) { // hide label if outside the range\n                if(p > maxRange) t.periodX = maxRange;\n                if(p < minRange) t.periodX = minRange;\n\n                t.text = ' '; // don't use an empty string here which can confuse automargin (issue 5132)\n                ax._prevDateHead = '';\n            }\n        }\n\n        ticksOut.push(t);\n    }\n\n    ax._inCalcTicks = false;\n\n    return ticksOut;\n};\n\nfunction arrayTicks(ax) {\n    var vals = ax.tickvals;\n    var text = ax.ticktext;\n    var ticksOut = new Array(vals.length);\n    var rng = Lib.simpleMap(ax.range, ax.r2l);\n    var exRng = expandRange(rng);\n    var tickMin = Math.min(exRng[0], exRng[1]);\n    var tickMax = Math.max(exRng[0], exRng[1]);\n    var j = 0;\n\n    // without a text array, just format the given values as any other ticks\n    // except with more precision to the numbers\n    if(!Array.isArray(text)) text = [];\n\n    // make sure showing ticks doesn't accidentally add new categories\n    // TODO multicategory, if we allow ticktext / tickvals\n    var tickVal2l = ax.type === 'category' ? ax.d2l_noadd : ax.d2l;\n\n    // array ticks on log axes always show the full number\n    // (if no explicit ticktext overrides it)\n    if(ax.type === 'log' && String(ax.dtick).charAt(0) !== 'L') {\n        ax.dtick = 'L' + Math.pow(10, Math.floor(Math.min(ax.range[0], ax.range[1])) - 1);\n    }\n\n    for(var i = 0; i < vals.length; i++) {\n        var vali = tickVal2l(vals[i]);\n        if(vali > tickMin && vali < tickMax) {\n            if(text[i] === undefined) ticksOut[j] = axes.tickText(ax, vali);\n            else ticksOut[j] = tickTextObj(ax, vali, String(text[i]));\n            j++;\n        }\n    }\n\n    if(j < vals.length) ticksOut.splice(j, vals.length - j);\n\n    if(ax.rangebreaks) {\n        // remove ticks falling inside rangebreaks\n        ticksOut = ticksOut.filter(function(d) {\n            return ax.maskBreaks(d.x) !== BADNUM;\n        });\n    }\n\n    return ticksOut;\n}\n\nvar roundBase10 = [2, 5, 10];\nvar roundBase24 = [1, 2, 3, 6, 12];\nvar roundBase60 = [1, 2, 5, 10, 15, 30];\n// 2&3 day ticks are weird, but need something btwn 1&7\nvar roundDays = [1, 2, 3, 7, 14];\n// approx. tick positions for log axes, showing all (1) and just 1, 2, 5 (2)\n// these don't have to be exact, just close enough to round to the right value\nvar roundLog1 = [-0.046, 0, 0.301, 0.477, 0.602, 0.699, 0.778, 0.845, 0.903, 0.954, 1];\nvar roundLog2 = [-0.301, 0, 0.301, 0.699, 1];\n// N.B. `thetaunit; 'radians' angular axes must be converted to degrees\nvar roundAngles = [15, 30, 45, 90, 180];\n\nfunction roundDTick(roughDTick, base, roundingSet) {\n    return base * Lib.roundUp(roughDTick / base, roundingSet);\n}\n\n// autoTicks: calculate best guess at pleasant ticks for this axis\n// inputs:\n//      ax - an axis object\n//      roughDTick - rough tick spacing (to be turned into a nice round number)\n// outputs (into ax):\n//   tick0: starting point for ticks (not necessarily on the graph)\n//      usually 0 for numeric (=10^0=1 for log) or jan 1, 2000 for dates\n//   dtick: the actual, nice round tick spacing, usually a little larger than roughDTick\n//      if the ticks are spaced linearly (linear scale, categories,\n//          log with only full powers, date ticks < month),\n//          this will just be a number\n//      months: M#\n//      years: M# where # is 12*number of years\n//      log with linear ticks: L# where # is the linear tick spacing\n//      log showing powers plus some intermediates:\n//          D1 shows all digits, D2 shows 2 and 5\naxes.autoTicks = function(ax, roughDTick) {\n    var base;\n\n    function getBase(v) {\n        return Math.pow(v, Math.floor(Math.log(roughDTick) / Math.LN10));\n    }\n\n    if(ax.type === 'date') {\n        ax.tick0 = Lib.dateTick0(ax.calendar, 0);\n\n        // the criteria below are all based on the rough spacing we calculate\n        // being > half of the final unit - so precalculate twice the rough val\n        var roughX2 = 2 * roughDTick;\n\n        if(roughX2 > ONEAVGYEAR) {\n            roughDTick /= ONEAVGYEAR;\n            base = getBase(10);\n            ax.dtick = 'M' + (12 * roundDTick(roughDTick, base, roundBase10));\n        } else if(roughX2 > ONEAVGMONTH) {\n            roughDTick /= ONEAVGMONTH;\n            ax.dtick = 'M' + roundDTick(roughDTick, 1, roundBase24);\n        } else if(roughX2 > ONEDAY) {\n            ax.dtick = roundDTick(roughDTick, ONEDAY, ax._hasDayOfWeekBreaks ? [1, 2, 7, 14] : roundDays);\n            // get week ticks on sunday\n            // this will also move the base tick off 2000-01-01 if dtick is\n            // 2 or 3 days... but that's a weird enough case that we'll ignore it.\n            var tickformat = axes.getTickFormat(ax);\n            var isPeriod = ax.ticklabelmode === 'period';\n            if(isPeriod) ax._rawTick0 = ax.tick0;\n\n            if(/%[uVW]/.test(tickformat)) {\n                ax.tick0 = Lib.dateTick0(ax.calendar, 2); // Monday\n            } else {\n                ax.tick0 = Lib.dateTick0(ax.calendar, 1); // Sunday\n            }\n\n            if(isPeriod) ax._dowTick0 = ax.tick0;\n        } else if(roughX2 > ONEHOUR) {\n            ax.dtick = roundDTick(roughDTick, ONEHOUR, roundBase24);\n        } else if(roughX2 > ONEMIN) {\n            ax.dtick = roundDTick(roughDTick, ONEMIN, roundBase60);\n        } else if(roughX2 > ONESEC) {\n            ax.dtick = roundDTick(roughDTick, ONESEC, roundBase60);\n        } else {\n            // milliseconds\n            base = getBase(10);\n            ax.dtick = roundDTick(roughDTick, base, roundBase10);\n        }\n    } else if(ax.type === 'log') {\n        ax.tick0 = 0;\n        var rng = Lib.simpleMap(ax.range, ax.r2l);\n\n        if(roughDTick > 0.7) {\n            // only show powers of 10\n            ax.dtick = Math.ceil(roughDTick);\n        } else if(Math.abs(rng[1] - rng[0]) < 1) {\n            // span is less than one power of 10\n            var nt = 1.5 * Math.abs((rng[1] - rng[0]) / roughDTick);\n\n            // ticks on a linear scale, labeled fully\n            roughDTick = Math.abs(Math.pow(10, rng[1]) -\n                Math.pow(10, rng[0])) / nt;\n            base = getBase(10);\n            ax.dtick = 'L' + roundDTick(roughDTick, base, roundBase10);\n        } else {\n            // include intermediates between powers of 10,\n            // labeled with small digits\n            // ax.dtick = \"D2\" (show 2 and 5) or \"D1\" (show all digits)\n            ax.dtick = (roughDTick > 0.3) ? 'D2' : 'D1';\n        }\n    } else if(ax.type === 'category' || ax.type === 'multicategory') {\n        ax.tick0 = 0;\n        ax.dtick = Math.ceil(Math.max(roughDTick, 1));\n    } else if(isAngular(ax)) {\n        ax.tick0 = 0;\n        base = 1;\n        ax.dtick = roundDTick(roughDTick, base, roundAngles);\n    } else {\n        // auto ticks always start at 0\n        ax.tick0 = 0;\n        base = getBase(10);\n        ax.dtick = roundDTick(roughDTick, base, roundBase10);\n    }\n\n    // prevent infinite loops\n    if(ax.dtick === 0) ax.dtick = 1;\n\n    // TODO: this is from log axis histograms with autorange off\n    if(!isNumeric(ax.dtick) && typeof ax.dtick !== 'string') {\n        var olddtick = ax.dtick;\n        ax.dtick = 1;\n        throw 'ax.dtick error: ' + String(olddtick);\n    }\n};\n\n// after dtick is already known, find tickround = precision\n// to display in tick labels\n//   for numeric ticks, integer # digits after . to round to\n//   for date ticks, the last date part to show (y,m,d,H,M,S)\n//      or an integer # digits past seconds\nfunction autoTickRound(ax) {\n    var dtick = ax.dtick;\n\n    ax._tickexponent = 0;\n    if(!isNumeric(dtick) && typeof dtick !== 'string') {\n        dtick = 1;\n    }\n\n    if(ax.type === 'category' || ax.type === 'multicategory') {\n        ax._tickround = null;\n    }\n    if(ax.type === 'date') {\n        // If tick0 is unusual, give tickround a bit more information\n        // not necessarily *all* the information in tick0 though, if it's really odd\n        // minimal string length for tick0: 'd' is 10, 'M' is 16, 'S' is 19\n        // take off a leading minus (year < 0) and i (intercalary month) so length is consistent\n        var tick0ms = ax.r2l(ax.tick0);\n        var tick0str = ax.l2r(tick0ms).replace(/(^-|i)/g, '');\n        var tick0len = tick0str.length;\n\n        if(String(dtick).charAt(0) === 'M') {\n            // any tick0 more specific than a year: alway show the full date\n            if(tick0len > 10 || tick0str.substr(5) !== '01-01') ax._tickround = 'd';\n            // show the month unless ticks are full multiples of a year\n            else ax._tickround = (+(dtick.substr(1)) % 12 === 0) ? 'y' : 'm';\n        } else if((dtick >= ONEDAY && tick0len <= 10) || (dtick >= ONEDAY * 15)) ax._tickround = 'd';\n        else if((dtick >= ONEMIN && tick0len <= 16) || (dtick >= ONEHOUR)) ax._tickround = 'M';\n        else if((dtick >= ONESEC && tick0len <= 19) || (dtick >= ONEMIN)) ax._tickround = 'S';\n        else {\n            // tickround is a number of digits of fractional seconds\n            // of any two adjacent ticks, at least one will have the maximum fractional digits\n            // of all possible ticks - so take the max. length of tick0 and the next one\n            var tick1len = ax.l2r(tick0ms + dtick).replace(/^-/, '').length;\n            ax._tickround = Math.max(tick0len, tick1len) - 20;\n\n            // We shouldn't get here... but in case there's a situation I'm\n            // not thinking of where tick0str and tick1str are identical or\n            // something, fall back on maximum precision\n            if(ax._tickround < 0) ax._tickround = 4;\n        }\n    } else if(isNumeric(dtick) || dtick.charAt(0) === 'L') {\n        // linear or log (except D1, D2)\n        var rng = ax.range.map(ax.r2d || Number);\n        if(!isNumeric(dtick)) dtick = Number(dtick.substr(1));\n        // 2 digits past largest digit of dtick\n        ax._tickround = 2 - Math.floor(Math.log(dtick) / Math.LN10 + 0.01);\n\n        var maxend = Math.max(Math.abs(rng[0]), Math.abs(rng[1]));\n        var rangeexp = Math.floor(Math.log(maxend) / Math.LN10 + 0.01);\n        var minexponent = ax.minexponent === undefined ? 3 : ax.minexponent;\n        if(Math.abs(rangeexp) > minexponent) {\n            if(isSIFormat(ax.exponentformat) && !beyondSI(rangeexp)) {\n                ax._tickexponent = 3 * Math.round((rangeexp - 1) / 3);\n            } else ax._tickexponent = rangeexp;\n        }\n    } else {\n        // D1 or D2 (log)\n        ax._tickround = null;\n    }\n}\n\n// months and years don't have constant millisecond values\n// (but a year is always 12 months so we only need months)\n// log-scale ticks are also not consistently spaced, except\n// for pure powers of 10\n// numeric ticks always have constant differences, other datetime ticks\n// can all be calculated as constant number of milliseconds\naxes.tickIncrement = function(x, dtick, axrev, calendar) {\n    var axSign = axrev ? -1 : 1;\n\n    // includes linear, all dates smaller than month, and pure 10^n in log\n    if(isNumeric(dtick)) return Lib.increment(x, axSign * dtick);\n\n    // everything else is a string, one character plus a number\n    var tType = dtick.charAt(0);\n    var dtSigned = axSign * Number(dtick.substr(1));\n\n    // Dates: months (or years - see Lib.incrementMonth)\n    if(tType === 'M') return Lib.incrementMonth(x, dtSigned, calendar);\n\n    // Log scales: Linear, Digits\n    if(tType === 'L') return Math.log(Math.pow(10, x) + dtSigned) / Math.LN10;\n\n    // log10 of 2,5,10, or all digits (logs just have to be\n    // close enough to round)\n    if(tType === 'D') {\n        var tickset = (dtick === 'D2') ? roundLog2 : roundLog1;\n        var x2 = x + axSign * 0.01;\n        var frac = Lib.roundUp(Lib.mod(x2, 1), tickset, axrev);\n\n        return Math.floor(x2) +\n            Math.log(d3.round(Math.pow(10, frac), 1)) / Math.LN10;\n    }\n\n    throw 'unrecognized dtick ' + String(dtick);\n};\n\n// calculate the first tick on an axis\naxes.tickFirst = function(ax, opts) {\n    var r2l = ax.r2l || Number;\n    var rng = Lib.simpleMap(ax.range, r2l, undefined, undefined, opts);\n    var axrev = rng[1] < rng[0];\n    var sRound = axrev ? Math.floor : Math.ceil;\n    // add a tiny extra bit to make sure we get ticks\n    // that may have been rounded out\n    var r0 = expandRange(rng)[0];\n    var dtick = ax.dtick;\n    var tick0 = r2l(ax.tick0);\n\n    if(isNumeric(dtick)) {\n        var tmin = sRound((r0 - tick0) / dtick) * dtick + tick0;\n\n        // make sure no ticks outside the category list\n        if(ax.type === 'category' || ax.type === 'multicategory') {\n            tmin = Lib.constrain(tmin, 0, ax._categories.length - 1);\n        }\n        return tmin;\n    }\n\n    var tType = dtick.charAt(0);\n    var dtNum = Number(dtick.substr(1));\n\n    // Dates: months (or years)\n    if(tType === 'M') {\n        var cnt = 0;\n        var t0 = tick0;\n        var t1, mult, newDTick;\n\n        // This algorithm should work for *any* nonlinear (but close to linear!)\n        // tick spacing. Limit to 10 iterations, for gregorian months it's normally <=3.\n        while(cnt < 10) {\n            t1 = axes.tickIncrement(t0, dtick, axrev, ax.calendar);\n            if((t1 - r0) * (t0 - r0) <= 0) {\n                // t1 and t0 are on opposite sides of r0! we've succeeded!\n                if(axrev) return Math.min(t0, t1);\n                return Math.max(t0, t1);\n            }\n            mult = (r0 - ((t0 + t1) / 2)) / (t1 - t0);\n            newDTick = tType + ((Math.abs(Math.round(mult)) || 1) * dtNum);\n            t0 = axes.tickIncrement(t0, newDTick, mult < 0 ? !axrev : axrev, ax.calendar);\n            cnt++;\n        }\n        Lib.error('tickFirst did not converge', ax);\n        return t0;\n    } else if(tType === 'L') {\n        // Log scales: Linear, Digits\n\n        return Math.log(sRound(\n            (Math.pow(10, r0) - tick0) / dtNum) * dtNum + tick0) / Math.LN10;\n    } else if(tType === 'D') {\n        var tickset = (dtick === 'D2') ? roundLog2 : roundLog1;\n        var frac = Lib.roundUp(Lib.mod(r0, 1), tickset, axrev);\n\n        return Math.floor(r0) +\n            Math.log(d3.round(Math.pow(10, frac), 1)) / Math.LN10;\n    } else throw 'unrecognized dtick ' + String(dtick);\n};\n\n// draw the text for one tick.\n// px,py are the location on gd.paper\n// prefix is there so the x axis ticks can be dropped a line\n// ax is the axis layout, x is the tick value\n// hover is a (truthy) flag for whether to show numbers with a bit\n// more precision for hovertext\naxes.tickText = function(ax, x, hover, noSuffixPrefix) {\n    var out = tickTextObj(ax, x);\n    var arrayMode = ax.tickmode === 'array';\n    var extraPrecision = hover || arrayMode;\n    var axType = ax.type;\n    // TODO multicategory, if we allow ticktext / tickvals\n    var tickVal2l = axType === 'category' ? ax.d2l_noadd : ax.d2l;\n    var i;\n\n    if(arrayMode && Array.isArray(ax.ticktext)) {\n        var rng = Lib.simpleMap(ax.range, ax.r2l);\n        var minDiff = (Math.abs(rng[1] - rng[0]) - (ax._lBreaks || 0)) / 10000;\n\n        for(i = 0; i < ax.ticktext.length; i++) {\n            if(Math.abs(x - tickVal2l(ax.tickvals[i])) < minDiff) break;\n        }\n        if(i < ax.ticktext.length) {\n            out.text = String(ax.ticktext[i]);\n            return out;\n        }\n    }\n\n    function isHidden(showAttr) {\n        if(showAttr === undefined) return true;\n        if(hover) return showAttr === 'none';\n\n        var firstOrLast = {\n            first: ax._tmin,\n            last: ax._tmax\n        }[showAttr];\n\n        return showAttr !== 'all' && x !== firstOrLast;\n    }\n\n    var hideexp = hover ?\n        'never' :\n        ax.exponentformat !== 'none' && isHidden(ax.showexponent) ? 'hide' : '';\n\n    if(axType === 'date') formatDate(ax, out, hover, extraPrecision);\n    else if(axType === 'log') formatLog(ax, out, hover, extraPrecision, hideexp);\n    else if(axType === 'category') formatCategory(ax, out);\n    else if(axType === 'multicategory') formatMultiCategory(ax, out, hover);\n    else if(isAngular(ax)) formatAngle(ax, out, hover, extraPrecision, hideexp);\n    else formatLinear(ax, out, hover, extraPrecision, hideexp);\n\n    // add prefix and suffix\n    if(!noSuffixPrefix) {\n        if(ax.tickprefix && !isHidden(ax.showtickprefix)) out.text = ax.tickprefix + out.text;\n        if(ax.ticksuffix && !isHidden(ax.showticksuffix)) out.text += ax.ticksuffix;\n    }\n\n    // Setup ticks and grid lines boundaries\n    // at 1/2 a 'category' to the left/bottom\n    if(ax.tickson === 'boundaries' || ax.showdividers) {\n        var inbounds = function(v) {\n            var p = ax.l2p(v);\n            return p >= 0 && p <= ax._length ? v : null;\n        };\n\n        out.xbnd = [\n            inbounds(out.x - 0.5),\n            inbounds(out.x + ax.dtick - 0.5)\n        ];\n    }\n\n    return out;\n};\n\n/**\n * create text for a hover label on this axis, with special handling of\n * log axes (where negative values can't be displayed but can appear in hover text)\n *\n * @param {object} ax: the axis to format text for\n * @param {number or array of numbers} values: calcdata value(s) to format\n * @param {Optional(string)} hoverformat: trace (x|y)hoverformat to override axis.hoverformat\n *\n * @returns {string} `val` formatted as a string appropriate to this axis, or\n *     first value and second value as a range (ie '<val1> - <val2>') if the second value is provided and\n *     it's different from the first value.\n */\naxes.hoverLabelText = function(ax, values, hoverformat) {\n    if(hoverformat) ax = Lib.extendFlat({}, ax, {hoverformat: hoverformat});\n\n    var val = Array.isArray(values) ? values[0] : values;\n    var val2 = Array.isArray(values) ? values[1] : undefined;\n    if(val2 !== undefined && val2 !== val) {\n        return (\n            axes.hoverLabelText(ax, val, hoverformat) + ' - ' +\n            axes.hoverLabelText(ax, val2, hoverformat)\n        );\n    }\n\n    var logOffScale = (ax.type === 'log' && val <= 0);\n    var tx = axes.tickText(ax, ax.c2l(logOffScale ? -val : val), 'hover').text;\n\n    if(logOffScale) {\n        return val === 0 ? '0' : MINUS_SIGN + tx;\n    }\n\n    // TODO: should we do something special if the axis calendar and\n    // the data calendar are different? Somehow display both dates with\n    // their system names? Right now it will just display in the axis calendar\n    // but users could add the other one as text.\n    return tx;\n};\n\nfunction tickTextObj(ax, x, text) {\n    var tf = ax.tickfont || {};\n\n    return {\n        x: x,\n        dx: 0,\n        dy: 0,\n        text: text || '',\n        fontSize: tf.size,\n        font: tf.family,\n        fontColor: tf.color\n    };\n}\n\nfunction formatDate(ax, out, hover, extraPrecision) {\n    var tr = ax._tickround;\n    var fmt = (hover && ax.hoverformat) || axes.getTickFormat(ax);\n\n    if(extraPrecision) {\n        // second or sub-second precision: extra always shows max digits.\n        // for other fields, extra precision just adds one field.\n        if(isNumeric(tr)) tr = 4;\n        else tr = {y: 'm', m: 'd', d: 'M', M: 'S', S: 4}[tr];\n    }\n\n    var dateStr = Lib.formatDate(out.x, fmt, tr, ax._dateFormat, ax.calendar, ax._extraFormat);\n    var headStr;\n\n    var splitIndex = dateStr.indexOf('\\n');\n    if(splitIndex !== -1) {\n        headStr = dateStr.substr(splitIndex + 1);\n        dateStr = dateStr.substr(0, splitIndex);\n    }\n\n    if(extraPrecision) {\n        // if extraPrecision led to trailing zeros, strip them off\n        // actually, this can lead to removing even more zeros than\n        // in the original rounding, but that's fine because in these\n        // contexts uniformity is not so important (if there's even\n        // anything to be uniform with!)\n\n        // can we remove the whole time part?\n        if(dateStr === '00:00:00' || dateStr === '00:00') {\n            dateStr = headStr;\n            headStr = '';\n        } else if(dateStr.length === 8) {\n            // strip off seconds if they're zero (zero fractional seconds\n            // are already omitted)\n            // but we never remove minutes and leave just hours\n            dateStr = dateStr.replace(/:00$/, '');\n        }\n    }\n\n    if(headStr) {\n        if(hover) {\n            // hover puts it all on one line, so headPart works best up front\n            // except for year headPart: turn this into \"Jan 1, 2000\" etc.\n            if(tr === 'd') dateStr += ', ' + headStr;\n            else dateStr = headStr + (dateStr ? ', ' + dateStr : '');\n        } else {\n            if(\n                !ax._inCalcTicks ||\n                ax._prevDateHead !== headStr\n            ) {\n                ax._prevDateHead = headStr;\n                dateStr += '<br>' + headStr;\n            } else {\n                var isInside = insideTicklabelposition(ax);\n                var side = ax._realSide || ax.side; // polar mocks the side of the radial axis\n                if(\n                    (!isInside && side === 'top') ||\n                    (isInside && side === 'bottom')\n                ) {\n                    dateStr += '<br> ';\n                }\n            }\n        }\n    }\n\n    out.text = dateStr;\n}\n\nfunction formatLog(ax, out, hover, extraPrecision, hideexp) {\n    var dtick = ax.dtick;\n    var x = out.x;\n    var tickformat = ax.tickformat;\n    var dtChar0 = typeof dtick === 'string' && dtick.charAt(0);\n\n    if(hideexp === 'never') {\n        // If this is a hover label, then we must *never* hide the exponent\n        // for the sake of display, which could give the wrong value by\n        // potentially many orders of magnitude. If hideexp was 'never', then\n        // it's now succeeded by preventing the other condition from automating\n        // this choice. Thus we can unset it so that the axis formatting takes\n        // precedence.\n        hideexp = '';\n    }\n\n    if(extraPrecision && (dtChar0 !== 'L')) {\n        dtick = 'L3';\n        dtChar0 = 'L';\n    }\n\n    if(tickformat || (dtChar0 === 'L')) {\n        out.text = numFormat(Math.pow(10, x), ax, hideexp, extraPrecision);\n    } else if(isNumeric(dtick) || ((dtChar0 === 'D') && (Lib.mod(x + 0.01, 1) < 0.1))) {\n        var p = Math.round(x);\n        var absP = Math.abs(p);\n        var exponentFormat = ax.exponentformat;\n        if(exponentFormat === 'power' || (isSIFormat(exponentFormat) && beyondSI(p))) {\n            if(p === 0) out.text = 1;\n            else if(p === 1) out.text = '10';\n            else out.text = '10<sup>' + (p > 1 ? '' : MINUS_SIGN) + absP + '</sup>';\n\n            out.fontSize *= 1.25;\n        } else if((exponentFormat === 'e' || exponentFormat === 'E') && absP > 2) {\n            out.text = '1' + exponentFormat + (p > 0 ? '+' : MINUS_SIGN) + absP;\n        } else {\n            out.text = numFormat(Math.pow(10, x), ax, '', 'fakehover');\n            if(dtick === 'D1' && ax._id.charAt(0) === 'y') {\n                out.dy -= out.fontSize / 6;\n            }\n        }\n    } else if(dtChar0 === 'D') {\n        out.text = String(Math.round(Math.pow(10, Lib.mod(x, 1))));\n        out.fontSize *= 0.75;\n    } else throw 'unrecognized dtick ' + String(dtick);\n\n    // if 9's are printed on log scale, move the 10's away a bit\n    if(ax.dtick === 'D1') {\n        var firstChar = String(out.text).charAt(0);\n        if(firstChar === '0' || firstChar === '1') {\n            if(ax._id.charAt(0) === 'y') {\n                out.dx -= out.fontSize / 4;\n            } else {\n                out.dy += out.fontSize / 2;\n                out.dx += (ax.range[1] > ax.range[0] ? 1 : -1) *\n                    out.fontSize * (x < 0 ? 0.5 : 0.25);\n            }\n        }\n    }\n}\n\nfunction formatCategory(ax, out) {\n    var tt = ax._categories[Math.round(out.x)];\n    if(tt === undefined) tt = '';\n    out.text = String(tt);\n}\n\nfunction formatMultiCategory(ax, out, hover) {\n    var v = Math.round(out.x);\n    var cats = ax._categories[v] || [];\n    var tt = cats[1] === undefined ? '' : String(cats[1]);\n    var tt2 = cats[0] === undefined ? '' : String(cats[0]);\n\n    if(hover) {\n        // TODO is this what we want?\n        out.text = tt2 + ' - ' + tt;\n    } else {\n        // setup for secondary labels\n        out.text = tt;\n        out.text2 = tt2;\n    }\n}\n\nfunction formatLinear(ax, out, hover, extraPrecision, hideexp) {\n    if(hideexp === 'never') {\n        // If this is a hover label, then we must *never* hide the exponent\n        // for the sake of display, which could give the wrong value by\n        // potentially many orders of magnitude. If hideexp was 'never', then\n        // it's now succeeded by preventing the other condition from automating\n        // this choice. Thus we can unset it so that the axis formatting takes\n        // precedence.\n        hideexp = '';\n    } else if(ax.showexponent === 'all' && Math.abs(out.x / ax.dtick) < 1e-6) {\n        // don't add an exponent to zero if we're showing all exponents\n        // so the only reason you'd show an exponent on zero is if it's the\n        // ONLY tick to get an exponent (first or last)\n        hideexp = 'hide';\n    }\n    out.text = numFormat(out.x, ax, hideexp, extraPrecision);\n}\n\nfunction formatAngle(ax, out, hover, extraPrecision, hideexp) {\n    if(ax.thetaunit === 'radians' && !hover) {\n        var num = out.x / 180;\n\n        if(num === 0) {\n            out.text = '0';\n        } else {\n            var frac = num2frac(num);\n\n            if(frac[1] >= 100) {\n                out.text = numFormat(Lib.deg2rad(out.x), ax, hideexp, extraPrecision);\n            } else {\n                var isNeg = out.x < 0;\n\n                if(frac[1] === 1) {\n                    if(frac[0] === 1) out.text = '';\n                    else out.text = frac[0] + '';\n                } else {\n                    out.text = [\n                        '<sup>', frac[0], '</sup>',\n                        '',\n                        '<sub>', frac[1], '</sub>',\n                        ''\n                    ].join('');\n                }\n\n                if(isNeg) out.text = MINUS_SIGN + out.text;\n            }\n        }\n    } else {\n        out.text = numFormat(out.x, ax, hideexp, extraPrecision);\n    }\n}\n\n// inspired by\n// https://github.com/yisibl/num2fraction/blob/master/index.js\nfunction num2frac(num) {\n    function almostEq(a, b) {\n        return Math.abs(a - b) <= 1e-6;\n    }\n\n    function findGCD(a, b) {\n        return almostEq(b, 0) ? a : findGCD(b, a % b);\n    }\n\n    function findPrecision(n) {\n        var e = 1;\n        while(!almostEq(Math.round(n * e) / e, n)) {\n            e *= 10;\n        }\n        return e;\n    }\n\n    var precision = findPrecision(num);\n    var number = num * precision;\n    var gcd = Math.abs(findGCD(number, precision));\n\n    return [\n        // numerator\n        Math.round(number / gcd),\n        // denominator\n        Math.round(precision / gcd)\n    ];\n}\n\n// format a number (tick value) according to the axis settings\n// new, more reliable procedure than d3.round or similar:\n// add half the rounding increment, then stringify and truncate\n// also automatically switch to sci. notation\nvar SIPREFIXES = ['f', 'p', 'n', '', 'm', '', 'k', 'M', 'G', 'T'];\n\nfunction isSIFormat(exponentFormat) {\n    return exponentFormat === 'SI' || exponentFormat === 'B';\n}\n\n// are we beyond the range of common SI prefixes?\n// 10^-16 -> 1x10^-16\n// 10^-15 -> 1f\n// ...\n// 10^14 -> 100T\n// 10^15 -> 1x10^15\n// 10^16 -> 1x10^16\nfunction beyondSI(exponent) {\n    return exponent > 14 || exponent < -15;\n}\n\nfunction numFormat(v, ax, fmtoverride, hover) {\n    var isNeg = v < 0;\n    // max number of digits past decimal point to show\n    var tickRound = ax._tickround;\n    var exponentFormat = fmtoverride || ax.exponentformat || 'B';\n    var exponent = ax._tickexponent;\n    var tickformat = axes.getTickFormat(ax);\n    var separatethousands = ax.separatethousands;\n\n    // special case for hover: set exponent just for this value, and\n    // add a couple more digits of precision over tick labels\n    if(hover) {\n        // make a dummy axis obj to get the auto rounding and exponent\n        var ah = {\n            exponentformat: exponentFormat,\n            minexponent: ax.minexponent,\n            dtick: ax.showexponent === 'none' ? ax.dtick :\n                (isNumeric(v) ? Math.abs(v) || 1 : 1),\n            // if not showing any exponents, don't change the exponent\n            // from what we calculate\n            range: ax.showexponent === 'none' ? ax.range.map(ax.r2d) : [0, v || 1]\n        };\n        autoTickRound(ah);\n        tickRound = (Number(ah._tickround) || 0) + 4;\n        exponent = ah._tickexponent;\n        if(ax.hoverformat) tickformat = ax.hoverformat;\n    }\n\n    if(tickformat) return ax._numFormat(tickformat)(v).replace(/-/g, MINUS_SIGN);\n\n    // 'epsilon' - rounding increment\n    var e = Math.pow(10, -tickRound) / 2;\n\n    // exponentFormat codes:\n    // 'e' (1.2e+6, default)\n    // 'E' (1.2E+6)\n    // 'SI' (1.2M)\n    // 'B' (same as SI except 10^9=B not G)\n    // 'none' (1200000)\n    // 'power' (1.2x10^6)\n    // 'hide' (1.2, use 3rd argument=='hide' to eg\n    //      only show exponent on last tick)\n    if(exponentFormat === 'none') exponent = 0;\n\n    // take the sign out, put it back manually at the end\n    // - makes cases easier\n    v = Math.abs(v);\n    if(v < e) {\n        // 0 is just 0, but may get exponent if it's the last tick\n        v = '0';\n        isNeg = false;\n    } else {\n        v += e;\n        // take out a common exponent, if any\n        if(exponent) {\n            v *= Math.pow(10, -exponent);\n            tickRound += exponent;\n        }\n        // round the mantissa\n        if(tickRound === 0) v = String(Math.floor(v));\n        else if(tickRound < 0) {\n            v = String(Math.round(v));\n            v = v.substr(0, v.length + tickRound);\n            for(var i = tickRound; i < 0; i++) v += '0';\n        } else {\n            v = String(v);\n            var dp = v.indexOf('.') + 1;\n            if(dp) v = v.substr(0, dp + tickRound).replace(/\\.?0+$/, '');\n        }\n        // insert appropriate decimal point and thousands separator\n        v = Lib.numSeparate(v, ax._separators, separatethousands);\n    }\n\n    // add exponent\n    if(exponent && exponentFormat !== 'hide') {\n        if(isSIFormat(exponentFormat) && beyondSI(exponent)) exponentFormat = 'power';\n\n        var signedExponent;\n        if(exponent < 0) signedExponent = MINUS_SIGN + -exponent;\n        else if(exponentFormat !== 'power') signedExponent = '+' + exponent;\n        else signedExponent = String(exponent);\n\n        if(exponentFormat === 'e' || exponentFormat === 'E') {\n            v += exponentFormat + signedExponent;\n        } else if(exponentFormat === 'power') {\n            v += '10<sup>' + signedExponent + '</sup>';\n        } else if(exponentFormat === 'B' && exponent === 9) {\n            v += 'B';\n        } else if(isSIFormat(exponentFormat)) {\n            v += SIPREFIXES[exponent / 3 + 5];\n        }\n    }\n\n    // put sign back in and return\n    // replace standard minus character (which is technically a hyphen)\n    // with a true minus sign\n    if(isNeg) return MINUS_SIGN + v;\n    return v;\n}\n\naxes.getTickFormat = function(ax) {\n    var i;\n\n    function convertToMs(dtick) {\n        return typeof dtick !== 'string' ? dtick : Number(dtick.replace('M', '')) * ONEAVGMONTH;\n    }\n\n    function compareLogTicks(left, right) {\n        var priority = ['L', 'D'];\n        if(typeof left === typeof right) {\n            if(typeof left === 'number') {\n                return left - right;\n            } else {\n                var leftPriority = priority.indexOf(left.charAt(0));\n                var rightPriority = priority.indexOf(right.charAt(0));\n                if(leftPriority === rightPriority) {\n                    return Number(left.replace(/(L|D)/g, '')) - Number(right.replace(/(L|D)/g, ''));\n                } else {\n                    return leftPriority - rightPriority;\n                }\n            }\n        } else {\n            return typeof left === 'number' ? 1 : -1;\n        }\n    }\n\n    function isProperStop(dtick, range, convert) {\n        var convertFn = convert || function(x) { return x;};\n        var leftDtick = range[0];\n        var rightDtick = range[1];\n        return ((!leftDtick && typeof leftDtick !== 'number') || convertFn(leftDtick) <= convertFn(dtick)) &&\n               ((!rightDtick && typeof rightDtick !== 'number') || convertFn(rightDtick) >= convertFn(dtick));\n    }\n\n    function isProperLogStop(dtick, range) {\n        var isLeftDtickNull = range[0] === null;\n        var isRightDtickNull = range[1] === null;\n        var isDtickInRangeLeft = compareLogTicks(dtick, range[0]) >= 0;\n        var isDtickInRangeRight = compareLogTicks(dtick, range[1]) <= 0;\n        return (isLeftDtickNull || isDtickInRangeLeft) && (isRightDtickNull || isDtickInRangeRight);\n    }\n\n    var tickstop, stopi;\n    if(ax.tickformatstops && ax.tickformatstops.length > 0) {\n        switch(ax.type) {\n            case 'date':\n            case 'linear': {\n                for(i = 0; i < ax.tickformatstops.length; i++) {\n                    stopi = ax.tickformatstops[i];\n                    if(stopi.enabled && isProperStop(ax.dtick, stopi.dtickrange, convertToMs)) {\n                        tickstop = stopi;\n                        break;\n                    }\n                }\n                break;\n            }\n            case 'log': {\n                for(i = 0; i < ax.tickformatstops.length; i++) {\n                    stopi = ax.tickformatstops[i];\n                    if(stopi.enabled && isProperLogStop(ax.dtick, stopi.dtickrange)) {\n                        tickstop = stopi;\n                        break;\n                    }\n                }\n                break;\n            }\n            default:\n        }\n    }\n    return tickstop ? tickstop.value : ax.tickformat;\n};\n\n// getSubplots - extract all subplot IDs we need\n// as an array of items like 'xy', 'x2y', 'x2y2'...\n// sorted by x (x,x2,x3...) then y\n// optionally restrict to only subplots containing axis object ax\n//\n// NOTE: this is currently only used OUTSIDE plotly.js (toolpanel, webapp)\n// ideally we get rid of it there (or just copy this there) and remove it here\naxes.getSubplots = function(gd, ax) {\n    var subplotObj = gd._fullLayout._subplots;\n    var allSubplots = subplotObj.cartesian.concat(subplotObj.gl2d || []);\n\n    var out = ax ? axes.findSubplotsWithAxis(allSubplots, ax) : allSubplots;\n\n    out.sort(function(a, b) {\n        var aParts = a.substr(1).split('y');\n        var bParts = b.substr(1).split('y');\n\n        if(aParts[0] === bParts[0]) return +aParts[1] - +bParts[1];\n        return +aParts[0] - +bParts[0];\n    });\n\n    return out;\n};\n\n// find all subplots with axis 'ax'\n// NOTE: this is only used in axes.getSubplots (only used outside plotly.js) and\n// gl2d/convert (where it restricts axis subplots to only those with gl2d)\naxes.findSubplotsWithAxis = function(subplots, ax) {\n    var axMatch = new RegExp(\n        (ax._id.charAt(0) === 'x') ? ('^' + ax._id + 'y') : (ax._id + '$')\n    );\n    var subplotsWithAx = [];\n\n    for(var i = 0; i < subplots.length; i++) {\n        var sp = subplots[i];\n        if(axMatch.test(sp)) subplotsWithAx.push(sp);\n    }\n\n    return subplotsWithAx;\n};\n\n// makeClipPaths: prepare clipPaths for all single axes and all possible xy pairings\naxes.makeClipPaths = function(gd) {\n    var fullLayout = gd._fullLayout;\n\n    // for more info: https://github.com/plotly/plotly.js/issues/2595\n    if(fullLayout._hasOnlyLargeSploms) return;\n\n    var fullWidth = {_offset: 0, _length: fullLayout.width, _id: ''};\n    var fullHeight = {_offset: 0, _length: fullLayout.height, _id: ''};\n    var xaList = axes.list(gd, 'x', true);\n    var yaList = axes.list(gd, 'y', true);\n    var clipList = [];\n    var i, j;\n\n    for(i = 0; i < xaList.length; i++) {\n        clipList.push({x: xaList[i], y: fullHeight});\n        for(j = 0; j < yaList.length; j++) {\n            if(i === 0) clipList.push({x: fullWidth, y: yaList[j]});\n            clipList.push({x: xaList[i], y: yaList[j]});\n        }\n    }\n\n    // selectors don't work right with camelCase tags,\n    // have to use class instead\n    // https://groups.google.com/forum/#!topic/d3-js/6EpAzQ2gU9I\n    var axClips = fullLayout._clips.selectAll('.axesclip')\n        .data(clipList, function(d) { return d.x._id + d.y._id; });\n\n    axClips.enter().append('clipPath')\n        .classed('axesclip', true)\n        .attr('id', function(d) { return 'clip' + fullLayout._uid + d.x._id + d.y._id; })\n      .append('rect');\n\n    axClips.exit().remove();\n\n    axClips.each(function(d) {\n        d3.select(this).select('rect').attr({\n            x: d.x._offset || 0,\n            y: d.y._offset || 0,\n            width: d.x._length || 1,\n            height: d.y._length || 1\n        });\n    });\n};\n\n/**\n * Main multi-axis drawing routine!\n *\n * @param {DOM element} gd : graph div\n * @param {string or array of strings} arg : polymorphic argument\n * @param {object} opts:\n * - @param {boolean} skipTitle : optional flag to skip axis title draw/update\n *\n * Signature 1: Axes.draw(gd, 'redraw')\n *   use this to clear and redraw all axes on graph\n *\n * Signature 2: Axes.draw(gd, '')\n *   use this to draw all axes on graph w/o the selectAll().remove()\n *   of the 'redraw' signature\n *\n * Signature 3: Axes.draw(gd, [axId, axId2, ...])\n *   where the items are axis id string,\n *   use this to update multiple axes in one call\n *\n * N.B draw updates:\n * - ax._r (stored range for use by zoom/pan)\n * - ax._rl (stored linearized range for use by zoom/pan)\n */\naxes.draw = function(gd, arg, opts) {\n    var fullLayout = gd._fullLayout;\n\n    if(arg === 'redraw') {\n        fullLayout._paper.selectAll('g.subplot').each(function(d) {\n            var id = d[0];\n            var plotinfo = fullLayout._plots[id];\n            if(plotinfo) {\n                var xa = plotinfo.xaxis;\n                var ya = plotinfo.yaxis;\n\n                plotinfo.xaxislayer.selectAll('.' + xa._id + 'tick').remove();\n                plotinfo.yaxislayer.selectAll('.' + ya._id + 'tick').remove();\n                plotinfo.xaxislayer.selectAll('.' + xa._id + 'tick2').remove();\n                plotinfo.yaxislayer.selectAll('.' + ya._id + 'tick2').remove();\n                plotinfo.xaxislayer.selectAll('.' + xa._id + 'divider').remove();\n                plotinfo.yaxislayer.selectAll('.' + ya._id + 'divider').remove();\n\n                if(plotinfo.gridlayer) plotinfo.gridlayer.selectAll('path').remove();\n                if(plotinfo.zerolinelayer) plotinfo.zerolinelayer.selectAll('path').remove();\n\n                fullLayout._infolayer.select('.g-' + xa._id + 'title').remove();\n                fullLayout._infolayer.select('.g-' + ya._id + 'title').remove();\n            }\n        });\n    }\n\n    var axList = (!arg || arg === 'redraw') ? axes.listIds(gd) : arg;\n\n    return Lib.syncOrAsync(axList.map(function(axId) {\n        return function() {\n            if(!axId) return;\n\n            var ax = axes.getFromId(gd, axId);\n            var axDone = axes.drawOne(gd, ax, opts);\n\n            ax._r = ax.range.slice();\n            ax._rl = Lib.simpleMap(ax._r, ax.r2l);\n\n            return axDone;\n        };\n    }));\n};\n\n/**\n * Draw one cartesian axis\n *\n * @param {DOM element} gd\n * @param {object} ax (full) axis object\n * @param {object} opts\n * - @param {boolean} skipTitle (set to true to skip axis title draw call)\n *\n * Depends on:\n * - ax._mainSubplot (from linkSubplots)\n * - ax._mainAxis\n * - ax._anchorAxis\n * - ax._subplotsWith\n * - ax._counterDomainMin, ax._counterDomainMax (optionally, from linkSubplots)\n * - ax._tickAngles (on redraw only, old value relinked during supplyDefaults)\n * - ax._mainLinePosition (from lsInner)\n * - ax._mainMirrorPosition\n * - ax._linepositions\n *\n * Fills in:\n * - ax._vals:\n * - ax._gridVals:\n * - ax._selections:\n * - ax._tickAngles:\n * - ax._depth (when required only):\n * - and calls ax.setScale\n */\naxes.drawOne = function(gd, ax, opts) {\n    opts = opts || {};\n\n    var i, sp, plotinfo;\n\n    ax.setScale();\n\n    var fullLayout = gd._fullLayout;\n    var axId = ax._id;\n    var axLetter = axId.charAt(0);\n    var counterLetter = axes.counterLetter(axId);\n    var mainPlotinfo = fullLayout._plots[ax._mainSubplot];\n\n    // this happens when updating matched group with 'missing' axes\n    if(!mainPlotinfo) return;\n\n    var mainAxLayer = mainPlotinfo[axLetter + 'axislayer'];\n    var mainLinePosition = ax._mainLinePosition;\n    var mainMirrorPosition = ax._mainMirrorPosition;\n\n    var vals = ax._vals = axes.calcTicks(ax);\n\n    // Add a couple of axis properties that should cause us to recreate\n    // elements. Used in d3 data function.\n    var axInfo = [ax.mirror, mainLinePosition, mainMirrorPosition].join('_');\n    for(i = 0; i < vals.length; i++) {\n        vals[i].axInfo = axInfo;\n    }\n\n    // stash selections to avoid DOM queries e.g.\n    // - stash tickLabels selection, so that drawTitle can use it to scoot title\n    ax._selections = {};\n    // stash tick angle (including the computed 'auto' values) per tick-label class\n    // linkup 'previous' tick angles on redraws\n    if(ax._tickAngles) ax._prevTickAngles = ax._tickAngles;\n    ax._tickAngles = {};\n    // measure [in px] between axis position and outward-most part of bounding box\n    // (touching either the tick label or ticks)\n    // depth can be expansive to compute, so we only do so when required\n    ax._depth = null;\n\n    // calcLabelLevelBbox can be expensive,\n    // so make sure to not call it twice during the same Axes.drawOne call\n    // by stashing label-level bounding boxes per tick-label class\n    var llbboxes = {};\n    function getLabelLevelBbox(suffix) {\n        var cls = axId + (suffix || 'tick');\n        if(!llbboxes[cls]) llbboxes[cls] = calcLabelLevelBbox(ax, cls);\n        return llbboxes[cls];\n    }\n\n    if(!ax.visible) return;\n\n    var transTickFn = axes.makeTransTickFn(ax);\n    var transTickLabelFn = axes.makeTransTickLabelFn(ax);\n\n    var tickVals;\n    // We remove zero lines, grid lines, and inside ticks if they're within 1px of the end\n    // The key case here is removing zero lines when the axis bound is zero\n    var valsClipped;\n\n    var insideTicks = ax.ticks === 'inside';\n    var outsideTicks = ax.ticks === 'outside';\n\n    if(ax.tickson === 'boundaries') {\n        var boundaryVals = getBoundaryVals(ax, vals);\n        valsClipped = axes.clipEnds(ax, boundaryVals);\n        tickVals = insideTicks ? valsClipped : boundaryVals;\n    } else {\n        valsClipped = axes.clipEnds(ax, vals);\n        tickVals = (insideTicks && ax.ticklabelmode !== 'period') ? valsClipped : vals;\n    }\n\n    var gridVals = ax._gridVals = valsClipped;\n    var dividerVals = getDividerVals(ax, vals);\n\n    if(!fullLayout._hasOnlyLargeSploms) {\n        var subplotsWithAx = ax._subplotsWith;\n\n        // keep track of which subplots (by main counter axis) we've already\n        // drawn grids for, so we don't overdraw overlaying subplots\n        var finishedGrids = {};\n\n        for(i = 0; i < subplotsWithAx.length; i++) {\n            sp = subplotsWithAx[i];\n            plotinfo = fullLayout._plots[sp];\n\n            var counterAxis = plotinfo[counterLetter + 'axis'];\n            var mainCounterID = counterAxis._mainAxis._id;\n            if(finishedGrids[mainCounterID]) continue;\n            finishedGrids[mainCounterID] = 1;\n\n            var gridPath = axLetter === 'x' ?\n                'M0,' + counterAxis._offset + 'v' + counterAxis._length :\n                'M' + counterAxis._offset + ',0h' + counterAxis._length;\n\n            axes.drawGrid(gd, ax, {\n                vals: gridVals,\n                counterAxis: counterAxis,\n                layer: plotinfo.gridlayer.select('.' + axId),\n                path: gridPath,\n                transFn: transTickFn\n            });\n            axes.drawZeroLine(gd, ax, {\n                counterAxis: counterAxis,\n                layer: plotinfo.zerolinelayer,\n                path: gridPath,\n                transFn: transTickFn\n            });\n        }\n    }\n\n    var tickSigns = axes.getTickSigns(ax);\n    var tickSubplots = [];\n\n    if(ax.ticks) {\n        var mainTickPath = axes.makeTickPath(ax, mainLinePosition, tickSigns[2]);\n        var mirrorTickPath;\n        var fullTickPath;\n        if(ax._anchorAxis && ax.mirror && ax.mirror !== true) {\n            mirrorTickPath = axes.makeTickPath(ax, mainMirrorPosition, tickSigns[3]);\n            fullTickPath = mainTickPath + mirrorTickPath;\n        } else {\n            mirrorTickPath = '';\n            fullTickPath = mainTickPath;\n        }\n\n        var tickPath;\n        if(ax.showdividers && outsideTicks && ax.tickson === 'boundaries') {\n            var dividerLookup = {};\n            for(i = 0; i < dividerVals.length; i++) {\n                dividerLookup[dividerVals[i].x] = 1;\n            }\n            tickPath = function(d) {\n                return dividerLookup[d.x] ? mirrorTickPath : fullTickPath;\n            };\n        } else {\n            tickPath = fullTickPath;\n        }\n\n        axes.drawTicks(gd, ax, {\n            vals: tickVals,\n            layer: mainAxLayer,\n            path: tickPath,\n            transFn: transTickFn\n        });\n\n        if(ax.mirror === 'allticks') {\n            tickSubplots = Object.keys(ax._linepositions || {});\n        }\n    }\n\n    for(i = 0; i < tickSubplots.length; i++) {\n        sp = tickSubplots[i];\n        plotinfo = fullLayout._plots[sp];\n        // [bottom or left, top or right], free and main are handled above\n        var linepositions = ax._linepositions[sp] || [];\n        var spTickPath = axes.makeTickPath(ax, linepositions[0], tickSigns[0]) +\n            axes.makeTickPath(ax, linepositions[1], tickSigns[1]);\n\n        axes.drawTicks(gd, ax, {\n            vals: tickVals,\n            layer: plotinfo[axLetter + 'axislayer'],\n            path: spTickPath,\n            transFn: transTickFn\n        });\n    }\n\n    var seq = [];\n\n    // tick labels - for now just the main labels.\n    // TODO: mirror labels, esp for subplots\n\n    seq.push(function() {\n        return axes.drawLabels(gd, ax, {\n            vals: vals,\n            layer: mainAxLayer,\n            plotinfo: plotinfo,\n            transFn: transTickLabelFn,\n            labelFns: axes.makeLabelFns(ax, mainLinePosition)\n        });\n    });\n\n    if(ax.type === 'multicategory') {\n        var pad = {x: 2, y: 10}[axLetter];\n\n        seq.push(function() {\n            var bboxKey = {x: 'height', y: 'width'}[axLetter];\n            var standoff = getLabelLevelBbox()[bboxKey] + pad +\n                (ax._tickAngles[axId + 'tick'] ? ax.tickfont.size * LINE_SPACING : 0);\n\n            return axes.drawLabels(gd, ax, {\n                vals: getSecondaryLabelVals(ax, vals),\n                layer: mainAxLayer,\n                cls: axId + 'tick2',\n                repositionOnUpdate: true,\n                secondary: true,\n                transFn: transTickFn,\n                labelFns: axes.makeLabelFns(ax, mainLinePosition + standoff * tickSigns[4])\n            });\n        });\n\n        seq.push(function() {\n            ax._depth = tickSigns[4] * (getLabelLevelBbox('tick2')[ax.side] - mainLinePosition);\n\n            return drawDividers(gd, ax, {\n                vals: dividerVals,\n                layer: mainAxLayer,\n                path: axes.makeTickPath(ax, mainLinePosition, tickSigns[4], ax._depth),\n                transFn: transTickFn\n            });\n        });\n    } else if(ax.title.hasOwnProperty('standoff')) {\n        seq.push(function() {\n            ax._depth = tickSigns[4] * (getLabelLevelBbox()[ax.side] - mainLinePosition);\n        });\n    }\n\n    var hasRangeSlider = Registry.getComponentMethod('rangeslider', 'isVisible')(ax);\n\n    seq.push(function() {\n        var s = ax.side.charAt(0);\n        var sMirror = OPPOSITE_SIDE[ax.side].charAt(0);\n        var pos = axes.getPxPosition(gd, ax);\n        var outsideTickLen = outsideTicks ? ax.ticklen : 0;\n        var llbbox;\n\n        var push;\n        var mirrorPush;\n        var rangeSliderPush;\n\n        if(ax.automargin || hasRangeSlider) {\n            if(ax.type === 'multicategory') {\n                llbbox = getLabelLevelBbox('tick2');\n            } else {\n                llbbox = getLabelLevelBbox();\n                if(axLetter === 'x' && s === 'b') {\n                    ax._depth = Math.max(llbbox.width > 0 ? llbbox.bottom - pos : 0, outsideTickLen);\n                }\n            }\n        }\n\n        if(ax.automargin) {\n            push = {x: 0, y: 0, r: 0, l: 0, t: 0, b: 0};\n            var domainIndices = [0, 1];\n\n            if(axLetter === 'x') {\n                if(s === 'b') {\n                    push[s] = ax._depth;\n                } else {\n                    push[s] = ax._depth = Math.max(llbbox.width > 0 ? pos - llbbox.top : 0, outsideTickLen);\n                    domainIndices.reverse();\n                }\n\n                if(llbbox.width > 0) {\n                    var rExtra = llbbox.right - (ax._offset + ax._length);\n                    if(rExtra > 0) {\n                        push.xr = 1;\n                        push.r = rExtra;\n                    }\n                    var lExtra = ax._offset - llbbox.left;\n                    if(lExtra > 0) {\n                        push.xl = 0;\n                        push.l = lExtra;\n                    }\n                }\n            } else {\n                if(s === 'l') {\n                    push[s] = ax._depth = Math.max(llbbox.height > 0 ? pos - llbbox.left : 0, outsideTickLen);\n                } else {\n                    push[s] = ax._depth = Math.max(llbbox.height > 0 ? llbbox.right - pos : 0, outsideTickLen);\n                    domainIndices.reverse();\n                }\n\n                if(llbbox.height > 0) {\n                    var bExtra = llbbox.bottom - (ax._offset + ax._length);\n                    if(bExtra > 0) {\n                        push.yb = 0;\n                        push.b = bExtra;\n                    }\n                    var tExtra = ax._offset - llbbox.top;\n                    if(tExtra > 0) {\n                        push.yt = 1;\n                        push.t = tExtra;\n                    }\n                }\n            }\n\n            push[counterLetter] = ax.anchor === 'free' ?\n                ax.position :\n                ax._anchorAxis.domain[domainIndices[0]];\n\n            if(ax.title.text !== fullLayout._dfltTitle[axLetter]) {\n                push[s] += approxTitleDepth(ax) + (ax.title.standoff || 0);\n            }\n\n            if(ax.mirror && ax.anchor !== 'free') {\n                mirrorPush = {x: 0, y: 0, r: 0, l: 0, t: 0, b: 0};\n\n                mirrorPush[sMirror] = ax.linewidth;\n                if(ax.mirror && ax.mirror !== true) mirrorPush[sMirror] += outsideTickLen;\n\n                if(ax.mirror === true || ax.mirror === 'ticks') {\n                    mirrorPush[counterLetter] = ax._anchorAxis.domain[domainIndices[1]];\n                } else if(ax.mirror === 'all' || ax.mirror === 'allticks') {\n                    mirrorPush[counterLetter] = [ax._counterDomainMin, ax._counterDomainMax][domainIndices[1]];\n                }\n            }\n        }\n\n        if(hasRangeSlider) {\n            rangeSliderPush = Registry.getComponentMethod('rangeslider', 'autoMarginOpts')(gd, ax);\n        }\n\n        Plots.autoMargin(gd, axAutoMarginID(ax), push);\n        Plots.autoMargin(gd, axMirrorAutoMarginID(ax), mirrorPush);\n        Plots.autoMargin(gd, rangeSliderAutoMarginID(ax), rangeSliderPush);\n    });\n\n    if(!opts.skipTitle &&\n        !(hasRangeSlider && ax.side === 'bottom')\n    ) {\n        seq.push(function() { return drawTitle(gd, ax); });\n    }\n\n    return Lib.syncOrAsync(seq);\n};\n\nfunction getBoundaryVals(ax, vals) {\n    var out = [];\n    var i;\n\n    // boundaryVals are never used for labels;\n    // no need to worry about the other tickTextObj keys\n    var _push = function(d, bndIndex) {\n        var xb = d.xbnd[bndIndex];\n        if(xb !== null) {\n            out.push(Lib.extendFlat({}, d, {x: xb}));\n        }\n    };\n\n    if(vals.length) {\n        for(i = 0; i < vals.length; i++) {\n            _push(vals[i], 0);\n        }\n        _push(vals[i - 1], 1);\n    }\n\n    return out;\n}\n\nfunction getSecondaryLabelVals(ax, vals) {\n    var out = [];\n    var lookup = {};\n\n    for(var i = 0; i < vals.length; i++) {\n        var d = vals[i];\n        if(lookup[d.text2]) {\n            lookup[d.text2].push(d.x);\n        } else {\n            lookup[d.text2] = [d.x];\n        }\n    }\n\n    for(var k in lookup) {\n        out.push(tickTextObj(ax, Lib.interp(lookup[k], 0.5), k));\n    }\n\n    return out;\n}\n\nfunction getDividerVals(ax, vals) {\n    var out = [];\n    var i, current;\n\n    var reversed = (vals.length && vals[vals.length - 1].x < vals[0].x);\n\n    // never used for labels;\n    // no need to worry about the other tickTextObj keys\n    var _push = function(d, bndIndex) {\n        var xb = d.xbnd[bndIndex];\n        if(xb !== null) {\n            out.push(Lib.extendFlat({}, d, {x: xb}));\n        }\n    };\n\n    if(ax.showdividers && vals.length) {\n        for(i = 0; i < vals.length; i++) {\n            var d = vals[i];\n            if(d.text2 !== current) {\n                _push(d, reversed ? 1 : 0);\n            }\n            current = d.text2;\n        }\n        _push(vals[i - 1], reversed ? 0 : 1);\n    }\n\n    return out;\n}\n\nfunction calcLabelLevelBbox(ax, cls) {\n    var top, bottom;\n    var left, right;\n\n    if(ax._selections[cls].size()) {\n        top = Infinity;\n        bottom = -Infinity;\n        left = Infinity;\n        right = -Infinity;\n        ax._selections[cls].each(function() {\n            var thisLabel = selectTickLabel(this);\n            // Use parent node <g.(x|y)tick>, to make Drawing.bBox\n            // retrieve a bbox computed with transform info\n            //\n            // To improve perf, it would be nice to use `thisLabel.node()`\n            // (like in fixLabelOverlaps) instead and use Axes.getPxPosition\n            // together with the makeLabelFns outputs and `tickangle`\n            // to compute one bbox per (tick value x tick style)\n            var bb = Drawing.bBox(thisLabel.node().parentNode);\n            top = Math.min(top, bb.top);\n            bottom = Math.max(bottom, bb.bottom);\n            left = Math.min(left, bb.left);\n            right = Math.max(right, bb.right);\n        });\n    } else {\n        top = 0;\n        bottom = 0;\n        left = 0;\n        right = 0;\n    }\n\n    return {\n        top: top,\n        bottom: bottom,\n        left: left,\n        right: right,\n        height: bottom - top,\n        width: right - left\n    };\n}\n\n/**\n * Which direction do the 'ax.side' values, and free ticks go?\n *\n * @param {object} ax (full) axis object\n *  - {string} _id (starting with 'x' or 'y')\n *  - {string} side\n *  - {string} ticks\n * @return {array} all entries are either -1 or 1\n *  - [0]: sign for top/right ticks (i.e. negative SVG direction)\n *  - [1]: sign for bottom/left ticks (i.e. positive SVG direction)\n *  - [2]: sign for ticks corresponding to 'ax.side'\n *  - [3]: sign for ticks mirroring 'ax.side'\n *  - [4]: sign of arrow starting at axis pointing towards margin\n */\naxes.getTickSigns = function(ax) {\n    var axLetter = ax._id.charAt(0);\n    var sideOpposite = {x: 'top', y: 'right'}[axLetter];\n    var main = ax.side === sideOpposite ? 1 : -1;\n    var out = [-1, 1, main, -main];\n    // then we flip if outside XOR y axis\n    if((ax.ticks !== 'inside') === (axLetter === 'x')) {\n        out = out.map(function(v) { return -v; });\n    }\n    // independent of `ticks`; do not flip this one\n    if(ax.side) {\n        out.push({l: -1, t: -1, r: 1, b: 1}[ax.side.charAt(0)]);\n    }\n    return out;\n};\n\n/**\n * Make axis translate transform function\n *\n * @param {object} ax (full) axis object\n *  - {string} _id\n *  - {number} _offset\n *  - {fn} l2p\n * @return {fn} function of calcTicks items\n */\naxes.makeTransTickFn = function(ax) {\n    return ax._id.charAt(0) === 'x' ?\n        function(d) { return strTranslate(ax._offset + ax.l2p(d.x), 0); } :\n        function(d) { return strTranslate(0, ax._offset + ax.l2p(d.x)); };\n};\n\naxes.makeTransTickLabelFn = function(ax) {\n    var uv = getTickLabelUV(ax);\n    var u = uv[0];\n    var v = uv[1];\n\n    return ax._id.charAt(0) === 'x' ?\n        function(d) {\n            return strTranslate(\n                u + ax._offset + ax.l2p(getPosX(d)),\n                v\n            );\n        } :\n        function(d) {\n            return strTranslate(\n                v,\n                u + ax._offset + ax.l2p(getPosX(d))\n            );\n        };\n};\n\nfunction getPosX(d) {\n    return d.periodX !== undefined ? d.periodX : d.x;\n}\n\n// u is a shift along the axis,\n// v is a shift perpendicular to the axis\nfunction getTickLabelUV(ax) {\n    var ticklabelposition = ax.ticklabelposition || '';\n    var has = function(str) {\n        return ticklabelposition.indexOf(str) !== -1;\n    };\n\n    var isTop = has('top');\n    var isLeft = has('left');\n    var isRight = has('right');\n    var isBottom = has('bottom');\n    var isInside = has('inside');\n\n    var isAligned = isBottom || isLeft || isTop || isRight;\n\n    // early return\n    if(!isAligned && !isInside) return [0, 0];\n\n    var side = ax.side;\n\n    var u = isAligned ? (ax.tickwidth || 0) / 2 : 0;\n    var v = TEXTPAD;\n\n    var fontSize = ax.tickfont ? ax.tickfont.size : 12;\n    if(isBottom || isTop) {\n        u += fontSize * CAP_SHIFT;\n        v += (ax.linewidth || 0) / 2;\n    }\n    if(isLeft || isRight) {\n        u += (ax.linewidth || 0) / 2;\n        v += TEXTPAD;\n    }\n    if(isInside && side === 'top') {\n        v -= fontSize * (1 - CAP_SHIFT);\n    }\n\n    if(isLeft || isTop) u = -u;\n    if(side === 'bottom' || side === 'right') v = -v;\n\n    return [\n        isAligned ? u : 0,\n        isInside ? v : 0\n    ];\n}\n\n/**\n * Make axis tick path string\n *\n * @param {object} ax (full) axis object\n *  - {string} _id\n *  - {number} ticklen\n *  - {number} linewidth\n * @param {number} shift along direction of ticklen\n * @param {1 or -1} sgn tick sign\n * @param {number (optional)} len tick length\n * @return {string}\n */\naxes.makeTickPath = function(ax, shift, sgn, len) {\n    len = len !== undefined ? len : ax.ticklen;\n\n    var axLetter = ax._id.charAt(0);\n    var pad = (ax.linewidth || 1) / 2;\n\n    return axLetter === 'x' ?\n        'M0,' + (shift + pad * sgn) + 'v' + (len * sgn) :\n        'M' + (shift + pad * sgn) + ',0h' + (len * sgn);\n};\n\n/**\n * Make axis tick label x, y and anchor functions\n *\n * @param {object} ax (full) axis object\n *  - {string} _id\n *  - {string} ticks\n *  - {number} ticklen\n *  - {string} side\n *  - {number} linewidth\n *  - {number} tickfont.size\n *  - {boolean} showline\n * @param {number} shift\n * @param {number} angle [in degrees] ...\n * @return {object}\n *  - {fn} xFn\n *  - {fn} yFn\n *  - {fn} anchorFn\n *  - {fn} heightFn\n *  - {number} labelStandoff (gap parallel to ticks)\n *  - {number} labelShift (gap perpendicular to ticks)\n */\naxes.makeLabelFns = function(ax, shift, angle) {\n    var ticklabelposition = ax.ticklabelposition || '';\n    var has = function(str) {\n        return ticklabelposition.indexOf(str) !== -1;\n    };\n\n    var isTop = has('top');\n    var isLeft = has('left');\n    var isRight = has('right');\n    var isBottom = has('bottom');\n    var isAligned = isBottom || isLeft || isTop || isRight;\n\n    var insideTickLabels = has('inside');\n    var labelsOverTicks =\n        (ticklabelposition === 'inside' && ax.ticks === 'inside') ||\n        (!insideTickLabels && ax.ticks === 'outside' && ax.tickson !== 'boundaries');\n\n    var labelStandoff = 0;\n    var labelShift = 0;\n\n    var tickLen = labelsOverTicks ? ax.ticklen : 0;\n    if(insideTickLabels) {\n        tickLen *= -1;\n    } else if(isAligned) {\n        tickLen = 0;\n    }\n\n    if(labelsOverTicks) {\n        labelStandoff += tickLen;\n        if(angle) {\n            var rad = Lib.deg2rad(angle);\n            labelStandoff = tickLen * Math.cos(rad) + 1;\n            labelShift = tickLen * Math.sin(rad);\n        }\n    }\n\n    if(ax.showticklabels && (labelsOverTicks || ax.showline)) {\n        labelStandoff += 0.2 * ax.tickfont.size;\n    }\n    labelStandoff += (ax.linewidth || 1) / 2 * (insideTickLabels ? -1 : 1);\n\n    var out = {\n        labelStandoff: labelStandoff,\n        labelShift: labelShift\n    };\n\n    var x0, y0, ff, flipIt;\n    var xQ = 0;\n\n    var side = ax.side;\n    var axLetter = ax._id.charAt(0);\n    var tickangle = ax.tickangle;\n    var endSide;\n    if(axLetter === 'x') {\n        endSide =\n            (!insideTickLabels && side === 'bottom') ||\n            (insideTickLabels && side === 'top');\n\n        flipIt = endSide ? 1 : -1;\n        if(insideTickLabels) flipIt *= -1;\n\n        x0 = labelShift * flipIt;\n        y0 = shift + labelStandoff * flipIt;\n        ff = endSide ? 1 : -0.2;\n        if(Math.abs(tickangle) === 90) {\n            if(insideTickLabels) {\n                ff += MID_SHIFT;\n            } else {\n                if(tickangle === -90 && side === 'bottom') {\n                    ff = CAP_SHIFT;\n                } else if(tickangle === 90 && side === 'top') {\n                    ff = MID_SHIFT;\n                } else {\n                    ff = 0.5;\n                }\n            }\n\n            xQ = (MID_SHIFT / 2) * (tickangle / 90);\n        }\n\n        out.xFn = function(d) { return d.dx + x0 + xQ * d.fontSize; };\n        out.yFn = function(d) { return d.dy + y0 + d.fontSize * ff; };\n        out.anchorFn = function(d, a) {\n            if(isAligned) {\n                if(isLeft) return 'end';\n                if(isRight) return 'start';\n            }\n\n            if(!isNumeric(a) || a === 0 || a === 180) {\n                return 'middle';\n            }\n\n            return ((a * flipIt < 0) !== insideTickLabels) ? 'end' : 'start';\n        };\n        out.heightFn = function(d, a, h) {\n            return (a < -60 || a > 60) ? -0.5 * h :\n                ((ax.side === 'top') !== insideTickLabels) ? -h :\n                0;\n        };\n    } else if(axLetter === 'y') {\n        endSide =\n            (!insideTickLabels && side === 'left') ||\n            (insideTickLabels && side === 'right');\n\n        flipIt = endSide ? 1 : -1;\n        if(insideTickLabels) flipIt *= -1;\n\n        x0 = labelStandoff;\n        y0 = labelShift * flipIt;\n        ff = 0;\n        if(!insideTickLabels && Math.abs(tickangle) === 90) {\n            if(\n                (tickangle === -90 && side === 'left') ||\n                (tickangle === 90 && side === 'right')\n            ) {\n                ff = CAP_SHIFT;\n            } else {\n                ff = 0.5;\n            }\n        }\n\n        if(insideTickLabels) {\n            var ang = isNumeric(tickangle) ? +tickangle : 0;\n            if(ang !== 0) {\n                var rA = Lib.deg2rad(ang);\n                xQ = Math.abs(Math.sin(rA)) * CAP_SHIFT * flipIt;\n                ff = 0;\n            }\n        }\n\n        out.xFn = function(d) { return d.dx + shift - (x0 + d.fontSize * ff) * flipIt + xQ * d.fontSize; };\n        out.yFn = function(d) { return d.dy + y0 + d.fontSize * MID_SHIFT; };\n        out.anchorFn = function(d, a) {\n            if(isNumeric(a) && Math.abs(a) === 90) {\n                return 'middle';\n            }\n\n            return endSide ? 'end' : 'start';\n        };\n        out.heightFn = function(d, a, h) {\n            if(ax.side === 'right') a *= -1;\n\n            return a < -30 ? -h :\n                a < 30 ? -0.5 * h :\n                0;\n        };\n    }\n\n    return out;\n};\n\nfunction tickDataFn(d) {\n    return [d.text, d.x, d.axInfo, d.font, d.fontSize, d.fontColor].join('_');\n}\n\n/**\n * Draw axis ticks\n *\n * @param {DOM element} gd\n * @param {object} ax (full) axis object\n *  - {string} _id\n *  - {string} ticks\n *  - {number} linewidth\n *  - {string} tickcolor\n * @param {object} opts\n * - {array of object} vals (calcTicks output-like)\n * - {d3 selection} layer\n * - {string or fn} path\n * - {fn} transFn\n * - {boolean} crisp (set to false to unset crisp-edge SVG rendering)\n */\naxes.drawTicks = function(gd, ax, opts) {\n    opts = opts || {};\n\n    var cls = ax._id + 'tick';\n\n    var vals = opts.vals;\n    if(\n        ax.ticklabelmode === 'period'\n    ) {\n        // drop very first tick that we added to handle period\n        vals = vals.slice();\n        vals.shift();\n    }\n\n    var ticks = opts.layer.selectAll('path.' + cls)\n        .data(ax.ticks ? vals : [], tickDataFn);\n\n    ticks.exit().remove();\n\n    ticks.enter().append('path')\n        .classed(cls, 1)\n        .classed('ticks', 1)\n        .classed('crisp', opts.crisp !== false)\n        .call(Color.stroke, ax.tickcolor)\n        .style('stroke-width', Drawing.crispRound(gd, ax.tickwidth, 1) + 'px')\n        .attr('d', opts.path)\n        .style('display', null); // visible\n\n    hideCounterAxisInsideTickLabels(ax, [TICK_PATH]);\n\n    ticks.attr('transform', opts.transFn);\n};\n\n/**\n * Draw axis grid\n *\n * @param {DOM element} gd\n * @param {object} ax (full) axis object\n *  - {string} _id\n *  - {boolean} showgrid\n *  - {string} gridcolor\n *  - {string} gridwidth\n *  - {boolean} zeroline\n *  - {string} type\n *  - {string} dtick\n * @param {object} opts\n * - {array of object} vals (calcTicks output-like)\n * - {d3 selection} layer\n * - {object} counterAxis (full axis object corresponding to counter axis)\n *     optional - only required if this axis supports zero lines\n * - {string or fn} path\n * - {fn} transFn\n * - {boolean} crisp (set to false to unset crisp-edge SVG rendering)\n */\naxes.drawGrid = function(gd, ax, opts) {\n    opts = opts || {};\n\n    var cls = ax._id + 'grid';\n    var vals = opts.vals;\n    var counterAx = opts.counterAxis;\n    if(ax.showgrid === false) {\n        vals = [];\n    } else if(counterAx && axes.shouldShowZeroLine(gd, ax, counterAx)) {\n        var isArrayMode = ax.tickmode === 'array';\n        for(var i = 0; i < vals.length; i++) {\n            var xi = vals[i].x;\n            if(isArrayMode ? !xi : (Math.abs(xi) < ax.dtick / 100)) {\n                vals = vals.slice(0, i).concat(vals.slice(i + 1));\n                // In array mode you can in principle have multiple\n                // ticks at 0, so test them all. Otherwise once we found\n                // one we can stop.\n                if(isArrayMode) i--;\n                else break;\n            }\n        }\n    }\n\n    var grid = opts.layer.selectAll('path.' + cls)\n        .data(vals, tickDataFn);\n\n    grid.exit().remove();\n\n    grid.enter().append('path')\n        .classed(cls, 1)\n        .classed('crisp', opts.crisp !== false);\n\n    ax._gw = Drawing.crispRound(gd, ax.gridwidth, 1);\n\n    grid.attr('transform', opts.transFn)\n        .attr('d', opts.path)\n        .call(Color.stroke, ax.gridcolor || '#ddd')\n        .style('stroke-width', ax._gw + 'px')\n        .style('display', null); // visible\n\n    hideCounterAxisInsideTickLabels(ax, [GRID_PATH]);\n\n    if(typeof opts.path === 'function') grid.attr('d', opts.path);\n};\n\n/**\n * Draw axis zero-line\n *\n * @param {DOM element} gd\n * @param {object} ax (full) axis object\n *  - {string} _id\n *  - {boolean} zeroline\n *  - {number} zerolinewidth\n *  - {string} zerolinecolor\n *  - {number (optional)} _gridWidthCrispRound\n * @param {object} opts\n * - {d3 selection} layer\n * - {object} counterAxis (full axis object corresponding to counter axis)\n * - {string or fn} path\n * - {fn} transFn\n * - {boolean} crisp (set to false to unset crisp-edge SVG rendering)\n */\naxes.drawZeroLine = function(gd, ax, opts) {\n    opts = opts || opts;\n\n    var cls = ax._id + 'zl';\n    var show = axes.shouldShowZeroLine(gd, ax, opts.counterAxis);\n\n    var zl = opts.layer.selectAll('path.' + cls)\n        .data(show ? [{x: 0, id: ax._id}] : []);\n\n    zl.exit().remove();\n\n    zl.enter().append('path')\n        .classed(cls, 1)\n        .classed('zl', 1)\n        .classed('crisp', opts.crisp !== false)\n        .each(function() {\n            // use the fact that only one element can enter to trigger a sort.\n            // If several zerolines enter at the same time we will sort once per,\n            // but generally this should be a minimal overhead.\n            opts.layer.selectAll('path').sort(function(da, db) {\n                return idSort(da.id, db.id);\n            });\n        });\n\n    zl.attr('transform', opts.transFn)\n        .attr('d', opts.path)\n        .call(Color.stroke, ax.zerolinecolor || Color.defaultLine)\n        .style('stroke-width', Drawing.crispRound(gd, ax.zerolinewidth, ax._gw || 1) + 'px')\n        .style('display', null); // visible\n\n    hideCounterAxisInsideTickLabels(ax, [ZERO_PATH]);\n};\n\n/**\n * Draw axis tick labels\n *\n * @param {DOM element} gd\n * @param {object} ax (full) axis object\n *  - {string} _id\n *  - {boolean} showticklabels\n *  - {number} tickangle\n *  - {object (optional)} _selections\n *  - {object} (optional)} _tickAngles\n *  - {object} (optional)} _prevTickAngles\n * @param {object} opts\n * - {array of object} vals (calcTicks output-like)\n * - {d3 selection} layer\n * - {string (optional)} cls (node className)\n * - {boolean} repositionOnUpdate (set to true to reposition update selection)\n * - {boolean} secondary\n * - {fn} transFn\n * - {object} labelFns\n *  + {fn} xFn\n *  + {fn} yFn\n *  + {fn} anchorFn\n *  + {fn} heightFn\n */\naxes.drawLabels = function(gd, ax, opts) {\n    opts = opts || {};\n\n    var fullLayout = gd._fullLayout;\n    var axId = ax._id;\n    var axLetter = axId.charAt(0);\n    var cls = opts.cls || axId + 'tick';\n    var vals = opts.vals;\n\n    var labelFns = opts.labelFns;\n    var tickAngle = opts.secondary ? 0 : ax.tickangle;\n    var prevAngle = (ax._prevTickAngles || {})[cls];\n\n    var tickLabels = opts.layer.selectAll('g.' + cls)\n        .data(ax.showticklabels ? vals : [], tickDataFn);\n\n    var labelsReady = [];\n\n    tickLabels.enter().append('g')\n        .classed(cls, 1)\n        .append('text')\n            // only so tex has predictable alignment that we can\n            // alter later\n            .attr('text-anchor', 'middle')\n            .each(function(d) {\n                var thisLabel = d3.select(this);\n                var newPromise = gd._promises.length;\n\n                thisLabel\n                    .call(svgTextUtils.positionText, labelFns.xFn(d), labelFns.yFn(d))\n                    .call(Drawing.font, d.font, d.fontSize, d.fontColor)\n                    .text(d.text)\n                    .call(svgTextUtils.convertToTspans, gd);\n\n                if(gd._promises[newPromise]) {\n                    // if we have an async label, we'll deal with that\n                    // all here so take it out of gd._promises and\n                    // instead position the label and promise this in\n                    // labelsReady\n                    labelsReady.push(gd._promises.pop().then(function() {\n                        positionLabels(thisLabel, tickAngle);\n                    }));\n                } else {\n                    // sync label: just position it now.\n                    positionLabels(thisLabel, tickAngle);\n                }\n            });\n\n    hideCounterAxisInsideTickLabels(ax, [TICK_TEXT]);\n\n    tickLabels.exit().remove();\n\n    if(opts.repositionOnUpdate) {\n        tickLabels.each(function(d) {\n            d3.select(this).select('text')\n                .call(svgTextUtils.positionText, labelFns.xFn(d), labelFns.yFn(d));\n        });\n    }\n\n    function positionLabels(s, angle) {\n        s.each(function(d) {\n            var thisLabel = d3.select(this);\n            var mathjaxGroup = thisLabel.select('.text-math-group');\n            var anchor = labelFns.anchorFn(d, angle);\n\n            var transform = opts.transFn.call(thisLabel.node(), d) +\n                ((isNumeric(angle) && +angle !== 0) ?\n                (' rotate(' + angle + ',' + labelFns.xFn(d) + ',' +\n                    (labelFns.yFn(d) - d.fontSize / 2) + ')') :\n                '');\n\n            // how much to shift a multi-line label to center it vertically.\n            var nLines = svgTextUtils.lineCount(thisLabel);\n            var lineHeight = LINE_SPACING * d.fontSize;\n            var anchorHeight = labelFns.heightFn(d, isNumeric(angle) ? +angle : 0, (nLines - 1) * lineHeight);\n\n            if(anchorHeight) {\n                transform += strTranslate(0, anchorHeight);\n            }\n\n            if(mathjaxGroup.empty()) {\n                var thisText = thisLabel.select('text');\n                thisText.attr({\n                    transform: transform,\n                    'text-anchor': anchor\n                });\n\n                thisText.style('opacity', 1); // visible\n\n                if(ax._adjustTickLabelsOverflow) {\n                    ax._adjustTickLabelsOverflow();\n                }\n            } else {\n                var mjWidth = Drawing.bBox(mathjaxGroup.node()).width;\n                var mjShift = mjWidth * {end: -0.5, start: 0.5}[anchor];\n                mathjaxGroup.attr('transform', transform + strTranslate(mjShift, 0));\n            }\n        });\n    }\n\n    ax._adjustTickLabelsOverflow = function() {\n        var ticklabeloverflow = ax.ticklabeloverflow;\n        if(!ticklabeloverflow || ticklabeloverflow === 'allow') return;\n\n        var hideOverflow = ticklabeloverflow.indexOf('hide') !== -1;\n\n        var isX = ax._id.charAt(0) === 'x';\n        // div positions\n        var p0 = 0;\n        var p1 = isX ?\n            gd._fullLayout.width :\n            gd._fullLayout.height;\n\n        if(ticklabeloverflow.indexOf('domain') !== -1) {\n            // domain positions\n            var rl = Lib.simpleMap(ax.range, ax.r2l);\n            p0 = ax.l2p(rl[0]) + ax._offset;\n            p1 = ax.l2p(rl[1]) + ax._offset;\n        }\n\n        var min = Math.min(p0, p1);\n        var max = Math.max(p0, p1);\n\n        var side = ax.side;\n\n        var visibleLabelMin = Infinity;\n        var visibleLabelMax = -Infinity;\n\n        tickLabels.each(function(d) {\n            var thisLabel = d3.select(this);\n            var mathjaxGroup = thisLabel.select('.text-math-group');\n\n            if(mathjaxGroup.empty()) {\n                var bb = Drawing.bBox(thisLabel.node());\n                var adjust = 0;\n                if(isX) {\n                    if(bb.right > max) adjust = 1;\n                    else if(bb.left < min) adjust = 1;\n                } else {\n                    if(bb.bottom > max) adjust = 1;\n                    else if(bb.top + (ax.tickangle ? 0 : d.fontSize / 4) < min) adjust = 1;\n                }\n\n                var t = thisLabel.select('text');\n                if(adjust) {\n                    if(hideOverflow) t.style('opacity', 0); // hidden\n                } else {\n                    t.style('opacity', 1); // visible\n\n                    if(side === 'bottom' || side === 'right') {\n                        visibleLabelMin = Math.min(visibleLabelMin, isX ? bb.top : bb.left);\n                    } else {\n                        visibleLabelMin = -Infinity;\n                    }\n\n                    if(side === 'top' || side === 'left') {\n                        visibleLabelMax = Math.max(visibleLabelMax, isX ? bb.bottom : bb.right);\n                    } else {\n                        visibleLabelMax = Infinity;\n                    }\n                }\n            } // TODO: hide mathjax?\n        });\n\n        for(var subplot in fullLayout._plots) {\n            var plotinfo = fullLayout._plots[subplot];\n            if(ax._id !== plotinfo.xaxis._id && ax._id !== plotinfo.yaxis._id) continue;\n            var anchorAx = isX ? plotinfo.yaxis : plotinfo.xaxis;\n            if(anchorAx) {\n                anchorAx['_visibleLabelMin_' + ax._id] = visibleLabelMin;\n                anchorAx['_visibleLabelMax_' + ax._id] = visibleLabelMax;\n            }\n        }\n    };\n\n    ax._hideCounterAxisInsideTickLabels = function(partialOpts) {\n        var isX = ax._id.charAt(0) === 'x';\n\n        var anchoredAxes = [];\n        for(var subplot in fullLayout._plots) {\n            var plotinfo = fullLayout._plots[subplot];\n            if(ax._id !== plotinfo.xaxis._id && ax._id !== plotinfo.yaxis._id) continue;\n            anchoredAxes.push(isX ? plotinfo.yaxis : plotinfo.xaxis);\n        }\n\n        anchoredAxes.forEach(function(anchorAx, idx) {\n            if(anchorAx && insideTicklabelposition(anchorAx)) {\n                (partialOpts || [\n                    ZERO_PATH,\n                    GRID_PATH,\n                    TICK_PATH,\n                    TICK_TEXT\n                ]).forEach(function(e) {\n                    var isPeriodLabel =\n                        e.K === 'tick' &&\n                        e.L === 'text' &&\n                        ax.ticklabelmode === 'period';\n\n                    var mainPlotinfo = fullLayout._plots[ax._mainSubplot];\n\n                    var sel;\n                    if(e.K === ZERO_PATH.K) sel = mainPlotinfo.zerolinelayer.selectAll('.' + ax._id + 'zl');\n                    else if(e.K === GRID_PATH.K) sel = mainPlotinfo.gridlayer.selectAll('.' + ax._id);\n                    else sel = mainPlotinfo[ax._id.charAt(0) + 'axislayer'];\n\n                    sel.each(function() {\n                        var w = d3.select(this);\n                        if(e.L) w = w.selectAll(e.L);\n\n                        w.each(function(d) {\n                            var q = ax.l2p(\n                                isPeriodLabel ? getPosX(d) : d.x\n                            ) + ax._offset;\n\n                            var t = d3.select(this);\n                            if(\n                                q < ax['_visibleLabelMax_' + anchorAx._id] &&\n                                q > ax['_visibleLabelMin_' + anchorAx._id]\n                            ) {\n                                t.style('display', 'none'); // hidden\n                            } else if(e.K === 'tick' && !idx) {\n                                t.style('display', null); // visible\n                            }\n                        });\n                    });\n                });\n            }\n        });\n    };\n\n    // make sure all labels are correctly positioned at their base angle\n    // the positionLabels call above is only for newly drawn labels.\n    // do this without waiting, using the last calculated angle to\n    // minimize flicker, then do it again when we know all labels are\n    // there, putting back the prescribed angle to check for overlaps.\n    positionLabels(tickLabels, (prevAngle + 1) ? prevAngle : tickAngle);\n\n    function allLabelsReady() {\n        return labelsReady.length && Promise.all(labelsReady);\n    }\n\n    var autoangle = null;\n\n    function fixLabelOverlaps() {\n        positionLabels(tickLabels, tickAngle);\n\n        // check for auto-angling if x labels overlap\n        // don't auto-angle at all for log axes with\n        // base and digit format\n        if(vals.length && axLetter === 'x' && !isNumeric(tickAngle) &&\n            (ax.type !== 'log' || String(ax.dtick).charAt(0) !== 'D')\n        ) {\n            autoangle = 0;\n\n            var maxFontSize = 0;\n            var lbbArray = [];\n            var i;\n\n            tickLabels.each(function(d) {\n                maxFontSize = Math.max(maxFontSize, d.fontSize);\n\n                var x = ax.l2p(d.x);\n                var thisLabel = selectTickLabel(this);\n                var bb = Drawing.bBox(thisLabel.node());\n\n                lbbArray.push({\n                    // ignore about y, just deal with x overlaps\n                    top: 0,\n                    bottom: 10,\n                    height: 10,\n                    left: x - bb.width / 2,\n                    // impose a 2px gap\n                    right: x + bb.width / 2 + 2,\n                    width: bb.width + 2\n                });\n            });\n\n            if((ax.tickson === 'boundaries' || ax.showdividers) && !opts.secondary) {\n                var gap = 2;\n                if(ax.ticks) gap += ax.tickwidth / 2;\n\n                // TODO should secondary labels also fall into this fix-overlap regime?\n\n                for(i = 0; i < lbbArray.length; i++) {\n                    var xbnd = vals[i].xbnd;\n                    var lbb = lbbArray[i];\n                    if(\n                        (xbnd[0] !== null && (lbb.left - ax.l2p(xbnd[0])) < gap) ||\n                        (xbnd[1] !== null && (ax.l2p(xbnd[1]) - lbb.right) < gap)\n                    ) {\n                        autoangle = 90;\n                        break;\n                    }\n                }\n            } else {\n                var vLen = vals.length;\n                var tickSpacing = Math.abs((vals[vLen - 1].x - vals[0].x) * ax._m) / (vLen - 1);\n\n                var ticklabelposition = ax.ticklabelposition || '';\n                var has = function(str) {\n                    return ticklabelposition.indexOf(str) !== -1;\n                };\n                var isTop = has('top');\n                var isLeft = has('left');\n                var isRight = has('right');\n                var isBottom = has('bottom');\n                var isAligned = isBottom || isLeft || isTop || isRight;\n                var pad = !isAligned ? 0 :\n                    (ax.tickwidth || 0) + 2 * TEXTPAD;\n\n                var rotate90 = (tickSpacing < maxFontSize * 2.5) || ax.type === 'multicategory';\n\n                // any overlap at all - set 30 degrees or 90 degrees\n                for(i = 0; i < lbbArray.length - 1; i++) {\n                    if(Lib.bBoxIntersect(lbbArray[i], lbbArray[i + 1], pad)) {\n                        autoangle = rotate90 ? 90 : 30;\n                        break;\n                    }\n                }\n            }\n\n            if(autoangle) {\n                positionLabels(tickLabels, autoangle);\n            }\n        }\n    }\n\n    if(ax._selections) {\n        ax._selections[cls] = tickLabels;\n    }\n\n    var seq = [allLabelsReady];\n\n    // N.B. during auto-margin redraws, if the axis fixed its label overlaps\n    // by rotating 90 degrees, do not attempt to re-fix its label overlaps\n    // as this can lead to infinite redraw loops!\n    if(ax.automargin && fullLayout._redrawFromAutoMarginCount && prevAngle === 90) {\n        autoangle = 90;\n        seq.push(function() {\n            positionLabels(tickLabels, prevAngle);\n        });\n    } else {\n        seq.push(fixLabelOverlaps);\n    }\n\n    // save current tick angle for future redraws\n    if(ax._tickAngles) {\n        seq.push(function() {\n            ax._tickAngles[cls] = autoangle === null ?\n                (isNumeric(tickAngle) ? tickAngle : 0) :\n                autoangle;\n        });\n    }\n\n    var anchorAx = ax._anchorAxis;\n    if(\n        anchorAx && anchorAx.autorange &&\n        insideTicklabelposition(ax) &&\n        !isLinked(fullLayout, ax._id)\n    ) {\n        if(!fullLayout._insideTickLabelsAutorange) {\n            fullLayout._insideTickLabelsAutorange = {};\n        }\n        fullLayout._insideTickLabelsAutorange[anchorAx._name + '.autorange'] = anchorAx.autorange;\n\n        seq.push(\n            function computeFinalTickLabelBoundingBoxes() {\n                tickLabels.each(function(d, i) {\n                    var thisLabel = selectTickLabel(this);\n                    var mathjaxGroup = thisLabel.select('.text-math-group');\n                    if(mathjaxGroup.empty()) {\n                        ax._vals[i].bb = Drawing.bBox(thisLabel.node());\n                    }\n                });\n            }\n        );\n    }\n\n    var done = Lib.syncOrAsync(seq);\n    if(done && done.then) gd._promises.push(done);\n    return done;\n};\n\n/**\n * Draw axis dividers\n *\n * @param {DOM element} gd\n * @param {object} ax (full) axis object\n *  - {string} _id\n *  - {string} showdividers\n *  - {number} dividerwidth\n *  - {string} dividercolor\n * @param {object} opts\n * - {array of object} vals (calcTicks output-like)\n * - {d3 selection} layer\n * - {fn} path\n * - {fn} transFn\n */\nfunction drawDividers(gd, ax, opts) {\n    var cls = ax._id + 'divider';\n    var vals = opts.vals;\n\n    var dividers = opts.layer.selectAll('path.' + cls)\n        .data(vals, tickDataFn);\n\n    dividers.exit().remove();\n\n    dividers.enter().insert('path', ':first-child')\n        .classed(cls, 1)\n        .classed('crisp', 1)\n        .call(Color.stroke, ax.dividercolor)\n        .style('stroke-width', Drawing.crispRound(gd, ax.dividerwidth, 1) + 'px');\n\n    dividers\n        .attr('transform', opts.transFn)\n        .attr('d', opts.path);\n}\n\n/**\n * Get axis position in px, that is the distance for the graph's\n * top (left) edge for x (y) axes.\n *\n * @param {DOM element} gd\n * @param {object} ax (full) axis object\n *  - {string} _id\n *  - {string} side\n *  if anchored:\n *  - {object} _anchorAxis\n *  Otherwise:\n *  - {number} position\n * @return {number}\n */\naxes.getPxPosition = function(gd, ax) {\n    var gs = gd._fullLayout._size;\n    var axLetter = ax._id.charAt(0);\n    var side = ax.side;\n    var anchorAxis;\n\n    if(ax.anchor !== 'free') {\n        anchorAxis = ax._anchorAxis;\n    } else if(axLetter === 'x') {\n        anchorAxis = {\n            _offset: gs.t + (1 - (ax.position || 0)) * gs.h,\n            _length: 0\n        };\n    } else if(axLetter === 'y') {\n        anchorAxis = {\n            _offset: gs.l + (ax.position || 0) * gs.w,\n            _length: 0\n        };\n    }\n\n    if(side === 'top' || side === 'left') {\n        return anchorAxis._offset;\n    } else if(side === 'bottom' || side === 'right') {\n        return anchorAxis._offset + anchorAxis._length;\n    }\n};\n\n/**\n * Approximate axis title depth (w/o computing its bounding box)\n *\n * @param {object} ax (full) axis object\n *  - {string} title.text\n *  - {number} title.font.size\n *  - {number} title.standoff\n * @return {number} (in px)\n */\nfunction approxTitleDepth(ax) {\n    var fontSize = ax.title.font.size;\n    var extraLines = (ax.title.text.match(svgTextUtils.BR_TAG_ALL) || []).length;\n    if(ax.title.hasOwnProperty('standoff')) {\n        return extraLines ?\n            fontSize * (CAP_SHIFT + (extraLines * LINE_SPACING)) :\n            fontSize * CAP_SHIFT;\n    } else {\n        return extraLines ?\n            fontSize * (extraLines + 1) * LINE_SPACING :\n            fontSize;\n    }\n}\n\n/**\n * Draw axis title, compute default standoff if necessary\n *\n * @param {DOM element} gd\n * @param {object} ax (full) axis object\n *  - {string} _id\n *  - {string} _name\n *  - {string} side\n *  - {number} title.font.size\n *  - {object} _selections\n *\n *  - {number} _depth\n *  - {number} title.standoff\n *  OR\n *  - {number} linewidth\n *  - {boolean} showticklabels\n */\nfunction drawTitle(gd, ax) {\n    var fullLayout = gd._fullLayout;\n    var axId = ax._id;\n    var axLetter = axId.charAt(0);\n    var fontSize = ax.title.font.size;\n    var titleStandoff;\n\n    if(ax.title.hasOwnProperty('standoff')) {\n        titleStandoff = ax._depth + ax.title.standoff + approxTitleDepth(ax);\n    } else {\n        var isInside = insideTicklabelposition(ax);\n\n        if(ax.type === 'multicategory') {\n            titleStandoff = ax._depth;\n        } else {\n            var offsetBase = 1.5 * fontSize;\n            if(isInside) {\n                offsetBase = 0.5 * fontSize;\n                if(ax.ticks === 'outside') {\n                    offsetBase += ax.ticklen;\n                }\n            }\n            titleStandoff = 10 + offsetBase + (ax.linewidth ? ax.linewidth - 1 : 0);\n        }\n\n        if(!isInside) {\n            if(axLetter === 'x') {\n                titleStandoff += ax.side === 'top' ?\n                    fontSize * (ax.showticklabels ? 1 : 0) :\n                    fontSize * (ax.showticklabels ? 1.5 : 0.5);\n            } else {\n                titleStandoff += ax.side === 'right' ?\n                    fontSize * (ax.showticklabels ? 1 : 0.5) :\n                    fontSize * (ax.showticklabels ? 0.5 : 0);\n            }\n        }\n    }\n\n    var pos = axes.getPxPosition(gd, ax);\n    var transform, x, y;\n\n    if(axLetter === 'x') {\n        x = ax._offset + ax._length / 2;\n        y = (ax.side === 'top') ? pos - titleStandoff : pos + titleStandoff;\n    } else {\n        y = ax._offset + ax._length / 2;\n        x = (ax.side === 'right') ? pos + titleStandoff : pos - titleStandoff;\n        transform = {rotate: '-90', offset: 0};\n    }\n\n    var avoid;\n\n    if(ax.type !== 'multicategory') {\n        var tickLabels = ax._selections[ax._id + 'tick'];\n\n        avoid = {\n            selection: tickLabels,\n            side: ax.side\n        };\n\n        if(tickLabels && tickLabels.node() && tickLabels.node().parentNode) {\n            var translation = Drawing.getTranslate(tickLabels.node().parentNode);\n            avoid.offsetLeft = translation.x;\n            avoid.offsetTop = translation.y;\n        }\n\n        if(ax.title.hasOwnProperty('standoff')) {\n            avoid.pad = 0;\n        }\n    }\n\n    return Titles.draw(gd, axId + 'title', {\n        propContainer: ax,\n        propName: ax._name + '.title.text',\n        placeholder: fullLayout._dfltTitle[axLetter],\n        avoid: avoid,\n        transform: transform,\n        attributes: {x: x, y: y, 'text-anchor': 'middle'}\n    });\n}\n\naxes.shouldShowZeroLine = function(gd, ax, counterAxis) {\n    var rng = Lib.simpleMap(ax.range, ax.r2l);\n    return (\n        (rng[0] * rng[1] <= 0) &&\n        ax.zeroline &&\n        (ax.type === 'linear' || ax.type === '-') &&\n        !(ax.rangebreaks && ax.maskBreaks(0) === BADNUM) &&\n        (\n            clipEnds(ax, 0) ||\n            !anyCounterAxLineAtZero(gd, ax, counterAxis, rng) ||\n            hasBarsOrFill(gd, ax)\n        )\n    );\n};\n\naxes.clipEnds = function(ax, vals) {\n    return vals.filter(function(d) { return clipEnds(ax, d.x); });\n};\n\nfunction clipEnds(ax, l) {\n    var p = ax.l2p(l);\n    return (p > 1 && p < ax._length - 1);\n}\n\nfunction anyCounterAxLineAtZero(gd, ax, counterAxis, rng) {\n    var mainCounterAxis = counterAxis._mainAxis;\n    if(!mainCounterAxis) return;\n\n    var fullLayout = gd._fullLayout;\n    var axLetter = ax._id.charAt(0);\n    var counterLetter = axes.counterLetter(ax._id);\n\n    var zeroPosition = ax._offset + (\n        ((Math.abs(rng[0]) < Math.abs(rng[1])) === (axLetter === 'x')) ?\n        0 : ax._length\n    );\n\n    function lineNearZero(ax2) {\n        if(!ax2.showline || !ax2.linewidth) return false;\n        var tolerance = Math.max((ax2.linewidth + ax.zerolinewidth) / 2, 1);\n\n        function closeEnough(pos2) {\n            return typeof pos2 === 'number' && Math.abs(pos2 - zeroPosition) < tolerance;\n        }\n\n        if(closeEnough(ax2._mainLinePosition) || closeEnough(ax2._mainMirrorPosition)) {\n            return true;\n        }\n        var linePositions = ax2._linepositions || {};\n        for(var k in linePositions) {\n            if(closeEnough(linePositions[k][0]) || closeEnough(linePositions[k][1])) {\n                return true;\n            }\n        }\n    }\n\n    var plotinfo = fullLayout._plots[counterAxis._mainSubplot];\n    if(!(plotinfo.mainplotinfo || plotinfo).overlays.length) {\n        return lineNearZero(counterAxis, zeroPosition);\n    }\n\n    var counterLetterAxes = axes.list(gd, counterLetter);\n    for(var i = 0; i < counterLetterAxes.length; i++) {\n        var counterAxis2 = counterLetterAxes[i];\n        if(\n            counterAxis2._mainAxis === mainCounterAxis &&\n            lineNearZero(counterAxis2, zeroPosition)\n        ) {\n            return true;\n        }\n    }\n}\n\nfunction hasBarsOrFill(gd, ax) {\n    var fullData = gd._fullData;\n    var subplot = ax._mainSubplot;\n    var axLetter = ax._id.charAt(0);\n\n    for(var i = 0; i < fullData.length; i++) {\n        var trace = fullData[i];\n\n        if(trace.visible === true && (trace.xaxis + trace.yaxis) === subplot) {\n            if(\n                Registry.traceIs(trace, 'bar-like') &&\n                trace.orientation === {x: 'h', y: 'v'}[axLetter]\n            ) return true;\n\n            if(\n                trace.fill &&\n                trace.fill.charAt(trace.fill.length - 1) === axLetter\n            ) return true;\n        }\n    }\n    return false;\n}\n\nfunction selectTickLabel(gTick) {\n    var s = d3.select(gTick);\n    var mj = s.select('.text-math-group');\n    return mj.empty() ? s.select('text') : mj;\n}\n\n/**\n * Find all margin pushers for 2D axes and reserve them for later use\n * Both label and rangeslider automargin calculations happen later so\n * we need to explicitly allow their ids in order to not delete them.\n *\n * TODO: can we pull the actual automargin calls forward to avoid this hack?\n * We're probably also doing multiple redraws in this case, would be faster\n * if we can just do the whole calculation ahead of time and draw once.\n */\naxes.allowAutoMargin = function(gd) {\n    var axList = axes.list(gd, '', true);\n    for(var i = 0; i < axList.length; i++) {\n        var ax = axList[i];\n        if(ax.automargin) {\n            Plots.allowAutoMargin(gd, axAutoMarginID(ax));\n            if(ax.mirror) {\n                Plots.allowAutoMargin(gd, axMirrorAutoMarginID(ax));\n            }\n        }\n        if(Registry.getComponentMethod('rangeslider', 'isVisible')(ax)) {\n            Plots.allowAutoMargin(gd, rangeSliderAutoMarginID(ax));\n        }\n    }\n};\n\nfunction axAutoMarginID(ax) { return ax._id + '.automargin'; }\nfunction axMirrorAutoMarginID(ax) { return axAutoMarginID(ax) + '.mirror'; }\nfunction rangeSliderAutoMarginID(ax) { return ax._id + '.rangeslider'; }\n\n// swap all the presentation attributes of the axes showing these traces\naxes.swap = function(gd, traces) {\n    var axGroups = makeAxisGroups(gd, traces);\n\n    for(var i = 0; i < axGroups.length; i++) {\n        swapAxisGroup(gd, axGroups[i].x, axGroups[i].y);\n    }\n};\n\nfunction makeAxisGroups(gd, traces) {\n    var groups = [];\n    var i, j;\n\n    for(i = 0; i < traces.length; i++) {\n        var groupsi = [];\n        var xi = gd._fullData[traces[i]].xaxis;\n        var yi = gd._fullData[traces[i]].yaxis;\n        if(!xi || !yi) continue; // not a 2D cartesian trace?\n\n        for(j = 0; j < groups.length; j++) {\n            if(groups[j].x.indexOf(xi) !== -1 || groups[j].y.indexOf(yi) !== -1) {\n                groupsi.push(j);\n            }\n        }\n\n        if(!groupsi.length) {\n            groups.push({x: [xi], y: [yi]});\n            continue;\n        }\n\n        var group0 = groups[groupsi[0]];\n        var groupj;\n\n        if(groupsi.length > 1) {\n            for(j = 1; j < groupsi.length; j++) {\n                groupj = groups[groupsi[j]];\n                mergeAxisGroups(group0.x, groupj.x);\n                mergeAxisGroups(group0.y, groupj.y);\n            }\n        }\n        mergeAxisGroups(group0.x, [xi]);\n        mergeAxisGroups(group0.y, [yi]);\n    }\n\n    return groups;\n}\n\nfunction mergeAxisGroups(intoSet, fromSet) {\n    for(var i = 0; i < fromSet.length; i++) {\n        if(intoSet.indexOf(fromSet[i]) === -1) intoSet.push(fromSet[i]);\n    }\n}\n\nfunction swapAxisGroup(gd, xIds, yIds) {\n    var xFullAxes = [];\n    var yFullAxes = [];\n    var layout = gd.layout;\n    var i, j;\n\n    for(i = 0; i < xIds.length; i++) xFullAxes.push(axes.getFromId(gd, xIds[i]));\n    for(i = 0; i < yIds.length; i++) yFullAxes.push(axes.getFromId(gd, yIds[i]));\n\n    var allAxKeys = Object.keys(axAttrs);\n\n    var noSwapAttrs = [\n        'anchor', 'domain', 'overlaying', 'position', 'side', 'tickangle', 'editType'\n    ];\n    var numericTypes = ['linear', 'log'];\n\n    for(i = 0; i < allAxKeys.length; i++) {\n        var keyi = allAxKeys[i];\n        var xVal = xFullAxes[0][keyi];\n        var yVal = yFullAxes[0][keyi];\n        var allEqual = true;\n        var coerceLinearX = false;\n        var coerceLinearY = false;\n        if(keyi.charAt(0) === '_' || typeof xVal === 'function' ||\n                noSwapAttrs.indexOf(keyi) !== -1) {\n            continue;\n        }\n        for(j = 1; j < xFullAxes.length && allEqual; j++) {\n            var xVali = xFullAxes[j][keyi];\n            if(keyi === 'type' && numericTypes.indexOf(xVal) !== -1 &&\n                    numericTypes.indexOf(xVali) !== -1 && xVal !== xVali) {\n                // type is special - if we find a mixture of linear and log,\n                // coerce them all to linear on flipping\n                coerceLinearX = true;\n            } else if(xVali !== xVal) allEqual = false;\n        }\n        for(j = 1; j < yFullAxes.length && allEqual; j++) {\n            var yVali = yFullAxes[j][keyi];\n            if(keyi === 'type' && numericTypes.indexOf(yVal) !== -1 &&\n                    numericTypes.indexOf(yVali) !== -1 && yVal !== yVali) {\n                // type is special - if we find a mixture of linear and log,\n                // coerce them all to linear on flipping\n                coerceLinearY = true;\n            } else if(yFullAxes[j][keyi] !== yVal) allEqual = false;\n        }\n        if(allEqual) {\n            if(coerceLinearX) layout[xFullAxes[0]._name].type = 'linear';\n            if(coerceLinearY) layout[yFullAxes[0]._name].type = 'linear';\n            swapAxisAttrs(layout, keyi, xFullAxes, yFullAxes, gd._fullLayout._dfltTitle);\n        }\n    }\n\n    // now swap x&y for any annotations anchored to these x & y\n    for(i = 0; i < gd._fullLayout.annotations.length; i++) {\n        var ann = gd._fullLayout.annotations[i];\n        if(xIds.indexOf(ann.xref) !== -1 &&\n                yIds.indexOf(ann.yref) !== -1) {\n            Lib.swapAttrs(layout.annotations[i], ['?']);\n        }\n    }\n}\n\nfunction swapAxisAttrs(layout, key, xFullAxes, yFullAxes, dfltTitle) {\n    // in case the value is the default for either axis,\n    // look at the first axis in each list and see if\n    // this key's value is undefined\n    var np = Lib.nestedProperty;\n    var xVal = np(layout[xFullAxes[0]._name], key).get();\n    var yVal = np(layout[yFullAxes[0]._name], key).get();\n    var i;\n\n    if(key === 'title') {\n        // special handling of placeholder titles\n        if(xVal && xVal.text === dfltTitle.x) {\n            xVal.text = dfltTitle.y;\n        }\n        if(yVal && yVal.text === dfltTitle.y) {\n            yVal.text = dfltTitle.x;\n        }\n    }\n\n    for(i = 0; i < xFullAxes.length; i++) {\n        np(layout, xFullAxes[i]._name + '.' + key).set(yVal);\n    }\n    for(i = 0; i < yFullAxes.length; i++) {\n        np(layout, yFullAxes[i]._name + '.' + key).set(xVal);\n    }\n}\n\nfunction isAngular(ax) {\n    return ax._id === 'angularaxis';\n}\n\nfunction moveOutsideBreak(v, ax) {\n    var len = ax._rangebreaks.length;\n    for(var k = 0; k < len; k++) {\n        var brk = ax._rangebreaks[k];\n        if(v >= brk.min && v < brk.max) {\n            return brk.max;\n        }\n    }\n    return v;\n}\n\nfunction insideTicklabelposition(ax) {\n    return ((ax.ticklabelposition || '').indexOf('inside') !== -1);\n}\n\nfunction hideCounterAxisInsideTickLabels(ax, opts) {\n    if(insideTicklabelposition(ax._anchorAxis || {})) {\n        if(ax._hideCounterAxisInsideTickLabels) {\n            ax._hideCounterAxisInsideTickLabels(opts);\n        }\n    }\n}\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\nvar Lib = require('../../lib');\nvar BADNUM = require('../../constants/numerical').BADNUM;\n\nvar isArrayOrTypedArray = Lib.isArrayOrTypedArray;\nvar isDateTime = Lib.isDateTime;\nvar cleanNumber = Lib.cleanNumber;\nvar round = Math.round;\n\nmodule.exports = function autoType(array, calendar, opts) {\n    var a = array;\n\n    var noMultiCategory = opts.noMultiCategory;\n    if(isArrayOrTypedArray(a) && !a.length) return '-';\n    if(!noMultiCategory && multiCategory(a)) return 'multicategory';\n    if(noMultiCategory && Array.isArray(a[0])) { // no need to flat typed arrays here\n        var b = [];\n        for(var i = 0; i < a.length; i++) {\n            if(isArrayOrTypedArray(a[i])) {\n                for(var j = 0; j < a[i].length; j++) {\n                    b.push(a[i][j]);\n                }\n            }\n        }\n        a = b;\n    }\n\n    if(moreDates(a, calendar)) return 'date';\n\n    var convertNumeric = opts.autotypenumbers !== 'strict'; // compare against strict, just in case autotypenumbers was not provided in opts\n    if(category(a, convertNumeric)) return 'category';\n    if(linearOK(a, convertNumeric)) return 'linear';\n\n    return '-';\n};\n\nfunction hasTypeNumber(v, convertNumeric) {\n    return convertNumeric ? isNumeric(v) : typeof v === 'number';\n}\n\n// is there at least one number in array? If not, we should leave\n// ax.type empty so it can be autoset later\nfunction linearOK(a, convertNumeric) {\n    var len = a.length;\n\n    for(var i = 0; i < len; i++) {\n        if(hasTypeNumber(a[i], convertNumeric)) return true;\n    }\n\n    return false;\n}\n\n// does the array a have mostly dates rather than numbers?\n// note: some values can be neither (such as blanks, text)\n// 2- or 4-digit integers can be both, so require twice as many\n// dates as non-dates, to exclude cases with mostly 2 & 4 digit\n// numbers and a few dates\n// as with categories, consider DISTINCT values only.\nfunction moreDates(a, calendar) {\n    var len = a.length;\n\n    var inc = getIncrement(len);\n    var dats = 0;\n    var nums = 0;\n    var seen = {};\n\n    for(var f = 0; f < len; f += inc) {\n        var i = round(f);\n        var ai = a[i];\n        var stri = String(ai);\n        if(seen[stri]) continue;\n        seen[stri] = 1;\n\n        if(isDateTime(ai, calendar)) dats++;\n        if(isNumeric(ai)) nums++;\n    }\n\n    return dats > nums * 2;\n}\n\n// return increment to test at most 1000 points, evenly spaced\nfunction getIncrement(len) {\n    return Math.max(1, (len - 1) / 1000);\n}\n\n// are the (x,y)-values in gd.data mostly text?\n// require twice as many DISTINCT categories as distinct numbers\nfunction category(a, convertNumeric) {\n    var len = a.length;\n\n    var inc = getIncrement(len);\n    var nums = 0;\n    var cats = 0;\n    var seen = {};\n\n    for(var f = 0; f < len; f += inc) {\n        var i = round(f);\n        var ai = a[i];\n        var stri = String(ai);\n        if(seen[stri]) continue;\n        seen[stri] = 1;\n\n        var t = typeof ai;\n        if(t === 'boolean') cats++;\n        else if(convertNumeric ? cleanNumber(ai) !== BADNUM : t === 'number') nums++;\n        else if(t === 'string') cats++;\n    }\n\n    return cats > nums * 2;\n}\n\n// very-loose requirements for multicategory,\n// trace modules that should never auto-type to multicategory\n// should be declared with 'noMultiCategory'\nfunction multiCategory(a) {\n    return isArrayOrTypedArray(a[0]) && isArrayOrTypedArray(a[1]);\n}\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\n\nvar handleArrayContainerDefaults = require('../array_container_defaults');\n\nvar layoutAttributes = require('./layout_attributes');\nvar handleTickValueDefaults = require('./tick_value_defaults');\nvar handleTickMarkDefaults = require('./tick_mark_defaults');\nvar handleTickLabelDefaults = require('./tick_label_defaults');\nvar handleCategoryOrderDefaults = require('./category_order_defaults');\nvar handleLineGridDefaults = require('./line_grid_defaults');\nvar setConvert = require('./set_convert');\n\nvar DAY_OF_WEEK = require('./constants').WEEKDAY_PATTERN;\nvar HOUR = require('./constants').HOUR_PATTERN;\n\n/**\n * options: object containing:\n *\n *  letter: 'x' or 'y'\n *  title: name of the axis (ie 'Colorbar') to go in default title\n *  font: the default font to inherit\n *  outerTicks: boolean, should ticks default to outside?\n *  showGrid: boolean, should gridlines be shown by default?\n *  noHover: boolean, this axis doesn't support hover effects?\n *  noTickson: boolean, this axis doesn't support 'tickson'\n *  data: the plot data, used to manage categories\n *  bgColor: the plot background color, to calculate default gridline colors\n *  calendar:\n *  splomStash:\n *  visibleDflt: boolean\n *  reverseDflt: boolean\n *  automargin: boolean\n */\nmodule.exports = function handleAxisDefaults(containerIn, containerOut, coerce, options, layoutOut) {\n    var letter = options.letter;\n    var font = options.font || {};\n    var splomStash = options.splomStash || {};\n\n    var visible = coerce('visible', !options.visibleDflt);\n\n    var axTemplate = containerOut._template || {};\n    var axType = containerOut.type || axTemplate.type || '-';\n\n    var ticklabelmode;\n    if(axType === 'date') {\n        var handleCalendarDefaults = Registry.getComponentMethod('calendars', 'handleDefaults');\n        handleCalendarDefaults(containerIn, containerOut, 'calendar', options.calendar);\n\n        if(!options.noTicklabelmode) {\n            ticklabelmode = coerce('ticklabelmode');\n        }\n    }\n\n    var ticklabelposition = '';\n    if(!options.noTicklabelposition || axType === 'multicategory') {\n        ticklabelposition = Lib.coerce(containerIn, containerOut, {\n            ticklabelposition: {\n                valType: 'enumerated',\n                dflt: 'outside',\n                values: ticklabelmode === 'period' ? ['outside', 'inside'] :\n                letter === 'x' ? [\n                    'outside', 'inside',\n                    'outside left', 'inside left',\n                    'outside right', 'inside right'\n                ] : [\n                    'outside', 'inside',\n                    'outside top', 'inside top',\n                    'outside bottom', 'inside bottom'\n                ]\n            }\n        }, 'ticklabelposition');\n    }\n\n    if(!options.noTicklabeloverflow) {\n        coerce('ticklabeloverflow',\n            ticklabelposition.indexOf('inside') !== -1 ?\n                'hide past domain' :\n            axType === 'category' ||\n            axType === 'multicategory' ?\n                'allow' :\n                'hide past div'\n        );\n    }\n\n    setConvert(containerOut, layoutOut);\n\n    var autorangeDflt = !containerOut.isValidRange(containerIn.range);\n    if(autorangeDflt && options.reverseDflt) autorangeDflt = 'reversed';\n    var autoRange = coerce('autorange', autorangeDflt);\n    if(autoRange && (axType === 'linear' || axType === '-')) coerce('rangemode');\n\n    coerce('range');\n    containerOut.cleanRange();\n\n    handleCategoryOrderDefaults(containerIn, containerOut, coerce, options);\n\n    if(axType !== 'category' && !options.noHover) coerce('hoverformat');\n\n    var dfltColor = coerce('color');\n    // if axis.color was provided, use it for fonts too; otherwise,\n    // inherit from global font color in case that was provided.\n    // Compare to dflt rather than to containerIn, so we can provide color via\n    // template too.\n    var dfltFontColor = (dfltColor !== layoutAttributes.color.dflt) ? dfltColor : font.color;\n    // try to get default title from splom trace, fallback to graph-wide value\n    var dfltTitle = splomStash.label || layoutOut._dfltTitle[letter];\n\n    handleTickLabelDefaults(containerIn, containerOut, coerce, axType, options, {pass: 1});\n    if(!visible) return containerOut;\n\n    coerce('title.text', dfltTitle);\n    Lib.coerceFont(coerce, 'title.font', {\n        family: font.family,\n        size: Lib.bigFont(font.size),\n        color: dfltFontColor\n    });\n\n    handleTickValueDefaults(containerIn, containerOut, coerce, axType);\n    handleTickLabelDefaults(containerIn, containerOut, coerce, axType, options, {pass: 2});\n    handleTickMarkDefaults(containerIn, containerOut, coerce, options);\n    handleLineGridDefaults(containerIn, containerOut, coerce, {\n        dfltColor: dfltColor,\n        bgColor: options.bgColor,\n        showGrid: options.showGrid,\n        attributes: layoutAttributes\n    });\n\n    if(containerOut.showline || containerOut.ticks) coerce('mirror');\n\n    if(options.automargin) coerce('automargin');\n\n    var isMultiCategory = axType === 'multicategory';\n\n    if(!options.noTickson &&\n        (axType === 'category' || isMultiCategory) &&\n        (containerOut.ticks || containerOut.showgrid)\n    ) {\n        var ticksonDflt;\n        if(isMultiCategory) ticksonDflt = 'boundaries';\n        var tickson = coerce('tickson', ticksonDflt);\n        if(tickson === 'boundaries') {\n            delete containerOut.ticklabelposition;\n        }\n    }\n\n    if(isMultiCategory) {\n        var showDividers = coerce('showdividers');\n        if(showDividers) {\n            coerce('dividercolor');\n            coerce('dividerwidth');\n        }\n    }\n\n    if(axType === 'date') {\n        handleArrayContainerDefaults(containerIn, containerOut, {\n            name: 'rangebreaks',\n            inclusionAttr: 'enabled',\n            handleItemDefaults: rangebreaksDefaults\n        });\n\n        if(!containerOut.rangebreaks.length) {\n            delete containerOut.rangebreaks;\n        } else {\n            for(var k = 0; k < containerOut.rangebreaks.length; k++) {\n                if(containerOut.rangebreaks[k].pattern === DAY_OF_WEEK) {\n                    containerOut._hasDayOfWeekBreaks = true;\n                    break;\n                }\n            }\n\n            setConvert(containerOut, layoutOut);\n\n            if(layoutOut._has('scattergl') || layoutOut._has('splom')) {\n                for(var i = 0; i < options.data.length; i++) {\n                    var trace = options.data[i];\n                    if(trace.type === 'scattergl' || trace.type === 'splom') {\n                        trace.visible = false;\n                        Lib.warn(trace.type +\n                            ' traces do not work on axes with rangebreaks.' +\n                            ' Setting trace ' + trace.index + ' to `visible: false`.');\n                    }\n                }\n            }\n        }\n    }\n\n    return containerOut;\n};\n\nfunction rangebreaksDefaults(itemIn, itemOut, containerOut) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(itemIn, itemOut, layoutAttributes.rangebreaks, attr, dflt);\n    }\n\n    var enabled = coerce('enabled');\n\n    if(enabled) {\n        var bnds = coerce('bounds');\n        if(bnds && bnds.length >= 2) {\n            var dfltPattern = '';\n            var i, q;\n            if(bnds.length === 2) {\n                for(i = 0; i < 2; i++) {\n                    q = indexOfDay(bnds[i]);\n                    if(q) {\n                        dfltPattern = DAY_OF_WEEK;\n                        break;\n                    }\n                }\n            }\n            var pattern = coerce('pattern', dfltPattern);\n            if(pattern === DAY_OF_WEEK) {\n                for(i = 0; i < 2; i++) {\n                    q = indexOfDay(bnds[i]);\n                    if(q) {\n                        // convert to integers i.e 'Sunday' --> 0\n                        itemOut.bounds[i] = bnds[i] = q - 1;\n                    }\n                }\n            }\n            if(pattern) {\n                // ensure types and ranges\n                for(i = 0; i < 2; i++) {\n                    q = bnds[i];\n                    switch(pattern) {\n                        case DAY_OF_WEEK :\n                            if(!isNumeric(q)) {\n                                itemOut.enabled = false;\n                                return;\n                            }\n                            q = +q;\n\n                            if(\n                                q !== Math.floor(q) || // don't accept fractional days for mow\n                                q < 0 || q >= 7\n                            ) {\n                                itemOut.enabled = false;\n                                return;\n                            }\n                            // use number\n                            itemOut.bounds[i] = bnds[i] = q;\n                            break;\n\n                        case HOUR :\n                            if(!isNumeric(q)) {\n                                itemOut.enabled = false;\n                                return;\n                            }\n                            q = +q;\n\n                            if(q < 0 || q > 24) { // accept 24\n                                itemOut.enabled = false;\n                                return;\n                            }\n                            // use number\n                            itemOut.bounds[i] = bnds[i] = q;\n                            break;\n                    }\n                }\n            }\n\n            if(containerOut.autorange === false) {\n                var rng = containerOut.range;\n\n                // if bounds are bigger than the (set) range, disable break\n                if(rng[0] < rng[1]) {\n                    if(bnds[0] < rng[0] && bnds[1] > rng[1]) {\n                        itemOut.enabled = false;\n                        return;\n                    }\n                } else if(bnds[0] > rng[0] && bnds[1] < rng[1]) {\n                    itemOut.enabled = false;\n                    return;\n                }\n            }\n        } else {\n            var values = coerce('values');\n\n            if(values && values.length) {\n                coerce('dvalue');\n            } else {\n                itemOut.enabled = false;\n                return;\n            }\n        }\n    }\n}\n\n// these numbers are one more than what bounds would be mapped to\nvar dayStrToNum = {\n    sun: 1,\n    mon: 2,\n    tue: 3,\n    wed: 4,\n    thu: 5,\n    fri: 6,\n    sat: 7\n};\n\nfunction indexOfDay(v) {\n    if(typeof v !== 'string') return;\n    return dayStrToNum[\n        v.substr(0, 3).toLowerCase()\n    ];\n}\n","'use strict';\n\nvar docs = require('../../constants/docs');\nvar FORMAT_LINK = docs.FORMAT_LINK;\nvar DATE_FORMAT_LINK = docs.DATE_FORMAT_LINK;\n\nfunction axisHoverFormat(x, noDates) {\n    return {\n        valType: 'string',\n        dflt: '',\n        editType: 'none',\n        description: (\n            noDates ? descriptionOnlyNumbers : descriptionWithDates\n        )('hover text', x) + [\n            'By default the values are formatted using ' + (\n                noDates ?\n                    'generic number format' :\n                    ('`' + x + 'axis.hoverformat`')\n            ) + '.',\n        ].join(' ')\n    };\n}\n\nfunction descriptionOnlyNumbers(label, x) {\n    return [\n        'Sets the ' + label + ' formatting rule' + (x ? 'for `' + x + '` ' : ''),\n        'using d3 formatting mini-languages',\n        'which are very similar to those in Python. For numbers, see: ' + FORMAT_LINK + '.'\n    ].join(' ');\n}\n\nfunction descriptionWithDates(label, x) {\n    return descriptionOnlyNumbers(label, x) + [\n        ' And for dates see: ' + DATE_FORMAT_LINK + '.',\n        'We add two items to d3\\'s date formatter:',\n        '*%h* for half of the year as a decimal number as well as',\n        '*%{n}f* for fractional seconds',\n        'with n digits. For example, *2016-10-13 09:15:23.456* with tickformat',\n        '*%H~%M~%S.%2f* would display *09~15~23.46*'\n    ].join(' ');\n}\n\nmodule.exports = {\n    axisHoverFormat: axisHoverFormat,\n    descriptionOnlyNumbers: descriptionOnlyNumbers,\n    descriptionWithDates: descriptionWithDates\n};\n","'use strict';\n\nvar Registry = require('../../registry');\n\nvar constants = require('./constants');\n\n\n// convert between axis names (xaxis, xaxis2, etc, elements of gd.layout)\n// and axis id's (x, x2, etc). Would probably have ditched 'xaxis'\n// completely in favor of just 'x' if it weren't ingrained in the API etc.\nexports.id2name = function id2name(id) {\n    if(typeof id !== 'string' || !id.match(constants.AX_ID_PATTERN)) return;\n    var axNum = id.split(' ')[0].substr(1);\n    if(axNum === '1') axNum = '';\n    return id.charAt(0) + 'axis' + axNum;\n};\n\nexports.name2id = function name2id(name) {\n    if(!name.match(constants.AX_NAME_PATTERN)) return;\n    var axNum = name.substr(5);\n    if(axNum === '1') axNum = '';\n    return name.charAt(0) + axNum;\n};\n\n/*\n * Cleans up the number of an axis, e.g., 'x002'->'x2', 'x0'->'x', 'x1' -> 'x',\n * etc.\n * If domainId is true, then id could be a domain reference and if it is, the\n * ' domain' part is kept at the end of the axis ID string.\n */\nexports.cleanId = function cleanId(id, axLetter, domainId) {\n    var domainTest = /( domain)$/.test(id);\n    if(typeof id !== 'string' || !id.match(constants.AX_ID_PATTERN)) return;\n    if(axLetter && id.charAt(0) !== axLetter) return;\n    if(domainTest && (!domainId)) return;\n    var axNum = id.split(' ')[0].substr(1).replace(/^0+/, '');\n    if(axNum === '1') axNum = '';\n    return id.charAt(0) + axNum + (domainTest && domainId ? ' domain' : '');\n};\n\n// get all axis objects, as restricted in listNames\nexports.list = function(gd, axLetter, only2d) {\n    var fullLayout = gd._fullLayout;\n    if(!fullLayout) return [];\n\n    var idList = exports.listIds(gd, axLetter);\n    var out = new Array(idList.length);\n    var i;\n\n    for(i = 0; i < idList.length; i++) {\n        var idi = idList[i];\n        out[i] = fullLayout[idi.charAt(0) + 'axis' + idi.substr(1)];\n    }\n\n    if(!only2d) {\n        var sceneIds3D = fullLayout._subplots.gl3d || [];\n\n        for(i = 0; i < sceneIds3D.length; i++) {\n            var scene = fullLayout[sceneIds3D[i]];\n\n            if(axLetter) out.push(scene[axLetter + 'axis']);\n            else out.push(scene.xaxis, scene.yaxis, scene.zaxis);\n        }\n    }\n\n    return out;\n};\n\n// get all axis ids, optionally restricted by letter\n// this only makes sense for 2d axes\nexports.listIds = function(gd, axLetter) {\n    var fullLayout = gd._fullLayout;\n    if(!fullLayout) return [];\n\n    var subplotLists = fullLayout._subplots;\n    if(axLetter) return subplotLists[axLetter + 'axis'];\n    return subplotLists.xaxis.concat(subplotLists.yaxis);\n};\n\n// get an axis object from its id 'x','x2' etc\n// optionally, id can be a subplot (ie 'x2y3') and type gets x or y from it\nexports.getFromId = function(gd, id, type) {\n    var fullLayout = gd._fullLayout;\n    // remove \"domain\" suffix\n    id = ((id === undefined) || (typeof(id) !== 'string')) ? id : id.replace(' domain', '');\n\n    if(type === 'x') id = id.replace(/y[0-9]*/, '');\n    else if(type === 'y') id = id.replace(/x[0-9]*/, '');\n\n    return fullLayout[exports.id2name(id)];\n};\n\n// get an axis object of specified type from the containing trace\nexports.getFromTrace = function(gd, fullTrace, type) {\n    var fullLayout = gd._fullLayout;\n    var ax = null;\n\n    if(Registry.traceIs(fullTrace, 'gl3d')) {\n        var scene = fullTrace.scene;\n        if(scene.substr(0, 5) === 'scene') {\n            ax = fullLayout[scene][type + 'axis'];\n        }\n    } else {\n        ax = exports.getFromId(gd, fullTrace[type + 'axis'] || type);\n    }\n\n    return ax;\n};\n\n// sort x, x2, x10, y, y2, y10...\nexports.idSort = function(id1, id2) {\n    var letter1 = id1.charAt(0);\n    var letter2 = id2.charAt(0);\n    if(letter1 !== letter2) return letter1 > letter2 ? 1 : -1;\n    return +(id1.substr(1) || 1) - +(id2.substr(1) || 1);\n};\n\n/*\n * An axis reference (e.g., the contents at the 'xref' key of an object) might\n * have extra information appended. Extract the axis ID only.\n *\n * ar: the axis reference string\n *\n */\nexports.ref2id = function(ar) {\n    // This assumes ar has been coerced via coerceRef, and uses the shortcut of\n    // checking if the first letter matches [xyz] to determine if it should\n    // return the axis ID. Otherwise it returns false.\n    return (/^[xyz]/.test(ar)) ? ar.split(' ')[0] : false;\n};\n\nfunction isFound(axId, list) {\n    if(list && list.length) {\n        for(var i = 0; i < list.length; i++) {\n            if(list[i][axId]) return true;\n        }\n    }\n    return false;\n}\n\nexports.isLinked = function(fullLayout, axId) {\n    return (\n        isFound(axId, fullLayout._axisMatchGroups) ||\n        isFound(axId, fullLayout._axisConstraintGroups)\n    );\n};\n","'use strict';\n\nfunction findCategories(ax, opts) {\n    var dataAttr = opts.dataAttr || ax._id.charAt(0);\n    var lookup = {};\n    var axData;\n    var i, j;\n\n    if(opts.axData) {\n        // non-x/y case\n        axData = opts.axData;\n    } else {\n        // x/y case\n        axData = [];\n        for(i = 0; i < opts.data.length; i++) {\n            var trace = opts.data[i];\n            if(trace[dataAttr + 'axis'] === ax._id) {\n                axData.push(trace);\n            }\n        }\n    }\n\n    for(i = 0; i < axData.length; i++) {\n        var vals = axData[i][dataAttr];\n        for(j = 0; j < vals.length; j++) {\n            var v = vals[j];\n            if(v !== null && v !== undefined) {\n                lookup[v] = 1;\n            }\n        }\n    }\n\n    return Object.keys(lookup);\n}\n\n/**\n * Fills in category* default and initial categories.\n *\n * @param {object} containerIn : input axis object\n * @param {object} containerOut : full axis object\n * @param {function} coerce : Lib.coerce fn wrapper\n * @param {object} opts :\n *   - data {array} : (full) data trace\n * OR\n *   - axData {array} : (full) data associated with axis being coerced here\n *   - dataAttr {string} : attribute name corresponding to coordinate array\n */\nmodule.exports = function handleCategoryOrderDefaults(containerIn, containerOut, coerce, opts) {\n    if(containerOut.type !== 'category') return;\n\n    var arrayIn = containerIn.categoryarray;\n    var isValidArray = (Array.isArray(arrayIn) && arrayIn.length > 0);\n\n    // override default 'categoryorder' value when non-empty array is supplied\n    var orderDefault;\n    if(isValidArray) orderDefault = 'array';\n\n    var order = coerce('categoryorder', orderDefault);\n    var array;\n\n    // coerce 'categoryarray' only in array order case\n    if(order === 'array') {\n        array = coerce('categoryarray');\n    }\n\n    // cannot set 'categoryorder' to 'array' with an invalid 'categoryarray'\n    if(!isValidArray && order === 'array') {\n        order = containerOut.categoryorder = 'trace';\n    }\n\n    // set up things for makeCalcdata\n    if(order === 'trace') {\n        containerOut._initialCategories = [];\n    } else if(order === 'array') {\n        containerOut._initialCategories = array.slice();\n    } else {\n        array = findCategories(containerOut, opts).sort();\n        if(order === 'category ascending') {\n            containerOut._initialCategories = array;\n        } else if(order === 'category descending') {\n            containerOut._initialCategories = array.reverse();\n        }\n    }\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar Lib = require('../../lib');\nvar constants = require('../../constants/numerical');\nvar ONEDAY = constants.ONEDAY;\nvar ONEWEEK = constants.ONEWEEK;\n\n/**\n * Return a validated dtick value for this axis\n *\n * @param {any} dtick: the candidate dtick. valid values are numbers and strings,\n *     and further constrained depending on the axis type.\n * @param {string} axType: the axis type\n */\nexports.dtick = function(dtick, axType) {\n    var isLog = axType === 'log';\n    var isDate = axType === 'date';\n    var isCat = axType === 'category';\n    var dtickDflt = isDate ? ONEDAY : 1;\n\n    if(!dtick) return dtickDflt;\n\n    if(isNumeric(dtick)) {\n        dtick = Number(dtick);\n        if(dtick <= 0) return dtickDflt;\n        if(isCat) {\n            // category dtick must be positive integers\n            return Math.max(1, Math.round(dtick));\n        }\n        if(isDate) {\n            // date dtick must be at least 0.1ms (our current precision)\n            return Math.max(0.1, dtick);\n        }\n        return dtick;\n    }\n\n    if(typeof dtick !== 'string' || !(isDate || isLog)) {\n        return dtickDflt;\n    }\n\n    var prefix = dtick.charAt(0);\n    var dtickNum = dtick.substr(1);\n    dtickNum = isNumeric(dtickNum) ? Number(dtickNum) : 0;\n\n    if((dtickNum <= 0) || !(\n            // \"M<n>\" gives ticks every (integer) n months\n            (isDate && prefix === 'M' && dtickNum === Math.round(dtickNum)) ||\n            // \"L<f>\" gives ticks linearly spaced in data (not in position) every (float) f\n            (isLog && prefix === 'L') ||\n            // \"D1\" gives powers of 10 with all small digits between, \"D2\" gives only 2 and 5\n            (isLog && prefix === 'D' && (dtickNum === 1 || dtickNum === 2))\n        )) {\n        return dtickDflt;\n    }\n\n    return dtick;\n};\n\n/**\n * Return a validated tick0 for this axis\n *\n * @param {any} tick0: the candidate tick0. Valid values are numbers and strings,\n *     further constrained depending on the axis type\n * @param {string} axType: the axis type\n * @param {string} calendar: for date axes, the calendar to validate/convert with\n * @param {any} dtick: an already valid dtick. Only used for D1 and D2 log dticks,\n *     which do not support tick0 at all.\n */\nexports.tick0 = function(tick0, axType, calendar, dtick) {\n    if(axType === 'date') {\n        return Lib.cleanDate(tick0,\n            Lib.dateTick0(calendar, (dtick % ONEWEEK === 0) ? 1 : 0)\n        );\n    }\n    if(dtick === 'D1' || dtick === 'D2') {\n        // D1 and D2 modes ignore tick0 entirely\n        return undefined;\n    }\n    // Aside from date axes, tick0 must be numeric\n    return isNumeric(tick0) ? Number(tick0) : 0;\n};\n","'use strict';\n\nvar counterRegex = require('../../lib/regex').counter;\n\nmodule.exports = {\n    idRegex: {\n        x: counterRegex('x', '( domain)?'),\n        y: counterRegex('y', '( domain)?')\n    },\n\n    attrRegex: counterRegex('[xy]axis'),\n\n    // axis match regular expression\n    xAxisMatch: counterRegex('xaxis'),\n    yAxisMatch: counterRegex('yaxis'),\n\n    // pattern matching axis ids and names\n    // note that this is more permissive than counterRegex, as\n    // id2name, name2id, and cleanId accept \"x1\" etc\n    AX_ID_PATTERN: /^[xyz][0-9]*( domain)?$/,\n    AX_NAME_PATTERN: /^[xyz]axis[0-9]*$/,\n\n    // and for 2D subplots\n    SUBPLOT_PATTERN: /^x([0-9]*)y([0-9]*)$/,\n\n    HOUR_PATTERN: 'hour',\n    WEEKDAY_PATTERN: 'day of week',\n\n    // pixels to move mouse before you stop clamping to starting point\n    MINDRAG: 8,\n\n    // smallest dimension allowed for a select box\n    MINSELECT: 12,\n\n    // smallest dimension allowed for a zoombox\n    MINZOOM: 20,\n\n    // width of axis drag regions\n    DRAGGERSIZE: 20,\n\n    // max pixels off straight before a lasso select line counts as bent\n    BENDPX: 1.5,\n\n    // delay before a redraw (relayout) after smooth panning and zooming\n    REDRAWDELAY: 50,\n\n    // throttling limit (ms) for selectPoints calls\n    SELECTDELAY: 100,\n\n    // cache ID suffix for throttle\n    SELECTID: '-select',\n\n    // last resort axis ranges for x and y axes if we have no data\n    DFLTRANGEX: [-1, 6],\n    DFLTRANGEY: [-1, 4],\n\n    // Layers to keep trace types in the right order\n    // N.B. each  'unique' plot method must have its own layer\n    traceLayerClasses: [\n        'imagelayer',\n        'heatmaplayer',\n        'contourcarpetlayer', 'contourlayer',\n        'funnellayer', 'waterfalllayer', 'barlayer',\n        'carpetlayer',\n        'violinlayer',\n        'boxlayer',\n        'ohlclayer',\n        'scattercarpetlayer', 'scatterlayer'\n    ],\n\n    clipOnAxisFalseQuery: [\n        '.scatterlayer',\n        '.barlayer',\n        '.funnellayer',\n        '.waterfalllayer'\n    ],\n\n    layerValue2layerClass: {\n        'above traces': 'above',\n        'below traces': 'below'\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\nvar autorange = require('./autorange');\nvar id2name = require('./axis_ids').id2name;\nvar layoutAttributes = require('./layout_attributes');\nvar scaleZoom = require('./scale_zoom');\nvar setConvert = require('./set_convert');\n\nvar ALMOST_EQUAL = require('../../constants/numerical').ALMOST_EQUAL;\nvar FROM_BL = require('../../constants/alignment').FROM_BL;\n\nexports.handleDefaults = function(layoutIn, layoutOut, opts) {\n    var axIds = opts.axIds;\n    var axHasImage = opts.axHasImage;\n\n    // sets of axes linked by `scaleanchor` OR `matches` along with the\n    // scaleratios compounded together, populated in handleConstraintDefaults\n    var constraintGroups = layoutOut._axisConstraintGroups = [];\n    // similar to _axisConstraintGroups, but only matching axes\n    var matchGroups = layoutOut._axisMatchGroups = [];\n\n    var i, group, axId, axName, axIn, axOut, attr, val;\n\n    for(i = 0; i < axIds.length; i++) {\n        axName = id2name(axIds[i]);\n        axIn = layoutIn[axName];\n        axOut = layoutOut[axName];\n\n        handleOneAxDefaults(axIn, axOut, {\n            axIds: axIds,\n            layoutOut: layoutOut,\n            hasImage: axHasImage[axName]\n        });\n    }\n\n    // save matchGroup on each matching axis\n    function stash(groups, stashAttr) {\n        for(i = 0; i < groups.length; i++) {\n            group = groups[i];\n            for(axId in group) {\n                layoutOut[id2name(axId)][stashAttr] = group;\n            }\n        }\n    }\n    stash(matchGroups, '_matchGroup');\n\n    // If any axis in a constraint group is fixedrange, they all get fixed\n    // This covers matches axes, as they're now in the constraintgroup too\n    // and have not yet been removed (if the group is *only* matching)\n    for(i = 0; i < constraintGroups.length; i++) {\n        group = constraintGroups[i];\n        for(axId in group) {\n            axOut = layoutOut[id2name(axId)];\n            if(axOut.fixedrange) {\n                for(var axId2 in group) {\n                    var axName2 = id2name(axId2);\n                    if((layoutIn[axName2] || {}).fixedrange === false) {\n                        Lib.warn(\n                            'fixedrange was specified as false for axis ' +\n                            axName2 + ' but was overridden because another ' +\n                            'axis in its constraint group has fixedrange true'\n                        );\n                    }\n                    layoutOut[axName2].fixedrange = true;\n                }\n                break;\n            }\n        }\n    }\n\n    // remove constraint groups that simply duplicate match groups\n    i = 0;\n    while(i < constraintGroups.length) {\n        group = constraintGroups[i];\n        for(axId in group) {\n            axOut = layoutOut[id2name(axId)];\n            if(axOut._matchGroup && Object.keys(axOut._matchGroup).length === Object.keys(group).length) {\n                constraintGroups.splice(i, 1);\n                i--;\n            }\n            break;\n        }\n        i++;\n    }\n\n    // save constraintGroup on each constrained axis\n    stash(constraintGroups, '_constraintGroup');\n\n    // make sure `matching` axes share values of necessary attributes\n    // Precedence (base axis is the one that doesn't list a `matches`, ie others\n    // all point to it):\n    // (1) explicitly defined value in the base axis\n    // (2) explicitly defined in another axis (arbitrary order)\n    // (3) default in the base axis\n    var matchAttrs = [\n        'constrain',\n        'range',\n        'autorange',\n        'rangemode',\n        'rangebreaks',\n        'categoryorder',\n        'categoryarray'\n    ];\n    var hasRange = false;\n    var hasDayOfWeekBreaks = false;\n\n    function setAttrVal() {\n        val = axOut[attr];\n        if(attr === 'rangebreaks') {\n            hasDayOfWeekBreaks = axOut._hasDayOfWeekBreaks;\n        }\n    }\n\n    for(i = 0; i < matchGroups.length; i++) {\n        group = matchGroups[i];\n\n        // find 'matching' range attrs\n        for(var j = 0; j < matchAttrs.length; j++) {\n            attr = matchAttrs[j];\n            val = null;\n            var baseAx;\n            for(axId in group) {\n                axName = id2name(axId);\n                axIn = layoutIn[axName];\n                axOut = layoutOut[axName];\n                if(!(attr in axOut)) {\n                    continue;\n                }\n                if(!axOut.matches) {\n                    baseAx = axOut;\n                    // top priority: explicit value in base axis\n                    if(attr in axIn) {\n                        setAttrVal();\n                        break;\n                    }\n                }\n                if(val === null && attr in axIn) {\n                    // second priority: first explicit value in another axis\n                    setAttrVal();\n                }\n            }\n\n            // special logic for coupling of range and autorange\n            // if nobody explicitly specifies autorange, but someone does\n            // explicitly specify range, autorange must be disabled.\n            if(attr === 'range' && val) {\n                hasRange = true;\n            }\n            if(attr === 'autorange' && val === null && hasRange) {\n                val = false;\n            }\n\n            if(val === null && attr in baseAx) {\n                // fallback: default value in base axis\n                val = baseAx[attr];\n            }\n            // but we still might not have a value, which is fine.\n            if(val !== null) {\n                for(axId in group) {\n                    axOut = layoutOut[id2name(axId)];\n                    axOut[attr] = attr === 'range' ? val.slice() : val;\n\n                    if(attr === 'rangebreaks') {\n                        axOut._hasDayOfWeekBreaks = hasDayOfWeekBreaks;\n                        setConvert(axOut, layoutOut);\n                    }\n                }\n            }\n        }\n    }\n};\n\nfunction handleOneAxDefaults(axIn, axOut, opts) {\n    var axIds = opts.axIds;\n    var layoutOut = opts.layoutOut;\n    var hasImage = opts.hasImage;\n    var constraintGroups = layoutOut._axisConstraintGroups;\n    var matchGroups = layoutOut._axisMatchGroups;\n    var axId = axOut._id;\n    var axLetter = axId.charAt(0);\n    var splomStash = ((layoutOut._splomAxes || {})[axLetter] || {})[axId] || {};\n    var thisID = axOut._id;\n    var isX = thisID.charAt(0) === 'x';\n\n    // Clear _matchGroup & _constraintGroup so relinkPrivateKeys doesn't keep\n    // an old one around. If this axis is in a group we'll set this again later\n    axOut._matchGroup = null;\n    axOut._constraintGroup = null;\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(axIn, axOut, layoutAttributes, attr, dflt);\n    }\n\n    // coerce the constraint mechanics even if this axis has no scaleanchor\n    // because it may be the anchor of another axis.\n    coerce('constrain', hasImage ? 'domain' : 'range');\n    Lib.coerce(axIn, axOut, {\n        constraintoward: {\n            valType: 'enumerated',\n            values: isX ? ['left', 'center', 'right'] : ['bottom', 'middle', 'top'],\n            dflt: isX ? 'center' : 'middle'\n        }\n    }, 'constraintoward');\n\n    // If this axis is already part of a constraint group, we can't\n    // scaleanchor any other axis in that group, or we'd make a loop.\n    // Filter axIds to enforce this, also matching axis types.\n    var thisType = axOut.type;\n    var i, idi;\n\n    var linkableAxes = [];\n    for(i = 0; i < axIds.length; i++) {\n        idi = axIds[i];\n        if(idi === thisID) continue;\n\n        var axi = layoutOut[id2name(idi)];\n        if(axi.type === thisType) {\n            linkableAxes.push(idi);\n        }\n    }\n\n    var thisGroup = getConstraintGroup(constraintGroups, thisID);\n    if(thisGroup) {\n        var linkableAxesNoLoops = [];\n        for(i = 0; i < linkableAxes.length; i++) {\n            idi = linkableAxes[i];\n            if(!thisGroup[idi]) linkableAxesNoLoops.push(idi);\n        }\n        linkableAxes = linkableAxesNoLoops;\n    }\n\n    var canLink = linkableAxes.length;\n\n    var matches, scaleanchor;\n\n    if(canLink && (axIn.matches || splomStash.matches)) {\n        matches = Lib.coerce(axIn, axOut, {\n            matches: {\n                valType: 'enumerated',\n                values: linkableAxes,\n                dflt: linkableAxes.indexOf(splomStash.matches) !== -1 ? splomStash.matches : undefined\n            }\n        }, 'matches');\n    }\n\n    // 'matches' wins over 'scaleanchor' - each axis can only specify one\n    // constraint, but you can chain matches and scaleanchor constraints by\n    // specifying them in separate axes.\n    var scaleanchorDflt = hasImage && !isX ? axOut.anchor : undefined;\n    if(canLink && !matches && (axIn.scaleanchor || scaleanchorDflt)) {\n        scaleanchor = Lib.coerce(axIn, axOut, {\n            scaleanchor: {\n                valType: 'enumerated',\n                values: linkableAxes\n            }\n        }, 'scaleanchor', scaleanchorDflt);\n    }\n\n    if(matches) {\n        axOut._matchGroup = updateConstraintGroups(matchGroups, thisID, matches, 1);\n\n        // Also include match constraints in the scale groups\n        var matchedAx = layoutOut[id2name(matches)];\n        var matchRatio = extent(layoutOut, axOut) / extent(layoutOut, matchedAx);\n        if(isX !== (matches.charAt(0) === 'x')) {\n            // We don't yet know the actual scale ratio of x/y matches constraints,\n            // due to possible automargins, so just leave a placeholder for this:\n            // 'x' means \"x size over y size\", 'y' means the inverse.\n            // in principle in the constraint group you could get multiple of these.\n            matchRatio = (isX ? 'x' : 'y') + matchRatio;\n        }\n        updateConstraintGroups(constraintGroups, thisID, matches, matchRatio);\n    } else if(axIn.matches && axIds.indexOf(axIn.matches) !== -1) {\n        Lib.warn('ignored ' + axOut._name + '.matches: \"' +\n            axIn.matches + '\" to avoid an infinite loop');\n    }\n\n    if(scaleanchor) {\n        var scaleratio = coerce('scaleratio');\n\n        // TODO: I suppose I could do attribute.min: Number.MIN_VALUE to avoid zero,\n        // but that seems hacky. Better way to say \"must be a positive number\"?\n        // Of course if you use several super-tiny values you could eventually\n        // force a product of these to zero and all hell would break loose...\n        // Likewise with super-huge values.\n        if(!scaleratio) scaleratio = axOut.scaleratio = 1;\n\n        updateConstraintGroups(constraintGroups, thisID, scaleanchor, scaleratio);\n    } else if(axIn.scaleanchor && axIds.indexOf(axIn.scaleanchor) !== -1) {\n        Lib.warn('ignored ' + axOut._name + '.scaleanchor: \"' +\n            axIn.scaleanchor + '\" to avoid either an infinite loop ' +\n            'and possibly inconsistent scaleratios, or because this axis ' +\n            'declares a *matches* constraint.');\n    }\n}\n\nfunction extent(layoutOut, ax) {\n    var domain = ax.domain;\n    if(!domain) {\n        // at this point overlaying axes haven't yet inherited their main domains\n        // TODO: constrain: domain with overlaying axes is likely a bug.\n        domain = layoutOut[id2name(ax.overlaying)].domain;\n    }\n    return domain[1] - domain[0];\n}\n\nfunction getConstraintGroup(groups, thisID) {\n    for(var i = 0; i < groups.length; i++) {\n        if(groups[i][thisID]) {\n            return groups[i];\n        }\n    }\n    return null;\n}\n\n/*\n * Add this axis to the axis constraint groups, which is the collection\n * of axes that are all constrained together on scale (or matching).\n *\n * constraintGroups: a list of objects. each object is\n * {axis_id: scale_within_group}, where scale_within_group is\n * only important relative to the rest of the group, and defines\n * the relative scales between all axes in the group\n *\n * thisGroup: the group the current axis is already in\n * thisID: the id if the current axis\n * thatID: the id of the axis to scale it with\n * scaleratio: the ratio of this axis to the thatID axis\n */\nfunction updateConstraintGroups(constraintGroups, thisID, thatID, scaleratio) {\n    var i, j, groupi, keyj, thisGroupIndex;\n\n    var thisGroup = getConstraintGroup(constraintGroups, thisID);\n\n    if(thisGroup === null) {\n        thisGroup = {};\n        thisGroup[thisID] = 1;\n        thisGroupIndex = constraintGroups.length;\n        constraintGroups.push(thisGroup);\n    } else {\n        thisGroupIndex = constraintGroups.indexOf(thisGroup);\n    }\n\n    var thisGroupKeys = Object.keys(thisGroup);\n\n    // we know that this axis isn't in any other groups, but we don't know\n    // about the thatID axis. If it is, we need to merge the groups.\n    for(i = 0; i < constraintGroups.length; i++) {\n        groupi = constraintGroups[i];\n        if(i !== thisGroupIndex && groupi[thatID]) {\n            var baseScale = groupi[thatID];\n            for(j = 0; j < thisGroupKeys.length; j++) {\n                keyj = thisGroupKeys[j];\n                groupi[keyj] = multiplyScales(baseScale, multiplyScales(scaleratio, thisGroup[keyj]));\n            }\n            constraintGroups.splice(thisGroupIndex, 1);\n            return;\n        }\n    }\n\n    // otherwise, we insert the new thatID axis as the base scale (1)\n    // in its group, and scale the rest of the group to it\n    if(scaleratio !== 1) {\n        for(j = 0; j < thisGroupKeys.length; j++) {\n            var key = thisGroupKeys[j];\n            thisGroup[key] = multiplyScales(scaleratio, thisGroup[key]);\n        }\n    }\n    thisGroup[thatID] = 1;\n}\n\n// scales may be numbers or 'x1.3', 'yy4.5' etc to multiply by as-yet-unknown\n// ratios between x and y plot sizes n times\nfunction multiplyScales(a, b) {\n    var aPrefix = '';\n    var bPrefix = '';\n    var aLen, bLen;\n\n    if(typeof a === 'string') {\n        aPrefix = a.match(/^[xy]*/)[0];\n        aLen = aPrefix.length;\n        a = +a.substr(aLen);\n    }\n\n    if(typeof b === 'string') {\n        bPrefix = b.match(/^[xy]*/)[0];\n        bLen = bPrefix.length;\n        b = +b.substr(bLen);\n    }\n\n    var c = a * b;\n\n    // just two numbers\n    if(!aLen && !bLen) {\n        return c;\n    }\n\n    // one or more prefixes of the same type\n    if(!aLen || !bLen || aPrefix.charAt(0) === bPrefix.charAt(0)) {\n        return aPrefix + bPrefix + (a * b);\n    }\n\n    // x and y cancel each other out exactly - back to a number\n    if(aLen === bLen) {\n        return c;\n    }\n\n    // partial cancelation of prefixes\n    return (aLen > bLen ? aPrefix.substr(bLen) : bPrefix.substr(aLen)) + c;\n}\n\nfunction finalRatios(group, fullLayout) {\n    var size = fullLayout._size;\n    var yRatio = size.h / size.w;\n    var out = {};\n    var keys = Object.keys(group);\n    for(var i = 0; i < keys.length; i++) {\n        var key = keys[i];\n        var val = group[key];\n\n        if(typeof val === 'string') {\n            var prefix = val.match(/^[xy]*/)[0];\n            var pLen = prefix.length;\n            val = +val.substr(pLen);\n            var mult = prefix.charAt(0) === 'y' ? yRatio : (1 / yRatio);\n            for(var j = 0; j < pLen; j++) {\n                val *= mult;\n            }\n        }\n\n        out[key] = val;\n    }\n    return out;\n}\n\nexports.enforce = function enforce(gd) {\n    var fullLayout = gd._fullLayout;\n    var constraintGroups = fullLayout._axisConstraintGroups || [];\n\n    var i, j, group, axisID, ax, normScale, mode, factor;\n\n    // matching constraints are handled in the autorange code when autoranged,\n    // or in the supplyDefaults code when explicitly ranged.\n    // now we just need to handle scaleanchor constraints\n    // matches constraints that chain with scaleanchor constraints are included\n    // here too, but because matches has already been satisfied,\n    // any changes here should preserve that.\n    for(i = 0; i < constraintGroups.length; i++) {\n        group = finalRatios(constraintGroups[i], fullLayout);\n        var axisIDs = Object.keys(group);\n\n        var minScale = Infinity;\n        var maxScale = 0;\n        // mostly matchScale will be the same as minScale\n        // ie we expand axis ranges to encompass *everything*\n        // that's currently in any of their ranges, but during\n        // autorange of a subset of axes we will ignore other\n        // axes for this purpose.\n        var matchScale = Infinity;\n        var normScales = {};\n        var axes = {};\n        var hasAnyDomainConstraint = false;\n\n        // find the (normalized) scale of each axis in the group\n        for(j = 0; j < axisIDs.length; j++) {\n            axisID = axisIDs[j];\n            axes[axisID] = ax = fullLayout[id2name(axisID)];\n\n            if(ax._inputDomain) ax.domain = ax._inputDomain.slice();\n            else ax._inputDomain = ax.domain.slice();\n\n            if(!ax._inputRange) ax._inputRange = ax.range.slice();\n\n            // set axis scale here so we can use _m rather than\n            // having to calculate it from length and range\n            ax.setScale();\n\n            // abs: inverted scales still satisfy the constraint\n            normScales[axisID] = normScale = Math.abs(ax._m) / group[axisID];\n            minScale = Math.min(minScale, normScale);\n            if(ax.constrain === 'domain' || !ax._constraintShrinkable) {\n                matchScale = Math.min(matchScale, normScale);\n            }\n\n            // this has served its purpose, so remove it\n            delete ax._constraintShrinkable;\n            maxScale = Math.max(maxScale, normScale);\n\n            if(ax.constrain === 'domain') hasAnyDomainConstraint = true;\n        }\n\n        // Do we have a constraint mismatch? Give a small buffer for rounding errors\n        if(minScale > ALMOST_EQUAL * maxScale && !hasAnyDomainConstraint) continue;\n\n        // now increase any ranges we need to until all normalized scales are equal\n        for(j = 0; j < axisIDs.length; j++) {\n            axisID = axisIDs[j];\n            normScale = normScales[axisID];\n            ax = axes[axisID];\n            mode = ax.constrain;\n\n            // even if the scale didn't change, if we're shrinking domain\n            // we need to recalculate in case `constraintoward` changed\n            if(normScale !== matchScale || mode === 'domain') {\n                factor = normScale / matchScale;\n\n                if(mode === 'range') {\n                    scaleZoom(ax, factor);\n                } else {\n                    // mode === 'domain'\n\n                    var inputDomain = ax._inputDomain;\n                    var domainShrunk = (ax.domain[1] - ax.domain[0]) /\n                        (inputDomain[1] - inputDomain[0]);\n                    var rangeShrunk = (ax.r2l(ax.range[1]) - ax.r2l(ax.range[0])) /\n                        (ax.r2l(ax._inputRange[1]) - ax.r2l(ax._inputRange[0]));\n\n                    factor /= domainShrunk;\n\n                    if(factor * rangeShrunk < 1) {\n                        // we've asked to magnify the axis more than we can just by\n                        // enlarging the domain - so we need to constrict range\n                        ax.domain = ax._input.domain = inputDomain.slice();\n                        scaleZoom(ax, factor);\n                        continue;\n                    }\n\n                    if(rangeShrunk < 1) {\n                        // the range has previously been constricted by ^^, but we've\n                        // switched to the domain-constricted regime, so reset range\n                        ax.range = ax._input.range = ax._inputRange.slice();\n                        factor *= rangeShrunk;\n                    }\n\n                    if(ax.autorange) {\n                        /*\n                         * range & factor may need to change because range was\n                         * calculated for the larger scaling, so some pixel\n                         * paddings may get cut off when we reduce the domain.\n                         *\n                         * This is easier than the regular autorange calculation\n                         * because we already know the scaling `m`, but we still\n                         * need to cut out impossible constraints (like\n                         * annotations with super-long arrows). That's what\n                         * outerMin/Max are for - if the expansion was going to\n                         * go beyond the original domain, it must be impossible\n                         */\n                        var rl0 = ax.r2l(ax.range[0]);\n                        var rl1 = ax.r2l(ax.range[1]);\n                        var rangeCenter = (rl0 + rl1) / 2;\n                        var rangeMin = rangeCenter;\n                        var rangeMax = rangeCenter;\n                        var halfRange = Math.abs(rl1 - rangeCenter);\n                        // extra tiny bit for rounding errors, in case we actually\n                        // *are* expanding to the full domain\n                        var outerMin = rangeCenter - halfRange * factor * 1.0001;\n                        var outerMax = rangeCenter + halfRange * factor * 1.0001;\n                        var getPadMin = autorange.makePadFn(fullLayout, ax, 0);\n                        var getPadMax = autorange.makePadFn(fullLayout, ax, 1);\n\n                        updateDomain(ax, factor);\n                        var m = Math.abs(ax._m);\n                        var extremes = autorange.concatExtremes(gd, ax);\n                        var minArray = extremes.min;\n                        var maxArray = extremes.max;\n                        var newVal;\n                        var k;\n\n                        for(k = 0; k < minArray.length; k++) {\n                            newVal = minArray[k].val - getPadMin(minArray[k]) / m;\n                            if(newVal > outerMin && newVal < rangeMin) {\n                                rangeMin = newVal;\n                            }\n                        }\n\n                        for(k = 0; k < maxArray.length; k++) {\n                            newVal = maxArray[k].val + getPadMax(maxArray[k]) / m;\n                            if(newVal < outerMax && newVal > rangeMax) {\n                                rangeMax = newVal;\n                            }\n                        }\n\n                        var domainExpand = (rangeMax - rangeMin) / (2 * halfRange);\n                        factor /= domainExpand;\n\n                        rangeMin = ax.l2r(rangeMin);\n                        rangeMax = ax.l2r(rangeMax);\n                        ax.range = ax._input.range = (rl0 < rl1) ?\n                            [rangeMin, rangeMax] : [rangeMax, rangeMin];\n                    }\n\n                    updateDomain(ax, factor);\n                }\n            }\n        }\n    }\n};\n\nexports.getAxisGroup = function getAxisGroup(fullLayout, axId) {\n    var matchGroups = fullLayout._axisMatchGroups;\n\n    for(var i = 0; i < matchGroups.length; i++) {\n        var group = matchGroups[i];\n        if(group[axId]) return 'g' + i;\n    }\n    return axId;\n};\n\n// For use before autoranging, check if this axis was previously constrained\n// by domain but no longer is\nexports.clean = function clean(gd, ax) {\n    if(ax._inputDomain) {\n        var isConstrained = false;\n        var axId = ax._id;\n        var constraintGroups = gd._fullLayout._axisConstraintGroups;\n        for(var j = 0; j < constraintGroups.length; j++) {\n            if(constraintGroups[j][axId]) {\n                isConstrained = true;\n                break;\n            }\n        }\n        if(!isConstrained || ax.constrain !== 'domain') {\n            ax._input.domain = ax.domain = ax._inputDomain;\n            delete ax._inputDomain;\n        }\n    }\n};\n\nfunction updateDomain(ax, factor) {\n    var inputDomain = ax._inputDomain;\n    var centerFraction = FROM_BL[ax.constraintoward];\n    var center = inputDomain[0] + (inputDomain[1] - inputDomain[0]) * centerFraction;\n\n    ax.domain = ax._input.domain = [\n        center + (inputDomain[0] - center) / factor,\n        center + (inputDomain[1] - center) / factor\n    ];\n    ax.setScale();\n}\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar tinycolor = require('tinycolor2');\nvar supportsPassive = require('has-passive-events');\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar Color = require('../../components/color');\nvar Drawing = require('../../components/drawing');\nvar Fx = require('../../components/fx');\nvar Axes = require('./axes');\nvar setCursor = require('../../lib/setcursor');\nvar dragElement = require('../../components/dragelement');\nvar helpers = require('../../components/dragelement/helpers');\nvar selectingOrDrawing = helpers.selectingOrDrawing;\nvar freeMode = helpers.freeMode;\n\nvar FROM_TL = require('../../constants/alignment').FROM_TL;\nvar clearGlCanvases = require('../../lib/clear_gl_canvases');\nvar redrawReglTraces = require('../../plot_api/subroutines').redrawReglTraces;\n\nvar Plots = require('../plots');\n\nvar getFromId = require('./axis_ids').getFromId;\nvar prepSelect = require('./select').prepSelect;\nvar clearSelect = require('./select').clearSelect;\nvar selectOnClick = require('./select').selectOnClick;\nvar scaleZoom = require('./scale_zoom');\n\nvar constants = require('./constants');\nvar MINDRAG = constants.MINDRAG;\nvar MINZOOM = constants.MINZOOM;\n\n// flag for showing \"doubleclick to zoom out\" only at the beginning\nvar SHOWZOOMOUTTIP = true;\n\n// dragBox: create an element to drag one or more axis ends\n// inputs:\n//      plotinfo - which subplot are we making dragboxes on?\n//      x,y,w,h - left, top, width, height of the box\n//      ns - how does this drag the vertical axis?\n//          'n' - top only\n//          's' - bottom only\n//          'ns' - top and bottom together, difference unchanged\n//      ew - same for horizontal axis\nfunction makeDragBox(gd, plotinfo, x, y, w, h, ns, ew) {\n    // mouseDown stores ms of first mousedown event in the last\n    // `gd._context.doubleClickDelay` ms on the drag bars\n    // numClicks stores how many mousedowns have been seen\n    // within `gd._context.doubleClickDelay` so we can check for click or doubleclick events\n    // dragged stores whether a drag has occurred, so we don't have to\n    // redraw unnecessarily, ie if no move bigger than MINDRAG or MINZOOM px\n    var zoomlayer = gd._fullLayout._zoomlayer;\n    var isMainDrag = (ns + ew === 'nsew');\n    var singleEnd = (ns + ew).length === 1;\n\n    // main subplot x and y (i.e. found in plotinfo - the main ones)\n    var xa0, ya0;\n    // {ax._id: ax} hash objects\n    var xaHash, yaHash;\n    // xaHash/yaHash values (arrays)\n    var xaxes, yaxes;\n    // main axis offsets\n    var xs, ys;\n    // main axis lengths\n    var pw, ph;\n    // contains keys 'xaHash', 'yaHash', 'xaxes', and 'yaxes'\n    // which are the x/y {ax._id: ax} hash objects and their values\n    // for linked axis relative to this subplot\n    var links;\n    // similar to `links` but for matching axes\n    var matches;\n    // set to ew/ns val when active, set to '' when inactive\n    var xActive, yActive;\n    // are all axes in this subplot are fixed?\n    var allFixedRanges;\n    // do we need to edit x/y ranges?\n    var editX, editY;\n    // graph-wide optimization flags\n    var hasScatterGl, hasSplom, hasSVG;\n    // collected changes to be made to the plot by relayout at the end\n    var updates;\n    // scaling factors from css transform\n    var scaleX;\n    var scaleY;\n\n    function recomputeAxisLists() {\n        xa0 = plotinfo.xaxis;\n        ya0 = plotinfo.yaxis;\n        pw = xa0._length;\n        ph = ya0._length;\n        xs = xa0._offset;\n        ys = ya0._offset;\n\n        xaHash = {};\n        xaHash[xa0._id] = xa0;\n        yaHash = {};\n        yaHash[ya0._id] = ya0;\n\n        // if we're dragging two axes at once, also drag overlays\n        if(ns && ew) {\n            var overlays = plotinfo.overlays;\n            for(var i = 0; i < overlays.length; i++) {\n                var xa = overlays[i].xaxis;\n                xaHash[xa._id] = xa;\n                var ya = overlays[i].yaxis;\n                yaHash[ya._id] = ya;\n            }\n        }\n\n        xaxes = hashValues(xaHash);\n        yaxes = hashValues(yaHash);\n        xActive = isDirectionActive(xaxes, ew);\n        yActive = isDirectionActive(yaxes, ns);\n        allFixedRanges = !yActive && !xActive;\n\n        matches = calcLinks(gd, gd._fullLayout._axisMatchGroups, xaHash, yaHash);\n        links = calcLinks(gd, gd._fullLayout._axisConstraintGroups, xaHash, yaHash, matches);\n        var spConstrained = links.isSubplotConstrained || matches.isSubplotConstrained;\n        editX = ew || spConstrained;\n        editY = ns || spConstrained;\n\n        var fullLayout = gd._fullLayout;\n        hasScatterGl = fullLayout._has('scattergl');\n        hasSplom = fullLayout._has('splom');\n        hasSVG = fullLayout._has('svg');\n    }\n\n    recomputeAxisLists();\n\n    var cursor = getDragCursor(yActive + xActive, gd._fullLayout.dragmode, isMainDrag);\n    var dragger = makeRectDragger(plotinfo, ns + ew + 'drag', cursor, x, y, w, h);\n\n    // still need to make the element if the axes are disabled\n    // but nuke its events (except for maindrag which needs them for hover)\n    // and stop there\n    if(allFixedRanges && !isMainDrag) {\n        dragger.onmousedown = null;\n        dragger.style.pointerEvents = 'none';\n        return dragger;\n    }\n\n    var dragOptions = {\n        element: dragger,\n        gd: gd,\n        plotinfo: plotinfo\n    };\n\n    dragOptions.prepFn = function(e, startX, startY) {\n        var dragModePrev = dragOptions.dragmode;\n        var dragModeNow = gd._fullLayout.dragmode;\n        if(dragModeNow !== dragModePrev) {\n            dragOptions.dragmode = dragModeNow;\n        }\n\n        recomputeAxisLists();\n\n        scaleX = gd._fullLayout._invScaleX;\n        scaleY = gd._fullLayout._invScaleY;\n\n        if(!allFixedRanges) {\n            if(isMainDrag) {\n                // main dragger handles all drag modes, and changes\n                // to pan (or to zoom if it already is pan) on shift\n                if(e.shiftKey) {\n                    if(dragModeNow === 'pan') dragModeNow = 'zoom';\n                    else if(!selectingOrDrawing(dragModeNow)) dragModeNow = 'pan';\n                } else if(e.ctrlKey) {\n                    dragModeNow = 'pan';\n                }\n            } else {\n                // all other draggers just pan\n                dragModeNow = 'pan';\n            }\n        }\n\n        if(freeMode(dragModeNow)) dragOptions.minDrag = 1;\n        else dragOptions.minDrag = undefined;\n\n        if(selectingOrDrawing(dragModeNow)) {\n            dragOptions.xaxes = xaxes;\n            dragOptions.yaxes = yaxes;\n            // this attaches moveFn, clickFn, doneFn on dragOptions\n            prepSelect(e, startX, startY, dragOptions, dragModeNow);\n        } else {\n            dragOptions.clickFn = clickFn;\n            if(selectingOrDrawing(dragModePrev)) {\n                // TODO Fix potential bug\n                // Note: clearing / resetting selection state only happens, when user\n                // triggers at least one interaction in pan/zoom mode. Otherwise, the\n                // select/lasso outlines are deleted (in plots.js.cleanPlot) but the selection\n                // cache isn't cleared. So when the user switches back to select/lasso and\n                // 'adds to a selection' with Shift, the \"old\", seemingly removed outlines\n                // are redrawn again because the selection cache still holds their coordinates.\n                // However, this isn't easily solved, since plots.js would need\n                // to have a reference to the dragOptions object (which holds the\n                // selection cache).\n                clearAndResetSelect();\n            }\n\n            if(!allFixedRanges) {\n                if(dragModeNow === 'zoom') {\n                    dragOptions.moveFn = zoomMove;\n                    dragOptions.doneFn = zoomDone;\n\n                    // zoomMove takes care of the threshold, but we need to\n                    // minimize this so that constrained zoom boxes will flip\n                    // orientation at the right place\n                    dragOptions.minDrag = 1;\n\n                    zoomPrep(e, startX, startY);\n                } else if(dragModeNow === 'pan') {\n                    dragOptions.moveFn = plotDrag;\n                    dragOptions.doneFn = dragTail;\n                }\n            }\n        }\n\n        gd._fullLayout._redrag = function() {\n            var dragDataNow = gd._dragdata;\n\n            if(dragDataNow && dragDataNow.element === dragger) {\n                var dragModeNow = gd._fullLayout.dragmode;\n\n                if(!selectingOrDrawing(dragModeNow)) {\n                    recomputeAxisLists();\n                    updateSubplots([0, 0, pw, ph]);\n                    dragOptions.moveFn(dragDataNow.dx, dragDataNow.dy);\n                }\n\n                // TODO should we try to \"re-select\" under select/lasso modes?\n                // probably best to wait for https://github.com/plotly/plotly.js/issues/1851\n            }\n        };\n    };\n\n    function clearAndResetSelect() {\n        // clear selection polygon cache (if any)\n        dragOptions.plotinfo.selection = false;\n        // clear selection outlines\n        clearSelect(gd);\n    }\n\n    function clickFn(numClicks, evt) {\n        var gd = dragOptions.gd;\n        if(gd._fullLayout._activeShapeIndex >= 0) {\n            gd._fullLayout._deactivateShape(gd);\n            return;\n        }\n\n        var clickmode = gd._fullLayout.clickmode;\n\n        removeZoombox(gd);\n\n        if(numClicks === 2 && !singleEnd) doubleClick();\n\n        if(isMainDrag) {\n            if(clickmode.indexOf('select') > -1) {\n                selectOnClick(evt, gd, xaxes, yaxes, plotinfo.id, dragOptions);\n            }\n\n            if(clickmode.indexOf('event') > -1) {\n                Fx.click(gd, evt, plotinfo.id);\n            }\n        } else if(numClicks === 1 && singleEnd) {\n            var ax = ns ? ya0 : xa0;\n            var end = (ns === 's' || ew === 'w') ? 0 : 1;\n            var attrStr = ax._name + '.range[' + end + ']';\n            var initialText = getEndText(ax, end);\n            var hAlign = 'left';\n            var vAlign = 'middle';\n\n            if(ax.fixedrange) return;\n\n            if(ns) {\n                vAlign = (ns === 'n') ? 'top' : 'bottom';\n                if(ax.side === 'right') hAlign = 'right';\n            } else if(ew === 'e') hAlign = 'right';\n\n            if(gd._context.showAxisRangeEntryBoxes) {\n                d3.select(dragger)\n                    .call(svgTextUtils.makeEditable, {\n                        gd: gd,\n                        immediate: true,\n                        background: gd._fullLayout.paper_bgcolor,\n                        text: String(initialText),\n                        fill: ax.tickfont ? ax.tickfont.color : '#444',\n                        horizontalAlign: hAlign,\n                        verticalAlign: vAlign\n                    })\n                    .on('edit', function(text) {\n                        var v = ax.d2r(text);\n                        if(v !== undefined) {\n                            Registry.call('_guiRelayout', gd, attrStr, v);\n                        }\n                    });\n            }\n        }\n    }\n\n    dragElement.init(dragOptions);\n\n    // x/y px position at start of drag\n    var x0, y0;\n    // bbox object of the zoombox\n    var box;\n    // luminance of bg behind zoombox\n    var lum;\n    // zoombox path outline\n    var path0;\n    // is zoombox dimmed (during drag)\n    var dimmed;\n    // 'x'-only, 'y' or 'xy' zooming\n    var zoomMode;\n    // zoombox d3 selection\n    var zb;\n    // zoombox corner d3 selection\n    var corners;\n    // zoom takes over minDrag, so it also has to take over gd._dragged\n    var zoomDragged;\n\n    function zoomPrep(e, startX, startY) {\n        var dragBBox = dragger.getBoundingClientRect();\n        x0 = startX - dragBBox.left;\n        y0 = startY - dragBBox.top;\n\n        gd._fullLayout._calcInverseTransform(gd);\n        var transformedCoords = Lib.apply3DTransform(gd._fullLayout._invTransform)(x0, y0);\n        x0 = transformedCoords[0];\n        y0 = transformedCoords[1];\n\n        box = {l: x0, r: x0, w: 0, t: y0, b: y0, h: 0};\n        lum = gd._hmpixcount ?\n            (gd._hmlumcount / gd._hmpixcount) :\n            tinycolor(gd._fullLayout.plot_bgcolor).getLuminance();\n        path0 = 'M0,0H' + pw + 'V' + ph + 'H0V0';\n        dimmed = false;\n        zoomMode = 'xy';\n        zoomDragged = false;\n        zb = makeZoombox(zoomlayer, lum, xs, ys, path0);\n        corners = makeCorners(zoomlayer, xs, ys);\n    }\n\n    function zoomMove(dx0, dy0) {\n        if(gd._transitioningWithDuration) {\n            return false;\n        }\n\n        var x1 = Math.max(0, Math.min(pw, scaleX * dx0 + x0));\n        var y1 = Math.max(0, Math.min(ph, scaleY * dy0 + y0));\n        var dx = Math.abs(x1 - x0);\n        var dy = Math.abs(y1 - y0);\n\n        box.l = Math.min(x0, x1);\n        box.r = Math.max(x0, x1);\n        box.t = Math.min(y0, y1);\n        box.b = Math.max(y0, y1);\n\n        function noZoom() {\n            zoomMode = '';\n            box.r = box.l;\n            box.t = box.b;\n            corners.attr('d', 'M0,0Z');\n        }\n\n        if(links.isSubplotConstrained) {\n            if(dx > MINZOOM || dy > MINZOOM) {\n                zoomMode = 'xy';\n                if(dx / pw > dy / ph) {\n                    dy = dx * ph / pw;\n                    if(y0 > y1) box.t = y0 - dy;\n                    else box.b = y0 + dy;\n                } else {\n                    dx = dy * pw / ph;\n                    if(x0 > x1) box.l = x0 - dx;\n                    else box.r = x0 + dx;\n                }\n                corners.attr('d', xyCorners(box));\n            } else {\n                noZoom();\n            }\n        } else if(matches.isSubplotConstrained) {\n            if(dx > MINZOOM || dy > MINZOOM) {\n                zoomMode = 'xy';\n\n                var r0 = Math.min(box.l / pw, (ph - box.b) / ph);\n                var r1 = Math.max(box.r / pw, (ph - box.t) / ph);\n\n                box.l = r0 * pw;\n                box.r = r1 * pw;\n                box.b = (1 - r0) * ph;\n                box.t = (1 - r1) * ph;\n                corners.attr('d', xyCorners(box));\n            } else {\n                noZoom();\n            }\n        } else if(!yActive || dy < Math.min(Math.max(dx * 0.6, MINDRAG), MINZOOM)) {\n            // look for small drags in one direction or the other,\n            // and only drag the other axis\n\n            if(dx < MINDRAG || !xActive) {\n                noZoom();\n            } else {\n                box.t = 0;\n                box.b = ph;\n                zoomMode = 'x';\n                corners.attr('d', xCorners(box, y0));\n            }\n        } else if(!xActive || dx < Math.min(dy * 0.6, MINZOOM)) {\n            box.l = 0;\n            box.r = pw;\n            zoomMode = 'y';\n            corners.attr('d', yCorners(box, x0));\n        } else {\n            zoomMode = 'xy';\n            corners.attr('d', xyCorners(box));\n        }\n        box.w = box.r - box.l;\n        box.h = box.b - box.t;\n\n        if(zoomMode) zoomDragged = true;\n        gd._dragged = zoomDragged;\n\n        updateZoombox(zb, corners, box, path0, dimmed, lum);\n        computeZoomUpdates();\n        gd.emit('plotly_relayouting', updates);\n        dimmed = true;\n    }\n\n    function computeZoomUpdates() {\n        updates = {};\n\n        // TODO: edit linked axes in zoomAxRanges and in dragTail\n        if(zoomMode === 'xy' || zoomMode === 'x') {\n            zoomAxRanges(xaxes, box.l / pw, box.r / pw, updates, links.xaxes);\n            updateMatchedAxRange('x', updates);\n        }\n        if(zoomMode === 'xy' || zoomMode === 'y') {\n            zoomAxRanges(yaxes, (ph - box.b) / ph, (ph - box.t) / ph, updates, links.yaxes);\n            updateMatchedAxRange('y', updates);\n        }\n    }\n\n    function zoomDone() {\n        computeZoomUpdates();\n        removeZoombox(gd);\n        dragTail();\n        showDoubleClickNotifier(gd);\n    }\n\n    // scroll zoom, on all draggers except corners\n    var scrollViewBox = [0, 0, pw, ph];\n    // wait a little after scrolling before redrawing\n    var redrawTimer = null;\n    var REDRAWDELAY = constants.REDRAWDELAY;\n    var mainplot = plotinfo.mainplot ? gd._fullLayout._plots[plotinfo.mainplot] : plotinfo;\n\n    function zoomWheel(e) {\n        // deactivate mousewheel scrolling on embedded graphs\n        // devs can override this with layout._enablescrollzoom,\n        // but _ ensures this setting won't leave their page\n        if(!gd._context._scrollZoom.cartesian && !gd._fullLayout._enablescrollzoom) {\n            return;\n        }\n\n        clearAndResetSelect();\n\n        // If a transition is in progress, then disable any behavior:\n        if(gd._transitioningWithDuration) {\n            e.preventDefault();\n            e.stopPropagation();\n            return;\n        }\n\n        recomputeAxisLists();\n\n        clearTimeout(redrawTimer);\n\n        var wheelDelta = -e.deltaY;\n        if(!isFinite(wheelDelta)) wheelDelta = e.wheelDelta / 10;\n        if(!isFinite(wheelDelta)) {\n            Lib.log('Did not find wheel motion attributes: ', e);\n            return;\n        }\n\n        var zoom = Math.exp(-Math.min(Math.max(wheelDelta, -20), 20) / 200);\n        var gbb = mainplot.draglayer.select('.nsewdrag').node().getBoundingClientRect();\n        var xfrac = (e.clientX - gbb.left) / gbb.width;\n        var yfrac = (gbb.bottom - e.clientY) / gbb.height;\n        var i;\n\n        function zoomWheelOneAxis(ax, centerFraction, zoom) {\n            if(ax.fixedrange) return;\n\n            var axRange = Lib.simpleMap(ax.range, ax.r2l);\n            var v0 = axRange[0] + (axRange[1] - axRange[0]) * centerFraction;\n            function doZoom(v) { return ax.l2r(v0 + (v - v0) * zoom); }\n            ax.range = axRange.map(doZoom);\n        }\n\n        if(editX) {\n            // if we're only zooming this axis because of constraints,\n            // zoom it about the center\n            if(!ew) xfrac = 0.5;\n\n            for(i = 0; i < xaxes.length; i++) {\n                zoomWheelOneAxis(xaxes[i], xfrac, zoom);\n            }\n            updateMatchedAxRange('x');\n\n            scrollViewBox[2] *= zoom;\n            scrollViewBox[0] += scrollViewBox[2] * xfrac * (1 / zoom - 1);\n        }\n        if(editY) {\n            if(!ns) yfrac = 0.5;\n\n            for(i = 0; i < yaxes.length; i++) {\n                zoomWheelOneAxis(yaxes[i], yfrac, zoom);\n            }\n            updateMatchedAxRange('y');\n\n            scrollViewBox[3] *= zoom;\n            scrollViewBox[1] += scrollViewBox[3] * (1 - yfrac) * (1 / zoom - 1);\n        }\n\n        // viewbox redraw at first\n        updateSubplots(scrollViewBox);\n        ticksAndAnnotations();\n\n        gd.emit('plotly_relayouting', updates);\n\n        // then replot after a delay to make sure\n        // no more scrolling is coming\n        redrawTimer = setTimeout(function() {\n            if(!gd._fullLayout) return;\n            scrollViewBox = [0, 0, pw, ph];\n            dragTail();\n        }, REDRAWDELAY);\n\n        e.preventDefault();\n        return;\n    }\n\n    // everything but the corners gets wheel zoom\n    if(ns.length * ew.length !== 1) {\n        attachWheelEventHandler(dragger, zoomWheel);\n    }\n\n    // plotDrag: move the plot in response to a drag\n    function plotDrag(dx, dy) {\n        dx = dx * scaleX;\n        dy = dy * scaleY;\n        // If a transition is in progress, then disable any behavior:\n        if(gd._transitioningWithDuration) {\n            return;\n        }\n\n        // prevent axis drawing from monkeying with margins until we're done\n        gd._fullLayout._replotting = true;\n\n        if(xActive === 'ew' || yActive === 'ns') {\n            var spDx = xActive ? -dx : 0;\n            var spDy = yActive ? -dy : 0;\n            if(matches.isSubplotConstrained) {\n                if(xActive && yActive) {\n                    var frac = (dx / pw - dy / ph) / 2;\n                    dx = frac * pw;\n                    dy = -frac * ph;\n                    spDx = -dx;\n                    spDy = -dy;\n                }\n                if(yActive) {\n                    spDx = -spDy * pw / ph;\n                } else {\n                    spDy = -spDx * ph / pw;\n                }\n            }\n            if(xActive) {\n                dragAxList(xaxes, dx);\n                updateMatchedAxRange('x');\n            }\n            if(yActive) {\n                dragAxList(yaxes, dy);\n                updateMatchedAxRange('y');\n            }\n            updateSubplots([spDx, spDy, pw, ph]);\n            ticksAndAnnotations();\n            gd.emit('plotly_relayouting', updates);\n            return;\n        }\n\n        // dz: set a new value for one end (0 or 1) of an axis array axArray,\n        // and return a pixel shift for that end for the viewbox\n        // based on pixel drag distance d\n        // TODO: this makes (generally non-fatal) errors when you get\n        // near floating point limits\n        function dz(axArray, end, d) {\n            var otherEnd = 1 - end;\n            var movedAx;\n            var newLinearizedEnd;\n            for(var i = 0; i < axArray.length; i++) {\n                var axi = axArray[i];\n                if(axi.fixedrange) continue;\n                movedAx = axi;\n                newLinearizedEnd = axi._rl[otherEnd] +\n                    (axi._rl[end] - axi._rl[otherEnd]) / dZoom(d / axi._length);\n                var newEnd = axi.l2r(newLinearizedEnd);\n\n                // if l2r comes back false or undefined, it means we've dragged off\n                // the end of valid ranges - so stop.\n                if(newEnd !== false && newEnd !== undefined) axi.range[end] = newEnd;\n            }\n            return movedAx._length * (movedAx._rl[end] - newLinearizedEnd) /\n                (movedAx._rl[end] - movedAx._rl[otherEnd]);\n        }\n\n        var dxySign = ((xActive === 'w') === (yActive === 'n')) ? 1 : -1;\n        if(xActive && yActive && (links.isSubplotConstrained || matches.isSubplotConstrained)) {\n            // dragging a corner of a constrained subplot:\n            // respect the fixed corner, but harmonize dx and dy\n            var dxyFraction = (dx / pw + dxySign * dy / ph) / 2;\n            dx = dxyFraction * pw;\n            dy = dxySign * dxyFraction * ph;\n        }\n\n        var xStart, yStart;\n\n        if(xActive === 'w') dx = dz(xaxes, 0, dx);\n        else if(xActive === 'e') dx = dz(xaxes, 1, -dx);\n        else if(!xActive) dx = 0;\n\n        if(yActive === 'n') dy = dz(yaxes, 1, dy);\n        else if(yActive === 's') dy = dz(yaxes, 0, -dy);\n        else if(!yActive) dy = 0;\n\n        xStart = (xActive === 'w') ? dx : 0;\n        yStart = (yActive === 'n') ? dy : 0;\n\n        if(\n            (links.isSubplotConstrained && !matches.isSubplotConstrained) ||\n            // NW or SE on matching axes - create a symmetric zoom\n            (matches.isSubplotConstrained && xActive && yActive && dxySign > 0)\n        ) {\n            var i;\n            if(matches.isSubplotConstrained || (!xActive && yActive.length === 1)) {\n                // dragging one end of the y axis of a constrained subplot\n                // scale the other axis the same about its middle\n                for(i = 0; i < xaxes.length; i++) {\n                    xaxes[i].range = xaxes[i]._r.slice();\n                    scaleZoom(xaxes[i], 1 - dy / ph);\n                }\n                dx = dy * pw / ph;\n                xStart = dx / 2;\n            }\n            if(matches.isSubplotConstrained || (!yActive && xActive.length === 1)) {\n                for(i = 0; i < yaxes.length; i++) {\n                    yaxes[i].range = yaxes[i]._r.slice();\n                    scaleZoom(yaxes[i], 1 - dx / pw);\n                }\n                dy = dx * ph / pw;\n                yStart = dy / 2;\n            }\n        }\n\n        if(!matches.isSubplotConstrained || !yActive) {\n            updateMatchedAxRange('x');\n        }\n        if(!matches.isSubplotConstrained || !xActive) {\n            updateMatchedAxRange('y');\n        }\n        var xSize = pw - dx;\n        var ySize = ph - dy;\n        if(matches.isSubplotConstrained && !(xActive && yActive)) {\n            if(xActive) {\n                yStart = xStart ? 0 : (dx * ph / pw);\n                ySize = xSize * ph / pw;\n            } else {\n                xStart = yStart ? 0 : (dy * pw / ph);\n                xSize = ySize * pw / ph;\n            }\n        }\n        updateSubplots([xStart, yStart, xSize, ySize]);\n        ticksAndAnnotations();\n        gd.emit('plotly_relayouting', updates);\n    }\n\n    function updateMatchedAxRange(axLetter, out) {\n        var matchedAxes = matches.isSubplotConstrained ?\n            {x: yaxes, y: xaxes}[axLetter] :\n            matches[axLetter + 'axes'];\n\n        var constrainedAxes = matches.isSubplotConstrained ?\n            {x: xaxes, y: yaxes}[axLetter] :\n            [];\n\n        for(var i = 0; i < matchedAxes.length; i++) {\n            var ax = matchedAxes[i];\n            var axId = ax._id;\n            var axId2 = matches.xLinks[axId] || matches.yLinks[axId];\n            var ax2 = constrainedAxes[0] || xaHash[axId2] || yaHash[axId2];\n\n            if(ax2) {\n                if(out) {\n                    // zoombox case - don't mutate 'range', just add keys in 'updates'\n                    out[ax._name + '.range[0]'] = out[ax2._name + '.range[0]'];\n                    out[ax._name + '.range[1]'] = out[ax2._name + '.range[1]'];\n                } else {\n                    ax.range = ax2.range.slice();\n                }\n            }\n        }\n    }\n\n    // Draw ticks and annotations (and other components) when ranges change.\n    // Also records the ranges that have changed for use by update at the end.\n    function ticksAndAnnotations() {\n        var activeAxIds = [];\n        var i;\n\n        function pushActiveAxIds(axList) {\n            for(i = 0; i < axList.length; i++) {\n                if(!axList[i].fixedrange) activeAxIds.push(axList[i]._id);\n            }\n        }\n\n        if(editX) {\n            pushActiveAxIds(xaxes);\n            pushActiveAxIds(links.xaxes);\n            pushActiveAxIds(matches.xaxes);\n        }\n        if(editY) {\n            pushActiveAxIds(yaxes);\n            pushActiveAxIds(links.yaxes);\n            pushActiveAxIds(matches.yaxes);\n        }\n\n        updates = {};\n        for(i = 0; i < activeAxIds.length; i++) {\n            var axId = activeAxIds[i];\n            var ax = getFromId(gd, axId);\n            Axes.drawOne(gd, ax, {skipTitle: true});\n            updates[ax._name + '.range[0]'] = ax.range[0];\n            updates[ax._name + '.range[1]'] = ax.range[1];\n        }\n\n        Axes.redrawComponents(gd, activeAxIds);\n    }\n\n    function doubleClick() {\n        if(gd._transitioningWithDuration) return;\n\n        var doubleClickConfig = gd._context.doubleClick;\n\n        var axList = [];\n        if(xActive) axList = axList.concat(xaxes);\n        if(yActive) axList = axList.concat(yaxes);\n        if(matches.xaxes) axList = axList.concat(matches.xaxes);\n        if(matches.yaxes) axList = axList.concat(matches.yaxes);\n\n        var attrs = {};\n        var ax, i, rangeInitial;\n\n        // For reset+autosize mode:\n        // If *any* of the main axes is not at its initial range\n        // (or autoranged, if we have no initial range, to match the logic in\n        // doubleClickConfig === 'reset' below), we reset.\n        // If they are *all* at their initial ranges, then we autosize.\n        if(doubleClickConfig === 'reset+autosize') {\n            doubleClickConfig = 'autosize';\n\n            for(i = 0; i < axList.length; i++) {\n                ax = axList[i];\n                if((ax._rangeInitial && (\n                        ax.range[0] !== ax._rangeInitial[0] ||\n                        ax.range[1] !== ax._rangeInitial[1]\n                    )) ||\n                    (!ax._rangeInitial && !ax.autorange)\n                ) {\n                    doubleClickConfig = 'reset';\n                    break;\n                }\n            }\n        }\n\n        if(doubleClickConfig === 'autosize') {\n            // don't set the linked axes here, so relayout marks them as shrinkable\n            // and we autosize just to the requested axis/axes\n            for(i = 0; i < axList.length; i++) {\n                ax = axList[i];\n                if(!ax.fixedrange) attrs[ax._name + '.autorange'] = true;\n            }\n        } else if(doubleClickConfig === 'reset') {\n            // when we're resetting, reset all linked axes too, so we get back\n            // to the fully-auto-with-constraints situation\n            if(xActive || links.isSubplotConstrained) axList = axList.concat(links.xaxes);\n            if(yActive && !links.isSubplotConstrained) axList = axList.concat(links.yaxes);\n\n            if(links.isSubplotConstrained) {\n                if(!xActive) axList = axList.concat(xaxes);\n                else if(!yActive) axList = axList.concat(yaxes);\n            }\n\n            for(i = 0; i < axList.length; i++) {\n                ax = axList[i];\n\n                if(!ax.fixedrange) {\n                    if(!ax._rangeInitial) {\n                        attrs[ax._name + '.autorange'] = true;\n                    } else {\n                        rangeInitial = ax._rangeInitial;\n                        attrs[ax._name + '.range[0]'] = rangeInitial[0];\n                        attrs[ax._name + '.range[1]'] = rangeInitial[1];\n                    }\n                }\n            }\n        }\n\n        gd.emit('plotly_doubleclick', null);\n        Registry.call('_guiRelayout', gd, attrs);\n    }\n\n    // dragTail - finish a drag event with a redraw\n    function dragTail() {\n        // put the subplot viewboxes back to default (Because we're going to)\n        // be repositioning the data in the relayout. But DON'T call\n        // ticksAndAnnotations again - it's unnecessary and would overwrite `updates`\n        updateSubplots([0, 0, pw, ph]);\n\n        // since we may have been redrawing some things during the drag, we may have\n        // accumulated MathJax promises - wait for them before we relayout.\n        Lib.syncOrAsync([\n            Plots.previousPromises,\n            function() {\n                gd._fullLayout._replotting = false;\n                Registry.call('_guiRelayout', gd, updates);\n            }\n        ], gd);\n    }\n\n    // updateSubplots - find all plot viewboxes that should be\n    // affected by this drag, and update them. look for all plots\n    // sharing an affected axis (including the one being dragged),\n    // includes also scattergl and splom logic.\n    function updateSubplots(viewBox) {\n        var fullLayout = gd._fullLayout;\n        var plotinfos = fullLayout._plots;\n        var subplots = fullLayout._subplots.cartesian;\n        var i, sp, xa, ya;\n\n        if(hasSplom) {\n            Registry.subplotsRegistry.splom.drag(gd);\n        }\n\n        if(hasScatterGl) {\n            for(i = 0; i < subplots.length; i++) {\n                sp = plotinfos[subplots[i]];\n                xa = sp.xaxis;\n                ya = sp.yaxis;\n\n                if(sp._scene) {\n                    var xrng = Lib.simpleMap(xa.range, xa.r2l);\n                    var yrng = Lib.simpleMap(ya.range, ya.r2l);\n                    sp._scene.update({range: [xrng[0], yrng[0], xrng[1], yrng[1]]});\n                }\n            }\n        }\n\n        if(hasSplom || hasScatterGl) {\n            clearGlCanvases(gd);\n            redrawReglTraces(gd);\n        }\n\n        if(hasSVG) {\n            var xScaleFactor = viewBox[2] / xa0._length;\n            var yScaleFactor = viewBox[3] / ya0._length;\n\n            for(i = 0; i < subplots.length; i++) {\n                sp = plotinfos[subplots[i]];\n                xa = sp.xaxis;\n                ya = sp.yaxis;\n\n                var editX2 = (editX || matches.isSubplotConstrained) && !xa.fixedrange && xaHash[xa._id];\n                var editY2 = (editY || matches.isSubplotConstrained) && !ya.fixedrange && yaHash[ya._id];\n\n                var xScaleFactor2, yScaleFactor2;\n                var clipDx, clipDy;\n\n                if(editX2) {\n                    xScaleFactor2 = xScaleFactor;\n                    clipDx = ew || matches.isSubplotConstrained ? viewBox[0] : getShift(xa, xScaleFactor2);\n                } else if(matches.xaHash[xa._id]) {\n                    xScaleFactor2 = xScaleFactor;\n                    clipDx = viewBox[0] * xa._length / xa0._length;\n                } else if(matches.yaHash[xa._id]) {\n                    xScaleFactor2 = yScaleFactor;\n                    clipDx = yActive === 'ns' ?\n                        -viewBox[1] * xa._length / ya0._length :\n                        getShift(xa, xScaleFactor2, {n: 'top', s: 'bottom'}[yActive]);\n                } else {\n                    xScaleFactor2 = getLinkedScaleFactor(xa, xScaleFactor, yScaleFactor);\n                    clipDx = scaleAndGetShift(xa, xScaleFactor2);\n                }\n\n                if(editY2) {\n                    yScaleFactor2 = yScaleFactor;\n                    clipDy = ns || matches.isSubplotConstrained ? viewBox[1] : getShift(ya, yScaleFactor2);\n                } else if(matches.yaHash[ya._id]) {\n                    yScaleFactor2 = yScaleFactor;\n                    clipDy = viewBox[1] * ya._length / ya0._length;\n                } else if(matches.xaHash[ya._id]) {\n                    yScaleFactor2 = xScaleFactor;\n                    clipDy = xActive === 'ew' ?\n                        -viewBox[0] * ya._length / xa0._length :\n                        getShift(ya, yScaleFactor2, {e: 'right', w: 'left'}[xActive]);\n                } else {\n                    yScaleFactor2 = getLinkedScaleFactor(ya, xScaleFactor, yScaleFactor);\n                    clipDy = scaleAndGetShift(ya, yScaleFactor2);\n                }\n\n                // don't scale at all if neither axis is scalable here\n                if(!xScaleFactor2 && !yScaleFactor2) {\n                    continue;\n                }\n\n                // but if only one is, reset the other axis scaling\n                if(!xScaleFactor2) xScaleFactor2 = 1;\n                if(!yScaleFactor2) yScaleFactor2 = 1;\n\n                var plotDx = xa._offset - clipDx / xScaleFactor2;\n                var plotDy = ya._offset - clipDy / yScaleFactor2;\n\n                // TODO could be more efficient here:\n                // setTranslate and setScale do a lot of extra work\n                // when working independently, should perhaps combine\n                // them into a single routine.\n                sp.clipRect\n                    .call(Drawing.setTranslate, clipDx, clipDy)\n                    .call(Drawing.setScale, xScaleFactor2, yScaleFactor2);\n\n                sp.plot\n                    .call(Drawing.setTranslate, plotDx, plotDy)\n                    .call(Drawing.setScale, 1 / xScaleFactor2, 1 / yScaleFactor2);\n\n                // apply an inverse scale to individual points to counteract\n                // the scale of the trace group.\n                // apply only when scale changes, as adjusting the scale of\n                // all the points can be expansive.\n                if(xScaleFactor2 !== sp.xScaleFactor || yScaleFactor2 !== sp.yScaleFactor) {\n                    Drawing.setPointGroupScale(sp.zoomScalePts, xScaleFactor2, yScaleFactor2);\n                    Drawing.setTextPointsScale(sp.zoomScaleTxt, xScaleFactor2, yScaleFactor2);\n                }\n\n                Drawing.hideOutsideRangePoints(sp.clipOnAxisFalseTraces, sp);\n\n                // update x/y scaleFactor stash\n                sp.xScaleFactor = xScaleFactor2;\n                sp.yScaleFactor = yScaleFactor2;\n            }\n        }\n    }\n\n    // Find the appropriate scaling for this axis, if it's linked to the\n    // dragged axes by constraints. 0 is special, it means this axis shouldn't\n    // ever be scaled (will be converted to 1 if the other axis is scaled)\n    function getLinkedScaleFactor(ax, xScaleFactor, yScaleFactor) {\n        if(ax.fixedrange) return 0;\n\n        if(editX && links.xaHash[ax._id]) {\n            return xScaleFactor;\n        }\n        if(editY && (links.isSubplotConstrained ? links.xaHash : links.yaHash)[ax._id]) {\n            return yScaleFactor;\n        }\n        return 0;\n    }\n\n    function scaleAndGetShift(ax, scaleFactor) {\n        if(scaleFactor) {\n            ax.range = ax._r.slice();\n            scaleZoom(ax, scaleFactor);\n            return getShift(ax, scaleFactor);\n        }\n        return 0;\n    }\n\n    function getShift(ax, scaleFactor, from) {\n        return ax._length * (1 - scaleFactor) * FROM_TL[from || ax.constraintoward || 'middle'];\n    }\n\n    return dragger;\n}\n\nfunction makeDragger(plotinfo, nodeName, dragClass, cursor) {\n    var dragger3 = Lib.ensureSingle(plotinfo.draglayer, nodeName, dragClass, function(s) {\n        s.classed('drag', true)\n            .style({fill: 'transparent', 'stroke-width': 0})\n            .attr('data-subplot', plotinfo.id);\n    });\n\n    dragger3.call(setCursor, cursor);\n\n    return dragger3.node();\n}\n\nfunction makeRectDragger(plotinfo, dragClass, cursor, x, y, w, h) {\n    var dragger = makeDragger(plotinfo, 'rect', dragClass, cursor);\n    d3.select(dragger).call(Drawing.setRect, x, y, w, h);\n    return dragger;\n}\n\nfunction isDirectionActive(axList, activeVal) {\n    for(var i = 0; i < axList.length; i++) {\n        if(!axList[i].fixedrange) return activeVal;\n    }\n    return '';\n}\n\nfunction getEndText(ax, end) {\n    var initialVal = ax.range[end];\n    var diff = Math.abs(initialVal - ax.range[1 - end]);\n    var dig;\n\n    // TODO: this should basically be ax.r2d but we're doing extra\n    // rounding here... can we clean up at all?\n    if(ax.type === 'date') {\n        return initialVal;\n    } else if(ax.type === 'log') {\n        dig = Math.ceil(Math.max(0, -Math.log(diff) / Math.LN10)) + 3;\n        return d3.format('.' + dig + 'g')(Math.pow(10, initialVal));\n    } else { // linear numeric (or category... but just show numbers here)\n        dig = Math.floor(Math.log(Math.abs(initialVal)) / Math.LN10) -\n            Math.floor(Math.log(diff) / Math.LN10) + 4;\n        return d3.format('.' + String(dig) + 'g')(initialVal);\n    }\n}\n\nfunction zoomAxRanges(axList, r0Fraction, r1Fraction, updates, linkedAxes) {\n    for(var i = 0; i < axList.length; i++) {\n        var axi = axList[i];\n        if(axi.fixedrange) continue;\n\n        if(axi.rangebreaks) {\n            var isY = axi._id.charAt(0) === 'y';\n            var r0F = isY ? (1 - r0Fraction) : r0Fraction;\n            var r1F = isY ? (1 - r1Fraction) : r1Fraction;\n\n            updates[axi._name + '.range[0]'] = axi.l2r(axi.p2l(r0F * axi._length));\n            updates[axi._name + '.range[1]'] = axi.l2r(axi.p2l(r1F * axi._length));\n        } else {\n            var axRangeLinear0 = axi._rl[0];\n            var axRangeLinearSpan = axi._rl[1] - axRangeLinear0;\n            updates[axi._name + '.range[0]'] = axi.l2r(axRangeLinear0 + axRangeLinearSpan * r0Fraction);\n            updates[axi._name + '.range[1]'] = axi.l2r(axRangeLinear0 + axRangeLinearSpan * r1Fraction);\n        }\n    }\n\n    // zoom linked axes about their centers\n    if(linkedAxes && linkedAxes.length) {\n        var linkedR0Fraction = (r0Fraction + (1 - r1Fraction)) / 2;\n        zoomAxRanges(linkedAxes, linkedR0Fraction, 1 - linkedR0Fraction, updates, []);\n    }\n}\n\nfunction dragAxList(axList, pix) {\n    for(var i = 0; i < axList.length; i++) {\n        var axi = axList[i];\n        if(!axi.fixedrange) {\n            if(axi.rangebreaks) {\n                var p0 = 0;\n                var p1 = axi._length;\n                var d0 = axi.p2l(p0 + pix) - axi.p2l(p0);\n                var d1 = axi.p2l(p1 + pix) - axi.p2l(p1);\n                var delta = (d0 + d1) / 2;\n\n                axi.range = [\n                    axi.l2r(axi._rl[0] - delta),\n                    axi.l2r(axi._rl[1] - delta)\n                ];\n            } else {\n                axi.range = [\n                    axi.l2r(axi._rl[0] - pix / axi._m),\n                    axi.l2r(axi._rl[1] - pix / axi._m)\n                ];\n            }\n        }\n    }\n}\n\n// common transform for dragging one end of an axis\n// d>0 is compressing scale (cursor is over the plot,\n//  the axis end should move with the cursor)\n// d<0 is expanding (cursor is off the plot, axis end moves\n//  nonlinearly so you can expand far)\nfunction dZoom(d) {\n    return 1 - ((d >= 0) ? Math.min(d, 0.9) :\n        1 / (1 / Math.max(d, -0.3) + 3.222));\n}\n\nfunction getDragCursor(nsew, dragmode, isMainDrag) {\n    if(!nsew) return 'pointer';\n    if(nsew === 'nsew') {\n        // in this case here, clear cursor and\n        // use the cursor style set on <g .draglayer>\n        if(isMainDrag) return '';\n        if(dragmode === 'pan') return 'move';\n        return 'crosshair';\n    }\n    return nsew.toLowerCase() + '-resize';\n}\n\nfunction makeZoombox(zoomlayer, lum, xs, ys, path0) {\n    return zoomlayer.append('path')\n        .attr('class', 'zoombox')\n        .style({\n            'fill': lum > 0.2 ? 'rgba(0,0,0,0)' : 'rgba(255,255,255,0)',\n            'stroke-width': 0\n        })\n        .attr('transform', strTranslate(xs, ys))\n        .attr('d', path0 + 'Z');\n}\n\nfunction makeCorners(zoomlayer, xs, ys) {\n    return zoomlayer.append('path')\n        .attr('class', 'zoombox-corners')\n        .style({\n            fill: Color.background,\n            stroke: Color.defaultLine,\n            'stroke-width': 1,\n            opacity: 0\n        })\n        .attr('transform', strTranslate(xs, ys))\n        .attr('d', 'M0,0Z');\n}\n\nfunction updateZoombox(zb, corners, box, path0, dimmed, lum) {\n    zb.attr('d',\n        path0 + 'M' + (box.l) + ',' + (box.t) + 'v' + (box.h) +\n        'h' + (box.w) + 'v-' + (box.h) + 'h-' + (box.w) + 'Z');\n    transitionZoombox(zb, corners, dimmed, lum);\n}\n\nfunction transitionZoombox(zb, corners, dimmed, lum) {\n    if(!dimmed) {\n        zb.transition()\n            .style('fill', lum > 0.2 ? 'rgba(0,0,0,0.4)' :\n                'rgba(255,255,255,0.3)')\n            .duration(200);\n        corners.transition()\n            .style('opacity', 1)\n            .duration(200);\n    }\n}\n\nfunction removeZoombox(gd) {\n    d3.select(gd)\n        .selectAll('.zoombox,.js-zoombox-backdrop,.js-zoombox-menu,.zoombox-corners')\n        .remove();\n}\n\nfunction showDoubleClickNotifier(gd) {\n    if(SHOWZOOMOUTTIP && gd.data && gd._context.showTips) {\n        Lib.notifier(Lib._(gd, 'Double-click to zoom back out'), 'long');\n        SHOWZOOMOUTTIP = false;\n    }\n}\n\nfunction xCorners(box, y0) {\n    return 'M' +\n        (box.l - 0.5) + ',' + (y0 - MINZOOM - 0.5) +\n        'h-3v' + (2 * MINZOOM + 1) + 'h3ZM' +\n        (box.r + 0.5) + ',' + (y0 - MINZOOM - 0.5) +\n        'h3v' + (2 * MINZOOM + 1) + 'h-3Z';\n}\n\nfunction yCorners(box, x0) {\n    return 'M' +\n        (x0 - MINZOOM - 0.5) + ',' + (box.t - 0.5) +\n        'v-3h' + (2 * MINZOOM + 1) + 'v3ZM' +\n        (x0 - MINZOOM - 0.5) + ',' + (box.b + 0.5) +\n        'v3h' + (2 * MINZOOM + 1) + 'v-3Z';\n}\n\nfunction xyCorners(box) {\n    var clen = Math.floor(Math.min(box.b - box.t, box.r - box.l, MINZOOM) / 2);\n    return 'M' +\n        (box.l - 3.5) + ',' + (box.t - 0.5 + clen) + 'h3v' + (-clen) +\n            'h' + clen + 'v-3h-' + (clen + 3) + 'ZM' +\n        (box.r + 3.5) + ',' + (box.t - 0.5 + clen) + 'h-3v' + (-clen) +\n            'h' + (-clen) + 'v-3h' + (clen + 3) + 'ZM' +\n        (box.r + 3.5) + ',' + (box.b + 0.5 - clen) + 'h-3v' + clen +\n            'h' + (-clen) + 'v3h' + (clen + 3) + 'ZM' +\n        (box.l - 3.5) + ',' + (box.b + 0.5 - clen) + 'h3v' + clen +\n            'h' + clen + 'v3h-' + (clen + 3) + 'Z';\n}\n\nfunction calcLinks(gd, groups, xaHash, yaHash, exclude) {\n    var isSubplotConstrained = false;\n    var xLinks = {};\n    var yLinks = {};\n    var xID, yID, xLinkID, yLinkID;\n    var xExclude = (exclude || {}).xaHash;\n    var yExclude = (exclude || {}).yaHash;\n\n    for(var i = 0; i < groups.length; i++) {\n        var group = groups[i];\n        // check if any of the x axes we're dragging is in this constraint group\n        for(xID in xaHash) {\n            if(group[xID]) {\n                // put the rest of these axes into xLinks, if we're not already\n                // dragging them, so we know to scale these axes automatically too\n                // to match the changes in the dragged x axes\n                for(xLinkID in group) {\n                    if(\n                        !(exclude && (xExclude[xLinkID] || yExclude[xLinkID])) &&\n                        !(xLinkID.charAt(0) === 'x' ? xaHash : yaHash)[xLinkID]\n                    ) {\n                        xLinks[xLinkID] = xID;\n                    }\n                }\n\n                // check if the x and y axes of THIS drag are linked\n                for(yID in yaHash) {\n                    if(\n                        !(exclude && (xExclude[yID] || yExclude[yID])) &&\n                        group[yID]\n                    ) {\n                        isSubplotConstrained = true;\n                    }\n                }\n            }\n        }\n\n        // now check if any of the y axes we're dragging is in this constraint group\n        // only look for outside links, as we've already checked for links within the dragger\n        for(yID in yaHash) {\n            if(group[yID]) {\n                for(yLinkID in group) {\n                    if(\n                        !(exclude && (xExclude[yLinkID] || yExclude[yLinkID])) &&\n                        !(yLinkID.charAt(0) === 'x' ? xaHash : yaHash)[yLinkID]\n                    ) {\n                        yLinks[yLinkID] = yID;\n                    }\n                }\n            }\n        }\n    }\n\n    if(isSubplotConstrained) {\n        // merge xLinks and yLinks if the subplot is constrained,\n        // since we'll always apply both anyway and the two will contain\n        // duplicates\n        Lib.extendFlat(xLinks, yLinks);\n        yLinks = {};\n    }\n\n    var xaHashLinked = {};\n    var xaxesLinked = [];\n    for(xLinkID in xLinks) {\n        var xa = getFromId(gd, xLinkID);\n        xaxesLinked.push(xa);\n        xaHashLinked[xa._id] = xa;\n    }\n\n    var yaHashLinked = {};\n    var yaxesLinked = [];\n    for(yLinkID in yLinks) {\n        var ya = getFromId(gd, yLinkID);\n        yaxesLinked.push(ya);\n        yaHashLinked[ya._id] = ya;\n    }\n\n    return {\n        xaHash: xaHashLinked,\n        yaHash: yaHashLinked,\n        xaxes: xaxesLinked,\n        yaxes: yaxesLinked,\n        xLinks: xLinks,\n        yLinks: yLinks,\n        isSubplotConstrained: isSubplotConstrained\n    };\n}\n\n// still seems to be some confusion about onwheel vs onmousewheel...\nfunction attachWheelEventHandler(element, handler) {\n    if(!supportsPassive) {\n        if(element.onwheel !== undefined) element.onwheel = handler;\n        else if(element.onmousewheel !== undefined) element.onmousewheel = handler;\n        else if(!element.isAddedWheelEvent) {\n            element.isAddedWheelEvent = true;\n            element.addEventListener('wheel', handler, {passive: false});\n        }\n    } else {\n        var wheelEventName = element.onwheel !== undefined ? 'wheel' : 'mousewheel';\n\n        if(element._onwheel) {\n            element.removeEventListener(wheelEventName, element._onwheel);\n        }\n        element._onwheel = handler;\n\n        element.addEventListener(wheelEventName, handler, {passive: false});\n    }\n}\n\nfunction hashValues(hash) {\n    var out = [];\n    for(var k in hash) out.push(hash[k]);\n    return out;\n}\n\nmodule.exports = {\n    makeDragBox: makeDragBox,\n\n    makeDragger: makeDragger,\n    makeRectDragger: makeRectDragger,\n    makeZoombox: makeZoombox,\n    makeCorners: makeCorners,\n\n    updateZoombox: updateZoombox,\n    xyCorners: xyCorners,\n    transitionZoombox: transitionZoombox,\n    removeZoombox: removeZoombox,\n    showDoubleClickNotifier: showDoubleClickNotifier,\n\n    attachWheelEventHandler: attachWheelEventHandler\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Fx = require('../../components/fx');\nvar dragElement = require('../../components/dragelement');\nvar setCursor = require('../../lib/setcursor');\n\nvar makeDragBox = require('./dragbox').makeDragBox;\nvar DRAGGERSIZE = require('./constants').DRAGGERSIZE;\n\nexports.initInteractions = function initInteractions(gd) {\n    var fullLayout = gd._fullLayout;\n\n    if(gd._context.staticPlot) {\n        // this sweeps up more than just cartesian drag elements...\n        d3.select(gd).selectAll('.drag').remove();\n        return;\n    }\n\n    if(!fullLayout._has('cartesian') && !fullLayout._has('splom')) return;\n\n    var subplots = Object.keys(fullLayout._plots || {}).sort(function(a, b) {\n        // sort overlays last, then by x axis number, then y axis number\n        if((fullLayout._plots[a].mainplot && true) ===\n            (fullLayout._plots[b].mainplot && true)) {\n            var aParts = a.split('y');\n            var bParts = b.split('y');\n            return (aParts[0] === bParts[0]) ?\n                (Number(aParts[1] || 1) - Number(bParts[1] || 1)) :\n                (Number(aParts[0] || 1) - Number(bParts[0] || 1));\n        }\n        return fullLayout._plots[a].mainplot ? 1 : -1;\n    });\n\n    subplots.forEach(function(subplot) {\n        var plotinfo = fullLayout._plots[subplot];\n        var xa = plotinfo.xaxis;\n        var ya = plotinfo.yaxis;\n\n        // main and corner draggers need not be repeated for\n        // overlaid subplots - these draggers drag them all\n        if(!plotinfo.mainplot) {\n            // main dragger goes over the grids and data, so we use its\n            // mousemove events for all data hover effects\n            var maindrag = makeDragBox(gd, plotinfo, xa._offset, ya._offset,\n                xa._length, ya._length, 'ns', 'ew');\n\n            maindrag.onmousemove = function(evt) {\n                // This is on `gd._fullLayout`, *not* fullLayout because the reference\n                // changes by the time this is called again.\n                gd._fullLayout._rehover = function() {\n                    if((gd._fullLayout._hoversubplot === subplot) && gd._fullLayout._plots[subplot]) {\n                        Fx.hover(gd, evt, subplot);\n                    }\n                };\n\n                Fx.hover(gd, evt, subplot);\n\n                // Note that we have *not* used the cached fullLayout variable here\n                // since that may be outdated when this is called as a callback later on\n                gd._fullLayout._lasthover = maindrag;\n                gd._fullLayout._hoversubplot = subplot;\n            };\n\n            /*\n             * IMPORTANT:\n             * We must check for the presence of the drag cover here.\n             * If we don't, a 'mouseout' event is triggered on the\n             * maindrag before each 'click' event, which has the effect\n             * of clearing the hoverdata; thus, cancelling the click event.\n             */\n            maindrag.onmouseout = function(evt) {\n                if(gd._dragging) return;\n\n                // When the mouse leaves this maindrag, unset the hovered subplot.\n                // This may cause problems if it leaves the subplot directly *onto*\n                // another subplot, but that's a tiny corner case at the moment.\n                gd._fullLayout._hoversubplot = null;\n\n                dragElement.unhover(gd, evt);\n            };\n\n            // corner draggers\n            if(gd._context.showAxisDragHandles) {\n                makeDragBox(gd, plotinfo, xa._offset - DRAGGERSIZE, ya._offset - DRAGGERSIZE,\n                    DRAGGERSIZE, DRAGGERSIZE, 'n', 'w');\n                makeDragBox(gd, plotinfo, xa._offset + xa._length, ya._offset - DRAGGERSIZE,\n                    DRAGGERSIZE, DRAGGERSIZE, 'n', 'e');\n                makeDragBox(gd, plotinfo, xa._offset - DRAGGERSIZE, ya._offset + ya._length,\n                    DRAGGERSIZE, DRAGGERSIZE, 's', 'w');\n                makeDragBox(gd, plotinfo, xa._offset + xa._length, ya._offset + ya._length,\n                    DRAGGERSIZE, DRAGGERSIZE, 's', 'e');\n            }\n        }\n        if(gd._context.showAxisDragHandles) {\n            // x axis draggers - if you have overlaid plots,\n            // these drag each axis separately\n            if(subplot === xa._mainSubplot) {\n                // the y position of the main x axis line\n                var y0 = xa._mainLinePosition;\n                if(xa.side === 'top') y0 -= DRAGGERSIZE;\n                makeDragBox(gd, plotinfo, xa._offset + xa._length * 0.1, y0,\n                    xa._length * 0.8, DRAGGERSIZE, '', 'ew');\n                makeDragBox(gd, plotinfo, xa._offset, y0,\n                    xa._length * 0.1, DRAGGERSIZE, '', 'w');\n                makeDragBox(gd, plotinfo, xa._offset + xa._length * 0.9, y0,\n                    xa._length * 0.1, DRAGGERSIZE, '', 'e');\n            }\n            // y axis draggers\n            if(subplot === ya._mainSubplot) {\n                // the x position of the main y axis line\n                var x0 = ya._mainLinePosition;\n                if(ya.side !== 'right') x0 -= DRAGGERSIZE;\n                makeDragBox(gd, plotinfo, x0, ya._offset + ya._length * 0.1,\n                    DRAGGERSIZE, ya._length * 0.8, 'ns', '');\n                makeDragBox(gd, plotinfo, x0, ya._offset + ya._length * 0.9,\n                    DRAGGERSIZE, ya._length * 0.1, 's', '');\n                makeDragBox(gd, plotinfo, x0, ya._offset,\n                    DRAGGERSIZE, ya._length * 0.1, 'n', '');\n            }\n        }\n    });\n\n    // In case you mousemove over some hovertext, send it to Fx.hover too\n    // we do this so that we can put the hover text in front of everything,\n    // but still be able to interact with everything as if it isn't there\n    var hoverLayer = fullLayout._hoverlayer.node();\n\n    hoverLayer.onmousemove = function(evt) {\n        evt.target = gd._fullLayout._lasthover;\n        Fx.hover(gd, evt, fullLayout._hoversubplot);\n    };\n\n    hoverLayer.onclick = function(evt) {\n        evt.target = gd._fullLayout._lasthover;\n        Fx.click(gd, evt);\n    };\n\n    // also delegate mousedowns... TODO: does this actually work?\n    hoverLayer.onmousedown = function(evt) {\n        gd._fullLayout._lasthover.onmousedown(evt);\n    };\n\n    exports.updateFx(gd);\n};\n\n// Minimal set of update needed on 'modebar' edits.\n// We only need to update the <g .draglayer> cursor style.\n//\n// Note that changing the axis configuration and/or the fixedrange attribute\n// should trigger a full initInteractions.\nexports.updateFx = function(gd) {\n    var fullLayout = gd._fullLayout;\n    var cursor = fullLayout.dragmode === 'pan' ? 'move' : 'crosshair';\n    setCursor(fullLayout._draggers, cursor);\n};\n","'use strict';\n\nfunction clearOutlineControllers(gd) {\n    var zoomLayer = gd._fullLayout._zoomlayer;\n    if(zoomLayer) {\n        zoomLayer.selectAll('.outline-controllers').remove();\n    }\n}\n\nfunction clearSelect(gd) {\n    var zoomLayer = gd._fullLayout._zoomlayer;\n    if(zoomLayer) {\n        // until we get around to persistent selections, remove the outline\n        // here. The selection itself will be removed when the plot redraws\n        // at the end.\n        zoomLayer.selectAll('.select-outline').remove();\n    }\n\n    gd._fullLayout._drawing = false;\n}\n\nmodule.exports = {\n    clearOutlineControllers: clearOutlineControllers,\n    clearSelect: clearSelect\n};\n","'use strict';\n\nvar strTranslate = require('../../lib').strTranslate;\n\n// in v3 (once log ranges are fixed),\n// we'll be able to p2r here for all axis types\nfunction p2r(ax, v) {\n    switch(ax.type) {\n        case 'log':\n            return ax.p2d(v);\n        case 'date':\n            return ax.p2r(v, 0, ax.calendar);\n        default:\n            return ax.p2r(v);\n    }\n}\n\nfunction r2p(ax, v) {\n    switch(ax.type) {\n        case 'log':\n            return ax.d2p(v);\n        case 'date':\n            return ax.r2p(v, 0, ax.calendar);\n        default:\n            return ax.r2p(v);\n    }\n}\n\nfunction axValue(ax) {\n    var index = (ax._id.charAt(0) === 'y') ? 1 : 0;\n    return function(v) { return p2r(ax, v[index]); };\n}\n\nfunction getTransform(plotinfo) {\n    return strTranslate(\n        plotinfo.xaxis._offset,\n        plotinfo.yaxis._offset\n    );\n}\n\nmodule.exports = {\n    p2r: p2r,\n    r2p: r2p,\n    axValue: axValue,\n    getTransform: getTransform\n};\n","'use strict';\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar axisIds = require('./axis_ids');\n\n/**\n * Factory function for checking component arrays for subplot references.\n *\n * @param {string} containerArrayName: the top-level array in gd.layout to check\n *   If an item in this container is found that references a cartesian x and/or y axis,\n *   ensure cartesian is marked as a base plot module and record the axes (and subplot\n *   if both refs are axes) in gd._fullLayout\n *\n * @return {function}: with args layoutIn (gd.layout) and layoutOut (gd._fullLayout)\n * as expected of a component includeBasePlot method\n */\nmodule.exports = function makeIncludeComponents(containerArrayName) {\n    return function includeComponents(layoutIn, layoutOut) {\n        var array = layoutIn[containerArrayName];\n        if(!Array.isArray(array)) return;\n\n        var Cartesian = Registry.subplotsRegistry.cartesian;\n        var idRegex = Cartesian.idRegex;\n        var subplots = layoutOut._subplots;\n        var xaList = subplots.xaxis;\n        var yaList = subplots.yaxis;\n        var cartesianList = subplots.cartesian;\n        var hasCartesianOrGL2D = layoutOut._has('cartesian') || layoutOut._has('gl2d');\n\n        for(var i = 0; i < array.length; i++) {\n            var itemi = array[i];\n            if(!Lib.isPlainObject(itemi)) continue;\n\n            // call cleanId because if xref, or yref has something appended\n            // (e.g., ' domain') this will get removed.\n            var xref = axisIds.cleanId(itemi.xref, 'x', false);\n            var yref = axisIds.cleanId(itemi.yref, 'y', false);\n\n            var hasXref = idRegex.x.test(xref);\n            var hasYref = idRegex.y.test(yref);\n            if(hasXref || hasYref) {\n                if(!hasCartesianOrGL2D) Lib.pushUnique(layoutOut._basePlotModules, Cartesian);\n\n                var newAxis = false;\n                if(hasXref && xaList.indexOf(xref) === -1) {\n                    xaList.push(xref);\n                    newAxis = true;\n                }\n                if(hasYref && yaList.indexOf(yref) === -1) {\n                    yaList.push(yref);\n                    newAxis = true;\n                }\n\n                /*\n                 * Notice the logic here: only add a subplot for a component if\n                 * it's referencing both x and y axes AND it's creating a new axis\n                 * so for example if your plot already has xy and x2y2, an annotation\n                 * on x2y or xy2 will not create a new subplot.\n                 */\n                if(newAxis && hasXref && hasYref) {\n                    cartesianList.push(xref + yref);\n                }\n            }\n        }\n    };\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar Plots = require('../plots');\nvar Drawing = require('../../components/drawing');\n\nvar getModuleCalcData = require('../get_data').getModuleCalcData;\nvar axisIds = require('./axis_ids');\nvar constants = require('./constants');\nvar xmlnsNamespaces = require('../../constants/xmlns_namespaces');\n\nvar ensureSingle = Lib.ensureSingle;\n\nfunction ensureSingleAndAddDatum(parent, nodeType, className) {\n    return Lib.ensureSingle(parent, nodeType, className, function(s) {\n        s.datum(className);\n    });\n}\n\nexports.name = 'cartesian';\n\nexports.attr = ['xaxis', 'yaxis'];\n\nexports.idRoot = ['x', 'y'];\n\nexports.idRegex = constants.idRegex;\n\nexports.attrRegex = constants.attrRegex;\n\nexports.attributes = require('./attributes');\n\nexports.layoutAttributes = require('./layout_attributes');\n\nexports.supplyLayoutDefaults = require('./layout_defaults');\n\nexports.transitionAxes = require('./transition_axes');\n\nexports.finalizeSubplots = function(layoutIn, layoutOut) {\n    var subplots = layoutOut._subplots;\n    var xList = subplots.xaxis;\n    var yList = subplots.yaxis;\n    var spSVG = subplots.cartesian;\n    var spAll = spSVG.concat(subplots.gl2d || []);\n    var allX = {};\n    var allY = {};\n    var i, xi, yi;\n\n    for(i = 0; i < spAll.length; i++) {\n        var parts = spAll[i].split('y');\n        allX[parts[0]] = 1;\n        allY['y' + parts[1]] = 1;\n    }\n\n    // check for x axes with no subplot, and make one from the anchor of that x axis\n    for(i = 0; i < xList.length; i++) {\n        xi = xList[i];\n        if(!allX[xi]) {\n            yi = (layoutIn[axisIds.id2name(xi)] || {}).anchor;\n            if(!constants.idRegex.y.test(yi)) yi = 'y';\n            spSVG.push(xi + yi);\n            spAll.push(xi + yi);\n\n            if(!allY[yi]) {\n                allY[yi] = 1;\n                Lib.pushUnique(yList, yi);\n            }\n        }\n    }\n\n    // same for y axes with no subplot\n    for(i = 0; i < yList.length; i++) {\n        yi = yList[i];\n        if(!allY[yi]) {\n            xi = (layoutIn[axisIds.id2name(yi)] || {}).anchor;\n            if(!constants.idRegex.x.test(xi)) xi = 'x';\n            spSVG.push(xi + yi);\n            spAll.push(xi + yi);\n\n            if(!allX[xi]) {\n                allX[xi] = 1;\n                Lib.pushUnique(xList, xi);\n            }\n        }\n    }\n\n    // finally, if we've gotten here we're supposed to show cartesian...\n    // so if there are NO subplots at all, make one from the first\n    // x & y axes in the input layout\n    if(!spAll.length) {\n        xi = '';\n        yi = '';\n        for(var ki in layoutIn) {\n            if(constants.attrRegex.test(ki)) {\n                var axLetter = ki.charAt(0);\n                if(axLetter === 'x') {\n                    if(!xi || (+ki.substr(5) < +xi.substr(5))) {\n                        xi = ki;\n                    }\n                } else if(!yi || (+ki.substr(5) < +yi.substr(5))) {\n                    yi = ki;\n                }\n            }\n        }\n        xi = xi ? axisIds.name2id(xi) : 'x';\n        yi = yi ? axisIds.name2id(yi) : 'y';\n        xList.push(xi);\n        yList.push(yi);\n        spSVG.push(xi + yi);\n    }\n};\n\n/**\n * Cartesian.plot\n *\n * @param {DOM div | object} gd\n * @param {array (optional)} traces\n *  array of traces indices to plot\n *  if undefined, plots all cartesian traces,\n * @param {object} (optional) transitionOpts\n *  transition option object\n * @param {function} (optional) makeOnCompleteCallback\n *  transition make callback function from Plots.transition\n */\nexports.plot = function(gd, traces, transitionOpts, makeOnCompleteCallback) {\n    var fullLayout = gd._fullLayout;\n    var subplots = fullLayout._subplots.cartesian;\n    var calcdata = gd.calcdata;\n    var i;\n\n    if(!Array.isArray(traces)) {\n        // If traces is not provided, then it's a complete replot and missing\n        // traces are removed\n        traces = [];\n        for(i = 0; i < calcdata.length; i++) traces.push(i);\n    }\n\n    for(i = 0; i < subplots.length; i++) {\n        var subplot = subplots[i];\n        var subplotInfo = fullLayout._plots[subplot];\n\n        // Get all calcdata for this subplot:\n        var cdSubplot = [];\n        var pcd;\n\n        for(var j = 0; j < calcdata.length; j++) {\n            var cd = calcdata[j];\n            var trace = cd[0].trace;\n\n            // Skip trace if whitelist provided and it's not whitelisted:\n            // if (Array.isArray(traces) && traces.indexOf(i) === -1) continue;\n            if(trace.xaxis + trace.yaxis === subplot) {\n                // XXX: Should trace carpet dependencies. Only replot all carpet plots if the carpet\n                // axis has actually changed:\n                //\n                // If this trace is specifically requested, add it to the list:\n                if(traces.indexOf(trace.index) !== -1 || trace.carpet) {\n                    // Okay, so example: traces 0, 1, and 2 have fill = tonext. You animate\n                    // traces 0 and 2. Trace 1 also needs to be updated, otherwise its fill\n                    // is outdated. So this retroactively adds the previous trace if the\n                    // traces are interdependent.\n                    if(\n                        pcd &&\n                        pcd[0].trace.xaxis + pcd[0].trace.yaxis === subplot &&\n                        ['tonextx', 'tonexty', 'tonext'].indexOf(trace.fill) !== -1 &&\n                        cdSubplot.indexOf(pcd) === -1\n                    ) {\n                        cdSubplot.push(pcd);\n                    }\n\n                    cdSubplot.push(cd);\n                }\n\n                // Track the previous trace on this subplot for the retroactive-add step\n                // above:\n                pcd = cd;\n            }\n        }\n\n        plotOne(gd, subplotInfo, cdSubplot, transitionOpts, makeOnCompleteCallback);\n    }\n};\n\nfunction plotOne(gd, plotinfo, cdSubplot, transitionOpts, makeOnCompleteCallback) {\n    var traceLayerClasses = constants.traceLayerClasses;\n    var fullLayout = gd._fullLayout;\n    var modules = fullLayout._modules;\n    var _module, cdModuleAndOthers, cdModule;\n\n    var layerData = [];\n    var zoomScaleQueryParts = [];\n\n    for(var i = 0; i < modules.length; i++) {\n        _module = modules[i];\n        var name = _module.name;\n        var categories = Registry.modules[name].categories;\n\n        if(categories.svg) {\n            var className = (_module.layerName || name + 'layer');\n            var plotMethod = _module.plot;\n\n            // plot all visible traces of this type on this subplot at once\n            cdModuleAndOthers = getModuleCalcData(cdSubplot, plotMethod);\n            cdModule = cdModuleAndOthers[0];\n            // don't need to search the found traces again - in fact we need to NOT\n            // so that if two modules share the same plotter we don't double-plot\n            cdSubplot = cdModuleAndOthers[1];\n\n            if(cdModule.length) {\n                layerData.push({\n                    i: traceLayerClasses.indexOf(className),\n                    className: className,\n                    plotMethod: plotMethod,\n                    cdModule: cdModule\n                });\n            }\n\n            if(categories.zoomScale) {\n                zoomScaleQueryParts.push('.' + className);\n            }\n        }\n    }\n\n    layerData.sort(function(a, b) { return a.i - b.i; });\n\n    var layers = plotinfo.plot.selectAll('g.mlayer')\n        .data(layerData, function(d) { return d.className; });\n\n    layers.enter().append('g')\n        .attr('class', function(d) { return d.className; })\n        .classed('mlayer', true)\n        .classed('rangeplot', plotinfo.isRangePlot);\n\n    layers.exit().remove();\n\n    layers.order();\n\n    layers.each(function(d) {\n        var sel = d3.select(this);\n        var className = d.className;\n\n        d.plotMethod(\n            gd, plotinfo, d.cdModule, sel,\n            transitionOpts, makeOnCompleteCallback\n        );\n\n        // layers that allow `cliponaxis: false`\n        if(constants.clipOnAxisFalseQuery.indexOf('.' + className) === -1) {\n            Drawing.setClipUrl(sel, plotinfo.layerClipId, gd);\n        }\n    });\n\n    // call Scattergl.plot separately\n    if(fullLayout._has('scattergl')) {\n        _module = Registry.getModule('scattergl');\n        cdModule = getModuleCalcData(cdSubplot, _module)[0];\n        _module.plot(gd, plotinfo, cdModule);\n    }\n\n    // stash \"hot\" selections for faster interaction on drag and scroll\n    if(!gd._context.staticPlot) {\n        if(plotinfo._hasClipOnAxisFalse) {\n            plotinfo.clipOnAxisFalseTraces = plotinfo.plot\n                .selectAll(constants.clipOnAxisFalseQuery.join(','))\n                .selectAll('.trace');\n        }\n\n        if(zoomScaleQueryParts.length) {\n            var traces = plotinfo.plot\n                .selectAll(zoomScaleQueryParts.join(','))\n                .selectAll('.trace');\n\n            plotinfo.zoomScalePts = traces.selectAll('path.point');\n            plotinfo.zoomScaleTxt = traces.selectAll('.textpoint');\n        }\n    }\n}\n\nexports.clean = function(newFullData, newFullLayout, oldFullData, oldFullLayout) {\n    var oldPlots = oldFullLayout._plots || {};\n    var newPlots = newFullLayout._plots || {};\n    var oldSubplotList = oldFullLayout._subplots || {};\n    var plotinfo;\n    var i, k;\n\n    // when going from a large splom graph to something else,\n    // we need to clear <g subplot> so that the new cartesian subplot\n    // can have the correct layer ordering\n    if(oldFullLayout._hasOnlyLargeSploms && !newFullLayout._hasOnlyLargeSploms) {\n        for(k in oldPlots) {\n            plotinfo = oldPlots[k];\n            if(plotinfo.plotgroup) plotinfo.plotgroup.remove();\n        }\n    }\n\n    var hadGl = (oldFullLayout._has && oldFullLayout._has('gl'));\n    var hasGl = (newFullLayout._has && newFullLayout._has('gl'));\n\n    if(hadGl && !hasGl) {\n        for(k in oldPlots) {\n            plotinfo = oldPlots[k];\n            if(plotinfo._scene) plotinfo._scene.destroy();\n        }\n    }\n\n    // delete any titles we don't need anymore\n    // check if axis list has changed, and if so clear old titles\n    if(oldSubplotList.xaxis && oldSubplotList.yaxis) {\n        var oldAxIDs = axisIds.listIds({_fullLayout: oldFullLayout});\n        for(i = 0; i < oldAxIDs.length; i++) {\n            var oldAxId = oldAxIDs[i];\n            if(!newFullLayout[axisIds.id2name(oldAxId)]) {\n                oldFullLayout._infolayer.selectAll('.g-' + oldAxId + 'title').remove();\n            }\n        }\n    }\n\n    var hadCartesian = (oldFullLayout._has && oldFullLayout._has('cartesian'));\n    var hasCartesian = (newFullLayout._has && newFullLayout._has('cartesian'));\n\n    if(hadCartesian && !hasCartesian) {\n        // if we've gotten rid of all cartesian traces, remove all the subplot svg items\n\n        purgeSubplotLayers(oldFullLayout._cartesianlayer.selectAll('.subplot'), oldFullLayout);\n        oldFullLayout._defs.selectAll('.axesclip').remove();\n        delete oldFullLayout._axisConstraintGroups;\n        delete oldFullLayout._axisMatchGroups;\n    } else if(oldSubplotList.cartesian) {\n        // otherwise look for subplots we need to remove\n\n        for(i = 0; i < oldSubplotList.cartesian.length; i++) {\n            var oldSubplotId = oldSubplotList.cartesian[i];\n            if(!newPlots[oldSubplotId]) {\n                var selector = '.' + oldSubplotId + ',.' + oldSubplotId + '-x,.' + oldSubplotId + '-y';\n                oldFullLayout._cartesianlayer.selectAll(selector).remove();\n                removeSubplotExtras(oldSubplotId, oldFullLayout);\n            }\n        }\n    }\n};\n\nexports.drawFramework = function(gd) {\n    var fullLayout = gd._fullLayout;\n    var subplotData = makeSubplotData(gd);\n\n    var subplotLayers = fullLayout._cartesianlayer.selectAll('.subplot')\n        .data(subplotData, String);\n\n    subplotLayers.enter().append('g')\n        .attr('class', function(d) { return 'subplot ' + d[0]; });\n\n    subplotLayers.order();\n\n    subplotLayers.exit()\n        .call(purgeSubplotLayers, fullLayout);\n\n    subplotLayers.each(function(d) {\n        var id = d[0];\n        var plotinfo = fullLayout._plots[id];\n\n        plotinfo.plotgroup = d3.select(this);\n        makeSubplotLayer(gd, plotinfo);\n\n        // make separate drag layers for each subplot,\n        // but append them to paper rather than the plot groups,\n        // so they end up on top of the rest\n        plotinfo.draglayer = ensureSingle(fullLayout._draggers, 'g', id);\n    });\n};\n\nexports.rangePlot = function(gd, plotinfo, cdSubplot) {\n    makeSubplotLayer(gd, plotinfo);\n    plotOne(gd, plotinfo, cdSubplot);\n    Plots.style(gd);\n};\n\nfunction makeSubplotData(gd) {\n    var fullLayout = gd._fullLayout;\n    var ids = fullLayout._subplots.cartesian;\n    var len = ids.length;\n    var i, j, id, plotinfo, xa, ya;\n\n    // split 'regular' and 'overlaying' subplots\n    var regulars = [];\n    var overlays = [];\n\n    for(i = 0; i < len; i++) {\n        id = ids[i];\n        plotinfo = fullLayout._plots[id];\n        xa = plotinfo.xaxis;\n        ya = plotinfo.yaxis;\n\n        var xa2 = xa._mainAxis;\n        var ya2 = ya._mainAxis;\n        var mainplot = xa2._id + ya2._id;\n        var mainplotinfo = fullLayout._plots[mainplot];\n        plotinfo.overlays = [];\n\n        if(mainplot !== id && mainplotinfo) {\n            plotinfo.mainplot = mainplot;\n            plotinfo.mainplotinfo = mainplotinfo;\n            overlays.push(id);\n        } else {\n            plotinfo.mainplot = undefined;\n            plotinfo.mainplotinfo = undefined;\n            regulars.push(id);\n        }\n    }\n\n    // fill in list of overlaying subplots in 'main plot'\n    for(i = 0; i < overlays.length; i++) {\n        id = overlays[i];\n        plotinfo = fullLayout._plots[id];\n        plotinfo.mainplotinfo.overlays.push(plotinfo);\n    }\n\n    // put 'regular' subplot data before 'overlaying'\n    var subplotIds = regulars.concat(overlays);\n    var subplotData = new Array(len);\n\n    for(i = 0; i < len; i++) {\n        id = subplotIds[i];\n        plotinfo = fullLayout._plots[id];\n        xa = plotinfo.xaxis;\n        ya = plotinfo.yaxis;\n\n        // use info about axis layer and overlaying pattern\n        // to clean what need to be cleaned up in exit selection\n        var d = [id, xa.layer, ya.layer, xa.overlaying || '', ya.overlaying || ''];\n        for(j = 0; j < plotinfo.overlays.length; j++) {\n            d.push(plotinfo.overlays[j].id);\n        }\n        subplotData[i] = d;\n    }\n\n    return subplotData;\n}\n\nfunction makeSubplotLayer(gd, plotinfo) {\n    var plotgroup = plotinfo.plotgroup;\n    var id = plotinfo.id;\n    var xLayer = constants.layerValue2layerClass[plotinfo.xaxis.layer];\n    var yLayer = constants.layerValue2layerClass[plotinfo.yaxis.layer];\n    var hasOnlyLargeSploms = gd._fullLayout._hasOnlyLargeSploms;\n\n    if(!plotinfo.mainplot) {\n        if(hasOnlyLargeSploms) {\n            // TODO could do even better\n            // - we don't need plot (but we would have to mock it in lsInner\n            //   and other places\n            // - we don't (x|y)lines and (x|y)axislayer for most subplots\n            //   usually just the bottom x and left y axes.\n            plotinfo.xlines = ensureSingle(plotgroup, 'path', 'xlines-above');\n            plotinfo.ylines = ensureSingle(plotgroup, 'path', 'ylines-above');\n            plotinfo.xaxislayer = ensureSingle(plotgroup, 'g', 'xaxislayer-above');\n            plotinfo.yaxislayer = ensureSingle(plotgroup, 'g', 'yaxislayer-above');\n        } else {\n            var backLayer = ensureSingle(plotgroup, 'g', 'layer-subplot');\n            plotinfo.shapelayer = ensureSingle(backLayer, 'g', 'shapelayer');\n            plotinfo.imagelayer = ensureSingle(backLayer, 'g', 'imagelayer');\n\n            plotinfo.gridlayer = ensureSingle(plotgroup, 'g', 'gridlayer');\n            plotinfo.zerolinelayer = ensureSingle(plotgroup, 'g', 'zerolinelayer');\n\n            ensureSingle(plotgroup, 'path', 'xlines-below');\n            ensureSingle(plotgroup, 'path', 'ylines-below');\n            plotinfo.overlinesBelow = ensureSingle(plotgroup, 'g', 'overlines-below');\n\n            ensureSingle(plotgroup, 'g', 'xaxislayer-below');\n            ensureSingle(plotgroup, 'g', 'yaxislayer-below');\n            plotinfo.overaxesBelow = ensureSingle(plotgroup, 'g', 'overaxes-below');\n\n            plotinfo.plot = ensureSingle(plotgroup, 'g', 'plot');\n            plotinfo.overplot = ensureSingle(plotgroup, 'g', 'overplot');\n\n            plotinfo.xlines = ensureSingle(plotgroup, 'path', 'xlines-above');\n            plotinfo.ylines = ensureSingle(plotgroup, 'path', 'ylines-above');\n            plotinfo.overlinesAbove = ensureSingle(plotgroup, 'g', 'overlines-above');\n\n            ensureSingle(plotgroup, 'g', 'xaxislayer-above');\n            ensureSingle(plotgroup, 'g', 'yaxislayer-above');\n            plotinfo.overaxesAbove = ensureSingle(plotgroup, 'g', 'overaxes-above');\n\n            // set refs to correct layers as determined by 'axis.layer'\n            plotinfo.xlines = plotgroup.select('.xlines-' + xLayer);\n            plotinfo.ylines = plotgroup.select('.ylines-' + yLayer);\n            plotinfo.xaxislayer = plotgroup.select('.xaxislayer-' + xLayer);\n            plotinfo.yaxislayer = plotgroup.select('.yaxislayer-' + yLayer);\n        }\n    } else {\n        var mainplotinfo = plotinfo.mainplotinfo;\n        var mainplotgroup = mainplotinfo.plotgroup;\n        var xId = id + '-x';\n        var yId = id + '-y';\n\n        // now make the components of overlaid subplots\n        // overlays don't have backgrounds, and append all\n        // their other components to the corresponding\n        // extra groups of their main plots.\n\n        plotinfo.gridlayer = mainplotinfo.gridlayer;\n        plotinfo.zerolinelayer = mainplotinfo.zerolinelayer;\n\n        ensureSingle(mainplotinfo.overlinesBelow, 'path', xId);\n        ensureSingle(mainplotinfo.overlinesBelow, 'path', yId);\n        ensureSingle(mainplotinfo.overaxesBelow, 'g', xId);\n        ensureSingle(mainplotinfo.overaxesBelow, 'g', yId);\n\n        plotinfo.plot = ensureSingle(mainplotinfo.overplot, 'g', id);\n\n        ensureSingle(mainplotinfo.overlinesAbove, 'path', xId);\n        ensureSingle(mainplotinfo.overlinesAbove, 'path', yId);\n        ensureSingle(mainplotinfo.overaxesAbove, 'g', xId);\n        ensureSingle(mainplotinfo.overaxesAbove, 'g', yId);\n\n        // set refs to correct layers as determined by 'abovetraces'\n        plotinfo.xlines = mainplotgroup.select('.overlines-' + xLayer).select('.' + xId);\n        plotinfo.ylines = mainplotgroup.select('.overlines-' + yLayer).select('.' + yId);\n        plotinfo.xaxislayer = mainplotgroup.select('.overaxes-' + xLayer).select('.' + xId);\n        plotinfo.yaxislayer = mainplotgroup.select('.overaxes-' + yLayer).select('.' + yId);\n    }\n\n    // common attributes for all subplots, overlays or not\n\n    if(!hasOnlyLargeSploms) {\n        ensureSingleAndAddDatum(plotinfo.gridlayer, 'g', plotinfo.xaxis._id);\n        ensureSingleAndAddDatum(plotinfo.gridlayer, 'g', plotinfo.yaxis._id);\n        plotinfo.gridlayer.selectAll('g')\n            .map(function(d) { return d[0]; })\n            .sort(axisIds.idSort);\n    }\n\n    plotinfo.xlines\n        .style('fill', 'none')\n        .classed('crisp', true);\n\n    plotinfo.ylines\n        .style('fill', 'none')\n        .classed('crisp', true);\n}\n\nfunction purgeSubplotLayers(layers, fullLayout) {\n    if(!layers) return;\n\n    var overlayIdsToRemove = {};\n\n    layers.each(function(d) {\n        var id = d[0];\n        var plotgroup = d3.select(this);\n\n        plotgroup.remove();\n        removeSubplotExtras(id, fullLayout);\n        overlayIdsToRemove[id] = true;\n\n        // do not remove individual axis <clipPath>s here\n        // as other subplots may need them\n    });\n\n    // must remove overlaid subplot trace layers 'manually'\n\n    for(var k in fullLayout._plots) {\n        var subplotInfo = fullLayout._plots[k];\n        var overlays = subplotInfo.overlays || [];\n\n        for(var j = 0; j < overlays.length; j++) {\n            var overlayInfo = overlays[j];\n\n            if(overlayIdsToRemove[overlayInfo.id]) {\n                overlayInfo.plot.selectAll('.trace').remove();\n            }\n        }\n    }\n}\n\nfunction removeSubplotExtras(subplotId, fullLayout) {\n    fullLayout._draggers.selectAll('g.' + subplotId).remove();\n    fullLayout._defs.select('#clip' + fullLayout._uid + subplotId + 'plot').remove();\n}\n\nexports.toSVG = function(gd) {\n    var imageRoot = gd._fullLayout._glimages;\n    var root = d3.select(gd).selectAll('.svg-container');\n    var canvases = root.filter(function(d, i) {return i === root.size() - 1;})\n        .selectAll('.gl-canvas-context, .gl-canvas-focus');\n\n    function canvasToImage() {\n        var canvas = this;\n        var imageData = canvas.toDataURL('image/png');\n        var image = imageRoot.append('svg:image');\n\n        image.attr({\n            xmlns: xmlnsNamespaces.svg,\n            'xlink:href': imageData,\n            preserveAspectRatio: 'none',\n            x: 0,\n            y: 0,\n            width: canvas.width,\n            height: canvas.height\n        });\n    }\n\n    canvases.each(canvasToImage);\n};\n\nexports.updateFx = require('./graph_interact').updateFx;\n","'use strict';\n\nvar fontAttrs = require('../font_attributes');\nvar colorAttrs = require('../../components/color/attributes');\nvar dash = require('../../components/drawing/attributes').dash;\nvar extendFlat = require('../../lib/extend').extendFlat;\nvar templatedArray = require('../../plot_api/plot_template').templatedArray;\nvar descriptionWithDates = require('../../plots/cartesian/axis_format_attributes').descriptionWithDates;\n\nvar ONEDAY = require('../../constants/numerical').ONEDAY;\nvar constants = require('./constants');\nvar HOUR = constants.HOUR_PATTERN;\nvar DAY_OF_WEEK = constants.WEEKDAY_PATTERN;\n\nmodule.exports = {\n    visible: {\n        valType: 'boolean',\n        editType: 'plot',\n        description: [\n            'A single toggle to hide the axis while preserving interaction like dragging.',\n            'Default is true when a cheater plot is present on the axis, otherwise',\n            'false'\n        ].join(' ')\n    },\n    color: {\n        valType: 'color',\n        dflt: colorAttrs.defaultLine,\n        editType: 'ticks',\n        description: [\n            'Sets default for all colors associated with this axis',\n            'all at once: line, font, tick, and grid colors.',\n            'Grid color is lightened by blending this with the plot background',\n            'Individual pieces can override this.'\n        ].join(' ')\n    },\n    title: {\n        text: {\n            valType: 'string',\n            editType: 'ticks',\n            description: [\n                'Sets the title of this axis.',\n                'Note that before the existence of `title.text`, the title\\'s',\n                'contents used to be defined as the `title` attribute itself.',\n                'This behavior has been deprecated.'\n            ].join(' ')\n        },\n        font: fontAttrs({\n            editType: 'ticks',\n            description: [\n                'Sets this axis\\' title font.',\n                'Note that the title\\'s font used to be customized',\n                'by the now deprecated `titlefont` attribute.'\n            ].join(' ')\n        }),\n        standoff: {\n            valType: 'number',\n            min: 0,\n            editType: 'ticks',\n            description: [\n                'Sets the standoff distance (in px) between the axis labels and the title text',\n                'The default value is a function of the axis tick labels, the title `font.size`',\n                'and the axis `linewidth`.',\n                'Note that the axis title position is always constrained within the margins,',\n                'so the actual standoff distance is always less than the set or default value.',\n                'By setting `standoff` and turning on `automargin`, plotly.js will push the',\n                'margins to fit the axis title at given standoff distance.'\n            ].join(' ')\n        },\n        editType: 'ticks'\n    },\n    type: {\n        valType: 'enumerated',\n        // '-' means we haven't yet run autotype or couldn't find any data\n        // it gets turned into linear in gd._fullLayout but not copied back\n        // to gd.data like the others are.\n        values: ['-', 'linear', 'log', 'date', 'category', 'multicategory'],\n        dflt: '-',\n        editType: 'calc',\n        // we forget when an axis has been autotyped, just writing the auto\n        // value back to the input - so it doesn't make sense to template this.\n        // Note: we do NOT prohibit this in `coerce`, so if someone enters a\n        // type in the template explicitly it will be honored as the default.\n        _noTemplating: true,\n        description: [\n            'Sets the axis type.',\n            'By default, plotly attempts to determined the axis type',\n            'by looking into the data of the traces that referenced',\n            'the axis in question.'\n        ].join(' ')\n    },\n    autotypenumbers: {\n        valType: 'enumerated',\n        values: ['convert types', 'strict'],\n        dflt: 'convert types',\n        editType: 'calc',\n        description: [\n            'Using *strict* a numeric string in trace data is not converted to a number.',\n            'Using *convert types* a numeric string in trace data may be',\n            'treated as a number during automatic axis `type` detection.',\n            'Defaults to layout.autotypenumbers.'\n        ].join(' ')\n    },\n    autorange: {\n        valType: 'enumerated',\n        values: [true, false, 'reversed'],\n        dflt: true,\n        editType: 'axrange',\n        impliedEdits: {'range[0]': undefined, 'range[1]': undefined},\n        description: [\n            'Determines whether or not the range of this axis is',\n            'computed in relation to the input data.',\n            'See `rangemode` for more info.',\n            'If `range` is provided, then `autorange` is set to *false*.'\n        ].join(' ')\n    },\n    rangemode: {\n        valType: 'enumerated',\n        values: ['normal', 'tozero', 'nonnegative'],\n        dflt: 'normal',\n        editType: 'plot',\n        description: [\n            'If *normal*, the range is computed in relation to the extrema',\n            'of the input data.',\n            'If *tozero*`, the range extends to 0,',\n            'regardless of the input data',\n            'If *nonnegative*, the range is non-negative,',\n            'regardless of the input data.',\n            'Applies only to linear axes.'\n        ].join(' ')\n    },\n    range: {\n        valType: 'info_array',\n        items: [\n            {valType: 'any', editType: 'axrange', impliedEdits: {'^autorange': false}, anim: true},\n            {valType: 'any', editType: 'axrange', impliedEdits: {'^autorange': false}, anim: true}\n        ],\n        editType: 'axrange',\n        impliedEdits: {'autorange': false},\n        anim: true,\n        description: [\n            'Sets the range of this axis.',\n            'If the axis `type` is *log*, then you must take the log of your',\n            'desired range (e.g. to set the range from 1 to 100,',\n            'set the range from 0 to 2).',\n            'If the axis `type` is *date*, it should be date strings,',\n            'like date data, though Date objects and unix milliseconds',\n            'will be accepted and converted to strings.',\n            'If the axis `type` is *category*, it should be numbers,',\n            'using the scale where each category is assigned a serial',\n            'number from zero in the order it appears.'\n        ].join(' ')\n    },\n    fixedrange: {\n        valType: 'boolean',\n        dflt: false,\n        editType: 'calc',\n        description: [\n            'Determines whether or not this axis is zoom-able.',\n            'If true, then zoom is disabled.'\n        ].join(' ')\n    },\n    // scaleanchor: not used directly, just put here for reference\n    // values are any opposite-letter axis id\n    scaleanchor: {\n        valType: 'enumerated',\n        values: [\n            constants.idRegex.x.toString(),\n            constants.idRegex.y.toString()\n        ],\n        editType: 'plot',\n        description: [\n            'If set to another axis id (e.g. `x2`, `y`), the range of this axis',\n            'changes together with the range of the corresponding axis',\n            'such that the scale of pixels per unit is in a constant ratio.',\n            'Both axes are still zoomable, but when you zoom one, the other will',\n            'zoom the same amount, keeping a fixed midpoint.',\n            '`constrain` and `constraintoward` determine how we enforce the constraint.',\n            'You can chain these, ie `yaxis: {scaleanchor: *x*}, xaxis2: {scaleanchor: *y*}`',\n            'but you can only link axes of the same `type`.',\n            'The linked axis can have the opposite letter (to constrain the aspect ratio)',\n            'or the same letter (to match scales across subplots).',\n            'Loops (`yaxis: {scaleanchor: *x*}, xaxis: {scaleanchor: *y*}` or longer) are redundant',\n            'and the last constraint encountered will be ignored to avoid possible',\n            'inconsistent constraints via `scaleratio`.',\n            'Note that setting axes simultaneously in both a `scaleanchor` and a `matches` constraint',\n            'is currently forbidden.'\n        ].join(' ')\n    },\n    scaleratio: {\n        valType: 'number',\n        min: 0,\n        dflt: 1,\n        editType: 'plot',\n        description: [\n            'If this axis is linked to another by `scaleanchor`, this determines the pixel',\n            'to unit scale ratio. For example, if this value is 10, then every unit on',\n            'this axis spans 10 times the number of pixels as a unit on the linked axis.',\n            'Use this for example to create an elevation profile where the vertical scale',\n            'is exaggerated a fixed amount with respect to the horizontal.'\n        ].join(' ')\n    },\n    constrain: {\n        valType: 'enumerated',\n        values: ['range', 'domain'],\n        editType: 'plot',\n        description: [\n            'If this axis needs to be compressed (either due to its own `scaleanchor` and',\n            '`scaleratio` or those of the other axis), determines how that happens:',\n            'by increasing the *range*, or by decreasing the *domain*.',\n            'Default is *domain* for axes containing image traces, *range* otherwise.'\n        ].join(' ')\n    },\n    // constraintoward: not used directly, just put here for reference\n    constraintoward: {\n        valType: 'enumerated',\n        values: ['left', 'center', 'right', 'top', 'middle', 'bottom'],\n        editType: 'plot',\n        description: [\n            'If this axis needs to be compressed (either due to its own `scaleanchor` and',\n            '`scaleratio` or those of the other axis), determines which direction we push',\n            'the originally specified plot area. Options are *left*, *center* (default),',\n            'and *right* for x axes, and *top*, *middle* (default), and *bottom* for y axes.'\n        ].join(' ')\n    },\n    matches: {\n        valType: 'enumerated',\n        values: [\n            constants.idRegex.x.toString(),\n            constants.idRegex.y.toString()\n        ],\n        editType: 'calc',\n        description: [\n            'If set to another axis id (e.g. `x2`, `y`), the range of this axis',\n            'will match the range of the corresponding axis in data-coordinates space.',\n            'Moreover, matching axes share auto-range values, category lists and',\n            'histogram auto-bins.',\n            'Note that setting axes simultaneously in both a `scaleanchor` and a `matches` constraint',\n            'is currently forbidden.',\n            'Moreover, note that matching axes must have the same `type`.'\n        ].join(' ')\n    },\n\n    rangebreaks: templatedArray('rangebreak', {\n        enabled: {\n            valType: 'boolean',\n            dflt: true,\n            editType: 'calc',\n            description: [\n                'Determines whether this axis rangebreak is enabled or disabled.',\n                'Please note that `rangebreaks` only work for *date* axis type.'\n            ].join(' ')\n        },\n\n        bounds: {\n            valType: 'info_array',\n            items: [\n                {valType: 'any', editType: 'calc'},\n                {valType: 'any', editType: 'calc'}\n            ],\n            editType: 'calc',\n            description: [\n                'Sets the lower and upper bounds of this axis rangebreak.',\n                'Can be used with `pattern`.'\n            ].join(' ')\n        },\n\n        pattern: {\n            valType: 'enumerated',\n            values: [DAY_OF_WEEK, HOUR, ''],\n            editType: 'calc',\n            description: [\n                'Determines a pattern on the time line that generates breaks.',\n                'If *' + DAY_OF_WEEK + '* - days of the week in English e.g. \\'Sunday\\' or `\\sun\\`',\n                '(matching is case-insensitive and considers only the first three characters),',\n                'as well as Sunday-based integers between 0 and 6.',\n                'If *' + HOUR + '* - hour (24-hour clock) as decimal numbers between 0 and 24.',\n                'for more info.',\n                'Examples:',\n                '- { pattern: \\'' + DAY_OF_WEEK + '\\', bounds: [6, 1] }',\n                ' or simply { bounds: [\\'sat\\', \\'mon\\'] }',\n                '  breaks from Saturday to Monday (i.e. skips the weekends).',\n                '- { pattern: \\'' + HOUR + '\\', bounds: [17, 8] }',\n                '  breaks from 5pm to 8am (i.e. skips non-work hours).'\n            ].join(' ')\n        },\n\n        values: {\n            valType: 'info_array',\n            freeLength: true,\n            editType: 'calc',\n            items: {\n                valType: 'any',\n                editType: 'calc'\n            },\n            description: [\n                'Sets the coordinate values corresponding to the rangebreaks.',\n                'An alternative to `bounds`.',\n                'Use `dvalue` to set the size of the values along the axis.'\n            ].join(' ')\n        },\n        dvalue: {\n            // TODO could become 'any' to add support for 'months', 'years'\n            valType: 'number',\n            editType: 'calc',\n            min: 0,\n            dflt: ONEDAY,\n            description: [\n                'Sets the size of each `values` item.',\n                'The default is one day in milliseconds.'\n            ].join(' ')\n        },\n\n        /*\n        gap: {\n            valType: 'number',\n            min: 0,\n            dflt: 0, // for *date* axes, maybe something else for *linear*\n            editType: 'calc',\n            description: [\n                'Sets the gap distance between the start and the end of this rangebreak.',\n                'Use with `gapmode` to set the unit of measurement.'\n            ].join(' ')\n        },\n        gapmode: {\n            valType: 'enumerated',\n            values: ['pixels', 'fraction'],\n            dflt: 'pixels',\n            editType: 'calc',\n            description: [\n                'Determines if the `gap` value corresponds to a pixel length',\n                'or a fraction of the plot area.'\n            ].join(' ')\n        },\n        */\n\n        // To complete https://github.com/plotly/plotly.js/issues/4210\n        // we additionally need `gap` and make this work on *linear*, and\n        // possibly all other cartesian axis types. We possibly would also need\n        // some style attributes controlling the zig-zag on the corresponding\n        // axis.\n\n        editType: 'calc'\n    }),\n\n    // ticks\n    tickmode: {\n        valType: 'enumerated',\n        values: ['auto', 'linear', 'array'],\n        editType: 'ticks',\n        impliedEdits: {tick0: undefined, dtick: undefined},\n        description: [\n            'Sets the tick mode for this axis.',\n            'If *auto*, the number of ticks is set via `nticks`.',\n            'If *linear*, the placement of the ticks is determined by',\n            'a starting position `tick0` and a tick step `dtick`',\n            '(*linear* is the default value if `tick0` and `dtick` are provided).',\n            'If *array*, the placement of the ticks is set via `tickvals`',\n            'and the tick text is `ticktext`.',\n            '(*array* is the default value if `tickvals` is provided).'\n        ].join(' ')\n    },\n    nticks: {\n        valType: 'integer',\n        min: 0,\n        dflt: 0,\n        editType: 'ticks',\n        description: [\n            'Specifies the maximum number of ticks for the particular axis.',\n            'The actual number of ticks will be chosen automatically to be',\n            'less than or equal to `nticks`.',\n            'Has an effect only if `tickmode` is set to *auto*.'\n        ].join(' ')\n    },\n    tick0: {\n        valType: 'any',\n        editType: 'ticks',\n        impliedEdits: {tickmode: 'linear'},\n        description: [\n            'Sets the placement of the first tick on this axis.',\n            'Use with `dtick`.',\n            'If the axis `type` is *log*, then you must take the log of your starting tick',\n            '(e.g. to set the starting tick to 100, set the `tick0` to 2)',\n            'except when `dtick`=*L<f>* (see `dtick` for more info).',\n            'If the axis `type` is *date*, it should be a date string, like date data.',\n            'If the axis `type` is *category*, it should be a number, using the scale where',\n            'each category is assigned a serial number from zero in the order it appears.'\n        ].join(' ')\n    },\n    dtick: {\n        valType: 'any',\n        editType: 'ticks',\n        impliedEdits: {tickmode: 'linear'},\n        description: [\n            'Sets the step in-between ticks on this axis. Use with `tick0`.',\n            'Must be a positive number, or special strings available to *log* and *date* axes.',\n            'If the axis `type` is *log*, then ticks are set every 10^(n*dtick) where n',\n            'is the tick number. For example,',\n            'to set a tick mark at 1, 10, 100, 1000, ... set dtick to 1.',\n            'To set tick marks at 1, 100, 10000, ... set dtick to 2.',\n            'To set tick marks at 1, 5, 25, 125, 625, 3125, ... set dtick to log_10(5), or 0.69897000433.',\n            '*log* has several special values; *L<f>*, where `f` is a positive number,',\n            'gives ticks linearly spaced in value (but not position).',\n            'For example `tick0` = 0.1, `dtick` = *L0.5* will put ticks at 0.1, 0.6, 1.1, 1.6 etc.',\n            'To show powers of 10 plus small digits between, use *D1* (all digits) or *D2* (only 2 and 5).',\n            '`tick0` is ignored for *D1* and *D2*.',\n            'If the axis `type` is *date*, then you must convert the time to milliseconds.',\n            'For example, to set the interval between ticks to one day,',\n            'set `dtick` to 86400000.0.',\n            '*date* also has special values *M<n>* gives ticks spaced by a number of months.',\n            '`n` must be a positive integer.',\n            'To set ticks on the 15th of every third month, set `tick0` to *2000-01-15* and `dtick` to *M3*.',\n            'To set ticks every 4 years, set `dtick` to *M48*'\n        ].join(' ')\n    },\n    tickvals: {\n        valType: 'data_array',\n        editType: 'ticks',\n        description: [\n            'Sets the values at which ticks on this axis appear.',\n            'Only has an effect if `tickmode` is set to *array*.',\n            'Used with `ticktext`.'\n        ].join(' ')\n    },\n    ticktext: {\n        valType: 'data_array',\n        editType: 'ticks',\n        description: [\n            'Sets the text displayed at the ticks position via `tickvals`.',\n            'Only has an effect if `tickmode` is set to *array*.',\n            'Used with `tickvals`.'\n        ].join(' ')\n    },\n    ticks: {\n        valType: 'enumerated',\n        values: ['outside', 'inside', ''],\n        editType: 'ticks',\n        description: [\n            'Determines whether ticks are drawn or not.',\n            'If **, this axis\\' ticks are not drawn.',\n            'If *outside* (*inside*), this axis\\' are drawn outside (inside)',\n            'the axis lines.'\n        ].join(' ')\n    },\n    tickson: {\n        valType: 'enumerated',\n        values: ['labels', 'boundaries'],\n        dflt: 'labels',\n        editType: 'ticks',\n        description: [\n            'Determines where ticks and grid lines are drawn with respect to their',\n            'corresponding tick labels.',\n            'Only has an effect for axes of `type` *category* or *multicategory*.',\n            'When set to *boundaries*, ticks and grid lines are drawn half a category',\n            'to the left/bottom of labels.'\n        ].join(' ')\n    },\n    ticklabelmode: {\n        valType: 'enumerated',\n        values: ['instant', 'period'],\n        dflt: 'instant',\n        editType: 'ticks',\n        description: [\n            'Determines where tick labels are drawn with respect to their',\n            'corresponding ticks and grid lines.',\n            'Only has an effect for axes of `type` *date*',\n            'When set to *period*, tick labels are drawn in the middle of the period',\n            'between ticks.'\n        ].join(' ')\n    },\n    // ticklabelposition: not used directly, as values depend on direction (similar to side)\n    // left/right options are for x axes, and top/bottom options are for y axes\n    ticklabelposition: {\n        valType: 'enumerated',\n        values: [\n            'outside', 'inside',\n            'outside top', 'inside top',\n            'outside left', 'inside left',\n            'outside right', 'inside right',\n            'outside bottom', 'inside bottom'\n        ],\n        dflt: 'outside',\n        editType: 'calc',\n        description: [\n            'Determines where tick labels are drawn with respect to the axis',\n            'Please note that',\n            'top or bottom has no effect on x axes or when `ticklabelmode` is set to *period*.',\n            'Similarly',\n            'left or right has no effect on y axes or when `ticklabelmode` is set to *period*.',\n            'Has no effect on *multicategory* axes or when `tickson` is set to *boundaries*.',\n            'When used on axes linked by `matches` or `scaleanchor`,',\n            'no extra padding for inside labels would be added by autorange,',\n            'so that the scales could match.'\n        ].join(' ')\n    },\n    ticklabeloverflow: {\n        valType: 'enumerated',\n        values: [\n            'allow',\n            'hide past div',\n            'hide past domain'\n        ],\n        editType: 'calc',\n        description: [\n            'Determines how we handle tick labels that would overflow either the graph div or the domain of the axis.',\n            'The default value for inside tick labels is *hide past domain*.',\n            'Otherwise on *category* and *multicategory* axes the default is *allow*.',\n            'In other cases the default is *hide past div*.'\n        ].join(' ')\n    },\n    mirror: {\n        valType: 'enumerated',\n        values: [true, 'ticks', false, 'all', 'allticks'],\n        dflt: false,\n        editType: 'ticks+layoutstyle',\n        description: [\n            'Determines if the axis lines or/and ticks are mirrored to',\n            'the opposite side of the plotting area.',\n            'If *true*, the axis lines are mirrored.',\n            'If *ticks*, the axis lines and ticks are mirrored.',\n            'If *false*, mirroring is disable.',\n            'If *all*, axis lines are mirrored on all shared-axes subplots.',\n            'If *allticks*, axis lines and ticks are mirrored',\n            'on all shared-axes subplots.'\n        ].join(' ')\n    },\n    ticklen: {\n        valType: 'number',\n        min: 0,\n        dflt: 5,\n        editType: 'ticks',\n        description: 'Sets the tick length (in px).'\n    },\n    tickwidth: {\n        valType: 'number',\n        min: 0,\n        dflt: 1,\n        editType: 'ticks',\n        description: 'Sets the tick width (in px).'\n    },\n    tickcolor: {\n        valType: 'color',\n        dflt: colorAttrs.defaultLine,\n        editType: 'ticks',\n        description: 'Sets the tick color.'\n    },\n    showticklabels: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'ticks',\n        description: 'Determines whether or not the tick labels are drawn.'\n    },\n    automargin: {\n        valType: 'boolean',\n        dflt: false,\n        editType: 'ticks',\n        description: [\n            'Determines whether long tick labels automatically grow the figure',\n            'margins.'\n        ].join(' ')\n    },\n    showspikes: {\n        valType: 'boolean',\n        dflt: false,\n        editType: 'modebar',\n        description: [\n            'Determines whether or not spikes (aka droplines) are drawn for this axis.',\n            'Note: This only takes affect when hovermode = closest'\n        ].join(' ')\n    },\n    spikecolor: {\n        valType: 'color',\n        dflt: null,\n        editType: 'none',\n        description: 'Sets the spike color. If undefined, will use the series color'\n    },\n    spikethickness: {\n        valType: 'number',\n        dflt: 3,\n        editType: 'none',\n        description: 'Sets the width (in px) of the zero line.'\n    },\n    spikedash: extendFlat({}, dash, {dflt: 'dash', editType: 'none'}),\n    spikemode: {\n        valType: 'flaglist',\n        flags: ['toaxis', 'across', 'marker'],\n        dflt: 'toaxis',\n        editType: 'none',\n        description: [\n            'Determines the drawing mode for the spike line',\n            'If *toaxis*, the line is drawn from the data point to the axis the ',\n            'series is plotted on.',\n\n            'If *across*, the line is drawn across the entire plot area, and',\n            'supercedes *toaxis*.',\n\n            'If *marker*, then a marker dot is drawn on the axis the series is',\n            'plotted on'\n        ].join(' ')\n    },\n    spikesnap: {\n        valType: 'enumerated',\n        values: ['data', 'cursor', 'hovered data'],\n        dflt: 'hovered data',\n        editType: 'none',\n        description: 'Determines whether spikelines are stuck to the cursor or to the closest datapoints.'\n    },\n    tickfont: fontAttrs({\n        editType: 'ticks',\n        description: 'Sets the tick font.'\n    }),\n    tickangle: {\n        valType: 'angle',\n        dflt: 'auto',\n        editType: 'ticks',\n        description: [\n            'Sets the angle of the tick labels with respect to the horizontal.',\n            'For example, a `tickangle` of -90 draws the tick labels',\n            'vertically.'\n        ].join(' ')\n    },\n    tickprefix: {\n        valType: 'string',\n        dflt: '',\n        editType: 'ticks',\n        description: 'Sets a tick label prefix.'\n    },\n    showtickprefix: {\n        valType: 'enumerated',\n        values: ['all', 'first', 'last', 'none'],\n        dflt: 'all',\n        editType: 'ticks',\n        description: [\n            'If *all*, all tick labels are displayed with a prefix.',\n            'If *first*, only the first tick is displayed with a prefix.',\n            'If *last*, only the last tick is displayed with a suffix.',\n            'If *none*, tick prefixes are hidden.'\n        ].join(' ')\n    },\n    ticksuffix: {\n        valType: 'string',\n        dflt: '',\n        editType: 'ticks',\n        description: 'Sets a tick label suffix.'\n    },\n    showticksuffix: {\n        valType: 'enumerated',\n        values: ['all', 'first', 'last', 'none'],\n        dflt: 'all',\n        editType: 'ticks',\n        description: 'Same as `showtickprefix` but for tick suffixes.'\n    },\n    showexponent: {\n        valType: 'enumerated',\n        values: ['all', 'first', 'last', 'none'],\n        dflt: 'all',\n        editType: 'ticks',\n        description: [\n            'If *all*, all exponents are shown besides their significands.',\n            'If *first*, only the exponent of the first tick is shown.',\n            'If *last*, only the exponent of the last tick is shown.',\n            'If *none*, no exponents appear.'\n        ].join(' ')\n    },\n    exponentformat: {\n        valType: 'enumerated',\n        values: ['none', 'e', 'E', 'power', 'SI', 'B'],\n        dflt: 'B',\n        editType: 'ticks',\n        description: [\n            'Determines a formatting rule for the tick exponents.',\n            'For example, consider the number 1,000,000,000.',\n            'If *none*, it appears as 1,000,000,000.',\n            'If *e*, 1e+9.',\n            'If *E*, 1E+9.',\n            'If *power*, 1x10^9 (with 9 in a super script).',\n            'If *SI*, 1G.',\n            'If *B*, 1B.'\n        ].join(' ')\n    },\n    minexponent: {\n        valType: 'number',\n        dflt: 3,\n        min: 0,\n        editType: 'ticks',\n        description: [\n            'Hide SI prefix for 10^n if |n| is below this number.',\n            'This only has an effect when `tickformat` is *SI* or *B*.'\n        ].join(' ')\n    },\n    separatethousands: {\n        valType: 'boolean',\n        dflt: false,\n        editType: 'ticks',\n        description: [\n            'If \"true\", even 4-digit integers are separated'\n        ].join(' ')\n    },\n    tickformat: {\n        valType: 'string',\n        dflt: '',\n        editType: 'ticks',\n        description: descriptionWithDates('tick label')\n    },\n    tickformatstops: templatedArray('tickformatstop', {\n        enabled: {\n            valType: 'boolean',\n            dflt: true,\n            editType: 'ticks',\n            description: [\n                'Determines whether or not this stop is used.',\n                'If `false`, this stop is ignored even within its `dtickrange`.'\n            ].join(' ')\n        },\n        dtickrange: {\n            valType: 'info_array',\n            items: [\n                {valType: 'any', editType: 'ticks'},\n                {valType: 'any', editType: 'ticks'}\n            ],\n            editType: 'ticks',\n            description: [\n                'range [*min*, *max*], where *min*, *max* - dtick values',\n                'which describe some zoom level, it is possible to omit *min*',\n                'or *max* value by passing *null*'\n            ].join(' ')\n        },\n        value: {\n            valType: 'string',\n            dflt: '',\n            editType: 'ticks',\n            description: [\n                'string - dtickformat for described zoom level, the same as *tickformat*'\n            ].join(' ')\n        },\n        editType: 'ticks'\n    }),\n    hoverformat: {\n        valType: 'string',\n        dflt: '',\n        editType: 'none',\n        description: descriptionWithDates('hover text')\n    },\n    // lines and grids\n    showline: {\n        valType: 'boolean',\n        dflt: false,\n        editType: 'ticks+layoutstyle',\n        description: [\n            'Determines whether or not a line bounding this axis is drawn.'\n        ].join(' ')\n    },\n    linecolor: {\n        valType: 'color',\n        dflt: colorAttrs.defaultLine,\n        editType: 'layoutstyle',\n        description: 'Sets the axis line color.'\n    },\n    linewidth: {\n        valType: 'number',\n        min: 0,\n        dflt: 1,\n        editType: 'ticks+layoutstyle',\n        description: 'Sets the width (in px) of the axis line.'\n    },\n    showgrid: {\n        valType: 'boolean',\n        editType: 'ticks',\n        description: [\n            'Determines whether or not grid lines are drawn.',\n            'If *true*, the grid lines are drawn at every tick mark.'\n        ].join(' ')\n    },\n    gridcolor: {\n        valType: 'color',\n        dflt: colorAttrs.lightLine,\n        editType: 'ticks',\n        description: 'Sets the color of the grid lines.'\n    },\n    gridwidth: {\n        valType: 'number',\n        min: 0,\n        dflt: 1,\n        editType: 'ticks',\n        description: 'Sets the width (in px) of the grid lines.'\n    },\n    zeroline: {\n        valType: 'boolean',\n        editType: 'ticks',\n        description: [\n            'Determines whether or not a line is drawn at along the 0 value',\n            'of this axis.',\n            'If *true*, the zero line is drawn on top of the grid lines.'\n        ].join(' ')\n    },\n    zerolinecolor: {\n        valType: 'color',\n        dflt: colorAttrs.defaultLine,\n        editType: 'ticks',\n        description: 'Sets the line color of the zero line.'\n    },\n    zerolinewidth: {\n        valType: 'number',\n        dflt: 1,\n        editType: 'ticks',\n        description: 'Sets the width (in px) of the zero line.'\n    },\n\n    showdividers: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'ticks',\n        description: [\n            'Determines whether or not a dividers are drawn',\n            'between the category levels of this axis.',\n            'Only has an effect on *multicategory* axes.'\n        ].join(' ')\n    },\n    dividercolor: {\n        valType: 'color',\n        dflt: colorAttrs.defaultLine,\n        editType: 'ticks',\n        description: [\n            'Sets the color of the dividers',\n            'Only has an effect on *multicategory* axes.'\n        ].join(' ')\n    },\n    dividerwidth: {\n        valType: 'number',\n        dflt: 1,\n        editType: 'ticks',\n        description: [\n            'Sets the width (in px) of the dividers',\n            'Only has an effect on *multicategory* axes.'\n        ].join(' ')\n    },\n    // TODO dividerlen: that would override \"to label base\" length?\n\n    // positioning attributes\n    // anchor: not used directly, just put here for reference\n    // values are any opposite-letter axis id\n    anchor: {\n        valType: 'enumerated',\n        values: [\n            'free',\n            constants.idRegex.x.toString(),\n            constants.idRegex.y.toString()\n        ],\n        editType: 'plot',\n        description: [\n            'If set to an opposite-letter axis id (e.g. `x2`, `y`), this axis is bound to',\n            'the corresponding opposite-letter axis.',\n            'If set to *free*, this axis\\' position is determined by `position`.'\n        ].join(' ')\n    },\n    // side: not used directly, as values depend on direction\n    // values are top, bottom for x axes, and left, right for y\n    side: {\n        valType: 'enumerated',\n        values: ['top', 'bottom', 'left', 'right'],\n        editType: 'plot',\n        description: [\n            'Determines whether a x (y) axis is positioned',\n            'at the *bottom* (*left*) or *top* (*right*)',\n            'of the plotting area.'\n        ].join(' ')\n    },\n    // overlaying: not used directly, just put here for reference\n    // values are false and any other same-letter axis id that's not\n    // itself overlaying anything\n    overlaying: {\n        valType: 'enumerated',\n        values: [\n            'free',\n            constants.idRegex.x.toString(),\n            constants.idRegex.y.toString()\n        ],\n        editType: 'plot',\n        description: [\n            'If set a same-letter axis id, this axis is overlaid on top of',\n            'the corresponding same-letter axis, with traces and axes visible for both',\n            'axes.',\n            'If *false*, this axis does not overlay any same-letter axes.',\n            'In this case, for axes with overlapping domains only the highest-numbered',\n            'axis will be visible.'\n        ].join(' ')\n    },\n    layer: {\n        valType: 'enumerated',\n        values: ['above traces', 'below traces'],\n        dflt: 'above traces',\n        editType: 'plot',\n        description: [\n            'Sets the layer on which this axis is displayed.',\n            'If *above traces*, this axis is displayed above all the subplot\\'s traces',\n            'If *below traces*, this axis is displayed below all the subplot\\'s traces,',\n            'but above the grid lines.',\n            'Useful when used together with scatter-like traces with `cliponaxis`',\n            'set to *false* to show markers and/or text nodes above this axis.'\n        ].join(' ')\n    },\n    domain: {\n        valType: 'info_array',\n        items: [\n            {valType: 'number', min: 0, max: 1, editType: 'plot'},\n            {valType: 'number', min: 0, max: 1, editType: 'plot'}\n        ],\n        dflt: [0, 1],\n        editType: 'plot',\n        description: [\n            'Sets the domain of this axis (in plot fraction).'\n        ].join(' ')\n    },\n    position: {\n        valType: 'number',\n        min: 0,\n        max: 1,\n        dflt: 0,\n        editType: 'plot',\n        description: [\n            'Sets the position of this axis in the plotting space',\n            '(in normalized coordinates).',\n            'Only has an effect if `anchor` is set to *free*.'\n        ].join(' ')\n    },\n    categoryorder: {\n        valType: 'enumerated',\n        values: [\n            'trace', 'category ascending', 'category descending', 'array',\n            'total ascending', 'total descending',\n            'min ascending', 'min descending',\n            'max ascending', 'max descending',\n            'sum ascending', 'sum descending',\n            'mean ascending', 'mean descending',\n            'median ascending', 'median descending'\n        ],\n        dflt: 'trace',\n        editType: 'calc',\n        description: [\n            'Specifies the ordering logic for the case of categorical variables.',\n            'By default, plotly uses *trace*, which specifies the order that is present in the data supplied.',\n            'Set `categoryorder` to *category ascending* or *category descending* if order should be determined by',\n            'the alphanumerical order of the category names.',\n            'Set `categoryorder` to *array* to derive the ordering from the attribute `categoryarray`. If a category',\n            'is not found in the `categoryarray` array, the sorting behavior for that attribute will be identical to',\n            'the *trace* mode. The unspecified categories will follow the categories in `categoryarray`.',\n            'Set `categoryorder` to *total ascending* or *total descending* if order should be determined by the',\n            'numerical order of the values.',\n            'Similarly, the order can be determined by the min, max, sum, mean or median of all the values.'\n        ].join(' ')\n    },\n    categoryarray: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: [\n            'Sets the order in which categories on this axis appear.',\n            'Only has an effect if `categoryorder` is set to *array*.',\n            'Used with `categoryorder`.'\n        ].join(' ')\n    },\n    uirevision: {\n        valType: 'any',\n        editType: 'none',\n        description: [\n            'Controls persistence of user-driven changes in axis `range`,',\n            '`autorange`, and `title` if in `editable: true` configuration.',\n            'Defaults to `layout.uirevision`.'\n        ].join(' ')\n    },\n    editType: 'calc',\n\n    _deprecated: {\n        autotick: {\n            valType: 'boolean',\n            editType: 'ticks',\n            description: [\n                'Obsolete.',\n                'Set `tickmode` to *auto* for old `autotick` *true* behavior.',\n                'Set `tickmode` to *linear* for `autotick` *false*.'\n            ].join(' ')\n        },\n        title: {\n            valType: 'string',\n            editType: 'ticks',\n            description: [\n                'Value of `title` is no longer a simple *string* but a set of sub-attributes.',\n                'To set the axis\\' title, please use `title.text` now.'\n            ].join(' ')\n        },\n        titlefont: fontAttrs({\n            editType: 'ticks',\n            description: [\n                'Former `titlefont` is now the sub-attribute `font` of `title`.',\n                'To customize title font properties, please use `title.font` now.'\n            ].join(' ')\n        })\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Color = require('../../components/color');\nvar isUnifiedHover = require('../../components/fx/helpers').isUnifiedHover;\nvar handleHoverModeDefaults = require('../../components/fx/hovermode_defaults');\nvar Template = require('../../plot_api/plot_template');\nvar basePlotLayoutAttributes = require('../layout_attributes');\n\nvar layoutAttributes = require('./layout_attributes');\nvar handleTypeDefaults = require('./type_defaults');\nvar handleAxisDefaults = require('./axis_defaults');\nvar constraints = require('./constraints');\nvar handlePositionDefaults = require('./position_defaults');\n\nvar axisIds = require('./axis_ids');\nvar id2name = axisIds.id2name;\nvar name2id = axisIds.name2id;\n\nvar AX_ID_PATTERN = require('./constants').AX_ID_PATTERN;\n\nvar Registry = require('../../registry');\nvar traceIs = Registry.traceIs;\nvar getComponentMethod = Registry.getComponentMethod;\n\nfunction appendList(cont, k, item) {\n    if(Array.isArray(cont[k])) cont[k].push(item);\n    else cont[k] = [item];\n}\n\nmodule.exports = function supplyLayoutDefaults(layoutIn, layoutOut, fullData) {\n    var autotypenumbersDflt = layoutOut.autotypenumbers;\n\n    var ax2traces = {};\n    var xaMayHide = {};\n    var yaMayHide = {};\n    var xaMustDisplay = {};\n    var yaMustDisplay = {};\n    var yaMustNotReverse = {};\n    var yaMayReverse = {};\n    var axHasImage = {};\n    var outerTicks = {};\n    var noGrids = {};\n    var i, j;\n\n    // look for axes in the data\n    for(i = 0; i < fullData.length; i++) {\n        var trace = fullData[i];\n        if(!traceIs(trace, 'cartesian') && !traceIs(trace, 'gl2d')) continue;\n\n        var xaName;\n        if(trace.xaxis) {\n            xaName = id2name(trace.xaxis);\n            appendList(ax2traces, xaName, trace);\n        } else if(trace.xaxes) {\n            for(j = 0; j < trace.xaxes.length; j++) {\n                appendList(ax2traces, id2name(trace.xaxes[j]), trace);\n            }\n        }\n\n        var yaName;\n        if(trace.yaxis) {\n            yaName = id2name(trace.yaxis);\n            appendList(ax2traces, yaName, trace);\n        } else if(trace.yaxes) {\n            for(j = 0; j < trace.yaxes.length; j++) {\n                appendList(ax2traces, id2name(trace.yaxes[j]), trace);\n            }\n        }\n\n        // logic for funnels\n        if(trace.type === 'funnel') {\n            if(trace.orientation === 'h') {\n                if(xaName) xaMayHide[xaName] = true;\n                if(yaName) yaMayReverse[yaName] = true;\n            } else {\n                if(yaName) yaMayHide[yaName] = true;\n            }\n        } else if(trace.type === 'image') {\n            if(yaName) axHasImage[yaName] = true;\n            if(xaName) axHasImage[xaName] = true;\n        } else {\n            if(yaName) {\n                yaMustDisplay[yaName] = true;\n                yaMustNotReverse[yaName] = true;\n            }\n\n            if(!traceIs(trace, 'carpet') || (trace.type === 'carpet' && !trace._cheater)) {\n                if(xaName) xaMustDisplay[xaName] = true;\n            }\n        }\n\n        // Two things trigger axis visibility:\n        // 1. is not carpet\n        // 2. carpet that's not cheater\n\n        // The above check for definitely-not-cheater is not adequate. This\n        // second list tracks which axes *could* be a cheater so that the\n        // full condition triggering hiding is:\n        //   *could* be a cheater and *is not definitely visible*\n        if(trace.type === 'carpet' && trace._cheater) {\n            if(xaName) xaMayHide[xaName] = true;\n        }\n\n        // check for default formatting tweaks\n        if(traceIs(trace, '2dMap')) {\n            outerTicks[xaName] = true;\n            outerTicks[yaName] = true;\n        }\n\n        if(traceIs(trace, 'oriented')) {\n            var positionAxis = trace.orientation === 'h' ? yaName : xaName;\n            noGrids[positionAxis] = true;\n        }\n    }\n\n    var subplots = layoutOut._subplots;\n    var xIds = subplots.xaxis;\n    var yIds = subplots.yaxis;\n    var xNames = Lib.simpleMap(xIds, id2name);\n    var yNames = Lib.simpleMap(yIds, id2name);\n    var axNames = xNames.concat(yNames);\n\n    // plot_bgcolor only makes sense if there's a (2D) plot!\n    // TODO: bgcolor for each subplot, to inherit from the main one\n    var plotBgColor = Color.background;\n    if(xIds.length && yIds.length) {\n        plotBgColor = Lib.coerce(layoutIn, layoutOut, basePlotLayoutAttributes, 'plot_bgcolor');\n    }\n\n    var bgColor = Color.combine(plotBgColor, layoutOut.paper_bgcolor);\n\n    // name of single axis (e.g. 'xaxis', 'yaxis2')\n    var axName;\n    // id of single axis (e.g. 'y', 'x5')\n    var axId;\n    // 'x' or 'y'\n    var axLetter;\n    // input layout axis container\n    var axLayoutIn;\n    // full layout axis container\n    var axLayoutOut;\n\n    function newAxLayoutOut() {\n        var traces = ax2traces[axName] || [];\n        axLayoutOut._traceIndices = traces.map(function(t) { return t._expandedIndex; });\n        axLayoutOut._annIndices = [];\n        axLayoutOut._shapeIndices = [];\n        axLayoutOut._imgIndices = [];\n        axLayoutOut._subplotsWith = [];\n        axLayoutOut._counterAxes = [];\n        axLayoutOut._name = axLayoutOut._attr = axName;\n        axLayoutOut._id = axId;\n    }\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(axLayoutIn, axLayoutOut, layoutAttributes, attr, dflt);\n    }\n\n    function coerce2(attr, dflt) {\n        return Lib.coerce2(axLayoutIn, axLayoutOut, layoutAttributes, attr, dflt);\n    }\n\n    function getCounterAxes(axLetter) {\n        return (axLetter === 'x') ? yIds : xIds;\n    }\n\n    function getOverlayableAxes(axLetter, axName) {\n        var list = (axLetter === 'x') ? xNames : yNames;\n        var out = [];\n\n        for(var j = 0; j < list.length; j++) {\n            var axName2 = list[j];\n\n            if(axName2 !== axName && !(layoutIn[axName2] || {}).overlaying) {\n                out.push(name2id(axName2));\n            }\n        }\n\n        return out;\n    }\n\n    // list of available counter axis names\n    var counterAxes = {x: getCounterAxes('x'), y: getCounterAxes('y')};\n    // list of all x AND y axis ids\n    var allAxisIds = counterAxes.x.concat(counterAxes.y);\n    // lookup and list of axis ids that axes in axNames have a reference to,\n    // even though they are missing from allAxisIds\n    var missingMatchedAxisIdsLookup = {};\n    var missingMatchedAxisIds = [];\n\n    // fill in 'missing' axis lookup when an axis is set to match an axis\n    // not part of the allAxisIds list, save axis type so that we can propagate\n    // it to the missing axes\n    function addMissingMatchedAxis() {\n        var matchesIn = axLayoutIn.matches;\n        if(AX_ID_PATTERN.test(matchesIn) && allAxisIds.indexOf(matchesIn) === -1) {\n            missingMatchedAxisIdsLookup[matchesIn] = axLayoutIn.type;\n            missingMatchedAxisIds = Object.keys(missingMatchedAxisIdsLookup);\n        }\n    }\n\n    var hovermode = handleHoverModeDefaults(layoutIn, layoutOut);\n    var unifiedHover = isUnifiedHover(hovermode);\n\n    // first pass creates the containers, determines types, and handles most of the settings\n    for(i = 0; i < axNames.length; i++) {\n        axName = axNames[i];\n        axId = name2id(axName);\n        axLetter = axName.charAt(0);\n\n        if(!Lib.isPlainObject(layoutIn[axName])) {\n            layoutIn[axName] = {};\n        }\n\n        axLayoutIn = layoutIn[axName];\n        axLayoutOut = Template.newContainer(layoutOut, axName, axLetter + 'axis');\n        newAxLayoutOut();\n\n        var visibleDflt =\n            (axLetter === 'x' && !xaMustDisplay[axName] && xaMayHide[axName]) ||\n            (axLetter === 'y' && !yaMustDisplay[axName] && yaMayHide[axName]);\n\n        var reverseDflt =\n            (axLetter === 'y' &&\n              (\n                (!yaMustNotReverse[axName] && yaMayReverse[axName]) ||\n                axHasImage[axName]\n              ));\n\n        var defaultOptions = {\n            letter: axLetter,\n            font: layoutOut.font,\n            outerTicks: outerTicks[axName],\n            showGrid: !noGrids[axName],\n            data: ax2traces[axName] || [],\n            bgColor: bgColor,\n            calendar: layoutOut.calendar,\n            automargin: true,\n            visibleDflt: visibleDflt,\n            reverseDflt: reverseDflt,\n            autotypenumbersDflt: autotypenumbersDflt,\n            splomStash: ((layoutOut._splomAxes || {})[axLetter] || {})[axId]\n        };\n\n        coerce('uirevision', layoutOut.uirevision);\n\n        handleTypeDefaults(axLayoutIn, axLayoutOut, coerce, defaultOptions);\n        handleAxisDefaults(axLayoutIn, axLayoutOut, coerce, defaultOptions, layoutOut);\n\n        var unifiedSpike = unifiedHover && axLetter === hovermode.charAt(0);\n        var spikecolor = coerce2('spikecolor', unifiedHover ? axLayoutOut.color : undefined);\n        var spikethickness = coerce2('spikethickness', unifiedHover ? 1.5 : undefined);\n        var spikedash = coerce2('spikedash', unifiedHover ? 'dot' : undefined);\n        var spikemode = coerce2('spikemode', unifiedHover ? 'across' : undefined);\n        var spikesnap = coerce2('spikesnap');\n        var showSpikes = coerce('showspikes', !!unifiedSpike || !!spikecolor || !!spikethickness || !!spikedash || !!spikemode || !!spikesnap);\n\n        if(!showSpikes) {\n            delete axLayoutOut.spikecolor;\n            delete axLayoutOut.spikethickness;\n            delete axLayoutOut.spikedash;\n            delete axLayoutOut.spikemode;\n            delete axLayoutOut.spikesnap;\n        }\n\n        handlePositionDefaults(axLayoutIn, axLayoutOut, coerce, {\n            letter: axLetter,\n            counterAxes: counterAxes[axLetter],\n            overlayableAxes: getOverlayableAxes(axLetter, axName),\n            grid: layoutOut.grid\n        });\n\n        coerce('title.standoff');\n\n        addMissingMatchedAxis();\n\n        axLayoutOut._input = axLayoutIn;\n    }\n\n    // coerce the 'missing' axes\n    i = 0;\n    while(i < missingMatchedAxisIds.length) {\n        axId = missingMatchedAxisIds[i++];\n        axName = id2name(axId);\n        axLetter = axName.charAt(0);\n\n        if(!Lib.isPlainObject(layoutIn[axName])) {\n            layoutIn[axName] = {};\n        }\n\n        axLayoutIn = layoutIn[axName];\n        axLayoutOut = Template.newContainer(layoutOut, axName, axLetter + 'axis');\n        newAxLayoutOut();\n\n        var defaultOptions2 = {\n            letter: axLetter,\n            font: layoutOut.font,\n            outerTicks: outerTicks[axName],\n            showGrid: !noGrids[axName],\n            data: [],\n            bgColor: bgColor,\n            calendar: layoutOut.calendar,\n            automargin: true,\n            visibleDflt: false,\n            reverseDflt: false,\n            autotypenumbersDflt: autotypenumbersDflt,\n            splomStash: ((layoutOut._splomAxes || {})[axLetter] || {})[axId]\n        };\n\n        coerce('uirevision', layoutOut.uirevision);\n\n        axLayoutOut.type = missingMatchedAxisIdsLookup[axId] || 'linear';\n\n        handleAxisDefaults(axLayoutIn, axLayoutOut, coerce, defaultOptions2, layoutOut);\n\n        handlePositionDefaults(axLayoutIn, axLayoutOut, coerce, {\n            letter: axLetter,\n            counterAxes: counterAxes[axLetter],\n            overlayableAxes: getOverlayableAxes(axLetter, axName),\n            grid: layoutOut.grid\n        });\n\n        coerce('fixedrange');\n\n        addMissingMatchedAxis();\n\n        axLayoutOut._input = axLayoutIn;\n    }\n\n    // quick second pass for range slider and selector defaults\n    var rangeSliderDefaults = getComponentMethod('rangeslider', 'handleDefaults');\n    var rangeSelectorDefaults = getComponentMethod('rangeselector', 'handleDefaults');\n\n    for(i = 0; i < xNames.length; i++) {\n        axName = xNames[i];\n        axLayoutIn = layoutIn[axName];\n        axLayoutOut = layoutOut[axName];\n\n        rangeSliderDefaults(layoutIn, layoutOut, axName);\n\n        if(axLayoutOut.type === 'date') {\n            rangeSelectorDefaults(\n                axLayoutIn,\n                axLayoutOut,\n                layoutOut,\n                yNames,\n                axLayoutOut.calendar\n            );\n        }\n\n        coerce('fixedrange');\n    }\n\n    for(i = 0; i < yNames.length; i++) {\n        axName = yNames[i];\n        axLayoutIn = layoutIn[axName];\n        axLayoutOut = layoutOut[axName];\n\n        var anchoredAxis = layoutOut[id2name(axLayoutOut.anchor)];\n\n        var fixedRangeDflt = getComponentMethod('rangeslider', 'isVisible')(anchoredAxis);\n\n        coerce('fixedrange', fixedRangeDflt);\n    }\n\n    // Finally, handle scale constraints and matching axes.\n    //\n    // We need to do this after all axes have coerced both `type`\n    // (so we link only axes of the same type) and\n    // `fixedrange` (so we can avoid linking from OR TO a fixed axis).\n    constraints.handleDefaults(layoutIn, layoutOut, {\n        axIds: allAxisIds.concat(missingMatchedAxisIds).sort(axisIds.idSort),\n        axHasImage: axHasImage\n    });\n};\n","'use strict';\n\nvar colorMix = require('tinycolor2').mix;\nvar lightFraction = require('../../components/color/attributes').lightFraction;\nvar Lib = require('../../lib');\n\n/**\n * @param {object} opts :\n *   - dfltColor {string} : default axis color\n *   - bgColor {string} : combined subplot bg color\n *   - blend {number, optional} : blend percentage (to compute dflt grid color)\n *   - showLine {boolean} : show line by default\n *   - showGrid {boolean} : show grid by default\n *   - noZeroLine {boolean} : don't coerce zeroline* attributes\n *   - attributes {object} : attribute object associated with input containers\n */\nmodule.exports = function handleLineGridDefaults(containerIn, containerOut, coerce, opts) {\n    opts = opts || {};\n\n    var dfltColor = opts.dfltColor;\n\n    function coerce2(attr, dflt) {\n        return Lib.coerce2(containerIn, containerOut, opts.attributes, attr, dflt);\n    }\n\n    var lineColor = coerce2('linecolor', dfltColor);\n    var lineWidth = coerce2('linewidth');\n    var showLine = coerce('showline', opts.showLine || !!lineColor || !!lineWidth);\n\n    if(!showLine) {\n        delete containerOut.linecolor;\n        delete containerOut.linewidth;\n    }\n\n    var gridColorDflt = colorMix(dfltColor, opts.bgColor, opts.blend || lightFraction).toRgbString();\n    var gridColor = coerce2('gridcolor', gridColorDflt);\n    var gridWidth = coerce2('gridwidth');\n    var showGridLines = coerce('showgrid', opts.showGrid || !!gridColor || !!gridWidth);\n\n    if(!showGridLines) {\n        delete containerOut.gridcolor;\n        delete containerOut.gridwidth;\n    }\n\n    if(!opts.noZeroLine) {\n        var zeroLineColor = coerce2('zerolinecolor', dfltColor);\n        var zeroLineWidth = coerce2('zerolinewidth');\n        var showZeroLine = coerce('zeroline', opts.showGrid || !!zeroLineColor || !!zeroLineWidth);\n\n        if(!showZeroLine) {\n            delete containerOut.zerolinecolor;\n            delete containerOut.zerolinewidth;\n        }\n    }\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\nvar Lib = require('../../lib');\n\n\nmodule.exports = function handlePositionDefaults(containerIn, containerOut, coerce, options) {\n    var counterAxes = options.counterAxes || [];\n    var overlayableAxes = options.overlayableAxes || [];\n    var letter = options.letter;\n    var grid = options.grid;\n\n    var dfltAnchor, dfltDomain, dfltSide, dfltPosition;\n\n    if(grid) {\n        dfltDomain = grid._domains[letter][grid._axisMap[containerOut._id]];\n        dfltAnchor = grid._anchors[containerOut._id];\n        if(dfltDomain) {\n            dfltSide = grid[letter + 'side'].split(' ')[0];\n            dfltPosition = grid.domain[letter][dfltSide === 'right' || dfltSide === 'top' ? 1 : 0];\n        }\n    }\n\n    // Even if there's a grid, this axis may not be in it - fall back on non-grid defaults\n    dfltDomain = dfltDomain || [0, 1];\n    dfltAnchor = dfltAnchor || (isNumeric(containerIn.position) ? 'free' : (counterAxes[0] || 'free'));\n    dfltSide = dfltSide || (letter === 'x' ? 'bottom' : 'left');\n    dfltPosition = dfltPosition || 0;\n\n    var anchor = Lib.coerce(containerIn, containerOut, {\n        anchor: {\n            valType: 'enumerated',\n            values: ['free'].concat(counterAxes),\n            dflt: dfltAnchor\n        }\n    }, 'anchor');\n\n    if(anchor === 'free') coerce('position', dfltPosition);\n\n    Lib.coerce(containerIn, containerOut, {\n        side: {\n            valType: 'enumerated',\n            values: letter === 'x' ? ['bottom', 'top'] : ['left', 'right'],\n            dflt: dfltSide\n        }\n    }, 'side');\n\n    var overlaying = false;\n    if(overlayableAxes.length) {\n        overlaying = Lib.coerce(containerIn, containerOut, {\n            overlaying: {\n                valType: 'enumerated',\n                values: [false].concat(overlayableAxes),\n                dflt: false\n            }\n        }, 'overlaying');\n    }\n\n    if(!overlaying) {\n        // TODO: right now I'm copying this domain over to overlaying axes\n        // in ax.setscale()... but this means we still need (imperfect) logic\n        // in the axes popover to hide domain for the overlaying axis.\n        // perhaps I should make a private version _domain that all axes get???\n        var domain = coerce('domain', dfltDomain);\n\n        // according to https://www.npmjs.com/package/canvas-size\n        // the minimum value of max canvas width across browsers and devices is 4096\n        // which applied in the calculation below:\n        if(domain[0] > domain[1] - 1 / 4096) containerOut.domain = dfltDomain;\n        Lib.noneOrAll(containerIn.domain, containerOut.domain, dfltDomain);\n    }\n\n    coerce('layer');\n\n    return containerOut;\n};\n","'use strict';\n\nvar FROM_BL = require('../../constants/alignment').FROM_BL;\n\nmodule.exports = function scaleZoom(ax, factor, centerFraction) {\n    if(centerFraction === undefined) {\n        centerFraction = FROM_BL[ax.constraintoward || 'center'];\n    }\n\n    var rangeLinear = [ax.r2l(ax.range[0]), ax.r2l(ax.range[1])];\n    var center = rangeLinear[0] + (rangeLinear[1] - rangeLinear[0]) * centerFraction;\n\n    ax.range = ax._input.range = [\n        ax.l2r(center + (rangeLinear[0] - center) * factor),\n        ax.l2r(center + (rangeLinear[1] - center) * factor)\n    ];\n    ax.setScale();\n};\n","'use strict';\n\nvar polybool = require('polybooljs');\n\nvar Registry = require('../../registry');\nvar dashStyle = require('../../components/drawing').dashStyle;\nvar Color = require('../../components/color');\nvar Fx = require('../../components/fx');\nvar makeEventData = require('../../components/fx/helpers').makeEventData;\nvar dragHelpers = require('../../components/dragelement/helpers');\nvar freeMode = dragHelpers.freeMode;\nvar rectMode = dragHelpers.rectMode;\nvar drawMode = dragHelpers.drawMode;\nvar openMode = dragHelpers.openMode;\nvar selectMode = dragHelpers.selectMode;\n\nvar displayOutlines = require('../../components/shapes/draw_newshape/display_outlines');\nvar handleEllipse = require('../../components/shapes/draw_newshape/helpers').handleEllipse;\nvar newShapes = require('../../components/shapes/draw_newshape/newshapes');\n\nvar Lib = require('../../lib');\nvar polygon = require('../../lib/polygon');\nvar throttle = require('../../lib/throttle');\nvar getFromId = require('./axis_ids').getFromId;\nvar clearGlCanvases = require('../../lib/clear_gl_canvases');\n\nvar redrawReglTraces = require('../../plot_api/subroutines').redrawReglTraces;\n\nvar constants = require('./constants');\nvar MINSELECT = constants.MINSELECT;\n\nvar filteredPolygon = polygon.filter;\nvar polygonTester = polygon.tester;\n\nvar clearSelect = require('./handle_outline').clearSelect;\n\nvar helpers = require('./helpers');\nvar p2r = helpers.p2r;\nvar axValue = helpers.axValue;\nvar getTransform = helpers.getTransform;\n\nfunction prepSelect(e, startX, startY, dragOptions, mode) {\n    var isFreeMode = freeMode(mode);\n    var isRectMode = rectMode(mode);\n    var isOpenMode = openMode(mode);\n    var isDrawMode = drawMode(mode);\n    var isSelectMode = selectMode(mode);\n\n    var isLine = mode === 'drawline';\n    var isEllipse = mode === 'drawcircle';\n    var isLineOrEllipse = isLine || isEllipse; // cases with two start & end positions\n\n    var gd = dragOptions.gd;\n    var fullLayout = gd._fullLayout;\n    var zoomLayer = fullLayout._zoomlayer;\n    var dragBBox = dragOptions.element.getBoundingClientRect();\n    var plotinfo = dragOptions.plotinfo;\n    var transform = getTransform(plotinfo);\n    var x0 = startX - dragBBox.left;\n    var y0 = startY - dragBBox.top;\n\n    fullLayout._calcInverseTransform(gd);\n    var transformedCoords = Lib.apply3DTransform(fullLayout._invTransform)(x0, y0);\n    x0 = transformedCoords[0];\n    y0 = transformedCoords[1];\n    var scaleX = fullLayout._invScaleX;\n    var scaleY = fullLayout._invScaleY;\n\n    var x1 = x0;\n    var y1 = y0;\n    var path0 = 'M' + x0 + ',' + y0;\n    var pw = dragOptions.xaxes[0]._length;\n    var ph = dragOptions.yaxes[0]._length;\n    var allAxes = dragOptions.xaxes.concat(dragOptions.yaxes);\n    var subtract = e.altKey &&\n        !(drawMode(mode) && isOpenMode);\n\n    var filterPoly, selectionTester, mergedPolygons, currentPolygon;\n    var i, searchInfo, eventData;\n\n    coerceSelectionsCache(e, gd, dragOptions);\n\n    if(isFreeMode) {\n        filterPoly = filteredPolygon([[x0, y0]], constants.BENDPX);\n    }\n\n    var outlines = zoomLayer.selectAll('path.select-outline-' + plotinfo.id).data(isDrawMode ? [0] : [1, 2]);\n    var drwStyle = fullLayout.newshape;\n\n    outlines.enter()\n        .append('path')\n        .attr('class', function(d) { return 'select-outline select-outline-' + d + ' select-outline-' + plotinfo.id; })\n        .style(isDrawMode ? {\n            opacity: drwStyle.opacity / 2,\n            fill: isOpenMode ? undefined : drwStyle.fillcolor,\n            stroke: drwStyle.line.color,\n            'stroke-dasharray': dashStyle(drwStyle.line.dash, drwStyle.line.width),\n            'stroke-width': drwStyle.line.width + 'px'\n        } : {})\n        .attr('fill-rule', drwStyle.fillrule)\n        .classed('cursor-move', isDrawMode ? true : false)\n        .attr('transform', transform)\n        .attr('d', path0 + 'Z');\n\n    var corners = zoomLayer.append('path')\n        .attr('class', 'zoombox-corners')\n        .style({\n            fill: Color.background,\n            stroke: Color.defaultLine,\n            'stroke-width': 1\n        })\n        .attr('transform', transform)\n        .attr('d', 'M0,0Z');\n\n\n    var throttleID = fullLayout._uid + constants.SELECTID;\n    var selection = [];\n\n    // find the traces to search for selection points\n    var searchTraces = determineSearchTraces(gd, dragOptions.xaxes,\n      dragOptions.yaxes, dragOptions.subplot);\n\n    function ascending(a, b) { return a - b; }\n\n    // allow subplots to override fillRangeItems routine\n    var fillRangeItems;\n\n    if(plotinfo.fillRangeItems) {\n        fillRangeItems = plotinfo.fillRangeItems;\n    } else {\n        if(isRectMode) {\n            fillRangeItems = function(eventData, poly) {\n                var ranges = eventData.range = {};\n\n                for(i = 0; i < allAxes.length; i++) {\n                    var ax = allAxes[i];\n                    var axLetter = ax._id.charAt(0);\n\n                    ranges[ax._id] = [\n                        p2r(ax, poly[axLetter + 'min']),\n                        p2r(ax, poly[axLetter + 'max'])\n                    ].sort(ascending);\n                }\n            };\n        } else { // case of isFreeMode\n            fillRangeItems = function(eventData, poly, filterPoly) {\n                var dataPts = eventData.lassoPoints = {};\n\n                for(i = 0; i < allAxes.length; i++) {\n                    var ax = allAxes[i];\n                    dataPts[ax._id] = filterPoly.filtered.map(axValue(ax));\n                }\n            };\n        }\n    }\n\n    dragOptions.moveFn = function(dx0, dy0) {\n        x1 = Math.max(0, Math.min(pw, scaleX * dx0 + x0));\n        y1 = Math.max(0, Math.min(ph, scaleY * dy0 + y0));\n\n        var dx = Math.abs(x1 - x0);\n        var dy = Math.abs(y1 - y0);\n\n        if(isRectMode) {\n            var direction;\n            var start, end;\n\n            if(isSelectMode) {\n                var q = fullLayout.selectdirection;\n\n                if(q === 'any') {\n                    if(dy < Math.min(dx * 0.6, MINSELECT)) {\n                        direction = 'h';\n                    } else if(dx < Math.min(dy * 0.6, MINSELECT)) {\n                        direction = 'v';\n                    } else {\n                        direction = 'd';\n                    }\n                } else {\n                    direction = q;\n                }\n\n                switch(direction) {\n                    case 'h':\n                        start = isEllipse ? ph / 2 : 0;\n                        end = ph;\n                        break;\n                    case 'v':\n                        start = isEllipse ? pw / 2 : 0;\n                        end = pw;\n                        break;\n                }\n            }\n\n            if(isDrawMode) {\n                switch(fullLayout.newshape.drawdirection) {\n                    case 'vertical':\n                        direction = 'h';\n                        start = isEllipse ? ph / 2 : 0;\n                        end = ph;\n                        break;\n                    case 'horizontal':\n                        direction = 'v';\n                        start = isEllipse ? pw / 2 : 0;\n                        end = pw;\n                        break;\n                    case 'ortho':\n                        if(dx < dy) {\n                            direction = 'h';\n                            start = y0;\n                            end = y1;\n                        } else {\n                            direction = 'v';\n                            start = x0;\n                            end = x1;\n                        }\n                        break;\n                    default: // i.e. case of 'diagonal'\n                        direction = 'd';\n                }\n            }\n\n            if(direction === 'h') {\n                // horizontal motion\n                currentPolygon = isLineOrEllipse ?\n                    handleEllipse(isEllipse, [x1, start], [x1, end]) : // using x1 instead of x0 allows adjusting the line while drawing\n                    [[x0, start], [x0, end], [x1, end], [x1, start]]; // make a vertical box\n\n                currentPolygon.xmin = isLineOrEllipse ? x1 : Math.min(x0, x1);\n                currentPolygon.xmax = isLineOrEllipse ? x1 : Math.max(x0, x1);\n                currentPolygon.ymin = Math.min(start, end);\n                currentPolygon.ymax = Math.max(start, end);\n                // extras to guide users in keeping a straight selection\n                corners.attr('d', 'M' + currentPolygon.xmin + ',' + (y0 - MINSELECT) +\n                    'h-4v' + (2 * MINSELECT) + 'h4Z' +\n                    'M' + (currentPolygon.xmax - 1) + ',' + (y0 - MINSELECT) +\n                    'h4v' + (2 * MINSELECT) + 'h-4Z');\n            } else if(direction === 'v') {\n                // vertical motion\n                currentPolygon = isLineOrEllipse ?\n                    handleEllipse(isEllipse, [start, y1], [end, y1]) : // using y1 instead of y0 allows adjusting the line while drawing\n                    [[start, y0], [start, y1], [end, y1], [end, y0]]; // make a horizontal box\n\n                currentPolygon.xmin = Math.min(start, end);\n                currentPolygon.xmax = Math.max(start, end);\n                currentPolygon.ymin = isLineOrEllipse ? y1 : Math.min(y0, y1);\n                currentPolygon.ymax = isLineOrEllipse ? y1 : Math.max(y0, y1);\n                corners.attr('d', 'M' + (x0 - MINSELECT) + ',' + currentPolygon.ymin +\n                    'v-4h' + (2 * MINSELECT) + 'v4Z' +\n                    'M' + (x0 - MINSELECT) + ',' + (currentPolygon.ymax - 1) +\n                    'v4h' + (2 * MINSELECT) + 'v-4Z');\n            } else if(direction === 'd') {\n                // diagonal motion\n                currentPolygon = isLineOrEllipse ?\n                    handleEllipse(isEllipse, [x0, y0], [x1, y1]) :\n                    [[x0, y0], [x0, y1], [x1, y1], [x1, y0]];\n\n                currentPolygon.xmin = Math.min(x0, x1);\n                currentPolygon.xmax = Math.max(x0, x1);\n                currentPolygon.ymin = Math.min(y0, y1);\n                currentPolygon.ymax = Math.max(y0, y1);\n                corners.attr('d', 'M0,0Z');\n            }\n        } else if(isFreeMode) {\n            filterPoly.addPt([x1, y1]);\n            currentPolygon = filterPoly.filtered;\n        }\n\n        // create outline & tester\n        if(dragOptions.selectionDefs && dragOptions.selectionDefs.length) {\n            mergedPolygons = mergePolygons(dragOptions.mergedPolygons, currentPolygon, subtract);\n            currentPolygon.subtract = subtract;\n            selectionTester = multiTester(dragOptions.selectionDefs.concat([currentPolygon]));\n        } else {\n            mergedPolygons = [currentPolygon];\n            selectionTester = polygonTester(currentPolygon);\n        }\n\n        // display polygons on the screen\n        displayOutlines(convertPoly(mergedPolygons, isOpenMode), outlines, dragOptions);\n\n        if(isSelectMode) {\n            throttle.throttle(\n                throttleID,\n                constants.SELECTDELAY,\n                function() {\n                    selection = [];\n\n                    var thisSelection;\n                    var traceSelections = [];\n                    var traceSelection;\n                    for(i = 0; i < searchTraces.length; i++) {\n                        searchInfo = searchTraces[i];\n\n                        traceSelection = searchInfo._module.selectPoints(searchInfo, selectionTester);\n                        traceSelections.push(traceSelection);\n\n                        thisSelection = fillSelectionItem(traceSelection, searchInfo);\n\n                        if(selection.length) {\n                            for(var j = 0; j < thisSelection.length; j++) {\n                                selection.push(thisSelection[j]);\n                            }\n                        } else selection = thisSelection;\n                    }\n\n                    eventData = {points: selection};\n                    updateSelectedState(gd, searchTraces, eventData);\n                    fillRangeItems(eventData, currentPolygon, filterPoly);\n                    dragOptions.gd.emit('plotly_selecting', eventData);\n                }\n            );\n        }\n    };\n\n    dragOptions.clickFn = function(numClicks, evt) {\n        corners.remove();\n\n        if(gd._fullLayout._activeShapeIndex >= 0) {\n            gd._fullLayout._deactivateShape(gd);\n            return;\n        }\n        if(isDrawMode) return;\n\n        var clickmode = fullLayout.clickmode;\n\n        throttle.done(throttleID).then(function() {\n            throttle.clear(throttleID);\n            if(numClicks === 2) {\n                // clear selection on doubleclick\n                outlines.remove();\n                for(i = 0; i < searchTraces.length; i++) {\n                    searchInfo = searchTraces[i];\n                    searchInfo._module.selectPoints(searchInfo, false);\n                }\n\n                updateSelectedState(gd, searchTraces);\n\n                clearSelectionsCache(dragOptions);\n\n                gd.emit('plotly_deselect', null);\n            } else {\n                if(clickmode.indexOf('select') > -1) {\n                    selectOnClick(evt, gd, dragOptions.xaxes, dragOptions.yaxes,\n                      dragOptions.subplot, dragOptions, outlines);\n                }\n\n                if(clickmode === 'event') {\n                    // TODO: remove in v3 - this was probably never intended to work as it does,\n                    // but in case anyone depends on it we don't want to break it now.\n                    // Note that click-to-select introduced pre v3 also emitts proper\n                    // event data when clickmode is having 'select' in its flag list.\n                    gd.emit('plotly_selected', undefined);\n                }\n            }\n\n            Fx.click(gd, evt);\n        }).catch(Lib.error);\n    };\n\n    dragOptions.doneFn = function() {\n        corners.remove();\n\n        throttle.done(throttleID).then(function() {\n            throttle.clear(throttleID);\n            dragOptions.gd.emit('plotly_selected', eventData);\n\n            if(currentPolygon && dragOptions.selectionDefs) {\n                // save last polygons\n                currentPolygon.subtract = subtract;\n                dragOptions.selectionDefs.push(currentPolygon);\n\n                // we have to keep reference to arrays container\n                dragOptions.mergedPolygons.length = 0;\n                [].push.apply(dragOptions.mergedPolygons, mergedPolygons);\n            }\n\n            if(dragOptions.doneFnCompleted) {\n                dragOptions.doneFnCompleted(selection);\n            }\n        }).catch(Lib.error);\n\n        if(isDrawMode) {\n            clearSelectionsCache(dragOptions);\n        }\n    };\n}\n\nfunction selectOnClick(evt, gd, xAxes, yAxes, subplot, dragOptions, polygonOutlines) {\n    var hoverData = gd._hoverdata;\n    var fullLayout = gd._fullLayout;\n    var clickmode = fullLayout.clickmode;\n    var sendEvents = clickmode.indexOf('event') > -1;\n    var selection = [];\n    var searchTraces, searchInfo, currentSelectionDef, selectionTester, traceSelection;\n    var thisTracesSelection, pointOrBinSelected, subtract, eventData, i;\n\n    if(isHoverDataSet(hoverData)) {\n        coerceSelectionsCache(evt, gd, dragOptions);\n        searchTraces = determineSearchTraces(gd, xAxes, yAxes, subplot);\n        var clickedPtInfo = extractClickedPtInfo(hoverData, searchTraces);\n        var isBinnedTrace = clickedPtInfo.pointNumbers.length > 0;\n\n\n        // Note: potentially costly operation isPointOrBinSelected is\n        // called as late as possible through the use of an assignment\n        // in an if condition.\n        if(isBinnedTrace ?\n            isOnlyThisBinSelected(searchTraces, clickedPtInfo) :\n            isOnlyOnePointSelected(searchTraces) &&\n                (pointOrBinSelected = isPointOrBinSelected(clickedPtInfo))) {\n            if(polygonOutlines) polygonOutlines.remove();\n            for(i = 0; i < searchTraces.length; i++) {\n                searchInfo = searchTraces[i];\n                searchInfo._module.selectPoints(searchInfo, false);\n            }\n\n            updateSelectedState(gd, searchTraces);\n\n            clearSelectionsCache(dragOptions);\n\n            if(sendEvents) {\n                gd.emit('plotly_deselect', null);\n            }\n        } else {\n            subtract = evt.shiftKey &&\n              (pointOrBinSelected !== undefined ?\n                pointOrBinSelected :\n                isPointOrBinSelected(clickedPtInfo));\n            currentSelectionDef = newPointSelectionDef(clickedPtInfo.pointNumber, clickedPtInfo.searchInfo, subtract);\n\n            var allSelectionDefs = dragOptions.selectionDefs.concat([currentSelectionDef]);\n            selectionTester = multiTester(allSelectionDefs);\n\n            for(i = 0; i < searchTraces.length; i++) {\n                traceSelection = searchTraces[i]._module.selectPoints(searchTraces[i], selectionTester);\n                thisTracesSelection = fillSelectionItem(traceSelection, searchTraces[i]);\n\n                if(selection.length) {\n                    for(var j = 0; j < thisTracesSelection.length; j++) {\n                        selection.push(thisTracesSelection[j]);\n                    }\n                } else selection = thisTracesSelection;\n            }\n\n            eventData = {points: selection};\n            updateSelectedState(gd, searchTraces, eventData);\n\n            if(currentSelectionDef && dragOptions) {\n                dragOptions.selectionDefs.push(currentSelectionDef);\n            }\n\n            if(polygonOutlines) {\n                var polygons = dragOptions.mergedPolygons;\n                var isOpenMode = openMode(dragOptions.dragmode);\n\n                // display polygons on the screen\n                displayOutlines(convertPoly(polygons, isOpenMode), polygonOutlines, dragOptions);\n            }\n\n            if(sendEvents) {\n                gd.emit('plotly_selected', eventData);\n            }\n        }\n    }\n}\n\n/**\n * Constructs a new point selection definition object.\n */\nfunction newPointSelectionDef(pointNumber, searchInfo, subtract) {\n    return {\n        pointNumber: pointNumber,\n        searchInfo: searchInfo,\n        subtract: subtract\n    };\n}\n\nfunction isPointSelectionDef(o) {\n    return 'pointNumber' in o && 'searchInfo' in o;\n}\n\n/*\n * Constructs a new point number tester.\n */\nfunction newPointNumTester(pointSelectionDef) {\n    return {\n        xmin: 0,\n        xmax: 0,\n        ymin: 0,\n        ymax: 0,\n        pts: [],\n        contains: function(pt, omitFirstEdge, pointNumber, searchInfo) {\n            var idxWantedTrace = pointSelectionDef.searchInfo.cd[0].trace._expandedIndex;\n            var idxActualTrace = searchInfo.cd[0].trace._expandedIndex;\n            return idxActualTrace === idxWantedTrace &&\n              pointNumber === pointSelectionDef.pointNumber;\n        },\n        isRect: false,\n        degenerate: false,\n        subtract: pointSelectionDef.subtract\n    };\n}\n\n/**\n * Wraps multiple selection testers.\n *\n * @param {Array} list - An array of selection testers.\n *\n * @return a selection tester object with a contains function\n * that can be called to evaluate a point against all wrapped\n * selection testers that were passed in list.\n */\nfunction multiTester(list) {\n    var testers = [];\n    var xmin = isPointSelectionDef(list[0]) ? 0 : list[0][0][0];\n    var xmax = xmin;\n    var ymin = isPointSelectionDef(list[0]) ? 0 : list[0][0][1];\n    var ymax = ymin;\n\n    for(var i = 0; i < list.length; i++) {\n        if(isPointSelectionDef(list[i])) {\n            testers.push(newPointNumTester(list[i]));\n        } else {\n            var tester = polygon.tester(list[i]);\n            tester.subtract = list[i].subtract;\n            testers.push(tester);\n            xmin = Math.min(xmin, tester.xmin);\n            xmax = Math.max(xmax, tester.xmax);\n            ymin = Math.min(ymin, tester.ymin);\n            ymax = Math.max(ymax, tester.ymax);\n        }\n    }\n\n    /**\n     * Tests if the given point is within this tester.\n     *\n     * @param {Array} pt - [0] is the x coordinate, [1] is the y coordinate of the point.\n     * @param {*} arg - An optional parameter to pass down to wrapped testers.\n     * @param {number} pointNumber - The point number of the point within the underlying data array.\n     * @param {number} searchInfo - An object identifying the trace the point is contained in.\n     *\n     * @return {boolean} true if point is considered to be selected, false otherwise.\n     */\n    function contains(pt, arg, pointNumber, searchInfo) {\n        var contained = false;\n        for(var i = 0; i < testers.length; i++) {\n            if(testers[i].contains(pt, arg, pointNumber, searchInfo)) {\n                // if contained by subtract tester - exclude the point\n                contained = testers[i].subtract === false;\n            }\n        }\n\n        return contained;\n    }\n\n    return {\n        xmin: xmin,\n        xmax: xmax,\n        ymin: ymin,\n        ymax: ymax,\n        pts: [],\n        contains: contains,\n        isRect: false,\n        degenerate: false\n    };\n}\n\nfunction coerceSelectionsCache(evt, gd, dragOptions) {\n    gd._fullLayout._drawing = false;\n\n    var fullLayout = gd._fullLayout;\n    var plotinfo = dragOptions.plotinfo;\n    var dragmode = dragOptions.dragmode;\n\n    var selectingOnSameSubplot = (\n        fullLayout._lastSelectedSubplot &&\n        fullLayout._lastSelectedSubplot === plotinfo.id\n    );\n\n    var hasModifierKey = (evt.shiftKey || evt.altKey) &&\n        !(drawMode(dragmode) && openMode(dragmode));\n\n    if(selectingOnSameSubplot && hasModifierKey &&\n      (plotinfo.selection && plotinfo.selection.selectionDefs) && !dragOptions.selectionDefs) {\n        // take over selection definitions from prev mode, if any\n        dragOptions.selectionDefs = plotinfo.selection.selectionDefs;\n        dragOptions.mergedPolygons = plotinfo.selection.mergedPolygons;\n    } else if(!hasModifierKey || !plotinfo.selection) {\n        clearSelectionsCache(dragOptions);\n    }\n\n    // clear selection outline when selecting a different subplot\n    if(!selectingOnSameSubplot) {\n        clearSelect(gd);\n        fullLayout._lastSelectedSubplot = plotinfo.id;\n    }\n}\n\nfunction clearSelectionsCache(dragOptions) {\n    var dragmode = dragOptions.dragmode;\n    var plotinfo = dragOptions.plotinfo;\n\n    var gd = dragOptions.gd;\n    if(gd._fullLayout._activeShapeIndex >= 0) {\n        gd._fullLayout._deactivateShape(gd);\n    }\n\n    if(drawMode(dragmode)) {\n        var fullLayout = gd._fullLayout;\n        var zoomLayer = fullLayout._zoomlayer;\n\n        var outlines = zoomLayer.selectAll('.select-outline-' + plotinfo.id);\n        if(outlines && gd._fullLayout._drawing) {\n            // add shape\n            var shapes = newShapes(outlines, dragOptions);\n            if(shapes) {\n                Registry.call('_guiRelayout', gd, {\n                    shapes: shapes\n                });\n            }\n\n            gd._fullLayout._drawing = false;\n        }\n    }\n\n    plotinfo.selection = {};\n    plotinfo.selection.selectionDefs = dragOptions.selectionDefs = [];\n    plotinfo.selection.mergedPolygons = dragOptions.mergedPolygons = [];\n}\n\nfunction determineSearchTraces(gd, xAxes, yAxes, subplot) {\n    var searchTraces = [];\n    var xAxisIds = xAxes.map(function(ax) { return ax._id; });\n    var yAxisIds = yAxes.map(function(ax) { return ax._id; });\n    var cd, trace, i;\n\n    for(i = 0; i < gd.calcdata.length; i++) {\n        cd = gd.calcdata[i];\n        trace = cd[0].trace;\n\n        if(trace.visible !== true || !trace._module || !trace._module.selectPoints) continue;\n\n        if(subplot && (trace.subplot === subplot || trace.geo === subplot)) {\n            searchTraces.push(createSearchInfo(trace._module, cd, xAxes[0], yAxes[0]));\n        } else if(\n          trace.type === 'splom' &&\n          // FIXME: make sure we don't have more than single axis for splom\n          trace._xaxes[xAxisIds[0]] && trace._yaxes[yAxisIds[0]]\n        ) {\n            var info = createSearchInfo(trace._module, cd, xAxes[0], yAxes[0]);\n            info.scene = gd._fullLayout._splomScenes[trace.uid];\n            searchTraces.push(info);\n        } else if(\n          trace.type === 'sankey'\n        ) {\n            var sankeyInfo = createSearchInfo(trace._module, cd, xAxes[0], yAxes[0]);\n            searchTraces.push(sankeyInfo);\n        } else {\n            if(xAxisIds.indexOf(trace.xaxis) === -1) continue;\n            if(yAxisIds.indexOf(trace.yaxis) === -1) continue;\n\n            searchTraces.push(createSearchInfo(trace._module, cd,\n              getFromId(gd, trace.xaxis), getFromId(gd, trace.yaxis)));\n        }\n    }\n\n    return searchTraces;\n\n    function createSearchInfo(module, calcData, xaxis, yaxis) {\n        return {\n            _module: module,\n            cd: calcData,\n            xaxis: xaxis,\n            yaxis: yaxis\n        };\n    }\n}\n\nfunction isHoverDataSet(hoverData) {\n    return hoverData &&\n      Array.isArray(hoverData) &&\n      hoverData[0].hoverOnBox !== true;\n}\n\nfunction extractClickedPtInfo(hoverData, searchTraces) {\n    var hoverDatum = hoverData[0];\n    var pointNumber = -1;\n    var pointNumbers = [];\n    var searchInfo, i;\n\n    for(i = 0; i < searchTraces.length; i++) {\n        searchInfo = searchTraces[i];\n        if(hoverDatum.fullData._expandedIndex === searchInfo.cd[0].trace._expandedIndex) {\n            // Special case for box (and violin)\n            if(hoverDatum.hoverOnBox === true) {\n                break;\n            }\n\n            // Hint: in some traces like histogram, one graphical element\n            // doesn't correspond to one particular data point, but to\n            // bins of data points. Thus, hoverDatum can have a binNumber\n            // property instead of pointNumber.\n            if(hoverDatum.pointNumber !== undefined) {\n                pointNumber = hoverDatum.pointNumber;\n            } else if(hoverDatum.binNumber !== undefined) {\n                pointNumber = hoverDatum.binNumber;\n                pointNumbers = hoverDatum.pointNumbers;\n            }\n\n            break;\n        }\n    }\n\n    return {\n        pointNumber: pointNumber,\n        pointNumbers: pointNumbers,\n        searchInfo: searchInfo\n    };\n}\n\nfunction isPointOrBinSelected(clickedPtInfo) {\n    var trace = clickedPtInfo.searchInfo.cd[0].trace;\n    var ptNum = clickedPtInfo.pointNumber;\n    var ptNums = clickedPtInfo.pointNumbers;\n    var ptNumsSet = ptNums.length > 0;\n\n    // When pointsNumbers is set (e.g. histogram's binning),\n    // it is assumed that when the first point of\n    // a bin is selected, all others are as well\n    var ptNumToTest = ptNumsSet ? ptNums[0] : ptNum;\n\n    // TODO potential performance improvement\n    // Primarily we need this function to determine if a click adds\n    // or subtracts from a selection.\n    // In cases `trace.selectedpoints` is a huge array, indexOf\n    // might be slow. One remedy would be to introduce a hash somewhere.\n    return trace.selectedpoints ? trace.selectedpoints.indexOf(ptNumToTest) > -1 : false;\n}\n\nfunction isOnlyThisBinSelected(searchTraces, clickedPtInfo) {\n    var tracesWithSelectedPts = [];\n    var searchInfo, trace, isSameTrace, i;\n\n    for(i = 0; i < searchTraces.length; i++) {\n        searchInfo = searchTraces[i];\n        if(searchInfo.cd[0].trace.selectedpoints && searchInfo.cd[0].trace.selectedpoints.length > 0) {\n            tracesWithSelectedPts.push(searchInfo);\n        }\n    }\n\n    if(tracesWithSelectedPts.length === 1) {\n        isSameTrace = tracesWithSelectedPts[0] === clickedPtInfo.searchInfo;\n        if(isSameTrace) {\n            trace = clickedPtInfo.searchInfo.cd[0].trace;\n            if(trace.selectedpoints.length === clickedPtInfo.pointNumbers.length) {\n                for(i = 0; i < clickedPtInfo.pointNumbers.length; i++) {\n                    if(trace.selectedpoints.indexOf(clickedPtInfo.pointNumbers[i]) < 0) {\n                        return false;\n                    }\n                }\n                return true;\n            }\n        }\n    }\n\n    return false;\n}\n\nfunction isOnlyOnePointSelected(searchTraces) {\n    var len = 0;\n    var searchInfo, trace, i;\n\n    for(i = 0; i < searchTraces.length; i++) {\n        searchInfo = searchTraces[i];\n        trace = searchInfo.cd[0].trace;\n        if(trace.selectedpoints) {\n            if(trace.selectedpoints.length > 1) return false;\n\n            len += trace.selectedpoints.length;\n            if(len > 1) return false;\n        }\n    }\n\n    return len === 1;\n}\n\nfunction updateSelectedState(gd, searchTraces, eventData) {\n    var i, searchInfo, cd, trace;\n\n    // before anything else, update preGUI if necessary\n    for(i = 0; i < searchTraces.length; i++) {\n        var fullInputTrace = searchTraces[i].cd[0].trace._fullInput;\n        var tracePreGUI = gd._fullLayout._tracePreGUI[fullInputTrace.uid] || {};\n        if(tracePreGUI.selectedpoints === undefined) {\n            tracePreGUI.selectedpoints = fullInputTrace._input.selectedpoints || null;\n        }\n    }\n\n    if(eventData) {\n        var pts = eventData.points || [];\n\n        for(i = 0; i < searchTraces.length; i++) {\n            trace = searchTraces[i].cd[0].trace;\n            trace._input.selectedpoints = trace._fullInput.selectedpoints = [];\n            if(trace._fullInput !== trace) trace.selectedpoints = [];\n        }\n\n        for(i = 0; i < pts.length; i++) {\n            var pt = pts[i];\n            var data = pt.data;\n            var fullData = pt.fullData;\n\n            if(pt.pointIndices) {\n                [].push.apply(data.selectedpoints, pt.pointIndices);\n                if(trace._fullInput !== trace) {\n                    [].push.apply(fullData.selectedpoints, pt.pointIndices);\n                }\n            } else {\n                data.selectedpoints.push(pt.pointIndex);\n                if(trace._fullInput !== trace) {\n                    fullData.selectedpoints.push(pt.pointIndex);\n                }\n            }\n        }\n    } else {\n        for(i = 0; i < searchTraces.length; i++) {\n            trace = searchTraces[i].cd[0].trace;\n            delete trace.selectedpoints;\n            delete trace._input.selectedpoints;\n            if(trace._fullInput !== trace) {\n                delete trace._fullInput.selectedpoints;\n            }\n        }\n    }\n\n    var hasRegl = false;\n\n    for(i = 0; i < searchTraces.length; i++) {\n        searchInfo = searchTraces[i];\n        cd = searchInfo.cd;\n        trace = cd[0].trace;\n\n        if(Registry.traceIs(trace, 'regl')) {\n            hasRegl = true;\n        }\n\n        var _module = searchInfo._module;\n        var fn = _module.styleOnSelect || _module.style;\n        if(fn) {\n            fn(gd, cd, cd[0].node3);\n            if(cd[0].nodeRangePlot3) fn(gd, cd, cd[0].nodeRangePlot3);\n        }\n    }\n\n    if(hasRegl) {\n        clearGlCanvases(gd);\n        redrawReglTraces(gd);\n    }\n}\n\nfunction mergePolygons(list, poly, subtract) {\n    var res;\n\n    if(subtract) {\n        res = polybool.difference({\n            regions: list,\n            inverted: false\n        }, {\n            regions: [poly],\n            inverted: false\n        });\n\n        return res.regions;\n    }\n\n    res = polybool.union({\n        regions: list,\n        inverted: false\n    }, {\n        regions: [poly],\n        inverted: false\n    });\n\n    return res.regions;\n}\n\nfunction fillSelectionItem(selection, searchInfo) {\n    if(Array.isArray(selection)) {\n        var cd = searchInfo.cd;\n        var trace = searchInfo.cd[0].trace;\n\n        for(var i = 0; i < selection.length; i++) {\n            selection[i] = makeEventData(selection[i], trace, cd);\n        }\n    }\n\n    return selection;\n}\n\nfunction convertPoly(polygonsIn, isOpenMode) { // add M and L command to draft positions\n    var polygonsOut = [];\n    for(var i = 0; i < polygonsIn.length; i++) {\n        polygonsOut[i] = [];\n        for(var j = 0; j < polygonsIn[i].length; j++) {\n            polygonsOut[i][j] = [];\n            polygonsOut[i][j][0] = j ? 'L' : 'M';\n            for(var k = 0; k < polygonsIn[i][j].length; k++) {\n                polygonsOut[i][j].push(\n                    polygonsIn[i][j][k]\n                );\n            }\n        }\n\n        if(!isOpenMode) {\n            polygonsOut[i].push([\n                'Z',\n                polygonsOut[i][0][1], // initial x\n                polygonsOut[i][0][2]  // initial y\n            ]);\n        }\n    }\n\n    return polygonsOut;\n}\n\nmodule.exports = {\n    prepSelect: prepSelect,\n    clearSelect: clearSelect,\n    clearSelectionsCache: clearSelectionsCache,\n    selectOnClick: selectOnClick\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar utcFormat = require('d3-time-format').utcFormat;\nvar isNumeric = require('fast-isnumeric');\n\nvar Lib = require('../../lib');\nvar cleanNumber = Lib.cleanNumber;\nvar ms2DateTime = Lib.ms2DateTime;\nvar dateTime2ms = Lib.dateTime2ms;\nvar ensureNumber = Lib.ensureNumber;\nvar isArrayOrTypedArray = Lib.isArrayOrTypedArray;\n\nvar numConstants = require('../../constants/numerical');\nvar FP_SAFE = numConstants.FP_SAFE;\nvar BADNUM = numConstants.BADNUM;\nvar LOG_CLIP = numConstants.LOG_CLIP;\nvar ONEWEEK = numConstants.ONEWEEK;\nvar ONEDAY = numConstants.ONEDAY;\nvar ONEHOUR = numConstants.ONEHOUR;\nvar ONEMIN = numConstants.ONEMIN;\nvar ONESEC = numConstants.ONESEC;\n\nvar axisIds = require('./axis_ids');\nvar constants = require('./constants');\nvar HOUR_PATTERN = constants.HOUR_PATTERN;\nvar WEEKDAY_PATTERN = constants.WEEKDAY_PATTERN;\n\nfunction fromLog(v) {\n    return Math.pow(10, v);\n}\n\nfunction isValidCategory(v) {\n    return v !== null && v !== undefined;\n}\n\n/**\n * Define the conversion functions for an axis data is used in 5 ways:\n *\n *  d: data, in whatever form it's provided\n *  c: calcdata: turned into numbers, but not linearized\n *  l: linearized - same as c except for log axes (and other nonlinear\n *      mappings later?) this is used when we need to know if it's\n *      *possible* to show some data on this axis, without caring about\n *      the current range\n *  p: pixel value - mapped to the screen with current size and zoom\n *  r: ranges, tick0, and annotation positions match one of the above\n *     but are handled differently for different types:\n *     - linear and date: data format (d)\n *     - category: calcdata format (c), and will stay that way because\n *       the data format has no continuous mapping\n *     - log: linearized (l) format\n *       TODO: in v3.0 we plan to change it to data format. At that point\n *       shapes will work the same way as ranges, tick0, and annotations\n *       so they can use this conversion too.\n *\n * Creates/updates these conversion functions, and a few more utilities\n * like cleanRange, and makeCalcdata\n *\n * also clears the autotick constraints ._minDtick, ._forceTick0\n */\nmodule.exports = function setConvert(ax, fullLayout) {\n    fullLayout = fullLayout || {};\n\n    var axId = (ax._id || 'x');\n    var axLetter = axId.charAt(0);\n\n    function toLog(v, clip) {\n        if(v > 0) return Math.log(v) / Math.LN10;\n\n        else if(v <= 0 && clip && ax.range && ax.range.length === 2) {\n            // clip NaN (ie past negative infinity) to LOG_CLIP axis\n            // length past the negative edge\n            var r0 = ax.range[0];\n            var r1 = ax.range[1];\n            return 0.5 * (r0 + r1 - 2 * LOG_CLIP * Math.abs(r0 - r1));\n        } else return BADNUM;\n    }\n\n    /*\n     * wrapped dateTime2ms that:\n     * - accepts ms numbers for backward compatibility\n     * - inserts a dummy arg so calendar is the 3rd arg (see notes below).\n     * - defaults to ax.calendar\n     */\n    function dt2ms(v, _, calendar, opts) {\n        if((opts || {}).msUTC && isNumeric(v)) {\n            // For now it is only used\n            // to fix bar length in milliseconds & gl3d ticks\n            // It could be applied in other places in v3\n            return +v;\n        }\n\n        // NOTE: Changed this behavior: previously we took any numeric value\n        // to be a ms, even if it was a string that could be a bare year.\n        // Now we convert it as a date if at all possible, and only try\n        // as (local) ms if that fails.\n        var ms = dateTime2ms(v, calendar || ax.calendar);\n        if(ms === BADNUM) {\n            if(isNumeric(v)) {\n                v = +v;\n                // keep track of tenths of ms, that `new Date` will drop\n                // same logic as in Lib.ms2DateTime\n                var msecTenths = Math.floor(Lib.mod(v + 0.05, 1) * 10);\n                var msRounded = Math.round(v - msecTenths / 10);\n                ms = dateTime2ms(new Date(msRounded)) + msecTenths / 10;\n            } else return BADNUM;\n        }\n        return ms;\n    }\n\n    // wrapped ms2DateTime to insert default ax.calendar\n    function ms2dt(v, r, calendar) {\n        return ms2DateTime(v, r, calendar || ax.calendar);\n    }\n\n    function getCategoryName(v) {\n        return ax._categories[Math.round(v)];\n    }\n\n    /*\n     * setCategoryIndex: return the index of category v,\n     * inserting it in the list if it's not already there\n     *\n     * this will enter the categories in the order it\n     * encounters them, ie all the categories from the\n     * first data set, then all the ones from the second\n     * that aren't in the first etc.\n     *\n     * it is assumed that this function is being invoked in the\n     * already sorted category order; otherwise there would be\n     * a disconnect between the array and the index returned\n     */\n    function setCategoryIndex(v) {\n        if(isValidCategory(v)) {\n            if(ax._categoriesMap === undefined) {\n                ax._categoriesMap = {};\n            }\n\n            if(ax._categoriesMap[v] !== undefined) {\n                return ax._categoriesMap[v];\n            } else {\n                ax._categories.push(typeof v === 'number' ? String(v) : v);\n\n                var curLength = ax._categories.length - 1;\n                ax._categoriesMap[v] = curLength;\n\n                return curLength;\n            }\n        }\n        return BADNUM;\n    }\n\n    function setMultiCategoryIndex(arrayIn, len) {\n        var arrayOut = new Array(len);\n\n        for(var i = 0; i < len; i++) {\n            var v0 = (arrayIn[0] || [])[i];\n            var v1 = (arrayIn[1] || [])[i];\n            arrayOut[i] = getCategoryIndex([v0, v1]);\n        }\n\n        return arrayOut;\n    }\n\n    function getCategoryIndex(v) {\n        if(ax._categoriesMap) {\n            return ax._categoriesMap[v];\n        }\n    }\n\n    function getCategoryPosition(v) {\n        // d2l/d2c variant that that won't add categories but will also\n        // allow numbers to be mapped to the linearized axis positions\n        var index = getCategoryIndex(v);\n        if(index !== undefined) return index;\n        if(isNumeric(v)) return +v;\n    }\n\n    function getRangePosition(v) {\n        return isNumeric(v) ? +v : getCategoryIndex(v);\n    }\n\n    // include 2 fractional digits on pixel, for PDF zooming etc\n    function _l2p(v, m, b) { return d3.round(b + m * v, 2); }\n\n    function _p2l(px, m, b) { return (px - b) / m; }\n\n    var l2p = function l2p(v) {\n        if(!isNumeric(v)) return BADNUM;\n        return _l2p(v, ax._m, ax._b);\n    };\n\n    var p2l = function(px) {\n        return _p2l(px, ax._m, ax._b);\n    };\n\n    if(ax.rangebreaks) {\n        var isY = axLetter === 'y';\n\n        l2p = function(v) {\n            if(!isNumeric(v)) return BADNUM;\n            var len = ax._rangebreaks.length;\n            if(!len) return _l2p(v, ax._m, ax._b);\n\n            var flip = isY;\n            if(ax.range[0] > ax.range[1]) flip = !flip;\n            var signAx = flip ? -1 : 1;\n            var pos = signAx * v;\n\n            var q = 0;\n            for(var i = 0; i < len; i++) {\n                var min = signAx * ax._rangebreaks[i].min;\n                var max = signAx * ax._rangebreaks[i].max;\n\n                if(pos < min) break;\n                if(pos > max) q = i + 1;\n                else {\n                    // when falls into break, pick 'closest' offset\n                    q = pos < (min + max) / 2 ? i : i + 1;\n                    break;\n                }\n            }\n            var b2 = ax._B[q] || 0;\n            if(!isFinite(b2)) return 0; // avoid NaN translate e.g. in positionLabels if one keep zooming exactly into a break\n            return _l2p(v, ax._m2, b2);\n        };\n\n        p2l = function(px) {\n            var len = ax._rangebreaks.length;\n            if(!len) return _p2l(px, ax._m, ax._b);\n\n            var q = 0;\n            for(var i = 0; i < len; i++) {\n                if(px < ax._rangebreaks[i].pmin) break;\n                if(px > ax._rangebreaks[i].pmax) q = i + 1;\n            }\n            return _p2l(px, ax._m2, ax._B[q]);\n        };\n    }\n\n    // conversions among c/l/p are fairly simple - do them together for all axis types\n    ax.c2l = (ax.type === 'log') ? toLog : ensureNumber;\n    ax.l2c = (ax.type === 'log') ? fromLog : ensureNumber;\n\n    ax.l2p = l2p;\n    ax.p2l = p2l;\n\n    ax.c2p = (ax.type === 'log') ? function(v, clip) { return l2p(toLog(v, clip)); } : l2p;\n    ax.p2c = (ax.type === 'log') ? function(px) { return fromLog(p2l(px)); } : p2l;\n\n    /*\n     * now type-specific conversions for **ALL** other combinations\n     * they're all written out, instead of being combinations of each other, for\n     * both clarity and speed.\n     */\n    if(['linear', '-'].indexOf(ax.type) !== -1) {\n        // all are data vals, but d and r need cleaning\n        ax.d2r = ax.r2d = ax.d2c = ax.r2c = ax.d2l = ax.r2l = cleanNumber;\n        ax.c2d = ax.c2r = ax.l2d = ax.l2r = ensureNumber;\n\n        ax.d2p = ax.r2p = function(v) { return ax.l2p(cleanNumber(v)); };\n        ax.p2d = ax.p2r = p2l;\n\n        ax.cleanPos = ensureNumber;\n    } else if(ax.type === 'log') {\n        // d and c are data vals, r and l are logged (but d and r need cleaning)\n        ax.d2r = ax.d2l = function(v, clip) { return toLog(cleanNumber(v), clip); };\n        ax.r2d = ax.r2c = function(v) { return fromLog(cleanNumber(v)); };\n\n        ax.d2c = ax.r2l = cleanNumber;\n        ax.c2d = ax.l2r = ensureNumber;\n\n        ax.c2r = toLog;\n        ax.l2d = fromLog;\n\n        ax.d2p = function(v, clip) { return ax.l2p(ax.d2r(v, clip)); };\n        ax.p2d = function(px) { return fromLog(p2l(px)); };\n\n        ax.r2p = function(v) { return ax.l2p(cleanNumber(v)); };\n        ax.p2r = p2l;\n\n        ax.cleanPos = ensureNumber;\n    } else if(ax.type === 'date') {\n        // r and d are date strings, l and c are ms\n\n        /*\n         * Any of these functions with r and d on either side, calendar is the\n         * **3rd** argument. log has reserved the second argument.\n         *\n         * Unless you need the special behavior of the second arg (ms2DateTime\n         * uses this to limit precision, toLog uses true to clip negatives\n         * to offscreen low rather than undefined), it's safe to pass 0.\n         */\n        ax.d2r = ax.r2d = Lib.identity;\n\n        ax.d2c = ax.r2c = ax.d2l = ax.r2l = dt2ms;\n        ax.c2d = ax.c2r = ax.l2d = ax.l2r = ms2dt;\n\n        ax.d2p = ax.r2p = function(v, _, calendar) { return ax.l2p(dt2ms(v, 0, calendar)); };\n        ax.p2d = ax.p2r = function(px, r, calendar) { return ms2dt(p2l(px), r, calendar); };\n\n        ax.cleanPos = function(v) { return Lib.cleanDate(v, BADNUM, ax.calendar); };\n    } else if(ax.type === 'category') {\n        // d is categories (string)\n        // c and l are indices (numbers)\n        // r is categories or numbers\n\n        ax.d2c = ax.d2l = setCategoryIndex;\n        ax.r2d = ax.c2d = ax.l2d = getCategoryName;\n\n        ax.d2r = ax.d2l_noadd = getCategoryPosition;\n\n        ax.r2c = function(v) {\n            var index = getRangePosition(v);\n            return index !== undefined ? index : ax.fraction2r(0.5);\n        };\n\n        ax.l2r = ax.c2r = ensureNumber;\n        ax.r2l = getRangePosition;\n\n        ax.d2p = function(v) { return ax.l2p(ax.r2c(v)); };\n        ax.p2d = function(px) { return getCategoryName(p2l(px)); };\n        ax.r2p = ax.d2p;\n        ax.p2r = p2l;\n\n        ax.cleanPos = function(v) {\n            if(typeof v === 'string' && v !== '') return v;\n            return ensureNumber(v);\n        };\n    } else if(ax.type === 'multicategory') {\n        // N.B. multicategory axes don't define d2c and d2l,\n        // as 'data-to-calcdata' conversion needs to take into\n        // account all data array items as in ax.makeCalcdata.\n\n        ax.r2d = ax.c2d = ax.l2d = getCategoryName;\n        ax.d2r = ax.d2l_noadd = getCategoryPosition;\n\n        ax.r2c = function(v) {\n            var index = getCategoryPosition(v);\n            return index !== undefined ? index : ax.fraction2r(0.5);\n        };\n\n        ax.r2c_just_indices = getCategoryIndex;\n\n        ax.l2r = ax.c2r = ensureNumber;\n        ax.r2l = getCategoryPosition;\n\n        ax.d2p = function(v) { return ax.l2p(ax.r2c(v)); };\n        ax.p2d = function(px) { return getCategoryName(p2l(px)); };\n        ax.r2p = ax.d2p;\n        ax.p2r = p2l;\n\n        ax.cleanPos = function(v) {\n            if(Array.isArray(v) || (typeof v === 'string' && v !== '')) return v;\n            return ensureNumber(v);\n        };\n\n        ax.setupMultiCategory = function(fullData) {\n            var traceIndices = ax._traceIndices;\n            var i, j;\n\n            var group = ax._matchGroup;\n            if(group && ax._categories.length === 0) {\n                for(var axId2 in group) {\n                    if(axId2 !== axId) {\n                        var ax2 = fullLayout[axisIds.id2name(axId2)];\n                        traceIndices = traceIndices.concat(ax2._traceIndices);\n                    }\n                }\n            }\n\n            // [ [cnt, {$cat: index}], for 1,2 ]\n            var seen = [[0, {}], [0, {}]];\n            // [ [arrayIn[0][i], arrayIn[1][i]], for i .. N ]\n            var list = [];\n\n            for(i = 0; i < traceIndices.length; i++) {\n                var trace = fullData[traceIndices[i]];\n\n                if(axLetter in trace) {\n                    var arrayIn = trace[axLetter];\n                    var len = trace._length || Lib.minRowLength(arrayIn);\n\n                    if(isArrayOrTypedArray(arrayIn[0]) && isArrayOrTypedArray(arrayIn[1])) {\n                        for(j = 0; j < len; j++) {\n                            var v0 = arrayIn[0][j];\n                            var v1 = arrayIn[1][j];\n\n                            if(isValidCategory(v0) && isValidCategory(v1)) {\n                                list.push([v0, v1]);\n\n                                if(!(v0 in seen[0][1])) {\n                                    seen[0][1][v0] = seen[0][0]++;\n                                }\n                                if(!(v1 in seen[1][1])) {\n                                    seen[1][1][v1] = seen[1][0]++;\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n\n            list.sort(function(a, b) {\n                var ind0 = seen[0][1];\n                var d = ind0[a[0]] - ind0[b[0]];\n                if(d) return d;\n\n                var ind1 = seen[1][1];\n                return ind1[a[1]] - ind1[b[1]];\n            });\n\n            for(i = 0; i < list.length; i++) {\n                setCategoryIndex(list[i]);\n            }\n        };\n    }\n\n    // find the range value at the specified (linear) fraction of the axis\n    ax.fraction2r = function(v) {\n        var rl0 = ax.r2l(ax.range[0]);\n        var rl1 = ax.r2l(ax.range[1]);\n        return ax.l2r(rl0 + v * (rl1 - rl0));\n    };\n\n    // find the fraction of the range at the specified range value\n    ax.r2fraction = function(v) {\n        var rl0 = ax.r2l(ax.range[0]);\n        var rl1 = ax.r2l(ax.range[1]);\n        return (ax.r2l(v) - rl0) / (rl1 - rl0);\n    };\n\n    /*\n     * cleanRange: make sure range is a couplet of valid & distinct values\n     * keep numbers away from the limits of floating point numbers,\n     * and dates away from the ends of our date system (+/- 9999 years)\n     *\n     * optional param rangeAttr: operate on a different attribute, like\n     * ax._r, rather than ax.range\n     */\n    ax.cleanRange = function(rangeAttr, opts) {\n        if(!opts) opts = {};\n        if(!rangeAttr) rangeAttr = 'range';\n\n        var range = Lib.nestedProperty(ax, rangeAttr).get();\n        var i, dflt;\n\n        if(ax.type === 'date') dflt = Lib.dfltRange(ax.calendar);\n        else if(axLetter === 'y') dflt = constants.DFLTRANGEY;\n        else dflt = opts.dfltRange || constants.DFLTRANGEX;\n\n        // make sure we don't later mutate the defaults\n        dflt = dflt.slice();\n\n        if(ax.rangemode === 'tozero' || ax.rangemode === 'nonnegative') {\n            dflt[0] = 0;\n        }\n\n        if(!range || range.length !== 2) {\n            Lib.nestedProperty(ax, rangeAttr).set(dflt);\n            return;\n        }\n\n        if(ax.type === 'date' && !ax.autorange) {\n            // check if milliseconds or js date objects are provided for range\n            // and convert to date strings\n            range[0] = Lib.cleanDate(range[0], BADNUM, ax.calendar);\n            range[1] = Lib.cleanDate(range[1], BADNUM, ax.calendar);\n        }\n\n        for(i = 0; i < 2; i++) {\n            if(ax.type === 'date') {\n                if(!Lib.isDateTime(range[i], ax.calendar)) {\n                    ax[rangeAttr] = dflt;\n                    break;\n                }\n\n                if(ax.r2l(range[0]) === ax.r2l(range[1])) {\n                    // split by +/- 1 second\n                    var linCenter = Lib.constrain(ax.r2l(range[0]),\n                        Lib.MIN_MS + 1000, Lib.MAX_MS - 1000);\n                    range[0] = ax.l2r(linCenter - 1000);\n                    range[1] = ax.l2r(linCenter + 1000);\n                    break;\n                }\n            } else {\n                if(!isNumeric(range[i])) {\n                    if(isNumeric(range[1 - i])) {\n                        range[i] = range[1 - i] * (i ? 10 : 0.1);\n                    } else {\n                        ax[rangeAttr] = dflt;\n                        break;\n                    }\n                }\n\n                if(range[i] < -FP_SAFE) range[i] = -FP_SAFE;\n                else if(range[i] > FP_SAFE) range[i] = FP_SAFE;\n\n                if(range[0] === range[1]) {\n                    // somewhat arbitrary: split by 1 or 1ppm, whichever is bigger\n                    var inc = Math.max(1, Math.abs(range[0] * 1e-6));\n                    range[0] -= inc;\n                    range[1] += inc;\n                }\n            }\n        }\n    };\n\n    // set scaling to pixels\n    ax.setScale = function(usePrivateRange) {\n        var gs = fullLayout._size;\n\n        // make sure we have a domain (pull it in from the axis\n        // this one is overlaying if necessary)\n        if(ax.overlaying) {\n            var ax2 = axisIds.getFromId({ _fullLayout: fullLayout }, ax.overlaying);\n            ax.domain = ax2.domain;\n        }\n\n        // While transitions are occurring, we get a double-transform\n        // issue if we transform the drawn layer *and* use the new axis range to\n        // draw the data. This allows us to construct setConvert using the pre-\n        // interaction values of the range:\n        var rangeAttr = (usePrivateRange && ax._r) ? '_r' : 'range';\n        var calendar = ax.calendar;\n        ax.cleanRange(rangeAttr);\n\n        var rl0 = ax.r2l(ax[rangeAttr][0], calendar);\n        var rl1 = ax.r2l(ax[rangeAttr][1], calendar);\n\n        var isY = axLetter === 'y';\n        if(isY) {\n            ax._offset = gs.t + (1 - ax.domain[1]) * gs.h;\n            ax._length = gs.h * (ax.domain[1] - ax.domain[0]);\n            ax._m = ax._length / (rl0 - rl1);\n            ax._b = -ax._m * rl1;\n        } else {\n            ax._offset = gs.l + ax.domain[0] * gs.w;\n            ax._length = gs.w * (ax.domain[1] - ax.domain[0]);\n            ax._m = ax._length / (rl1 - rl0);\n            ax._b = -ax._m * rl0;\n        }\n\n        // set of \"N\" disjoint rangebreaks inside the range\n        ax._rangebreaks = [];\n        // length of these rangebreaks in value space - negative on reversed axes\n        ax._lBreaks = 0;\n        // l2p slope (same for all intervals)\n        ax._m2 = 0;\n        // set of l2p offsets (one for each of the (N+1) piecewise intervals)\n        ax._B = [];\n\n        if(ax.rangebreaks) {\n            var i, brk;\n\n            ax._rangebreaks = ax.locateBreaks(\n                Math.min(rl0, rl1),\n                Math.max(rl0, rl1)\n            );\n\n            if(ax._rangebreaks.length) {\n                for(i = 0; i < ax._rangebreaks.length; i++) {\n                    brk = ax._rangebreaks[i];\n                    ax._lBreaks += Math.abs(brk.max - brk.min);\n                }\n\n                var flip = isY;\n                if(rl0 > rl1) flip = !flip;\n                if(flip) ax._rangebreaks.reverse();\n                var sign = flip ? -1 : 1;\n\n                ax._m2 = sign * ax._length / (Math.abs(rl1 - rl0) - ax._lBreaks);\n                ax._B.push(-ax._m2 * (isY ? rl1 : rl0));\n                for(i = 0; i < ax._rangebreaks.length; i++) {\n                    brk = ax._rangebreaks[i];\n                    ax._B.push(\n                        ax._B[ax._B.length - 1] -\n                        sign * ax._m2 * (brk.max - brk.min)\n                    );\n                }\n\n                // fill pixel (i.e. 'p') min/max here,\n                // to not have to loop through the _rangebreaks twice during `p2l`\n                for(i = 0; i < ax._rangebreaks.length; i++) {\n                    brk = ax._rangebreaks[i];\n                    brk.pmin = l2p(brk.min);\n                    brk.pmax = l2p(brk.max);\n                }\n            }\n        }\n\n        if(!isFinite(ax._m) || !isFinite(ax._b) || ax._length < 0) {\n            fullLayout._replotting = false;\n            throw new Error('Something went wrong with axis scaling');\n        }\n    };\n\n    ax.maskBreaks = function(v) {\n        var rangebreaksIn = ax.rangebreaks || [];\n        var bnds, b0, b1, vb, vDate;\n\n\n        if(!rangebreaksIn._cachedPatterns) {\n            rangebreaksIn._cachedPatterns = rangebreaksIn.map(function(brk) {\n                return brk.enabled && brk.bounds ? Lib.simpleMap(brk.bounds, brk.pattern ?\n                    cleanNumber :\n                    ax.d2c // case of pattern: ''\n                ) : null;\n            });\n        }\n        if(!rangebreaksIn._cachedValues) {\n            rangebreaksIn._cachedValues = rangebreaksIn.map(function(brk) {\n                return brk.enabled && brk.values ? Lib.simpleMap(brk.values, ax.d2c).sort(Lib.sorterAsc) : null;\n            });\n        }\n\n\n        for(var i = 0; i < rangebreaksIn.length; i++) {\n            var brk = rangebreaksIn[i];\n\n            if(brk.enabled) {\n                if(brk.bounds) {\n                    var pattern = brk.pattern;\n                    bnds = rangebreaksIn._cachedPatterns[i];\n                    b0 = bnds[0];\n                    b1 = bnds[1];\n\n                    switch(pattern) {\n                        case WEEKDAY_PATTERN:\n                            vDate = new Date(v);\n                            vb = vDate.getUTCDay();\n\n                            if(b0 > b1) {\n                                b1 += 7;\n                                if(vb < b0) vb += 7;\n                            }\n\n                            break;\n                        case HOUR_PATTERN:\n                            vDate = new Date(v);\n                            var hours = vDate.getUTCHours();\n                            var minutes = vDate.getUTCMinutes();\n                            var seconds = vDate.getUTCSeconds();\n                            var milliseconds = vDate.getUTCMilliseconds();\n\n                            vb = hours + (\n                                minutes / 60 +\n                                seconds / 3600 +\n                                milliseconds / 3600000\n                            );\n\n                            if(b0 > b1) {\n                                b1 += 24;\n                                if(vb < b0) vb += 24;\n                            }\n\n                            break;\n                        case '':\n                            // N.B. should work on date axes as well!\n                            // e.g. { bounds: ['2020-01-04', '2020-01-05 23:59'] }\n                            // TODO should work with reversed-range axes\n                            vb = v;\n                            break;\n                    }\n\n                    if(vb >= b0 && vb < b1) return BADNUM;\n                } else {\n                    var vals = rangebreaksIn._cachedValues[i];\n                    for(var j = 0; j < vals.length; j++) {\n                        b0 = vals[j];\n                        b1 = b0 + brk.dvalue;\n                        if(v >= b0 && v < b1) return BADNUM;\n                    }\n                }\n            }\n        }\n        return v;\n    };\n\n    ax.locateBreaks = function(r0, r1) {\n        var i, bnds, b0, b1;\n\n        var rangebreaksOut = [];\n        if(!ax.rangebreaks) return rangebreaksOut;\n\n        var rangebreaksIn = ax.rangebreaks.slice().sort(function(a, b) {\n            if(a.pattern === WEEKDAY_PATTERN && b.pattern === HOUR_PATTERN) return -1;\n            if(b.pattern === WEEKDAY_PATTERN && a.pattern === HOUR_PATTERN) return 1;\n            return 0;\n        });\n\n        var addBreak = function(min, max) {\n            min = Lib.constrain(min, r0, r1);\n            max = Lib.constrain(max, r0, r1);\n            if(min === max) return;\n\n            var isNewBreak = true;\n            for(var j = 0; j < rangebreaksOut.length; j++) {\n                var brkj = rangebreaksOut[j];\n                if(min < brkj.max && max >= brkj.min) {\n                    if(min < brkj.min) {\n                        brkj.min = min;\n                    }\n                    if(max > brkj.max) {\n                        brkj.max = max;\n                    }\n                    isNewBreak = false;\n                }\n            }\n            if(isNewBreak) {\n                rangebreaksOut.push({min: min, max: max});\n            }\n        };\n\n        for(i = 0; i < rangebreaksIn.length; i++) {\n            var brk = rangebreaksIn[i];\n\n            if(brk.enabled) {\n                if(brk.bounds) {\n                    var t0 = r0;\n                    var t1 = r1;\n                    if(brk.pattern) {\n                        // to remove decimal (most often found in auto ranges)\n                        t0 = Math.floor(t0);\n                    }\n\n                    bnds = Lib.simpleMap(brk.bounds, brk.pattern ? cleanNumber : ax.r2l);\n                    b0 = bnds[0];\n                    b1 = bnds[1];\n\n                    // r0 value as date\n                    var t0Date = new Date(t0);\n                    // r0 value for break pattern\n                    var bndDelta;\n                    // step in ms between rangebreaks\n                    var step;\n\n                    switch(brk.pattern) {\n                        case WEEKDAY_PATTERN:\n                            step = ONEWEEK;\n\n                            bndDelta = (\n                                (b1 < b0 ? 7 : 0) +\n                                (b1 - b0)\n                            ) * ONEDAY;\n\n                            t0 += b0 * ONEDAY - (\n                                t0Date.getUTCDay() * ONEDAY +\n                                t0Date.getUTCHours() * ONEHOUR +\n                                t0Date.getUTCMinutes() * ONEMIN +\n                                t0Date.getUTCSeconds() * ONESEC +\n                                t0Date.getUTCMilliseconds()\n                            );\n                            break;\n                        case HOUR_PATTERN:\n                            step = ONEDAY;\n\n                            bndDelta = (\n                                (b1 < b0 ? 24 : 0) +\n                                (b1 - b0)\n                            ) * ONEHOUR;\n\n                            t0 += b0 * ONEHOUR - (\n                                t0Date.getUTCHours() * ONEHOUR +\n                                t0Date.getUTCMinutes() * ONEMIN +\n                                t0Date.getUTCSeconds() * ONESEC +\n                                t0Date.getUTCMilliseconds()\n                            );\n                            break;\n                        default:\n                            t0 = Math.min(bnds[0], bnds[1]);\n                            t1 = Math.max(bnds[0], bnds[1]);\n                            step = t1 - t0;\n                            bndDelta = step;\n                    }\n\n                    for(var t = t0; t < t1; t += step) {\n                        addBreak(t, t + bndDelta);\n                    }\n                } else {\n                    var vals = Lib.simpleMap(brk.values, ax.d2c);\n                    for(var j = 0; j < vals.length; j++) {\n                        b0 = vals[j];\n                        b1 = b0 + brk.dvalue;\n                        addBreak(b0, b1);\n                    }\n                }\n            }\n        }\n\n        rangebreaksOut.sort(function(a, b) { return a.min - b.min; });\n\n        return rangebreaksOut;\n    };\n\n    // makeCalcdata: takes an x or y array and converts it\n    // to a position on the axis object \"ax\"\n    // inputs:\n    //      trace - a data object from gd.data\n    //      axLetter - a string, either 'x' or 'y', for which item\n    //          to convert (TODO: is this now always the same as\n    //          the first letter of ax._id?)\n    // in case the expected data isn't there, make a list of\n    // integers based on the opposite data\n    ax.makeCalcdata = function(trace, axLetter, opts) {\n        var arrayIn, arrayOut, i, len;\n\n        var axType = ax.type;\n        var cal = axType === 'date' && trace[axLetter + 'calendar'];\n\n        if(axLetter in trace) {\n            arrayIn = trace[axLetter];\n            len = trace._length || Lib.minRowLength(arrayIn);\n\n            if(Lib.isTypedArray(arrayIn) && (axType === 'linear' || axType === 'log')) {\n                if(len === arrayIn.length) {\n                    return arrayIn;\n                } else if(arrayIn.subarray) {\n                    return arrayIn.subarray(0, len);\n                }\n            }\n\n            if(axType === 'multicategory') {\n                return setMultiCategoryIndex(arrayIn, len);\n            }\n\n            arrayOut = new Array(len);\n            for(i = 0; i < len; i++) {\n                arrayOut[i] = ax.d2c(arrayIn[i], 0, cal, opts);\n            }\n        } else {\n            var v0 = ((axLetter + '0') in trace) ? ax.d2c(trace[axLetter + '0'], 0, cal) : 0;\n            var dv = (trace['d' + axLetter]) ? Number(trace['d' + axLetter]) : 1;\n\n            // the opposing data, for size if we have x and dx etc\n            arrayIn = trace[{x: 'y', y: 'x'}[axLetter]];\n            len = trace._length || arrayIn.length;\n            arrayOut = new Array(len);\n\n            for(i = 0; i < len; i++) {\n                arrayOut[i] = v0 + i * dv;\n            }\n        }\n\n        // mask (i.e. set to BADNUM) coords that fall inside rangebreaks\n        if(ax.rangebreaks) {\n            for(i = 0; i < len; i++) {\n                arrayOut[i] = ax.maskBreaks(arrayOut[i]);\n            }\n        }\n\n        return arrayOut;\n    };\n\n    ax.isValidRange = function(range) {\n        return (\n            Array.isArray(range) &&\n            range.length === 2 &&\n            isNumeric(ax.r2l(range[0])) &&\n            isNumeric(ax.r2l(range[1]))\n        );\n    };\n\n    ax.isPtWithinRange = function(d, calendar) {\n        var coord = ax.c2l(d[axLetter], null, calendar);\n        var r0 = ax.r2l(ax.range[0]);\n        var r1 = ax.r2l(ax.range[1]);\n\n        if(r0 < r1) {\n            return r0 <= coord && coord <= r1;\n        } else {\n            // Reversed axis case.\n            return r1 <= coord && coord <= r0;\n        }\n    };\n\n    ax._emptyCategories = function() {\n        ax._categories = [];\n        ax._categoriesMap = {};\n    };\n\n    // should skip if not category nor multicategory\n    ax.clearCalc = function() {\n        var group = ax._matchGroup;\n        if(group) {\n            var categories = null;\n            var categoriesMap = null;\n\n            for(var axId2 in group) {\n                var ax2 = fullLayout[axisIds.id2name(axId2)];\n                if(ax2._categories) {\n                    categories = ax2._categories;\n                    categoriesMap = ax2._categoriesMap;\n                    break;\n                }\n            }\n\n            if(categories && categoriesMap) {\n                ax._categories = categories;\n                ax._categoriesMap = categoriesMap;\n            } else {\n                ax._emptyCategories();\n            }\n        } else {\n            ax._emptyCategories();\n        }\n\n        if(ax._initialCategories) {\n            for(var j = 0; j < ax._initialCategories.length; j++) {\n                setCategoryIndex(ax._initialCategories[j]);\n            }\n        }\n    };\n\n    // sort the axis (and all the matching ones) by _initialCategories\n    // returns the indices of the traces affected by the reordering\n    ax.sortByInitialCategories = function() {\n        var affectedTraces = [];\n\n        ax._emptyCategories();\n\n        if(ax._initialCategories) {\n            for(var j = 0; j < ax._initialCategories.length; j++) {\n                setCategoryIndex(ax._initialCategories[j]);\n            }\n        }\n\n        affectedTraces = affectedTraces.concat(ax._traceIndices);\n\n        // Propagate to matching axes\n        var group = ax._matchGroup;\n        for(var axId2 in group) {\n            if(axId === axId2) continue;\n            var ax2 = fullLayout[axisIds.id2name(axId2)];\n            ax2._categories = ax._categories;\n            ax2._categoriesMap = ax._categoriesMap;\n            affectedTraces = affectedTraces.concat(ax2._traceIndices);\n        }\n        return affectedTraces;\n    };\n\n    // Propagate localization into the axis so that\n    // methods in Axes can use it w/o having to pass fullLayout\n    // Default (non-d3) number formatting uses separators directly\n    // dates and d3-formatted numbers use the d3 locale\n    // Fall back on default format for dummy axes that don't care about formatting\n    var locale = fullLayout._d3locale;\n    if(ax.type === 'date') {\n        ax._dateFormat = locale ? locale.timeFormat : utcFormat;\n        ax._extraFormat = fullLayout._extraFormat;\n    }\n    // occasionally we need _numFormat to pass through\n    // even though it won't be needed by this axis\n    ax._separators = fullLayout.separators;\n    ax._numFormat = locale ? locale.numberFormat : d3.format;\n\n    // and for bar charts and box plots: reset forced minimum tick spacing\n    delete ax._minDtick;\n    delete ax._forceTick0;\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar contrast = require('../../components/color').contrast;\nvar layoutAttributes = require('./layout_attributes');\nvar handleArrayContainerDefaults = require('../array_container_defaults');\n\nmodule.exports = function handleTickLabelDefaults(containerIn, containerOut, coerce, axType, options, config) {\n    if(!config || config.pass === 1) {\n        handlePrefixSuffix(containerIn, containerOut, coerce, axType, options);\n    }\n\n    if(!config || config.pass === 2) {\n        handleOtherDefaults(containerIn, containerOut, coerce, axType, options);\n    }\n};\n\nfunction handlePrefixSuffix(containerIn, containerOut, coerce, axType, options) {\n    var showAttrDflt = getShowAttrDflt(containerIn);\n\n    var tickPrefix = coerce('tickprefix');\n    if(tickPrefix) coerce('showtickprefix', showAttrDflt);\n\n    var tickSuffix = coerce('ticksuffix', options.tickSuffixDflt);\n    if(tickSuffix) coerce('showticksuffix', showAttrDflt);\n}\n\nfunction handleOtherDefaults(containerIn, containerOut, coerce, axType, options) {\n    var showAttrDflt = getShowAttrDflt(containerIn);\n\n    var tickPrefix = coerce('tickprefix');\n    if(tickPrefix) coerce('showtickprefix', showAttrDflt);\n\n    var tickSuffix = coerce('ticksuffix', options.tickSuffixDflt);\n    if(tickSuffix) coerce('showticksuffix', showAttrDflt);\n\n    var showTickLabels = coerce('showticklabels');\n    if(showTickLabels) {\n        var font = options.font || {};\n        var contColor = containerOut.color;\n        var position = containerOut.ticklabelposition || '';\n        var dfltFontColor = position.indexOf('inside') !== -1 ?\n            contrast(options.bgColor) :\n            // as with titlefont.color, inherit axis.color only if one was\n            // explicitly provided\n            (contColor && contColor !== layoutAttributes.color.dflt) ?\n            contColor : font.color;\n\n        Lib.coerceFont(coerce, 'tickfont', {\n            family: font.family,\n            size: font.size,\n            color: dfltFontColor\n        });\n        coerce('tickangle');\n\n        if(axType !== 'category') {\n            var tickFormat = coerce('tickformat');\n\n            handleArrayContainerDefaults(containerIn, containerOut, {\n                name: 'tickformatstops',\n                inclusionAttr: 'enabled',\n                handleItemDefaults: tickformatstopDefaults\n            });\n            if(!containerOut.tickformatstops.length) {\n                delete containerOut.tickformatstops;\n            }\n\n            if(!tickFormat && axType !== 'date') {\n                coerce('showexponent', showAttrDflt);\n                coerce('exponentformat');\n                coerce('minexponent');\n                coerce('separatethousands');\n            }\n        }\n    }\n}\n\n/*\n * Attributes 'showexponent', 'showtickprefix' and 'showticksuffix'\n * share values.\n *\n * If only 1 attribute is set,\n * the remaining attributes inherit that value.\n *\n * If 2 attributes are set to the same value,\n * the remaining attribute inherits that value.\n *\n * If 2 attributes are set to different values,\n * the remaining is set to its dflt value.\n *\n */\nfunction getShowAttrDflt(containerIn) {\n    var showAttrsAll = ['showexponent', 'showtickprefix', 'showticksuffix'];\n    var showAttrs = showAttrsAll.filter(function(a) {\n        return containerIn[a] !== undefined;\n    });\n    var sameVal = function(a) {\n        return containerIn[a] === containerIn[showAttrs[0]];\n    };\n\n    if(showAttrs.every(sameVal) || showAttrs.length === 1) {\n        return containerIn[showAttrs[0]];\n    }\n}\n\nfunction tickformatstopDefaults(valueIn, valueOut) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(valueIn, valueOut, layoutAttributes.tickformatstops, attr, dflt);\n    }\n\n    var enabled = coerce('enabled');\n    if(enabled) {\n        coerce('dtickrange');\n        coerce('value');\n    }\n}\n","'use strict';\n\nvar Lib = require('../../lib');\n\nvar layoutAttributes = require('./layout_attributes');\n\n\n/**\n * options: inherits outerTicks from axes.handleAxisDefaults\n */\nmodule.exports = function handleTickDefaults(containerIn, containerOut, coerce, options) {\n    var tickLen = Lib.coerce2(containerIn, containerOut, layoutAttributes, 'ticklen');\n    var tickWidth = Lib.coerce2(containerIn, containerOut, layoutAttributes, 'tickwidth');\n    var tickColor = Lib.coerce2(containerIn, containerOut, layoutAttributes, 'tickcolor', containerOut.color);\n    var showTicks = coerce('ticks', (options.outerTicks || tickLen || tickWidth || tickColor) ? 'outside' : '');\n\n    if(!showTicks) {\n        delete containerOut.ticklen;\n        delete containerOut.tickwidth;\n        delete containerOut.tickcolor;\n    }\n};\n","'use strict';\n\nvar cleanTicks = require('./clean_ticks');\nvar isArrayOrTypedArray = require('../../lib').isArrayOrTypedArray;\n\nmodule.exports = function handleTickValueDefaults(containerIn, containerOut, coerce, axType) {\n    function readInput(attr) {\n        var v = containerIn[attr];\n        return (\n            v !== undefined\n        ) ? v : (containerOut._template || {})[attr];\n    }\n\n    var _tick0 = readInput('tick0');\n    var _dtick = readInput('dtick');\n    var _tickvals = readInput('tickvals');\n\n    var tickmodeDefault = isArrayOrTypedArray(_tickvals) ? 'array' :\n        _dtick ? 'linear' :\n        'auto';\n    var tickmode = coerce('tickmode', tickmodeDefault);\n\n    if(tickmode === 'auto') coerce('nticks');\n    else if(tickmode === 'linear') {\n        // dtick is usually a positive number, but there are some\n        // special strings available for log or date axes\n        // tick0 also has special logic\n        var dtick = containerOut.dtick = cleanTicks.dtick(\n            _dtick, axType);\n        containerOut.tick0 = cleanTicks.tick0(\n            _tick0, axType, containerOut.calendar, dtick);\n    } else if(axType !== 'multicategory') {\n        var tickvals = coerce('tickvals');\n        if(tickvals === undefined) containerOut.tickmode = 'auto';\n        else coerce('ticktext');\n    }\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar Drawing = require('../../components/drawing');\nvar Axes = require('./axes');\n\n/**\n * transitionAxes\n *\n * transition axes from one set of ranges to another, using a svg\n * transformations, similar to during panning.\n *\n * @param {DOM element | object} gd\n * @param {array} edits : array of 'edits', each item with\n * - plotinfo {object} subplot object\n * - xr0 {array} initial x-range\n * - xr1 {array} end x-range\n * - yr0 {array} initial y-range\n * - yr1 {array} end y-range\n * @param {object} transitionOpts\n * @param {function} makeOnCompleteCallback\n */\nmodule.exports = function transitionAxes(gd, edits, transitionOpts, makeOnCompleteCallback) {\n    var fullLayout = gd._fullLayout;\n\n    // special case for redraw:false Plotly.animate that relies on this\n    // to update axis-referenced layout components\n    if(edits.length === 0) {\n        Axes.redrawComponents(gd);\n        return;\n    }\n\n    function unsetSubplotTransform(subplot) {\n        var xa = subplot.xaxis;\n        var ya = subplot.yaxis;\n\n        fullLayout._defs.select('#' + subplot.clipId + '> rect')\n            .call(Drawing.setTranslate, 0, 0)\n            .call(Drawing.setScale, 1, 1);\n\n        subplot.plot\n            .call(Drawing.setTranslate, xa._offset, ya._offset)\n            .call(Drawing.setScale, 1, 1);\n\n        var traceGroups = subplot.plot.selectAll('.scatterlayer .trace');\n\n        // This is specifically directed at scatter traces, applying an inverse\n        // scale to individual points to counteract the scale of the trace\n        // as a whole:\n        traceGroups.selectAll('.point')\n            .call(Drawing.setPointGroupScale, 1, 1);\n        traceGroups.selectAll('.textpoint')\n            .call(Drawing.setTextPointsScale, 1, 1);\n        traceGroups\n            .call(Drawing.hideOutsideRangePoints, subplot);\n    }\n\n    function updateSubplot(edit, progress) {\n        var plotinfo = edit.plotinfo;\n        var xa = plotinfo.xaxis;\n        var ya = plotinfo.yaxis;\n        var xlen = xa._length;\n        var ylen = ya._length;\n        var editX = !!edit.xr1;\n        var editY = !!edit.yr1;\n        var viewBox = [];\n\n        if(editX) {\n            var xr0 = Lib.simpleMap(edit.xr0, xa.r2l);\n            var xr1 = Lib.simpleMap(edit.xr1, xa.r2l);\n            var dx0 = xr0[1] - xr0[0];\n            var dx1 = xr1[1] - xr1[0];\n            viewBox[0] = (xr0[0] * (1 - progress) + progress * xr1[0] - xr0[0]) / (xr0[1] - xr0[0]) * xlen;\n            viewBox[2] = xlen * ((1 - progress) + progress * dx1 / dx0);\n            xa.range[0] = xa.l2r(xr0[0] * (1 - progress) + progress * xr1[0]);\n            xa.range[1] = xa.l2r(xr0[1] * (1 - progress) + progress * xr1[1]);\n        } else {\n            viewBox[0] = 0;\n            viewBox[2] = xlen;\n        }\n\n        if(editY) {\n            var yr0 = Lib.simpleMap(edit.yr0, ya.r2l);\n            var yr1 = Lib.simpleMap(edit.yr1, ya.r2l);\n            var dy0 = yr0[1] - yr0[0];\n            var dy1 = yr1[1] - yr1[0];\n            viewBox[1] = (yr0[1] * (1 - progress) + progress * yr1[1] - yr0[1]) / (yr0[0] - yr0[1]) * ylen;\n            viewBox[3] = ylen * ((1 - progress) + progress * dy1 / dy0);\n            ya.range[0] = xa.l2r(yr0[0] * (1 - progress) + progress * yr1[0]);\n            ya.range[1] = ya.l2r(yr0[1] * (1 - progress) + progress * yr1[1]);\n        } else {\n            viewBox[1] = 0;\n            viewBox[3] = ylen;\n        }\n\n        Axes.drawOne(gd, xa, {skipTitle: true});\n        Axes.drawOne(gd, ya, {skipTitle: true});\n        Axes.redrawComponents(gd, [xa._id, ya._id]);\n\n        var xScaleFactor = editX ? xlen / viewBox[2] : 1;\n        var yScaleFactor = editY ? ylen / viewBox[3] : 1;\n        var clipDx = editX ? viewBox[0] : 0;\n        var clipDy = editY ? viewBox[1] : 0;\n        var fracDx = editX ? (viewBox[0] / viewBox[2] * xlen) : 0;\n        var fracDy = editY ? (viewBox[1] / viewBox[3] * ylen) : 0;\n        var plotDx = xa._offset - fracDx;\n        var plotDy = ya._offset - fracDy;\n\n        plotinfo.clipRect\n            .call(Drawing.setTranslate, clipDx, clipDy)\n            .call(Drawing.setScale, 1 / xScaleFactor, 1 / yScaleFactor);\n\n        plotinfo.plot\n            .call(Drawing.setTranslate, plotDx, plotDy)\n            .call(Drawing.setScale, xScaleFactor, yScaleFactor);\n\n        // apply an inverse scale to individual points to counteract\n        // the scale of the trace group.\n        Drawing.setPointGroupScale(plotinfo.zoomScalePts, 1 / xScaleFactor, 1 / yScaleFactor);\n        Drawing.setTextPointsScale(plotinfo.zoomScaleTxt, 1 / xScaleFactor, 1 / yScaleFactor);\n    }\n\n    var onComplete;\n    if(makeOnCompleteCallback) {\n        // This module makes the choice whether or not it notifies Plotly.transition\n        // about completion:\n        onComplete = makeOnCompleteCallback();\n    }\n\n    function transitionComplete() {\n        var aobj = {};\n\n        for(var i = 0; i < edits.length; i++) {\n            var edit = edits[i];\n            var xa = edit.plotinfo.xaxis;\n            var ya = edit.plotinfo.yaxis;\n            if(edit.xr1) aobj[xa._name + '.range'] = edit.xr1.slice();\n            if(edit.yr1) aobj[ya._name + '.range'] = edit.yr1.slice();\n        }\n\n        // Signal that this transition has completed:\n        onComplete && onComplete();\n\n        return Registry.call('relayout', gd, aobj).then(function() {\n            for(var i = 0; i < edits.length; i++) {\n                unsetSubplotTransform(edits[i].plotinfo);\n            }\n        });\n    }\n\n    function transitionInterrupt() {\n        var aobj = {};\n\n        for(var i = 0; i < edits.length; i++) {\n            var edit = edits[i];\n            var xa = edit.plotinfo.xaxis;\n            var ya = edit.plotinfo.yaxis;\n            if(edit.xr0) aobj[xa._name + '.range'] = edit.xr0.slice();\n            if(edit.yr0) aobj[ya._name + '.range'] = edit.yr0.slice();\n        }\n\n        return Registry.call('relayout', gd, aobj).then(function() {\n            for(var i = 0; i < edits.length; i++) {\n                unsetSubplotTransform(edits[i].plotinfo);\n            }\n        });\n    }\n\n    var t1, t2, raf;\n    var easeFn = d3.ease(transitionOpts.easing);\n\n    gd._transitionData._interruptCallbacks.push(function() {\n        window.cancelAnimationFrame(raf);\n        raf = null;\n        return transitionInterrupt();\n    });\n\n    function doFrame() {\n        t2 = Date.now();\n\n        var tInterp = Math.min(1, (t2 - t1) / transitionOpts.duration);\n        var progress = easeFn(tInterp);\n\n        for(var i = 0; i < edits.length; i++) {\n            updateSubplot(edits[i], progress);\n        }\n\n        if(t2 - t1 > transitionOpts.duration) {\n            transitionComplete();\n            raf = window.cancelAnimationFrame(doFrame);\n        } else {\n            raf = window.requestAnimationFrame(doFrame);\n        }\n    }\n\n    t1 = Date.now();\n    raf = window.requestAnimationFrame(doFrame);\n\n    return Promise.resolve();\n};\n","'use strict';\n\nvar traceIs = require('../../registry').traceIs;\nvar autoType = require('./axis_autotype');\n\n/*\n *  data: the plot data to use in choosing auto type\n *  name: axis object name (ie 'xaxis') if one should be stored\n */\nmodule.exports = function handleTypeDefaults(containerIn, containerOut, coerce, options) {\n    coerce('autotypenumbers', options.autotypenumbersDflt);\n    var axType = coerce('type', (options.splomStash || {}).type);\n\n    if(axType === '-') {\n        setAutoType(containerOut, options.data);\n\n        if(containerOut.type === '-') {\n            containerOut.type = 'linear';\n        } else {\n            // copy autoType back to input axis\n            // note that if this object didn't exist\n            // in the input layout, we have to put it in\n            // this happens in the main supplyDefaults function\n            containerIn.type = containerOut.type;\n        }\n    }\n};\n\nfunction setAutoType(ax, data) {\n    // new logic: let people specify any type they want,\n    // only autotype if type is '-'\n    if(ax.type !== '-') return;\n\n    var id = ax._id;\n    var axLetter = id.charAt(0);\n    var i;\n\n    // support 3d\n    if(id.indexOf('scene') !== -1) id = axLetter;\n\n    var d0 = getFirstNonEmptyTrace(data, id, axLetter);\n    if(!d0) return;\n\n    // first check for histograms, as the count direction\n    // should always default to a linear axis\n    if(d0.type === 'histogram' &&\n        axLetter === {v: 'y', h: 'x'}[d0.orientation || 'v']\n    ) {\n        ax.type = 'linear';\n        return;\n    }\n\n    var calAttr = axLetter + 'calendar';\n    var calendar = d0[calAttr];\n    var opts = {noMultiCategory: !traceIs(d0, 'cartesian') || traceIs(d0, 'noMultiCategory')};\n\n    // To not confuse 2D x/y used for per-box sample points for multicategory coordinates\n    if(d0.type === 'box' && d0._hasPreCompStats &&\n        axLetter === {h: 'x', v: 'y'}[d0.orientation || 'v']\n    ) {\n        opts.noMultiCategory = true;\n    }\n\n    opts.autotypenumbers = ax.autotypenumbers;\n\n    // check all boxes on this x axis to see\n    // if they're dates, numbers, or categories\n    if(isBoxWithoutPositionCoords(d0, axLetter)) {\n        var posLetter = getBoxPosLetter(d0);\n        var boxPositions = [];\n\n        for(i = 0; i < data.length; i++) {\n            var trace = data[i];\n            if(!traceIs(trace, 'box-violin') || (trace[axLetter + 'axis'] || axLetter) !== id) continue;\n\n            if(trace[posLetter] !== undefined) boxPositions.push(trace[posLetter][0]);\n            else if(trace.name !== undefined) boxPositions.push(trace.name);\n            else boxPositions.push('text');\n\n            if(trace[calAttr] !== calendar) calendar = undefined;\n        }\n\n        ax.type = autoType(boxPositions, calendar, opts);\n    } else if(d0.type === 'splom') {\n        var dimensions = d0.dimensions;\n        var dim = dimensions[d0._axesDim[id]];\n        if(dim.visible) ax.type = autoType(dim.values, calendar, opts);\n    } else {\n        ax.type = autoType(d0[axLetter] || [d0[axLetter + '0']], calendar, opts);\n    }\n}\n\nfunction getFirstNonEmptyTrace(data, id, axLetter) {\n    for(var i = 0; i < data.length; i++) {\n        var trace = data[i];\n\n        if(trace.type === 'splom' &&\n                trace._length > 0 &&\n                (trace['_' + axLetter + 'axes'] || {})[id]\n        ) {\n            return trace;\n        }\n\n        if((trace[axLetter + 'axis'] || axLetter) === id) {\n            if(isBoxWithoutPositionCoords(trace, axLetter)) {\n                return trace;\n            } else if((trace[axLetter] || []).length || trace[axLetter + '0']) {\n                return trace;\n            }\n        }\n    }\n}\n\nfunction getBoxPosLetter(trace) {\n    return {v: 'x', h: 'y'}[trace.orientation || 'v'];\n}\n\nfunction isBoxWithoutPositionCoords(trace, axLetter) {\n    var posLetter = getBoxPosLetter(trace);\n    var isBox = traceIs(trace, 'box-violin');\n    var isCandlestick = traceIs(trace._fullInput || {}, 'candlestick');\n\n    return (\n        isBox &&\n        !isCandlestick &&\n        axLetter === posLetter &&\n        trace[posLetter] === undefined &&\n        trace[posLetter + '0'] === undefined\n    );\n}\n","'use strict';\n\nvar Registry = require('../registry');\nvar Lib = require('../lib');\n\n/*\n * Create or update an observer. This function is designed to be\n * idempotent so that it can be called over and over as the component\n * updates, and will attach and detach listeners as needed.\n *\n * @param {optional object} container\n *      An object on which the observer is stored. This is the mechanism\n *      by which it is idempotent. If it already exists, another won't be\n *      added. Each time it's called, the value lookup table is updated.\n * @param {array} commandList\n *      An array of commands, following either `buttons` of `updatemenus`\n *      or `steps` of `sliders`.\n * @param {function} onchange\n *      A listener called when the value is changed. Receives data object\n *      with information about the new state.\n */\nexports.manageCommandObserver = function(gd, container, commandList, onchange) {\n    var ret = {};\n    var enabled = true;\n\n    if(container && container._commandObserver) {\n        ret = container._commandObserver;\n    }\n\n    if(!ret.cache) {\n        ret.cache = {};\n    }\n\n    // Either create or just recompute this:\n    ret.lookupTable = {};\n\n    var binding = exports.hasSimpleAPICommandBindings(gd, commandList, ret.lookupTable);\n\n    if(container && container._commandObserver) {\n        if(!binding) {\n            // If container exists and there are no longer any bindings,\n            // remove existing:\n            if(container._commandObserver.remove) {\n                container._commandObserver.remove();\n                container._commandObserver = null;\n                return ret;\n            }\n        } else {\n            // If container exists and there *are* bindings, then the lookup\n            // table should have been updated and check is already attached,\n            // so there's nothing to be done:\n            return ret;\n        }\n    }\n\n    // Determine whether there's anything to do for this binding:\n\n    if(binding) {\n        // Build the cache:\n        bindingValueHasChanged(gd, binding, ret.cache);\n\n        ret.check = function check() {\n            if(!enabled) return;\n\n            var update = bindingValueHasChanged(gd, binding, ret.cache);\n\n            if(update.changed && onchange) {\n                // Disable checks for the duration of this command in order to avoid\n                // infinite loops:\n                if(ret.lookupTable[update.value] !== undefined) {\n                    ret.disable();\n                    Promise.resolve(onchange({\n                        value: update.value,\n                        type: binding.type,\n                        prop: binding.prop,\n                        traces: binding.traces,\n                        index: ret.lookupTable[update.value]\n                    })).then(ret.enable, ret.enable);\n                }\n            }\n\n            return update.changed;\n        };\n\n        var checkEvents = [\n            'plotly_relayout',\n            'plotly_redraw',\n            'plotly_restyle',\n            'plotly_update',\n            'plotly_animatingframe',\n            'plotly_afterplot'\n        ];\n\n        for(var i = 0; i < checkEvents.length; i++) {\n            gd._internalOn(checkEvents[i], ret.check);\n        }\n\n        ret.remove = function() {\n            for(var i = 0; i < checkEvents.length; i++) {\n                gd._removeInternalListener(checkEvents[i], ret.check);\n            }\n        };\n    } else {\n        // TODO: It'd be really neat to actually give a *reason* for this, but at least a warning\n        // is a start\n        Lib.log('Unable to automatically bind plot updates to API command');\n\n        ret.lookupTable = {};\n        ret.remove = function() {};\n    }\n\n    ret.disable = function disable() {\n        enabled = false;\n    };\n\n    ret.enable = function enable() {\n        enabled = true;\n    };\n\n    if(container) {\n        container._commandObserver = ret;\n    }\n\n    return ret;\n};\n\n/*\n * This function checks to see if an array of objects containing\n * method and args properties is compatible with automatic two-way\n * binding. The criteria right now are that\n *\n *   1. multiple traces may be affected\n *   2. only one property may be affected\n *   3. the same property must be affected by all commands\n */\nexports.hasSimpleAPICommandBindings = function(gd, commandList, bindingsByValue) {\n    var i;\n    var n = commandList.length;\n\n    var refBinding;\n\n    for(i = 0; i < n; i++) {\n        var binding;\n        var command = commandList[i];\n        var method = command.method;\n        var args = command.args;\n\n        if(!Array.isArray(args)) args = [];\n\n        // If any command has no method, refuse to bind:\n        if(!method) {\n            return false;\n        }\n        var bindings = exports.computeAPICommandBindings(gd, method, args);\n\n        // Right now, handle one and *only* one property being set:\n        if(bindings.length !== 1) {\n            return false;\n        }\n\n        if(!refBinding) {\n            refBinding = bindings[0];\n            if(Array.isArray(refBinding.traces)) {\n                refBinding.traces.sort();\n            }\n        } else {\n            binding = bindings[0];\n            if(binding.type !== refBinding.type) {\n                return false;\n            }\n            if(binding.prop !== refBinding.prop) {\n                return false;\n            }\n            if(Array.isArray(refBinding.traces)) {\n                if(Array.isArray(binding.traces)) {\n                    binding.traces.sort();\n                    for(var j = 0; j < refBinding.traces.length; j++) {\n                        if(refBinding.traces[j] !== binding.traces[j]) {\n                            return false;\n                        }\n                    }\n                } else {\n                    return false;\n                }\n            } else {\n                if(binding.prop !== refBinding.prop) {\n                    return false;\n                }\n            }\n        }\n\n        binding = bindings[0];\n        var value = binding.value;\n        if(Array.isArray(value)) {\n            if(value.length === 1) {\n                value = value[0];\n            } else {\n                return false;\n            }\n        }\n        if(bindingsByValue) {\n            bindingsByValue[value] = i;\n        }\n    }\n\n    return refBinding;\n};\n\nfunction bindingValueHasChanged(gd, binding, cache) {\n    var container, value, obj;\n    var changed = false;\n\n    if(binding.type === 'data') {\n        // If it's data, we need to get a trace. Based on the limited scope\n        // of what we cover, we can just take the first trace from the list,\n        // or otherwise just the first trace:\n        container = gd._fullData[binding.traces !== null ? binding.traces[0] : 0];\n    } else if(binding.type === 'layout') {\n        container = gd._fullLayout;\n    } else {\n        return false;\n    }\n\n    value = Lib.nestedProperty(container, binding.prop).get();\n\n    obj = cache[binding.type] = cache[binding.type] || {};\n\n    if(obj.hasOwnProperty(binding.prop)) {\n        if(obj[binding.prop] !== value) {\n            changed = true;\n        }\n    }\n\n    obj[binding.prop] = value;\n\n    return {\n        changed: changed,\n        value: value\n    };\n}\n\n/*\n * Execute an API command. There's really not much to this; it just provides\n * a common hook so that implementations don't need to be synchronized across\n * multiple components with the ability to invoke API commands.\n *\n * @param {string} method\n *      The name of the plotly command to execute. Must be one of 'animate',\n *      'restyle', 'relayout', 'update'.\n * @param {array} args\n *      A list of arguments passed to the API command\n */\nexports.executeAPICommand = function(gd, method, args) {\n    if(method === 'skip') return Promise.resolve();\n\n    var _method = Registry.apiMethodRegistry[method];\n    var allArgs = [gd];\n    if(!Array.isArray(args)) args = [];\n\n    for(var i = 0; i < args.length; i++) {\n        allArgs.push(args[i]);\n    }\n\n    return _method.apply(null, allArgs).catch(function(err) {\n        Lib.warn('API call to Plotly.' + method + ' rejected.', err);\n        return Promise.reject(err);\n    });\n};\n\nexports.computeAPICommandBindings = function(gd, method, args) {\n    var bindings;\n\n    if(!Array.isArray(args)) args = [];\n\n    switch(method) {\n        case 'restyle':\n            bindings = computeDataBindings(gd, args);\n            break;\n        case 'relayout':\n            bindings = computeLayoutBindings(gd, args);\n            break;\n        case 'update':\n            bindings = computeDataBindings(gd, [args[0], args[2]])\n                .concat(computeLayoutBindings(gd, [args[1]]));\n            break;\n        case 'animate':\n            bindings = computeAnimateBindings(gd, args);\n            break;\n        default:\n            // This is the case where intelligent logic about what affects\n            // this command is not implemented. It causes no ill effects.\n            // For example, addFrames simply won't bind to a control component.\n            bindings = [];\n    }\n    return bindings;\n};\n\nfunction computeAnimateBindings(gd, args) {\n    // We'll assume that the only relevant modification an animation\n    // makes that's meaningfully tracked is the frame:\n    if(Array.isArray(args[0]) && args[0].length === 1 && ['string', 'number'].indexOf(typeof args[0][0]) !== -1) {\n        return [{type: 'layout', prop: '_currentFrame', value: args[0][0].toString()}];\n    } else {\n        return [];\n    }\n}\n\nfunction computeLayoutBindings(gd, args) {\n    var bindings = [];\n\n    var astr = args[0];\n    var aobj = {};\n    if(typeof astr === 'string') {\n        aobj[astr] = args[1];\n    } else if(Lib.isPlainObject(astr)) {\n        aobj = astr;\n    } else {\n        return bindings;\n    }\n\n    crawl(aobj, function(path, attrName, attr) {\n        bindings.push({type: 'layout', prop: path, value: attr});\n    }, '', 0);\n\n    return bindings;\n}\n\nfunction computeDataBindings(gd, args) {\n    var traces, astr, val, aobj;\n    var bindings = [];\n\n    // Logic copied from Plotly.restyle:\n    astr = args[0];\n    val = args[1];\n    traces = args[2];\n    aobj = {};\n    if(typeof astr === 'string') {\n        aobj[astr] = val;\n    } else if(Lib.isPlainObject(astr)) {\n        // the 3-arg form\n        aobj = astr;\n\n        if(traces === undefined) {\n            traces = val;\n        }\n    } else {\n        return bindings;\n    }\n\n    if(traces === undefined) {\n        // Explicitly assign this to null instead of undefined:\n        traces = null;\n    }\n\n    crawl(aobj, function(path, attrName, _attr) {\n        var thisTraces;\n        var attr;\n\n        if(Array.isArray(_attr)) {\n            attr = _attr.slice();\n\n            var nAttr = Math.min(attr.length, gd.data.length);\n            if(traces) {\n                nAttr = Math.min(nAttr, traces.length);\n            }\n            thisTraces = [];\n            for(var j = 0; j < nAttr; j++) {\n                thisTraces[j] = traces ? traces[j] : j;\n            }\n        } else {\n            attr = _attr;\n            thisTraces = traces ? traces.slice() : null;\n        }\n\n        // Convert [7] to just 7 when traces is null:\n        if(thisTraces === null) {\n            if(Array.isArray(attr)) {\n                attr = attr[0];\n            }\n        } else if(Array.isArray(thisTraces)) {\n            if(!Array.isArray(attr)) {\n                var tmp = attr;\n                attr = [];\n                for(var i = 0; i < thisTraces.length; i++) {\n                    attr[i] = tmp;\n                }\n            }\n            attr.length = Math.min(thisTraces.length, attr.length);\n        }\n\n        bindings.push({\n            type: 'data',\n            prop: path,\n            traces: thisTraces,\n            value: attr\n        });\n    }, '', 0);\n\n    return bindings;\n}\n\nfunction crawl(attrs, callback, path, depth) {\n    Object.keys(attrs).forEach(function(attrName) {\n        var attr = attrs[attrName];\n\n        if(attrName[0] === '_') return;\n\n        var thisPath = path + (depth > 0 ? '.' : '') + attrName;\n\n        if(Lib.isPlainObject(attr)) {\n            crawl(attr, callback, thisPath, depth + 1);\n        } else {\n            // Only execute the callback on leaf nodes:\n            callback(thisPath, attrName, attr);\n        }\n    });\n}\n","'use strict';\n\nvar extendFlat = require('../lib/extend').extendFlat;\n\n/**\n * Make a xy domain attribute group\n *\n * @param {object} opts\n *   @param {string}\n *     opts.name: name to be inserted in the default description\n *   @param {boolean}\n *     opts.trace: set to true for trace containers\n *   @param {string}\n *     opts.editType: editType for all pieces\n *   @param {boolean}\n *     opts.noGridCell: set to true to omit `row` and `column`\n *\n * @param {object} extra\n *   @param {string}\n *     extra.description: extra description. N.B we use\n *     a separate extra container to make it compatible with\n *     the compress_attributes transform.\n *\n * @return {object} attributes object containing {x,y} as specified\n */\nexports.attributes = function(opts, extra) {\n    opts = opts || {};\n    extra = extra || {};\n\n    var base = {\n        valType: 'info_array',\n        editType: opts.editType,\n        items: [\n            {valType: 'number', min: 0, max: 1, editType: opts.editType},\n            {valType: 'number', min: 0, max: 1, editType: opts.editType}\n        ],\n        dflt: [0, 1]\n    };\n\n    var namePart = opts.name ? opts.name + ' ' : '';\n    var contPart = opts.trace ? 'trace ' : 'subplot ';\n    var descPart = extra.description ? ' ' + extra.description : '';\n\n    var out = {\n        x: extendFlat({}, base, {\n            description: [\n                'Sets the horizontal domain of this ',\n                namePart,\n                contPart,\n                '(in plot fraction).',\n                descPart\n            ].join('')\n        }),\n        y: extendFlat({}, base, {\n            description: [\n                'Sets the vertical domain of this ',\n                namePart,\n                contPart,\n                '(in plot fraction).',\n                descPart\n            ].join('')\n        }),\n        editType: opts.editType\n    };\n\n    if(!opts.noGridCell) {\n        out.row = {\n            valType: 'integer',\n            min: 0,\n            dflt: 0,\n            editType: opts.editType,\n            description: [\n                'If there is a layout grid, use the domain ',\n                'for this row in the grid for this ',\n                namePart,\n                contPart,\n                '.',\n                descPart\n            ].join('')\n        };\n        out.column = {\n            valType: 'integer',\n            min: 0,\n            dflt: 0,\n            editType: opts.editType,\n            description: [\n                'If there is a layout grid, use the domain ',\n                'for this column in the grid for this ',\n                namePart,\n                contPart,\n                '.',\n                descPart\n            ].join('')\n        };\n    }\n\n    return out;\n};\n\nexports.defaults = function(containerOut, layout, coerce, dfltDomains) {\n    var dfltX = (dfltDomains && dfltDomains.x) || [0, 1];\n    var dfltY = (dfltDomains && dfltDomains.y) || [0, 1];\n\n    var grid = layout.grid;\n    if(grid) {\n        var column = coerce('domain.column');\n        if(column !== undefined) {\n            if(column < grid.columns) dfltX = grid._domains.x[column];\n            else delete containerOut.domain.column;\n        }\n\n        var row = coerce('domain.row');\n        if(row !== undefined) {\n            if(row < grid.rows) dfltY = grid._domains.y[row];\n            else delete containerOut.domain.row;\n        }\n    }\n\n    var x = coerce('domain.x', dfltX);\n    var y = coerce('domain.y', dfltY);\n\n    // don't accept bad input data\n    if(!(x[0] < x[1])) containerOut.domain.x = dfltX.slice();\n    if(!(y[0] < y[1])) containerOut.domain.y = dfltY.slice();\n};\n","'use strict';\n\n/*\n * make a font attribute group\n *\n * @param {object} opts\n *   @param {string}\n *     opts.description: where & how this font is used\n *   @param {optional bool} arrayOk:\n *     should each part (family, size, color) be arrayOk? default false.\n *   @param {string} editType:\n *     the editType for all pieces of this font\n *   @param {optional string} colorEditType:\n *     a separate editType just for color\n *\n * @return {object} attributes object containing {family, size, color} as specified\n */\nmodule.exports = function(opts) {\n    var editType = opts.editType;\n    var colorEditType = opts.colorEditType;\n    if(colorEditType === undefined) colorEditType = editType;\n    var attrs = {\n        family: {\n            valType: 'string',\n            noBlank: true,\n            strict: true,\n            editType: editType,\n            description: [\n                'HTML font family - the typeface that will be applied by the web browser.',\n                'The web browser will only be able to apply a font if it is available on the system',\n                'which it operates. Provide multiple font families, separated by commas, to indicate',\n                'the preference in which to apply fonts if they aren\\'t available on the system.',\n                'The Chart Studio Cloud (at https://chart-studio.plotly.com or on-premise) generates images on a server,',\n                'where only a select number of',\n                'fonts are installed and supported.',\n                'These include *Arial*, *Balto*, *Courier New*, *Droid Sans*,, *Droid Serif*,',\n                '*Droid Sans Mono*, *Gravitas One*, *Old Standard TT*, *Open Sans*, *Overpass*,',\n                '*PT Sans Narrow*, *Raleway*, *Times New Roman*.'\n            ].join(' ')\n        },\n        size: {\n            valType: 'number',\n            min: 1,\n            editType: editType\n        },\n        color: {\n            valType: 'color',\n            editType: colorEditType\n        },\n        editType: editType,\n        // blank strings so compress_attributes can remove\n        // TODO - that's uber hacky... better solution?\n        description: '' + (opts.description || '') + ''\n    };\n\n    if(opts.arrayOk) {\n        attrs.family.arrayOk = true;\n        attrs.size.arrayOk = true;\n        attrs.color.arrayOk = true;\n    }\n\n    return attrs;\n};\n","'use strict';\n\nmodule.exports = {\n    _isLinkedToArray: 'frames_entry',\n\n    group: {\n        valType: 'string',\n        description: [\n            'An identifier that specifies the group to which the frame belongs,',\n            'used by animate to select a subset of frames.'\n        ].join(' ')\n    },\n    name: {\n        valType: 'string',\n        description: 'A label by which to identify the frame'\n    },\n    traces: {\n        valType: 'any',\n        description: [\n            'A list of trace indices that identify the respective traces in the',\n            'data attribute'\n        ].join(' ')\n    },\n    baseframe: {\n        valType: 'string',\n        description: [\n            'The name of the frame into which this frame\\'s properties are merged',\n            'before applying. This is used to unify properties and avoid needing',\n            'to specify the same values for the same properties in multiple frames.'\n        ].join(' ')\n    },\n    data: {\n        valType: 'any',\n        description: [\n            'A list of traces this frame modifies. The format is identical to the',\n            'normal trace definition.'\n        ].join(' ')\n    },\n    layout: {\n        valType: 'any',\n        description: [\n            'Layout properties which this frame modifies. The format is identical',\n            'to the normal layout definition.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar Registry = require('../registry');\nvar SUBPLOT_PATTERN = require('./cartesian/constants').SUBPLOT_PATTERN;\n\n/**\n * Get calcdata trace(s) associated with a given subplot\n *\n * @param {array} calcData: as in gd.calcdata\n * @param {string} type: subplot type\n * @param {string} subplotId: subplot id to look for\n *\n * @return {array} array of calcdata traces\n */\nexports.getSubplotCalcData = function(calcData, type, subplotId) {\n    var basePlotModule = Registry.subplotsRegistry[type];\n    if(!basePlotModule) return [];\n\n    var attr = basePlotModule.attr;\n    var subplotCalcData = [];\n\n    for(var i = 0; i < calcData.length; i++) {\n        var calcTrace = calcData[i];\n        var trace = calcTrace[0].trace;\n\n        if(trace[attr] === subplotId) subplotCalcData.push(calcTrace);\n    }\n\n    return subplotCalcData;\n};\n/**\n * Get calcdata trace(s) that can be plotted with a given module\n * NOTE: this isn't necessarily just exactly matching trace type,\n * if multiple trace types use the same plotting routine, they will be\n * collected here.\n * In order to not plot the same thing multiple times, we return two arrays,\n * the calcdata we *will* plot with this module, and the ones we *won't*\n *\n * @param {array} calcdata: as in gd.calcdata\n * @param {object|string|fn} arg1:\n *  the plotting module, or its name, or its plot method\n *\n * @return {array[array]} [foundCalcdata, remainingCalcdata]\n */\nexports.getModuleCalcData = function(calcdata, arg1) {\n    var moduleCalcData = [];\n    var remainingCalcData = [];\n\n    var plotMethod;\n    if(typeof arg1 === 'string') {\n        plotMethod = Registry.getModule(arg1).plot;\n    } else if(typeof arg1 === 'function') {\n        plotMethod = arg1;\n    } else {\n        plotMethod = arg1.plot;\n    }\n    if(!plotMethod) {\n        return [moduleCalcData, calcdata];\n    }\n\n    for(var i = 0; i < calcdata.length; i++) {\n        var cd = calcdata[i];\n        var trace = cd[0].trace;\n        // N.B.\n        // - 'legendonly' traces do not make it past here\n        // - skip over 'visible' traces that got trimmed completely during calc transforms\n        if(trace.visible !== true || trace._length === 0) continue;\n\n        // group calcdata trace not by 'module' (as the name of this function\n        // would suggest), but by 'module plot method' so that if some traces\n        // share the same module plot method (e.g. bar and histogram), we\n        // only call it one!\n        if(trace._module.plot === plotMethod) {\n            moduleCalcData.push(cd);\n        } else {\n            remainingCalcData.push(cd);\n        }\n    }\n\n    return [moduleCalcData, remainingCalcData];\n};\n\n/**\n * Get the data trace(s) associated with a given subplot.\n *\n * @param {array} data  plotly full data array.\n * @param {string} type subplot type to look for.\n * @param {string} subplotId subplot id to look for.\n *\n * @return {array} list of trace objects.\n *\n */\nexports.getSubplotData = function getSubplotData(data, type, subplotId) {\n    if(!Registry.subplotsRegistry[type]) return [];\n\n    var attr = Registry.subplotsRegistry[type].attr;\n    var subplotData = [];\n    var trace, subplotX, subplotY;\n\n    if(type === 'gl2d') {\n        var spmatch = subplotId.match(SUBPLOT_PATTERN);\n        subplotX = 'x' + spmatch[1];\n        subplotY = 'y' + spmatch[2];\n    }\n\n    for(var i = 0; i < data.length; i++) {\n        trace = data[i];\n\n        if(type === 'gl2d' && Registry.traceIs(trace, 'gl2d')) {\n            if(trace[attr[0]] === subplotX && trace[attr[1]] === subplotY) {\n                subplotData.push(trace);\n            }\n        } else {\n            if(trace[attr] === subplotId) subplotData.push(trace);\n        }\n    }\n\n    return subplotData;\n};\n","'use strict';\n\nfunction xformMatrix(m, v) {\n    var out = [0, 0, 0, 0];\n    var i, j;\n\n    for(i = 0; i < 4; ++i) {\n        for(j = 0; j < 4; ++j) {\n            out[j] += m[4 * i + j] * v[i];\n        }\n    }\n\n    return out;\n}\n\nfunction project(camera, v) {\n    var p = xformMatrix(camera.projection,\n        xformMatrix(camera.view,\n        xformMatrix(camera.model, [v[0], v[1], v[2], 1])));\n    return p;\n}\n\nmodule.exports = project;\n","'use strict';\n\nvar fontAttrs = require('./font_attributes');\nvar animationAttrs = require('./animation_attributes');\nvar colorAttrs = require('../components/color/attributes');\nvar drawNewShapeAttrs = require('../components/shapes/draw_newshape/attributes');\nvar padAttrs = require('./pad_attributes');\nvar extendFlat = require('../lib/extend').extendFlat;\n\nvar globalFont = fontAttrs({\n    editType: 'calc',\n    description: [\n        'Sets the global font.',\n        'Note that fonts used in traces and other',\n        'layout components inherit from the global font.'\n    ].join(' ')\n});\nglobalFont.family.dflt = '\"Open Sans\", verdana, arial, sans-serif';\nglobalFont.size.dflt = 12;\nglobalFont.color.dflt = colorAttrs.defaultLine;\n\nmodule.exports = {\n    font: globalFont,\n    title: {\n        text: {\n            valType: 'string',\n            editType: 'layoutstyle',\n            description: [\n                'Sets the plot\\'s title.',\n                'Note that before the existence of `title.text`, the title\\'s',\n                'contents used to be defined as the `title` attribute itself.',\n                'This behavior has been deprecated.'\n            ].join(' ')\n        },\n        font: fontAttrs({\n            editType: 'layoutstyle',\n            description: [\n                'Sets the title font.',\n                'Note that the title\\'s font used to be customized',\n                'by the now deprecated `titlefont` attribute.'\n            ].join(' ')\n        }),\n        xref: {\n            valType: 'enumerated',\n            dflt: 'container',\n            values: ['container', 'paper'],\n            editType: 'layoutstyle',\n            description: [\n                'Sets the container `x` refers to.',\n                '*container* spans the entire `width` of the plot.',\n                '*paper* refers to the width of the plotting area only.'\n            ].join(' ')\n        },\n        yref: {\n            valType: 'enumerated',\n            dflt: 'container',\n            values: ['container', 'paper'],\n            editType: 'layoutstyle',\n            description: [\n                'Sets the container `y` refers to.',\n                '*container* spans the entire `height` of the plot.',\n                '*paper* refers to the height of the plotting area only.'\n            ].join(' ')\n        },\n        x: {\n            valType: 'number',\n            min: 0,\n            max: 1,\n            dflt: 0.5,\n            editType: 'layoutstyle',\n            description: [\n                'Sets the x position with respect to `xref` in normalized',\n                'coordinates from *0* (left) to *1* (right).'\n            ].join(' ')\n        },\n        y: {\n            valType: 'number',\n            min: 0,\n            max: 1,\n            dflt: 'auto',\n            editType: 'layoutstyle',\n            description: [\n                'Sets the y position with respect to `yref` in normalized',\n                'coordinates from *0* (bottom) to *1* (top).',\n                '*auto* places the baseline of the title onto the',\n                'vertical center of the top margin.'\n            ].join(' ')\n        },\n        xanchor: {\n            valType: 'enumerated',\n            dflt: 'auto',\n            values: ['auto', 'left', 'center', 'right'],\n            editType: 'layoutstyle',\n            description: [\n                'Sets the title\\'s horizontal alignment with respect to its x position.',\n                '*left* means that the title starts at x,',\n                '*right* means that the title ends at x',\n                'and *center* means that the title\\'s center is at x.',\n                '*auto* divides `xref` by three and calculates the `xanchor`',\n                'value automatically based on the value of `x`.'\n            ].join(' ')\n        },\n        yanchor: {\n            valType: 'enumerated',\n            dflt: 'auto',\n            values: ['auto', 'top', 'middle', 'bottom'],\n            editType: 'layoutstyle',\n            description: [\n                'Sets the title\\'s vertical alignment with respect to its y position.',\n                '*top* means that the title\\'s cap line is at y,',\n                '*bottom* means that the title\\'s baseline is at y',\n                'and *middle* means that the title\\'s midline is at y.',\n                '*auto* divides `yref` by three and calculates the `yanchor`',\n                'value automatically based on the value of `y`.'\n            ].join(' ')\n        },\n        pad: extendFlat(padAttrs({editType: 'layoutstyle'}), {\n            description: [\n                'Sets the padding of the title.',\n                'Each padding value only applies when the corresponding',\n                '`xanchor`/`yanchor` value is set accordingly. E.g. for left',\n                'padding to take effect, `xanchor` must be set to *left*.',\n                'The same rule applies if `xanchor`/`yanchor` is determined automatically.',\n                'Padding is muted if the respective anchor value is *middle*/*center*.'\n            ].join(' ')\n        }),\n        editType: 'layoutstyle'\n    },\n    uniformtext: {\n        mode: {\n            valType: 'enumerated',\n            values: [false, 'hide', 'show'],\n            dflt: false,\n            editType: 'plot',\n            description: [\n                'Determines how the font size for various text',\n                'elements are uniformed between each trace type.',\n                'If the computed text sizes were smaller than',\n                'the minimum size defined by `uniformtext.minsize`',\n                'using *hide* option hides the text; and',\n                'using *show* option shows the text without further downscaling.',\n                'Please note that if the size defined by `minsize` is greater than',\n                'the font size defined by trace, then the `minsize` is used.'\n            ].join(' ')\n        },\n        minsize: {\n            valType: 'number',\n            min: 0,\n            dflt: 0,\n            editType: 'plot',\n            description: [\n                'Sets the minimum text size between traces of the same type.'\n            ].join(' ')\n        },\n        editType: 'plot'\n    },\n    autosize: {\n        valType: 'boolean',\n        dflt: false,\n        // autosize, width, and height get special editType treatment in _relayout\n        // so we can handle noop resizes more efficiently\n        editType: 'none',\n        description: [\n            'Determines whether or not a layout width or height',\n            'that has been left undefined by the user',\n            'is initialized on each relayout.',\n\n            'Note that, regardless of this attribute,',\n            'an undefined layout width or height',\n            'is always initialized on the first call to plot.'\n        ].join(' ')\n    },\n    width: {\n        valType: 'number',\n        min: 10,\n        dflt: 700,\n        editType: 'plot',\n        description: [\n            'Sets the plot\\'s width (in px).'\n        ].join(' ')\n    },\n    height: {\n        valType: 'number',\n        min: 10,\n        dflt: 450,\n        editType: 'plot',\n        description: [\n            'Sets the plot\\'s height (in px).'\n        ].join(' ')\n    },\n    margin: {\n        l: {\n            valType: 'number',\n            min: 0,\n            dflt: 80,\n            editType: 'plot',\n            description: 'Sets the left margin (in px).'\n        },\n        r: {\n            valType: 'number',\n            min: 0,\n            dflt: 80,\n            editType: 'plot',\n            description: 'Sets the right margin (in px).'\n        },\n        t: {\n            valType: 'number',\n            min: 0,\n            dflt: 100,\n            editType: 'plot',\n            description: 'Sets the top margin (in px).'\n        },\n        b: {\n            valType: 'number',\n            min: 0,\n            dflt: 80,\n            editType: 'plot',\n            description: 'Sets the bottom margin (in px).'\n        },\n        pad: {\n            valType: 'number',\n            min: 0,\n            dflt: 0,\n            editType: 'plot',\n            description: [\n                'Sets the amount of padding (in px)',\n                'between the plotting area and the axis lines'\n            ].join(' ')\n        },\n        autoexpand: {\n            valType: 'boolean',\n            dflt: true,\n            editType: 'plot',\n            description: [\n                'Turns on/off margin expansion computations.',\n                'Legends, colorbars, updatemenus, sliders, axis rangeselector and rangeslider',\n                'are allowed to push the margins by defaults.'\n            ].join(' ')\n        },\n        editType: 'plot'\n    },\n    computed: {\n        valType: 'any',\n        editType: 'none',\n        description: [\n            'Placeholder for exporting automargin-impacting values namely',\n            '`margin.t`, `margin.b`, `margin.l` and `margin.r` in *full-json* mode.',\n        ].join(' ')\n    },\n    paper_bgcolor: {\n        valType: 'color',\n        dflt: colorAttrs.background,\n        editType: 'plot',\n        description: 'Sets the background color of the paper where the graph is drawn.'\n    },\n    plot_bgcolor: {\n        // defined here, but set in cartesian.supplyLayoutDefaults\n        // because it needs to know if there are (2D) axes or not\n        valType: 'color',\n        dflt: colorAttrs.background,\n        editType: 'layoutstyle',\n        description: [\n            'Sets the background color of the plotting area in-between x and y axes.'\n        ].join(' ')\n    },\n    autotypenumbers: {\n        valType: 'enumerated',\n        values: ['convert types', 'strict'],\n        dflt: 'convert types',\n        editType: 'calc',\n        description: [\n            'Using *strict* a numeric string in trace data is not converted to a number.',\n            'Using *convert types* a numeric string in trace data may be',\n            'treated as a number during automatic axis `type` detection.',\n            'This is the default value; however it could be overridden for individual axes.'\n        ].join(' ')\n    },\n    separators: {\n        valType: 'string',\n        editType: 'plot',\n        description: [\n            'Sets the decimal and thousand separators.',\n            'For example, *. * puts a \\'.\\' before decimals and a space',\n            'between thousands. In English locales, dflt is *.,* but',\n            'other locales may alter this default.'\n        ].join(' ')\n    },\n    hidesources: {\n        valType: 'boolean',\n        dflt: false,\n        editType: 'plot',\n        description: [\n            'Determines whether or not a text link citing the data source is',\n            'placed at the bottom-right cored of the figure.',\n            'Has only an effect only on graphs that have been generated via',\n            'forked graphs from the Chart Studio Cloud (at https://chart-studio.plotly.com or on-premise).'\n        ].join(' ')\n    },\n    showlegend: {\n        // handled in legend.supplyLayoutDefaults\n        // but included here because it's not in the legend object\n        valType: 'boolean',\n        editType: 'legend',\n        description: [\n            'Determines whether or not a legend is drawn.',\n            'Default is `true` if there is a trace to show and any of these:',\n            'a) Two or more traces would by default be shown in the legend.',\n            'b) One pie trace is shown in the legend.',\n            'c) One trace is explicitly given with `showlegend: true`.'\n        ].join(' ')\n    },\n    colorway: {\n        valType: 'colorlist',\n        dflt: colorAttrs.defaults,\n        editType: 'calc',\n        description: 'Sets the default trace colors.'\n    },\n    datarevision: {\n        valType: 'any',\n        editType: 'calc',\n        description: [\n            'If provided, a changed value tells `Plotly.react` that',\n            'one or more data arrays has changed. This way you can modify',\n            'arrays in-place rather than making a complete new copy for an',\n            'incremental change.',\n            'If NOT provided, `Plotly.react` assumes that data arrays are',\n            'being treated as immutable, thus any data array with a',\n            'different identity from its predecessor contains new data.'\n        ].join(' ')\n    },\n    uirevision: {\n        valType: 'any',\n        editType: 'none',\n        description: [\n            'Used to allow user interactions with the plot to persist after',\n            '`Plotly.react` calls that are unaware of these interactions.',\n            'If `uirevision` is omitted, or if it is given and it changed from',\n            'the previous `Plotly.react` call, the exact new figure is used.',\n            'If `uirevision` is truthy and did NOT change, any attribute',\n            'that has been affected by user interactions and did not receive a',\n            'different value in the new figure will keep the interaction value.',\n            '`layout.uirevision` attribute serves as the default for',\n            '`uirevision` attributes in various sub-containers. For finer',\n            'control you can set these sub-attributes directly. For example,',\n            'if your app separately controls the data on the x and y axes you',\n            'might set `xaxis.uirevision=*time*` and `yaxis.uirevision=*cost*`.',\n            'Then if only the y data is changed, you can update',\n            '`yaxis.uirevision=*quantity*` and the y axis range will reset but',\n            'the x axis range will retain any user-driven zoom.'\n        ].join(' ')\n    },\n    editrevision: {\n        valType: 'any',\n        editType: 'none',\n        description: [\n            'Controls persistence of user-driven changes in `editable: true`',\n            'configuration, other than trace names and axis titles.',\n            'Defaults to `layout.uirevision`.'\n        ].join(' ')\n    },\n    selectionrevision: {\n        valType: 'any',\n        editType: 'none',\n        description: [\n            'Controls persistence of user-driven changes in selected points',\n            'from all traces.'\n        ].join(' ')\n    },\n    template: {\n        valType: 'any',\n        editType: 'calc',\n        description: [\n            'Default attributes to be applied to the plot. Templates can be',\n            'created from existing plots using `Plotly.makeTemplate`, or',\n            'created manually. They should be objects with format:',\n            '`{layout: layoutTemplate, data: {[type]: [traceTemplate, ...]}, ...}`',\n            '`layoutTemplate` and `traceTemplate` are objects matching the',\n            'attribute structure of `layout` and a data trace. ',\n            'Trace templates are applied cyclically to traces of each type.',\n            'Container arrays (eg `annotations`) have special handling:',\n            'An object ending in `defaults` (eg `annotationdefaults`) is applied',\n            'to each array item. But if an item has a `templateitemname` key',\n            'we look in the template array for an item with matching `name` and',\n            'apply that instead. If no matching `name` is found we mark the item',\n            'invisible. Any named template item not referenced is appended to',\n            'the end of the array, so you can use this for a watermark annotation',\n            'or a logo image, for example. To omit one of these items on the plot,',\n            'make an item with matching `templateitemname` and `visible: false`.'\n        ].join(' ')\n    },\n\n    newshape: drawNewShapeAttrs.newshape,\n    activeshape: drawNewShapeAttrs.activeshape,\n\n    meta: {\n        valType: 'any',\n        arrayOk: true,\n        editType: 'plot',\n        description: [\n            'Assigns extra meta information that can be used in various `text` attributes.',\n            'Attributes such as the graph, axis and colorbar `title.text`, annotation `text`',\n            '`trace.name` in legend items, `rangeselector`, `updatemenus` and `sliders` `label` text',\n            'all support `meta`. One can access `meta` fields using template strings:',\n            '`%{meta[i]}` where `i` is the index of the `meta`',\n            'item in question.',\n            '`meta` can also be an object for example `{key: value}` which can be accessed',\n            '%{meta[key]}.'\n        ].join(' ')\n    },\n\n    transition: extendFlat({}, animationAttrs.transition, {\n        description: [\n            'Sets transition options used during Plotly.react updates.'\n        ].join(' '),\n        editType: 'none'\n    }),\n    _deprecated: {\n        title: {\n            valType: 'string',\n            editType: 'layoutstyle',\n            description: [\n                'Value of `title` is no longer a simple *string* but a set of sub-attributes.',\n                'To set the contents of the title, please use `title.text` now.'\n            ].join(' ')\n        },\n        titlefont: fontAttrs({\n            editType: 'layoutstyle',\n            description: [\n                'Former `titlefont` is now the sub-attribute `font` of `title`.',\n                'To customize title font properties, please use `title.font` now.'\n            ].join(' ')\n        })\n    }\n};\n","'use strict';\n\n/**\n * Creates a set of padding attributes.\n *\n * @param {object} opts\n *   @param {string} editType:\n *     the editType for all pieces of this padding definition\n *\n * @return {object} attributes object containing {t, r, b, l} as specified\n */\nmodule.exports = function(opts) {\n    var editType = opts.editType;\n    return {\n        t: {\n            valType: 'number',\n            dflt: 0,\n            editType: editType,\n            description: 'The amount of padding (in px) along the top of the component.'\n        },\n        r: {\n            valType: 'number',\n            dflt: 0,\n            editType: editType,\n            description: 'The amount of padding (in px) on the right side of the component.'\n        },\n        b: {\n            valType: 'number',\n            dflt: 0,\n            editType: editType,\n            description: 'The amount of padding (in px) along the bottom of the component.'\n        },\n        l: {\n            valType: 'number',\n            dflt: 0,\n            editType: editType,\n            description: 'The amount of padding (in px) on the left side of the component.'\n        },\n        editType: editType\n    };\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar timeFormatLocale = require('d3-time-format').timeFormatLocale;\nvar isNumeric = require('fast-isnumeric');\n\nvar Registry = require('../registry');\nvar PlotSchema = require('../plot_api/plot_schema');\nvar Template = require('../plot_api/plot_template');\nvar Lib = require('../lib');\nvar Color = require('../components/color');\nvar BADNUM = require('../constants/numerical').BADNUM;\n\nvar axisIDs = require('./cartesian/axis_ids');\nvar clearSelect = require('./cartesian/handle_outline').clearSelect;\n\nvar animationAttrs = require('./animation_attributes');\nvar frameAttrs = require('./frame_attributes');\n\nvar getModuleCalcData = require('../plots/get_data').getModuleCalcData;\n\nvar relinkPrivateKeys = Lib.relinkPrivateKeys;\nvar _ = Lib._;\n\nvar plots = module.exports = {};\n\n// Expose registry methods on Plots for backward-compatibility\nLib.extendFlat(plots, Registry);\n\nplots.attributes = require('./attributes');\nplots.attributes.type.values = plots.allTypes;\nplots.fontAttrs = require('./font_attributes');\nplots.layoutAttributes = require('./layout_attributes');\n\n// TODO make this a plot attribute?\nplots.fontWeight = 'normal';\n\nvar transformsRegistry = plots.transformsRegistry;\n\nvar commandModule = require('./command');\nplots.executeAPICommand = commandModule.executeAPICommand;\nplots.computeAPICommandBindings = commandModule.computeAPICommandBindings;\nplots.manageCommandObserver = commandModule.manageCommandObserver;\nplots.hasSimpleAPICommandBindings = commandModule.hasSimpleAPICommandBindings;\n\n// in some cases the browser doesn't seem to know how big\n// the text is at first, so it needs to draw it,\n// then wait a little, then draw it again\nplots.redrawText = function(gd) {\n    gd = Lib.getGraphDiv(gd);\n\n    return new Promise(function(resolve) {\n        setTimeout(function() {\n            if(!gd._fullLayout) return;\n            Registry.getComponentMethod('annotations', 'draw')(gd);\n            Registry.getComponentMethod('legend', 'draw')(gd);\n            Registry.getComponentMethod('colorbar', 'draw')(gd);\n            resolve(plots.previousPromises(gd));\n        }, 300);\n    });\n};\n\n// resize plot about the container size\nplots.resize = function(gd) {\n    gd = Lib.getGraphDiv(gd);\n\n    var resolveLastResize;\n    var p = new Promise(function(resolve, reject) {\n        if(!gd || Lib.isHidden(gd)) {\n            reject(new Error('Resize must be passed a displayed plot div element.'));\n        }\n\n        if(gd._redrawTimer) clearTimeout(gd._redrawTimer);\n        if(gd._resolveResize) resolveLastResize = gd._resolveResize;\n        gd._resolveResize = resolve;\n\n        gd._redrawTimer = setTimeout(function() {\n            // return if there is nothing to resize or is hidden\n            if(!gd.layout || (gd.layout.width && gd.layout.height) || Lib.isHidden(gd)) {\n                resolve(gd);\n                return;\n            }\n\n            delete gd.layout.width;\n            delete gd.layout.height;\n\n            // autosizing doesn't count as a change that needs saving\n            var oldchanged = gd.changed;\n\n            // nor should it be included in the undo queue\n            gd.autoplay = true;\n\n            Registry.call('relayout', gd, {autosize: true}).then(function() {\n                gd.changed = oldchanged;\n                // Only resolve if a new call hasn't been made!\n                if(gd._resolveResize === resolve) {\n                    delete gd._resolveResize;\n                    resolve(gd);\n                }\n            });\n        }, 100);\n    });\n\n    if(resolveLastResize) resolveLastResize(p);\n    return p;\n};\n\n\n// for use in Lib.syncOrAsync, check if there are any\n// pending promises in this plot and wait for them\nplots.previousPromises = function(gd) {\n    if((gd._promises || []).length) {\n        return Promise.all(gd._promises)\n            .then(function() { gd._promises = []; });\n    }\n};\n\n/**\n * Adds the 'Edit chart' link.\n * Note that now _doPlot calls this so it can regenerate whenever it replots\n *\n * Add source links to your graph inside the 'showSources' config argument.\n */\nplots.addLinks = function(gd) {\n    // Do not do anything if showLink and showSources are not set to true in config\n    if(!gd._context.showLink && !gd._context.showSources) return;\n\n    var fullLayout = gd._fullLayout;\n\n    var linkContainer = Lib.ensureSingle(fullLayout._paper, 'text', 'js-plot-link-container', function(s) {\n        s.style({\n            'font-family': '\"Open Sans\", Arial, sans-serif',\n            'font-size': '12px',\n            'fill': Color.defaultLine,\n            'pointer-events': 'all'\n        })\n        .each(function() {\n            var links = d3.select(this);\n            links.append('tspan').classed('js-link-to-tool', true);\n            links.append('tspan').classed('js-link-spacer', true);\n            links.append('tspan').classed('js-sourcelinks', true);\n        });\n    });\n\n    // The text node inside svg\n    var text = linkContainer.node();\n    var attrs = {y: fullLayout._paper.attr('height') - 9};\n\n    // If text's width is bigger than the layout\n    // Check that text is a child node or document.body\n    // because otherwise IE/Edge might throw an exception\n    // when calling getComputedTextLength().\n    // Apparently offsetParent is null for invisibles.\n    if(document.body.contains(text) && text.getComputedTextLength() >= (fullLayout.width - 20)) {\n        // Align the text at the left\n        attrs['text-anchor'] = 'start';\n        attrs.x = 5;\n    } else {\n        // Align the text at the right\n        attrs['text-anchor'] = 'end';\n        attrs.x = fullLayout._paper.attr('width') - 7;\n    }\n\n    linkContainer.attr(attrs);\n\n    var toolspan = linkContainer.select('.js-link-to-tool');\n    var spacespan = linkContainer.select('.js-link-spacer');\n    var sourcespan = linkContainer.select('.js-sourcelinks');\n\n    if(gd._context.showSources) gd._context.showSources(gd);\n\n    // 'view in plotly' link for embedded plots\n    if(gd._context.showLink) positionPlayWithData(gd, toolspan);\n\n    // separator if we have both sources and tool link\n    spacespan.text((toolspan.text() && sourcespan.text()) ? ' - ' : '');\n};\n\n// note that now this function is only adding the brand in\n// iframes and 3rd-party apps\nfunction positionPlayWithData(gd, container) {\n    container.text('');\n    var link = container.append('a')\n        .attr({\n            'xlink:xlink:href': '#',\n            'class': 'link--impt link--embedview',\n            'font-weight': 'bold'\n        })\n        .text(gd._context.linkText + ' ' + String.fromCharCode(187));\n\n    if(gd._context.sendData) {\n        link.on('click', function() {\n            plots.sendDataToCloud(gd);\n        });\n    } else {\n        var path = window.location.pathname.split('/');\n        var query = window.location.search;\n        link.attr({\n            'xlink:xlink:show': 'new',\n            'xlink:xlink:href': '/' + path[2].split('.')[0] + '/' + path[1] + query\n        });\n    }\n}\n\nplots.sendDataToCloud = function(gd) {\n    var baseUrl = (window.PLOTLYENV || {}).BASE_URL || gd._context.plotlyServerURL;\n    if(!baseUrl) return;\n\n    gd.emit('plotly_beforeexport');\n\n    var hiddenformDiv = d3.select(gd)\n        .append('div')\n        .attr('id', 'hiddenform')\n        .style('display', 'none');\n\n    var hiddenform = hiddenformDiv\n        .append('form')\n        .attr({\n            action: baseUrl + '/external',\n            method: 'post',\n            target: '_blank'\n        });\n\n    var hiddenformInput = hiddenform\n        .append('input')\n        .attr({\n            type: 'text',\n            name: 'data'\n        });\n\n    hiddenformInput.node().value = plots.graphJson(gd, false, 'keepdata');\n    hiddenform.node().submit();\n    hiddenformDiv.remove();\n\n    gd.emit('plotly_afterexport');\n    return false;\n};\n\nvar d3FormatKeys = [\n    'days', 'shortDays', 'months', 'shortMonths', 'periods',\n    'dateTime', 'date', 'time',\n    'decimal', 'thousands', 'grouping', 'currency'\n];\n\nvar extraFormatKeys = [\n    'year', 'month', 'dayMonth', 'dayMonthYear'\n];\n\n/*\n * Fill in default values\n * @param {DOM element} gd\n * @param {object} opts\n * @param {boolean} opts.skipUpdateCalc: normally if the existing gd.calcdata looks\n *   compatible with the new gd._fullData we finish by linking the new _fullData traces\n *   to the old gd.calcdata, so it's correctly set if we're not going to recalc. But also,\n *   if there are calcTransforms on the trace, we first remap data arrays from the old full\n *   trace into the new one. Use skipUpdateCalc to defer this (needed by Plotly.react)\n *\n * gd.data, gd.layout:\n *   are precisely what the user specified (except as modified by cleanData/cleanLayout),\n *   these fields shouldn't be modified (except for filling in some auto values)\n *   nor used directly after the supply defaults step.\n *\n * gd._fullData, gd._fullLayout:\n *   are complete descriptions of how to draw the plot,\n *   use these fields in all required computations.\n *\n * gd._fullLayout._modules\n *   is a list of all the trace modules required to draw the plot.\n *\n * gd._fullLayout._visibleModules\n *   subset of _modules, a list of modules corresponding to visible:true traces.\n *\n * gd._fullLayout._basePlotModules\n *   is a list of all the plot modules required to draw the plot.\n *\n * gd._fullLayout._transformModules\n *   is a list of all the transform modules invoked.\n *\n */\nplots.supplyDefaults = function(gd, opts) {\n    var skipUpdateCalc = opts && opts.skipUpdateCalc;\n    var oldFullLayout = gd._fullLayout || {};\n\n    if(oldFullLayout._skipDefaults) {\n        delete oldFullLayout._skipDefaults;\n        return;\n    }\n\n    var newFullLayout = gd._fullLayout = {};\n    var newLayout = gd.layout || {};\n\n    var oldFullData = gd._fullData || [];\n    var newFullData = gd._fullData = [];\n    var newData = gd.data || [];\n\n    var oldCalcdata = gd.calcdata || [];\n\n    var context = gd._context || {};\n\n    var i;\n\n    // Create all the storage space for frames, but only if doesn't already exist\n    if(!gd._transitionData) plots.createTransitionData(gd);\n\n    // So we only need to do this once (and since we have gd here)\n    // get the translated placeholder titles.\n    // These ones get used as default values so need to be known at supplyDefaults\n    // others keep their blank defaults but render the placeholder as desired later\n    // TODO: make these work the same way, only inserting the placeholder text at draw time?\n    // The challenge is that this has slightly different behavior right now in editable mode:\n    // using the placeholder as default makes this text permanently (but lightly) visible,\n    // but explicit '' for these titles gives you a placeholder that's hidden until you mouse\n    // over it - so you're not distracted by it if you really don't want a title, but if you do\n    // and you're new to plotly you may not be able to find it.\n    // When editable=false the two behave the same, no title is drawn.\n    newFullLayout._dfltTitle = {\n        plot: _(gd, 'Click to enter Plot title'),\n        x: _(gd, 'Click to enter X axis title'),\n        y: _(gd, 'Click to enter Y axis title'),\n        colorbar: _(gd, 'Click to enter Colorscale title'),\n        annotation: _(gd, 'new text')\n    };\n    newFullLayout._traceWord = _(gd, 'trace');\n\n    var formatObj = getFormatObj(gd, d3FormatKeys);\n\n    // stash the token from context so mapbox subplots can use it as default\n    newFullLayout._mapboxAccessToken = context.mapboxAccessToken;\n\n    // first fill in what we can of layout without looking at data\n    // because fullData needs a few things from layout\n    if(oldFullLayout._initialAutoSizeIsDone) {\n        // coerce the updated layout while preserving width and height\n        var oldWidth = oldFullLayout.width;\n        var oldHeight = oldFullLayout.height;\n\n        plots.supplyLayoutGlobalDefaults(newLayout, newFullLayout, formatObj);\n\n        if(!newLayout.width) newFullLayout.width = oldWidth;\n        if(!newLayout.height) newFullLayout.height = oldHeight;\n        plots.sanitizeMargins(newFullLayout);\n    } else {\n        // coerce the updated layout and autosize if needed\n        plots.supplyLayoutGlobalDefaults(newLayout, newFullLayout, formatObj);\n\n        var missingWidthOrHeight = (!newLayout.width || !newLayout.height);\n        var autosize = newFullLayout.autosize;\n        var autosizable = context.autosizable;\n        var initialAutoSize = missingWidthOrHeight && (autosize || autosizable);\n\n        if(initialAutoSize) plots.plotAutoSize(gd, newLayout, newFullLayout);\n        else if(missingWidthOrHeight) plots.sanitizeMargins(newFullLayout);\n\n        // for backwards-compatibility with Plotly v1.x.x\n        if(!autosize && missingWidthOrHeight) {\n            newLayout.width = newFullLayout.width;\n            newLayout.height = newFullLayout.height;\n        }\n    }\n\n    newFullLayout._d3locale = getFormatter(formatObj, newFullLayout.separators);\n    newFullLayout._extraFormat = getFormatObj(gd, extraFormatKeys);\n\n    newFullLayout._initialAutoSizeIsDone = true;\n\n    // keep track of how many traces are inputted\n    newFullLayout._dataLength = newData.length;\n\n    // clear the lists of trace and baseplot modules, and subplots\n    newFullLayout._modules = [];\n    newFullLayout._visibleModules = [];\n    newFullLayout._basePlotModules = [];\n    var subplots = newFullLayout._subplots = emptySubplotLists();\n\n    // initialize axis and subplot hash objects for splom-generated grids\n    var splomAxes = newFullLayout._splomAxes = {x: {}, y: {}};\n    var splomSubplots = newFullLayout._splomSubplots = {};\n    // initialize splom grid defaults\n    newFullLayout._splomGridDflt = {};\n\n    // for stacked area traces to share config across traces\n    newFullLayout._scatterStackOpts = {};\n    // for the first scatter trace on each subplot (so it knows tonext->tozero)\n    newFullLayout._firstScatter = {};\n    // for grouped bar/box/violin trace to share config across traces\n    newFullLayout._alignmentOpts = {};\n    // track color axes referenced in the data\n    newFullLayout._colorAxes = {};\n\n    // for traces to request a default rangeslider on their x axes\n    // eg set `_requestRangeslider.x2 = true` for xaxis2\n    newFullLayout._requestRangeslider = {};\n\n    // pull uids from old data to use as new defaults\n    newFullLayout._traceUids = getTraceUids(oldFullData, newData);\n\n    // then do the data\n    newFullLayout._globalTransforms = (gd._context || {}).globalTransforms;\n    plots.supplyDataDefaults(newData, newFullData, newLayout, newFullLayout);\n\n    // redo grid size defaults with info about splom x/y axes,\n    // and fill in generated cartesian axes and subplots\n    var splomXa = Object.keys(splomAxes.x);\n    var splomYa = Object.keys(splomAxes.y);\n    if(splomXa.length > 1 && splomYa.length > 1) {\n        Registry.getComponentMethod('grid', 'sizeDefaults')(newLayout, newFullLayout);\n\n        for(i = 0; i < splomXa.length; i++) {\n            Lib.pushUnique(subplots.xaxis, splomXa[i]);\n        }\n        for(i = 0; i < splomYa.length; i++) {\n            Lib.pushUnique(subplots.yaxis, splomYa[i]);\n        }\n        for(var k in splomSubplots) {\n            Lib.pushUnique(subplots.cartesian, k);\n        }\n    }\n\n    // attach helper method to check whether a plot type is present on graph\n    newFullLayout._has = plots._hasPlotType.bind(newFullLayout);\n\n    if(oldFullData.length === newFullData.length) {\n        for(i = 0; i < newFullData.length; i++) {\n            relinkPrivateKeys(newFullData[i], oldFullData[i]);\n        }\n    }\n\n    // finally, fill in the pieces of layout that may need to look at data\n    plots.supplyLayoutModuleDefaults(newLayout, newFullLayout, newFullData, gd._transitionData);\n\n    // Special cases that introduce interactions between traces.\n    // This is after relinkPrivateKeys so we can use those in crossTraceDefaults\n    // and after layout module defaults, so we can use eg barmode\n    var _modules = newFullLayout._visibleModules;\n    var crossTraceDefaultsFuncs = [];\n    for(i = 0; i < _modules.length; i++) {\n        var funci = _modules[i].crossTraceDefaults;\n        // some trace types share crossTraceDefaults (ie histogram2d, histogram2dcontour)\n        if(funci) Lib.pushUnique(crossTraceDefaultsFuncs, funci);\n    }\n    for(i = 0; i < crossTraceDefaultsFuncs.length; i++) {\n        crossTraceDefaultsFuncs[i](newFullData, newFullLayout);\n    }\n\n    // turn on flag to optimize large splom-only graphs\n    // mostly by omitting SVG layers during Cartesian.drawFramework\n    newFullLayout._hasOnlyLargeSploms = (\n        newFullLayout._basePlotModules.length === 1 &&\n        newFullLayout._basePlotModules[0].name === 'splom' &&\n        splomXa.length > 15 &&\n        splomYa.length > 15 &&\n        newFullLayout.shapes.length === 0 &&\n        newFullLayout.images.length === 0\n    );\n\n    // relink / initialize subplot axis objects\n    plots.linkSubplots(newFullData, newFullLayout, oldFullData, oldFullLayout);\n\n    // clean subplots and other artifacts from previous plot calls\n    plots.cleanPlot(newFullData, newFullLayout, oldFullData, oldFullLayout);\n\n    var hadGL2D = !!(oldFullLayout._has && oldFullLayout._has('gl2d'));\n    var hasGL2D = !!(newFullLayout._has && newFullLayout._has('gl2d'));\n    var hadCartesian = !!(oldFullLayout._has && oldFullLayout._has('cartesian'));\n    var hasCartesian = !!(newFullLayout._has && newFullLayout._has('cartesian'));\n    var hadBgLayer = hadCartesian || hadGL2D;\n    var hasBgLayer = hasCartesian || hasGL2D;\n    if(hadBgLayer && !hasBgLayer) {\n        // remove bgLayer\n        oldFullLayout._bgLayer.remove();\n    } else if(hasBgLayer && !hadBgLayer) {\n        // create bgLayer\n        newFullLayout._shouldCreateBgLayer = true;\n    }\n\n    // clear selection outline until we implement persistent selection,\n    // don't clear them though when drag handlers (e.g. listening to\n    // `plotly_selecting`) update the graph.\n    // we should try to come up with a better solution when implementing\n    // https://github.com/plotly/plotly.js/issues/1851\n    if(oldFullLayout._zoomlayer && !gd._dragging) {\n        clearSelect({ // mock old gd\n            _fullLayout: oldFullLayout\n        });\n    }\n\n\n    // fill in meta helpers\n    fillMetaTextHelpers(newFullData, newFullLayout);\n\n    // relink functions and _ attributes to promote consistency between plots\n    relinkPrivateKeys(newFullLayout, oldFullLayout);\n\n    // colorscale crossTraceDefaults needs newFullLayout with relinked keys\n    Registry.getComponentMethod('colorscale', 'crossTraceDefaults')(newFullData, newFullLayout);\n\n    // For persisting GUI-driven changes in layout\n    // _preGUI and _tracePreGUI were already copied over in relinkPrivateKeys\n    if(!newFullLayout._preGUI) newFullLayout._preGUI = {};\n    // track trace GUI changes by uid rather than by trace index\n    if(!newFullLayout._tracePreGUI) newFullLayout._tracePreGUI = {};\n    var tracePreGUI = newFullLayout._tracePreGUI;\n    var uids = {};\n    var uid;\n    for(uid in tracePreGUI) uids[uid] = 'old';\n    for(i = 0; i < newFullData.length; i++) {\n        uid = newFullData[i]._fullInput.uid;\n        if(!uids[uid]) tracePreGUI[uid] = {};\n        uids[uid] = 'new';\n    }\n    for(uid in uids) {\n        if(uids[uid] === 'old') delete tracePreGUI[uid];\n    }\n\n    // set up containers for margin calculations\n    initMargins(newFullLayout);\n\n    // collect and do some initial calculations for rangesliders\n    Registry.getComponentMethod('rangeslider', 'makeData')(newFullLayout);\n\n    // update object references in calcdata\n    if(!skipUpdateCalc && oldCalcdata.length === newFullData.length) {\n        plots.supplyDefaultsUpdateCalc(oldCalcdata, newFullData);\n    }\n};\n\nplots.supplyDefaultsUpdateCalc = function(oldCalcdata, newFullData) {\n    for(var i = 0; i < newFullData.length; i++) {\n        var newTrace = newFullData[i];\n        var cd0 = (oldCalcdata[i] || [])[0];\n        if(cd0 && cd0.trace) {\n            var oldTrace = cd0.trace;\n            if(oldTrace._hasCalcTransform) {\n                var arrayAttrs = oldTrace._arrayAttrs;\n                var j, astr, oldArrayVal;\n\n                for(j = 0; j < arrayAttrs.length; j++) {\n                    astr = arrayAttrs[j];\n                    oldArrayVal = Lib.nestedProperty(oldTrace, astr).get().slice();\n                    Lib.nestedProperty(newTrace, astr).set(oldArrayVal);\n                }\n            }\n            cd0.trace = newTrace;\n        }\n    }\n};\n\n/**\n * Create a list of uid strings satisfying (in this order of importance):\n * 1. all unique, all strings\n * 2. matches input uids if provided\n * 3. matches previous data uids\n */\nfunction getTraceUids(oldFullData, newData) {\n    var len = newData.length;\n    var oldFullInput = [];\n    var i, prevFullInput;\n    for(i = 0; i < oldFullData.length; i++) {\n        var thisFullInput = oldFullData[i]._fullInput;\n        if(thisFullInput !== prevFullInput) oldFullInput.push(thisFullInput);\n        prevFullInput = thisFullInput;\n    }\n    var oldLen = oldFullInput.length;\n    var out = new Array(len);\n    var seenUids = {};\n\n    function setUid(uid, i) {\n        out[i] = uid;\n        seenUids[uid] = 1;\n    }\n\n    function tryUid(uid, i) {\n        if(uid && typeof uid === 'string' && !seenUids[uid]) {\n            setUid(uid, i);\n            return true;\n        }\n    }\n\n    for(i = 0; i < len; i++) {\n        var newUid = newData[i].uid;\n        if(typeof newUid === 'number') newUid = String(newUid);\n\n        if(tryUid(newUid, i)) continue;\n        if(i < oldLen && tryUid(oldFullInput[i].uid, i)) continue;\n        setUid(Lib.randstr(seenUids), i);\n    }\n\n    return out;\n}\n\n/**\n * Make a container for collecting subplots we need to display.\n *\n * Finds all subplot types we need to enumerate once and caches it,\n * but makes a new output object each time.\n * Single-trace subplots (which have no `id`) such as pie, table, etc\n * do not need to be collected because we just draw all visible traces.\n */\nfunction emptySubplotLists() {\n    var collectableSubplotTypes = Registry.collectableSubplotTypes;\n    var out = {};\n    var i, j;\n\n    if(!collectableSubplotTypes) {\n        collectableSubplotTypes = [];\n\n        var subplotsRegistry = Registry.subplotsRegistry;\n\n        for(var subplotType in subplotsRegistry) {\n            var subplotModule = subplotsRegistry[subplotType];\n            var subplotAttr = subplotModule.attr;\n\n            if(subplotAttr) {\n                collectableSubplotTypes.push(subplotType);\n\n                // special case, currently just for cartesian:\n                // we need to enumerate axes, not just subplots\n                if(Array.isArray(subplotAttr)) {\n                    for(j = 0; j < subplotAttr.length; j++) {\n                        Lib.pushUnique(collectableSubplotTypes, subplotAttr[j]);\n                    }\n                }\n            }\n        }\n    }\n\n    for(i = 0; i < collectableSubplotTypes.length; i++) {\n        out[collectableSubplotTypes[i]] = [];\n    }\n    return out;\n}\n\n/**\n * getFormatObj: use _context to get the format object from locale.\n * Used to get d3.locale argument object and extraFormat argument object\n *\n * Regarding d3.locale argument :\n * decimal and thousands can be overridden later by layout.separators\n * grouping and currency are not presently used by our automatic number\n * formatting system but can be used by custom formats.\n *\n * @returns {object} d3.locale format object\n */\nfunction getFormatObj(gd, formatKeys) {\n    var locale = gd._context.locale;\n    if(!locale) locale = 'en-US';\n\n    var formatDone = false;\n    var formatObj = {};\n\n    function includeFormat(newFormat) {\n        var formatFinished = true;\n        for(var i = 0; i < formatKeys.length; i++) {\n            var formatKey = formatKeys[i];\n            if(!formatObj[formatKey]) {\n                if(newFormat[formatKey]) {\n                    formatObj[formatKey] = newFormat[formatKey];\n                } else formatFinished = false;\n            }\n        }\n        if(formatFinished) formatDone = true;\n    }\n\n    // same as localize, look for format parts in each format spec in the chain\n    for(var i = 0; i < 2; i++) {\n        var locales = gd._context.locales;\n        for(var j = 0; j < 2; j++) {\n            var formatj = (locales[locale] || {}).format;\n            if(formatj) {\n                includeFormat(formatj);\n                if(formatDone) break;\n            }\n            locales = Registry.localeRegistry;\n        }\n\n        var baseLocale = locale.split('-')[0];\n        if(formatDone || baseLocale === locale) break;\n        locale = baseLocale;\n    }\n\n    // lastly pick out defaults from english (non-US, as DMY is so much more common)\n    if(!formatDone) includeFormat(Registry.localeRegistry.en.format);\n\n    return formatObj;\n}\n\n/**\n * getFormatter: combine the final separators with the locale formatting object\n * we pulled earlier to generate number and time formatters\n * TODO: remove separators in v3, only use locale, so we don't need this step?\n *\n * @param {object} formatObj: d3.locale format object\n * @param {string} separators: length-2 string to override decimal and thousands\n *   separators in number formatting\n *\n * @returns {object} {numberFormat, timeFormat} d3 formatter factory functions\n *   for numbers and time\n */\nfunction getFormatter(formatObj, separators) {\n    formatObj.decimal = separators.charAt(0);\n    formatObj.thousands = separators.charAt(1);\n\n    return {\n        numberFormat: d3.locale(formatObj).numberFormat,\n        timeFormat: timeFormatLocale(formatObj).utcFormat\n    };\n}\n\nfunction fillMetaTextHelpers(newFullData, newFullLayout) {\n    var _meta;\n    var meta4data = [];\n\n    if(newFullLayout.meta) {\n        _meta = newFullLayout._meta = {\n            meta: newFullLayout.meta,\n            layout: {meta: newFullLayout.meta}\n        };\n    }\n\n    for(var i = 0; i < newFullData.length; i++) {\n        var trace = newFullData[i];\n\n        if(trace.meta) {\n            meta4data[trace.index] = trace._meta = {meta: trace.meta};\n        } else if(newFullLayout.meta) {\n            trace._meta = {meta: newFullLayout.meta};\n        }\n        if(newFullLayout.meta) {\n            trace._meta.layout = {meta: newFullLayout.meta};\n        }\n    }\n\n    if(meta4data.length) {\n        if(!_meta) {\n            _meta = newFullLayout._meta = {};\n        }\n        _meta.data = meta4data;\n    }\n}\n\n// Create storage for all of the data related to frames and transitions:\nplots.createTransitionData = function(gd) {\n    // Set up the default keyframe if it doesn't exist:\n    if(!gd._transitionData) {\n        gd._transitionData = {};\n    }\n\n    if(!gd._transitionData._frames) {\n        gd._transitionData._frames = [];\n    }\n\n    if(!gd._transitionData._frameHash) {\n        gd._transitionData._frameHash = {};\n    }\n\n    if(!gd._transitionData._counter) {\n        gd._transitionData._counter = 0;\n    }\n\n    if(!gd._transitionData._interruptCallbacks) {\n        gd._transitionData._interruptCallbacks = [];\n    }\n};\n\n// helper function to be bound to fullLayout to check\n// whether a certain plot type is present on plot\n// or trace has a category\nplots._hasPlotType = function(category) {\n    var i;\n\n    // check base plot modules\n    var basePlotModules = this._basePlotModules || [];\n    for(i = 0; i < basePlotModules.length; i++) {\n        if(basePlotModules[i].name === category) return true;\n    }\n\n    // check trace modules (including non-visible:true)\n    var modules = this._modules || [];\n    for(i = 0; i < modules.length; i++) {\n        var name = modules[i].name;\n        if(name === category) return true;\n        // N.B. this is modules[i] along with 'categories' as a hash object\n        var _module = Registry.modules[name];\n        if(_module && _module.categories[category]) return true;\n    }\n\n    return false;\n};\n\nplots.cleanPlot = function(newFullData, newFullLayout, oldFullData, oldFullLayout) {\n    var i, j;\n\n    var basePlotModules = oldFullLayout._basePlotModules || [];\n    for(i = 0; i < basePlotModules.length; i++) {\n        var _module = basePlotModules[i];\n\n        if(_module.clean) {\n            _module.clean(newFullData, newFullLayout, oldFullData, oldFullLayout);\n        }\n    }\n\n    var hadGl = oldFullLayout._has && oldFullLayout._has('gl');\n    var hasGl = newFullLayout._has && newFullLayout._has('gl');\n\n    if(hadGl && !hasGl) {\n        if(oldFullLayout._glcontainer !== undefined) {\n            oldFullLayout._glcontainer.selectAll('.gl-canvas').remove();\n            oldFullLayout._glcontainer.selectAll('.no-webgl').remove();\n            oldFullLayout._glcanvas = null;\n        }\n    }\n\n    var hasInfoLayer = !!oldFullLayout._infolayer;\n\n    oldLoop:\n    for(i = 0; i < oldFullData.length; i++) {\n        var oldTrace = oldFullData[i];\n        var oldUid = oldTrace.uid;\n\n        for(j = 0; j < newFullData.length; j++) {\n            var newTrace = newFullData[j];\n\n            if(oldUid === newTrace.uid) continue oldLoop;\n        }\n\n        // clean old colorbars\n        if(hasInfoLayer) {\n            oldFullLayout._infolayer.select('.cb' + oldUid).remove();\n        }\n    }\n};\n\nplots.linkSubplots = function(newFullData, newFullLayout, oldFullData, oldFullLayout) {\n    var i, j;\n\n    var oldSubplots = oldFullLayout._plots || {};\n    var newSubplots = newFullLayout._plots = {};\n    var newSubplotList = newFullLayout._subplots;\n\n    var mockGd = {\n        _fullData: newFullData,\n        _fullLayout: newFullLayout\n    };\n\n    var ids = newSubplotList.cartesian.concat(newSubplotList.gl2d || []);\n\n    for(i = 0; i < ids.length; i++) {\n        var id = ids[i];\n        var oldSubplot = oldSubplots[id];\n        var xaxis = axisIDs.getFromId(mockGd, id, 'x');\n        var yaxis = axisIDs.getFromId(mockGd, id, 'y');\n        var plotinfo;\n\n        // link or create subplot object\n        if(oldSubplot) {\n            plotinfo = newSubplots[id] = oldSubplot;\n        } else {\n            plotinfo = newSubplots[id] = {};\n            plotinfo.id = id;\n        }\n\n        // add these axis ids to each others' subplot lists\n        xaxis._counterAxes.push(yaxis._id);\n        yaxis._counterAxes.push(xaxis._id);\n        xaxis._subplotsWith.push(id);\n        yaxis._subplotsWith.push(id);\n\n        // update x and y axis layout object refs\n        plotinfo.xaxis = xaxis;\n        plotinfo.yaxis = yaxis;\n\n        // By default, we clip at the subplot level,\n        // but if one trace on a given subplot has *cliponaxis* set to false,\n        // we need to clip at the trace module layer level;\n        // find this out here, once of for all.\n        plotinfo._hasClipOnAxisFalse = false;\n\n        for(j = 0; j < newFullData.length; j++) {\n            var trace = newFullData[j];\n\n            if(\n                trace.xaxis === plotinfo.xaxis._id &&\n                trace.yaxis === plotinfo.yaxis._id &&\n                trace.cliponaxis === false\n            ) {\n                plotinfo._hasClipOnAxisFalse = true;\n                break;\n            }\n        }\n    }\n\n    // while we're at it, link overlaying axes to their main axes and\n    // anchored axes to the axes they're anchored to\n    var axList = axisIDs.list(mockGd, null, true);\n    var ax;\n    for(i = 0; i < axList.length; i++) {\n        ax = axList[i];\n        var mainAx = null;\n\n        if(ax.overlaying) {\n            mainAx = axisIDs.getFromId(mockGd, ax.overlaying);\n\n            // you cannot overlay an axis that's already overlaying another\n            if(mainAx && mainAx.overlaying) {\n                ax.overlaying = false;\n                mainAx = null;\n            }\n        }\n        ax._mainAxis = mainAx || ax;\n\n        /*\n         * For now force overlays to overlay completely... so they\n         * can drag together correctly and share backgrounds.\n         * Later perhaps we make separate axis domain and\n         * tick/line domain or something, so they can still share\n         * the (possibly larger) dragger and background but don't\n         * have to both be drawn over that whole domain\n         */\n        if(mainAx) ax.domain = mainAx.domain.slice();\n\n        ax._anchorAxis = ax.anchor === 'free' ?\n            null :\n            axisIDs.getFromId(mockGd, ax.anchor);\n    }\n\n    // finally, we can find the main subplot for each axis\n    // (on which the ticks & labels are drawn)\n    for(i = 0; i < axList.length; i++) {\n        ax = axList[i];\n        ax._counterAxes.sort(axisIDs.idSort);\n        ax._subplotsWith.sort(Lib.subplotSort);\n        ax._mainSubplot = findMainSubplot(ax, newFullLayout);\n\n        // find \"full\" domain span of counter axes,\n        // this loop can be costly, so only compute it when required\n        if(ax._counterAxes.length && (\n            (ax.spikemode && ax.spikemode.indexOf('across') !== -1) ||\n            (ax.automargin && ax.mirror && ax.anchor !== 'free') ||\n            Registry.getComponentMethod('rangeslider', 'isVisible')(ax)\n        )) {\n            var min = 1;\n            var max = 0;\n            for(j = 0; j < ax._counterAxes.length; j++) {\n                var ax2 = axisIDs.getFromId(mockGd, ax._counterAxes[j]);\n                min = Math.min(min, ax2.domain[0]);\n                max = Math.max(max, ax2.domain[1]);\n            }\n            if(min < max) {\n                ax._counterDomainMin = min;\n                ax._counterDomainMax = max;\n            }\n        }\n    }\n};\n\nfunction findMainSubplot(ax, fullLayout) {\n    var mockGd = {_fullLayout: fullLayout};\n\n    var isX = ax._id.charAt(0) === 'x';\n    var anchorAx = ax._mainAxis._anchorAxis;\n    var mainSubplotID = '';\n    var nextBestMainSubplotID = '';\n    var anchorID = '';\n\n    // First try the main ID with the anchor\n    if(anchorAx) {\n        anchorID = anchorAx._mainAxis._id;\n        mainSubplotID = isX ? (ax._id + anchorID) : (anchorID + ax._id);\n    }\n\n    // Then look for a subplot with the counteraxis overlaying the anchor\n    // If that fails just use the first subplot including this axis\n    if(!mainSubplotID || !fullLayout._plots[mainSubplotID]) {\n        mainSubplotID = '';\n\n        var counterIDs = ax._counterAxes;\n        for(var j = 0; j < counterIDs.length; j++) {\n            var counterPart = counterIDs[j];\n            var id = isX ? (ax._id + counterPart) : (counterPart + ax._id);\n            if(!nextBestMainSubplotID) nextBestMainSubplotID = id;\n            var counterAx = axisIDs.getFromId(mockGd, counterPart);\n            if(anchorID && counterAx.overlaying === anchorID) {\n                mainSubplotID = id;\n                break;\n            }\n        }\n    }\n\n    return mainSubplotID || nextBestMainSubplotID;\n}\n\n// This function clears any trace attributes with valType: color and\n// no set dflt filed in the plot schema. This is needed because groupby (which\n// is the only transform for which this currently applies) supplies parent\n// trace defaults, then expanded trace defaults. The result is that `null`\n// colors are default-supplied and inherited as a color instead of a null.\n// The result is that expanded trace default colors have no effect, with\n// the final result that groups are indistinguishable. This function clears\n// those colors so that individual groupby groups get unique colors.\nplots.clearExpandedTraceDefaultColors = function(trace) {\n    var colorAttrs, path, i;\n\n    // This uses weird closure state in order to satisfy the linter rule\n    // that we can't create functions in a loop.\n    function locateColorAttrs(attr, attrName, attrs, level) {\n        path[level] = attrName;\n        path.length = level + 1;\n        if(attr.valType === 'color' && attr.dflt === undefined) {\n            colorAttrs.push(path.join('.'));\n        }\n    }\n\n    path = [];\n\n    // Get the cached colorAttrs:\n    colorAttrs = trace._module._colorAttrs;\n\n    // Or else compute and cache the colorAttrs on the module:\n    if(!colorAttrs) {\n        trace._module._colorAttrs = colorAttrs = [];\n        PlotSchema.crawl(\n            trace._module.attributes,\n            locateColorAttrs\n        );\n    }\n\n    for(i = 0; i < colorAttrs.length; i++) {\n        var origprop = Lib.nestedProperty(trace, '_input.' + colorAttrs[i]);\n\n        if(!origprop.get()) {\n            Lib.nestedProperty(trace, colorAttrs[i]).set(null);\n        }\n    }\n};\n\n\nplots.supplyDataDefaults = function(dataIn, dataOut, layout, fullLayout) {\n    var modules = fullLayout._modules;\n    var visibleModules = fullLayout._visibleModules;\n    var basePlotModules = fullLayout._basePlotModules;\n    var cnt = 0;\n    var colorCnt = 0;\n\n    var i, fullTrace, trace;\n\n    fullLayout._transformModules = [];\n\n    function pushModule(fullTrace) {\n        dataOut.push(fullTrace);\n\n        var _module = fullTrace._module;\n        if(!_module) return;\n\n        Lib.pushUnique(modules, _module);\n        if(fullTrace.visible === true) Lib.pushUnique(visibleModules, _module);\n        Lib.pushUnique(basePlotModules, fullTrace._module.basePlotModule);\n        cnt++;\n\n        // TODO: do we really want color not to increment for explicitly invisible traces?\n        // This logic is weird, but matches previous behavior: traces that you explicitly\n        // set to visible:false do not increment the color, but traces WE determine to be\n        // empty or invalid (and thus set to visible:false) DO increment color.\n        // I kind of think we should just let all traces increment color, visible or not.\n        // see mock: axes-autotype-empty vs. a test of restyling visible: false that\n        // I can't find right now...\n        if(fullTrace._input.visible !== false) colorCnt++;\n    }\n\n    var carpetIndex = {};\n    var carpetDependents = [];\n    var dataTemplate = (layout.template || {}).data || {};\n    var templater = Template.traceTemplater(dataTemplate);\n\n    for(i = 0; i < dataIn.length; i++) {\n        trace = dataIn[i];\n\n        // reuse uid we may have pulled out of oldFullData\n        // Note: templater supplies trace type\n        fullTrace = templater.newTrace(trace);\n        fullTrace.uid = fullLayout._traceUids[i];\n        plots.supplyTraceDefaults(trace, fullTrace, colorCnt, fullLayout, i);\n\n        fullTrace.index = i;\n        fullTrace._input = trace;\n        fullTrace._expandedIndex = cnt;\n\n        if(fullTrace.transforms && fullTrace.transforms.length) {\n            var sdInvisible = trace.visible !== false && fullTrace.visible === false;\n\n            var expandedTraces = applyTransforms(fullTrace, dataOut, layout, fullLayout);\n\n            for(var j = 0; j < expandedTraces.length; j++) {\n                var expandedTrace = expandedTraces[j];\n\n                // No further templating during transforms.\n                var fullExpandedTrace = {\n                    _template: fullTrace._template,\n                    type: fullTrace.type,\n                    // set uid using parent uid and expanded index\n                    // to promote consistency between update calls\n                    uid: fullTrace.uid + j\n                };\n\n                // If the first supplyDefaults created `visible: false`,\n                // clear it before running supplyDefaults a second time,\n                // because sometimes there are items we still want to coerce\n                // inside trace modules before determining that the trace is\n                // again `visible: false`, for example partial visibilities\n                // in `splom` traces.\n                if(sdInvisible && expandedTrace.visible === false) {\n                    delete expandedTrace.visible;\n                }\n\n                plots.supplyTraceDefaults(expandedTrace, fullExpandedTrace, cnt, fullLayout, i);\n\n                // relink private (i.e. underscore) keys expanded trace to full expanded trace so\n                // that transform supply-default methods can set _ keys for future use.\n                relinkPrivateKeys(fullExpandedTrace, expandedTrace);\n\n                // add info about parent data trace\n                fullExpandedTrace.index = i;\n                fullExpandedTrace._input = trace;\n                fullExpandedTrace._fullInput = fullTrace;\n\n                // add info about the expanded data\n                fullExpandedTrace._expandedIndex = cnt;\n                fullExpandedTrace._expandedInput = expandedTrace;\n\n                pushModule(fullExpandedTrace);\n            }\n        } else {\n            // add identify refs for consistency with transformed traces\n            fullTrace._fullInput = fullTrace;\n            fullTrace._expandedInput = fullTrace;\n\n            pushModule(fullTrace);\n        }\n\n        if(Registry.traceIs(fullTrace, 'carpetAxis')) {\n            carpetIndex[fullTrace.carpet] = fullTrace;\n        }\n\n        if(Registry.traceIs(fullTrace, 'carpetDependent')) {\n            carpetDependents.push(i);\n        }\n    }\n\n    for(i = 0; i < carpetDependents.length; i++) {\n        fullTrace = dataOut[carpetDependents[i]];\n\n        if(!fullTrace.visible) continue;\n\n        var carpetAxis = carpetIndex[fullTrace.carpet];\n        fullTrace._carpet = carpetAxis;\n\n        if(!carpetAxis || !carpetAxis.visible) {\n            fullTrace.visible = false;\n            continue;\n        }\n\n        fullTrace.xaxis = carpetAxis.xaxis;\n        fullTrace.yaxis = carpetAxis.yaxis;\n    }\n};\n\nplots.supplyAnimationDefaults = function(opts) {\n    opts = opts || {};\n    var i;\n    var optsOut = {};\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(opts || {}, optsOut, animationAttrs, attr, dflt);\n    }\n\n    coerce('mode');\n    coerce('direction');\n    coerce('fromcurrent');\n\n    if(Array.isArray(opts.frame)) {\n        optsOut.frame = [];\n        for(i = 0; i < opts.frame.length; i++) {\n            optsOut.frame[i] = plots.supplyAnimationFrameDefaults(opts.frame[i] || {});\n        }\n    } else {\n        optsOut.frame = plots.supplyAnimationFrameDefaults(opts.frame || {});\n    }\n\n    if(Array.isArray(opts.transition)) {\n        optsOut.transition = [];\n        for(i = 0; i < opts.transition.length; i++) {\n            optsOut.transition[i] = plots.supplyAnimationTransitionDefaults(opts.transition[i] || {});\n        }\n    } else {\n        optsOut.transition = plots.supplyAnimationTransitionDefaults(opts.transition || {});\n    }\n\n    return optsOut;\n};\n\nplots.supplyAnimationFrameDefaults = function(opts) {\n    var optsOut = {};\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(opts || {}, optsOut, animationAttrs.frame, attr, dflt);\n    }\n\n    coerce('duration');\n    coerce('redraw');\n\n    return optsOut;\n};\n\nplots.supplyAnimationTransitionDefaults = function(opts) {\n    var optsOut = {};\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(opts || {}, optsOut, animationAttrs.transition, attr, dflt);\n    }\n\n    coerce('duration');\n    coerce('easing');\n\n    return optsOut;\n};\n\nplots.supplyFrameDefaults = function(frameIn) {\n    var frameOut = {};\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(frameIn, frameOut, frameAttrs, attr, dflt);\n    }\n\n    coerce('group');\n    coerce('name');\n    coerce('traces');\n    coerce('baseframe');\n    coerce('data');\n    coerce('layout');\n\n    return frameOut;\n};\n\nplots.supplyTraceDefaults = function(traceIn, traceOut, colorIndex, layout, traceInIndex) {\n    var colorway = layout.colorway || Color.defaults;\n    var defaultColor = colorway[colorIndex % colorway.length];\n\n    var i;\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(traceIn, traceOut, plots.attributes, attr, dflt);\n    }\n\n    var visible = coerce('visible');\n\n    coerce('type');\n    coerce('name', layout._traceWord + ' ' + traceInIndex);\n\n    coerce('uirevision', layout.uirevision);\n\n    // we want even invisible traces to make their would-be subplots visible\n    // so coerce the subplot id(s) now no matter what\n    var _module = plots.getModule(traceOut);\n\n    traceOut._module = _module;\n    if(_module) {\n        var basePlotModule = _module.basePlotModule;\n        var subplotAttr = basePlotModule.attr;\n        var subplotAttrs = basePlotModule.attributes;\n        if(subplotAttr && subplotAttrs) {\n            var subplots = layout._subplots;\n            var subplotId = '';\n\n            if(\n                visible ||\n                basePlotModule.name !== 'gl2d' // for now just drop empty gl2d subplots\n                // TODO - currently if we draw an empty gl2d subplot, it draws\n                // nothing then gets stuck and you can't get it back without newPlot\n                // sort this out in the regl refactor?\n            ) {\n                if(Array.isArray(subplotAttr)) {\n                    for(i = 0; i < subplotAttr.length; i++) {\n                        var attri = subplotAttr[i];\n                        var vali = Lib.coerce(traceIn, traceOut, subplotAttrs, attri);\n\n                        if(subplots[attri]) Lib.pushUnique(subplots[attri], vali);\n                        subplotId += vali;\n                    }\n                } else {\n                    subplotId = Lib.coerce(traceIn, traceOut, subplotAttrs, subplotAttr);\n                }\n\n                if(subplots[basePlotModule.name]) {\n                    Lib.pushUnique(subplots[basePlotModule.name], subplotId);\n                }\n            }\n        }\n    }\n\n    if(visible) {\n        coerce('customdata');\n        coerce('ids');\n        coerce('meta');\n\n        if(Registry.traceIs(traceOut, 'showLegend')) {\n            Lib.coerce(traceIn, traceOut,\n                _module.attributes.showlegend ? _module.attributes : plots.attributes,\n                'showlegend'\n            );\n\n            coerce('legendgroup');\n            var titleText = coerce('legendgrouptitle.text');\n            if(titleText) {\n                Lib.coerceFont(coerce, 'legendgrouptitle.font', Lib.extendFlat({}, layout.font, {\n                    size: Math.round(layout.font.size * 1.1) // default to larger font size\n                }));\n            }\n\n            coerce('legendrank');\n\n            traceOut._dfltShowLegend = true;\n        } else {\n            traceOut._dfltShowLegend = false;\n        }\n\n        if(_module) {\n            _module.supplyDefaults(traceIn, traceOut, defaultColor, layout);\n        }\n\n        if(!Registry.traceIs(traceOut, 'noOpacity')) {\n            coerce('opacity');\n        }\n\n        if(Registry.traceIs(traceOut, 'notLegendIsolatable')) {\n            // This clears out the legendonly state for traces like carpet that\n            // cannot be isolated in the legend\n            traceOut.visible = !!traceOut.visible;\n        }\n\n        if(!Registry.traceIs(traceOut, 'noHover')) {\n            if(!traceOut.hovertemplate) Lib.coerceHoverinfo(traceIn, traceOut, layout);\n\n            // parcats support hover, but not hoverlabel stylings (yet)\n            if(traceOut.type !== 'parcats') {\n                Registry.getComponentMethod('fx', 'supplyDefaults')(traceIn, traceOut, defaultColor, layout);\n            }\n        }\n\n        if(_module && _module.selectPoints) {\n            coerce('selectedpoints');\n        }\n\n        plots.supplyTransformDefaults(traceIn, traceOut, layout);\n    }\n\n    return traceOut;\n};\n\n/**\n * hasMakesDataTransform: does this trace have a transform that makes its own\n * data, either by grabbing it from somewhere else or by creating it from input\n * parameters? If so, we should still keep going with supplyDefaults\n * even if the trace is invisible, which may just be because it has no data yet.\n */\nfunction hasMakesDataTransform(trace) {\n    var transforms = trace.transforms;\n    if(Array.isArray(transforms) && transforms.length) {\n        for(var i = 0; i < transforms.length; i++) {\n            var ti = transforms[i];\n            var _module = ti._module || transformsRegistry[ti.type];\n            if(_module && _module.makesData) return true;\n        }\n    }\n    return false;\n}\n\nplots.hasMakesDataTransform = hasMakesDataTransform;\n\nplots.supplyTransformDefaults = function(traceIn, traceOut, layout) {\n    // For now we only allow transforms on 1D traces, ie those that specify a _length.\n    // If we were to implement 2D transforms, we'd need to have each transform\n    // describe its own applicability and disable itself when it doesn't apply.\n    // Also allow transforms that make their own data, but not in globalTransforms\n    if(!(traceOut._length || hasMakesDataTransform(traceIn))) return;\n\n    var globalTransforms = layout._globalTransforms || [];\n    var transformModules = layout._transformModules || [];\n\n    if(!Array.isArray(traceIn.transforms) && globalTransforms.length === 0) return;\n\n    var containerIn = traceIn.transforms || [];\n    var transformList = globalTransforms.concat(containerIn);\n    var containerOut = traceOut.transforms = [];\n\n    for(var i = 0; i < transformList.length; i++) {\n        var transformIn = transformList[i];\n        var type = transformIn.type;\n        var _module = transformsRegistry[type];\n        var transformOut;\n\n        /*\n         * Supply defaults may run twice. First pass runs all supply defaults steps\n         * and adds the _module to any output transforms.\n         * If transforms exist another pass is run so that any generated traces also\n         * go through supply defaults. This has the effect of rerunning\n         * supplyTransformDefaults. If the transform does not have a `transform`\n         * function it could not have generated any new traces and the second stage\n         * is unnecessary. We detect this case with the following variables.\n         */\n        var isFirstStage = !(transformIn._module && transformIn._module === _module);\n        var doLaterStages = _module && typeof _module.transform === 'function';\n\n        if(!_module) Lib.warn('Unrecognized transform type ' + type + '.');\n\n        if(_module && _module.supplyDefaults && (isFirstStage || doLaterStages)) {\n            transformOut = _module.supplyDefaults(transformIn, traceOut, layout, traceIn);\n            transformOut.type = type;\n            transformOut._module = _module;\n\n            Lib.pushUnique(transformModules, _module);\n        } else {\n            transformOut = Lib.extendFlat({}, transformIn);\n        }\n\n        containerOut.push(transformOut);\n    }\n};\n\nfunction applyTransforms(fullTrace, fullData, layout, fullLayout) {\n    var container = fullTrace.transforms;\n    var dataOut = [fullTrace];\n\n    for(var i = 0; i < container.length; i++) {\n        var transform = container[i];\n        var _module = transformsRegistry[transform.type];\n\n        if(_module && _module.transform) {\n            dataOut = _module.transform(dataOut, {\n                transform: transform,\n                fullTrace: fullTrace,\n                fullData: fullData,\n                layout: layout,\n                fullLayout: fullLayout,\n                transformIndex: i\n            });\n        }\n    }\n\n    return dataOut;\n}\n\nplots.supplyLayoutGlobalDefaults = function(layoutIn, layoutOut, formatObj) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(layoutIn, layoutOut, plots.layoutAttributes, attr, dflt);\n    }\n\n    var template = layoutIn.template;\n    if(Lib.isPlainObject(template)) {\n        layoutOut.template = template;\n        layoutOut._template = template.layout;\n        layoutOut._dataTemplate = template.data;\n    }\n\n    coerce('autotypenumbers');\n\n    var globalFont = Lib.coerceFont(coerce, 'font');\n\n    coerce('title.text', layoutOut._dfltTitle.plot);\n\n    Lib.coerceFont(coerce, 'title.font', {\n        family: globalFont.family,\n        size: Math.round(globalFont.size * 1.4),\n        color: globalFont.color\n    });\n\n    coerce('title.xref');\n    coerce('title.yref');\n    coerce('title.x');\n    coerce('title.y');\n    coerce('title.xanchor');\n    coerce('title.yanchor');\n    coerce('title.pad.t');\n    coerce('title.pad.r');\n    coerce('title.pad.b');\n    coerce('title.pad.l');\n\n    var uniformtextMode = coerce('uniformtext.mode');\n    if(uniformtextMode) {\n        coerce('uniformtext.minsize');\n    }\n\n    // Make sure that autosize is defaulted to *true*\n    // on layouts with no set width and height for backward compatibly,\n    // in particular https://plotly.com/javascript/responsive-fluid-layout/\n    //\n    // Before https://github.com/plotly/plotly.js/pull/635 ,\n    // layouts with no set width and height were set temporary set to 'initial'\n    // to pass through the autosize routine\n    //\n    // This behavior is subject to change in v3.\n    coerce('autosize', !(layoutIn.width && layoutIn.height));\n\n    coerce('width');\n    coerce('height');\n    coerce('margin.l');\n    coerce('margin.r');\n    coerce('margin.t');\n    coerce('margin.b');\n    coerce('margin.pad');\n    coerce('margin.autoexpand');\n\n    if(layoutIn.width && layoutIn.height) plots.sanitizeMargins(layoutOut);\n\n    Registry.getComponentMethod('grid', 'sizeDefaults')(layoutIn, layoutOut);\n\n    coerce('paper_bgcolor');\n\n    coerce('separators', formatObj.decimal + formatObj.thousands);\n    coerce('hidesources');\n\n    coerce('colorway');\n\n    coerce('datarevision');\n    var uirevision = coerce('uirevision');\n    coerce('editrevision', uirevision);\n    coerce('selectionrevision', uirevision);\n\n    Registry.getComponentMethod(\n        'modebar',\n        'supplyLayoutDefaults'\n    )(layoutIn, layoutOut);\n\n    Registry.getComponentMethod(\n        'shapes',\n        'supplyDrawNewShapeDefaults'\n    )(layoutIn, layoutOut, coerce);\n\n    coerce('meta');\n\n    // do not include defaults in fullLayout when users do not set transition\n    if(Lib.isPlainObject(layoutIn.transition)) {\n        coerce('transition.duration');\n        coerce('transition.easing');\n        coerce('transition.ordering');\n    }\n\n    Registry.getComponentMethod(\n        'calendars',\n        'handleDefaults'\n    )(layoutIn, layoutOut, 'calendar');\n\n    Registry.getComponentMethod(\n        'fx',\n        'supplyLayoutGlobalDefaults'\n    )(layoutIn, layoutOut, coerce);\n};\n\nfunction getComputedSize(attr) {\n    return (\n        (typeof attr === 'string') &&\n        (attr.substr(attr.length - 2) === 'px') &&\n        parseFloat(attr)\n    );\n}\n\n\nplots.plotAutoSize = function plotAutoSize(gd, layout, fullLayout) {\n    var context = gd._context || {};\n    var frameMargins = context.frameMargins;\n    var newWidth;\n    var newHeight;\n\n    var isPlotDiv = Lib.isPlotDiv(gd);\n\n    if(isPlotDiv) gd.emit('plotly_autosize');\n\n    // embedded in an iframe - just take the full iframe size\n    // if we get to this point, with no aspect ratio restrictions\n    if(context.fillFrame) {\n        newWidth = window.innerWidth;\n        newHeight = window.innerHeight;\n\n        // somehow we get a few extra px height sometimes...\n        // just hide it\n        document.body.style.overflow = 'hidden';\n    } else {\n        // plotly.js - let the developers do what they want, either\n        // provide height and width for the container div,\n        // specify size in layout, or take the defaults,\n        // but don't enforce any ratio restrictions\n        var computedStyle = isPlotDiv ? window.getComputedStyle(gd) : {};\n\n        newWidth = getComputedSize(computedStyle.width) || getComputedSize(computedStyle.maxWidth) || fullLayout.width;\n        newHeight = getComputedSize(computedStyle.height) || getComputedSize(computedStyle.maxHeight) || fullLayout.height;\n\n        if(isNumeric(frameMargins) && frameMargins > 0) {\n            var factor = 1 - 2 * frameMargins;\n            newWidth = Math.round(factor * newWidth);\n            newHeight = Math.round(factor * newHeight);\n        }\n    }\n\n    var minWidth = plots.layoutAttributes.width.min;\n    var minHeight = plots.layoutAttributes.height.min;\n    if(newWidth < minWidth) newWidth = minWidth;\n    if(newHeight < minHeight) newHeight = minHeight;\n\n    var widthHasChanged = !layout.width &&\n        (Math.abs(fullLayout.width - newWidth) > 1);\n    var heightHasChanged = !layout.height &&\n        (Math.abs(fullLayout.height - newHeight) > 1);\n\n    if(heightHasChanged || widthHasChanged) {\n        if(widthHasChanged) fullLayout.width = newWidth;\n        if(heightHasChanged) fullLayout.height = newHeight;\n    }\n\n    // cache initial autosize value, used in relayout when\n    // width or height values are set to null\n    if(!gd._initialAutoSize) {\n        gd._initialAutoSize = { width: newWidth, height: newHeight };\n    }\n\n    plots.sanitizeMargins(fullLayout);\n};\n\nplots.supplyLayoutModuleDefaults = function(layoutIn, layoutOut, fullData, transitionData) {\n    var componentsRegistry = Registry.componentsRegistry;\n    var basePlotModules = layoutOut._basePlotModules;\n    var component, i, _module;\n\n    var Cartesian = Registry.subplotsRegistry.cartesian;\n\n    // check if any components need to add more base plot modules\n    // that weren't captured by traces\n    for(component in componentsRegistry) {\n        _module = componentsRegistry[component];\n\n        if(_module.includeBasePlot) {\n            _module.includeBasePlot(layoutIn, layoutOut);\n        }\n    }\n\n    // make sure we *at least* have some cartesian axes\n    if(!basePlotModules.length) {\n        basePlotModules.push(Cartesian);\n    }\n\n    // ensure all cartesian axes have at least one subplot\n    if(layoutOut._has('cartesian')) {\n        Registry.getComponentMethod('grid', 'contentDefaults')(layoutIn, layoutOut);\n        Cartesian.finalizeSubplots(layoutIn, layoutOut);\n    }\n\n    // sort subplot lists\n    for(var subplotType in layoutOut._subplots) {\n        layoutOut._subplots[subplotType].sort(Lib.subplotSort);\n    }\n\n    // base plot module layout defaults\n    for(i = 0; i < basePlotModules.length; i++) {\n        _module = basePlotModules[i];\n\n        // e.g. pie does not have a layout-defaults step\n        if(_module.supplyLayoutDefaults) {\n            _module.supplyLayoutDefaults(layoutIn, layoutOut, fullData);\n        }\n    }\n\n    // trace module layout defaults\n    // use _modules rather than _visibleModules so that even\n    // legendonly traces can include settings - eg barmode, which affects\n    // legend.traceorder default value.\n    var modules = layoutOut._modules;\n    for(i = 0; i < modules.length; i++) {\n        _module = modules[i];\n\n        if(_module.supplyLayoutDefaults) {\n            _module.supplyLayoutDefaults(layoutIn, layoutOut, fullData);\n        }\n    }\n\n    // transform module layout defaults\n    var transformModules = layoutOut._transformModules;\n    for(i = 0; i < transformModules.length; i++) {\n        _module = transformModules[i];\n\n        if(_module.supplyLayoutDefaults) {\n            _module.supplyLayoutDefaults(layoutIn, layoutOut, fullData, transitionData);\n        }\n    }\n\n    for(component in componentsRegistry) {\n        _module = componentsRegistry[component];\n\n        if(_module.supplyLayoutDefaults) {\n            _module.supplyLayoutDefaults(layoutIn, layoutOut, fullData);\n        }\n    }\n};\n\n// Remove all plotly attributes from a div so it can be replotted fresh\n// TODO: these really need to be encapsulated into a much smaller set...\nplots.purge = function(gd) {\n    // note: we DO NOT remove _context because it doesn't change when we insert\n    // a new plot, and may have been set outside of our scope.\n\n    var fullLayout = gd._fullLayout || {};\n    if(fullLayout._glcontainer !== undefined) {\n        fullLayout._glcontainer.selectAll('.gl-canvas').remove();\n        fullLayout._glcontainer.remove();\n        fullLayout._glcanvas = null;\n    }\n\n    // remove modebar\n    if(fullLayout._modeBar) fullLayout._modeBar.destroy();\n\n    if(gd._transitionData) {\n        // Ensure any dangling callbacks are simply dropped if the plot is purged.\n        // This is more or less only actually important for testing.\n        if(gd._transitionData._interruptCallbacks) {\n            gd._transitionData._interruptCallbacks.length = 0;\n        }\n\n        if(gd._transitionData._animationRaf) {\n            window.cancelAnimationFrame(gd._transitionData._animationRaf);\n        }\n    }\n\n    // remove any planned throttles\n    Lib.clearThrottle();\n\n    // remove responsive handler\n    Lib.clearResponsive(gd);\n\n    // data and layout\n    delete gd.data;\n    delete gd.layout;\n    delete gd._fullData;\n    delete gd._fullLayout;\n    delete gd.calcdata;\n    delete gd.empty;\n\n    delete gd.fid;\n\n    delete gd.undoqueue; // action queue\n    delete gd.undonum;\n    delete gd.autoplay; // are we doing an action that doesn't go in undo queue?\n    delete gd.changed;\n\n    // these get recreated on _doPlot anyway, but just to be safe\n    // (and to have a record of them...)\n    delete gd._promises;\n    delete gd._redrawTimer;\n    delete gd._hmlumcount;\n    delete gd._hmpixcount;\n    delete gd._transitionData;\n    delete gd._transitioning;\n    delete gd._initialAutoSize;\n    delete gd._transitioningWithDuration;\n\n    // created during certain events, that *should* clean them up\n    // themselves, but may not if there was an error\n    delete gd._dragging;\n    delete gd._dragged;\n    delete gd._dragdata;\n    delete gd._hoverdata;\n    delete gd._snapshotInProgress;\n    delete gd._editing;\n    delete gd._mouseDownTime;\n    delete gd._legendMouseDownTime;\n\n    // remove all event listeners\n    if(gd.removeAllListeners) gd.removeAllListeners();\n};\n\nplots.style = function(gd) {\n    var _modules = gd._fullLayout._visibleModules;\n    var styleModules = [];\n    var i;\n\n    // some trace modules reuse the same style method,\n    // make sure to not unnecessary call them multiple times.\n\n    for(i = 0; i < _modules.length; i++) {\n        var _module = _modules[i];\n        if(_module.style) {\n            Lib.pushUnique(styleModules, _module.style);\n        }\n    }\n\n    for(i = 0; i < styleModules.length; i++) {\n        styleModules[i](gd);\n    }\n};\n\nplots.sanitizeMargins = function(fullLayout) {\n    // polar doesn't do margins...\n    if(!fullLayout || !fullLayout.margin) return;\n\n    var width = fullLayout.width;\n    var height = fullLayout.height;\n    var margin = fullLayout.margin;\n    var plotWidth = width - (margin.l + margin.r);\n    var plotHeight = height - (margin.t + margin.b);\n    var correction;\n\n    // if margin.l + margin.r = 0 then plotWidth > 0\n    // as width >= 10 by supplyDefaults\n    // similarly for margin.t + margin.b\n\n    if(plotWidth < 0) {\n        correction = (width - 1) / (margin.l + margin.r);\n        margin.l = Math.floor(correction * margin.l);\n        margin.r = Math.floor(correction * margin.r);\n    }\n\n    if(plotHeight < 0) {\n        correction = (height - 1) / (margin.t + margin.b);\n        margin.t = Math.floor(correction * margin.t);\n        margin.b = Math.floor(correction * margin.b);\n    }\n};\n\nplots.clearAutoMarginIds = function(gd) {\n    gd._fullLayout._pushmarginIds = {};\n};\n\nplots.allowAutoMargin = function(gd, id) {\n    gd._fullLayout._pushmarginIds[id] = 1;\n};\n\nfunction initMargins(fullLayout) {\n    var margin = fullLayout.margin;\n\n    if(!fullLayout._size) {\n        var gs = fullLayout._size = {\n            l: Math.round(margin.l),\n            r: Math.round(margin.r),\n            t: Math.round(margin.t),\n            b: Math.round(margin.b),\n            p: Math.round(margin.pad)\n        };\n        gs.w = Math.round(fullLayout.width) - gs.l - gs.r;\n        gs.h = Math.round(fullLayout.height) - gs.t - gs.b;\n    }\n    if(!fullLayout._pushmargin) fullLayout._pushmargin = {};\n    if(!fullLayout._pushmarginIds) fullLayout._pushmarginIds = {};\n}\n\n// non-negotiable - this is the smallest height we will allow users to specify via explicit margins\nvar MIN_SPECIFIED_WIDTH = 2;\nvar MIN_SPECIFIED_HEIGHT = 2;\n\n// could be exposed as an option - the smallest we will allow automargin to shrink a larger plot\nvar MIN_REDUCED_WIDTH = 64;\nvar MIN_REDUCED_HEIGHT = 64;\n\n/**\n * autoMargin: called by components that may need to expand the margins to\n * be rendered on-plot.\n *\n * @param {DOM element} gd\n * @param {string} id - an identifier unique (within this plot) to this object,\n *     so we can remove a previous margin expansion from the same object.\n * @param {object} o - the margin requirements of this object, or omit to delete\n *     this entry (like if it's hidden). Keys are:\n *     x, y: plot fraction of the anchor point.\n *     xl, xr, yt, yb: if the object has an extent defined in plot fraction,\n *         you can specify both edges as plot fractions in each dimension\n *     l, r, t, b: the pixels to pad past the plot fraction x[l|r] and y[t|b]\n *     pad: extra pixels to add in all directions, default 12 (why?)\n */\nplots.autoMargin = function(gd, id, o) {\n    var fullLayout = gd._fullLayout;\n    var width = fullLayout.width;\n    var height = fullLayout.height;\n    var margin = fullLayout.margin;\n\n    var minFinalWidth = Lib.constrain(\n        width - margin.l - margin.r,\n        MIN_SPECIFIED_WIDTH,\n        MIN_REDUCED_WIDTH\n    );\n\n    var minFinalHeight = Lib.constrain(\n        height - margin.t - margin.b,\n        MIN_SPECIFIED_HEIGHT,\n        MIN_REDUCED_HEIGHT\n    );\n\n    var maxSpaceW = Math.max(0, width - minFinalWidth);\n    var maxSpaceH = Math.max(0, height - minFinalHeight);\n\n    var pushMargin = fullLayout._pushmargin;\n    var pushMarginIds = fullLayout._pushmarginIds;\n\n    if(margin.autoexpand !== false) {\n        if(!o) {\n            delete pushMargin[id];\n            delete pushMarginIds[id];\n        } else {\n            var pad = o.pad;\n            if(pad === undefined) {\n                // if no explicit pad is given, use 12px unless there's a\n                // specified margin that's smaller than that\n                pad = Math.min(12, margin.l, margin.r, margin.t, margin.b);\n            }\n\n            // if the item is too big, just give it enough automargin to\n            // make sure you can still grab it and bring it back\n            if(maxSpaceW) {\n                var rW = (o.l + o.r) / maxSpaceW;\n                if(rW > 1) {\n                    o.l /= rW;\n                    o.r /= rW;\n                }\n            }\n            if(maxSpaceH) {\n                var rH = (o.t + o.b) / maxSpaceH;\n                if(rH > 1) {\n                    o.t /= rH;\n                    o.b /= rH;\n                }\n            }\n\n            var xl = o.xl !== undefined ? o.xl : o.x;\n            var xr = o.xr !== undefined ? o.xr : o.x;\n            var yt = o.yt !== undefined ? o.yt : o.y;\n            var yb = o.yb !== undefined ? o.yb : o.y;\n\n            pushMargin[id] = {\n                l: {val: xl, size: o.l + pad},\n                r: {val: xr, size: o.r + pad},\n                b: {val: yb, size: o.b + pad},\n                t: {val: yt, size: o.t + pad}\n            };\n            pushMarginIds[id] = 1;\n        }\n\n        if(!fullLayout._replotting) {\n            return plots.doAutoMargin(gd);\n        }\n    }\n};\n\nplots.doAutoMargin = function(gd) {\n    var fullLayout = gd._fullLayout;\n    var width = fullLayout.width;\n    var height = fullLayout.height;\n\n    if(!fullLayout._size) fullLayout._size = {};\n    initMargins(fullLayout);\n\n    var gs = fullLayout._size;\n    var margin = fullLayout.margin;\n    var oldMargins = Lib.extendFlat({}, gs);\n\n    // adjust margins for outside components\n    // fullLayout.margin is the requested margin,\n    // fullLayout._size has margins and plotsize after adjustment\n    var ml = margin.l;\n    var mr = margin.r;\n    var mt = margin.t;\n    var mb = margin.b;\n    var pushMargin = fullLayout._pushmargin;\n    var pushMarginIds = fullLayout._pushmarginIds;\n\n    if(fullLayout.margin.autoexpand !== false) {\n        for(var k in pushMargin) {\n            if(!pushMarginIds[k]) delete pushMargin[k];\n        }\n\n        // fill in the requested margins\n        pushMargin.base = {\n            l: {val: 0, size: ml},\n            r: {val: 1, size: mr},\n            t: {val: 1, size: mt},\n            b: {val: 0, size: mb}\n        };\n\n        // now cycle through all the combinations of l and r\n        // (and t and b) to find the required margins\n\n        for(var k1 in pushMargin) {\n            var pushleft = pushMargin[k1].l || {};\n            var pushbottom = pushMargin[k1].b || {};\n            var fl = pushleft.val;\n            var pl = pushleft.size;\n            var fb = pushbottom.val;\n            var pb = pushbottom.size;\n\n            for(var k2 in pushMargin) {\n                if(isNumeric(pl) && pushMargin[k2].r) {\n                    var fr = pushMargin[k2].r.val;\n                    var pr = pushMargin[k2].r.size;\n                    if(fr > fl) {\n                        var newL = (pl * fr + (pr - width) * fl) / (fr - fl);\n                        var newR = (pr * (1 - fl) + (pl - width) * (1 - fr)) / (fr - fl);\n                        if(newL + newR > ml + mr) {\n                            ml = newL;\n                            mr = newR;\n                        }\n                    }\n                }\n\n                if(isNumeric(pb) && pushMargin[k2].t) {\n                    var ft = pushMargin[k2].t.val;\n                    var pt = pushMargin[k2].t.size;\n                    if(ft > fb) {\n                        var newB = (pb * ft + (pt - height) * fb) / (ft - fb);\n                        var newT = (pt * (1 - fb) + (pb - height) * (1 - ft)) / (ft - fb);\n                        if(newB + newT > mb + mt) {\n                            mb = newB;\n                            mt = newT;\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    var minFinalWidth = Lib.constrain(\n        width - margin.l - margin.r,\n        MIN_SPECIFIED_WIDTH,\n        MIN_REDUCED_WIDTH\n    );\n\n    var minFinalHeight = Lib.constrain(\n        height - margin.t - margin.b,\n        MIN_SPECIFIED_HEIGHT,\n        MIN_REDUCED_HEIGHT\n    );\n\n    var maxSpaceW = Math.max(0, width - minFinalWidth);\n    var maxSpaceH = Math.max(0, height - minFinalHeight);\n\n    if(maxSpaceW) {\n        var rW = (ml + mr) / maxSpaceW;\n        if(rW > 1) {\n            ml /= rW;\n            mr /= rW;\n        }\n    }\n\n    if(maxSpaceH) {\n        var rH = (mb + mt) / maxSpaceH;\n        if(rH > 1) {\n            mb /= rH;\n            mt /= rH;\n        }\n    }\n\n    gs.l = Math.round(ml);\n    gs.r = Math.round(mr);\n    gs.t = Math.round(mt);\n    gs.b = Math.round(mb);\n    gs.p = Math.round(margin.pad);\n    gs.w = Math.round(width) - gs.l - gs.r;\n    gs.h = Math.round(height) - gs.t - gs.b;\n\n    // if things changed and we're not already redrawing, trigger a redraw\n    if(!fullLayout._replotting && plots.didMarginChange(oldMargins, gs)) {\n        if('_redrawFromAutoMarginCount' in fullLayout) {\n            fullLayout._redrawFromAutoMarginCount++;\n        } else {\n            fullLayout._redrawFromAutoMarginCount = 1;\n        }\n\n        // Always allow at least one redraw and give each margin-push\n        // call 3 loops to converge. Of course, for most cases this way too many,\n        // but let's keep things on the safe side until we fix our\n        // auto-margin pipeline problems:\n        // https://github.com/plotly/plotly.js/issues/2704\n        var maxNumberOfRedraws = 3 * (1 + Object.keys(pushMarginIds).length);\n\n        if(fullLayout._redrawFromAutoMarginCount < maxNumberOfRedraws) {\n            return Registry.call('_doPlot', gd);\n        } else {\n            fullLayout._size = oldMargins;\n            Lib.warn('Too many auto-margin redraws.');\n        }\n    }\n\n    refineTicks(gd);\n};\n\nfunction refineTicks(gd) {\n    var axList = axisIDs.list(gd, '', true);\n\n    [\n        '_adjustTickLabelsOverflow',\n        '_hideCounterAxisInsideTickLabels'\n    ].forEach(function(k) {\n        for(var i = 0; i < axList.length; i++) {\n            var hideFn = axList[i][k];\n            if(hideFn) hideFn();\n        }\n    });\n}\n\nvar marginKeys = ['l', 'r', 't', 'b', 'p', 'w', 'h'];\n\nplots.didMarginChange = function(margin0, margin1) {\n    for(var i = 0; i < marginKeys.length; i++) {\n        var k = marginKeys[i];\n        var m0 = margin0[k];\n        var m1 = margin1[k];\n        // use 1px tolerance in case we old/new differ only\n        // by rounding errors, which can lead to infinite loops\n        if(!isNumeric(m0) || Math.abs(m1 - m0) > 1) {\n            return true;\n        }\n    }\n    return false;\n};\n\n/**\n * JSONify the graph data and layout\n *\n * This function needs to recurse because some src can be inside\n * sub-objects.\n *\n * It also strips out functions and private (starts with _) elements.\n * Therefore, we can add temporary things to data and layout that don't\n * get saved.\n *\n * @param gd The graphDiv\n * @param {Boolean} dataonly If true, don't return layout.\n * @param {'keepref'|'keepdata'|'keepall'} [mode='keepref'] Filter what's kept\n *      keepref: remove data for which there's a src present\n *          eg if there's xsrc present (and xsrc is well-formed,\n *          ie has : and some chars before it), strip out x\n *      keepdata: remove all src tags, don't remove the data itself\n *      keepall: keep data and src\n * @param {String} output If you specify 'object', the result will not be stringified\n * @param {Boolean} useDefaults If truthy, use _fullLayout and _fullData\n * @param {Boolean} includeConfig If truthy, include _context\n * @returns {Object|String}\n */\nplots.graphJson = function(gd, dataonly, mode, output, useDefaults, includeConfig) {\n    // if the defaults aren't supplied yet, we need to do that...\n    if((useDefaults && dataonly && !gd._fullData) ||\n            (useDefaults && !dataonly && !gd._fullLayout)) {\n        plots.supplyDefaults(gd);\n    }\n\n    var data = (useDefaults) ? gd._fullData : gd.data;\n    var layout = (useDefaults) ? gd._fullLayout : gd.layout;\n    var frames = (gd._transitionData || {})._frames;\n\n    function stripObj(d, keepFunction) {\n        if(typeof d === 'function') {\n            return keepFunction ? '_function_' : null;\n        }\n        if(Lib.isPlainObject(d)) {\n            var o = {};\n            var src;\n            Object.keys(d).sort().forEach(function(v) {\n                // remove private elements and functions\n                // _ is for private, [ is a mistake ie [object Object]\n                if(['_', '['].indexOf(v.charAt(0)) !== -1) return;\n\n                // if a function, add if necessary then move on\n                if(typeof d[v] === 'function') {\n                    if(keepFunction) o[v] = '_function';\n                    return;\n                }\n\n                // look for src/data matches and remove the appropriate one\n                if(mode === 'keepdata') {\n                    // keepdata: remove all ...src tags\n                    if(v.substr(v.length - 3) === 'src') {\n                        return;\n                    }\n                } else if(mode === 'keepstream') {\n                    // keep sourced data if it's being streamed.\n                    // similar to keepref, but if the 'stream' object exists\n                    // in a trace, we will keep the data array.\n                    src = d[v + 'src'];\n                    if(typeof src === 'string' && src.indexOf(':') > 0) {\n                        if(!Lib.isPlainObject(d.stream)) {\n                            return;\n                        }\n                    }\n                } else if(mode !== 'keepall') {\n                    // keepref: remove sourced data but only\n                    // if the source tag is well-formed\n                    src = d[v + 'src'];\n                    if(typeof src === 'string' && src.indexOf(':') > 0) {\n                        return;\n                    }\n                }\n\n                // OK, we're including this... recurse into it\n                o[v] = stripObj(d[v], keepFunction);\n            });\n            return o;\n        }\n\n        if(Array.isArray(d)) {\n            return d.map(function(x) {return stripObj(x, keepFunction);});\n        }\n\n        if(Lib.isTypedArray(d)) {\n            return Lib.simpleMap(d, Lib.identity);\n        }\n\n        // convert native dates to date strings...\n        // mostly for external users exporting to plotly\n        if(Lib.isJSDate(d)) return Lib.ms2DateTimeLocal(+d);\n\n        return d;\n    }\n\n    var obj = {\n        data: (data || []).map(function(v) {\n            var d = stripObj(v);\n            // fit has some little arrays in it that don't contain data,\n            // just fit params and meta\n            if(dataonly) { delete d.fit; }\n            return d;\n        })\n    };\n    if(!dataonly) {\n        obj.layout = stripObj(layout);\n        if(useDefaults) {\n            var gs = layout._size;\n            obj.layout.computed = {\n                margin: {\n                    b: gs.b,\n                    l: gs.l,\n                    r: gs.r,\n                    t: gs.t\n                }\n            };\n        }\n    }\n\n    if(frames) obj.frames = stripObj(frames);\n\n    if(includeConfig) obj.config = stripObj(gd._context, true);\n\n    return (output === 'object') ? obj : JSON.stringify(obj);\n};\n\n/**\n * Modify a keyframe using a list of operations:\n *\n * @param {array of objects} operations\n *      Sequence of operations to be performed on the keyframes\n */\nplots.modifyFrames = function(gd, operations) {\n    var i, op, frame;\n    var _frames = gd._transitionData._frames;\n    var _frameHash = gd._transitionData._frameHash;\n\n    for(i = 0; i < operations.length; i++) {\n        op = operations[i];\n\n        switch(op.type) {\n            // No reason this couldn't exist, but is currently unused/untested:\n            /* case 'rename':\n                frame = _frames[op.index];\n                delete _frameHash[frame.name];\n                _frameHash[op.name] = frame;\n                frame.name = op.name;\n                break;*/\n            case 'replace':\n                frame = op.value;\n                var oldName = (_frames[op.index] || {}).name;\n                var newName = frame.name;\n                _frames[op.index] = _frameHash[newName] = frame;\n\n                if(newName !== oldName) {\n                    // If name has changed in addition to replacement, then update\n                    // the lookup table:\n                    delete _frameHash[oldName];\n                    _frameHash[newName] = frame;\n                }\n\n                break;\n            case 'insert':\n                frame = op.value;\n                _frameHash[frame.name] = frame;\n                _frames.splice(op.index, 0, frame);\n                break;\n            case 'delete':\n                frame = _frames[op.index];\n                delete _frameHash[frame.name];\n                _frames.splice(op.index, 1);\n                break;\n        }\n    }\n\n    return Promise.resolve();\n};\n\n/*\n * Compute a keyframe. Merge a keyframe into its base frame(s) and\n * expand properties.\n *\n * @param {object} frameLookup\n *      An object containing frames keyed by name (i.e. gd._transitionData._frameHash)\n * @param {string} frame\n *      The name of the keyframe to be computed\n *\n * Returns: a new object with the merged content\n */\nplots.computeFrame = function(gd, frameName) {\n    var frameLookup = gd._transitionData._frameHash;\n    var i, traceIndices, traceIndex, destIndex;\n\n    // Null or undefined will fail on .toString(). We'll allow numbers since we\n    // make it clear frames must be given string names, but we'll allow numbers\n    // here since they're otherwise fine for looking up frames as long as they're\n    // properly cast to strings. We really just want to ensure here that this\n    // 1) doesn't fail, and\n    // 2) doens't give an incorrect answer (which String(frameName) would)\n    if(!frameName) {\n        throw new Error('computeFrame must be given a string frame name');\n    }\n\n    var framePtr = frameLookup[frameName.toString()];\n\n    // Return false if the name is invalid:\n    if(!framePtr) {\n        return false;\n    }\n\n    var frameStack = [framePtr];\n    var frameNameStack = [framePtr.name];\n\n    // Follow frame pointers:\n    while(framePtr.baseframe && (framePtr = frameLookup[framePtr.baseframe.toString()])) {\n        // Avoid infinite loops:\n        if(frameNameStack.indexOf(framePtr.name) !== -1) break;\n\n        frameStack.push(framePtr);\n        frameNameStack.push(framePtr.name);\n    }\n\n    // A new object for the merged result:\n    var result = {};\n\n    // Merge, starting with the last and ending with the desired frame:\n    while((framePtr = frameStack.pop())) {\n        if(framePtr.layout) {\n            result.layout = plots.extendLayout(result.layout, framePtr.layout);\n        }\n\n        if(framePtr.data) {\n            if(!result.data) {\n                result.data = [];\n            }\n            traceIndices = framePtr.traces;\n\n            if(!traceIndices) {\n                // If not defined, assume serial order starting at zero\n                traceIndices = [];\n                for(i = 0; i < framePtr.data.length; i++) {\n                    traceIndices[i] = i;\n                }\n            }\n\n            if(!result.traces) {\n                result.traces = [];\n            }\n\n            for(i = 0; i < framePtr.data.length; i++) {\n                // Loop through this frames data, find out where it should go,\n                // and merge it!\n                traceIndex = traceIndices[i];\n                if(traceIndex === undefined || traceIndex === null) {\n                    continue;\n                }\n\n                destIndex = result.traces.indexOf(traceIndex);\n                if(destIndex === -1) {\n                    destIndex = result.data.length;\n                    result.traces[destIndex] = traceIndex;\n                }\n\n                result.data[destIndex] = plots.extendTrace(result.data[destIndex], framePtr.data[i]);\n            }\n        }\n    }\n\n    return result;\n};\n\n/*\n * Recompute the lookup table that maps frame name -> frame object. addFrames/\n * deleteFrames already manages this data one at a time, so the only time this\n * is necessary is if you poke around manually in `gd._transitionData._frames`\n * and create and haven't updated the lookup table.\n */\nplots.recomputeFrameHash = function(gd) {\n    var hash = gd._transitionData._frameHash = {};\n    var frames = gd._transitionData._frames;\n    for(var i = 0; i < frames.length; i++) {\n        var frame = frames[i];\n        if(frame && frame.name) {\n            hash[frame.name] = frame;\n        }\n    }\n};\n\n/**\n * Extend an object, treating container arrays very differently by extracting\n * their contents and merging them separately.\n *\n * This exists so that we can extendDeepNoArrays and avoid stepping into data\n * arrays without knowledge of the plot schema, but so that we may also manually\n * recurse into known container arrays, such as transforms.\n *\n * See extendTrace and extendLayout below for usage.\n */\nplots.extendObjectWithContainers = function(dest, src, containerPaths) {\n    var containerProp, containerVal, i, j, srcProp, destProp, srcContainer, destContainer;\n    var copy = Lib.extendDeepNoArrays({}, src || {});\n    var expandedObj = Lib.expandObjectPaths(copy);\n    var containerObj = {};\n\n    // Step through and extract any container properties. Otherwise extendDeepNoArrays\n    // will clobber any existing properties with an empty array and then supplyDefaults\n    // will reset everything to defaults.\n    if(containerPaths && containerPaths.length) {\n        for(i = 0; i < containerPaths.length; i++) {\n            containerProp = Lib.nestedProperty(expandedObj, containerPaths[i]);\n            containerVal = containerProp.get();\n\n            if(containerVal === undefined) {\n                Lib.nestedProperty(containerObj, containerPaths[i]).set(null);\n            } else {\n                containerProp.set(null);\n                Lib.nestedProperty(containerObj, containerPaths[i]).set(containerVal);\n            }\n        }\n    }\n\n    dest = Lib.extendDeepNoArrays(dest || {}, expandedObj);\n\n    if(containerPaths && containerPaths.length) {\n        for(i = 0; i < containerPaths.length; i++) {\n            srcProp = Lib.nestedProperty(containerObj, containerPaths[i]);\n            srcContainer = srcProp.get();\n\n            if(!srcContainer) continue;\n\n            destProp = Lib.nestedProperty(dest, containerPaths[i]);\n            destContainer = destProp.get();\n\n            if(!Array.isArray(destContainer)) {\n                destContainer = [];\n                destProp.set(destContainer);\n            }\n\n            for(j = 0; j < srcContainer.length; j++) {\n                var srcObj = srcContainer[j];\n\n                if(srcObj === null) destContainer[j] = null;\n                else {\n                    destContainer[j] = plots.extendObjectWithContainers(destContainer[j], srcObj);\n                }\n            }\n\n            destProp.set(destContainer);\n        }\n    }\n\n    return dest;\n};\n\nplots.dataArrayContainers = ['transforms', 'dimensions'];\nplots.layoutArrayContainers = Registry.layoutArrayContainers;\n\n/*\n * Extend a trace definition. This method:\n *\n *  1. directly transfers any array references\n *  2. manually recurses into container arrays like transforms\n *\n * The result is the original object reference with the new contents merged in.\n */\nplots.extendTrace = function(destTrace, srcTrace) {\n    return plots.extendObjectWithContainers(destTrace, srcTrace, plots.dataArrayContainers);\n};\n\n/*\n * Extend a layout definition. This method:\n *\n *  1. directly transfers any array references (not critically important for\n *     layout since there aren't really data arrays)\n *  2. manually recurses into container arrays like annotations\n *\n * The result is the original object reference with the new contents merged in.\n */\nplots.extendLayout = function(destLayout, srcLayout) {\n    return plots.extendObjectWithContainers(destLayout, srcLayout, plots.layoutArrayContainers);\n};\n\n/**\n * Transition to a set of new data and layout properties from Plotly.animate\n *\n * @param {DOM element} gd\n * @param {Object[]} data\n *      an array of data objects following the normal Plotly data definition format\n * @param {Object} layout\n *      a layout object, following normal Plotly layout format\n * @param {Number[]} traces\n *      indices of the corresponding traces specified in `data`\n * @param {Object} frameOpts\n *      options for the frame (i.e. whether to redraw post-transition)\n * @param {Object} transitionOpts\n *      options for the transition\n */\nplots.transition = function(gd, data, layout, traces, frameOpts, transitionOpts) {\n    var opts = {redraw: frameOpts.redraw};\n    var transitionedTraces = {};\n    var axEdits = [];\n\n    opts.prepareFn = function() {\n        var dataLength = Array.isArray(data) ? data.length : 0;\n        var traceIndices = traces.slice(0, dataLength);\n\n        for(var i = 0; i < traceIndices.length; i++) {\n            var traceIdx = traceIndices[i];\n            var trace = gd._fullData[traceIdx];\n            var _module = trace._module;\n\n            // There's nothing to do if this module is not defined:\n            if(!_module) continue;\n\n            // Don't register the trace as transitioned if it doesn't know what to do.\n            // If it *is* registered, it will receive a callback that it's responsible\n            // for calling in order to register the transition as having completed.\n            if(_module.animatable) {\n                var n = _module.basePlotModule.name;\n                if(!transitionedTraces[n]) transitionedTraces[n] = [];\n                transitionedTraces[n].push(traceIdx);\n            }\n\n            gd.data[traceIndices[i]] = plots.extendTrace(gd.data[traceIndices[i]], data[i]);\n        }\n\n        // Follow the same procedure. Clone it so we don't mangle the input, then\n        // expand any object paths so we can merge deep into gd.layout:\n        var layoutUpdate = Lib.expandObjectPaths(Lib.extendDeepNoArrays({}, layout));\n\n        // Before merging though, we need to modify the incoming layout. We only\n        // know how to *transition* layout ranges, so it's imperative that a new\n        // range not be sent to the layout before the transition has started. So\n        // we must remove the things we can transition:\n        var axisAttrRe = /^[xy]axis[0-9]*$/;\n        for(var attr in layoutUpdate) {\n            if(!axisAttrRe.test(attr)) continue;\n            delete layoutUpdate[attr].range;\n        }\n\n        plots.extendLayout(gd.layout, layoutUpdate);\n\n        // Supply defaults after applying the incoming properties. Note that any attempt\n        // to simplify this step and reduce the amount of work resulted in the reconstruction\n        // of essentially the whole supplyDefaults step, so that it seems sensible to just use\n        // supplyDefaults even though it's heavier than would otherwise be desired for\n        // transitions:\n\n        // first delete calcdata so supplyDefaults knows a calc step is coming\n        delete gd.calcdata;\n\n        plots.supplyDefaults(gd);\n        plots.doCalcdata(gd);\n\n        var newLayout = Lib.expandObjectPaths(layout);\n\n        if(newLayout) {\n            var subplots = gd._fullLayout._plots;\n\n            for(var k in subplots) {\n                var plotinfo = subplots[k];\n                var xa = plotinfo.xaxis;\n                var ya = plotinfo.yaxis;\n                var xr0 = xa.range.slice();\n                var yr0 = ya.range.slice();\n\n                var xr1 = null;\n                var yr1 = null;\n                var editX = null;\n                var editY = null;\n\n                if(Array.isArray(newLayout[xa._name + '.range'])) {\n                    xr1 = newLayout[xa._name + '.range'].slice();\n                } else if(Array.isArray((newLayout[xa._name] || {}).range)) {\n                    xr1 = newLayout[xa._name].range.slice();\n                }\n                if(Array.isArray(newLayout[ya._name + '.range'])) {\n                    yr1 = newLayout[ya._name + '.range'].slice();\n                } else if(Array.isArray((newLayout[ya._name] || {}).range)) {\n                    yr1 = newLayout[ya._name].range.slice();\n                }\n\n                if(xr0 && xr1 &&\n                    (xa.r2l(xr0[0]) !== xa.r2l(xr1[0]) || xa.r2l(xr0[1]) !== xa.r2l(xr1[1]))\n                ) {\n                    editX = {xr0: xr0, xr1: xr1};\n                }\n                if(yr0 && yr1 &&\n                    (ya.r2l(yr0[0]) !== ya.r2l(yr1[0]) || ya.r2l(yr0[1]) !== ya.r2l(yr1[1]))\n                ) {\n                    editY = {yr0: yr0, yr1: yr1};\n                }\n\n                if(editX || editY) {\n                    axEdits.push(Lib.extendFlat({plotinfo: plotinfo}, editX, editY));\n                }\n            }\n        }\n\n        return Promise.resolve();\n    };\n\n    opts.runFn = function(makeCallback) {\n        var traceTransitionOpts;\n        var basePlotModules = gd._fullLayout._basePlotModules;\n        var hasAxisTransition = axEdits.length;\n        var i;\n\n        if(layout) {\n            for(i = 0; i < basePlotModules.length; i++) {\n                if(basePlotModules[i].transitionAxes) {\n                    basePlotModules[i].transitionAxes(gd, axEdits, transitionOpts, makeCallback);\n                }\n            }\n        }\n\n        // Here handle the exception that we refuse to animate scales and axes at the same\n        // time. In other words, if there's an axis transition, then set the data transition\n        // to instantaneous.\n        if(hasAxisTransition) {\n            traceTransitionOpts = Lib.extendFlat({}, transitionOpts);\n            traceTransitionOpts.duration = 0;\n            // This means do not transition cartesian traces,\n            // this happens on layout-only (e.g. axis range) animations\n            delete transitionedTraces.cartesian;\n        } else {\n            traceTransitionOpts = transitionOpts;\n        }\n\n        // Note that we pass a callback to *create* the callback that must be invoked on completion.\n        // This is since not all traces know about transitions, so it greatly simplifies matters if\n        // the trace is responsible for creating a callback, if needed, and then executing it when\n        // the time is right.\n        for(var n in transitionedTraces) {\n            var traceIndices = transitionedTraces[n];\n            var _module = gd._fullData[traceIndices[0]]._module;\n            _module.basePlotModule.plot(gd, traceIndices, traceTransitionOpts, makeCallback);\n        }\n    };\n\n    return _transition(gd, transitionOpts, opts);\n};\n\n/**\n * Transition to a set of new data and layout properties from Plotly.react\n *\n * @param {DOM element} gd\n * @param {object} restyleFlags\n * - anim {'all'|'some'}\n * @param {object} relayoutFlags\n * - anim {'all'|'some'}\n * @param {object} oldFullLayout : old (pre Plotly.react) fullLayout\n */\nplots.transitionFromReact = function(gd, restyleFlags, relayoutFlags, oldFullLayout) {\n    var fullLayout = gd._fullLayout;\n    var transitionOpts = fullLayout.transition;\n    var opts = {};\n    var axEdits = [];\n\n    opts.prepareFn = function() {\n        var subplots = fullLayout._plots;\n\n        // no need to redraw at end of transition,\n        // if all changes are animatable\n        opts.redraw = false;\n        if(restyleFlags.anim === 'some') opts.redraw = true;\n        if(relayoutFlags.anim === 'some') opts.redraw = true;\n\n        for(var k in subplots) {\n            var plotinfo = subplots[k];\n            var xa = plotinfo.xaxis;\n            var ya = plotinfo.yaxis;\n            var xr0 = oldFullLayout[xa._name].range.slice();\n            var yr0 = oldFullLayout[ya._name].range.slice();\n            var xr1 = xa.range.slice();\n            var yr1 = ya.range.slice();\n\n            xa.setScale();\n            ya.setScale();\n\n            var editX = null;\n            var editY = null;\n\n            if(xa.r2l(xr0[0]) !== xa.r2l(xr1[0]) || xa.r2l(xr0[1]) !== xa.r2l(xr1[1])) {\n                editX = {xr0: xr0, xr1: xr1};\n            }\n            if(ya.r2l(yr0[0]) !== ya.r2l(yr1[0]) || ya.r2l(yr0[1]) !== ya.r2l(yr1[1])) {\n                editY = {yr0: yr0, yr1: yr1};\n            }\n\n            if(editX || editY) {\n                axEdits.push(Lib.extendFlat({plotinfo: plotinfo}, editX, editY));\n            }\n        }\n\n        return Promise.resolve();\n    };\n\n    opts.runFn = function(makeCallback) {\n        var fullData = gd._fullData;\n        var fullLayout = gd._fullLayout;\n        var basePlotModules = fullLayout._basePlotModules;\n\n        var axisTransitionOpts;\n        var traceTransitionOpts;\n        var transitionedTraces;\n\n        var allTraceIndices = [];\n        for(var i = 0; i < fullData.length; i++) {\n            allTraceIndices.push(i);\n        }\n\n        function transitionAxes() {\n            if(!gd._fullLayout) return;\n            for(var j = 0; j < basePlotModules.length; j++) {\n                if(basePlotModules[j].transitionAxes) {\n                    basePlotModules[j].transitionAxes(gd, axEdits, axisTransitionOpts, makeCallback);\n                }\n            }\n        }\n\n        function transitionTraces() {\n            if(!gd._fullLayout) return;\n            for(var j = 0; j < basePlotModules.length; j++) {\n                basePlotModules[j].plot(gd, transitionedTraces, traceTransitionOpts, makeCallback);\n            }\n        }\n\n        if(axEdits.length && restyleFlags.anim) {\n            if(transitionOpts.ordering === 'traces first') {\n                axisTransitionOpts = Lib.extendFlat({}, transitionOpts, {duration: 0});\n                transitionedTraces = allTraceIndices;\n                traceTransitionOpts = transitionOpts;\n                setTimeout(transitionAxes, transitionOpts.duration);\n                transitionTraces();\n            } else {\n                axisTransitionOpts = transitionOpts;\n                transitionedTraces = null;\n                traceTransitionOpts = Lib.extendFlat({}, transitionOpts, {duration: 0});\n                setTimeout(transitionTraces, axisTransitionOpts.duration);\n                transitionAxes();\n            }\n        } else if(axEdits.length) {\n            axisTransitionOpts = transitionOpts;\n            transitionAxes();\n        } else if(restyleFlags.anim) {\n            transitionedTraces = allTraceIndices;\n            traceTransitionOpts = transitionOpts;\n            transitionTraces();\n        }\n    };\n\n    return _transition(gd, transitionOpts, opts);\n};\n\n/**\n * trace/layout transition wrapper that works\n * for transitions initiated by Plotly.animate and Plotly.react.\n *\n * @param {DOM element} gd\n * @param {object} transitionOpts\n * @param {object} opts\n * - redraw {boolean}\n * - prepareFn {function} *should return a Promise*\n * - runFn {function} ran inside executeTransitions\n */\nfunction _transition(gd, transitionOpts, opts) {\n    var aborted = false;\n\n    function executeCallbacks(list) {\n        var p = Promise.resolve();\n        if(!list) return p;\n        while(list.length) {\n            p = p.then((list.shift()));\n        }\n        return p;\n    }\n\n    function flushCallbacks(list) {\n        if(!list) return;\n        while(list.length) {\n            list.shift();\n        }\n    }\n\n    function executeTransitions() {\n        gd.emit('plotly_transitioning', []);\n\n        return new Promise(function(resolve) {\n            // This flag is used to disabled things like autorange:\n            gd._transitioning = true;\n\n            // When instantaneous updates are coming through quickly, it's too much to simply disable\n            // all interaction, so store this flag so we can disambiguate whether mouse interactions\n            // should be fully disabled or not:\n            if(transitionOpts.duration > 0) {\n                gd._transitioningWithDuration = true;\n            }\n\n            // If another transition is triggered, this callback will be executed simply because it's\n            // in the interruptCallbacks queue. If this transition completes, it will instead flush\n            // that queue and forget about this callback.\n            gd._transitionData._interruptCallbacks.push(function() {\n                aborted = true;\n            });\n\n            if(opts.redraw) {\n                gd._transitionData._interruptCallbacks.push(function() {\n                    return Registry.call('redraw', gd);\n                });\n            }\n\n            // Emit this and make sure it happens last:\n            gd._transitionData._interruptCallbacks.push(function() {\n                gd.emit('plotly_transitioninterrupted', []);\n            });\n\n            // Construct callbacks that are executed on transition end. This ensures the d3 transitions\n            // are *complete* before anything else is done.\n            var numCallbacks = 0;\n            var numCompleted = 0;\n            function makeCallback() {\n                numCallbacks++;\n                return function() {\n                    numCompleted++;\n                    // When all are complete, perform a redraw:\n                    if(!aborted && numCompleted === numCallbacks) {\n                        completeTransition(resolve);\n                    }\n                };\n            }\n\n            opts.runFn(makeCallback);\n\n            // If nothing else creates a callback, then this will trigger the completion in the next tick:\n            setTimeout(makeCallback());\n        });\n    }\n\n    function completeTransition(callback) {\n        // This a simple workaround for tests which purge the graph before animations\n        // have completed. That's not a very common case, so this is the simplest\n        // fix.\n        if(!gd._transitionData) return;\n\n        flushCallbacks(gd._transitionData._interruptCallbacks);\n\n        return Promise.resolve().then(function() {\n            if(opts.redraw) {\n                return Registry.call('redraw', gd);\n            }\n        }).then(function() {\n            // Set transitioning false again once the redraw has occurred. This is used, for example,\n            // to prevent the trailing redraw from autoranging:\n            gd._transitioning = false;\n            gd._transitioningWithDuration = false;\n\n            gd.emit('plotly_transitioned', []);\n        }).then(callback);\n    }\n\n    function interruptPreviousTransitions() {\n        // Fail-safe against purged plot:\n        if(!gd._transitionData) return;\n\n        // If a transition is interrupted, set this to false. At the moment, the only thing that would\n        // interrupt a transition is another transition, so that it will momentarily be set to true\n        // again, but this determines whether autorange or dragbox work, so it's for the sake of\n        // cleanliness:\n        gd._transitioning = false;\n\n        return executeCallbacks(gd._transitionData._interruptCallbacks);\n    }\n\n    var seq = [\n        plots.previousPromises,\n        interruptPreviousTransitions,\n        opts.prepareFn,\n        plots.rehover,\n        executeTransitions\n    ];\n\n    var transitionStarting = Lib.syncOrAsync(seq, gd);\n\n    if(!transitionStarting || !transitionStarting.then) {\n        transitionStarting = Promise.resolve();\n    }\n\n    return transitionStarting.then(function() { return gd; });\n}\n\nplots.doCalcdata = function(gd, traces) {\n    var axList = axisIDs.list(gd);\n    var fullData = gd._fullData;\n    var fullLayout = gd._fullLayout;\n\n    var trace, _module, i, j;\n\n    // XXX: Is this correct? Needs a closer look so that *some* traces can be recomputed without\n    // *all* needing doCalcdata:\n    var calcdata = new Array(fullData.length);\n    var oldCalcdata = (gd.calcdata || []).slice();\n    gd.calcdata = calcdata;\n\n    // extra helper variables\n\n    // how many box/violins plots do we have (in case they're grouped)\n    fullLayout._numBoxes = 0;\n    fullLayout._numViolins = 0;\n\n    // initialize violin per-scale-group stats container\n    fullLayout._violinScaleGroupStats = {};\n\n    // for calculating avg luminosity of heatmaps\n    gd._hmpixcount = 0;\n    gd._hmlumcount = 0;\n\n    // for sharing colors across pies / sunbursts / treemap / icicle / funnelarea (and for legend)\n    fullLayout._piecolormap = {};\n    fullLayout._sunburstcolormap = {};\n    fullLayout._treemapcolormap = {};\n    fullLayout._iciclecolormap = {};\n    fullLayout._funnelareacolormap = {};\n\n    // If traces were specified and this trace was not included,\n    // then transfer it over from the old calcdata:\n    for(i = 0; i < fullData.length; i++) {\n        if(Array.isArray(traces) && traces.indexOf(i) === -1) {\n            calcdata[i] = oldCalcdata[i];\n            continue;\n        }\n    }\n\n    for(i = 0; i < fullData.length; i++) {\n        trace = fullData[i];\n\n        trace._arrayAttrs = PlotSchema.findArrayAttributes(trace);\n\n        // keep track of trace extremes (for autorange) in here\n        trace._extremes = {};\n    }\n\n    // add polar axes to axis list\n    var polarIds = fullLayout._subplots.polar || [];\n    for(i = 0; i < polarIds.length; i++) {\n        axList.push(\n            fullLayout[polarIds[i]].radialaxis,\n            fullLayout[polarIds[i]].angularaxis\n        );\n    }\n\n    // clear relinked cmin/cmax values in shared axes to start aggregation from scratch\n    for(var k in fullLayout._colorAxes) {\n        var cOpts = fullLayout[k];\n        if(cOpts.cauto !== false) {\n            delete cOpts.cmin;\n            delete cOpts.cmax;\n        }\n    }\n\n    var hasCalcTransform = false;\n\n    function transformCalci(i) {\n        trace = fullData[i];\n        _module = trace._module;\n\n        if(trace.visible === true && trace.transforms) {\n            // we need one round of trace module calc before\n            // the calc transform to 'fill in' the categories list\n            // used for example in the data-to-coordinate method\n            if(_module && _module.calc) {\n                var cdi = _module.calc(gd, trace);\n\n                // must clear scene 'batches', so that 2nd\n                // _module.calc call starts from scratch\n                if(cdi[0] && cdi[0].t && cdi[0].t._scene) {\n                    delete cdi[0].t._scene.dirty;\n                }\n            }\n\n            for(j = 0; j < trace.transforms.length; j++) {\n                var transform = trace.transforms[j];\n\n                _module = transformsRegistry[transform.type];\n                if(_module && _module.calcTransform) {\n                    trace._hasCalcTransform = true;\n                    hasCalcTransform = true;\n                    _module.calcTransform(gd, trace, transform);\n                }\n            }\n        }\n    }\n\n    function calci(i, isContainer) {\n        trace = fullData[i];\n        _module = trace._module;\n\n        if(!!_module.isContainer !== isContainer) return;\n\n        var cd = [];\n\n        if(trace.visible === true && trace._length !== 0) {\n            // clear existing ref in case it got relinked\n            delete trace._indexToPoints;\n            // keep ref of index-to-points map object of the *last* enabled transform,\n            // this index-to-points map object is required to determine the calcdata indices\n            // that correspond to input indices (e.g. from 'selectedpoints')\n            var transforms = trace.transforms || [];\n            for(j = transforms.length - 1; j >= 0; j--) {\n                if(transforms[j].enabled) {\n                    trace._indexToPoints = transforms[j]._indexToPoints;\n                    break;\n                }\n            }\n\n            if(_module && _module.calc) {\n                cd = _module.calc(gd, trace);\n            }\n        }\n\n        // Make sure there is a first point.\n        //\n        // This ensures there is a calcdata item for every trace,\n        // even if cartesian logic doesn't handle it (for things like legends).\n        if(!Array.isArray(cd) || !cd[0]) {\n            cd = [{x: BADNUM, y: BADNUM}];\n        }\n\n        // add the trace-wide properties to the first point,\n        // per point properties to every point\n        // t is the holder for trace-wide properties\n        if(!cd[0].t) cd[0].t = {};\n        cd[0].trace = trace;\n\n        calcdata[i] = cd;\n    }\n\n    setupAxisCategories(axList, fullData, fullLayout);\n\n    // 'transform' loop - must calc container traces first\n    // so that if their dependent traces can get transform properly\n    for(i = 0; i < fullData.length; i++) calci(i, true);\n    for(i = 0; i < fullData.length; i++) transformCalci(i);\n\n    // clear stuff that should recomputed in 'regular' loop\n    if(hasCalcTransform) setupAxisCategories(axList, fullData, fullLayout);\n\n    // 'regular' loop - make sure container traces (eg carpet) calc before\n    // contained traces (eg contourcarpet)\n    for(i = 0; i < fullData.length; i++) calci(i, true);\n    for(i = 0; i < fullData.length; i++) calci(i, false);\n\n    doCrossTraceCalc(gd);\n\n    // Sort axis categories per value if specified\n    var sorted = sortAxisCategoriesByValue(axList, gd);\n    if(sorted.length) {\n        // how many box/violins plots do we have (in case they're grouped)\n        fullLayout._numBoxes = 0;\n        fullLayout._numViolins = 0;\n        // If a sort operation was performed, run calc() again\n        for(i = 0; i < sorted.length; i++) calci(sorted[i], true);\n        for(i = 0; i < sorted.length; i++) calci(sorted[i], false);\n        doCrossTraceCalc(gd);\n    }\n\n    Registry.getComponentMethod('fx', 'calc')(gd);\n    Registry.getComponentMethod('errorbars', 'calc')(gd);\n};\n\nvar sortAxisCategoriesByValueRegex = /(total|sum|min|max|mean|median) (ascending|descending)/;\n\nfunction sortAxisCategoriesByValue(axList, gd) {\n    var affectedTraces = [];\n    var i, j, k, l, o;\n\n    function zMapCategory(type, ax, value) {\n        var axLetter = ax._id.charAt(0);\n        if(type === 'histogram2dcontour') {\n            var counterAxLetter = ax._counterAxes[0];\n            var counterAx = axisIDs.getFromId(gd, counterAxLetter);\n\n            var xCategorical = axLetter === 'x' || (counterAxLetter === 'x' && counterAx.type === 'category');\n            var yCategorical = axLetter === 'y' || (counterAxLetter === 'y' && counterAx.type === 'category');\n\n            return function(o, l) {\n                if(o === 0 || l === 0) return -1; // Skip first row and column\n                if(xCategorical && o === value[l].length - 1) return -1;\n                if(yCategorical && l === value.length - 1) return -1;\n\n                return (axLetter === 'y' ? l : o) - 1;\n            };\n        } else {\n            return function(o, l) {\n                return axLetter === 'y' ? l : o;\n            };\n        }\n    }\n\n    var aggFn = {\n        'min': function(values) {return Lib.aggNums(Math.min, null, values);},\n        'max': function(values) {return Lib.aggNums(Math.max, null, values);},\n        'sum': function(values) {return Lib.aggNums(function(a, b) { return a + b;}, null, values);},\n        'total': function(values) {return Lib.aggNums(function(a, b) { return a + b;}, null, values);},\n        'mean': function(values) {return Lib.mean(values);},\n        'median': function(values) {return Lib.median(values);}\n    };\n\n    for(i = 0; i < axList.length; i++) {\n        var ax = axList[i];\n        if(ax.type !== 'category') continue;\n\n        // Order by value\n        var match = ax.categoryorder.match(sortAxisCategoriesByValueRegex);\n        if(match) {\n            var aggregator = match[1];\n            var order = match[2];\n\n            var axLetter = ax._id.charAt(0);\n            var isX = axLetter === 'x';\n\n            // Store values associated with each category\n            var categoriesValue = [];\n            for(j = 0; j < ax._categories.length; j++) {\n                categoriesValue.push([ax._categories[j], []]);\n            }\n\n            // Collect values across traces\n            for(j = 0; j < ax._traceIndices.length; j++) {\n                var traceIndex = ax._traceIndices[j];\n                var fullTrace = gd._fullData[traceIndex];\n\n                // Skip over invisible traces\n                if(fullTrace.visible !== true) continue;\n\n                var type = fullTrace.type;\n                if(Registry.traceIs(fullTrace, 'histogram')) {\n                    delete fullTrace._xautoBinFinished;\n                    delete fullTrace._yautoBinFinished;\n                }\n                var isSplom = type === 'splom';\n                var isScattergl = type === 'scattergl';\n\n                var cd = gd.calcdata[traceIndex];\n                for(k = 0; k < cd.length; k++) {\n                    var cdi = cd[k];\n                    var catIndex, value;\n\n                    if(isSplom) {\n                        // If `splom`, collect values across dimensions\n                        // Find which dimension the current axis is representing\n                        var currentDimensionIndex = fullTrace._axesDim[ax._id];\n\n                        // Apply logic to associated x axis if it's defined\n                        if(!isX) {\n                            var associatedXAxisID = fullTrace._diag[currentDimensionIndex][0];\n                            if(associatedXAxisID) ax = gd._fullLayout[axisIDs.id2name(associatedXAxisID)];\n                        }\n\n                        var categories = cdi.trace.dimensions[currentDimensionIndex].values;\n                        for(l = 0; l < categories.length; l++) {\n                            catIndex = ax._categoriesMap[categories[l]];\n\n                            // Collect associated values at index `l` over all other dimensions\n                            for(o = 0; o < cdi.trace.dimensions.length; o++) {\n                                if(o === currentDimensionIndex) continue;\n                                var dimension = cdi.trace.dimensions[o];\n                                categoriesValue[catIndex][1].push(dimension.values[l]);\n                            }\n                        }\n                    } else if(isScattergl) {\n                        // If `scattergl`, collect all values stashed under cdi.t\n                        for(l = 0; l < cdi.t.x.length; l++) {\n                            if(isX) {\n                                catIndex = cdi.t.x[l];\n                                value = cdi.t.y[l];\n                            } else {\n                                catIndex = cdi.t.y[l];\n                                value = cdi.t.x[l];\n                            }\n                            categoriesValue[catIndex][1].push(value);\n                        }\n                        // must clear scene 'batches', so that 2nd\n                        // _module.calc call starts from scratch\n                        if(cdi.t && cdi.t._scene) {\n                            delete cdi.t._scene.dirty;\n                        }\n                    } else if(cdi.hasOwnProperty('z')) {\n                        // If 2dMap, collect values in `z`\n                        value = cdi.z;\n                        var mapping = zMapCategory(fullTrace.type, ax, value);\n\n                        for(l = 0; l < value.length; l++) {\n                            for(o = 0; o < value[l].length; o++) {\n                                catIndex = mapping(o, l);\n                                if(catIndex + 1) categoriesValue[catIndex][1].push(value[l][o]);\n                            }\n                        }\n                    } else {\n                        // For all other 2d cartesian traces\n                        catIndex = cdi.p;\n                        if(catIndex === undefined) catIndex = cdi[axLetter];\n\n                        value = cdi.s;\n                        if(value === undefined) value = cdi.v;\n                        if(value === undefined) value = isX ? cdi.y : cdi.x;\n\n                        if(!Array.isArray(value)) {\n                            if(value === undefined) value = [];\n                            else value = [value];\n                        }\n                        for(l = 0; l < value.length; l++) {\n                            categoriesValue[catIndex][1].push(value[l]);\n                        }\n                    }\n                }\n            }\n\n            ax._categoriesValue = categoriesValue;\n\n            var categoriesAggregatedValue = [];\n            for(j = 0; j < categoriesValue.length; j++) {\n                categoriesAggregatedValue.push([\n                    categoriesValue[j][0],\n                    aggFn[aggregator](categoriesValue[j][1])\n                ]);\n            }\n\n            // Sort by aggregated value\n            categoriesAggregatedValue.sort(function(a, b) {\n                return a[1] - b[1];\n            });\n\n            ax._categoriesAggregatedValue = categoriesAggregatedValue;\n\n            // Set new category order\n            ax._initialCategories = categoriesAggregatedValue.map(function(c) {\n                return c[0];\n            });\n\n            // Reverse if descending\n            if(order === 'descending') {\n                ax._initialCategories.reverse();\n            }\n\n            // Sort all matching axes\n            affectedTraces = affectedTraces.concat(ax.sortByInitialCategories());\n        }\n    }\n    return affectedTraces;\n}\n\nfunction setupAxisCategories(axList, fullData, fullLayout) {\n    var axLookup = {};\n\n    function setupOne(ax) {\n        ax.clearCalc();\n        if(ax.type === 'multicategory') {\n            ax.setupMultiCategory(fullData);\n        }\n\n        axLookup[ax._id] = 1;\n    }\n\n    Lib.simpleMap(axList, setupOne);\n\n    // look into match groups for 'missing' axes\n    var matchGroups = fullLayout._axisMatchGroups || [];\n    for(var i = 0; i < matchGroups.length; i++) {\n        for(var axId in matchGroups[i]) {\n            if(!axLookup[axId]) {\n                setupOne(fullLayout[axisIDs.id2name(axId)]);\n            }\n        }\n    }\n}\n\nfunction doCrossTraceCalc(gd) {\n    var fullLayout = gd._fullLayout;\n    var modules = fullLayout._visibleModules;\n    var hash = {};\n    var i, j, k;\n\n    // position and range calculations for traces that\n    // depend on each other ie bars (stacked or grouped)\n    // and boxes (grouped) push each other out of the way\n\n    for(j = 0; j < modules.length; j++) {\n        var _module = modules[j];\n        var fn = _module.crossTraceCalc;\n        if(fn) {\n            var spType = _module.basePlotModule.name;\n            if(hash[spType]) {\n                Lib.pushUnique(hash[spType], fn);\n            } else {\n                hash[spType] = [fn];\n            }\n        }\n    }\n\n    for(k in hash) {\n        var methods = hash[k];\n        var subplots = fullLayout._subplots[k];\n\n        if(Array.isArray(subplots)) {\n            for(i = 0; i < subplots.length; i++) {\n                var sp = subplots[i];\n                var spInfo = k === 'cartesian' ?\n                    fullLayout._plots[sp] :\n                    fullLayout[sp];\n\n                for(j = 0; j < methods.length; j++) {\n                    methods[j](gd, spInfo, sp);\n                }\n            }\n        } else {\n            for(j = 0; j < methods.length; j++) {\n                methods[j](gd);\n            }\n        }\n    }\n}\n\nplots.rehover = function(gd) {\n    if(gd._fullLayout._rehover) {\n        gd._fullLayout._rehover();\n    }\n};\n\nplots.redrag = function(gd) {\n    if(gd._fullLayout._redrag) {\n        gd._fullLayout._redrag();\n    }\n};\n\nplots.generalUpdatePerTraceModule = function(gd, subplot, subplotCalcData, subplotLayout) {\n    var traceHashOld = subplot.traceHash;\n    var traceHash = {};\n    var i;\n\n    // build up moduleName -> calcData hash\n    for(i = 0; i < subplotCalcData.length; i++) {\n        var calcTraces = subplotCalcData[i];\n        var trace = calcTraces[0].trace;\n\n        // skip over visible === false traces\n        // as they don't have `_module` ref\n        if(trace.visible) {\n            traceHash[trace.type] = traceHash[trace.type] || [];\n            traceHash[trace.type].push(calcTraces);\n        }\n    }\n\n    // when a trace gets deleted, make sure that its module's\n    // plot method is called so that it is properly\n    // removed from the DOM.\n    for(var moduleNameOld in traceHashOld) {\n        if(!traceHash[moduleNameOld]) {\n            var fakeCalcTrace = traceHashOld[moduleNameOld][0];\n            var fakeTrace = fakeCalcTrace[0].trace;\n\n            fakeTrace.visible = false;\n            traceHash[moduleNameOld] = [fakeCalcTrace];\n        }\n    }\n\n    // call module plot method\n    for(var moduleName in traceHash) {\n        var moduleCalcData = traceHash[moduleName];\n        var _module = moduleCalcData[0][0].trace._module;\n\n        _module.plot(gd, subplot, Lib.filterVisible(moduleCalcData), subplotLayout);\n    }\n\n    // update moduleName -> calcData hash\n    subplot.traceHash = traceHash;\n};\n\nplots.plotBasePlot = function(desiredType, gd, traces, transitionOpts, makeOnCompleteCallback) {\n    var _module = Registry.getModule(desiredType);\n    var cdmodule = getModuleCalcData(gd.calcdata, _module)[0];\n    _module.plot(gd, cdmodule, transitionOpts, makeOnCompleteCallback);\n};\n\nplots.cleanBasePlot = function(desiredType, newFullData, newFullLayout, oldFullData, oldFullLayout) {\n    var had = (oldFullLayout._has && oldFullLayout._has(desiredType));\n    var has = (newFullLayout._has && newFullLayout._has(desiredType));\n\n    if(had && !has) {\n        oldFullLayout['_' + desiredType + 'layer'].selectAll('g.trace').remove();\n    }\n};\n","'use strict';\n\nvar Lib = require('../lib');\nvar Template = require('../plot_api/plot_template');\nvar handleDomainDefaults = require('./domain').defaults;\n\n\n/**\n * Find and supply defaults to all subplots of a given type\n * This handles subplots that are contained within one container - so\n * gl3d, geo, ternary... but not 2d axes which have separate x and y axes\n * finds subplots, coerces their `domain` attributes, then calls the\n * given handleDefaults function to fill in everything else.\n *\n * layoutIn: the complete user-supplied input layout\n * layoutOut: the complete finished layout\n * fullData: the finished data array, used only to find subplots\n * opts: {\n *  type: subplot type string\n *  attributes: subplot attributes object\n *  partition: 'x' or 'y', which direction to divide domain space by default\n *      (default 'x', ie side-by-side subplots)\n *      TODO: this option is only here because 3D and geo made opposite\n *      choices in this regard previously and I didn't want to change it.\n *      Instead we should do:\n *      - something consistent\n *      - something more square (4 cuts 2x2, 5/6 cuts 2x3, etc.)\n *      - something that includes all subplot types in one arrangement,\n *        now that we can have them together!\n *  handleDefaults: function of (subplotLayoutIn, subplotLayoutOut, coerce, opts)\n *      this opts object is passed through to handleDefaults, so attach any\n *      additional items needed by this function here as well\n * }\n */\nmodule.exports = function handleSubplotDefaults(layoutIn, layoutOut, fullData, opts) {\n    var subplotType = opts.type;\n    var subplotAttributes = opts.attributes;\n    var handleDefaults = opts.handleDefaults;\n    var partition = opts.partition || 'x';\n\n    var ids = layoutOut._subplots[subplotType];\n    var idsLength = ids.length;\n\n    var baseId = idsLength && ids[0].replace(/\\d+$/, '');\n\n    var subplotLayoutIn, subplotLayoutOut;\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(subplotLayoutIn, subplotLayoutOut, subplotAttributes, attr, dflt);\n    }\n\n    for(var i = 0; i < idsLength; i++) {\n        var id = ids[i];\n\n        // ternary traces get a layout ternary for free!\n        if(layoutIn[id]) subplotLayoutIn = layoutIn[id];\n        else subplotLayoutIn = layoutIn[id] = {};\n\n        subplotLayoutOut = Template.newContainer(layoutOut, id, baseId);\n\n        // All subplot containers get a `uirevision` inheriting from the base.\n        // Currently all subplots containers have some user interaction\n        // attributes, but if we ever add one that doesn't, we would need an\n        // option to skip this step.\n        coerce('uirevision', layoutOut.uirevision);\n\n        var dfltDomains = {};\n        dfltDomains[partition] = [i / idsLength, (i + 1) / idsLength];\n        handleDomainDefaults(subplotLayoutOut, layoutOut, coerce, dfltDomains);\n\n        opts.id = id;\n        handleDefaults(subplotLayoutIn, subplotLayoutOut, coerce, opts);\n    }\n};\n","'use strict';\n\nvar docs = require('../constants/docs');\nvar FORMAT_LINK = docs.FORMAT_LINK;\nvar DATE_FORMAT_LINK = docs.DATE_FORMAT_LINK;\n\nfunction templateFormatStringDescription(opts) {\n    var supportOther = opts && opts.supportOther;\n\n    return [\n        'Variables are inserted using %{variable},',\n        'for example \"y: %{y}\"' + (\n            supportOther ?\n                ' as well as %{xother}, {%_xother}, {%_xother_}, {%xother_}. When showing info for several points, *xother* will be added to those with different x positions from the first point. An underscore before or after *(x|y)other* will add a space on that side, only when this field is shown.' :\n                '.'\n        ),\n        'Numbers are formatted using d3-format\\'s syntax %{variable:d3-format}, for example \"Price: %{y:$.2f}\".',\n        FORMAT_LINK,\n        'for details on the formatting syntax.',\n        'Dates are formatted using d3-time-format\\'s syntax %{variable|d3-time-format}, for example \"Day: %{2019-01-01|%A}\".',\n        DATE_FORMAT_LINK,\n        'for details on the date formatting syntax.'\n    ].join(' ');\n}\n\nfunction describeVariables(extra) {\n    var descPart = extra.description ? ' ' + extra.description : '';\n    var keys = extra.keys || [];\n    if(keys.length > 0) {\n        var quotedKeys = [];\n        for(var i = 0; i < keys.length; i++) {\n            quotedKeys[i] = '`' + keys[i] + '`';\n        }\n        descPart = descPart + 'Finally, the template string has access to ';\n        if(keys.length === 1) {\n            descPart = 'variable ' + quotedKeys[0];\n        } else {\n            descPart = 'variables ' + quotedKeys.slice(0, -1).join(', ') + ' and ' + quotedKeys.slice(-1) + '.';\n        }\n    }\n    return descPart;\n}\n\nexports.hovertemplateAttrs = function(opts, extra) {\n    opts = opts || {};\n    extra = extra || {};\n\n    var descPart = describeVariables(extra);\n\n    var hovertemplate = {\n        valType: 'string',\n        dflt: '',\n        editType: opts.editType || 'none',\n        description: [\n            'Template string used for rendering the information that appear on hover box.',\n            'Note that this will override `hoverinfo`.',\n            templateFormatStringDescription({supportOther: true}),\n            'The variables available in `hovertemplate` are the ones emitted as event data described at this link https://plotly.com/javascript/plotlyjs-events/#event-data.',\n            'Additionally, every attributes that can be specified per-point (the ones that are `arrayOk: true`) are available.',\n            descPart,\n            'Anything contained in tag `<extra>` is displayed in the secondary box, for example \"<extra>{fullData.name}</extra>\".',\n            'To hide the secondary box completely, use an empty tag `<extra></extra>`.'\n        ].join(' ')\n    };\n\n    if(opts.arrayOk !== false) {\n        hovertemplate.arrayOk = true;\n    }\n\n    return hovertemplate;\n};\n\nexports.texttemplateAttrs = function(opts, extra) {\n    opts = opts || {};\n    extra = extra || {};\n\n    var descPart = describeVariables(extra);\n\n    var texttemplate = {\n        valType: 'string',\n        dflt: '',\n        editType: opts.editType || 'calc',\n        description: [\n            'Template string used for rendering the information text that appear on points.',\n            'Note that this will override `textinfo`.',\n            templateFormatStringDescription(),\n            'Every attributes that can be specified per-point (the ones that are `arrayOk: true`) are available.',\n            descPart\n        ].join(' ')\n    };\n\n    if(opts.arrayOk !== false) {\n        texttemplate.arrayOk = true;\n    }\n    return texttemplate;\n};\n","'use strict';\n\nvar Ternary = require('./ternary');\n\nvar getSubplotCalcData = require('../../plots/get_data').getSubplotCalcData;\nvar counterRegex = require('../../lib').counterRegex;\nvar TERNARY = 'ternary';\n\nexports.name = TERNARY;\n\nvar attr = exports.attr = 'subplot';\n\nexports.idRoot = TERNARY;\n\nexports.idRegex = exports.attrRegex = counterRegex(TERNARY);\n\nvar attributes = exports.attributes = {};\nattributes[attr] = {\n    valType: 'subplotid',\n    dflt: 'ternary',\n    editType: 'calc',\n    description: [\n        'Sets a reference between this trace\\'s data coordinates and',\n        'a ternary subplot.',\n        'If *ternary* (the default value), the data refer to `layout.ternary`.',\n        'If *ternary2*, the data refer to `layout.ternary2`, and so on.'\n    ].join(' ')\n};\n\nexports.layoutAttributes = require('./layout_attributes');\n\nexports.supplyLayoutDefaults = require('./layout_defaults');\n\nexports.plot = function plot(gd) {\n    var fullLayout = gd._fullLayout;\n    var calcData = gd.calcdata;\n    var ternaryIds = fullLayout._subplots[TERNARY];\n\n    for(var i = 0; i < ternaryIds.length; i++) {\n        var ternaryId = ternaryIds[i];\n        var ternaryCalcData = getSubplotCalcData(calcData, TERNARY, ternaryId);\n        var ternary = fullLayout[ternaryId]._subplot;\n\n        // If ternary is not instantiated, create one!\n        if(!ternary) {\n            ternary = new Ternary({\n                id: ternaryId,\n                graphDiv: gd,\n                container: fullLayout._ternarylayer.node()\n            },\n                fullLayout\n            );\n\n            fullLayout[ternaryId]._subplot = ternary;\n        }\n\n        ternary.plot(ternaryCalcData, fullLayout, gd._promises);\n    }\n};\n\nexports.clean = function(newFullData, newFullLayout, oldFullData, oldFullLayout) {\n    var oldTernaryKeys = oldFullLayout._subplots[TERNARY] || [];\n\n    for(var i = 0; i < oldTernaryKeys.length; i++) {\n        var oldTernaryKey = oldTernaryKeys[i];\n        var oldTernary = oldFullLayout[oldTernaryKey]._subplot;\n\n        if(!newFullLayout[oldTernaryKey] && !!oldTernary) {\n            oldTernary.plotContainer.remove();\n            oldTernary.clipDef.remove();\n            oldTernary.clipDefRelative.remove();\n            oldTernary.layers['a-title'].remove();\n            oldTernary.layers['b-title'].remove();\n            oldTernary.layers['c-title'].remove();\n        }\n    }\n};\n","'use strict';\n\nvar colorAttrs = require('../../components/color/attributes');\nvar domainAttrs = require('../domain').attributes;\nvar axesAttrs = require('../cartesian/layout_attributes');\n\nvar overrideAll = require('../../plot_api/edit_types').overrideAll;\nvar extendFlat = require('../../lib/extend').extendFlat;\n\nvar ternaryAxesAttrs = {\n    title: {\n        text: axesAttrs.title.text,\n        font: axesAttrs.title.font\n        // TODO does standoff here make sense?\n    },\n    color: axesAttrs.color,\n    // ticks\n    tickmode: axesAttrs.tickmode,\n    nticks: extendFlat({}, axesAttrs.nticks, {dflt: 6, min: 1}),\n    tick0: axesAttrs.tick0,\n    dtick: axesAttrs.dtick,\n    tickvals: axesAttrs.tickvals,\n    ticktext: axesAttrs.ticktext,\n    ticks: axesAttrs.ticks,\n    ticklen: axesAttrs.ticklen,\n    tickwidth: axesAttrs.tickwidth,\n    tickcolor: axesAttrs.tickcolor,\n    showticklabels: axesAttrs.showticklabels,\n    showtickprefix: axesAttrs.showtickprefix,\n    tickprefix: axesAttrs.tickprefix,\n    showticksuffix: axesAttrs.showticksuffix,\n    ticksuffix: axesAttrs.ticksuffix,\n    showexponent: axesAttrs.showexponent,\n    exponentformat: axesAttrs.exponentformat,\n    minexponent: axesAttrs.minexponent,\n    separatethousands: axesAttrs.separatethousands,\n    tickfont: axesAttrs.tickfont,\n    tickangle: axesAttrs.tickangle,\n    tickformat: axesAttrs.tickformat,\n    tickformatstops: axesAttrs.tickformatstops,\n    hoverformat: axesAttrs.hoverformat,\n    // lines and grids\n    showline: extendFlat({}, axesAttrs.showline, {dflt: true}),\n    linecolor: axesAttrs.linecolor,\n    linewidth: axesAttrs.linewidth,\n    showgrid: extendFlat({}, axesAttrs.showgrid, {dflt: true}),\n    gridcolor: axesAttrs.gridcolor,\n    gridwidth: axesAttrs.gridwidth,\n    layer: axesAttrs.layer,\n    // range\n    min: {\n        valType: 'number',\n        dflt: 0,\n        min: 0,\n        description: [\n            'The minimum value visible on this axis.',\n            'The maximum is determined by the sum minus the minimum',\n            'values of the other two axes. The full view corresponds to',\n            'all the minima set to zero.'\n        ].join(' ')\n    },\n    _deprecated: {\n        title: axesAttrs._deprecated.title,\n        titlefont: axesAttrs._deprecated.titlefont\n    }\n};\n\nvar attrs = module.exports = overrideAll({\n    domain: domainAttrs({name: 'ternary'}),\n\n    bgcolor: {\n        valType: 'color',\n        dflt: colorAttrs.background,\n        description: 'Set the background color of the subplot'\n    },\n    sum: {\n        valType: 'number',\n        dflt: 1,\n        min: 0,\n        description: [\n            'The number each triplet should sum to,',\n            'and the maximum range of each axis'\n        ].join(' ')\n    },\n    aaxis: ternaryAxesAttrs,\n    baxis: ternaryAxesAttrs,\n    caxis: ternaryAxesAttrs\n}, 'plot', 'from-root');\n\n// set uirevisions outside of `overrideAll` so we can get `editType: none`\nattrs.uirevision = {\n    valType: 'any',\n    editType: 'none',\n    description: [\n        'Controls persistence of user-driven changes in axis `min` and `title`,',\n        'if not overridden in the individual axes.',\n        'Defaults to `layout.uirevision`.'\n    ].join(' ')\n};\n\nattrs.aaxis.uirevision = attrs.baxis.uirevision = attrs.caxis.uirevision = {\n    valType: 'any',\n    editType: 'none',\n    description: [\n        'Controls persistence of user-driven changes in axis `min`,',\n        'and `title` if in `editable: true` configuration.',\n        'Defaults to `ternary<N>.uirevision`.'\n    ].join(' ')\n};\n","'use strict';\n\nvar Color = require('../../components/color');\nvar Template = require('../../plot_api/plot_template');\nvar Lib = require('../../lib');\n\nvar handleSubplotDefaults = require('../subplot_defaults');\nvar handleTickLabelDefaults = require('../cartesian/tick_label_defaults');\nvar handleTickMarkDefaults = require('../cartesian/tick_mark_defaults');\nvar handleTickValueDefaults = require('../cartesian/tick_value_defaults');\nvar handleLineGridDefaults = require('../cartesian/line_grid_defaults');\nvar layoutAttributes = require('./layout_attributes');\n\nvar axesNames = ['aaxis', 'baxis', 'caxis'];\n\nmodule.exports = function supplyLayoutDefaults(layoutIn, layoutOut, fullData) {\n    handleSubplotDefaults(layoutIn, layoutOut, fullData, {\n        type: 'ternary',\n        attributes: layoutAttributes,\n        handleDefaults: handleTernaryDefaults,\n        font: layoutOut.font,\n        paper_bgcolor: layoutOut.paper_bgcolor\n    });\n};\n\nfunction handleTernaryDefaults(ternaryLayoutIn, ternaryLayoutOut, coerce, options) {\n    var bgColor = coerce('bgcolor');\n    var sum = coerce('sum');\n    options.bgColor = Color.combine(bgColor, options.paper_bgcolor);\n    var axName, containerIn, containerOut;\n\n    // TODO: allow most (if not all) axis attributes to be set\n    // in the outer container and used as defaults in the individual axes?\n\n    for(var j = 0; j < axesNames.length; j++) {\n        axName = axesNames[j];\n        containerIn = ternaryLayoutIn[axName] || {};\n        containerOut = Template.newContainer(ternaryLayoutOut, axName);\n        containerOut._name = axName;\n\n        handleAxisDefaults(containerIn, containerOut, options, ternaryLayoutOut);\n    }\n\n    // if the min values contradict each other, set them all to default (0)\n    // and delete *all* the inputs so the user doesn't get confused later by\n    // changing one and having them all change.\n    var aaxis = ternaryLayoutOut.aaxis;\n    var baxis = ternaryLayoutOut.baxis;\n    var caxis = ternaryLayoutOut.caxis;\n    if(aaxis.min + baxis.min + caxis.min >= sum) {\n        aaxis.min = 0;\n        baxis.min = 0;\n        caxis.min = 0;\n        if(ternaryLayoutIn.aaxis) delete ternaryLayoutIn.aaxis.min;\n        if(ternaryLayoutIn.baxis) delete ternaryLayoutIn.baxis.min;\n        if(ternaryLayoutIn.caxis) delete ternaryLayoutIn.caxis.min;\n    }\n}\n\nfunction handleAxisDefaults(containerIn, containerOut, options, ternaryLayoutOut) {\n    var axAttrs = layoutAttributes[containerOut._name];\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(containerIn, containerOut, axAttrs, attr, dflt);\n    }\n\n    coerce('uirevision', ternaryLayoutOut.uirevision);\n\n    containerOut.type = 'linear'; // no other types allowed for ternary\n\n    var dfltColor = coerce('color');\n    // if axis.color was provided, use it for fonts too; otherwise,\n    // inherit from global font color in case that was provided.\n    var dfltFontColor = (dfltColor !== axAttrs.color.dflt) ? dfltColor : options.font.color;\n\n    var axName = containerOut._name;\n    var letterUpper = axName.charAt(0).toUpperCase();\n    var dfltTitle = 'Component ' + letterUpper;\n\n    var title = coerce('title.text', dfltTitle);\n    containerOut._hovertitle = title === dfltTitle ? title : letterUpper;\n\n    Lib.coerceFont(coerce, 'title.font', {\n        family: options.font.family,\n        size: Lib.bigFont(options.font.size),\n        color: dfltFontColor\n    });\n\n    // range is just set by 'min' - max is determined by the other axes mins\n    coerce('min');\n\n    handleTickValueDefaults(containerIn, containerOut, coerce, 'linear');\n    handleTickLabelDefaults(containerIn, containerOut, coerce, 'linear', {});\n    handleTickMarkDefaults(containerIn, containerOut, coerce,\n        { outerTicks: true });\n\n    var showTickLabels = coerce('showticklabels');\n    if(showTickLabels) {\n        Lib.coerceFont(coerce, 'tickfont', {\n            family: options.font.family,\n            size: options.font.size,\n            color: dfltFontColor\n        });\n        coerce('tickangle');\n        coerce('tickformat');\n    }\n\n    handleLineGridDefaults(containerIn, containerOut, coerce, {\n        dfltColor: dfltColor,\n        bgColor: options.bgColor,\n        // default grid color is darker here (60%, vs cartesian default ~91%)\n        // because the grid is not square so the eye needs heavier cues to follow\n        blend: 60,\n        showLine: true,\n        showGrid: true,\n        noZeroLine: true,\n        attributes: axAttrs\n    });\n\n    coerce('hoverformat');\n    coerce('layer');\n}\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar tinycolor = require('tinycolor2');\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar _ = Lib._;\nvar Color = require('../../components/color');\nvar Drawing = require('../../components/drawing');\nvar setConvert = require('../cartesian/set_convert');\nvar extendFlat = require('../../lib/extend').extendFlat;\nvar Plots = require('../plots');\nvar Axes = require('../cartesian/axes');\nvar dragElement = require('../../components/dragelement');\nvar Fx = require('../../components/fx');\nvar dragHelpers = require('../../components/dragelement/helpers');\nvar freeMode = dragHelpers.freeMode;\nvar rectMode = dragHelpers.rectMode;\nvar Titles = require('../../components/titles');\nvar prepSelect = require('../cartesian/select').prepSelect;\nvar selectOnClick = require('../cartesian/select').selectOnClick;\nvar clearSelect = require('../cartesian/select').clearSelect;\nvar clearSelectionsCache = require('../cartesian/select').clearSelectionsCache;\nvar constants = require('../cartesian/constants');\n\nfunction Ternary(options, fullLayout) {\n    this.id = options.id;\n    this.graphDiv = options.graphDiv;\n    this.init(fullLayout);\n    this.makeFramework(fullLayout);\n\n    // unfortunately, we have to keep track of some axis tick settings\n    // as ternary subplots do not implement the 'ticks' editType\n    this.aTickLayout = null;\n    this.bTickLayout = null;\n    this.cTickLayout = null;\n}\n\nmodule.exports = Ternary;\n\nvar proto = Ternary.prototype;\n\nproto.init = function(fullLayout) {\n    this.container = fullLayout._ternarylayer;\n    this.defs = fullLayout._defs;\n    this.layoutId = fullLayout._uid;\n    this.traceHash = {};\n    this.layers = {};\n};\n\nproto.plot = function(ternaryCalcData, fullLayout) {\n    var _this = this;\n    var ternaryLayout = fullLayout[_this.id];\n    var graphSize = fullLayout._size;\n\n    _this._hasClipOnAxisFalse = false;\n    for(var i = 0; i < ternaryCalcData.length; i++) {\n        var trace = ternaryCalcData[i][0].trace;\n\n        if(trace.cliponaxis === false) {\n            _this._hasClipOnAxisFalse = true;\n            break;\n        }\n    }\n\n    _this.updateLayers(ternaryLayout);\n    _this.adjustLayout(ternaryLayout, graphSize);\n    Plots.generalUpdatePerTraceModule(_this.graphDiv, _this, ternaryCalcData, ternaryLayout);\n    _this.layers.plotbg.select('path').call(Color.fill, ternaryLayout.bgcolor);\n};\n\nproto.makeFramework = function(fullLayout) {\n    var _this = this;\n    var gd = _this.graphDiv;\n    var ternaryLayout = fullLayout[_this.id];\n\n    var clipId = _this.clipId = 'clip' + _this.layoutId + _this.id;\n    var clipIdRelative = _this.clipIdRelative = 'clip-relative' + _this.layoutId + _this.id;\n\n    // clippath for this ternary subplot\n    _this.clipDef = Lib.ensureSingleById(fullLayout._clips, 'clipPath', clipId, function(s) {\n        s.append('path').attr('d', 'M0,0Z');\n    });\n\n    // 'relative' clippath (i.e. no translation) for this ternary subplot\n    _this.clipDefRelative = Lib.ensureSingleById(fullLayout._clips, 'clipPath', clipIdRelative, function(s) {\n        s.append('path').attr('d', 'M0,0Z');\n    });\n\n    // container for everything in this ternary subplot\n    _this.plotContainer = Lib.ensureSingle(_this.container, 'g', _this.id);\n    _this.updateLayers(ternaryLayout);\n\n    Drawing.setClipUrl(_this.layers.backplot, clipId, gd);\n    Drawing.setClipUrl(_this.layers.grids, clipId, gd);\n};\n\nproto.updateLayers = function(ternaryLayout) {\n    var _this = this;\n    var layers = _this.layers;\n\n    // inside that container, we have one container for the data, and\n    // one each for the three axes around it.\n\n    var plotLayers = ['draglayer', 'plotbg', 'backplot', 'grids'];\n\n    if(ternaryLayout.aaxis.layer === 'below traces') {\n        plotLayers.push('aaxis', 'aline');\n    }\n    if(ternaryLayout.baxis.layer === 'below traces') {\n        plotLayers.push('baxis', 'bline');\n    }\n    if(ternaryLayout.caxis.layer === 'below traces') {\n        plotLayers.push('caxis', 'cline');\n    }\n\n    plotLayers.push('frontplot');\n\n    if(ternaryLayout.aaxis.layer === 'above traces') {\n        plotLayers.push('aaxis', 'aline');\n    }\n    if(ternaryLayout.baxis.layer === 'above traces') {\n        plotLayers.push('baxis', 'bline');\n    }\n    if(ternaryLayout.caxis.layer === 'above traces') {\n        plotLayers.push('caxis', 'cline');\n    }\n\n    var toplevel = _this.plotContainer.selectAll('g.toplevel')\n        .data(plotLayers, String);\n\n    var grids = ['agrid', 'bgrid', 'cgrid'];\n\n    toplevel.enter().append('g')\n        .attr('class', function(d) { return 'toplevel ' + d; })\n        .each(function(d) {\n            var s = d3.select(this);\n            layers[d] = s;\n\n            // containers for different trace types.\n            // NOTE - this is different from cartesian, where all traces\n            // are in front of grids. Here I'm putting maps behind the grids\n            // so the grids will always be visible if they're requested.\n            // Perhaps we want that for cartesian too?\n            if(d === 'frontplot') {\n                s.append('g').classed('scatterlayer', true);\n            } else if(d === 'backplot') {\n                s.append('g').classed('maplayer', true);\n            } else if(d === 'plotbg') {\n                s.append('path').attr('d', 'M0,0Z');\n            } else if(d === 'aline' || d === 'bline' || d === 'cline') {\n                s.append('path');\n            } else if(d === 'grids') {\n                grids.forEach(function(d) {\n                    layers[d] = s.append('g').classed('grid ' + d, true);\n                });\n            }\n        });\n\n    toplevel.order();\n};\n\nvar whRatio = Math.sqrt(4 / 3);\n\nproto.adjustLayout = function(ternaryLayout, graphSize) {\n    var _this = this;\n    var domain = ternaryLayout.domain;\n    var xDomainCenter = (domain.x[0] + domain.x[1]) / 2;\n    var yDomainCenter = (domain.y[0] + domain.y[1]) / 2;\n    var xDomain = domain.x[1] - domain.x[0];\n    var yDomain = domain.y[1] - domain.y[0];\n    var wmax = xDomain * graphSize.w;\n    var hmax = yDomain * graphSize.h;\n    var sum = ternaryLayout.sum;\n    var amin = ternaryLayout.aaxis.min;\n    var bmin = ternaryLayout.baxis.min;\n    var cmin = ternaryLayout.caxis.min;\n\n    var x0, y0, w, h, xDomainFinal, yDomainFinal;\n\n    if(wmax > whRatio * hmax) {\n        h = hmax;\n        w = h * whRatio;\n    } else {\n        w = wmax;\n        h = w / whRatio;\n    }\n\n    xDomainFinal = xDomain * w / wmax;\n    yDomainFinal = yDomain * h / hmax;\n\n    x0 = graphSize.l + graphSize.w * xDomainCenter - w / 2;\n    y0 = graphSize.t + graphSize.h * (1 - yDomainCenter) - h / 2;\n\n    _this.x0 = x0;\n    _this.y0 = y0;\n    _this.w = w;\n    _this.h = h;\n    _this.sum = sum;\n\n    // set up the x and y axis objects we'll use to lay out the points\n    _this.xaxis = {\n        type: 'linear',\n        range: [amin + 2 * cmin - sum, sum - amin - 2 * bmin],\n        domain: [\n            xDomainCenter - xDomainFinal / 2,\n            xDomainCenter + xDomainFinal / 2\n        ],\n        _id: 'x'\n    };\n    setConvert(_this.xaxis, _this.graphDiv._fullLayout);\n    _this.xaxis.setScale();\n    _this.xaxis.isPtWithinRange = function(d) {\n        return (\n            d.a >= _this.aaxis.range[0] &&\n            d.a <= _this.aaxis.range[1] &&\n            d.b >= _this.baxis.range[1] &&\n            d.b <= _this.baxis.range[0] &&\n            d.c >= _this.caxis.range[1] &&\n            d.c <= _this.caxis.range[0]\n        );\n    };\n\n    _this.yaxis = {\n        type: 'linear',\n        range: [amin, sum - bmin - cmin],\n        domain: [\n            yDomainCenter - yDomainFinal / 2,\n            yDomainCenter + yDomainFinal / 2\n        ],\n        _id: 'y'\n    };\n    setConvert(_this.yaxis, _this.graphDiv._fullLayout);\n    _this.yaxis.setScale();\n    _this.yaxis.isPtWithinRange = function() { return true; };\n\n    // set up the modified axes for tick drawing\n    var yDomain0 = _this.yaxis.domain[0];\n\n    // aaxis goes up the left side. Set it up as a y axis, but with\n    // fictitious angles and domain, but then rotate and translate\n    // it into place at the end\n    var aaxis = _this.aaxis = extendFlat({}, ternaryLayout.aaxis, {\n        range: [amin, sum - bmin - cmin],\n        side: 'left',\n        // tickangle = 'auto' means 0 anyway for a y axis, need to coerce to 0 here\n        // so we can shift by 30.\n        tickangle: (+ternaryLayout.aaxis.tickangle || 0) - 30,\n        domain: [yDomain0, yDomain0 + yDomainFinal * whRatio],\n        anchor: 'free',\n        position: 0,\n        _id: 'y',\n        _length: w\n    });\n    setConvert(aaxis, _this.graphDiv._fullLayout);\n    aaxis.setScale();\n\n    // baxis goes across the bottom (backward). We can set it up as an x axis\n    // without any enclosing transformation.\n    var baxis = _this.baxis = extendFlat({}, ternaryLayout.baxis, {\n        range: [sum - amin - cmin, bmin],\n        side: 'bottom',\n        domain: _this.xaxis.domain,\n        anchor: 'free',\n        position: 0,\n        _id: 'x',\n        _length: w\n    });\n    setConvert(baxis, _this.graphDiv._fullLayout);\n    baxis.setScale();\n\n    // caxis goes down the right side. Set it up as a y axis, with\n    // post-transformation similar to aaxis\n    var caxis = _this.caxis = extendFlat({}, ternaryLayout.caxis, {\n        range: [sum - amin - bmin, cmin],\n        side: 'right',\n        tickangle: (+ternaryLayout.caxis.tickangle || 0) + 30,\n        domain: [yDomain0, yDomain0 + yDomainFinal * whRatio],\n        anchor: 'free',\n        position: 0,\n        _id: 'y',\n        _length: w\n    });\n    setConvert(caxis, _this.graphDiv._fullLayout);\n    caxis.setScale();\n\n    var triangleClip = 'M' + x0 + ',' + (y0 + h) + 'h' + w + 'l-' + (w / 2) + ',-' + h + 'Z';\n    _this.clipDef.select('path').attr('d', triangleClip);\n    _this.layers.plotbg.select('path').attr('d', triangleClip);\n\n    var triangleClipRelative = 'M0,' + h + 'h' + w + 'l-' + (w / 2) + ',-' + h + 'Z';\n    _this.clipDefRelative.select('path').attr('d', triangleClipRelative);\n\n    var plotTransform = strTranslate(x0, y0);\n    _this.plotContainer.selectAll('.scatterlayer,.maplayer')\n        .attr('transform', plotTransform);\n\n    _this.clipDefRelative.select('path').attr('transform', null);\n\n    // TODO: shift axes to accommodate linewidth*sin(30) tick mark angle\n\n    // TODO: there's probably an easier way to handle these translations/offsets now...\n    var bTransform = strTranslate(x0 - baxis._offset, y0 + h);\n\n    _this.layers.baxis.attr('transform', bTransform);\n    _this.layers.bgrid.attr('transform', bTransform);\n\n    var aTransform = strTranslate(x0 + w / 2, y0) +\n        'rotate(30)' + strTranslate(0, -aaxis._offset);\n    _this.layers.aaxis.attr('transform', aTransform);\n    _this.layers.agrid.attr('transform', aTransform);\n\n    var cTransform = strTranslate(x0 + w / 2, y0) +\n        'rotate(-30)' + strTranslate(0, -caxis._offset);\n    _this.layers.caxis.attr('transform', cTransform);\n    _this.layers.cgrid.attr('transform', cTransform);\n\n    _this.drawAxes(true);\n\n    _this.layers.aline.select('path')\n        .attr('d', aaxis.showline ?\n            'M' + x0 + ',' + (y0 + h) + 'l' + (w / 2) + ',-' + h : 'M0,0')\n        .call(Color.stroke, aaxis.linecolor || '#000')\n        .style('stroke-width', (aaxis.linewidth || 0) + 'px');\n    _this.layers.bline.select('path')\n        .attr('d', baxis.showline ?\n            'M' + x0 + ',' + (y0 + h) + 'h' + w : 'M0,0')\n        .call(Color.stroke, baxis.linecolor || '#000')\n        .style('stroke-width', (baxis.linewidth || 0) + 'px');\n    _this.layers.cline.select('path')\n        .attr('d', caxis.showline ?\n            'M' + (x0 + w / 2) + ',' + y0 + 'l' + (w / 2) + ',' + h : 'M0,0')\n        .call(Color.stroke, caxis.linecolor || '#000')\n        .style('stroke-width', (caxis.linewidth || 0) + 'px');\n\n    if(!_this.graphDiv._context.staticPlot) {\n        _this.initInteractions();\n    }\n\n    Drawing.setClipUrl(\n        _this.layers.frontplot,\n        _this._hasClipOnAxisFalse ? null : _this.clipId,\n        _this.graphDiv\n    );\n};\n\nproto.drawAxes = function(doTitles) {\n    var _this = this;\n    var gd = _this.graphDiv;\n    var titlesuffix = _this.id.substr(7) + 'title';\n    var layers = _this.layers;\n    var aaxis = _this.aaxis;\n    var baxis = _this.baxis;\n    var caxis = _this.caxis;\n\n    _this.drawAx(aaxis);\n    _this.drawAx(baxis);\n    _this.drawAx(caxis);\n\n    if(doTitles) {\n        var apad = Math.max(aaxis.showticklabels ? aaxis.tickfont.size / 2 : 0,\n            (caxis.showticklabels ? caxis.tickfont.size * 0.75 : 0) +\n            (caxis.ticks === 'outside' ? caxis.ticklen * 0.87 : 0));\n        var bpad = (baxis.showticklabels ? baxis.tickfont.size : 0) +\n            (baxis.ticks === 'outside' ? baxis.ticklen : 0) + 3;\n\n        layers['a-title'] = Titles.draw(gd, 'a' + titlesuffix, {\n            propContainer: aaxis,\n            propName: _this.id + '.aaxis.title',\n            placeholder: _(gd, 'Click to enter Component A title'),\n            attributes: {\n                x: _this.x0 + _this.w / 2,\n                y: _this.y0 - aaxis.title.font.size / 3 - apad,\n                'text-anchor': 'middle'\n            }\n        });\n        layers['b-title'] = Titles.draw(gd, 'b' + titlesuffix, {\n            propContainer: baxis,\n            propName: _this.id + '.baxis.title',\n            placeholder: _(gd, 'Click to enter Component B title'),\n            attributes: {\n                x: _this.x0 - bpad,\n                y: _this.y0 + _this.h + baxis.title.font.size * 0.83 + bpad,\n                'text-anchor': 'middle'\n            }\n        });\n        layers['c-title'] = Titles.draw(gd, 'c' + titlesuffix, {\n            propContainer: caxis,\n            propName: _this.id + '.caxis.title',\n            placeholder: _(gd, 'Click to enter Component C title'),\n            attributes: {\n                x: _this.x0 + _this.w + bpad,\n                y: _this.y0 + _this.h + caxis.title.font.size * 0.83 + bpad,\n                'text-anchor': 'middle'\n            }\n        });\n    }\n};\n\nproto.drawAx = function(ax) {\n    var _this = this;\n    var gd = _this.graphDiv;\n    var axName = ax._name;\n    var axLetter = axName.charAt(0);\n    var axId = ax._id;\n    var axLayer = _this.layers[axName];\n    var counterAngle = 30;\n\n    var stashKey = axLetter + 'tickLayout';\n    var newTickLayout = strTickLayout(ax);\n    if(_this[stashKey] !== newTickLayout) {\n        axLayer.selectAll('.' + axId + 'tick').remove();\n        _this[stashKey] = newTickLayout;\n    }\n\n    ax.setScale();\n\n    var vals = Axes.calcTicks(ax);\n    var valsClipped = Axes.clipEnds(ax, vals);\n    var transFn = Axes.makeTransTickFn(ax);\n    var tickSign = Axes.getTickSigns(ax)[2];\n\n    var caRad = Lib.deg2rad(counterAngle);\n    var pad = tickSign * (ax.linewidth || 1) / 2;\n    var len = tickSign * ax.ticklen;\n    var w = _this.w;\n    var h = _this.h;\n\n    var tickPath = axLetter === 'b' ?\n        'M0,' + pad + 'l' + (Math.sin(caRad) * len) + ',' + (Math.cos(caRad) * len) :\n        'M' + pad + ',0l' + (Math.cos(caRad) * len) + ',' + (-Math.sin(caRad) * len);\n\n    var gridPath = {\n        a: 'M0,0l' + h + ',-' + (w / 2),\n        b: 'M0,0l-' + (w / 2) + ',-' + h,\n        c: 'M0,0l-' + h + ',' + (w / 2)\n    }[axLetter];\n\n    Axes.drawTicks(gd, ax, {\n        vals: ax.ticks === 'inside' ? valsClipped : vals,\n        layer: axLayer,\n        path: tickPath,\n        transFn: transFn,\n        crisp: false\n    });\n\n    Axes.drawGrid(gd, ax, {\n        vals: valsClipped,\n        layer: _this.layers[axLetter + 'grid'],\n        path: gridPath,\n        transFn: transFn,\n        crisp: false\n    });\n\n    Axes.drawLabels(gd, ax, {\n        vals: vals,\n        layer: axLayer,\n        transFn: transFn,\n        labelFns: Axes.makeLabelFns(ax, 0, counterAngle)\n    });\n};\n\nfunction strTickLayout(axLayout) {\n    return axLayout.ticks + String(axLayout.ticklen) + String(axLayout.showticklabels);\n}\n\n// hard coded paths for zoom corners\n// uses the same sizing as cartesian, length is MINZOOM/2, width is 3px\nvar CLEN = constants.MINZOOM / 2 + 0.87;\nvar BLPATH = 'm-0.87,.5h' + CLEN + 'v3h-' + (CLEN + 5.2) +\n    'l' + (CLEN / 2 + 2.6) + ',-' + (CLEN * 0.87 + 4.5) +\n    'l2.6,1.5l-' + (CLEN / 2) + ',' + (CLEN * 0.87) + 'Z';\nvar BRPATH = 'm0.87,.5h-' + CLEN + 'v3h' + (CLEN + 5.2) +\n    'l-' + (CLEN / 2 + 2.6) + ',-' + (CLEN * 0.87 + 4.5) +\n    'l-2.6,1.5l' + (CLEN / 2) + ',' + (CLEN * 0.87) + 'Z';\nvar TOPPATH = 'm0,1l' + (CLEN / 2) + ',' + (CLEN * 0.87) +\n    'l2.6,-1.5l-' + (CLEN / 2 + 2.6) + ',-' + (CLEN * 0.87 + 4.5) +\n    'l-' + (CLEN / 2 + 2.6) + ',' + (CLEN * 0.87 + 4.5) +\n    'l2.6,1.5l' + (CLEN / 2) + ',-' + (CLEN * 0.87) + 'Z';\nvar STARTMARKER = 'm0.5,0.5h5v-2h-5v-5h-2v5h-5v2h5v5h2Z';\n\n// I guess this could be shared with cartesian... but for now it's separate.\nvar SHOWZOOMOUTTIP = true;\n\nproto.clearSelect = function() {\n    clearSelectionsCache(this.dragOptions);\n    clearSelect(this.dragOptions.gd);\n};\n\nproto.initInteractions = function() {\n    var _this = this;\n    var dragger = _this.layers.plotbg.select('path').node();\n    var gd = _this.graphDiv;\n    var zoomLayer = gd._fullLayout._zoomlayer;\n    var scaleX;\n    var scaleY;\n\n    // use plotbg for the main interactions\n    this.dragOptions = {\n        element: dragger,\n        gd: gd,\n        plotinfo: {\n            id: _this.id,\n            domain: gd._fullLayout[_this.id].domain,\n            xaxis: _this.xaxis,\n            yaxis: _this.yaxis\n        },\n        subplot: _this.id,\n        prepFn: function(e, startX, startY) {\n            // these aren't available yet when initInteractions\n            // is called\n            _this.dragOptions.xaxes = [_this.xaxis];\n            _this.dragOptions.yaxes = [_this.yaxis];\n\n            scaleX = gd._fullLayout._invScaleX;\n            scaleY = gd._fullLayout._invScaleY;\n\n            var dragModeNow = _this.dragOptions.dragmode = gd._fullLayout.dragmode;\n\n            if(freeMode(dragModeNow)) _this.dragOptions.minDrag = 1;\n            else _this.dragOptions.minDrag = undefined;\n\n            if(dragModeNow === 'zoom') {\n                _this.dragOptions.moveFn = zoomMove;\n                _this.dragOptions.clickFn = clickZoomPan;\n                _this.dragOptions.doneFn = zoomDone;\n                zoomPrep(e, startX, startY);\n            } else if(dragModeNow === 'pan') {\n                _this.dragOptions.moveFn = plotDrag;\n                _this.dragOptions.clickFn = clickZoomPan;\n                _this.dragOptions.doneFn = dragDone;\n                panPrep();\n                _this.clearSelect(gd);\n            } else if(rectMode(dragModeNow) || freeMode(dragModeNow)) {\n                prepSelect(e, startX, startY, _this.dragOptions, dragModeNow);\n            }\n        }\n    };\n\n    var x0, y0, mins0, span0, mins, lum, path0, dimmed, zb, corners;\n\n    function makeUpdate(_mins) {\n        var attrs = {};\n        attrs[_this.id + '.aaxis.min'] = _mins.a;\n        attrs[_this.id + '.baxis.min'] = _mins.b;\n        attrs[_this.id + '.caxis.min'] = _mins.c;\n        return attrs;\n    }\n\n    function clickZoomPan(numClicks, evt) {\n        var clickMode = gd._fullLayout.clickmode;\n\n        removeZoombox(gd);\n\n        if(numClicks === 2) {\n            gd.emit('plotly_doubleclick', null);\n            Registry.call('_guiRelayout', gd, makeUpdate({a: 0, b: 0, c: 0}));\n        }\n\n        if(clickMode.indexOf('select') > -1 && numClicks === 1) {\n            selectOnClick(evt, gd, [_this.xaxis], [_this.yaxis], _this.id, _this.dragOptions);\n        }\n\n        if(clickMode.indexOf('event') > -1) {\n            Fx.click(gd, evt, _this.id);\n        }\n    }\n\n    function zoomPrep(e, startX, startY) {\n        var dragBBox = dragger.getBoundingClientRect();\n        x0 = startX - dragBBox.left;\n        y0 = startY - dragBBox.top;\n\n        gd._fullLayout._calcInverseTransform(gd);\n        var inverse = gd._fullLayout._invTransform;\n        var transformedCoords = Lib.apply3DTransform(inverse)(x0, y0);\n        x0 = transformedCoords[0];\n        y0 = transformedCoords[1];\n\n        mins0 = {\n            a: _this.aaxis.range[0],\n            b: _this.baxis.range[1],\n            c: _this.caxis.range[1]\n        };\n        mins = mins0;\n        span0 = _this.aaxis.range[1] - mins0.a;\n        lum = tinycolor(_this.graphDiv._fullLayout[_this.id].bgcolor).getLuminance();\n        path0 = 'M0,' + _this.h + 'L' + (_this.w / 2) + ', 0L' + _this.w + ',' + _this.h + 'Z';\n        dimmed = false;\n\n        zb = zoomLayer.append('path')\n            .attr('class', 'zoombox')\n            .attr('transform', strTranslate(_this.x0, _this.y0))\n            .style({\n                'fill': lum > 0.2 ? 'rgba(0,0,0,0)' : 'rgba(255,255,255,0)',\n                'stroke-width': 0\n            })\n            .attr('d', path0);\n\n        corners = zoomLayer.append('path')\n            .attr('class', 'zoombox-corners')\n            .attr('transform', strTranslate(_this.x0, _this.y0))\n            .style({\n                fill: Color.background,\n                stroke: Color.defaultLine,\n                'stroke-width': 1,\n                opacity: 0\n            })\n            .attr('d', 'M0,0Z');\n\n        _this.clearSelect(gd);\n    }\n\n    function getAFrac(x, y) { return 1 - (y / _this.h); }\n    function getBFrac(x, y) { return 1 - ((x + (_this.h - y) / Math.sqrt(3)) / _this.w); }\n    function getCFrac(x, y) { return ((x - (_this.h - y) / Math.sqrt(3)) / _this.w); }\n\n    function zoomMove(dx0, dy0) {\n        var x1 = x0 + dx0 * scaleX;\n        var y1 = y0 + dy0 * scaleY;\n        var afrac = Math.max(0, Math.min(1, getAFrac(x0, y0), getAFrac(x1, y1)));\n        var bfrac = Math.max(0, Math.min(1, getBFrac(x0, y0), getBFrac(x1, y1)));\n        var cfrac = Math.max(0, Math.min(1, getCFrac(x0, y0), getCFrac(x1, y1)));\n        var xLeft = ((afrac / 2) + cfrac) * _this.w;\n        var xRight = (1 - (afrac / 2) - bfrac) * _this.w;\n        var xCenter = (xLeft + xRight) / 2;\n        var xSpan = xRight - xLeft;\n        var yBottom = (1 - afrac) * _this.h;\n        var yTop = yBottom - xSpan / whRatio;\n\n        if(xSpan < constants.MINZOOM) {\n            mins = mins0;\n            zb.attr('d', path0);\n            corners.attr('d', 'M0,0Z');\n        } else {\n            mins = {\n                a: mins0.a + afrac * span0,\n                b: mins0.b + bfrac * span0,\n                c: mins0.c + cfrac * span0\n            };\n            zb.attr('d', path0 + 'M' + xLeft + ',' + yBottom +\n                'H' + xRight + 'L' + xCenter + ',' + yTop +\n                'L' + xLeft + ',' + yBottom + 'Z');\n            corners.attr('d', 'M' + x0 + ',' + y0 + STARTMARKER +\n                'M' + xLeft + ',' + yBottom + BLPATH +\n                'M' + xRight + ',' + yBottom + BRPATH +\n                'M' + xCenter + ',' + yTop + TOPPATH);\n        }\n\n        if(!dimmed) {\n            zb.transition()\n                .style('fill', lum > 0.2 ? 'rgba(0,0,0,0.4)' :\n                    'rgba(255,255,255,0.3)')\n                .duration(200);\n            corners.transition()\n                .style('opacity', 1)\n                .duration(200);\n            dimmed = true;\n        }\n\n        gd.emit('plotly_relayouting', makeUpdate(mins));\n    }\n\n    function zoomDone() {\n        removeZoombox(gd);\n\n        if(mins === mins0) return;\n\n        Registry.call('_guiRelayout', gd, makeUpdate(mins));\n\n        if(SHOWZOOMOUTTIP && gd.data && gd._context.showTips) {\n            Lib.notifier(_(gd, 'Double-click to zoom back out'), 'long');\n            SHOWZOOMOUTTIP = false;\n        }\n    }\n\n    function panPrep() {\n        mins0 = {\n            a: _this.aaxis.range[0],\n            b: _this.baxis.range[1],\n            c: _this.caxis.range[1]\n        };\n        mins = mins0;\n    }\n\n    function plotDrag(dx, dy) {\n        var dxScaled = dx / _this.xaxis._m;\n        var dyScaled = dy / _this.yaxis._m;\n        mins = {\n            a: mins0.a - dyScaled,\n            b: mins0.b + (dxScaled + dyScaled) / 2,\n            c: mins0.c - (dxScaled - dyScaled) / 2\n        };\n        var minsorted = [mins.a, mins.b, mins.c].sort(Lib.sorterAsc);\n        var minindices = {\n            a: minsorted.indexOf(mins.a),\n            b: minsorted.indexOf(mins.b),\n            c: minsorted.indexOf(mins.c)\n        };\n        if(minsorted[0] < 0) {\n            if(minsorted[1] + minsorted[0] / 2 < 0) {\n                minsorted[2] += minsorted[0] + minsorted[1];\n                minsorted[0] = minsorted[1] = 0;\n            } else {\n                minsorted[2] += minsorted[0] / 2;\n                minsorted[1] += minsorted[0] / 2;\n                minsorted[0] = 0;\n            }\n            mins = {\n                a: minsorted[minindices.a],\n                b: minsorted[minindices.b],\n                c: minsorted[minindices.c]\n            };\n            dy = (mins0.a - mins.a) * _this.yaxis._m;\n            dx = (mins0.c - mins.c - mins0.b + mins.b) * _this.xaxis._m;\n        }\n\n        // move the data (translate, don't redraw)\n        var plotTransform = strTranslate(_this.x0 + dx, _this.y0 + dy);\n        _this.plotContainer.selectAll('.scatterlayer,.maplayer')\n            .attr('transform', plotTransform);\n\n        var plotTransform2 = strTranslate(-dx, -dy);\n        _this.clipDefRelative.select('path').attr('transform', plotTransform2);\n\n        // move the ticks\n        _this.aaxis.range = [mins.a, _this.sum - mins.b - mins.c];\n        _this.baxis.range = [_this.sum - mins.a - mins.c, mins.b];\n        _this.caxis.range = [_this.sum - mins.a - mins.b, mins.c];\n\n        _this.drawAxes(false);\n\n        if(_this._hasClipOnAxisFalse) {\n            _this.plotContainer\n                .select('.scatterlayer').selectAll('.trace')\n                .call(Drawing.hideOutsideRangePoints, _this);\n        }\n\n        gd.emit('plotly_relayouting', makeUpdate(mins));\n    }\n\n    function dragDone() {\n        Registry.call('_guiRelayout', gd, makeUpdate(mins));\n    }\n\n    // finally, set up hover and click\n    // these event handlers must already be set before dragElement.init\n    // so it can stash them and override them.\n    dragger.onmousemove = function(evt) {\n        Fx.hover(gd, evt, _this.id);\n        gd._fullLayout._lasthover = dragger;\n        gd._fullLayout._hoversubplot = _this.id;\n    };\n\n    dragger.onmouseout = function(evt) {\n        if(gd._dragging) return;\n\n        dragElement.unhover(gd, evt);\n    };\n\n    dragElement.init(this.dragOptions);\n};\n\nfunction removeZoombox(gd) {\n    d3.select(gd)\n        .selectAll('.zoombox,.js-zoombox-backdrop,.js-zoombox-menu,.zoombox-corners')\n        .remove();\n}\n","'use strict';\n\nvar Loggers = require('./lib/loggers');\nvar noop = require('./lib/noop');\nvar pushUnique = require('./lib/push_unique');\nvar isPlainObject = require('./lib/is_plain_object');\nvar addStyleRule = require('./lib/dom').addStyleRule;\nvar ExtendModule = require('./lib/extend');\n\nvar basePlotAttributes = require('./plots/attributes');\nvar baseLayoutAttributes = require('./plots/layout_attributes');\n\nvar extendFlat = ExtendModule.extendFlat;\nvar extendDeepAll = ExtendModule.extendDeepAll;\n\nexports.modules = {};\nexports.allCategories = {};\nexports.allTypes = [];\nexports.subplotsRegistry = {};\nexports.transformsRegistry = {};\nexports.componentsRegistry = {};\nexports.layoutArrayContainers = [];\nexports.layoutArrayRegexes = [];\nexports.traceLayoutAttributes = {};\nexports.localeRegistry = {};\nexports.apiMethodRegistry = {};\nexports.collectableSubplotTypes = null;\n\n/**\n * Top-level register routine, exported as Plotly.register\n *\n * @param {object array or array of objects} _modules :\n *  module object or list of module object to register.\n *\n *  A valid `moduleType: 'trace'` module has fields:\n *  - name {string} : the trace type\n *  - categories {array} : categories associated with this trace type,\n *                         tested with Register.traceIs()\n *  - meta {object} : meta info (mostly for plot-schema)\n *\n *  A valid `moduleType: 'locale'` module has fields:\n *  - name {string} : the locale name. Should be a 2-digit language string ('en', 'de')\n *                    optionally with a country/region code ('en-GB', 'de-CH'). If a country\n *                    code is used but the base language locale has not yet been supplied,\n *                    we will use this locale for the base as well.\n *  - dictionary {object} : the dictionary mapping input strings to localized strings\n *                          generally the keys should be the literal input strings, but\n *                          if default translations are provided you can use any string as a key.\n *  - format {object} : a `d3.locale` format specifier for this locale\n *                      any omitted keys we'll fall back on en-US.\n *\n *  A valid `moduleType: 'transform'` module has fields:\n *  - name {string} : transform name\n *  - transform {function} : default-level transform function\n *  - calcTransform {function} : calc-level transform function\n *  - attributes {object} : transform attributes declarations\n *  - supplyDefaults {function} : attributes default-supply function\n *\n *  A valid `moduleType: 'component'` module has fields:\n *  - name {string} : the component name, used it with Register.getComponentMethod()\n *                    to employ component method.\n *\n *  A valid `moduleType: 'apiMethod'` module has fields:\n *  - name {string} : the api method name.\n *  - fn {function} : the api method called with Register.call();\n *\n */\nexports.register = function register(_modules) {\n    exports.collectableSubplotTypes = null;\n\n    if(!_modules) {\n        throw new Error('No argument passed to Plotly.register.');\n    } else if(_modules && !Array.isArray(_modules)) {\n        _modules = [_modules];\n    }\n\n    for(var i = 0; i < _modules.length; i++) {\n        var newModule = _modules[i];\n\n        if(!newModule) {\n            throw new Error('Invalid module was attempted to be registered!');\n        }\n\n        switch(newModule.moduleType) {\n            case 'trace':\n                registerTraceModule(newModule);\n                break;\n            case 'transform':\n                registerTransformModule(newModule);\n                break;\n            case 'component':\n                registerComponentModule(newModule);\n                break;\n            case 'locale':\n                registerLocale(newModule);\n                break;\n            case 'apiMethod':\n                var name = newModule.name;\n                exports.apiMethodRegistry[name] = newModule.fn;\n                break;\n            default:\n                throw new Error('Invalid module was attempted to be registered!');\n        }\n    }\n};\n\n/**\n * Get registered module using trace object or trace type\n *\n * @param {object||string} trace\n *  trace object with prop 'type' or trace type as a string\n * @return {object}\n *  module object corresponding to trace type\n */\nexports.getModule = function(trace) {\n    var _module = exports.modules[getTraceType(trace)];\n    if(!_module) return false;\n    return _module._module;\n};\n\n/**\n * Determine if this trace type is in a given category\n *\n * @param {object||string} traceType\n *  a trace (object) or trace type (string)\n * @param {string} category\n *  category in question\n * @return {boolean}\n */\nexports.traceIs = function(traceType, category) {\n    traceType = getTraceType(traceType);\n\n    // old Chart Studio Cloud workspace hack, nothing to see here\n    if(traceType === 'various') return false;\n\n    var _module = exports.modules[traceType];\n\n    if(!_module) {\n        if(traceType) {\n            Loggers.log('Unrecognized trace type ' + traceType + '.');\n        }\n\n        _module = exports.modules[basePlotAttributes.type.dflt];\n    }\n\n    return !!_module.categories[category];\n};\n\n/**\n * Determine if this trace has a transform of the given type and return\n * array of matching indices.\n *\n * @param {object} data\n *  a trace object (member of data or fullData)\n * @param {string} type\n *  type of trace to test\n * @return {array}\n *  array of matching indices. If none found, returns []\n */\nexports.getTransformIndices = function(data, type) {\n    var indices = [];\n    var transforms = data.transforms || [];\n    for(var i = 0; i < transforms.length; i++) {\n        if(transforms[i].type === type) {\n            indices.push(i);\n        }\n    }\n    return indices;\n};\n\n/**\n * Determine if this trace has a transform of the given type\n *\n * @param {object} data\n *  a trace object (member of data or fullData)\n * @param {string} type\n *  type of trace to test\n * @return {boolean}\n */\nexports.hasTransform = function(data, type) {\n    var transforms = data.transforms || [];\n    for(var i = 0; i < transforms.length; i++) {\n        if(transforms[i].type === type) {\n            return true;\n        }\n    }\n    return false;\n};\n\n/**\n * Retrieve component module method. Falls back on noop if either the\n * module or the method is missing, so the result can always be safely called\n *\n * @param {string} name\n *  name of component (as declared in component module)\n * @param {string} method\n *  name of component module method\n * @return {function}\n */\nexports.getComponentMethod = function(name, method) {\n    var _module = exports.componentsRegistry[name];\n\n    if(!_module) return noop;\n    return _module[method] || noop;\n};\n\n/**\n * Call registered api method.\n *\n * @param {string} name : api method name\n * @param {...array} args : arguments passed to api method\n * @return {any} : returns api method output\n */\nexports.call = function() {\n    var name = arguments[0];\n    var args = [].slice.call(arguments, 1);\n    return exports.apiMethodRegistry[name].apply(null, args);\n};\n\nfunction registerTraceModule(_module) {\n    var thisType = _module.name;\n    var categoriesIn = _module.categories;\n    var meta = _module.meta;\n\n    if(exports.modules[thisType]) {\n        Loggers.log('Type ' + thisType + ' already registered');\n        return;\n    }\n\n    if(!exports.subplotsRegistry[_module.basePlotModule.name]) {\n        registerSubplot(_module.basePlotModule);\n    }\n\n    var categoryObj = {};\n    for(var i = 0; i < categoriesIn.length; i++) {\n        categoryObj[categoriesIn[i]] = true;\n        exports.allCategories[categoriesIn[i]] = true;\n    }\n\n    exports.modules[thisType] = {\n        _module: _module,\n        categories: categoryObj\n    };\n\n    if(meta && Object.keys(meta).length) {\n        exports.modules[thisType].meta = meta;\n    }\n\n    exports.allTypes.push(thisType);\n\n    for(var componentName in exports.componentsRegistry) {\n        mergeComponentAttrsToTrace(componentName, thisType);\n    }\n\n    /*\n     * Collect all trace layout attributes in one place for easier lookup later\n     * but don't merge them into the base schema as it would confuse the docs\n     * (at least after https://github.com/plotly/documentation/issues/202 gets done!)\n     */\n    if(_module.layoutAttributes) {\n        extendFlat(exports.traceLayoutAttributes, _module.layoutAttributes);\n    }\n\n    var basePlotModule = _module.basePlotModule;\n    var bpmName = basePlotModule.name;\n\n    // add mapbox-gl CSS here to avoid console warning on instantiation\n    if(bpmName === 'mapbox') {\n        var styleRules = basePlotModule.constants.styleRules;\n        for(var k in styleRules) {\n            addStyleRule('.js-plotly-plot .plotly .mapboxgl-' + k, styleRules[k]);\n        }\n    }\n\n    // if `plotly-geo-assets.js` is not included,\n    // add `PlotlyGeoAssets` global to stash references to all fetched\n    // topojson / geojson data\n    if((bpmName === 'geo' || bpmName === 'mapbox') &&\n        (typeof window !== undefined && window.PlotlyGeoAssets === undefined)\n    ) {\n        window.PlotlyGeoAssets = {topojson: {}};\n    }\n}\n\nfunction registerSubplot(_module) {\n    var plotType = _module.name;\n\n    if(exports.subplotsRegistry[plotType]) {\n        Loggers.log('Plot type ' + plotType + ' already registered.');\n        return;\n    }\n\n    // relayout array handling will look for component module methods with this\n    // name and won't find them because this is a subplot module... but that\n    // should be fine, it will just fall back on redrawing the plot.\n    findArrayRegexps(_module);\n\n    // not sure what's best for the 'cartesian' type at this point\n    exports.subplotsRegistry[plotType] = _module;\n\n    for(var componentName in exports.componentsRegistry) {\n        mergeComponentAttrsToSubplot(componentName, _module.name);\n    }\n}\n\nfunction registerComponentModule(_module) {\n    if(typeof _module.name !== 'string') {\n        throw new Error('Component module *name* must be a string.');\n    }\n\n    var name = _module.name;\n    exports.componentsRegistry[name] = _module;\n\n    if(_module.layoutAttributes) {\n        if(_module.layoutAttributes._isLinkedToArray) {\n            pushUnique(exports.layoutArrayContainers, name);\n        }\n        findArrayRegexps(_module);\n    }\n\n    for(var traceType in exports.modules) {\n        mergeComponentAttrsToTrace(name, traceType);\n    }\n\n    for(var subplotName in exports.subplotsRegistry) {\n        mergeComponentAttrsToSubplot(name, subplotName);\n    }\n\n    for(var transformType in exports.transformsRegistry) {\n        mergeComponentAttrsToTransform(name, transformType);\n    }\n\n    if(_module.schema && _module.schema.layout) {\n        extendDeepAll(baseLayoutAttributes, _module.schema.layout);\n    }\n}\n\nfunction registerTransformModule(_module) {\n    if(typeof _module.name !== 'string') {\n        throw new Error('Transform module *name* must be a string.');\n    }\n\n    var prefix = 'Transform module ' + _module.name;\n    var hasTransform = typeof _module.transform === 'function';\n    var hasCalcTransform = typeof _module.calcTransform === 'function';\n\n    if(!hasTransform && !hasCalcTransform) {\n        throw new Error(prefix + ' is missing a *transform* or *calcTransform* method.');\n    }\n    if(hasTransform && hasCalcTransform) {\n        Loggers.log([\n            prefix + ' has both a *transform* and *calcTransform* methods.',\n            'Please note that all *transform* methods are executed',\n            'before all *calcTransform* methods.'\n        ].join(' '));\n    }\n    if(!isPlainObject(_module.attributes)) {\n        Loggers.log(prefix + ' registered without an *attributes* object.');\n    }\n    if(typeof _module.supplyDefaults !== 'function') {\n        Loggers.log(prefix + ' registered without a *supplyDefaults* method.');\n    }\n\n    exports.transformsRegistry[_module.name] = _module;\n\n    for(var componentName in exports.componentsRegistry) {\n        mergeComponentAttrsToTransform(componentName, _module.name);\n    }\n}\n\nfunction registerLocale(_module) {\n    var locale = _module.name;\n    var baseLocale = locale.split('-')[0];\n\n    var newDict = _module.dictionary;\n    var newFormat = _module.format;\n    var hasDict = newDict && Object.keys(newDict).length;\n    var hasFormat = newFormat && Object.keys(newFormat).length;\n\n    var locales = exports.localeRegistry;\n\n    var localeObj = locales[locale];\n    if(!localeObj) locales[locale] = localeObj = {};\n\n    // Should we use this dict for the base locale?\n    // In case we're overwriting a previous dict for this locale, check\n    // whether the base matches the full locale dict now. If we're not\n    // overwriting, locales[locale] is undefined so this just checks if\n    // baseLocale already had a dict or not.\n    // Same logic for dateFormats\n    if(baseLocale !== locale) {\n        var baseLocaleObj = locales[baseLocale];\n        if(!baseLocaleObj) locales[baseLocale] = baseLocaleObj = {};\n\n        if(hasDict && baseLocaleObj.dictionary === localeObj.dictionary) {\n            baseLocaleObj.dictionary = newDict;\n        }\n        if(hasFormat && baseLocaleObj.format === localeObj.format) {\n            baseLocaleObj.format = newFormat;\n        }\n    }\n\n    if(hasDict) localeObj.dictionary = newDict;\n    if(hasFormat) localeObj.format = newFormat;\n}\n\nfunction findArrayRegexps(_module) {\n    if(_module.layoutAttributes) {\n        var arrayAttrRegexps = _module.layoutAttributes._arrayAttrRegexps;\n        if(arrayAttrRegexps) {\n            for(var i = 0; i < arrayAttrRegexps.length; i++) {\n                pushUnique(exports.layoutArrayRegexes, arrayAttrRegexps[i]);\n            }\n        }\n    }\n}\n\nfunction mergeComponentAttrsToTrace(componentName, traceType) {\n    var componentSchema = exports.componentsRegistry[componentName].schema;\n    if(!componentSchema || !componentSchema.traces) return;\n\n    var traceAttrs = componentSchema.traces[traceType];\n    if(traceAttrs) {\n        extendDeepAll(exports.modules[traceType]._module.attributes, traceAttrs);\n    }\n}\n\nfunction mergeComponentAttrsToTransform(componentName, transformType) {\n    var componentSchema = exports.componentsRegistry[componentName].schema;\n    if(!componentSchema || !componentSchema.transforms) return;\n\n    var transformAttrs = componentSchema.transforms[transformType];\n    if(transformAttrs) {\n        extendDeepAll(exports.transformsRegistry[transformType].attributes, transformAttrs);\n    }\n}\n\nfunction mergeComponentAttrsToSubplot(componentName, subplotName) {\n    var componentSchema = exports.componentsRegistry[componentName].schema;\n    if(!componentSchema || !componentSchema.subplots) return;\n\n    var subplotModule = exports.subplotsRegistry[subplotName];\n    var subplotAttrs = subplotModule.layoutAttributes;\n    var subplotAttr = subplotModule.attr === 'subplot' ? subplotModule.name : subplotModule.attr;\n    if(Array.isArray(subplotAttr)) subplotAttr = subplotAttr[0];\n\n    var componentLayoutAttrs = componentSchema.subplots[subplotAttr];\n    if(subplotAttrs && componentLayoutAttrs) {\n        extendDeepAll(subplotAttrs, componentLayoutAttrs);\n    }\n}\n\nfunction getTraceType(traceType) {\n    if(typeof traceType === 'object') traceType = traceType.type;\n    return traceType;\n}\n","'use strict';\n\nvar Registry = require('../registry');\nvar Lib = require('../lib');\n\nvar extendFlat = Lib.extendFlat;\nvar extendDeep = Lib.extendDeep;\n\n// Put default plotTile layouts here\nfunction cloneLayoutOverride(tileClass) {\n    var override;\n\n    switch(tileClass) {\n        case 'themes__thumb':\n            override = {\n                autosize: true,\n                width: 150,\n                height: 150,\n                title: {text: ''},\n                showlegend: false,\n                margin: {l: 5, r: 5, t: 5, b: 5, pad: 0},\n                annotations: []\n            };\n            break;\n\n        case 'thumbnail':\n            override = {\n                title: {text: ''},\n                hidesources: true,\n                showlegend: false,\n                borderwidth: 0,\n                bordercolor: '',\n                margin: {l: 1, r: 1, t: 1, b: 1, pad: 0},\n                annotations: []\n            };\n            break;\n\n        default:\n            override = {};\n    }\n\n\n    return override;\n}\n\nfunction keyIsAxis(keyName) {\n    var types = ['xaxis', 'yaxis', 'zaxis'];\n    return (types.indexOf(keyName.slice(0, 5)) > -1);\n}\n\n\nmodule.exports = function clonePlot(graphObj, options) {\n    var i;\n    var oldData = graphObj.data;\n    var oldLayout = graphObj.layout;\n    var newData = extendDeep([], oldData);\n    var newLayout = extendDeep({}, oldLayout, cloneLayoutOverride(options.tileClass));\n    var context = graphObj._context || {};\n\n    if(options.width) newLayout.width = options.width;\n    if(options.height) newLayout.height = options.height;\n\n    if(options.tileClass === 'thumbnail' || options.tileClass === 'themes__thumb') {\n        // kill annotations\n        newLayout.annotations = [];\n        var keys = Object.keys(newLayout);\n\n        for(i = 0; i < keys.length; i++) {\n            if(keyIsAxis(keys[i])) {\n                newLayout[keys[i]].title = {text: ''};\n            }\n        }\n\n        // kill colorbar and pie labels\n        for(i = 0; i < newData.length; i++) {\n            var trace = newData[i];\n            trace.showscale = false;\n            if(trace.marker) trace.marker.showscale = false;\n            if(Registry.traceIs(trace, 'pie-like')) trace.textposition = 'none';\n        }\n    }\n\n    if(Array.isArray(options.annotations)) {\n        for(i = 0; i < options.annotations.length; i++) {\n            newLayout.annotations.push(options.annotations[i]);\n        }\n    }\n\n    // TODO: does this scene modification really belong here?\n    // If we still need it, can it move into the gl3d module?\n    var sceneIds = Object.keys(newLayout).filter(function(key) {\n        return key.match(/^scene\\d*$/);\n    });\n    if(sceneIds.length) {\n        var axesImageOverride = {};\n        if(options.tileClass === 'thumbnail') {\n            axesImageOverride = {\n                title: {text: ''},\n                showaxeslabels: false,\n                showticklabels: false,\n                linetickenable: false\n            };\n        }\n        for(i = 0; i < sceneIds.length; i++) {\n            var scene = newLayout[sceneIds[i]];\n\n            if(!scene.xaxis) {\n                scene.xaxis = {};\n            }\n\n            if(!scene.yaxis) {\n                scene.yaxis = {};\n            }\n\n            if(!scene.zaxis) {\n                scene.zaxis = {};\n            }\n\n            extendFlat(scene.xaxis, axesImageOverride);\n            extendFlat(scene.yaxis, axesImageOverride);\n            extendFlat(scene.zaxis, axesImageOverride);\n\n            // TODO what does this do?\n            scene._scene = null;\n        }\n    }\n\n    var gd = document.createElement('div');\n    if(options.tileClass) gd.className = options.tileClass;\n\n    var plotTile = {\n        gd: gd,\n        td: gd, // for external (image server) compatibility\n        layout: newLayout,\n        data: newData,\n        config: {\n            staticPlot: (options.staticPlot === undefined) ?\n                true :\n                options.staticPlot,\n            plotGlPixelRatio: (options.plotGlPixelRatio === undefined) ?\n                2 :\n                options.plotGlPixelRatio,\n            displaylogo: options.displaylogo || false,\n            showLink: options.showLink || false,\n            showTips: options.showTips || false,\n            mapboxAccessToken: context.mapboxAccessToken\n        }\n    };\n\n    if(options.setBackground !== 'transparent') {\n        plotTile.config.setBackground = options.setBackground || 'opaque';\n    }\n\n    // attaching the default Layout the gd, so you can grab it later\n    plotTile.gd.defaultLayout = cloneLayoutOverride(options.tileClass);\n\n    return plotTile;\n};\n","'use strict';\n\nvar Lib = require('../lib');\n\nvar toImage = require('../plot_api/to_image');\n\nvar fileSaver = require('./filesaver');\nvar helpers = require('./helpers');\n\n/**\n * Plotly.downloadImage\n *\n * @param {object | string | HTML div} gd\n *   can either be a data/layout/config object\n *   or an existing graph <div>\n *   or an id to an existing graph <div>\n * @param {object} opts (see Plotly.toImage in ../plot_api/to_image)\n * @return {promise}\n */\nfunction downloadImage(gd, opts) {\n    var _gd;\n    if(!Lib.isPlainObject(gd)) _gd = Lib.getGraphDiv(gd);\n\n    opts = opts || {};\n    opts.format = opts.format || 'png';\n    opts.width = opts.width || null;\n    opts.height = opts.height || null;\n    opts.imageDataOnly = true;\n\n    return new Promise(function(resolve, reject) {\n        if(_gd && _gd._snapshotInProgress) {\n            reject(new Error('Snapshotting already in progress.'));\n        }\n\n        // see comments within svgtoimg for additional\n        //   discussion of problems with IE\n        //   can now draw to canvas, but CORS tainted canvas\n        //   does not allow toDataURL\n        //   svg format will work though\n        if(Lib.isIE() && opts.format !== 'svg') {\n            reject(new Error(helpers.MSG_IE_BAD_FORMAT));\n        }\n\n        if(_gd) _gd._snapshotInProgress = true;\n        var promise = toImage(gd, opts);\n\n        var filename = opts.filename || gd.fn || 'newplot';\n        filename += '.' + opts.format.replace('-', '.');\n\n        promise.then(function(result) {\n            if(_gd) _gd._snapshotInProgress = false;\n            return fileSaver(result, filename, opts.format);\n        }).then(function(name) {\n            resolve(name);\n        }).catch(function(err) {\n            if(_gd) _gd._snapshotInProgress = false;\n            reject(err);\n        });\n    });\n}\n\nmodule.exports = downloadImage;\n","'use strict';\n\nvar Lib = require('../lib');\nvar helpers = require('./helpers');\n\n/*\n* substantial portions of this code from FileSaver.js\n* https://github.com/eligrey/FileSaver.js\n* License: https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md\n* FileSaver.js\n* A saveAs() FileSaver implementation.\n* 1.1.20160328\n*\n* By Eli Grey, http://eligrey.com\n* License: MIT\n*   See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md\n*/\nfunction fileSaver(url, name, format) {\n    var saveLink = document.createElement('a');\n    var canUseSaveLink = 'download' in saveLink;\n\n    var promise = new Promise(function(resolve, reject) {\n        var blob;\n        var objectUrl;\n\n        // Safari doesn't allow downloading of blob urls\n        if(Lib.isSafari()) {\n            var prefix = format === 'svg' ? ',' : ';base64,';\n            helpers.octetStream(prefix + encodeURIComponent(url));\n            return resolve(name);\n        }\n\n        // IE 10+ (native saveAs)\n        if(Lib.isIE()) {\n            // At this point we are only dealing with a decoded SVG as\n            // a data URL (since IE only supports SVG)\n            blob = helpers.createBlob(url, 'svg');\n            window.navigator.msSaveBlob(blob, name);\n            blob = null;\n            return resolve(name);\n        }\n\n        if(canUseSaveLink) {\n            blob = helpers.createBlob(url, format);\n            objectUrl = helpers.createObjectURL(blob);\n\n            saveLink.href = objectUrl;\n            saveLink.download = name;\n            document.body.appendChild(saveLink);\n            saveLink.click();\n\n            document.body.removeChild(saveLink);\n            helpers.revokeObjectURL(objectUrl);\n            blob = null;\n\n            return resolve(name);\n        }\n\n        reject(new Error('download error'));\n    });\n\n    return promise;\n}\n\n\nmodule.exports = fileSaver;\n","'use strict';\n\nvar Registry = require('../registry');\n\nexports.getDelay = function(fullLayout) {\n    if(!fullLayout._has) return 0;\n\n    return (\n        fullLayout._has('gl3d') ||\n        fullLayout._has('gl2d') ||\n        fullLayout._has('mapbox')\n    ) ? 500 : 0;\n};\n\nexports.getRedrawFunc = function(gd) {\n    return function() {\n        Registry.getComponentMethod('colorbar', 'draw')(gd);\n    };\n};\n\nexports.encodeSVG = function(svg) {\n    return 'data:image/svg+xml,' + encodeURIComponent(svg);\n};\n\nexports.encodeJSON = function(json) {\n    return 'data:application/json,' + encodeURIComponent(json);\n};\n\nvar DOM_URL = window.URL || window.webkitURL;\n\nexports.createObjectURL = function(blob) {\n    return DOM_URL.createObjectURL(blob);\n};\n\nexports.revokeObjectURL = function(url) {\n    return DOM_URL.revokeObjectURL(url);\n};\n\nexports.createBlob = function(url, format) {\n    if(format === 'svg') {\n        return new window.Blob([url], {type: 'image/svg+xml;charset=utf-8'});\n    } else if(format === 'full-json') {\n        return new window.Blob([url], {type: 'application/json;charset=utf-8'});\n    } else {\n        var binary = fixBinary(window.atob(url));\n        return new window.Blob([binary], {type: 'image/' + format});\n    }\n};\n\nexports.octetStream = function(s) {\n    document.location.href = 'data:application/octet-stream' + s;\n};\n\n// Taken from https://bl.ocks.org/nolanlawson/0eac306e4dac2114c752\nfunction fixBinary(b) {\n    var len = b.length;\n    var buf = new ArrayBuffer(len);\n    var arr = new Uint8Array(buf);\n    for(var i = 0; i < len; i++) {\n        arr[i] = b.charCodeAt(i);\n    }\n    return buf;\n}\n\nexports.IMAGE_URL_PREFIX = /^data:image\\/\\w+;base64,/;\n\nexports.MSG_IE_BAD_FORMAT = 'Sorry IE does not support downloading from canvas. Try {format:\\'svg\\'} instead.';\n","'use strict';\n\nvar helpers = require('./helpers');\n\nvar Snapshot = {\n    getDelay: helpers.getDelay,\n    getRedrawFunc: helpers.getRedrawFunc,\n    clone: require('./cloneplot'),\n    toSVG: require('./tosvg'),\n    svgToImg: require('./svgtoimg'),\n    toImage: require('./toimage'),\n    downloadImage: require('./download')\n};\n\nmodule.exports = Snapshot;\n","'use strict';\n\nvar Lib = require('../lib');\nvar EventEmitter = require('events').EventEmitter;\n\nvar helpers = require('./helpers');\n\nfunction svgToImg(opts) {\n    var ev = opts.emitter || new EventEmitter();\n\n    var promise = new Promise(function(resolve, reject) {\n        var Image = window.Image;\n        var svg = opts.svg;\n        var format = opts.format || 'png';\n\n        // IE only support svg\n        if(Lib.isIE() && format !== 'svg') {\n            var ieSvgError = new Error(helpers.MSG_IE_BAD_FORMAT);\n            reject(ieSvgError);\n            // eventually remove the ev\n            //  in favor of promises\n            if(!opts.promise) {\n                return ev.emit('error', ieSvgError);\n            } else {\n                return promise;\n            }\n        }\n\n        var canvas = opts.canvas;\n        var scale = opts.scale || 1;\n        var w0 = opts.width || 300;\n        var h0 = opts.height || 150;\n        var w1 = scale * w0;\n        var h1 = scale * h0;\n\n        var ctx = canvas.getContext('2d');\n        var img = new Image();\n        var svgBlob, url;\n\n        if(format === 'svg' || Lib.isSafari()) {\n            url = helpers.encodeSVG(svg);\n        } else {\n            svgBlob = helpers.createBlob(svg, 'svg');\n            url = helpers.createObjectURL(svgBlob);\n        }\n\n        canvas.width = w1;\n        canvas.height = h1;\n\n        img.onload = function() {\n            var imgData;\n\n            svgBlob = null;\n            helpers.revokeObjectURL(url);\n\n            // don't need to draw to canvas if svg\n            //  save some time and also avoid failure on IE\n            if(format !== 'svg') {\n                ctx.drawImage(img, 0, 0, w1, h1);\n            }\n\n            switch(format) {\n                case 'jpeg':\n                    imgData = canvas.toDataURL('image/jpeg');\n                    break;\n                case 'png':\n                    imgData = canvas.toDataURL('image/png');\n                    break;\n                case 'webp':\n                    imgData = canvas.toDataURL('image/webp');\n                    break;\n                case 'svg':\n                    imgData = url;\n                    break;\n                default:\n                    var errorMsg = 'Image format is not jpeg, png, svg or webp.';\n                    reject(new Error(errorMsg));\n                    // eventually remove the ev\n                    //  in favor of promises\n                    if(!opts.promise) {\n                        return ev.emit('error', errorMsg);\n                    }\n            }\n            resolve(imgData);\n            // eventually remove the ev\n            //  in favor of promises\n            if(!opts.promise) {\n                ev.emit('success', imgData);\n            }\n        };\n\n        img.onerror = function(err) {\n            svgBlob = null;\n            helpers.revokeObjectURL(url);\n\n            reject(err);\n            // eventually remove the ev\n            //  in favor of promises\n            if(!opts.promise) {\n                return ev.emit('error', err);\n            }\n        };\n\n        img.src = url;\n    });\n\n    // temporary for backward compatibility\n    //  move to only Promise in 2.0.0\n    //  and eliminate the EventEmitter\n    if(opts.promise) {\n        return promise;\n    }\n\n    return ev;\n}\n\nmodule.exports = svgToImg;\n","'use strict';\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar Registry = require('../registry');\nvar Lib = require('../lib');\n\nvar helpers = require('./helpers');\nvar clonePlot = require('./cloneplot');\nvar toSVG = require('./tosvg');\nvar svgToImg = require('./svgtoimg');\n\n/**\n * @param {object} gd figure Object\n * @param {object} opts option object\n * @param opts.format 'jpeg' | 'png' | 'webp' | 'svg'\n */\nfunction toImage(gd, opts) {\n    // first clone the GD so we can operate in a clean environment\n    var ev = new EventEmitter();\n\n    var clone = clonePlot(gd, {format: 'png'});\n    var clonedGd = clone.gd;\n\n    // put the cloned div somewhere off screen before attaching to DOM\n    clonedGd.style.position = 'absolute';\n    clonedGd.style.left = '-5000px';\n    document.body.appendChild(clonedGd);\n\n    function wait() {\n        var delay = helpers.getDelay(clonedGd._fullLayout);\n\n        setTimeout(function() {\n            var svg = toSVG(clonedGd);\n\n            var canvas = document.createElement('canvas');\n            canvas.id = Lib.randstr();\n\n            ev = svgToImg({\n                format: opts.format,\n                width: clonedGd._fullLayout.width,\n                height: clonedGd._fullLayout.height,\n                canvas: canvas,\n                emitter: ev,\n                svg: svg\n            });\n\n            ev.clean = function() {\n                if(clonedGd) document.body.removeChild(clonedGd);\n            };\n        }, delay);\n    }\n\n    var redrawFunc = helpers.getRedrawFunc(clonedGd);\n\n    Registry.call('_doPlot', clonedGd, clone.data, clone.layout, clone.config)\n        .then(redrawFunc)\n        .then(wait)\n        .catch(function(err) {\n            ev.emit('error', err);\n        });\n\n\n    return ev;\n}\n\nmodule.exports = toImage;\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Lib = require('../lib');\nvar Drawing = require('../components/drawing');\nvar Color = require('../components/color');\n\nvar xmlnsNamespaces = require('../constants/xmlns_namespaces');\nvar DOUBLEQUOTE_REGEX = /\"/g;\nvar DUMMY_SUB = 'TOBESTRIPPED';\nvar DUMMY_REGEX = new RegExp('(\"' + DUMMY_SUB + ')|(' + DUMMY_SUB + '\")', 'g');\n\nfunction htmlEntityDecode(s) {\n    var hiddenDiv = d3.select('body').append('div').style({display: 'none'}).html('');\n    var replaced = s.replace(/(&[^;]*;)/gi, function(d) {\n        if(d === '&lt;') { return '&#60;'; } // special handling for brackets\n        if(d === '&rt;') { return '&#62;'; }\n        if(d.indexOf('<') !== -1 || d.indexOf('>') !== -1) { return ''; }\n        return hiddenDiv.html(d).text(); // everything else, let the browser decode it to unicode\n    });\n    hiddenDiv.remove();\n    return replaced;\n}\n\nfunction xmlEntityEncode(str) {\n    return str.replace(/&(?!\\w+;|\\#[0-9]+;| \\#x[0-9A-F]+;)/g, '&amp;');\n}\n\nmodule.exports = function toSVG(gd, format, scale) {\n    var fullLayout = gd._fullLayout;\n    var svg = fullLayout._paper;\n    var toppaper = fullLayout._toppaper;\n    var width = fullLayout.width;\n    var height = fullLayout.height;\n    var i, k;\n\n    // make background color a rect in the svg, then revert after scraping\n    // all other alterations have been dealt with by properly preparing the svg\n    // in the first place... like setting cursors with css classes so we don't\n    // have to remove them, and providing the right namespaces in the svg to\n    // begin with\n    svg.insert('rect', ':first-child')\n        .call(Drawing.setRect, 0, 0, width, height)\n        .call(Color.fill, fullLayout.paper_bgcolor);\n\n    // subplot-specific to-SVG methods\n    // which notably add the contents of the gl-container\n    // into the main svg node\n    var basePlotModules = fullLayout._basePlotModules || [];\n    for(i = 0; i < basePlotModules.length; i++) {\n        var _module = basePlotModules[i];\n\n        if(_module.toSVG) _module.toSVG(gd);\n    }\n\n    // add top items above them assumes everything in toppaper is either\n    // a group or a defs, and if it's empty (like hoverlayer) we can ignore it.\n    if(toppaper) {\n        var nodes = toppaper.node().childNodes;\n\n        // make copy of nodes as childNodes prop gets mutated in loop below\n        var topGroups = Array.prototype.slice.call(nodes);\n\n        for(i = 0; i < topGroups.length; i++) {\n            var topGroup = topGroups[i];\n\n            if(topGroup.childNodes.length) svg.node().appendChild(topGroup);\n        }\n    }\n\n    // remove draglayer for Adobe Illustrator compatibility\n    if(fullLayout._draggers) {\n        fullLayout._draggers.remove();\n    }\n\n    // in case the svg element had an explicit background color, remove this\n    // we want the rect to get the color so it's the right size; svg bg will\n    // fill whatever container it's displayed in regardless of plot size.\n    svg.node().style.background = '';\n\n    svg.selectAll('text')\n        .attr({'data-unformatted': null, 'data-math': null})\n        .each(function() {\n            var txt = d3.select(this);\n\n            // hidden text is pre-formatting mathjax, the browser ignores it\n            // but in a static plot it's useless and it can confuse batik\n            // we've tried to standardize on display:none but make sure we still\n            // catch visibility:hidden if it ever arises\n            if(this.style.visibility === 'hidden' || this.style.display === 'none') {\n                txt.remove();\n                return;\n            } else {\n                // clear other visibility/display values to default\n                // to not potentially confuse non-browser SVG implementations\n                txt.style({visibility: null, display: null});\n            }\n\n            // Font family styles break things because of quotation marks,\n            // so we must remove them *after* the SVG DOM has been serialized\n            // to a string (browsers convert singles back)\n            var ff = this.style.fontFamily;\n            if(ff && ff.indexOf('\"') !== -1) {\n                txt.style('font-family', ff.replace(DOUBLEQUOTE_REGEX, DUMMY_SUB));\n            }\n        });\n\n    var queryParts = [];\n    if(fullLayout._gradientUrlQueryParts) {\n        for(k in fullLayout._gradientUrlQueryParts) queryParts.push(k);\n    }\n\n    if(fullLayout._patternUrlQueryParts) {\n        for(k in fullLayout._patternUrlQueryParts) queryParts.push(k);\n    }\n\n    if(queryParts.length) {\n        svg.selectAll(queryParts.join(',')).each(function() {\n            var pt = d3.select(this);\n\n            // similar to font family styles above,\n            // we must remove \" after the SVG DOM has been serialized\n            var fill = this.style.fill;\n            if(fill && fill.indexOf('url(') !== -1) {\n                pt.style('fill', fill.replace(DOUBLEQUOTE_REGEX, DUMMY_SUB));\n            }\n\n            var stroke = this.style.stroke;\n            if(stroke && stroke.indexOf('url(') !== -1) {\n                pt.style('stroke', stroke.replace(DOUBLEQUOTE_REGEX, DUMMY_SUB));\n            }\n        });\n    }\n\n    if(format === 'pdf' || format === 'eps') {\n        // these formats make the extra line MathJax adds around symbols look super thick in some cases\n        // it looks better if this is removed entirely.\n        svg.selectAll('#MathJax_SVG_glyphs path')\n            .attr('stroke-width', 0);\n    }\n\n    // fix for IE namespacing quirk?\n    // http://stackoverflow.com/questions/19610089/unwanted-namespaces-on-svg-markup-when-using-xmlserializer-in-javascript-with-ie\n    svg.node().setAttributeNS(xmlnsNamespaces.xmlns, 'xmlns', xmlnsNamespaces.svg);\n    svg.node().setAttributeNS(xmlnsNamespaces.xmlns, 'xmlns:xlink', xmlnsNamespaces.xlink);\n\n    if(format === 'svg' && scale) {\n        svg.attr('width', scale * width);\n        svg.attr('height', scale * height);\n        svg.attr('viewBox', '0 0 ' + width + ' ' + height);\n    }\n\n    var s = new window.XMLSerializer().serializeToString(svg.node());\n    s = htmlEntityDecode(s);\n    s = xmlEntityEncode(s);\n\n    // Fix quotations around font strings and gradient URLs\n    s = s.replace(DUMMY_REGEX, '\\'');\n\n    // Do we need this process now that IE9 and IE10 are not supported?\n\n    // IE is very strict, so we will need to clean\n    //  svg with the following regex\n    //  yes this is messy, but do not know a better way\n    // Even with this IE will not work due to tainted canvas\n    //  see https://github.com/kangax/fabric.js/issues/1957\n    //      http://stackoverflow.com/questions/18112047/canvas-todataurl-working-in-all-browsers-except-ie10\n    // Leave here just in case the CORS/tainted IE issue gets resolved\n    if(Lib.isIE()) {\n        // replace double quote with single quote\n        s = s.replace(/\"/gi, '\\'');\n        // url in svg are single quoted\n        //   since we changed double to single\n        //   we'll need to change these to double-quoted\n        s = s.replace(/(\\('#)([^']*)('\\))/gi, '(\\\"#$2\\\")');\n        // font names with spaces will be escaped single-quoted\n        //   we'll need to change these to double-quoted\n        s = s.replace(/(\\\\')/gi, '\\\"');\n    }\n\n    return s;\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\n// arrayOk attributes, merge them into calcdata array\nmodule.exports = function arraysToCalcdata(cd, trace) {\n    for(var i = 0; i < cd.length; i++) cd[i].i = i;\n\n    Lib.mergeArray(trace.text, cd, 'tx');\n    Lib.mergeArray(trace.hovertext, cd, 'htx');\n\n    var marker = trace.marker;\n    if(marker) {\n        Lib.mergeArray(marker.opacity, cd, 'mo', true);\n        Lib.mergeArray(marker.color, cd, 'mc');\n\n        var markerLine = marker.line;\n        if(markerLine) {\n            Lib.mergeArray(markerLine.color, cd, 'mlc');\n            Lib.mergeArrayCastPositive(markerLine.width, cd, 'mlw');\n        }\n    }\n};\n","'use strict';\n\nvar scatterAttrs = require('../scatter/attributes');\nvar axisHoverFormat = require('../../plots/cartesian/axis_format_attributes').axisHoverFormat;\nvar hovertemplateAttrs = require('../../plots/template_attributes').hovertemplateAttrs;\nvar texttemplateAttrs = require('../../plots/template_attributes').texttemplateAttrs;\nvar colorScaleAttrs = require('../../components/colorscale/attributes');\nvar fontAttrs = require('../../plots/font_attributes');\nvar constants = require('./constants');\nvar pattern = require('../../components/drawing/attributes').pattern;\n\nvar extendFlat = require('../../lib/extend').extendFlat;\n\nvar textFontAttrs = fontAttrs({\n    editType: 'calc',\n    arrayOk: true,\n    colorEditType: 'style',\n    description: ''\n});\n\nvar scatterMarkerAttrs = scatterAttrs.marker;\nvar scatterMarkerLineAttrs = scatterMarkerAttrs.line;\n\nvar markerLineWidth = extendFlat({},\n    scatterMarkerLineAttrs.width, { dflt: 0 });\n\nvar markerLine = extendFlat({\n    width: markerLineWidth,\n    editType: 'calc'\n}, colorScaleAttrs('marker.line'));\n\nvar marker = extendFlat({\n    line: markerLine,\n    editType: 'calc'\n}, colorScaleAttrs('marker'), {\n    opacity: {\n        valType: 'number',\n        arrayOk: true,\n        dflt: 1,\n        min: 0,\n        max: 1,\n        editType: 'style',\n        description: 'Sets the opacity of the bars.'\n    },\n    pattern: pattern\n});\n\nmodule.exports = {\n    x: scatterAttrs.x,\n    x0: scatterAttrs.x0,\n    dx: scatterAttrs.dx,\n    y: scatterAttrs.y,\n    y0: scatterAttrs.y0,\n    dy: scatterAttrs.dy,\n\n    xperiod: scatterAttrs.xperiod,\n    yperiod: scatterAttrs.yperiod,\n    xperiod0: scatterAttrs.xperiod0,\n    yperiod0: scatterAttrs.yperiod0,\n    xperiodalignment: scatterAttrs.xperiodalignment,\n    yperiodalignment: scatterAttrs.yperiodalignment,\n    xhoverformat: axisHoverFormat('x'),\n    yhoverformat: axisHoverFormat('y'),\n\n    text: scatterAttrs.text,\n    texttemplate: texttemplateAttrs({editType: 'plot'}, {\n        keys: constants.eventDataKeys\n    }),\n    hovertext: scatterAttrs.hovertext,\n    hovertemplate: hovertemplateAttrs({}, {\n        keys: constants.eventDataKeys\n    }),\n\n    textposition: {\n        valType: 'enumerated',\n        values: ['inside', 'outside', 'auto', 'none'],\n        dflt: 'auto',\n        arrayOk: true,\n        editType: 'calc',\n        description: [\n            'Specifies the location of the `text`.',\n            '*inside* positions `text` inside, next to the bar end',\n            '(rotated and scaled if needed).',\n            '*outside* positions `text` outside, next to the bar end',\n            '(scaled if needed), unless there is another bar stacked on',\n            'this one, then the text gets pushed inside.',\n            '*auto* tries to position `text` inside the bar, but if',\n            'the bar is too small and no bar is stacked on this one',\n            'the text is moved outside.',\n            'If *none*, no text appears.'\n        ].join(' ')\n    },\n\n    insidetextanchor: {\n        valType: 'enumerated',\n        values: ['end', 'middle', 'start'],\n        dflt: 'end',\n        editType: 'plot',\n        description: [\n            'Determines if texts are kept at center or start/end points in `textposition` *inside* mode.'\n        ].join(' ')\n    },\n\n    textangle: {\n        valType: 'angle',\n        dflt: 'auto',\n        editType: 'plot',\n        description: [\n            'Sets the angle of the tick labels with respect to the bar.',\n            'For example, a `tickangle` of -90 draws the tick labels',\n            'vertically. With *auto* the texts may automatically be',\n            'rotated to fit with the maximum size in bars.'\n        ].join(' ')\n    },\n\n    textfont: extendFlat({}, textFontAttrs, {\n        description: 'Sets the font used for `text`.'\n    }),\n\n    insidetextfont: extendFlat({}, textFontAttrs, {\n        description: 'Sets the font used for `text` lying inside the bar.'\n    }),\n\n    outsidetextfont: extendFlat({}, textFontAttrs, {\n        description: 'Sets the font used for `text` lying outside the bar.'\n    }),\n\n    constraintext: {\n        valType: 'enumerated',\n        values: ['inside', 'outside', 'both', 'none'],\n        dflt: 'both',\n        editType: 'calc',\n        description: [\n            'Constrain the size of text inside or outside a bar to be no',\n            'larger than the bar itself.'\n        ].join(' ')\n    },\n\n    cliponaxis: extendFlat({}, scatterAttrs.cliponaxis, {\n        description: [\n            'Determines whether the text nodes',\n            'are clipped about the subplot axes.',\n            'To show the text nodes above axis lines and tick labels,',\n            'make sure to set `xaxis.layer` and `yaxis.layer` to *below traces*.'\n        ].join(' ')\n    }),\n\n    orientation: {\n        valType: 'enumerated',\n        values: ['v', 'h'],\n        editType: 'calc+clearAxisTypes',\n        description: [\n            'Sets the orientation of the bars.',\n            'With *v* (*h*), the value of the each bar spans',\n            'along the vertical (horizontal).'\n        ].join(' ')\n    },\n\n    base: {\n        valType: 'any',\n        dflt: null,\n        arrayOk: true,\n        editType: 'calc',\n        description: [\n            'Sets where the bar base is drawn (in position axis units).',\n            'In *stack* or *relative* barmode,',\n            'traces that set *base* will be excluded',\n            'and drawn in *overlay* mode instead.'\n        ].join(' ')\n    },\n\n    offset: {\n        valType: 'number',\n        dflt: null,\n        arrayOk: true,\n        editType: 'calc',\n        description: [\n            'Shifts the position where the bar is drawn',\n            '(in position axis units).',\n            'In *group* barmode,',\n            'traces that set *offset* will be excluded',\n            'and drawn in *overlay* mode instead.'\n        ].join(' ')\n    },\n\n    width: {\n        valType: 'number',\n        dflt: null,\n        min: 0,\n        arrayOk: true,\n        editType: 'calc',\n        description: [\n            'Sets the bar width (in position axis units).'\n        ].join(' ')\n    },\n\n    marker: marker,\n\n    offsetgroup: {\n        valType: 'string',\n        dflt: '',\n        editType: 'calc',\n        description: [\n            'Set several traces linked to the same position axis',\n            'or matching axes to the same',\n            'offsetgroup where bars of the same position coordinate will line up.'\n        ].join(' ')\n    },\n    alignmentgroup: {\n        valType: 'string',\n        dflt: '',\n        editType: 'calc',\n        description: [\n            'Set several traces linked to the same position axis',\n            'or matching axes to the same',\n            'alignmentgroup. This controls whether bars compute their positional',\n            'range dependently or independently.'\n        ].join(' ')\n    },\n\n    selected: {\n        marker: {\n            opacity: scatterAttrs.selected.marker.opacity,\n            color: scatterAttrs.selected.marker.color,\n            editType: 'style'\n        },\n        textfont: scatterAttrs.selected.textfont,\n        editType: 'style'\n    },\n    unselected: {\n        marker: {\n            opacity: scatterAttrs.unselected.marker.opacity,\n            color: scatterAttrs.unselected.marker.color,\n            editType: 'style'\n        },\n        textfont: scatterAttrs.unselected.textfont,\n        editType: 'style'\n    },\n\n    _deprecated: {\n        bardir: {\n            valType: 'enumerated',\n            editType: 'calc',\n            values: ['v', 'h'],\n            description: 'Renamed to `orientation`.'\n        }\n    }\n};\n","'use strict';\n\nvar Axes = require('../../plots/cartesian/axes');\nvar alignPeriod = require('../../plots/cartesian/align_period');\nvar hasColorscale = require('../../components/colorscale/helpers').hasColorscale;\nvar colorscaleCalc = require('../../components/colorscale/calc');\nvar arraysToCalcdata = require('./arrays_to_calcdata');\nvar calcSelection = require('../scatter/calc_selection');\n\nmodule.exports = function calc(gd, trace) {\n    var xa = Axes.getFromId(gd, trace.xaxis || 'x');\n    var ya = Axes.getFromId(gd, trace.yaxis || 'y');\n    var size, pos, origPos;\n\n    var sizeOpts = {\n        msUTC: !!(trace.base || trace.base === 0)\n    };\n\n    var hasPeriod;\n    if(trace.orientation === 'h') {\n        size = xa.makeCalcdata(trace, 'x', sizeOpts);\n        origPos = ya.makeCalcdata(trace, 'y');\n        pos = alignPeriod(trace, ya, 'y', origPos);\n        hasPeriod = !!trace.yperiodalignment;\n    } else {\n        size = ya.makeCalcdata(trace, 'y', sizeOpts);\n        origPos = xa.makeCalcdata(trace, 'x');\n        pos = alignPeriod(trace, xa, 'x', origPos);\n        hasPeriod = !!trace.xperiodalignment;\n    }\n\n    // create the \"calculated data\" to plot\n    var serieslen = Math.min(pos.length, size.length);\n    var cd = new Array(serieslen);\n\n    // set position and size\n    for(var i = 0; i < serieslen; i++) {\n        cd[i] = { p: pos[i], s: size[i] };\n\n        if(hasPeriod) {\n            cd[i].orig_p = origPos[i]; // used by hover\n        }\n\n        if(trace.ids) {\n            cd[i].id = String(trace.ids[i]);\n        }\n    }\n\n    // auto-z and autocolorscale if applicable\n    if(hasColorscale(trace, 'marker')) {\n        colorscaleCalc(gd, trace, {\n            vals: trace.marker.color,\n            containerStr: 'marker',\n            cLetter: 'c'\n        });\n    }\n    if(hasColorscale(trace, 'marker.line')) {\n        colorscaleCalc(gd, trace, {\n            vals: trace.marker.line.color,\n            containerStr: 'marker.line',\n            cLetter: 'c'\n        });\n    }\n\n    arraysToCalcdata(cd, trace);\n    calcSelection(cd, trace);\n\n    return cd;\n};\n","'use strict';\n\nmodule.exports = {\n    // padding in pixels around text\n    TEXTPAD: 3,\n    // 'value' and 'label' are not really necessary for bar traces,\n    // but they were made available to `texttemplate` (maybe by accident)\n    // via tokens `%{value}` and `%{label}` starting in 1.50.0,\n    // so let's include them in the event data also.\n    eventDataKeys: ['value', 'label']\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar isArrayOrTypedArray = require('../../lib').isArrayOrTypedArray;\nvar BADNUM = require('../../constants/numerical').BADNUM;\n\nvar Registry = require('../../registry');\nvar Axes = require('../../plots/cartesian/axes');\nvar getAxisGroup = require('../../plots/cartesian/constraints').getAxisGroup;\nvar Sieve = require('./sieve.js');\n\n/*\n * Bar chart stacking/grouping positioning and autoscaling calculations\n * for each direction separately calculate the ranges and positions\n * note that this handles histograms too\n * now doing this one subplot at a time\n */\n\nfunction crossTraceCalc(gd, plotinfo) {\n    var xa = plotinfo.xaxis;\n    var ya = plotinfo.yaxis;\n\n    var fullLayout = gd._fullLayout;\n    var fullTraces = gd._fullData;\n    var calcTraces = gd.calcdata;\n    var calcTracesHorz = [];\n    var calcTracesVert = [];\n\n    for(var i = 0; i < fullTraces.length; i++) {\n        var fullTrace = fullTraces[i];\n        if(\n            fullTrace.visible === true &&\n            Registry.traceIs(fullTrace, 'bar') &&\n            fullTrace.xaxis === xa._id &&\n            fullTrace.yaxis === ya._id\n        ) {\n            if(fullTrace.orientation === 'h') {\n                calcTracesHorz.push(calcTraces[i]);\n            } else {\n                calcTracesVert.push(calcTraces[i]);\n            }\n\n            if(fullTrace._computePh) {\n                var cd = gd.calcdata[i];\n                for(var j = 0; j < cd.length; j++) {\n                    if(typeof cd[j].ph0 === 'function') cd[j].ph0 = cd[j].ph0();\n                    if(typeof cd[j].ph1 === 'function') cd[j].ph1 = cd[j].ph1();\n                }\n            }\n        }\n    }\n\n    var opts = {\n        xCat: xa.type === 'category' || xa.type === 'multicategory',\n        yCat: ya.type === 'category' || ya.type === 'multicategory',\n\n        mode: fullLayout.barmode,\n        norm: fullLayout.barnorm,\n        gap: fullLayout.bargap,\n        groupgap: fullLayout.bargroupgap\n    };\n\n    setGroupPositions(gd, xa, ya, calcTracesVert, opts);\n    setGroupPositions(gd, ya, xa, calcTracesHorz, opts);\n}\n\nfunction setGroupPositions(gd, pa, sa, calcTraces, opts) {\n    if(!calcTraces.length) return;\n\n    var excluded;\n    var included;\n    var i, calcTrace, fullTrace;\n\n    initBase(sa, calcTraces);\n\n    switch(opts.mode) {\n        case 'overlay':\n            setGroupPositionsInOverlayMode(pa, sa, calcTraces, opts);\n            break;\n\n        case 'group':\n            // exclude from the group those traces for which the user set an offset\n            excluded = [];\n            included = [];\n            for(i = 0; i < calcTraces.length; i++) {\n                calcTrace = calcTraces[i];\n                fullTrace = calcTrace[0].trace;\n\n                if(fullTrace.offset === undefined) included.push(calcTrace);\n                else excluded.push(calcTrace);\n            }\n\n            if(included.length) {\n                setGroupPositionsInGroupMode(gd, pa, sa, included, opts);\n            }\n            if(excluded.length) {\n                setGroupPositionsInOverlayMode(pa, sa, excluded, opts);\n            }\n            break;\n\n        case 'stack':\n        case 'relative':\n            // exclude from the stack those traces for which the user set a base\n            excluded = [];\n            included = [];\n            for(i = 0; i < calcTraces.length; i++) {\n                calcTrace = calcTraces[i];\n                fullTrace = calcTrace[0].trace;\n\n                if(fullTrace.base === undefined) included.push(calcTrace);\n                else excluded.push(calcTrace);\n            }\n\n            if(included.length) {\n                setGroupPositionsInStackOrRelativeMode(gd, pa, sa, included, opts);\n            }\n            if(excluded.length) {\n                setGroupPositionsInOverlayMode(pa, sa, excluded, opts);\n            }\n            break;\n    }\n\n    collectExtents(calcTraces, pa);\n}\n\nfunction initBase(sa, calcTraces) {\n    var i, j;\n\n    for(i = 0; i < calcTraces.length; i++) {\n        var cd = calcTraces[i];\n        var trace = cd[0].trace;\n        var base = (trace.type === 'funnel') ? trace._base : trace.base;\n        var b;\n\n        // not sure if it really makes sense to have dates for bar size data...\n        // ideally if we want to make gantt charts or something we'd treat\n        // the actual size (trace.x or y) as time delta but base as absolute\n        // time. But included here for completeness.\n        var scalendar = trace.orientation === 'h' ? trace.xcalendar : trace.ycalendar;\n\n        // 'base' on categorical axes makes no sense\n        var d2c = sa.type === 'category' || sa.type === 'multicategory' ?\n            function() { return null; } :\n            sa.d2c;\n\n        if(isArrayOrTypedArray(base)) {\n            for(j = 0; j < Math.min(base.length, cd.length); j++) {\n                b = d2c(base[j], 0, scalendar);\n                if(isNumeric(b)) {\n                    cd[j].b = +b;\n                    cd[j].hasB = 1;\n                } else cd[j].b = 0;\n            }\n            for(; j < cd.length; j++) {\n                cd[j].b = 0;\n            }\n        } else {\n            b = d2c(base, 0, scalendar);\n            var hasBase = isNumeric(b);\n            b = hasBase ? b : 0;\n            for(j = 0; j < cd.length; j++) {\n                cd[j].b = b;\n                if(hasBase) cd[j].hasB = 1;\n            }\n        }\n    }\n}\n\nfunction setGroupPositionsInOverlayMode(pa, sa, calcTraces, opts) {\n    // update position axis and set bar offsets and widths\n    for(var i = 0; i < calcTraces.length; i++) {\n        var calcTrace = calcTraces[i];\n\n        var sieve = new Sieve([calcTrace], {\n            posAxis: pa,\n            sepNegVal: false,\n            overlapNoMerge: !opts.norm\n        });\n\n        // set bar offsets and widths, and update position axis\n        setOffsetAndWidth(pa, sieve, opts);\n\n        // set bar bases and sizes, and update size axis\n        //\n        // (note that `setGroupPositionsInOverlayMode` handles the case barnorm\n        // is defined, because this function is also invoked for traces that\n        // can't be grouped or stacked)\n        if(opts.norm) {\n            sieveBars(sieve);\n            normalizeBars(sa, sieve, opts);\n        } else {\n            setBaseAndTop(sa, sieve);\n        }\n    }\n}\n\nfunction setGroupPositionsInGroupMode(gd, pa, sa, calcTraces, opts) {\n    var sieve = new Sieve(calcTraces, {\n        posAxis: pa,\n        sepNegVal: false,\n        overlapNoMerge: !opts.norm\n    });\n\n    // set bar offsets and widths, and update position axis\n    setOffsetAndWidthInGroupMode(gd, pa, sieve, opts);\n\n    // relative-stack bars within the same trace that would otherwise\n    // be hidden\n    unhideBarsWithinTrace(sieve, pa);\n\n    // set bar bases and sizes, and update size axis\n    if(opts.norm) {\n        sieveBars(sieve);\n        normalizeBars(sa, sieve, opts);\n    } else {\n        setBaseAndTop(sa, sieve);\n    }\n}\n\nfunction setGroupPositionsInStackOrRelativeMode(gd, pa, sa, calcTraces, opts) {\n    var sieve = new Sieve(calcTraces, {\n        posAxis: pa,\n        sepNegVal: opts.mode === 'relative',\n        overlapNoMerge: !(opts.norm || opts.mode === 'stack' || opts.mode === 'relative')\n    });\n\n    // set bar offsets and widths, and update position axis\n    setOffsetAndWidth(pa, sieve, opts);\n\n    // set bar bases and sizes, and update size axis\n    stackBars(sa, sieve, opts);\n\n    // flag the outmost bar (for text display purposes)\n    for(var i = 0; i < calcTraces.length; i++) {\n        var calcTrace = calcTraces[i];\n\n        for(var j = 0; j < calcTrace.length; j++) {\n            var bar = calcTrace[j];\n\n            if(bar.s !== BADNUM) {\n                var isOutmostBar = ((bar.b + bar.s) === sieve.get(bar.p, bar.s));\n                if(isOutmostBar) bar._outmost = true;\n            }\n        }\n    }\n\n    // Note that marking the outmost bars has to be done\n    // before `normalizeBars` changes `bar.b` and `bar.s`.\n    if(opts.norm) normalizeBars(sa, sieve, opts);\n}\n\nfunction setOffsetAndWidth(pa, sieve, opts) {\n    var minDiff = sieve.minDiff;\n    var calcTraces = sieve.traces;\n\n    // set bar offsets and widths\n    var barGroupWidth = minDiff * (1 - opts.gap);\n    var barWidthPlusGap = barGroupWidth;\n    var barWidth = barWidthPlusGap * (1 - (opts.groupgap || 0));\n\n    // computer bar group center and bar offset\n    var offsetFromCenter = -barWidth / 2;\n\n    for(var i = 0; i < calcTraces.length; i++) {\n        var calcTrace = calcTraces[i];\n        var t = calcTrace[0].t;\n\n        // store bar width and offset for this trace\n        t.barwidth = barWidth;\n        t.poffset = offsetFromCenter;\n        t.bargroupwidth = barGroupWidth;\n        t.bardelta = minDiff;\n    }\n\n    // stack bars that only differ by rounding\n    sieve.binWidth = calcTraces[0][0].t.barwidth / 100;\n\n    // if defined, apply trace offset and width\n    applyAttributes(sieve);\n\n    // store the bar center in each calcdata item\n    setBarCenterAndWidth(pa, sieve);\n\n    // update position axes\n    updatePositionAxis(pa, sieve);\n}\n\nfunction setOffsetAndWidthInGroupMode(gd, pa, sieve, opts) {\n    var fullLayout = gd._fullLayout;\n    var positions = sieve.positions;\n    var distinctPositions = sieve.distinctPositions;\n    var minDiff = sieve.minDiff;\n    var calcTraces = sieve.traces;\n    var nTraces = calcTraces.length;\n\n    // if there aren't any overlapping positions,\n    // let them have full width even if mode is group\n    var overlap = (positions.length !== distinctPositions.length);\n    var barGroupWidth = minDiff * (1 - opts.gap);\n\n    var groupId = getAxisGroup(fullLayout, pa._id) + calcTraces[0][0].trace.orientation;\n    var alignmentGroups = fullLayout._alignmentOpts[groupId] || {};\n\n    for(var i = 0; i < nTraces; i++) {\n        var calcTrace = calcTraces[i];\n        var trace = calcTrace[0].trace;\n\n        var alignmentGroupOpts = alignmentGroups[trace.alignmentgroup] || {};\n        var nOffsetGroups = Object.keys(alignmentGroupOpts.offsetGroups || {}).length;\n\n        var barWidthPlusGap;\n        if(nOffsetGroups) {\n            barWidthPlusGap = barGroupWidth / nOffsetGroups;\n        } else {\n            barWidthPlusGap = overlap ? barGroupWidth / nTraces : barGroupWidth;\n        }\n\n        var barWidth = barWidthPlusGap * (1 - (opts.groupgap || 0));\n\n        var offsetFromCenter;\n        if(nOffsetGroups) {\n            offsetFromCenter = ((2 * trace._offsetIndex + 1 - nOffsetGroups) * barWidthPlusGap - barWidth) / 2;\n        } else {\n            offsetFromCenter = overlap ?\n                ((2 * i + 1 - nTraces) * barWidthPlusGap - barWidth) / 2 :\n                -barWidth / 2;\n        }\n\n        var t = calcTrace[0].t;\n        t.barwidth = barWidth;\n        t.poffset = offsetFromCenter;\n        t.bargroupwidth = barGroupWidth;\n        t.bardelta = minDiff;\n    }\n\n    // stack bars that only differ by rounding\n    sieve.binWidth = calcTraces[0][0].t.barwidth / 100;\n\n    // if defined, apply trace width\n    applyAttributes(sieve);\n\n    // store the bar center in each calcdata item\n    setBarCenterAndWidth(pa, sieve);\n\n    // update position axes\n    updatePositionAxis(pa, sieve, overlap);\n}\n\nfunction applyAttributes(sieve) {\n    var calcTraces = sieve.traces;\n    var i, j;\n\n    for(i = 0; i < calcTraces.length; i++) {\n        var calcTrace = calcTraces[i];\n        var calcTrace0 = calcTrace[0];\n        var fullTrace = calcTrace0.trace;\n        var t = calcTrace0.t;\n        var offset = fullTrace._offset || fullTrace.offset;\n        var initialPoffset = t.poffset;\n        var newPoffset;\n\n        if(isArrayOrTypedArray(offset)) {\n            // if offset is an array, then clone it into t.poffset.\n            newPoffset = Array.prototype.slice.call(offset, 0, calcTrace.length);\n\n            // guard against non-numeric items\n            for(j = 0; j < newPoffset.length; j++) {\n                if(!isNumeric(newPoffset[j])) {\n                    newPoffset[j] = initialPoffset;\n                }\n            }\n\n            // if the length of the array is too short,\n            // then extend it with the initial value of t.poffset\n            for(j = newPoffset.length; j < calcTrace.length; j++) {\n                newPoffset.push(initialPoffset);\n            }\n\n            t.poffset = newPoffset;\n        } else if(offset !== undefined) {\n            t.poffset = offset;\n        }\n\n        var width = fullTrace._width || fullTrace.width;\n        var initialBarwidth = t.barwidth;\n\n        if(isArrayOrTypedArray(width)) {\n            // if width is an array, then clone it into t.barwidth.\n            var newBarwidth = Array.prototype.slice.call(width, 0, calcTrace.length);\n\n            // guard against non-numeric items\n            for(j = 0; j < newBarwidth.length; j++) {\n                if(!isNumeric(newBarwidth[j])) newBarwidth[j] = initialBarwidth;\n            }\n\n            // if the length of the array is too short,\n            // then extend it with the initial value of t.barwidth\n            for(j = newBarwidth.length; j < calcTrace.length; j++) {\n                newBarwidth.push(initialBarwidth);\n            }\n\n            t.barwidth = newBarwidth;\n\n            // if user didn't set offset,\n            // then correct t.poffset to ensure bars remain centered\n            if(offset === undefined) {\n                newPoffset = [];\n                for(j = 0; j < calcTrace.length; j++) {\n                    newPoffset.push(\n                        initialPoffset + (initialBarwidth - newBarwidth[j]) / 2\n                    );\n                }\n                t.poffset = newPoffset;\n            }\n        } else if(width !== undefined) {\n            t.barwidth = width;\n\n            // if user didn't set offset,\n            // then correct t.poffset to ensure bars remain centered\n            if(offset === undefined) {\n                t.poffset = initialPoffset + (initialBarwidth - width) / 2;\n            }\n        }\n    }\n}\n\nfunction setBarCenterAndWidth(pa, sieve) {\n    var calcTraces = sieve.traces;\n    var pLetter = getAxisLetter(pa);\n\n    for(var i = 0; i < calcTraces.length; i++) {\n        var calcTrace = calcTraces[i];\n        var t = calcTrace[0].t;\n        var poffset = t.poffset;\n        var poffsetIsArray = Array.isArray(poffset);\n        var barwidth = t.barwidth;\n        var barwidthIsArray = Array.isArray(barwidth);\n\n        for(var j = 0; j < calcTrace.length; j++) {\n            var calcBar = calcTrace[j];\n\n            // store the actual bar width and position, for use by hover\n            var width = calcBar.w = barwidthIsArray ? barwidth[j] : barwidth;\n            calcBar[pLetter] = calcBar.p + (poffsetIsArray ? poffset[j] : poffset) + width / 2;\n        }\n    }\n}\n\nfunction updatePositionAxis(pa, sieve, allowMinDtick) {\n    var calcTraces = sieve.traces;\n    var minDiff = sieve.minDiff;\n    var vpad = minDiff / 2;\n\n    Axes.minDtick(pa, sieve.minDiff, sieve.distinctPositions[0], allowMinDtick);\n\n    for(var i = 0; i < calcTraces.length; i++) {\n        var calcTrace = calcTraces[i];\n        var calcTrace0 = calcTrace[0];\n        var fullTrace = calcTrace0.trace;\n        var pts = [];\n        var bar, l, r, j;\n\n        for(j = 0; j < calcTrace.length; j++) {\n            bar = calcTrace[j];\n            l = bar.p - vpad;\n            r = bar.p + vpad;\n            pts.push(l, r);\n        }\n\n        if(fullTrace.width || fullTrace.offset) {\n            var t = calcTrace0.t;\n            var poffset = t.poffset;\n            var barwidth = t.barwidth;\n            var poffsetIsArray = Array.isArray(poffset);\n            var barwidthIsArray = Array.isArray(barwidth);\n\n            for(j = 0; j < calcTrace.length; j++) {\n                bar = calcTrace[j];\n                var calcBarOffset = poffsetIsArray ? poffset[j] : poffset;\n                var calcBarWidth = barwidthIsArray ? barwidth[j] : barwidth;\n                l = bar.p + calcBarOffset;\n                r = l + calcBarWidth;\n                pts.push(l, r);\n            }\n        }\n\n        fullTrace._extremes[pa._id] = Axes.findExtremes(pa, pts, {padded: false});\n    }\n}\n\n// store these bar bases and tops in calcdata\n// and make sure the size axis includes zero,\n// along with the bases and tops of each bar.\nfunction setBaseAndTop(sa, sieve) {\n    var calcTraces = sieve.traces;\n    var sLetter = getAxisLetter(sa);\n\n    for(var i = 0; i < calcTraces.length; i++) {\n        var calcTrace = calcTraces[i];\n        var fullTrace = calcTrace[0].trace;\n        var pts = [];\n        var tozero = false;\n\n        for(var j = 0; j < calcTrace.length; j++) {\n            var bar = calcTrace[j];\n            var base = bar.b;\n            var top = base + bar.s;\n\n            bar[sLetter] = top;\n            pts.push(top);\n            if(bar.hasB) pts.push(base);\n\n            if(!bar.hasB || !bar.b) {\n                tozero = true;\n            }\n        }\n\n        fullTrace._extremes[sa._id] = Axes.findExtremes(sa, pts, {\n            tozero: tozero,\n            padded: true\n        });\n    }\n}\n\nfunction stackBars(sa, sieve, opts) {\n    var sLetter = getAxisLetter(sa);\n    var calcTraces = sieve.traces;\n    var calcTrace;\n    var fullTrace;\n    var isFunnel;\n    var i, j;\n    var bar;\n\n    for(i = 0; i < calcTraces.length; i++) {\n        calcTrace = calcTraces[i];\n        fullTrace = calcTrace[0].trace;\n\n        if(fullTrace.type === 'funnel') {\n            for(j = 0; j < calcTrace.length; j++) {\n                bar = calcTrace[j];\n\n                if(bar.s !== BADNUM) {\n                    // create base of funnels\n                    sieve.put(bar.p, -0.5 * bar.s);\n                }\n            }\n        }\n    }\n\n    for(i = 0; i < calcTraces.length; i++) {\n        calcTrace = calcTraces[i];\n        fullTrace = calcTrace[0].trace;\n\n        isFunnel = (fullTrace.type === 'funnel');\n\n        var pts = [];\n\n        for(j = 0; j < calcTrace.length; j++) {\n            bar = calcTrace[j];\n\n            if(bar.s !== BADNUM) {\n                // stack current bar and get previous sum\n                var value;\n                if(isFunnel) {\n                    value = bar.s;\n                } else {\n                    value = bar.s + bar.b;\n                }\n\n                var base = sieve.put(bar.p, value);\n\n                var top = base + value;\n\n                // store the bar base and top in each calcdata item\n                bar.b = base;\n                bar[sLetter] = top;\n\n                if(!opts.norm) {\n                    pts.push(top);\n                    if(bar.hasB) {\n                        pts.push(base);\n                    }\n                }\n            }\n        }\n\n        // if barnorm is set, let normalizeBars update the axis range\n        if(!opts.norm) {\n            fullTrace._extremes[sa._id] = Axes.findExtremes(sa, pts, {\n                // N.B. we don't stack base with 'base',\n                // so set tozero:true always!\n                tozero: true,\n                padded: true\n            });\n        }\n    }\n}\n\nfunction sieveBars(sieve) {\n    var calcTraces = sieve.traces;\n\n    for(var i = 0; i < calcTraces.length; i++) {\n        var calcTrace = calcTraces[i];\n\n        for(var j = 0; j < calcTrace.length; j++) {\n            var bar = calcTrace[j];\n\n            if(bar.s !== BADNUM) {\n                sieve.put(bar.p, bar.b + bar.s);\n            }\n        }\n    }\n}\n\nfunction unhideBarsWithinTrace(sieve, pa) {\n    var calcTraces = sieve.traces;\n\n    for(var i = 0; i < calcTraces.length; i++) {\n        var calcTrace = calcTraces[i];\n        var fullTrace = calcTrace[0].trace;\n\n        if(fullTrace.base === undefined) {\n            var inTraceSieve = new Sieve([calcTrace], {\n                posAxis: pa,\n                sepNegVal: true,\n                overlapNoMerge: true\n            });\n\n            for(var j = 0; j < calcTrace.length; j++) {\n                var bar = calcTrace[j];\n\n                if(bar.p !== BADNUM) {\n                    // stack current bar and get previous sum\n                    var base = inTraceSieve.put(bar.p, bar.b + bar.s);\n\n                    // if previous sum if non-zero, this means:\n                    // multiple bars have same starting point are potentially hidden,\n                    // shift them vertically so that all bars are visible by default\n                    if(base) bar.b = base;\n                }\n            }\n        }\n    }\n}\n\n// Note:\n//\n// normalizeBars requires that either sieveBars or stackBars has been\n// previously invoked.\nfunction normalizeBars(sa, sieve, opts) {\n    var calcTraces = sieve.traces;\n    var sLetter = getAxisLetter(sa);\n    var sTop = opts.norm === 'fraction' ? 1 : 100;\n    var sTiny = sTop / 1e9; // in case of rounding error in sum\n    var sMin = sa.l2c(sa.c2l(0));\n    var sMax = opts.mode === 'stack' ? sTop : sMin;\n\n    function needsPadding(v) {\n        return (\n            isNumeric(sa.c2l(v)) &&\n            ((v < sMin - sTiny) || (v > sMax + sTiny) || !isNumeric(sMin))\n        );\n    }\n\n    for(var i = 0; i < calcTraces.length; i++) {\n        var calcTrace = calcTraces[i];\n        var fullTrace = calcTrace[0].trace;\n        var pts = [];\n        var tozero = false;\n        var padded = false;\n\n        for(var j = 0; j < calcTrace.length; j++) {\n            var bar = calcTrace[j];\n\n            if(bar.s !== BADNUM) {\n                var scale = Math.abs(sTop / sieve.get(bar.p, bar.s));\n                bar.b *= scale;\n                bar.s *= scale;\n\n                var base = bar.b;\n                var top = base + bar.s;\n\n                bar[sLetter] = top;\n                pts.push(top);\n                padded = padded || needsPadding(top);\n\n                if(bar.hasB) {\n                    pts.push(base);\n                    padded = padded || needsPadding(base);\n                }\n\n                if(!bar.hasB || !bar.b) {\n                    tozero = true;\n                }\n            }\n        }\n\n        fullTrace._extremes[sa._id] = Axes.findExtremes(sa, pts, {\n            tozero: tozero,\n            padded: padded\n        });\n    }\n}\n\n// find the full position span of bars at each position\n// for use by hover, to ensure labels move in if bars are\n// narrower than the space they're in.\n// run once per trace group (subplot & direction) and\n// the same mapping is attached to all calcdata traces\nfunction collectExtents(calcTraces, pa) {\n    var pLetter = getAxisLetter(pa);\n    var extents = {};\n    var i, j, cd;\n\n    var pMin = Infinity;\n    var pMax = -Infinity;\n\n    for(i = 0; i < calcTraces.length; i++) {\n        cd = calcTraces[i];\n        for(j = 0; j < cd.length; j++) {\n            var p = cd[j].p;\n            if(isNumeric(p)) {\n                pMin = Math.min(pMin, p);\n                pMax = Math.max(pMax, p);\n            }\n        }\n    }\n\n    // this is just for positioning of hover labels, and nobody will care if\n    // the label is 1px too far out; so round positions to 1/10K in case\n    // position values don't exactly match from trace to trace\n    var roundFactor = 10000 / (pMax - pMin);\n    var round = extents.round = function(p) {\n        return String(Math.round(roundFactor * (p - pMin)));\n    };\n\n    for(i = 0; i < calcTraces.length; i++) {\n        cd = calcTraces[i];\n        cd[0].t.extents = extents;\n\n        var poffset = cd[0].t.poffset;\n        var poffsetIsArray = Array.isArray(poffset);\n\n        for(j = 0; j < cd.length; j++) {\n            var di = cd[j];\n            var p0 = di[pLetter] - di.w / 2;\n\n            if(isNumeric(p0)) {\n                var p1 = di[pLetter] + di.w / 2;\n                var pVal = round(di.p);\n                if(extents[pVal]) {\n                    extents[pVal] = [Math.min(p0, extents[pVal][0]), Math.max(p1, extents[pVal][1])];\n                } else {\n                    extents[pVal] = [p0, p1];\n                }\n            }\n\n            di.p0 = di.p + (poffsetIsArray ? poffset[j] : poffset);\n            di.p1 = di.p0 + di.w;\n            di.s0 = di.b;\n            di.s1 = di.s0 + di.s;\n        }\n    }\n}\n\nfunction getAxisLetter(ax) {\n    return ax._id.charAt(0);\n}\n\nmodule.exports = {\n    crossTraceCalc: crossTraceCalc,\n    setGroupPositions: setGroupPositions\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Color = require('../../components/color');\nvar Registry = require('../../registry');\n\nvar handleXYDefaults = require('../scatter/xy_defaults');\nvar handlePeriodDefaults = require('../scatter/period_defaults');\nvar handleStyleDefaults = require('./style_defaults');\nvar getAxisGroup = require('../../plots/cartesian/constraints').getAxisGroup;\nvar attributes = require('./attributes');\n\nvar coerceFont = Lib.coerceFont;\n\nfunction supplyDefaults(traceIn, traceOut, defaultColor, layout) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(traceIn, traceOut, attributes, attr, dflt);\n    }\n\n    var len = handleXYDefaults(traceIn, traceOut, layout, coerce);\n    if(!len) {\n        traceOut.visible = false;\n        return;\n    }\n\n    handlePeriodDefaults(traceIn, traceOut, layout, coerce);\n    coerce('xhoverformat');\n    coerce('yhoverformat');\n\n    coerce('orientation', (traceOut.x && !traceOut.y) ? 'h' : 'v');\n    coerce('base');\n    coerce('offset');\n    coerce('width');\n\n    coerce('text');\n    coerce('hovertext');\n    coerce('hovertemplate');\n\n    var textposition = coerce('textposition');\n    handleText(traceIn, traceOut, layout, coerce, textposition, {\n        moduleHasSelected: true,\n        moduleHasUnselected: true,\n        moduleHasConstrain: true,\n        moduleHasCliponaxis: true,\n        moduleHasTextangle: true,\n        moduleHasInsideanchor: true\n    });\n\n    handleStyleDefaults(traceIn, traceOut, coerce, defaultColor, layout);\n\n    var lineColor = (traceOut.marker.line || {}).color;\n\n    // override defaultColor for error bars with defaultLine\n    var errorBarsSupplyDefaults = Registry.getComponentMethod('errorbars', 'supplyDefaults');\n    errorBarsSupplyDefaults(traceIn, traceOut, lineColor || Color.defaultLine, {axis: 'y'});\n    errorBarsSupplyDefaults(traceIn, traceOut, lineColor || Color.defaultLine, {axis: 'x', inherit: 'y'});\n\n    Lib.coerceSelectionMarkerOpacity(traceOut, coerce);\n}\n\nfunction handleGroupingDefaults(traceIn, traceOut, fullLayout, coerce) {\n    var orientation = traceOut.orientation;\n    // N.B. grouping is done across all trace types that support it\n    var posAxId = traceOut[{v: 'x', h: 'y'}[orientation] + 'axis'];\n    var groupId = getAxisGroup(fullLayout, posAxId) + orientation;\n\n    var alignmentOpts = fullLayout._alignmentOpts || {};\n    var alignmentgroup = coerce('alignmentgroup');\n\n    var alignmentGroups = alignmentOpts[groupId];\n    if(!alignmentGroups) alignmentGroups = alignmentOpts[groupId] = {};\n\n    var alignmentGroupOpts = alignmentGroups[alignmentgroup];\n\n    if(alignmentGroupOpts) {\n        alignmentGroupOpts.traces.push(traceOut);\n    } else {\n        alignmentGroupOpts = alignmentGroups[alignmentgroup] = {\n            traces: [traceOut],\n            alignmentIndex: Object.keys(alignmentGroups).length,\n            offsetGroups: {}\n        };\n    }\n\n    var offsetgroup = coerce('offsetgroup');\n    var offsetGroups = alignmentGroupOpts.offsetGroups;\n    var offsetGroupOpts = offsetGroups[offsetgroup];\n\n    if(offsetgroup) {\n        if(!offsetGroupOpts) {\n            offsetGroupOpts = offsetGroups[offsetgroup] = {\n                offsetIndex: Object.keys(offsetGroups).length\n            };\n        }\n\n        traceOut._offsetIndex = offsetGroupOpts.offsetIndex;\n    }\n}\n\nfunction crossTraceDefaults(fullData, fullLayout) {\n    var traceIn, traceOut;\n\n    function coerce(attr) {\n        return Lib.coerce(traceOut._input, traceOut, attributes, attr);\n    }\n\n    if(fullLayout.barmode === 'group') {\n        for(var i = 0; i < fullData.length; i++) {\n            traceOut = fullData[i];\n\n            if(traceOut.type === 'bar') {\n                traceIn = traceOut._input;\n                handleGroupingDefaults(traceIn, traceOut, fullLayout, coerce);\n            }\n        }\n    }\n}\n\nfunction handleText(traceIn, traceOut, layout, coerce, textposition, opts) {\n    opts = opts || {};\n    var moduleHasSelected = !(opts.moduleHasSelected === false);\n    var moduleHasUnselected = !(opts.moduleHasUnselected === false);\n    var moduleHasConstrain = !(opts.moduleHasConstrain === false);\n    var moduleHasCliponaxis = !(opts.moduleHasCliponaxis === false);\n    var moduleHasTextangle = !(opts.moduleHasTextangle === false);\n    var moduleHasInsideanchor = !(opts.moduleHasInsideanchor === false);\n    var hasPathbar = !!opts.hasPathbar;\n\n    var hasBoth = Array.isArray(textposition) || textposition === 'auto';\n    var hasInside = hasBoth || textposition === 'inside';\n    var hasOutside = hasBoth || textposition === 'outside';\n\n    if(hasInside || hasOutside) {\n        var dfltFont = coerceFont(coerce, 'textfont', layout.font);\n\n        // Note that coercing `insidetextfont` is always needed \n        // even if `textposition` is `outside` for each trace  since\n        // an outside label can become an inside one, for example because\n        // of a bar being stacked on top of it.\n        var insideTextFontDefault = Lib.extendFlat({}, dfltFont);\n        var isTraceTextfontColorSet = traceIn.textfont && traceIn.textfont.color;\n        var isColorInheritedFromLayoutFont = !isTraceTextfontColorSet;\n        if(isColorInheritedFromLayoutFont) {\n            delete insideTextFontDefault.color;\n        }\n        coerceFont(coerce, 'insidetextfont', insideTextFontDefault);\n\n        if(hasPathbar) {\n            var pathbarTextFontDefault = Lib.extendFlat({}, dfltFont);\n            if(isColorInheritedFromLayoutFont) {\n                delete pathbarTextFontDefault.color;\n            }\n            coerceFont(coerce, 'pathbar.textfont', pathbarTextFontDefault);\n        }\n\n        if(hasOutside) coerceFont(coerce, 'outsidetextfont', dfltFont);\n\n        if(moduleHasSelected) coerce('selected.textfont.color');\n        if(moduleHasUnselected) coerce('unselected.textfont.color');\n        if(moduleHasConstrain) coerce('constraintext');\n        if(moduleHasCliponaxis) coerce('cliponaxis');\n        if(moduleHasTextangle) coerce('textangle');\n\n        coerce('texttemplate');\n    }\n\n    if(hasInside) {\n        if(moduleHasInsideanchor) coerce('insidetextanchor');\n    }\n}\n\nmodule.exports = {\n    supplyDefaults: supplyDefaults,\n    crossTraceDefaults: crossTraceDefaults,\n    handleGroupingDefaults: handleGroupingDefaults,\n    handleText: handleText\n};\n","'use strict';\n\nmodule.exports = function eventData(out, pt, trace) {\n    // standard cartesian event data\n    out.x = 'xVal' in pt ? pt.xVal : pt.x;\n    out.y = 'yVal' in pt ? pt.yVal : pt.y;\n    if(pt.xa) out.xaxis = pt.xa;\n    if(pt.ya) out.yaxis = pt.ya;\n\n    if(trace.orientation === 'h') {\n        out.label = out.y;\n        out.value = out.x;\n    } else {\n        out.label = out.x;\n        out.value = out.y;\n    }\n\n    return out;\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar tinycolor = require('tinycolor2');\nvar isArrayOrTypedArray = require('../../lib').isArrayOrTypedArray;\n\nexports.coerceString = function(attributeDefinition, value, defaultValue) {\n    if(typeof value === 'string') {\n        if(value || !attributeDefinition.noBlank) return value;\n    } else if(typeof value === 'number' || value === true) {\n        if(!attributeDefinition.strict) return String(value);\n    }\n\n    return (defaultValue !== undefined) ?\n      defaultValue :\n      attributeDefinition.dflt;\n};\n\nexports.coerceNumber = function(attributeDefinition, value, defaultValue) {\n    if(isNumeric(value)) {\n        value = +value;\n\n        var min = attributeDefinition.min;\n        var max = attributeDefinition.max;\n        var isOutOfBounds = (min !== undefined && value < min) ||\n              (max !== undefined && value > max);\n\n        if(!isOutOfBounds) return value;\n    }\n\n    return (defaultValue !== undefined) ?\n      defaultValue :\n      attributeDefinition.dflt;\n};\n\nexports.coerceColor = function(attributeDefinition, value, defaultValue) {\n    if(tinycolor(value).isValid()) return value;\n\n    return (defaultValue !== undefined) ?\n      defaultValue :\n      attributeDefinition.dflt;\n};\n\nexports.coerceEnumerated = function(attributeDefinition, value, defaultValue) {\n    if(attributeDefinition.coerceNumber) value = +value;\n\n    if(attributeDefinition.values.indexOf(value) !== -1) return value;\n\n    return (defaultValue !== undefined) ?\n      defaultValue :\n      attributeDefinition.dflt;\n};\n\nexports.getValue = function(arrayOrScalar, index) {\n    var value;\n    if(!Array.isArray(arrayOrScalar)) value = arrayOrScalar;\n    else if(index < arrayOrScalar.length) value = arrayOrScalar[index];\n    return value;\n};\n\nexports.getLineWidth = function(trace, di) {\n    var w =\n        (0 < di.mlw) ? di.mlw :\n        !isArrayOrTypedArray(trace.marker.line.width) ? trace.marker.line.width :\n        0;\n\n    return w;\n};\n","'use strict';\n\nvar Fx = require('../../components/fx');\nvar Registry = require('../../registry');\nvar Color = require('../../components/color');\n\nvar fillText = require('../../lib').fillText;\nvar getLineWidth = require('./helpers').getLineWidth;\nvar hoverLabelText = require('../../plots/cartesian/axes').hoverLabelText;\nvar BADNUM = require('../../constants/numerical').BADNUM;\n\nfunction hoverPoints(pointData, xval, yval, hovermode, opts) {\n    var barPointData = hoverOnBars(pointData, xval, yval, hovermode, opts);\n\n    if(barPointData) {\n        var cd = barPointData.cd;\n        var trace = cd[0].trace;\n        var di = cd[barPointData.index];\n\n        barPointData.color = getTraceColor(trace, di);\n        Registry.getComponentMethod('errorbars', 'hoverInfo')(di, trace, barPointData);\n\n        return [barPointData];\n    }\n}\n\nfunction hoverOnBars(pointData, xval, yval, hovermode, opts) {\n    var cd = pointData.cd;\n    var trace = cd[0].trace;\n    var t = cd[0].t;\n    var isClosest = (hovermode === 'closest');\n    var isWaterfall = (trace.type === 'waterfall');\n    var maxHoverDistance = pointData.maxHoverDistance;\n    var maxSpikeDistance = pointData.maxSpikeDistance;\n\n    var posVal, sizeVal, posLetter, sizeLetter, dx, dy, pRangeCalc;\n\n    if(trace.orientation === 'h') {\n        posVal = yval;\n        sizeVal = xval;\n        posLetter = 'y';\n        sizeLetter = 'x';\n        dx = sizeFn;\n        dy = positionFn;\n    } else {\n        posVal = xval;\n        sizeVal = yval;\n        posLetter = 'x';\n        sizeLetter = 'y';\n        dy = sizeFn;\n        dx = positionFn;\n    }\n\n    var period = trace[posLetter + 'period'];\n\n    function thisBarMinPos(di) { return thisBarExtPos(di, -1); }\n    function thisBarMaxPos(di) { return thisBarExtPos(di, 1); }\n\n    function thisBarExtPos(di, sgn) {\n        if(period) {\n            return di.p + sgn * Math.abs(di.p - di.orig_p);\n        }\n        return di[posLetter] + sgn * di.w / 2;\n    }\n\n    var minPos = isClosest || period ?\n        thisBarMinPos :\n        function(di) {\n            /*\n             * In compare mode, accept a bar if you're on it *or* its group.\n             * Nearly always it's the group that matters, but in case the bar\n             * was explicitly set wider than its group we'd better accept the\n             * whole bar.\n             *\n             * use `bardelta` instead of `bargroupwidth` so we accept hover\n             * in the gap. That way hover doesn't flash on and off as you\n             * mouse over the plot in compare modes.\n             * In 'closest' mode though the flashing seems inevitable,\n             * without far more complex logic\n             */\n            return Math.min(thisBarMinPos(di), di.p - t.bardelta / 2);\n        };\n\n    var maxPos = isClosest || period ?\n        thisBarMaxPos :\n        function(di) {\n            return Math.max(thisBarMaxPos(di), di.p + t.bardelta / 2);\n        };\n\n    function inbox(_minPos, _maxPos, maxDistance) {\n        if(opts.finiteRange) maxDistance = 0;\n\n        // add a little to the pseudo-distance for wider bars, so that like scatter,\n        // if you are over two overlapping bars, the narrower one wins.\n        return Fx.inbox(_minPos - posVal, _maxPos - posVal,\n            maxDistance + Math.min(1, Math.abs(_maxPos - _minPos) / pRangeCalc) - 1);\n    }\n\n    function positionFn(di) {\n        return inbox(minPos(di), maxPos(di), maxHoverDistance);\n    }\n\n    function thisBarPositionFn(di) {\n        return inbox(thisBarMinPos(di), thisBarMaxPos(di), maxSpikeDistance);\n    }\n\n    function getSize(di) {\n        var s = di[sizeLetter];\n\n        if(isWaterfall) {\n            var rawS = Math.abs(di.rawS) || 0;\n            if(sizeVal > 0) {\n                s += rawS;\n            } else if(sizeVal < 0) {\n                s -= rawS;\n            }\n        }\n\n        return s;\n    }\n\n    function sizeFn(di) {\n        var v = sizeVal;\n        var b = di.b;\n        var s = getSize(di);\n\n        // add a gradient so hovering near the end of a\n        // bar makes it a little closer match\n        return Fx.inbox(b - v, s - v, maxHoverDistance + (s - v) / (s - b) - 1);\n    }\n\n    function thisBarSizeFn(di) {\n        var v = sizeVal;\n        var b = di.b;\n        var s = getSize(di);\n\n        // add a gradient so hovering near the end of a\n        // bar makes it a little closer match\n        return Fx.inbox(b - v, s - v, maxSpikeDistance + (s - v) / (s - b) - 1);\n    }\n\n    var pa = pointData[posLetter + 'a'];\n    var sa = pointData[sizeLetter + 'a'];\n\n    pRangeCalc = Math.abs(pa.r2c(pa.range[1]) - pa.r2c(pa.range[0]));\n\n    function dxy(di) { return (dx(di) + dy(di)) / 2; }\n    var distfn = Fx.getDistanceFunction(hovermode, dx, dy, dxy);\n    Fx.getClosest(cd, distfn, pointData);\n\n    // skip the rest (for this trace) if we didn't find a close point\n    if(pointData.index === false) return;\n\n    // skip points inside axis rangebreaks\n    if(cd[pointData.index].p === BADNUM) return;\n\n    // if we get here and we're not in 'closest' mode, push min/max pos back\n    // onto the group - even though that means occasionally the mouse will be\n    // over the hover label.\n    if(!isClosest) {\n        minPos = function(di) {\n            return Math.min(thisBarMinPos(di), di.p - t.bargroupwidth / 2);\n        };\n        maxPos = function(di) {\n            return Math.max(thisBarMaxPos(di), di.p + t.bargroupwidth / 2);\n        };\n    }\n\n    // the closest data point\n    var index = pointData.index;\n    var di = cd[index];\n\n    var size = (trace.base) ? di.b + di.s : di.s;\n    pointData[sizeLetter + '0'] = pointData[sizeLetter + '1'] = sa.c2p(di[sizeLetter], true);\n    pointData[sizeLetter + 'LabelVal'] = size;\n\n    var extent = t.extents[t.extents.round(di.p)];\n    pointData[posLetter + '0'] = pa.c2p(isClosest ? minPos(di) : extent[0], true);\n    pointData[posLetter + '1'] = pa.c2p(isClosest ? maxPos(di) : extent[1], true);\n\n    var hasPeriod = di.orig_p !== undefined;\n    pointData[posLetter + 'LabelVal'] = hasPeriod ? di.orig_p : di.p;\n\n    pointData.labelLabel = hoverLabelText(pa, pointData[posLetter + 'LabelVal'], trace[posLetter + 'hoverformat']);\n    pointData.valueLabel = hoverLabelText(sa, pointData[sizeLetter + 'LabelVal'], trace[sizeLetter + 'hoverformat']);\n    pointData.baseLabel = hoverLabelText(sa, di.b, trace[sizeLetter + 'hoverformat']);\n\n    // spikelines always want \"closest\" distance regardless of hovermode\n    pointData.spikeDistance = (thisBarSizeFn(di) + thisBarPositionFn(di)) / 2;\n    // they also want to point to the data value, regardless of where the label goes\n    // in case of bars shifted within groups\n    pointData[posLetter + 'Spike'] = pa.c2p(di.p, true);\n\n    fillText(di, trace, pointData);\n    pointData.hovertemplate = trace.hovertemplate;\n\n    return pointData;\n}\n\nfunction getTraceColor(trace, di) {\n    var mc = di.mcc || trace.marker.color;\n    var mlc = di.mlcc || trace.marker.line.color;\n    var mlw = getLineWidth(trace, di);\n\n    if(Color.opacity(mc)) return mc;\n    else if(Color.opacity(mlc) && mlw) return mlc;\n}\n\nmodule.exports = {\n    hoverPoints: hoverPoints,\n    hoverOnBars: hoverOnBars,\n    getTraceColor: getTraceColor\n};\n","'use strict';\n\nmodule.exports = {\n    attributes: require('./attributes'),\n    layoutAttributes: require('./layout_attributes'),\n    supplyDefaults: require('./defaults').supplyDefaults,\n    crossTraceDefaults: require('./defaults').crossTraceDefaults,\n    supplyLayoutDefaults: require('./layout_defaults'),\n    calc: require('./calc'),\n    crossTraceCalc: require('./cross_trace_calc').crossTraceCalc,\n    colorbar: require('../scatter/marker_colorbar'),\n    arraysToCalcdata: require('./arrays_to_calcdata'),\n    plot: require('./plot').plot,\n    style: require('./style').style,\n    styleOnSelect: require('./style').styleOnSelect,\n    hoverPoints: require('./hover').hoverPoints,\n    eventData: require('./event_data'),\n    selectPoints: require('./select'),\n\n    moduleType: 'trace',\n    name: 'bar',\n    basePlotModule: require('../../plots/cartesian'),\n    categories: ['bar-like', 'cartesian', 'svg', 'bar', 'oriented', 'errorBarsOK', 'showLegend', 'zoomScale'],\n    animatable: true,\n    meta: {\n        description: [\n            'The data visualized by the span of the bars is set in `y`',\n            'if `orientation` is set th *v* (the default)',\n            'and the labels are set in `x`.',\n            'By setting `orientation` to *h*, the roles are interchanged.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\n\nmodule.exports = {\n    barmode: {\n        valType: 'enumerated',\n        values: ['stack', 'group', 'overlay', 'relative'],\n        dflt: 'group',\n        editType: 'calc',\n        description: [\n            'Determines how bars at the same location coordinate',\n            'are displayed on the graph.',\n            'With *stack*, the bars are stacked on top of one another',\n            'With *relative*, the bars are stacked on top of one another,',\n            'with negative values below the axis, positive values above',\n            'With *group*, the bars are plotted next to one another',\n            'centered around the shared location.',\n            'With *overlay*, the bars are plotted over one another,',\n            'you might need to an *opacity* to see multiple bars.'\n        ].join(' ')\n    },\n    barnorm: {\n        valType: 'enumerated',\n        values: ['', 'fraction', 'percent'],\n        dflt: '',\n        editType: 'calc',\n        description: [\n            'Sets the normalization for bar traces on the graph.',\n            'With *fraction*, the value of each bar is divided by the sum of all',\n            'values at that location coordinate.',\n            '*percent* is the same but multiplied by 100 to show percentages.'\n        ].join(' ')\n    },\n    bargap: {\n        valType: 'number',\n        min: 0,\n        max: 1,\n        editType: 'calc',\n        description: [\n            'Sets the gap (in plot fraction) between bars of',\n            'adjacent location coordinates.'\n        ].join(' ')\n    },\n    bargroupgap: {\n        valType: 'number',\n        min: 0,\n        max: 1,\n        dflt: 0,\n        editType: 'calc',\n        description: [\n            'Sets the gap (in plot fraction) between bars of',\n            'the same location coordinate.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar Registry = require('../../registry');\nvar Axes = require('../../plots/cartesian/axes');\nvar Lib = require('../../lib');\n\nvar layoutAttributes = require('./layout_attributes');\n\nmodule.exports = function(layoutIn, layoutOut, fullData) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(layoutIn, layoutOut, layoutAttributes, attr, dflt);\n    }\n\n    var hasBars = false;\n    var shouldBeGapless = false;\n    var gappedAnyway = false;\n    var usedSubplots = {};\n\n    var mode = coerce('barmode');\n\n    for(var i = 0; i < fullData.length; i++) {\n        var trace = fullData[i];\n        if(Registry.traceIs(trace, 'bar') && trace.visible) hasBars = true;\n        else continue;\n\n        // if we have at least 2 grouped bar traces on the same subplot,\n        // we should default to a gap anyway, even if the data is histograms\n        if(mode === 'group') {\n            var subploti = trace.xaxis + trace.yaxis;\n            if(usedSubplots[subploti]) gappedAnyway = true;\n            usedSubplots[subploti] = true;\n        }\n\n        if(trace.visible && trace.type === 'histogram') {\n            var pa = Axes.getFromId({_fullLayout: layoutOut},\n                        trace[trace.orientation === 'v' ? 'xaxis' : 'yaxis']);\n            if(pa.type !== 'category') shouldBeGapless = true;\n        }\n    }\n\n    if(!hasBars) {\n        delete layoutOut.barmode;\n        return;\n    }\n\n    if(mode !== 'overlay') coerce('barnorm');\n\n    coerce('bargap', (shouldBeGapless && !gappedAnyway) ? 0 : 0.2);\n    coerce('bargroupgap');\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar isNumeric = require('fast-isnumeric');\n\nvar Lib = require('../../lib');\nvar svgTextUtils = require('../../lib/svg_text_utils');\n\nvar Color = require('../../components/color');\nvar Drawing = require('../../components/drawing');\nvar Registry = require('../../registry');\nvar tickText = require('../../plots/cartesian/axes').tickText;\n\nvar uniformText = require('./uniform_text');\nvar recordMinTextSize = uniformText.recordMinTextSize;\nvar clearMinTextSize = uniformText.clearMinTextSize;\n\nvar style = require('./style');\nvar helpers = require('./helpers');\nvar constants = require('./constants');\nvar attributes = require('./attributes');\n\nvar attributeText = attributes.text;\nvar attributeTextPosition = attributes.textposition;\n\nvar appendArrayPointValue = require('../../components/fx/helpers').appendArrayPointValue;\n\nvar TEXTPAD = constants.TEXTPAD;\n\nfunction keyFunc(d) {return d.id;}\nfunction getKeyFunc(trace) {\n    if(trace.ids) {\n        return keyFunc;\n    }\n}\n\nfunction dirSign(a, b) {\n    return (a < b) ? 1 : -1;\n}\n\nfunction getXY(di, xa, ya, isHorizontal) {\n    var s = [];\n    var p = [];\n\n    var sAxis = isHorizontal ? xa : ya;\n    var pAxis = isHorizontal ? ya : xa;\n\n    s[0] = sAxis.c2p(di.s0, true);\n    p[0] = pAxis.c2p(di.p0, true);\n\n    s[1] = sAxis.c2p(di.s1, true);\n    p[1] = pAxis.c2p(di.p1, true);\n\n    return isHorizontal ? [s, p] : [p, s];\n}\n\nfunction transition(selection, fullLayout, opts, makeOnCompleteCallback) {\n    if(!fullLayout.uniformtext.mode && hasTransition(opts)) {\n        var onComplete;\n        if(makeOnCompleteCallback) {\n            onComplete = makeOnCompleteCallback();\n        }\n        return selection\n          .transition()\n          .duration(opts.duration)\n          .ease(opts.easing)\n          .each('end', function() { onComplete && onComplete(); })\n          .each('interrupt', function() { onComplete && onComplete(); });\n    } else {\n        return selection;\n    }\n}\n\nfunction hasTransition(transitionOpts) {\n    return transitionOpts && transitionOpts.duration > 0;\n}\n\nfunction plot(gd, plotinfo, cdModule, traceLayer, opts, makeOnCompleteCallback) {\n    var xa = plotinfo.xaxis;\n    var ya = plotinfo.yaxis;\n    var fullLayout = gd._fullLayout;\n\n    if(!opts) {\n        opts = {\n            mode: fullLayout.barmode,\n            norm: fullLayout.barmode,\n            gap: fullLayout.bargap,\n            groupgap: fullLayout.bargroupgap\n        };\n\n        // don't clear bar when this is called from waterfall or funnel\n        clearMinTextSize('bar', fullLayout);\n    }\n\n    var bartraces = Lib.makeTraceGroups(traceLayer, cdModule, 'trace bars').each(function(cd) {\n        var plotGroup = d3.select(this);\n        var trace = cd[0].trace;\n        var isWaterfall = (trace.type === 'waterfall');\n        var isFunnel = (trace.type === 'funnel');\n        var isBar = (trace.type === 'bar');\n        var shouldDisplayZeros = (isBar || isFunnel);\n\n        var adjustPixel = 0;\n        if(isWaterfall && trace.connector.visible && trace.connector.mode === 'between') {\n            adjustPixel = trace.connector.line.width / 2;\n        }\n\n        var isHorizontal = (trace.orientation === 'h');\n        var withTransition = hasTransition(opts);\n\n        var pointGroup = Lib.ensureSingle(plotGroup, 'g', 'points');\n\n        var keyFunc = getKeyFunc(trace);\n        var bars = pointGroup.selectAll('g.point').data(Lib.identity, keyFunc);\n\n        bars.enter().append('g')\n            .classed('point', true);\n\n        bars.exit().remove();\n\n        bars.each(function(di, i) {\n            var bar = d3.select(this);\n\n            // now display the bar\n            // clipped xf/yf (2nd arg true): non-positive\n            // log values go off-screen by plotwidth\n            // so you see them continue if you drag the plot\n            var xy = getXY(di, xa, ya, isHorizontal);\n\n            var x0 = xy[0][0];\n            var x1 = xy[0][1];\n            var y0 = xy[1][0];\n            var y1 = xy[1][1];\n\n            // empty bars\n            var isBlank = (isHorizontal ? x1 - x0 : y1 - y0) === 0;\n\n            // display zeros if line.width > 0\n            if(isBlank && shouldDisplayZeros && helpers.getLineWidth(trace, di)) {\n                isBlank = false;\n            }\n\n            // skip nulls\n            if(!isBlank) {\n                isBlank = (\n                    !isNumeric(x0) ||\n                    !isNumeric(x1) ||\n                    !isNumeric(y0) ||\n                    !isNumeric(y1)\n                );\n            }\n\n            // record isBlank\n            di.isBlank = isBlank;\n\n            // for blank bars, ensure start and end positions are equal - important for smooth transitions\n            if(isBlank) {\n                if(isHorizontal) {\n                    x1 = x0;\n                } else {\n                    y1 = y0;\n                }\n            }\n\n            // in waterfall mode `between` we need to adjust bar end points to match the connector width\n            if(adjustPixel && !isBlank) {\n                if(isHorizontal) {\n                    x0 -= dirSign(x0, x1) * adjustPixel;\n                    x1 += dirSign(x0, x1) * adjustPixel;\n                } else {\n                    y0 -= dirSign(y0, y1) * adjustPixel;\n                    y1 += dirSign(y0, y1) * adjustPixel;\n                }\n            }\n\n            var lw;\n            var mc;\n\n            if(trace.type === 'waterfall') {\n                if(!isBlank) {\n                    var cont = trace[di.dir].marker;\n                    lw = cont.line.width;\n                    mc = cont.color;\n                }\n            } else {\n                lw = helpers.getLineWidth(trace, di);\n                mc = di.mc || trace.marker.color;\n            }\n\n            function roundWithLine(v) {\n                var offset = d3.round((lw / 2) % 1, 2);\n\n                // if there are explicit gaps, don't round,\n                // it can make the gaps look crappy\n                return (opts.gap === 0 && opts.groupgap === 0) ?\n                    d3.round(Math.round(v) - offset, 2) : v;\n            }\n\n            function expandToVisible(v, vc, hideZeroSpan) {\n                if(hideZeroSpan && v === vc) {\n                    // should not expand zero span bars\n                    // when start and end positions are identical\n                    // i.e. for vertical when y0 === y1\n                    // and for horizontal when x0 === x1\n                    return v;\n                }\n\n                // if it's not in danger of disappearing entirely,\n                // round more precisely\n                return Math.abs(v - vc) >= 2 ? roundWithLine(v) :\n                // but if it's very thin, expand it so it's\n                // necessarily visible, even if it might overlap\n                // its neighbor\n                (v > vc ? Math.ceil(v) : Math.floor(v));\n            }\n\n            if(!gd._context.staticPlot) {\n                // if bars are not fully opaque or they have a line\n                // around them, round to integer pixels, mainly for\n                // safari so we prevent overlaps from its expansive\n                // pixelation. if the bars ARE fully opaque and have\n                // no line, expand to a full pixel to make sure we\n                // can see them\n\n                var op = Color.opacity(mc);\n                var fixpx = (op < 1 || lw > 0.01) ? roundWithLine : expandToVisible;\n\n                x0 = fixpx(x0, x1, isHorizontal);\n                x1 = fixpx(x1, x0, isHorizontal);\n                y0 = fixpx(y0, y1, !isHorizontal);\n                y1 = fixpx(y1, y0, !isHorizontal);\n            }\n\n            var sel = transition(Lib.ensureSingle(bar, 'path'), fullLayout, opts, makeOnCompleteCallback);\n            sel\n                .style('vector-effect', 'non-scaling-stroke')\n                .attr('d', (isNaN((x1 - x0) * (y1 - y0)) || (isBlank && gd._context.staticPlot)) ? 'M0,0Z' : 'M' + x0 + ',' + y0 + 'V' + y1 + 'H' + x1 + 'V' + y0 + 'Z')\n                .call(Drawing.setClipUrl, plotinfo.layerClipId, gd);\n\n            if(!fullLayout.uniformtext.mode && withTransition) {\n                var styleFns = Drawing.makePointStyleFns(trace);\n                Drawing.singlePointStyle(di, sel, trace, styleFns, gd);\n            }\n\n            appendBarText(gd, plotinfo, bar, cd, i, x0, x1, y0, y1, opts, makeOnCompleteCallback);\n\n            if(plotinfo.layerClipId) {\n                Drawing.hideOutsideRangePoint(di, bar.select('text'), xa, ya, trace.xcalendar, trace.ycalendar);\n            }\n        });\n\n        // lastly, clip points groups of `cliponaxis !== false` traces\n        // on `plotinfo._hasClipOnAxisFalse === true` subplots\n        var hasClipOnAxisFalse = trace.cliponaxis === false;\n        Drawing.setClipUrl(plotGroup, hasClipOnAxisFalse ? null : plotinfo.layerClipId, gd);\n    });\n\n    // error bars are on the top\n    Registry.getComponentMethod('errorbars', 'plot')(gd, bartraces, plotinfo, opts);\n}\n\nfunction appendBarText(gd, plotinfo, bar, cd, i, x0, x1, y0, y1, opts, makeOnCompleteCallback) {\n    var xa = plotinfo.xaxis;\n    var ya = plotinfo.yaxis;\n\n    var fullLayout = gd._fullLayout;\n    var textPosition;\n\n    function appendTextNode(bar, text, font) {\n        var textSelection = Lib.ensureSingle(bar, 'text')\n            .text(text)\n            .attr({\n                'class': 'bartext bartext-' + textPosition,\n                'text-anchor': 'middle',\n                // prohibit tex interpretation until we can handle\n                // tex and regular text together\n                'data-notex': 1\n            })\n            .call(Drawing.font, font)\n            .call(svgTextUtils.convertToTspans, gd);\n\n        return textSelection;\n    }\n\n    // get trace attributes\n    var trace = cd[0].trace;\n    var isHorizontal = (trace.orientation === 'h');\n\n    var text = getText(fullLayout, cd, i, xa, ya);\n    textPosition = getTextPosition(trace, i);\n\n    // compute text position\n    var inStackOrRelativeMode =\n        opts.mode === 'stack' ||\n        opts.mode === 'relative';\n\n    var calcBar = cd[i];\n    var isOutmostBar = !inStackOrRelativeMode || calcBar._outmost;\n\n    if(!text ||\n        textPosition === 'none' ||\n        ((calcBar.isBlank || x0 === x1 || y0 === y1) && (\n            textPosition === 'auto' ||\n            textPosition === 'inside'))) {\n        bar.select('text').remove();\n        return;\n    }\n\n    var layoutFont = fullLayout.font;\n    var barColor = style.getBarColor(cd[i], trace);\n    var insideTextFont = style.getInsideTextFont(trace, i, layoutFont, barColor);\n    var outsideTextFont = style.getOutsideTextFont(trace, i, layoutFont);\n\n    // Special case: don't use the c2p(v, true) value on log size axes,\n    // so that we can get correctly inside text scaling\n    var di = bar.datum();\n    if(isHorizontal) {\n        if(xa.type === 'log' && di.s0 <= 0) {\n            if(xa.range[0] < xa.range[1]) {\n                x0 = 0;\n            } else {\n                x0 = xa._length;\n            }\n        }\n    } else {\n        if(ya.type === 'log' && di.s0 <= 0) {\n            if(ya.range[0] < ya.range[1]) {\n                y0 = ya._length;\n            } else {\n                y0 = 0;\n            }\n        }\n    }\n\n    // padding excluded\n    var barWidth = Math.abs(x1 - x0) - 2 * TEXTPAD;\n    var barHeight = Math.abs(y1 - y0) - 2 * TEXTPAD;\n\n    var textSelection;\n    var textBB;\n    var textWidth;\n    var textHeight;\n    var font;\n\n    if(textPosition === 'outside') {\n        if(!isOutmostBar && !calcBar.hasB) textPosition = 'inside';\n    }\n\n    if(textPosition === 'auto') {\n        if(isOutmostBar) {\n            // draw text using insideTextFont and check if it fits inside bar\n            textPosition = 'inside';\n\n            font = Lib.ensureUniformFontSize(gd, insideTextFont);\n\n            textSelection = appendTextNode(bar, text, font);\n\n            textBB = Drawing.bBox(textSelection.node()),\n            textWidth = textBB.width,\n            textHeight = textBB.height;\n\n            var textHasSize = (textWidth > 0 && textHeight > 0);\n            var fitsInside = (textWidth <= barWidth && textHeight <= barHeight);\n            var fitsInsideIfRotated = (textWidth <= barHeight && textHeight <= barWidth);\n            var fitsInsideIfShrunk = (isHorizontal) ?\n                (barWidth >= textWidth * (barHeight / textHeight)) :\n                (barHeight >= textHeight * (barWidth / textWidth));\n\n            if(textHasSize && (\n                fitsInside ||\n                fitsInsideIfRotated ||\n                fitsInsideIfShrunk)\n            ) {\n                textPosition = 'inside';\n            } else {\n                textPosition = 'outside';\n                textSelection.remove();\n                textSelection = null;\n            }\n        } else {\n            textPosition = 'inside';\n        }\n    }\n\n    if(!textSelection) {\n        font = Lib.ensureUniformFontSize(gd, (textPosition === 'outside') ? outsideTextFont : insideTextFont);\n\n        textSelection = appendTextNode(bar, text, font);\n\n        var currentTransform = textSelection.attr('transform');\n        textSelection.attr('transform', '');\n        textBB = Drawing.bBox(textSelection.node()),\n        textWidth = textBB.width,\n        textHeight = textBB.height;\n        textSelection.attr('transform', currentTransform);\n\n        if(textWidth <= 0 || textHeight <= 0) {\n            textSelection.remove();\n            return;\n        }\n    }\n\n    var angle = trace.textangle;\n\n    // compute text transform\n    var transform, constrained;\n    if(textPosition === 'outside') {\n        constrained =\n            trace.constraintext === 'both' ||\n            trace.constraintext === 'outside';\n\n        transform = toMoveOutsideBar(x0, x1, y0, y1, textBB, {\n            isHorizontal: isHorizontal,\n            constrained: constrained,\n            angle: angle\n        });\n    } else {\n        constrained =\n            trace.constraintext === 'both' ||\n            trace.constraintext === 'inside';\n\n        transform = toMoveInsideBar(x0, x1, y0, y1, textBB, {\n            isHorizontal: isHorizontal,\n            constrained: constrained,\n            angle: angle,\n            anchor: trace.insidetextanchor\n        });\n    }\n\n    transform.fontSize = font.size;\n    recordMinTextSize(trace.type, transform, fullLayout);\n    calcBar.transform = transform;\n\n    transition(textSelection, fullLayout, opts, makeOnCompleteCallback)\n        .attr('transform', Lib.getTextTransform(transform));\n}\n\nfunction getRotateFromAngle(angle) {\n    return (angle === 'auto') ? 0 : angle;\n}\n\nfunction getRotatedTextSize(textBB, rotate) {\n    var a = Math.PI / 180 * rotate;\n    var absSin = Math.abs(Math.sin(a));\n    var absCos = Math.abs(Math.cos(a));\n\n    return {\n        x: textBB.width * absCos + textBB.height * absSin,\n        y: textBB.width * absSin + textBB.height * absCos\n    };\n}\n\nfunction toMoveInsideBar(x0, x1, y0, y1, textBB, opts) {\n    var isHorizontal = !!opts.isHorizontal;\n    var constrained = !!opts.constrained;\n    var angle = opts.angle || 0;\n    var anchor = opts.anchor || 'end';\n    var isEnd = anchor === 'end';\n    var isStart = anchor === 'start';\n    var leftToRight = opts.leftToRight || 0; // left: -1, center: 0, right: 1\n    var toRight = (leftToRight + 1) / 2;\n    var toLeft = 1 - toRight;\n\n    var textWidth = textBB.width;\n    var textHeight = textBB.height;\n    var lx = Math.abs(x1 - x0);\n    var ly = Math.abs(y1 - y0);\n\n    // compute remaining space\n    var textpad = (\n        lx > (2 * TEXTPAD) &&\n        ly > (2 * TEXTPAD)\n    ) ? TEXTPAD : 0;\n\n    lx -= 2 * textpad;\n    ly -= 2 * textpad;\n\n    var rotate = getRotateFromAngle(angle);\n    if((angle === 'auto') &&\n        !(textWidth <= lx && textHeight <= ly) &&\n        (textWidth > lx || textHeight > ly) && (\n        !(textWidth > ly || textHeight > lx) ||\n        ((textWidth < textHeight) !== (lx < ly))\n    )) {\n        rotate += 90;\n    }\n\n    var t = getRotatedTextSize(textBB, rotate);\n\n    var scale = 1;\n    if(constrained) {\n        scale = Math.min(\n            1,\n            lx / t.x,\n            ly / t.y\n        );\n    }\n\n    // compute text and target positions\n    var textX = (\n        textBB.left * toLeft +\n        textBB.right * toRight\n    );\n    var textY = (textBB.top + textBB.bottom) / 2;\n    var targetX = (\n        (x0 + TEXTPAD) * toLeft +\n        (x1 - TEXTPAD) * toRight\n    );\n    var targetY = (y0 + y1) / 2;\n    var anchorX = 0;\n    var anchorY = 0;\n    if(isStart || isEnd) {\n        var extrapad = (isHorizontal ? t.x : t.y) / 2;\n        var dir = isHorizontal ? dirSign(x0, x1) : dirSign(y0, y1);\n\n        if(isHorizontal) {\n            if(isStart) {\n                targetX = x0 + dir * textpad;\n                anchorX = -dir * extrapad;\n            } else {\n                targetX = x1 - dir * textpad;\n                anchorX = dir * extrapad;\n            }\n        } else {\n            if(isStart) {\n                targetY = y0 + dir * textpad;\n                anchorY = -dir * extrapad;\n            } else {\n                targetY = y1 - dir * textpad;\n                anchorY = dir * extrapad;\n            }\n        }\n    }\n\n    return {\n        textX: textX,\n        textY: textY,\n        targetX: targetX,\n        targetY: targetY,\n        anchorX: anchorX,\n        anchorY: anchorY,\n        scale: scale,\n        rotate: rotate\n    };\n}\n\nfunction toMoveOutsideBar(x0, x1, y0, y1, textBB, opts) {\n    var isHorizontal = !!opts.isHorizontal;\n    var constrained = !!opts.constrained;\n    var angle = opts.angle || 0;\n\n    var textWidth = textBB.width;\n    var textHeight = textBB.height;\n    var lx = Math.abs(x1 - x0);\n    var ly = Math.abs(y1 - y0);\n\n    var textpad;\n    // Keep the padding so the text doesn't sit right against\n    // the bars, but don't factor it into barWidth\n    if(isHorizontal) {\n        textpad = (ly > 2 * TEXTPAD) ? TEXTPAD : 0;\n    } else {\n        textpad = (lx > 2 * TEXTPAD) ? TEXTPAD : 0;\n    }\n\n    // compute rotate and scale\n    var scale = 1;\n    if(constrained) {\n        scale = (isHorizontal) ?\n            Math.min(1, ly / textHeight) :\n            Math.min(1, lx / textWidth);\n    }\n\n    var rotate = getRotateFromAngle(angle);\n    var t = getRotatedTextSize(textBB, rotate);\n\n    // compute text and target positions\n    var extrapad = (isHorizontal ? t.x : t.y) / 2;\n    var textX = (textBB.left + textBB.right) / 2;\n    var textY = (textBB.top + textBB.bottom) / 2;\n    var targetX = (x0 + x1) / 2;\n    var targetY = (y0 + y1) / 2;\n    var anchorX = 0;\n    var anchorY = 0;\n\n    var dir = isHorizontal ? dirSign(x1, x0) : dirSign(y0, y1);\n    if(isHorizontal) {\n        targetX = x1 - dir * textpad;\n        anchorX = dir * extrapad;\n    } else {\n        targetY = y1 + dir * textpad;\n        anchorY = -dir * extrapad;\n    }\n\n    return {\n        textX: textX,\n        textY: textY,\n        targetX: targetX,\n        targetY: targetY,\n        anchorX: anchorX,\n        anchorY: anchorY,\n        scale: scale,\n        rotate: rotate\n    };\n}\n\nfunction getText(fullLayout, cd, index, xa, ya) {\n    var trace = cd[0].trace;\n    var texttemplate = trace.texttemplate;\n\n    var value;\n    if(texttemplate) {\n        value = calcTexttemplate(fullLayout, cd, index, xa, ya);\n    } else if(trace.textinfo) {\n        value = calcTextinfo(cd, index, xa, ya);\n    } else {\n        value = helpers.getValue(trace.text, index);\n    }\n\n    return helpers.coerceString(attributeText, value);\n}\n\nfunction getTextPosition(trace, index) {\n    var value = helpers.getValue(trace.textposition, index);\n    return helpers.coerceEnumerated(attributeTextPosition, value);\n}\n\nfunction calcTexttemplate(fullLayout, cd, index, xa, ya) {\n    var trace = cd[0].trace;\n    var texttemplate = Lib.castOption(trace, index, 'texttemplate');\n    if(!texttemplate) return '';\n    var isWaterfall = (trace.type === 'waterfall');\n    var isFunnel = (trace.type === 'funnel');\n\n    var pLetter, pAxis;\n    var vLetter, vAxis;\n    if(trace.orientation === 'h') {\n        pLetter = 'y';\n        pAxis = ya;\n        vLetter = 'x';\n        vAxis = xa;\n    } else {\n        pLetter = 'x';\n        pAxis = xa;\n        vLetter = 'y';\n        vAxis = ya;\n    }\n\n    function formatLabel(u) {\n        return tickText(pAxis, pAxis.c2l(u), true).text;\n    }\n\n    function formatNumber(v) {\n        return tickText(vAxis, vAxis.c2l(v), true).text;\n    }\n\n    var cdi = cd[index];\n    var obj = {};\n\n    obj.label = cdi.p;\n    obj.labelLabel = obj[pLetter + 'Label'] = formatLabel(cdi.p);\n\n    var tx = Lib.castOption(trace, cdi.i, 'text');\n    if(tx === 0 || tx) obj.text = tx;\n\n    obj.value = cdi.s;\n    obj.valueLabel = obj[vLetter + 'Label'] = formatNumber(cdi.s);\n\n    var pt = {};\n    appendArrayPointValue(pt, trace, cdi.i);\n\n    if(isWaterfall) {\n        obj.delta = +cdi.rawS || cdi.s;\n        obj.deltaLabel = formatNumber(obj.delta);\n        obj.final = cdi.v;\n        obj.finalLabel = formatNumber(obj.final);\n        obj.initial = obj.final - obj.delta;\n        obj.initialLabel = formatNumber(obj.initial);\n    }\n\n    if(isFunnel) {\n        obj.value = cdi.s;\n        obj.valueLabel = formatNumber(obj.value);\n\n        obj.percentInitial = cdi.begR;\n        obj.percentInitialLabel = Lib.formatPercent(cdi.begR);\n        obj.percentPrevious = cdi.difR;\n        obj.percentPreviousLabel = Lib.formatPercent(cdi.difR);\n        obj.percentTotal = cdi.sumR;\n        obj.percenTotalLabel = Lib.formatPercent(cdi.sumR);\n    }\n\n    var customdata = Lib.castOption(trace, cdi.i, 'customdata');\n    if(customdata) obj.customdata = customdata;\n    return Lib.texttemplateString(texttemplate, obj, fullLayout._d3locale, pt, obj, trace._meta || {});\n}\n\nfunction calcTextinfo(cd, index, xa, ya) {\n    var trace = cd[0].trace;\n    var isHorizontal = (trace.orientation === 'h');\n    var isWaterfall = (trace.type === 'waterfall');\n    var isFunnel = (trace.type === 'funnel');\n\n    function formatLabel(u) {\n        var pAxis = isHorizontal ? ya : xa;\n        return tickText(pAxis, u, true).text;\n    }\n\n    function formatNumber(v) {\n        var sAxis = isHorizontal ? xa : ya;\n        return tickText(sAxis, +v, true).text;\n    }\n\n    var textinfo = trace.textinfo;\n    var cdi = cd[index];\n\n    var parts = textinfo.split('+');\n    var text = [];\n    var tx;\n\n    var hasFlag = function(flag) { return parts.indexOf(flag) !== -1; };\n\n    if(hasFlag('label')) {\n        text.push(formatLabel(cd[index].p));\n    }\n\n    if(hasFlag('text')) {\n        tx = Lib.castOption(trace, cdi.i, 'text');\n        if(tx === 0 || tx) text.push(tx);\n    }\n\n    if(isWaterfall) {\n        var delta = +cdi.rawS || cdi.s;\n        var final = cdi.v;\n        var initial = final - delta;\n\n        if(hasFlag('initial')) text.push(formatNumber(initial));\n        if(hasFlag('delta')) text.push(formatNumber(delta));\n        if(hasFlag('final')) text.push(formatNumber(final));\n    }\n\n    if(isFunnel) {\n        if(hasFlag('value')) text.push(formatNumber(cdi.s));\n\n        var nPercent = 0;\n        if(hasFlag('percent initial')) nPercent++;\n        if(hasFlag('percent previous')) nPercent++;\n        if(hasFlag('percent total')) nPercent++;\n\n        var hasMultiplePercents = nPercent > 1;\n\n        if(hasFlag('percent initial')) {\n            tx = Lib.formatPercent(cdi.begR);\n            if(hasMultiplePercents) tx += ' of initial';\n            text.push(tx);\n        }\n        if(hasFlag('percent previous')) {\n            tx = Lib.formatPercent(cdi.difR);\n            if(hasMultiplePercents) tx += ' of previous';\n            text.push(tx);\n        }\n        if(hasFlag('percent total')) {\n            tx = Lib.formatPercent(cdi.sumR);\n            if(hasMultiplePercents) tx += ' of total';\n            text.push(tx);\n        }\n    }\n\n    return text.join('<br>');\n}\n\nmodule.exports = {\n    plot: plot,\n    toMoveInsideBar: toMoveInsideBar\n};\n","'use strict';\n\nmodule.exports = function selectPoints(searchInfo, selectionTester) {\n    var cd = searchInfo.cd;\n    var xa = searchInfo.xaxis;\n    var ya = searchInfo.yaxis;\n    var trace = cd[0].trace;\n    var isFunnel = (trace.type === 'funnel');\n    var isHorizontal = (trace.orientation === 'h');\n    var selection = [];\n    var i;\n\n    if(selectionTester === false) {\n        // clear selection\n        for(i = 0; i < cd.length; i++) {\n            cd[i].selected = 0;\n        }\n    } else {\n        for(i = 0; i < cd.length; i++) {\n            var di = cd[i];\n            var ct = 'ct' in di ? di.ct : getCentroid(di, xa, ya, isHorizontal, isFunnel);\n\n            if(selectionTester.contains(ct, false, i, searchInfo)) {\n                selection.push({\n                    pointNumber: i,\n                    x: xa.c2d(di.x),\n                    y: ya.c2d(di.y)\n                });\n                di.selected = 1;\n            } else {\n                di.selected = 0;\n            }\n        }\n    }\n\n    return selection;\n};\n\nfunction getCentroid(d, xa, ya, isHorizontal, isFunnel) {\n    var x0 = xa.c2p(isHorizontal ? d.s0 : d.p0, true);\n    var x1 = xa.c2p(isHorizontal ? d.s1 : d.p1, true);\n    var y0 = ya.c2p(isHorizontal ? d.p0 : d.s0, true);\n    var y1 = ya.c2p(isHorizontal ? d.p1 : d.s1, true);\n\n    if(isFunnel) {\n        return [(x0 + x1) / 2, (y0 + y1) / 2];\n    } else {\n        if(isHorizontal) {\n            return [x1, (y0 + y1) / 2];\n        } else {\n            return [(x0 + x1) / 2, y1];\n        }\n    }\n}\n","'use strict';\n\nmodule.exports = Sieve;\n\nvar distinctVals = require('../../lib').distinctVals;\nvar BADNUM = require('../../constants/numerical').BADNUM;\n\n/**\n * Helper class to sieve data from traces into bins\n *\n * @class\n *\n * @param {Array} traces\n*   Array of calculated traces\n * @param {object} opts\n *  - @param {boolean} [sepNegVal]\n *      If true, then split data at the same position into a bar\n *      for positive values and another for negative values\n *  - @param {boolean} [overlapNoMerge]\n *     If true, then don't merge overlapping bars into a single bar\n */\nfunction Sieve(traces, opts) {\n    this.traces = traces;\n    this.sepNegVal = opts.sepNegVal;\n    this.overlapNoMerge = opts.overlapNoMerge;\n\n    // for single-bin histograms - see histogram/calc\n    var width1 = Infinity;\n\n    var positions = [];\n    for(var i = 0; i < traces.length; i++) {\n        var trace = traces[i];\n        for(var j = 0; j < trace.length; j++) {\n            var bar = trace[j];\n            if(bar.p !== BADNUM) positions.push(bar.p);\n        }\n        if(trace[0] && trace[0].width1) {\n            width1 = Math.min(trace[0].width1, width1);\n        }\n    }\n    this.positions = positions;\n\n    var dv = distinctVals(positions);\n\n    this.distinctPositions = dv.vals;\n    if(dv.vals.length === 1 && width1 !== Infinity) this.minDiff = width1;\n    else this.minDiff = Math.min(dv.minDiff, width1);\n\n    var type = (opts.posAxis || {}).type;\n    if(type === 'category' || type === 'multicategory') {\n        this.minDiff = 1;\n    }\n\n    this.binWidth = this.minDiff;\n\n    this.bins = {};\n}\n\n/**\n * Sieve datum\n *\n * @method\n * @param {number} position\n * @param {number} value\n * @returns {number} Previous bin value\n */\nSieve.prototype.put = function put(position, value) {\n    var label = this.getLabel(position, value);\n    var oldValue = this.bins[label] || 0;\n\n    this.bins[label] = oldValue + value;\n\n    return oldValue;\n};\n\n/**\n * Get current bin value for a given datum\n *\n * @method\n * @param {number} position  Position of datum\n * @param {number} [value]   Value of datum\n *                           (required if this.sepNegVal is true)\n * @returns {number} Current bin value\n */\nSieve.prototype.get = function get(position, value) {\n    var label = this.getLabel(position, value);\n    return this.bins[label] || 0;\n};\n\n/**\n * Get bin label for a given datum\n *\n * @method\n * @param {number} position  Position of datum\n * @param {number} [value]   Value of datum\n *                           (required if this.sepNegVal is true)\n * @returns {string} Bin label\n * (prefixed with a 'v' if value is negative and this.sepNegVal is\n * true; otherwise prefixed with '^')\n */\nSieve.prototype.getLabel = function getLabel(position, value) {\n    var prefix = (value < 0 && this.sepNegVal) ? 'v' : '^';\n    var label = (this.overlapNoMerge) ?\n        position :\n        Math.round(position / this.binWidth);\n    return prefix + label;\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar Color = require('../../components/color');\nvar Drawing = require('../../components/drawing');\nvar Lib = require('../../lib');\nvar Registry = require('../../registry');\n\nvar resizeText = require('./uniform_text').resizeText;\nvar attributes = require('./attributes');\nvar attributeTextFont = attributes.textfont;\nvar attributeInsideTextFont = attributes.insidetextfont;\nvar attributeOutsideTextFont = attributes.outsidetextfont;\nvar helpers = require('./helpers');\n\nfunction style(gd) {\n    var s = d3.select(gd).selectAll('g.barlayer').selectAll('g.trace');\n    resizeText(gd, s, 'bar');\n\n    var barcount = s.size();\n    var fullLayout = gd._fullLayout;\n\n    // trace styling\n    s.style('opacity', function(d) { return d[0].trace.opacity; })\n\n    // for gapless (either stacked or neighboring grouped) bars use\n    // crispEdges to turn off antialiasing so an artificial gap\n    // isn't introduced.\n    .each(function(d) {\n        if((fullLayout.barmode === 'stack' && barcount > 1) ||\n                (fullLayout.bargap === 0 &&\n                 fullLayout.bargroupgap === 0 &&\n                 !d[0].trace.marker.line.width)) {\n            d3.select(this).attr('shape-rendering', 'crispEdges');\n        }\n    });\n\n    s.selectAll('g.points').each(function(d) {\n        var sel = d3.select(this);\n        var trace = d[0].trace;\n        stylePoints(sel, trace, gd);\n    });\n\n    Registry.getComponentMethod('errorbars', 'style')(s);\n}\n\nfunction stylePoints(sel, trace, gd) {\n    Drawing.pointStyle(sel.selectAll('path'), trace, gd);\n    styleTextPoints(sel, trace, gd);\n}\n\nfunction styleTextPoints(sel, trace, gd) {\n    sel.selectAll('text').each(function(d) {\n        var tx = d3.select(this);\n        var font = Lib.ensureUniformFontSize(gd, determineFont(tx, d, trace, gd));\n\n        Drawing.font(tx, font);\n    });\n}\n\nfunction styleOnSelect(gd, cd, sel) {\n    var trace = cd[0].trace;\n\n    if(trace.selectedpoints) {\n        stylePointsInSelectionMode(sel, trace, gd);\n    } else {\n        stylePoints(sel, trace, gd);\n        Registry.getComponentMethod('errorbars', 'style')(sel);\n    }\n}\n\nfunction stylePointsInSelectionMode(s, trace, gd) {\n    Drawing.selectedPointStyle(s.selectAll('path'), trace);\n    styleTextInSelectionMode(s.selectAll('text'), trace, gd);\n}\n\nfunction styleTextInSelectionMode(txs, trace, gd) {\n    txs.each(function(d) {\n        var tx = d3.select(this);\n        var font;\n\n        if(d.selected) {\n            font = Lib.ensureUniformFontSize(gd, determineFont(tx, d, trace, gd));\n\n            var selectedFontColor = trace.selected.textfont && trace.selected.textfont.color;\n            if(selectedFontColor) {\n                font.color = selectedFontColor;\n            }\n\n            Drawing.font(tx, font);\n        } else {\n            Drawing.selectedTextStyle(tx, trace);\n        }\n    });\n}\n\nfunction determineFont(tx, d, trace, gd) {\n    var layoutFont = gd._fullLayout.font;\n    var textFont = trace.textfont;\n\n    if(tx.classed('bartext-inside')) {\n        var barColor = getBarColor(d, trace);\n        textFont = getInsideTextFont(trace, d.i, layoutFont, barColor);\n    } else if(tx.classed('bartext-outside')) {\n        textFont = getOutsideTextFont(trace, d.i, layoutFont);\n    }\n\n    return textFont;\n}\n\nfunction getTextFont(trace, index, defaultValue) {\n    return getFontValue(\n      attributeTextFont, trace.textfont, index, defaultValue);\n}\n\nfunction getInsideTextFont(trace, index, layoutFont, barColor) {\n    var defaultFont = getTextFont(trace, index, layoutFont);\n\n    var wouldFallBackToLayoutFont =\n      (trace._input.textfont === undefined || trace._input.textfont.color === undefined) ||\n      (Array.isArray(trace.textfont.color) && trace.textfont.color[index] === undefined);\n    if(wouldFallBackToLayoutFont) {\n        defaultFont = {\n            color: Color.contrast(barColor),\n            family: defaultFont.family,\n            size: defaultFont.size\n        };\n    }\n\n    return getFontValue(\n      attributeInsideTextFont, trace.insidetextfont, index, defaultFont);\n}\n\nfunction getOutsideTextFont(trace, index, layoutFont) {\n    var defaultFont = getTextFont(trace, index, layoutFont);\n    return getFontValue(\n      attributeOutsideTextFont, trace.outsidetextfont, index, defaultFont);\n}\n\nfunction getFontValue(attributeDefinition, attributeValue, index, defaultValue) {\n    attributeValue = attributeValue || {};\n\n    var familyValue = helpers.getValue(attributeValue.family, index);\n    var sizeValue = helpers.getValue(attributeValue.size, index);\n    var colorValue = helpers.getValue(attributeValue.color, index);\n\n    return {\n        family: helpers.coerceString(\n          attributeDefinition.family, familyValue, defaultValue.family),\n        size: helpers.coerceNumber(\n          attributeDefinition.size, sizeValue, defaultValue.size),\n        color: helpers.coerceColor(\n          attributeDefinition.color, colorValue, defaultValue.color)\n    };\n}\n\nfunction getBarColor(cd, trace) {\n    if(trace.type === 'waterfall') {\n        return trace[cd.dir].marker.color;\n    }\n    return cd.mcc || cd.mc || trace.marker.color;\n}\n\nmodule.exports = {\n    style: style,\n    styleTextPoints: styleTextPoints,\n    styleOnSelect: styleOnSelect,\n    getInsideTextFont: getInsideTextFont,\n    getOutsideTextFont: getOutsideTextFont,\n    getBarColor: getBarColor,\n    resizeText: resizeText\n};\n","'use strict';\n\nvar Color = require('../../components/color');\nvar hasColorscale = require('../../components/colorscale/helpers').hasColorscale;\nvar colorscaleDefaults = require('../../components/colorscale/defaults');\nvar coercePattern = require('../../lib').coercePattern;\n\nmodule.exports = function handleStyleDefaults(traceIn, traceOut, coerce, defaultColor, layout) {\n    var markerColor = coerce('marker.color', defaultColor);\n    var hasMarkerColorscale = hasColorscale(traceIn, 'marker');\n    if(hasMarkerColorscale) {\n        colorscaleDefaults(\n            traceIn, traceOut, layout, coerce, {prefix: 'marker.', cLetter: 'c'}\n        );\n    }\n\n    coerce('marker.line.color', Color.defaultLine);\n\n    if(hasColorscale(traceIn, 'marker.line')) {\n        colorscaleDefaults(\n            traceIn, traceOut, layout, coerce, {prefix: 'marker.line.', cLetter: 'c'}\n        );\n    }\n\n    coerce('marker.line.width');\n    coerce('marker.opacity');\n    coercePattern(coerce, 'marker.pattern', markerColor, hasMarkerColorscale);\n    coerce('selected.marker.color');\n    coerce('unselected.marker.color');\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar Lib = require('../../lib');\n\nfunction resizeText(gd, gTrace, traceType) {\n    var fullLayout = gd._fullLayout;\n    var minSize = fullLayout['_' + traceType + 'Text_minsize'];\n    if(minSize) {\n        var shouldHide = fullLayout.uniformtext.mode === 'hide';\n\n        var selector;\n        switch(traceType) {\n            case 'funnelarea' :\n            case 'pie' :\n            case 'sunburst' :\n                selector = 'g.slice';\n                break;\n            case 'treemap' :\n            case 'icicle' :\n                selector = 'g.slice, g.pathbar';\n                break;\n            default :\n                selector = 'g.points > g.point';\n        }\n\n        gTrace.selectAll(selector).each(function(d) {\n            var transform = d.transform;\n            if(transform) {\n                transform.scale = (shouldHide && transform.hide) ? 0 : minSize / transform.fontSize;\n\n                var el = d3.select(this).select('text');\n                el.attr('transform', Lib.getTextTransform(transform));\n            }\n        });\n    }\n}\n\nfunction recordMinTextSize(\n    traceType, // in\n    transform, // inout\n    fullLayout // inout\n) {\n    if(fullLayout.uniformtext.mode) {\n        var minKey = getMinKey(traceType);\n        var minSize = fullLayout.uniformtext.minsize;\n        var size = transform.scale * transform.fontSize;\n\n        transform.hide = size < minSize;\n\n        fullLayout[minKey] = fullLayout[minKey] || Infinity;\n        if(!transform.hide) {\n            fullLayout[minKey] = Math.min(\n                fullLayout[minKey],\n                Math.max(size, minSize)\n            );\n        }\n    }\n}\n\nfunction clearMinTextSize(\n    traceType, // in\n    fullLayout // inout\n) {\n    var minKey = getMinKey(traceType);\n    fullLayout[minKey] = undefined;\n}\n\nfunction getMinKey(traceType) {\n    return '_' + traceType + 'Text_minsize';\n}\n\nmodule.exports = {\n    recordMinTextSize: recordMinTextSize,\n    clearMinTextSize: clearMinTextSize,\n    resizeText: resizeText\n};\n","'use strict';\n\nvar scatterAttrs = require('../scatter/attributes');\nvar barAttrs = require('../bar/attributes');\nvar colorAttrs = require('../../components/color/attributes');\nvar axisHoverFormat = require('../../plots/cartesian/axis_format_attributes').axisHoverFormat;\nvar hovertemplateAttrs = require('../../plots/template_attributes').hovertemplateAttrs;\nvar extendFlat = require('../../lib/extend').extendFlat;\n\nvar scatterMarkerAttrs = scatterAttrs.marker;\nvar scatterMarkerLineAttrs = scatterMarkerAttrs.line;\n\nmodule.exports = {\n    y: {\n        valType: 'data_array',\n        editType: 'calc+clearAxisTypes',\n        description: [\n            'Sets the y sample data or coordinates.',\n            'See overview for more info.'\n        ].join(' ')\n    },\n    x: {\n        valType: 'data_array',\n        editType: 'calc+clearAxisTypes',\n        description: [\n            'Sets the x sample data or coordinates.',\n            'See overview for more info.'\n        ].join(' ')\n    },\n    x0: {\n        valType: 'any',\n        editType: 'calc+clearAxisTypes',\n        description: [\n            'Sets the x coordinate for single-box traces',\n            'or the starting coordinate for multi-box traces',\n            'set using q1/median/q3.',\n            'See overview for more info.'\n        ].join(' ')\n    },\n    y0: {\n        valType: 'any',\n        editType: 'calc+clearAxisTypes',\n        description: [\n            'Sets the y coordinate for single-box traces',\n            'or the starting coordinate for multi-box traces',\n            'set using q1/median/q3.',\n            'See overview for more info.'\n        ].join(' ')\n    },\n\n    dx: {\n        valType: 'number',\n        editType: 'calc',\n        description: [\n            'Sets the x coordinate step for multi-box traces',\n            'set using q1/median/q3.'\n        ].join(' ')\n    },\n    dy: {\n        valType: 'number',\n        editType: 'calc',\n        description: [\n            'Sets the y coordinate step for multi-box traces',\n            'set using q1/median/q3.'\n        ].join(' ')\n    },\n\n    xperiod: scatterAttrs.xperiod,\n    yperiod: scatterAttrs.yperiod,\n    xperiod0: scatterAttrs.xperiod0,\n    yperiod0: scatterAttrs.yperiod0,\n    xperiodalignment: scatterAttrs.xperiodalignment,\n    yperiodalignment: scatterAttrs.yperiodalignment,\n    xhoverformat: axisHoverFormat('x'),\n    yhoverformat: axisHoverFormat('y'),\n\n    name: {\n        valType: 'string',\n        editType: 'calc+clearAxisTypes',\n        description: [\n            'Sets the trace name.',\n            'The trace name appear as the legend item and on hover.',\n            'For box traces, the name will also be used for the position',\n            'coordinate, if `x` and `x0` (`y` and `y0` if horizontal) are',\n            'missing and the position axis is categorical'\n        ].join(' ')\n    },\n\n    q1: {\n        valType: 'data_array',\n        editType: 'calc+clearAxisTypes',\n        description: [\n            'Sets the Quartile 1 values.',\n            'There should be as many items as the number of boxes desired.',\n        ].join(' ')\n    },\n    median: {\n        valType: 'data_array',\n        editType: 'calc+clearAxisTypes',\n        description: [\n            'Sets the median values.',\n            'There should be as many items as the number of boxes desired.',\n        ].join(' ')\n    },\n    q3: {\n        valType: 'data_array',\n        editType: 'calc+clearAxisTypes',\n        description: [\n            'Sets the Quartile 3 values.',\n            'There should be as many items as the number of boxes desired.',\n        ].join(' ')\n    },\n    lowerfence: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: [\n            'Sets the lower fence values.',\n            'There should be as many items as the number of boxes desired.',\n            'This attribute has effect only under the q1/median/q3 signature.',\n            'If `lowerfence` is not provided but a sample (in `y` or `x`) is set,',\n            'we compute the lower as the last sample point below 1.5 times the IQR.'\n        ].join(' ')\n    },\n    upperfence: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: [\n            'Sets the upper fence values.',\n            'There should be as many items as the number of boxes desired.',\n            'This attribute has effect only under the q1/median/q3 signature.',\n            'If `upperfence` is not provided but a sample (in `y` or `x`) is set,',\n            'we compute the lower as the last sample point above 1.5 times the IQR.'\n        ].join(' ')\n    },\n\n    notched: {\n        valType: 'boolean',\n        editType: 'calc',\n        description: [\n            'Determines whether or not notches are drawn.',\n            'Notches displays a confidence interval around the median.',\n            'We compute the confidence interval as median +/- 1.57 * IQR / sqrt(N),',\n            'where IQR is the interquartile range and N is the sample size.',\n            'If two boxes\\' notches do not overlap there is 95% confidence their medians differ.',\n            'See https://sites.google.com/site/davidsstatistics/home/notched-box-plots for more info.',\n            'Defaults to *false* unless `notchwidth` or `notchspan` is set.'\n        ].join(' ')\n    },\n    notchwidth: {\n        valType: 'number',\n        min: 0,\n        max: 0.5,\n        dflt: 0.25,\n        editType: 'calc',\n        description: [\n            'Sets the width of the notches relative to',\n            'the box\\' width.',\n            'For example, with 0, the notches are as wide as the box(es).'\n        ].join(' ')\n    },\n    notchspan: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: [\n            'Sets the notch span from the boxes\\' `median` values.',\n            'There should be as many items as the number of boxes desired.',\n            'This attribute has effect only under the q1/median/q3 signature.',\n            'If `notchspan` is not provided but a sample (in `y` or `x`) is set,',\n            'we compute it as 1.57 * IQR / sqrt(N),',\n            'where N is the sample size.'\n        ].join(' ')\n    },\n\n    // TODO\n    // maybe add\n    // - loweroutlierbound / upperoutlierbound\n    // - lowersuspectedoutlierbound / uppersuspectedoutlierbound\n\n    boxpoints: {\n        valType: 'enumerated',\n        values: ['all', 'outliers', 'suspectedoutliers', false],\n        editType: 'calc',\n        description: [\n            'If *outliers*, only the sample points lying outside the whiskers',\n            'are shown',\n            'If *suspectedoutliers*, the outlier points are shown and',\n            'points either less than 4*Q1-3*Q3 or greater than 4*Q3-3*Q1',\n            'are highlighted (see `outliercolor`)',\n            'If *all*, all sample points are shown',\n            'If *false*, only the box(es) are shown with no sample points',\n            'Defaults to *suspectedoutliers* when `marker.outliercolor` or',\n            '`marker.line.outliercolor` is set.',\n            'Defaults to *all* under the q1/median/q3 signature.',\n            'Otherwise defaults to *outliers*.',\n        ].join(' ')\n    },\n    jitter: {\n        valType: 'number',\n        min: 0,\n        max: 1,\n        editType: 'calc',\n        description: [\n            'Sets the amount of jitter in the sample points drawn.',\n            'If *0*, the sample points align along the distribution axis.',\n            'If *1*, the sample points are drawn in a random jitter of width',\n            'equal to the width of the box(es).'\n        ].join(' ')\n    },\n    pointpos: {\n        valType: 'number',\n        min: -2,\n        max: 2,\n        editType: 'calc',\n        description: [\n            'Sets the position of the sample points in relation to the box(es).',\n            'If *0*, the sample points are places over the center of the box(es).',\n            'Positive (negative) values correspond to positions to the',\n            'right (left) for vertical boxes and above (below) for horizontal boxes'\n        ].join(' ')\n    },\n\n    boxmean: {\n        valType: 'enumerated',\n        values: [true, 'sd', false],\n        editType: 'calc',\n        description: [\n            'If *true*, the mean of the box(es)\\' underlying distribution is',\n            'drawn as a dashed line inside the box(es).',\n            'If *sd* the standard deviation is also drawn.',\n            'Defaults to *true* when `mean` is set.',\n            'Defaults to *sd* when `sd` is set',\n            'Otherwise defaults to *false*.'\n        ].join(' ')\n    },\n    mean: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: [\n            'Sets the mean values.',\n            'There should be as many items as the number of boxes desired.',\n            'This attribute has effect only under the q1/median/q3 signature.',\n            'If `mean` is not provided but a sample (in `y` or `x`) is set,',\n            'we compute the mean for each box using the sample values.'\n        ].join(' ')\n    },\n    sd: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: [\n            'Sets the standard deviation values.',\n            'There should be as many items as the number of boxes desired.',\n            'This attribute has effect only under the q1/median/q3 signature.',\n            'If `sd` is not provided but a sample (in `y` or `x`) is set,',\n            'we compute the standard deviation for each box using the sample values.'\n        ].join(' ')\n    },\n\n    orientation: {\n        valType: 'enumerated',\n        values: ['v', 'h'],\n        editType: 'calc+clearAxisTypes',\n        description: [\n            'Sets the orientation of the box(es).',\n            'If *v* (*h*), the distribution is visualized along',\n            'the vertical (horizontal).'\n        ].join(' ')\n    },\n\n    quartilemethod: {\n        valType: 'enumerated',\n        values: ['linear', 'exclusive', 'inclusive'],\n        dflt: 'linear',\n        editType: 'calc',\n        description: [\n            'Sets the method used to compute the sample\\'s Q1 and Q3 quartiles.',\n\n            'The *linear* method uses the 25th percentile for Q1 and 75th percentile for Q3',\n            'as computed using method #10 (listed on http://www.amstat.org/publications/jse/v14n3/langford.html).',\n\n            'The *exclusive* method uses the median to divide the ordered dataset into two halves',\n            'if the sample is odd, it does not include the median in either half -',\n            'Q1 is then the median of the lower half and',\n            'Q3 the median of the upper half.',\n\n            'The *inclusive* method also uses the median to divide the ordered dataset into two halves',\n            'but if the sample is odd, it includes the median in both halves -',\n            'Q1 is then the median of the lower half and',\n            'Q3 the median of the upper half.'\n        ].join(' ')\n    },\n\n    width: {\n        valType: 'number',\n        min: 0,\n        dflt: 0,\n        editType: 'calc',\n        description: [\n            'Sets the width of the box in data coordinate',\n            'If *0* (default value) the width is automatically selected based on the positions',\n            'of other box traces in the same subplot.'\n        ].join(' ')\n    },\n\n    marker: {\n        outliercolor: {\n            valType: 'color',\n            dflt: 'rgba(0, 0, 0, 0)',\n            editType: 'style',\n            description: 'Sets the color of the outlier sample points.'\n        },\n        symbol: extendFlat({}, scatterMarkerAttrs.symbol,\n            {arrayOk: false, editType: 'plot'}),\n        opacity: extendFlat({}, scatterMarkerAttrs.opacity,\n            {arrayOk: false, dflt: 1, editType: 'style'}),\n        size: extendFlat({}, scatterMarkerAttrs.size,\n            {arrayOk: false, editType: 'calc'}),\n        color: extendFlat({}, scatterMarkerAttrs.color,\n            {arrayOk: false, editType: 'style'}),\n        line: {\n            color: extendFlat({}, scatterMarkerLineAttrs.color,\n                {arrayOk: false, dflt: colorAttrs.defaultLine, editType: 'style'}\n            ),\n            width: extendFlat({}, scatterMarkerLineAttrs.width,\n                {arrayOk: false, dflt: 0, editType: 'style'}\n            ),\n            outliercolor: {\n                valType: 'color',\n                editType: 'style',\n                description: [\n                    'Sets the border line color of the outlier sample points.',\n                    'Defaults to marker.color'\n                ].join(' ')\n            },\n            outlierwidth: {\n                valType: 'number',\n                min: 0,\n                dflt: 1,\n                editType: 'style',\n                description: [\n                    'Sets the border line width (in px) of the outlier sample points.'\n                ].join(' ')\n            },\n            editType: 'style'\n        },\n        editType: 'plot'\n    },\n\n    line: {\n        color: {\n            valType: 'color',\n            editType: 'style',\n            description: 'Sets the color of line bounding the box(es).'\n        },\n        width: {\n            valType: 'number',\n            min: 0,\n            dflt: 2,\n            editType: 'style',\n            description: 'Sets the width (in px) of line bounding the box(es).'\n        },\n        editType: 'plot'\n    },\n\n    fillcolor: scatterAttrs.fillcolor,\n\n    whiskerwidth: {\n        valType: 'number',\n        min: 0,\n        max: 1,\n        dflt: 0.5,\n        editType: 'calc',\n        description: [\n            'Sets the width of the whiskers relative to',\n            'the box\\' width.',\n            'For example, with 1, the whiskers are as wide as the box(es).'\n        ].join(' ')\n    },\n\n    offsetgroup: barAttrs.offsetgroup,\n    alignmentgroup: barAttrs.alignmentgroup,\n\n    selected: {\n        marker: scatterAttrs.selected.marker,\n        editType: 'style'\n    },\n    unselected: {\n        marker: scatterAttrs.unselected.marker,\n        editType: 'style'\n    },\n\n    text: extendFlat({}, scatterAttrs.text, {\n        description: [\n            'Sets the text elements associated with each sample value.',\n            'If a single string, the same string appears over',\n            'all the data points.',\n            'If an array of string, the items are mapped in order to the',\n            'this trace\\'s (x,y) coordinates.',\n            'To be seen, trace `hoverinfo` must contain a *text* flag.'\n        ].join(' ')\n    }),\n    hovertext: extendFlat({}, scatterAttrs.hovertext, {\n        description: 'Same as `text`.'\n    }),\n    hovertemplate: hovertemplateAttrs({\n        description: [\n            'N.B. This only has an effect when hovering on points.'\n        ].join(' ')\n    }),\n\n    hoveron: {\n        valType: 'flaglist',\n        flags: ['boxes', 'points'],\n        dflt: 'boxes+points',\n        editType: 'style',\n        description: [\n            'Do the hover effects highlight individual boxes ',\n            'or sample points or both?'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\nvar Axes = require('../../plots/cartesian/axes');\nvar alignPeriod = require('../../plots/cartesian/align_period');\nvar Lib = require('../../lib');\n\nvar BADNUM = require('../../constants/numerical').BADNUM;\nvar _ = Lib._;\n\nmodule.exports = function calc(gd, trace) {\n    var fullLayout = gd._fullLayout;\n    var xa = Axes.getFromId(gd, trace.xaxis || 'x');\n    var ya = Axes.getFromId(gd, trace.yaxis || 'y');\n    var cd = [];\n\n    // N.B. violin reuses same Box.calc\n    var numKey = trace.type === 'violin' ? '_numViolins' : '_numBoxes';\n\n    var i, j;\n    var valAxis, valLetter;\n    var posAxis, posLetter;\n\n    var hasPeriod;\n    if(trace.orientation === 'h') {\n        valAxis = xa;\n        valLetter = 'x';\n        posAxis = ya;\n        posLetter = 'y';\n        hasPeriod = !!trace.yperiodalignment;\n    } else {\n        valAxis = ya;\n        valLetter = 'y';\n        posAxis = xa;\n        posLetter = 'x';\n        hasPeriod = !!trace.xperiodalignment;\n    }\n\n    var allPosArrays = getPosArrays(trace, posLetter, posAxis, fullLayout[numKey]);\n    var posArray = allPosArrays[0];\n    var origPos = allPosArrays[1];\n    var dv = Lib.distinctVals(posArray, posAxis);\n    var posDistinct = dv.vals;\n    var dPos = dv.minDiff / 2;\n\n    // item in trace calcdata\n    var cdi;\n    // array of {v: v, i, i} sample pts\n    var pts;\n    // values of the `pts` array of objects\n    var boxVals;\n    // length of sample\n    var N;\n    // single sample point\n    var pt;\n    // single sample value\n    var v;\n\n    // filter function for outlier pts\n    // outlier definition based on http://www.physics.csbsju.edu/stats/box2.html\n    var ptFilterFn = (trace.boxpoints || trace.points) === 'all' ?\n        Lib.identity :\n        function(pt) { return (pt.v < cdi.lf || pt.v > cdi.uf); };\n\n    if(trace._hasPreCompStats) {\n        var valArrayRaw = trace[valLetter];\n        var d2c = function(k) { return valAxis.d2c((trace[k] || [])[i]); };\n        var minVal = Infinity;\n        var maxVal = -Infinity;\n\n        for(i = 0; i < trace._length; i++) {\n            var posi = posArray[i];\n            if(!isNumeric(posi)) continue;\n\n            cdi = {};\n            cdi.pos = cdi[posLetter] = posi;\n            if(hasPeriod && origPos) {\n                cdi.orig_p = origPos[i]; // used by hover\n            }\n\n            cdi.q1 = d2c('q1');\n            cdi.med = d2c('median');\n            cdi.q3 = d2c('q3');\n\n            pts = [];\n            if(valArrayRaw && Lib.isArrayOrTypedArray(valArrayRaw[i])) {\n                for(j = 0; j < valArrayRaw[i].length; j++) {\n                    v = valAxis.d2c(valArrayRaw[i][j]);\n                    if(v !== BADNUM) {\n                        pt = {v: v, i: [i, j]};\n                        arraysToCalcdata(pt, trace, [i, j]);\n                        pts.push(pt);\n                    }\n                }\n            }\n            cdi.pts = pts.sort(sortByVal);\n            boxVals = cdi[valLetter] = pts.map(extractVal);\n            N = boxVals.length;\n\n            if(cdi.med !== BADNUM && cdi.q1 !== BADNUM && cdi.q3 !== BADNUM &&\n                cdi.med >= cdi.q1 && cdi.q3 >= cdi.med\n            ) {\n                var lf = d2c('lowerfence');\n                cdi.lf = (lf !== BADNUM && lf <= cdi.q1) ?\n                    lf :\n                    computeLowerFence(cdi, boxVals, N);\n\n                var uf = d2c('upperfence');\n                cdi.uf = (uf !== BADNUM && uf >= cdi.q3) ?\n                    uf :\n                    computeUpperFence(cdi, boxVals, N);\n\n                var mean = d2c('mean');\n                cdi.mean = (mean !== BADNUM) ?\n                    mean :\n                    (N ? Lib.mean(boxVals, N) : (cdi.q1 + cdi.q3) / 2);\n\n                var sd = d2c('sd');\n                cdi.sd = (mean !== BADNUM && sd >= 0) ?\n                    sd :\n                    (N ? Lib.stdev(boxVals, N, cdi.mean) : (cdi.q3 - cdi.q1));\n\n                cdi.lo = computeLowerOutlierBound(cdi);\n                cdi.uo = computeUpperOutlierBound(cdi);\n\n                var ns = d2c('notchspan');\n                ns = (ns !== BADNUM && ns > 0) ? ns : computeNotchSpan(cdi, N);\n                cdi.ln = cdi.med - ns;\n                cdi.un = cdi.med + ns;\n\n                var imin = cdi.lf;\n                var imax = cdi.uf;\n                if(trace.boxpoints && boxVals.length) {\n                    imin = Math.min(imin, boxVals[0]);\n                    imax = Math.max(imax, boxVals[N - 1]);\n                }\n                if(trace.notched) {\n                    imin = Math.min(imin, cdi.ln);\n                    imax = Math.max(imax, cdi.un);\n                }\n                cdi.min = imin;\n                cdi.max = imax;\n            } else {\n                Lib.warn([\n                    'Invalid input - make sure that q1 <= median <= q3',\n                    'q1 = ' + cdi.q1,\n                    'median = ' + cdi.med,\n                    'q3 = ' + cdi.q3\n                ].join('\\n'));\n\n                var v0;\n                if(cdi.med !== BADNUM) {\n                    v0 = cdi.med;\n                } else if(cdi.q1 !== BADNUM) {\n                    if(cdi.q3 !== BADNUM) v0 = (cdi.q1 + cdi.q3) / 2;\n                    else v0 = cdi.q1;\n                } else if(cdi.q3 !== BADNUM) {\n                    v0 = cdi.q3;\n                } else {\n                    v0 = 0;\n                }\n\n                // draw box as line segment\n                cdi.med = v0;\n                cdi.q1 = cdi.q3 = v0;\n                cdi.lf = cdi.uf = v0;\n                cdi.mean = cdi.sd = v0;\n                cdi.ln = cdi.un = v0;\n                cdi.min = cdi.max = v0;\n            }\n\n            minVal = Math.min(minVal, cdi.min);\n            maxVal = Math.max(maxVal, cdi.max);\n\n            cdi.pts2 = pts.filter(ptFilterFn);\n\n            cd.push(cdi);\n        }\n\n        trace._extremes[valAxis._id] = Axes.findExtremes(valAxis,\n            [minVal, maxVal],\n            {padded: true}\n        );\n    } else {\n        var valArray = valAxis.makeCalcdata(trace, valLetter);\n        var posBins = makeBins(posDistinct, dPos);\n        var pLen = posDistinct.length;\n        var ptsPerBin = initNestedArray(pLen);\n\n        // bin pts info per position bins\n        for(i = 0; i < trace._length; i++) {\n            v = valArray[i];\n            if(!isNumeric(v)) continue;\n\n            var n = Lib.findBin(posArray[i], posBins);\n            if(n >= 0 && n < pLen) {\n                pt = {v: v, i: i};\n                arraysToCalcdata(pt, trace, i);\n                ptsPerBin[n].push(pt);\n            }\n        }\n\n        var minLowerNotch = Infinity;\n        var maxUpperNotch = -Infinity;\n\n        var quartilemethod = trace.quartilemethod;\n        var usesExclusive = quartilemethod === 'exclusive';\n        var usesInclusive = quartilemethod === 'inclusive';\n\n        // build calcdata trace items, one item per distinct position\n        for(i = 0; i < pLen; i++) {\n            if(ptsPerBin[i].length > 0) {\n                cdi = {};\n                cdi.pos = cdi[posLetter] = posDistinct[i];\n\n                pts = cdi.pts = ptsPerBin[i].sort(sortByVal);\n                boxVals = cdi[valLetter] = pts.map(extractVal);\n                N = boxVals.length;\n\n                cdi.min = boxVals[0];\n                cdi.max = boxVals[N - 1];\n                cdi.mean = Lib.mean(boxVals, N);\n                cdi.sd = Lib.stdev(boxVals, N, cdi.mean);\n                cdi.med = Lib.interp(boxVals, 0.5);\n\n                if((N % 2) && (usesExclusive || usesInclusive)) {\n                    var lower;\n                    var upper;\n\n                    if(usesExclusive) {\n                        // do NOT include the median in either half\n                        lower = boxVals.slice(0, N / 2);\n                        upper = boxVals.slice(N / 2 + 1);\n                    } else if(usesInclusive) {\n                        // include the median in either half\n                        lower = boxVals.slice(0, N / 2 + 1);\n                        upper = boxVals.slice(N / 2);\n                    }\n\n                    cdi.q1 = Lib.interp(lower, 0.5);\n                    cdi.q3 = Lib.interp(upper, 0.5);\n                } else {\n                    cdi.q1 = Lib.interp(boxVals, 0.25);\n                    cdi.q3 = Lib.interp(boxVals, 0.75);\n                }\n\n                // lower and upper fences\n                cdi.lf = computeLowerFence(cdi, boxVals, N);\n                cdi.uf = computeUpperFence(cdi, boxVals, N);\n\n                // lower and upper outliers bounds\n                cdi.lo = computeLowerOutlierBound(cdi);\n                cdi.uo = computeUpperOutlierBound(cdi);\n\n                // lower and upper notches\n                var mci = computeNotchSpan(cdi, N);\n                cdi.ln = cdi.med - mci;\n                cdi.un = cdi.med + mci;\n                minLowerNotch = Math.min(minLowerNotch, cdi.ln);\n                maxUpperNotch = Math.max(maxUpperNotch, cdi.un);\n\n                cdi.pts2 = pts.filter(ptFilterFn);\n\n                cd.push(cdi);\n            }\n        }\n\n        trace._extremes[valAxis._id] = Axes.findExtremes(valAxis,\n            trace.notched ? valArray.concat([minLowerNotch, maxUpperNotch]) : valArray,\n            {padded: true}\n        );\n    }\n\n    calcSelection(cd, trace);\n\n    if(cd.length > 0) {\n        cd[0].t = {\n            num: fullLayout[numKey],\n            dPos: dPos,\n            posLetter: posLetter,\n            valLetter: valLetter,\n            labels: {\n                med: _(gd, 'median:'),\n                min: _(gd, 'min:'),\n                q1: _(gd, 'q1:'),\n                q3: _(gd, 'q3:'),\n                max: _(gd, 'max:'),\n                mean: trace.boxmean === 'sd' ? _(gd, 'mean  :') : _(gd, 'mean:'),\n                lf: _(gd, 'lower fence:'),\n                uf: _(gd, 'upper fence:')\n            }\n        };\n\n        fullLayout[numKey]++;\n        return cd;\n    } else {\n        return [{t: {empty: true}}];\n    }\n};\n\n// In vertical (horizontal) box plots:\n// if no x (y) data, use x0 (y0), or name\n// so if you want one box\n// per trace, set x0 (y0) to the x (y) value or category for this trace\n// (or set x (y) to a constant array matching y (x))\nfunction getPosArrays(trace, posLetter, posAxis, num) {\n    var hasPosArray = posLetter in trace;\n    var hasPos0 = posLetter + '0' in trace;\n    var hasPosStep = 'd' + posLetter in trace;\n\n    if(hasPosArray || (hasPos0 && hasPosStep)) {\n        var origPos = posAxis.makeCalcdata(trace, posLetter);\n        var pos = alignPeriod(trace, posAxis, posLetter, origPos);\n        return [pos, origPos];\n    }\n\n    var pos0;\n    if(hasPos0) {\n        pos0 = trace[posLetter + '0'];\n    } else if('name' in trace && (\n        posAxis.type === 'category' || (\n            isNumeric(trace.name) &&\n            ['linear', 'log'].indexOf(posAxis.type) !== -1\n        ) || (\n            Lib.isDateTime(trace.name) &&\n            posAxis.type === 'date'\n        )\n    )) {\n        pos0 = trace.name;\n    } else {\n        pos0 = num;\n    }\n\n    var pos0c = posAxis.type === 'multicategory' ?\n        posAxis.r2c_just_indices(pos0) :\n        posAxis.d2c(pos0, 0, trace[posLetter + 'calendar']);\n\n    var len = trace._length;\n    var out = new Array(len);\n    for(var i = 0; i < len; i++) out[i] = pos0c;\n\n    return [out];\n}\n\nfunction makeBins(x, dx) {\n    var len = x.length;\n    var bins = new Array(len + 1);\n\n    for(var i = 0; i < len; i++) {\n        bins[i] = x[i] - dx;\n    }\n    bins[len] = x[len - 1] + dx;\n\n    return bins;\n}\n\nfunction initNestedArray(len) {\n    var arr = new Array(len);\n    for(var i = 0; i < len; i++) {\n        arr[i] = [];\n    }\n    return arr;\n}\n\nvar TRACE_TO_CALC = {\n    text: 'tx',\n    hovertext: 'htx'\n};\n\nfunction arraysToCalcdata(pt, trace, ptNumber) {\n    for(var k in TRACE_TO_CALC) {\n        if(Lib.isArrayOrTypedArray(trace[k])) {\n            if(Array.isArray(ptNumber)) {\n                if(Lib.isArrayOrTypedArray(trace[k][ptNumber[0]])) {\n                    pt[TRACE_TO_CALC[k]] = trace[k][ptNumber[0]][ptNumber[1]];\n                }\n            } else {\n                pt[TRACE_TO_CALC[k]] = trace[k][ptNumber];\n            }\n        }\n    }\n}\n\nfunction calcSelection(cd, trace) {\n    if(Lib.isArrayOrTypedArray(trace.selectedpoints)) {\n        for(var i = 0; i < cd.length; i++) {\n            var pts = cd[i].pts || [];\n            var ptNumber2cdIndex = {};\n\n            for(var j = 0; j < pts.length; j++) {\n                ptNumber2cdIndex[pts[j].i] = j;\n            }\n\n            Lib.tagSelected(pts, trace, ptNumber2cdIndex);\n        }\n    }\n}\n\nfunction sortByVal(a, b) { return a.v - b.v; }\n\nfunction extractVal(o) { return o.v; }\n\n// last point below 1.5 * IQR\nfunction computeLowerFence(cdi, boxVals, N) {\n    if(N === 0) return cdi.q1;\n    return Math.min(\n        cdi.q1,\n        boxVals[Math.min(\n            Lib.findBin(2.5 * cdi.q1 - 1.5 * cdi.q3, boxVals, true) + 1,\n            N - 1\n        )]\n    );\n}\n\n// last point above 1.5 * IQR\nfunction computeUpperFence(cdi, boxVals, N) {\n    if(N === 0) return cdi.q3;\n    return Math.max(\n        cdi.q3,\n        boxVals[Math.max(\n            Lib.findBin(2.5 * cdi.q3 - 1.5 * cdi.q1, boxVals),\n            0\n        )]\n    );\n}\n\n// 3 IQR below (don't clip to max/min,\n// this is only for discriminating suspected & far outliers)\nfunction computeLowerOutlierBound(cdi) {\n    return 4 * cdi.q1 - 3 * cdi.q3;\n}\n\n// 3 IQR above (don't clip to max/min,\n// this is only for discriminating suspected & far outliers)\nfunction computeUpperOutlierBound(cdi) {\n    return 4 * cdi.q3 - 3 * cdi.q1;\n}\n\n// 95% confidence intervals for median\nfunction computeNotchSpan(cdi, N) {\n    if(N === 0) return 0;\n    return 1.57 * (cdi.q3 - cdi.q1) / Math.sqrt(N);\n}\n","'use strict';\n\nvar Axes = require('../../plots/cartesian/axes');\nvar Lib = require('../../lib');\nvar getAxisGroup = require('../../plots/cartesian/constraints').getAxisGroup;\n\nvar orientations = ['v', 'h'];\n\nfunction crossTraceCalc(gd, plotinfo) {\n    var calcdata = gd.calcdata;\n    var xa = plotinfo.xaxis;\n    var ya = plotinfo.yaxis;\n\n    for(var i = 0; i < orientations.length; i++) {\n        var orientation = orientations[i];\n        var posAxis = orientation === 'h' ? ya : xa;\n        var boxList = [];\n\n        // make list of boxes / candlesticks\n        // For backward compatibility, candlesticks are treated as if they *are* box traces here\n        for(var j = 0; j < calcdata.length; j++) {\n            var cd = calcdata[j];\n            var t = cd[0].t;\n            var trace = cd[0].trace;\n\n            if(trace.visible === true &&\n                    (trace.type === 'box' || trace.type === 'candlestick') &&\n                    !t.empty &&\n                    (trace.orientation || 'v') === orientation &&\n                    trace.xaxis === xa._id &&\n                    trace.yaxis === ya._id\n              ) {\n                boxList.push(j);\n            }\n        }\n\n        setPositionOffset('box', gd, boxList, posAxis);\n    }\n}\n\nfunction setPositionOffset(traceType, gd, boxList, posAxis) {\n    var calcdata = gd.calcdata;\n    var fullLayout = gd._fullLayout;\n    var axId = posAxis._id;\n    var axLetter = axId.charAt(0);\n\n    var i, j, calcTrace;\n    var pointList = [];\n    var shownPts = 0;\n\n    // make list of box points\n    for(i = 0; i < boxList.length; i++) {\n        calcTrace = calcdata[boxList[i]];\n        for(j = 0; j < calcTrace.length; j++) {\n            pointList.push(posAxis.c2l(calcTrace[j].pos, true));\n            shownPts += (calcTrace[j].pts2 || []).length;\n        }\n    }\n\n    if(!pointList.length) return;\n\n    // box plots - update dPos based on multiple traces\n    var boxdv = Lib.distinctVals(pointList);\n    if(posAxis.type === 'category' || posAxis.type === 'multicategory') {\n        boxdv.minDiff = 1;\n    }\n\n    var dPos0 = boxdv.minDiff / 2;\n\n    // check for forced minimum dtick\n    Axes.minDtick(posAxis, boxdv.minDiff, boxdv.vals[0], true);\n\n    var numKey = traceType === 'violin' ? '_numViolins' : '_numBoxes';\n    var numTotal = fullLayout[numKey];\n    var group = fullLayout[traceType + 'mode'] === 'group' && numTotal > 1;\n    var groupFraction = 1 - fullLayout[traceType + 'gap'];\n    var groupGapFraction = 1 - fullLayout[traceType + 'groupgap'];\n\n    for(i = 0; i < boxList.length; i++) {\n        calcTrace = calcdata[boxList[i]];\n\n        var trace = calcTrace[0].trace;\n        var t = calcTrace[0].t;\n        var width = trace.width;\n        var side = trace.side;\n\n        // position coordinate delta\n        var dPos;\n        // box half width;\n        var bdPos;\n        // box center offset\n        var bPos;\n        // half-width within which to accept hover for this box/violin\n        // always split the distance to the closest box/violin\n        var wHover;\n\n        if(width) {\n            dPos = bdPos = wHover = width / 2;\n            bPos = 0;\n        } else {\n            dPos = dPos0;\n\n            if(group) {\n                var groupId = getAxisGroup(fullLayout, posAxis._id) + trace.orientation;\n                var alignmentGroups = fullLayout._alignmentOpts[groupId] || {};\n                var alignmentGroupOpts = alignmentGroups[trace.alignmentgroup] || {};\n                var nOffsetGroups = Object.keys(alignmentGroupOpts.offsetGroups || {}).length;\n                var num = nOffsetGroups || numTotal;\n                var shift = nOffsetGroups ? trace._offsetIndex : t.num;\n\n                bdPos = dPos * groupFraction * groupGapFraction / num;\n                bPos = 2 * dPos * (-0.5 + (shift + 0.5) / num) * groupFraction;\n                wHover = dPos * groupFraction / num;\n            } else {\n                bdPos = dPos * groupFraction * groupGapFraction;\n                bPos = 0;\n                wHover = dPos;\n            }\n        }\n        t.dPos = dPos;\n        t.bPos = bPos;\n        t.bdPos = bdPos;\n        t.wHover = wHover;\n\n        // box/violin-only value-space push value\n        var pushplus;\n        var pushminus;\n        // edge of box/violin\n        var edge = bPos + bdPos;\n        var edgeplus;\n        var edgeminus;\n        // value-space padding\n        var vpadplus;\n        var vpadminus;\n        // pixel-space padding\n        var ppadplus;\n        var ppadminus;\n        // do we add 5% of both sides (more logic for points beyond box/violin below)\n        var padded = Boolean(width);\n        // does this trace show points?\n        var hasPts = (trace.boxpoints || trace.points) && (shownPts > 0);\n\n        if(side === 'positive') {\n            pushplus = dPos * (width ? 1 : 0.5);\n            edgeplus = edge;\n            pushminus = edgeplus = bPos;\n        } else if(side === 'negative') {\n            pushplus = edgeplus = bPos;\n            pushminus = dPos * (width ? 1 : 0.5);\n            edgeminus = edge;\n        } else {\n            pushplus = pushminus = dPos;\n            edgeplus = edgeminus = edge;\n        }\n\n        if(hasPts) {\n            var pointpos = trace.pointpos;\n            var jitter = trace.jitter;\n            var ms = trace.marker.size / 2;\n\n            var pp = 0;\n            if((pointpos + jitter) >= 0) {\n                pp = edge * (pointpos + jitter);\n                if(pp > pushplus) {\n                    // (++) beyond plus-value, use pp\n                    padded = true;\n                    ppadplus = ms;\n                    vpadplus = pp;\n                } else if(pp > edgeplus) {\n                    // (+), use push-value (it's bigger), but add px-pad\n                    ppadplus = ms;\n                    vpadplus = pushplus;\n                }\n            }\n            if(pp <= pushplus) {\n                // (->) fallback to push value\n                vpadplus = pushplus;\n            }\n\n            var pm = 0;\n            if((pointpos - jitter) <= 0) {\n                pm = -edge * (pointpos - jitter);\n                if(pm > pushminus) {\n                    // (--) beyond plus-value, use pp\n                    padded = true;\n                    ppadminus = ms;\n                    vpadminus = pm;\n                } else if(pm > edgeminus) {\n                    // (-), use push-value (it's bigger), but add px-pad\n                    ppadminus = ms;\n                    vpadminus = pushminus;\n                }\n            }\n            if(pm <= pushminus) {\n                // (<-) fallback to push value\n                vpadminus = pushminus;\n            }\n        } else {\n            vpadplus = pushplus;\n            vpadminus = pushminus;\n        }\n\n        var pos = new Array(calcTrace.length);\n        for(j = 0; j < calcTrace.length; j++) {\n            pos[j] = calcTrace[j].pos;\n        }\n\n        trace._extremes[axId] = Axes.findExtremes(posAxis, pos, {\n            padded: padded,\n            vpadminus: vpadminus,\n            vpadplus: vpadplus,\n            vpadLinearized: true,\n            // N.B. SVG px-space positive/negative\n            ppadminus: {x: ppadminus, y: ppadplus}[axLetter],\n            ppadplus: {x: ppadplus, y: ppadminus}[axLetter],\n        });\n    }\n}\n\nmodule.exports = {\n    crossTraceCalc: crossTraceCalc,\n    setPositionOffset: setPositionOffset\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Registry = require('../../registry');\nvar Color = require('../../components/color');\nvar handlePeriodDefaults = require('../scatter/period_defaults');\nvar handleGroupingDefaults = require('../bar/defaults').handleGroupingDefaults;\nvar autoType = require('../../plots/cartesian/axis_autotype');\nvar attributes = require('./attributes');\n\nfunction supplyDefaults(traceIn, traceOut, defaultColor, layout) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(traceIn, traceOut, attributes, attr, dflt);\n    }\n\n    handleSampleDefaults(traceIn, traceOut, coerce, layout);\n    if(traceOut.visible === false) return;\n\n    handlePeriodDefaults(traceIn, traceOut, layout, coerce);\n    coerce('xhoverformat');\n    coerce('yhoverformat');\n\n    var hasPreCompStats = traceOut._hasPreCompStats;\n\n    if(hasPreCompStats) {\n        coerce('lowerfence');\n        coerce('upperfence');\n    }\n\n    coerce('line.color', (traceIn.marker || {}).color || defaultColor);\n    coerce('line.width');\n    coerce('fillcolor', Color.addOpacity(traceOut.line.color, 0.5));\n\n    var boxmeanDflt = false;\n    if(hasPreCompStats) {\n        var mean = coerce('mean');\n        var sd = coerce('sd');\n        if(mean && mean.length) {\n            boxmeanDflt = true;\n            if(sd && sd.length) boxmeanDflt = 'sd';\n        }\n    }\n    coerce('boxmean', boxmeanDflt);\n\n    coerce('whiskerwidth');\n    coerce('width');\n    coerce('quartilemethod');\n\n    var notchedDflt = false;\n    if(hasPreCompStats) {\n        var notchspan = coerce('notchspan');\n        if(notchspan && notchspan.length) {\n            notchedDflt = true;\n        }\n    } else if(Lib.validate(traceIn.notchwidth, attributes.notchwidth)) {\n        notchedDflt = true;\n    }\n    var notched = coerce('notched', notchedDflt);\n    if(notched) coerce('notchwidth');\n\n    handlePointsDefaults(traceIn, traceOut, coerce, {prefix: 'box'});\n}\n\nfunction handleSampleDefaults(traceIn, traceOut, coerce, layout) {\n    function getDims(arr) {\n        var dims = 0;\n        if(arr && arr.length) {\n            dims += 1;\n            if(Lib.isArrayOrTypedArray(arr[0]) && arr[0].length) {\n                dims += 1;\n            }\n        }\n        return dims;\n    }\n\n    function valid(astr) {\n        return Lib.validate(traceIn[astr], attributes[astr]);\n    }\n\n    var y = coerce('y');\n    var x = coerce('x');\n\n    var sLen;\n    if(traceOut.type === 'box') {\n        var q1 = coerce('q1');\n        var median = coerce('median');\n        var q3 = coerce('q3');\n\n        traceOut._hasPreCompStats = (\n            q1 && q1.length &&\n            median && median.length &&\n            q3 && q3.length\n        );\n        sLen = Math.min(\n            Lib.minRowLength(q1),\n            Lib.minRowLength(median),\n            Lib.minRowLength(q3)\n        );\n    }\n\n    var yDims = getDims(y);\n    var xDims = getDims(x);\n    var yLen = yDims && Lib.minRowLength(y);\n    var xLen = xDims && Lib.minRowLength(x);\n\n    var calendar = layout.calendar;\n    var opts = {\n        autotypenumbers: layout.autotypenumbers\n    };\n\n    var defaultOrientation, len;\n    if(traceOut._hasPreCompStats) {\n        switch(String(xDims) + String(yDims)) {\n            // no x / no y\n            case '00':\n                var setInX = valid('x0') || valid('dx');\n                var setInY = valid('y0') || valid('dy');\n\n                if(setInY && !setInX) {\n                    defaultOrientation = 'h';\n                } else {\n                    defaultOrientation = 'v';\n                }\n\n                len = sLen;\n                break;\n            // just x\n            case '10':\n                defaultOrientation = 'v';\n                len = Math.min(sLen, xLen);\n                break;\n            case '20':\n                defaultOrientation = 'h';\n                len = Math.min(sLen, x.length);\n                break;\n            // just y\n            case '01':\n                defaultOrientation = 'h';\n                len = Math.min(sLen, yLen);\n                break;\n            case '02':\n                defaultOrientation = 'v';\n                len = Math.min(sLen, y.length);\n                break;\n            // both\n            case '12':\n                defaultOrientation = 'v';\n                len = Math.min(sLen, xLen, y.length);\n                break;\n            case '21':\n                defaultOrientation = 'h';\n                len = Math.min(sLen, x.length, yLen);\n                break;\n            case '11':\n                // this one is ill-defined\n                len = 0;\n                break;\n            case '22':\n                var hasCategories = false;\n                var i;\n                for(i = 0; i < x.length; i++) {\n                    if(autoType(x[i], calendar, opts) === 'category') {\n                        hasCategories = true;\n                        break;\n                    }\n                }\n\n                if(hasCategories) {\n                    defaultOrientation = 'v';\n                    len = Math.min(sLen, xLen, y.length);\n                } else {\n                    for(i = 0; i < y.length; i++) {\n                        if(autoType(y[i], calendar, opts) === 'category') {\n                            hasCategories = true;\n                            break;\n                        }\n                    }\n\n                    if(hasCategories) {\n                        defaultOrientation = 'h';\n                        len = Math.min(sLen, x.length, yLen);\n                    } else {\n                        defaultOrientation = 'v';\n                        len = Math.min(sLen, xLen, y.length);\n                    }\n                }\n                break;\n        }\n    } else if(yDims > 0) {\n        defaultOrientation = 'v';\n        if(xDims > 0) {\n            len = Math.min(xLen, yLen);\n        } else {\n            len = Math.min(yLen);\n        }\n    } else if(xDims > 0) {\n        defaultOrientation = 'h';\n        len = Math.min(xLen);\n    } else {\n        len = 0;\n    }\n\n    if(!len) {\n        traceOut.visible = false;\n        return;\n    }\n    traceOut._length = len;\n\n    var orientation = coerce('orientation', defaultOrientation);\n\n    // these are just used for positioning, they never define the sample\n    if(traceOut._hasPreCompStats) {\n        if(orientation === 'v' && xDims === 0) {\n            coerce('x0', 0);\n            coerce('dx', 1);\n        } else if(orientation === 'h' && yDims === 0) {\n            coerce('y0', 0);\n            coerce('dy', 1);\n        }\n    } else {\n        if(orientation === 'v' && xDims === 0) {\n            coerce('x0');\n        } else if(orientation === 'h' && yDims === 0) {\n            coerce('y0');\n        }\n    }\n\n    var handleCalendarDefaults = Registry.getComponentMethod('calendars', 'handleTraceDefaults');\n    handleCalendarDefaults(traceIn, traceOut, ['x', 'y'], layout);\n}\n\nfunction handlePointsDefaults(traceIn, traceOut, coerce, opts) {\n    var prefix = opts.prefix;\n\n    var outlierColorDflt = Lib.coerce2(traceIn, traceOut, attributes, 'marker.outliercolor');\n    var lineoutliercolor = coerce('marker.line.outliercolor');\n\n    var modeDflt = 'outliers';\n    if(traceOut._hasPreCompStats) {\n        modeDflt = 'all';\n    } else if(outlierColorDflt || lineoutliercolor) {\n        modeDflt = 'suspectedoutliers';\n    }\n\n    var mode = coerce(prefix + 'points', modeDflt);\n\n    if(mode) {\n        coerce('jitter', mode === 'all' ? 0.3 : 0);\n        coerce('pointpos', mode === 'all' ? -1.5 : 0);\n\n        coerce('marker.symbol');\n        coerce('marker.opacity');\n        coerce('marker.size');\n        coerce('marker.color', traceOut.line.color);\n        coerce('marker.line.color');\n        coerce('marker.line.width');\n\n        if(mode === 'suspectedoutliers') {\n            coerce('marker.line.outliercolor', traceOut.marker.color);\n            coerce('marker.line.outlierwidth');\n        }\n\n        coerce('selected.marker.color');\n        coerce('unselected.marker.color');\n        coerce('selected.marker.size');\n        coerce('unselected.marker.size');\n\n        coerce('text');\n        coerce('hovertext');\n    } else {\n        delete traceOut.marker;\n    }\n\n    var hoveron = coerce('hoveron');\n    if(hoveron === 'all' || hoveron.indexOf('points') !== -1) {\n        coerce('hovertemplate');\n    }\n\n    Lib.coerceSelectionMarkerOpacity(traceOut, coerce);\n}\n\nfunction crossTraceDefaults(fullData, fullLayout) {\n    var traceIn, traceOut;\n\n    function coerce(attr) {\n        return Lib.coerce(traceOut._input, traceOut, attributes, attr);\n    }\n\n    for(var i = 0; i < fullData.length; i++) {\n        traceOut = fullData[i];\n        var traceType = traceOut.type;\n\n        if(traceType === 'box' || traceType === 'violin') {\n            traceIn = traceOut._input;\n            if(fullLayout[traceType + 'mode'] === 'group') {\n                handleGroupingDefaults(traceIn, traceOut, fullLayout, coerce);\n            }\n        }\n    }\n}\n\nmodule.exports = {\n    supplyDefaults: supplyDefaults,\n    crossTraceDefaults: crossTraceDefaults,\n\n    handleSampleDefaults: handleSampleDefaults,\n    handlePointsDefaults: handlePointsDefaults\n};\n","'use strict';\n\nmodule.exports = function eventData(out, pt) {\n    // Note: hoverOnBox property is needed for click-to-select\n    // to ignore when a box was clicked. This is the reason box\n    // implements this custom eventData function.\n    if(pt.hoverOnBox) out.hoverOnBox = pt.hoverOnBox;\n\n    if('xVal' in pt) out.x = pt.xVal;\n    if('yVal' in pt) out.y = pt.yVal;\n    if(pt.xa) out.xaxis = pt.xa;\n    if(pt.ya) out.yaxis = pt.ya;\n\n    return out;\n};\n","'use strict';\n\nvar Axes = require('../../plots/cartesian/axes');\nvar Lib = require('../../lib');\nvar Fx = require('../../components/fx');\nvar Color = require('../../components/color');\nvar fillText = Lib.fillText;\n\nfunction hoverPoints(pointData, xval, yval, hovermode) {\n    var cd = pointData.cd;\n    var trace = cd[0].trace;\n    var hoveron = trace.hoveron;\n    var closeBoxData = [];\n    var closePtData;\n\n    if(hoveron.indexOf('boxes') !== -1) {\n        closeBoxData = closeBoxData.concat(hoverOnBoxes(pointData, xval, yval, hovermode));\n    }\n\n    if(hoveron.indexOf('points') !== -1) {\n        closePtData = hoverOnPoints(pointData, xval, yval);\n    }\n\n    // If there's a point in range and hoveron has points, show the best single point only.\n    // If hoveron has boxes and there's no point in range (or hoveron doesn't have points), show the box stats.\n    if(hovermode === 'closest') {\n        if(closePtData) return [closePtData];\n        return closeBoxData;\n    }\n\n    // Otherwise in compare mode, allow a point AND the box stats to be labeled\n    // If there are multiple boxes in range (ie boxmode = 'overlay') we'll see stats for all of them.\n    if(closePtData) {\n        closeBoxData.push(closePtData);\n        return closeBoxData;\n    }\n    return closeBoxData;\n}\n\nfunction hoverOnBoxes(pointData, xval, yval, hovermode) {\n    var cd = pointData.cd;\n    var xa = pointData.xa;\n    var ya = pointData.ya;\n    var trace = cd[0].trace;\n    var t = cd[0].t;\n    var isViolin = trace.type === 'violin';\n    var closeBoxData = [];\n\n    var pLetter, vLetter, pAxis, vAxis, vVal, pVal, dx, dy, dPos,\n        hoverPseudoDistance, spikePseudoDistance;\n\n    var boxDelta = t.bdPos;\n    var boxDeltaPos, boxDeltaNeg;\n    var posAcceptance = t.wHover;\n    var shiftPos = function(di) { return pAxis.c2l(di.pos) + t.bPos - pAxis.c2l(pVal); };\n\n    if(isViolin && trace.side !== 'both') {\n        if(trace.side === 'positive') {\n            dPos = function(di) {\n                var pos = shiftPos(di);\n                return Fx.inbox(pos, pos + posAcceptance, hoverPseudoDistance);\n            };\n            boxDeltaPos = boxDelta;\n            boxDeltaNeg = 0;\n        }\n        if(trace.side === 'negative') {\n            dPos = function(di) {\n                var pos = shiftPos(di);\n                return Fx.inbox(pos - posAcceptance, pos, hoverPseudoDistance);\n            };\n            boxDeltaPos = 0;\n            boxDeltaNeg = boxDelta;\n        }\n    } else {\n        dPos = function(di) {\n            var pos = shiftPos(di);\n            return Fx.inbox(pos - posAcceptance, pos + posAcceptance, hoverPseudoDistance);\n        };\n        boxDeltaPos = boxDeltaNeg = boxDelta;\n    }\n\n    var dVal;\n\n    if(isViolin) {\n        dVal = function(di) {\n            return Fx.inbox(di.span[0] - vVal, di.span[1] - vVal, hoverPseudoDistance);\n        };\n    } else {\n        dVal = function(di) {\n            return Fx.inbox(di.min - vVal, di.max - vVal, hoverPseudoDistance);\n        };\n    }\n\n    if(trace.orientation === 'h') {\n        vVal = xval;\n        pVal = yval;\n        dx = dVal;\n        dy = dPos;\n        pLetter = 'y';\n        pAxis = ya;\n        vLetter = 'x';\n        vAxis = xa;\n    } else {\n        vVal = yval;\n        pVal = xval;\n        dx = dPos;\n        dy = dVal;\n        pLetter = 'x';\n        pAxis = xa;\n        vLetter = 'y';\n        vAxis = ya;\n    }\n\n    // if two boxes are overlaying, let the narrowest one win\n    var pseudoDistance = Math.min(1, boxDelta / Math.abs(pAxis.r2c(pAxis.range[1]) - pAxis.r2c(pAxis.range[0])));\n    hoverPseudoDistance = pointData.maxHoverDistance - pseudoDistance;\n    spikePseudoDistance = pointData.maxSpikeDistance - pseudoDistance;\n\n    function dxy(di) { return (dx(di) + dy(di)) / 2; }\n    var distfn = Fx.getDistanceFunction(hovermode, dx, dy, dxy);\n    Fx.getClosest(cd, distfn, pointData);\n\n    // skip the rest (for this trace) if we didn't find a close point\n    // and create the item(s) in closedata for this point\n    if(pointData.index === false) return [];\n\n    var di = cd[pointData.index];\n    var lc = trace.line.color;\n    var mc = (trace.marker || {}).color;\n\n    if(Color.opacity(lc) && trace.line.width) pointData.color = lc;\n    else if(Color.opacity(mc) && trace.boxpoints) pointData.color = mc;\n    else pointData.color = trace.fillcolor;\n\n    pointData[pLetter + '0'] = pAxis.c2p(di.pos + t.bPos - boxDeltaNeg, true);\n    pointData[pLetter + '1'] = pAxis.c2p(di.pos + t.bPos + boxDeltaPos, true);\n\n    pointData[pLetter + 'LabelVal'] = di.orig_p !== undefined ? di.orig_p : di.pos;\n\n    var spikePosAttr = pLetter + 'Spike';\n    pointData.spikeDistance = dxy(di) * spikePseudoDistance / hoverPseudoDistance;\n    pointData[spikePosAttr] = pAxis.c2p(di.pos, true);\n\n    // box plots: each \"point\" gets many labels\n    var usedVals = {};\n    var attrs = ['med', 'q1', 'q3', 'min', 'max'];\n\n    if(trace.boxmean || (trace.meanline || {}).visible) {\n        attrs.push('mean');\n    }\n    if(trace.boxpoints || trace.points) {\n        attrs.push('lf', 'uf');\n    }\n\n    for(var i = 0; i < attrs.length; i++) {\n        var attr = attrs[i];\n\n        if(!(attr in di) || (di[attr] in usedVals)) continue;\n        usedVals[di[attr]] = true;\n\n        // copy out to a new object for each value to label\n        var val = di[attr];\n        var valPx = vAxis.c2p(val, true);\n        var pointData2 = Lib.extendFlat({}, pointData);\n\n        pointData2.attr = attr;\n        pointData2[vLetter + '0'] = pointData2[vLetter + '1'] = valPx;\n        pointData2[vLetter + 'LabelVal'] = val;\n        pointData2[vLetter + 'Label'] = (t.labels ? t.labels[attr] + ' ' : '') + Axes.hoverLabelText(vAxis, val, trace[vLetter + 'hoverformat']);\n\n        // Note: introduced to be able to distinguish a\n        // clicked point from a box during click-to-select\n        pointData2.hoverOnBox = true;\n\n        if(attr === 'mean' && ('sd' in di) && trace.boxmean === 'sd') {\n            pointData2[vLetter + 'err'] = di.sd;\n        }\n\n        // only keep name and spikes on the first item (median)\n        pointData.name = '';\n        pointData.spikeDistance = undefined;\n        pointData[spikePosAttr] = undefined;\n\n        // no hovertemplate support yet\n        pointData2.hovertemplate = false;\n\n        closeBoxData.push(pointData2);\n    }\n\n    return closeBoxData;\n}\n\nfunction hoverOnPoints(pointData, xval, yval) {\n    var cd = pointData.cd;\n    var xa = pointData.xa;\n    var ya = pointData.ya;\n    var trace = cd[0].trace;\n    var xPx = xa.c2p(xval);\n    var yPx = ya.c2p(yval);\n    var closePtData;\n\n    var dx = function(di) {\n        var rad = Math.max(3, di.mrc || 0);\n        return Math.max(Math.abs(xa.c2p(di.x) - xPx) - rad, 1 - 3 / rad);\n    };\n    var dy = function(di) {\n        var rad = Math.max(3, di.mrc || 0);\n        return Math.max(Math.abs(ya.c2p(di.y) - yPx) - rad, 1 - 3 / rad);\n    };\n    var distfn = Fx.quadrature(dx, dy);\n\n    // show one point per trace\n    var ijClosest = false;\n    var di, pt;\n\n    for(var i = 0; i < cd.length; i++) {\n        di = cd[i];\n\n        for(var j = 0; j < (di.pts || []).length; j++) {\n            pt = di.pts[j];\n\n            var newDistance = distfn(pt);\n            if(newDistance <= pointData.distance) {\n                pointData.distance = newDistance;\n                ijClosest = [i, j];\n            }\n        }\n    }\n\n    if(!ijClosest) return false;\n\n    di = cd[ijClosest[0]];\n    pt = di.pts[ijClosest[1]];\n\n    var xc = xa.c2p(pt.x, true);\n    var yc = ya.c2p(pt.y, true);\n    var rad = pt.mrc || 1;\n\n    closePtData = Lib.extendFlat({}, pointData, {\n        // corresponds to index in x/y input data array\n        index: pt.i,\n        color: (trace.marker || {}).color,\n        name: trace.name,\n        x0: xc - rad,\n        x1: xc + rad,\n        y0: yc - rad,\n        y1: yc + rad,\n        spikeDistance: pointData.distance,\n        hovertemplate: trace.hovertemplate\n    });\n\n    var origPos = di.orig_p;\n    var pos = origPos !== undefined ? origPos : di.pos;\n    var pa;\n    if(trace.orientation === 'h') {\n        pa = ya;\n        closePtData.xLabelVal = pt.x;\n        closePtData.yLabelVal = pos;\n    } else {\n        pa = xa;\n        closePtData.xLabelVal = pos;\n        closePtData.yLabelVal = pt.y;\n    }\n\n    var pLetter = pa._id.charAt(0);\n    closePtData[pLetter + 'Spike'] = pa.c2p(di.pos, true);\n\n    fillText(pt, trace, closePtData);\n\n    return closePtData;\n}\n\nmodule.exports = {\n    hoverPoints: hoverPoints,\n    hoverOnBoxes: hoverOnBoxes,\n    hoverOnPoints: hoverOnPoints\n};\n","'use strict';\n\nmodule.exports = {\n    attributes: require('./attributes'),\n    layoutAttributes: require('./layout_attributes'),\n    supplyDefaults: require('./defaults').supplyDefaults,\n    crossTraceDefaults: require('./defaults').crossTraceDefaults,\n    supplyLayoutDefaults: require('./layout_defaults').supplyLayoutDefaults,\n    calc: require('./calc'),\n    crossTraceCalc: require('./cross_trace_calc').crossTraceCalc,\n    plot: require('./plot').plot,\n    style: require('./style').style,\n    styleOnSelect: require('./style').styleOnSelect,\n    hoverPoints: require('./hover').hoverPoints,\n    eventData: require('./event_data'),\n    selectPoints: require('./select'),\n\n    moduleType: 'trace',\n    name: 'box',\n    basePlotModule: require('../../plots/cartesian'),\n    categories: ['cartesian', 'svg', 'symbols', 'oriented', 'box-violin', 'showLegend', 'boxLayout', 'zoomScale'],\n    meta: {\n        description: [\n            'Each box spans from quartile 1 (Q1) to quartile 3 (Q3).',\n            'The second quartile (Q2, i.e. the median) is marked by a line inside the box.',\n            'The fences grow outward from the boxes\\' edges,',\n            'by default they span +/- 1.5 times the interquartile range (IQR: Q3-Q1),',\n            'The sample mean and standard deviation as well as notches and',\n            'the sample, outlier and suspected outliers points can be optionally',\n            'added to the box plot.',\n\n            'The values and positions corresponding to each boxes can be input',\n            'using two signatures.',\n\n            'The first signature expects users to supply the sample values in the `y`',\n            'data array for vertical boxes (`x` for horizontal boxes).',\n            'By supplying an `x` (`y`) array, one box per distinct `x` (`y`) value is drawn',\n            'If no `x` (`y`) {array} is provided, a single box is drawn.',\n            'In this case, the box is positioned with the trace `name` or with `x0` (`y0`) if provided.',\n\n            'The second signature expects users to supply the boxes corresponding Q1, median and Q3',\n            'statistics in the `q1`, `median` and `q3` data arrays respectively.',\n            'Other box features relying on statistics namely `lowerfence`, `upperfence`, `notchspan`',\n            'can be set directly by the users.',\n            'To have plotly compute them or to show sample points besides the boxes,',\n            'users can set the `y` data array for vertical boxes (`x` for horizontal boxes)',\n            'to a 2D array with the outer length corresponding',\n            'to the number of boxes in the traces and the inner length corresponding the sample size.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\n\nmodule.exports = {\n    boxmode: {\n        valType: 'enumerated',\n        values: ['group', 'overlay'],\n        dflt: 'overlay',\n        editType: 'calc',\n        description: [\n            'Determines how boxes at the same location coordinate',\n            'are displayed on the graph.',\n            'If *group*, the boxes are plotted next to one another',\n            'centered around the shared location.',\n            'If *overlay*, the boxes are plotted over one another,',\n            'you might need to set *opacity* to see them multiple boxes.',\n            'Has no effect on traces that have *width* set.'\n        ].join(' ')\n    },\n    boxgap: {\n        valType: 'number',\n        min: 0,\n        max: 1,\n        dflt: 0.3,\n        editType: 'calc',\n        description: [\n            'Sets the gap (in plot fraction) between boxes of',\n            'adjacent location coordinates.',\n            'Has no effect on traces that have *width* set.'\n        ].join(' ')\n    },\n    boxgroupgap: {\n        valType: 'number',\n        min: 0,\n        max: 1,\n        dflt: 0.3,\n        editType: 'calc',\n        description: [\n            'Sets the gap (in plot fraction) between boxes of',\n            'the same location coordinate.',\n            'Has no effect on traces that have *width* set.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar layoutAttributes = require('./layout_attributes');\n\nfunction _supply(layoutIn, layoutOut, fullData, coerce, traceType) {\n    var category = traceType + 'Layout';\n    var hasTraceType = false;\n\n    for(var i = 0; i < fullData.length; i++) {\n        var trace = fullData[i];\n\n        if(Registry.traceIs(trace, category)) {\n            hasTraceType = true;\n            break;\n        }\n    }\n    if(!hasTraceType) return;\n\n    coerce(traceType + 'mode');\n    coerce(traceType + 'gap');\n    coerce(traceType + 'groupgap');\n}\n\nfunction supplyLayoutDefaults(layoutIn, layoutOut, fullData) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(layoutIn, layoutOut, layoutAttributes, attr, dflt);\n    }\n    _supply(layoutIn, layoutOut, fullData, coerce, 'box');\n}\n\nmodule.exports = {\n    supplyLayoutDefaults: supplyLayoutDefaults,\n    _supply: _supply\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Lib = require('../../lib');\nvar Drawing = require('../../components/drawing');\n\n// constants for dynamic jitter (ie less jitter for sparser points)\nvar JITTERCOUNT = 5; // points either side of this to include\nvar JITTERSPREAD = 0.01; // fraction of IQR to count as \"dense\"\n\nfunction plot(gd, plotinfo, cdbox, boxLayer) {\n    var xa = plotinfo.xaxis;\n    var ya = plotinfo.yaxis;\n\n    Lib.makeTraceGroups(boxLayer, cdbox, 'trace boxes').each(function(cd) {\n        var plotGroup = d3.select(this);\n        var cd0 = cd[0];\n        var t = cd0.t;\n        var trace = cd0.trace;\n\n        // whisker width\n        t.wdPos = t.bdPos * trace.whiskerwidth;\n\n        if(trace.visible !== true || t.empty) {\n            plotGroup.remove();\n            return;\n        }\n\n        var posAxis, valAxis;\n\n        if(trace.orientation === 'h') {\n            posAxis = ya;\n            valAxis = xa;\n        } else {\n            posAxis = xa;\n            valAxis = ya;\n        }\n\n        plotBoxAndWhiskers(plotGroup, {pos: posAxis, val: valAxis}, trace, t);\n        plotPoints(plotGroup, {x: xa, y: ya}, trace, t);\n        plotBoxMean(plotGroup, {pos: posAxis, val: valAxis}, trace, t);\n    });\n}\n\nfunction plotBoxAndWhiskers(sel, axes, trace, t) {\n    var isHorizontal = trace.orientation === 'h';\n    var valAxis = axes.val;\n    var posAxis = axes.pos;\n    var posHasRangeBreaks = !!posAxis.rangebreaks;\n\n    var bPos = t.bPos;\n    var wdPos = t.wdPos || 0;\n    var bPosPxOffset = t.bPosPxOffset || 0;\n    var whiskerWidth = trace.whiskerwidth || 0;\n    var notched = trace.notched || false;\n    var nw = notched ? 1 - 2 * trace.notchwidth : 1;\n\n    // to support for one-sided box\n    var bdPos0;\n    var bdPos1;\n    if(Array.isArray(t.bdPos)) {\n        bdPos0 = t.bdPos[0];\n        bdPos1 = t.bdPos[1];\n    } else {\n        bdPos0 = t.bdPos;\n        bdPos1 = t.bdPos;\n    }\n\n    var paths = sel.selectAll('path.box').data((\n        trace.type !== 'violin' ||\n        trace.box.visible\n    ) ? Lib.identity : []);\n\n    paths.enter().append('path')\n        .style('vector-effect', 'non-scaling-stroke')\n        .attr('class', 'box');\n\n    paths.exit().remove();\n\n    paths.each(function(d) {\n        if(d.empty) return 'M0,0Z';\n\n        var lcenter = posAxis.c2l(d.pos + bPos, true);\n\n        var pos0 = posAxis.l2p(lcenter - bdPos0) + bPosPxOffset;\n        var pos1 = posAxis.l2p(lcenter + bdPos1) + bPosPxOffset;\n        var posc = posHasRangeBreaks ? (pos0 + pos1) / 2 : posAxis.l2p(lcenter) + bPosPxOffset;\n\n        var r = trace.whiskerwidth;\n        var posw0 = posHasRangeBreaks ? pos0 * r + (1 - r) * posc : posAxis.l2p(lcenter - wdPos) + bPosPxOffset;\n        var posw1 = posHasRangeBreaks ? pos1 * r + (1 - r) * posc : posAxis.l2p(lcenter + wdPos) + bPosPxOffset;\n\n        var posm0 = posAxis.l2p(lcenter - bdPos0 * nw) + bPosPxOffset;\n        var posm1 = posAxis.l2p(lcenter + bdPos1 * nw) + bPosPxOffset;\n        var q1 = valAxis.c2p(d.q1, true);\n        var q3 = valAxis.c2p(d.q3, true);\n        // make sure median isn't identical to either of the\n        // quartiles, so we can see it\n        var m = Lib.constrain(\n            valAxis.c2p(d.med, true),\n            Math.min(q1, q3) + 1, Math.max(q1, q3) - 1\n        );\n\n        // for compatibility with box, violin, and candlestick\n        // perhaps we should put this into cd0.t instead so it's more explicit,\n        // but what we have now is:\n        // - box always has d.lf, but boxpoints can be anything\n        // - violin has d.lf and should always use it (boxpoints is undefined)\n        // - candlestick has only min/max\n        var useExtremes = (d.lf === undefined) || (trace.boxpoints === false);\n        var lf = valAxis.c2p(useExtremes ? d.min : d.lf, true);\n        var uf = valAxis.c2p(useExtremes ? d.max : d.uf, true);\n        var ln = valAxis.c2p(d.ln, true);\n        var un = valAxis.c2p(d.un, true);\n\n        if(isHorizontal) {\n            d3.select(this).attr('d',\n                'M' + m + ',' + posm0 + 'V' + posm1 + // median line\n                'M' + q1 + ',' + pos0 + 'V' + pos1 + // left edge\n                (notched ?\n                    'H' + ln + 'L' + m + ',' + posm1 + 'L' + un + ',' + pos1 :\n                    ''\n                ) + // top notched edge\n                'H' + q3 + // end of the top edge\n                'V' + pos0 + // right edge\n                (notched ? 'H' + un + 'L' + m + ',' + posm0 + 'L' + ln + ',' + pos0 : '') + // bottom notched edge\n                'Z' + // end of the box\n                'M' + q1 + ',' + posc + 'H' + lf + 'M' + q3 + ',' + posc + 'H' + uf + // whiskers\n                (whiskerWidth === 0 ?\n                    '' : // whisker caps\n                    'M' + lf + ',' + posw0 + 'V' + posw1 + 'M' + uf + ',' + posw0 + 'V' + posw1\n                )\n            );\n        } else {\n            d3.select(this).attr('d',\n                'M' + posm0 + ',' + m + 'H' + posm1 + // median line\n                'M' + pos0 + ',' + q1 + 'H' + pos1 + // top of the box\n                (notched ?\n                    'V' + ln + 'L' + posm1 + ',' + m + 'L' + pos1 + ',' + un :\n                    ''\n                ) + // notched right edge\n                'V' + q3 + // end of the right edge\n                'H' + pos0 + // bottom of the box\n                (notched ?\n                    'V' + un + 'L' + posm0 + ',' + m + 'L' + pos0 + ',' + ln :\n                    ''\n                ) + // notched left edge\n                'Z' + // end of the box\n                'M' + posc + ',' + q1 + 'V' + lf + 'M' + posc + ',' + q3 + 'V' + uf + // whiskers\n                (whiskerWidth === 0 ?\n                    '' : // whisker caps\n                    'M' + posw0 + ',' + lf + 'H' + posw1 + 'M' + posw0 + ',' + uf + 'H' + posw1\n                )\n            );\n        }\n    });\n}\n\nfunction plotPoints(sel, axes, trace, t) {\n    var xa = axes.x;\n    var ya = axes.y;\n    var bdPos = t.bdPos;\n    var bPos = t.bPos;\n\n    // to support violin points\n    var mode = trace.boxpoints || trace.points;\n\n    // repeatable pseudo-random number generator\n    Lib.seedPseudoRandom();\n\n    // since box plot points get an extra level of nesting, each\n    // box needs the trace styling info\n    var fn = function(d) {\n        d.forEach(function(v) {\n            v.t = t;\n            v.trace = trace;\n        });\n        return d;\n    };\n\n    var gPoints = sel.selectAll('g.points')\n        .data(mode ? fn : []);\n\n    gPoints.enter().append('g')\n        .attr('class', 'points');\n\n    gPoints.exit().remove();\n\n    var paths = gPoints.selectAll('path')\n        .data(function(d) {\n            var i;\n            var pts = d.pts2;\n\n            // normally use IQR, but if this is 0 or too small, use max-min\n            var typicalSpread = Math.max((d.max - d.min) / 10, d.q3 - d.q1);\n            var minSpread = typicalSpread * 1e-9;\n            var spreadLimit = typicalSpread * JITTERSPREAD;\n            var jitterFactors = [];\n            var maxJitterFactor = 0;\n            var newJitter;\n\n            // dynamic jitter\n            if(trace.jitter) {\n                if(typicalSpread === 0) {\n                    // edge case of no spread at all: fall back to max jitter\n                    maxJitterFactor = 1;\n                    jitterFactors = new Array(pts.length);\n                    for(i = 0; i < pts.length; i++) {\n                        jitterFactors[i] = 1;\n                    }\n                } else {\n                    for(i = 0; i < pts.length; i++) {\n                        var i0 = Math.max(0, i - JITTERCOUNT);\n                        var pmin = pts[i0].v;\n                        var i1 = Math.min(pts.length - 1, i + JITTERCOUNT);\n                        var pmax = pts[i1].v;\n\n                        if(mode !== 'all') {\n                            if(pts[i].v < d.lf) pmax = Math.min(pmax, d.lf);\n                            else pmin = Math.max(pmin, d.uf);\n                        }\n\n                        var jitterFactor = Math.sqrt(spreadLimit * (i1 - i0) / (pmax - pmin + minSpread)) || 0;\n                        jitterFactor = Lib.constrain(Math.abs(jitterFactor), 0, 1);\n\n                        jitterFactors.push(jitterFactor);\n                        maxJitterFactor = Math.max(jitterFactor, maxJitterFactor);\n                    }\n                }\n                newJitter = trace.jitter * 2 / (maxJitterFactor || 1);\n            }\n\n            // fills in 'x' and 'y' in calcdata 'pts' item\n            for(i = 0; i < pts.length; i++) {\n                var pt = pts[i];\n                var v = pt.v;\n\n                var jitterOffset = trace.jitter ?\n                    (newJitter * jitterFactors[i] * (Lib.pseudoRandom() - 0.5)) :\n                    0;\n\n                var posPx = d.pos + bPos + bdPos * (trace.pointpos + jitterOffset);\n\n                if(trace.orientation === 'h') {\n                    pt.y = posPx;\n                    pt.x = v;\n                } else {\n                    pt.x = posPx;\n                    pt.y = v;\n                }\n\n                // tag suspected outliers\n                if(mode === 'suspectedoutliers' && v < d.uo && v > d.lo) {\n                    pt.so = true;\n                }\n            }\n\n            return pts;\n        });\n\n    paths.enter().append('path')\n        .classed('point', true);\n\n    paths.exit().remove();\n\n    paths.call(Drawing.translatePoints, xa, ya);\n}\n\nfunction plotBoxMean(sel, axes, trace, t) {\n    var valAxis = axes.val;\n    var posAxis = axes.pos;\n    var posHasRangeBreaks = !!posAxis.rangebreaks;\n\n    var bPos = t.bPos;\n    var bPosPxOffset = t.bPosPxOffset || 0;\n\n    // to support violin mean lines\n    var mode = trace.boxmean || (trace.meanline || {}).visible;\n\n    // to support for one-sided box\n    var bdPos0;\n    var bdPos1;\n    if(Array.isArray(t.bdPos)) {\n        bdPos0 = t.bdPos[0];\n        bdPos1 = t.bdPos[1];\n    } else {\n        bdPos0 = t.bdPos;\n        bdPos1 = t.bdPos;\n    }\n\n    var paths = sel.selectAll('path.mean').data((\n        (trace.type === 'box' && trace.boxmean) ||\n        (trace.type === 'violin' && trace.box.visible && trace.meanline.visible)\n    ) ? Lib.identity : []);\n\n    paths.enter().append('path')\n        .attr('class', 'mean')\n        .style({\n            fill: 'none',\n            'vector-effect': 'non-scaling-stroke'\n        });\n\n    paths.exit().remove();\n\n    paths.each(function(d) {\n        var lcenter = posAxis.c2l(d.pos + bPos, true);\n\n        var pos0 = posAxis.l2p(lcenter - bdPos0) + bPosPxOffset;\n        var pos1 = posAxis.l2p(lcenter + bdPos1) + bPosPxOffset;\n        var posc = posHasRangeBreaks ? (pos0 + pos1) / 2 : posAxis.l2p(lcenter) + bPosPxOffset;\n\n        var m = valAxis.c2p(d.mean, true);\n        var sl = valAxis.c2p(d.mean - d.sd, true);\n        var sh = valAxis.c2p(d.mean + d.sd, true);\n\n        if(trace.orientation === 'h') {\n            d3.select(this).attr('d',\n                'M' + m + ',' + pos0 + 'V' + pos1 +\n                (mode === 'sd' ?\n                    'm0,0L' + sl + ',' + posc + 'L' + m + ',' + pos0 + 'L' + sh + ',' + posc + 'Z' :\n                    '')\n            );\n        } else {\n            d3.select(this).attr('d',\n                'M' + pos0 + ',' + m + 'H' + pos1 +\n                (mode === 'sd' ?\n                    'm0,0L' + posc + ',' + sl + 'L' + pos0 + ',' + m + 'L' + posc + ',' + sh + 'Z' :\n                    '')\n            );\n        }\n    });\n}\n\nmodule.exports = {\n    plot: plot,\n    plotBoxAndWhiskers: plotBoxAndWhiskers,\n    plotPoints: plotPoints,\n    plotBoxMean: plotBoxMean\n};\n","'use strict';\n\nmodule.exports = function selectPoints(searchInfo, selectionTester) {\n    var cd = searchInfo.cd;\n    var xa = searchInfo.xaxis;\n    var ya = searchInfo.yaxis;\n    var selection = [];\n    var i, j;\n\n    if(selectionTester === false) {\n        for(i = 0; i < cd.length; i++) {\n            for(j = 0; j < (cd[i].pts || []).length; j++) {\n                // clear selection\n                cd[i].pts[j].selected = 0;\n            }\n        }\n    } else {\n        for(i = 0; i < cd.length; i++) {\n            for(j = 0; j < (cd[i].pts || []).length; j++) {\n                var pt = cd[i].pts[j];\n                var x = xa.c2p(pt.x);\n                var y = ya.c2p(pt.y);\n\n                if(selectionTester.contains([x, y], null, pt.i, searchInfo)) {\n                    selection.push({\n                        pointNumber: pt.i,\n                        x: xa.c2d(pt.x),\n                        y: ya.c2d(pt.y)\n                    });\n                    pt.selected = 1;\n                } else {\n                    pt.selected = 0;\n                }\n            }\n        }\n    }\n\n    return selection;\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar Color = require('../../components/color');\nvar Drawing = require('../../components/drawing');\n\nfunction style(gd, cd, sel) {\n    var s = sel ? sel : d3.select(gd).selectAll('g.trace.boxes');\n\n    s.style('opacity', function(d) { return d[0].trace.opacity; });\n\n    s.each(function(d) {\n        var el = d3.select(this);\n        var trace = d[0].trace;\n        var lineWidth = trace.line.width;\n\n        function styleBox(boxSel, lineWidth, lineColor, fillColor) {\n            boxSel.style('stroke-width', lineWidth + 'px')\n                .call(Color.stroke, lineColor)\n                .call(Color.fill, fillColor);\n        }\n\n        var allBoxes = el.selectAll('path.box');\n\n        if(trace.type === 'candlestick') {\n            allBoxes.each(function(boxData) {\n                if(boxData.empty) return;\n\n                var thisBox = d3.select(this);\n                var container = trace[boxData.dir]; // dir = 'increasing' or 'decreasing'\n                styleBox(thisBox, container.line.width, container.line.color, container.fillcolor);\n                // TODO: custom selection style for candlesticks\n                thisBox.style('opacity', trace.selectedpoints && !boxData.selected ? 0.3 : 1);\n            });\n        } else {\n            styleBox(allBoxes, lineWidth, trace.line.color, trace.fillcolor);\n            el.selectAll('path.mean')\n                .style({\n                    'stroke-width': lineWidth,\n                    'stroke-dasharray': (2 * lineWidth) + 'px,' + lineWidth + 'px'\n                })\n                .call(Color.stroke, trace.line.color);\n\n            var pts = el.selectAll('path.point');\n            Drawing.pointStyle(pts, trace, gd);\n        }\n    });\n}\n\nfunction styleOnSelect(gd, cd, sel) {\n    var trace = cd[0].trace;\n    var pts = sel.selectAll('path.point');\n\n    if(trace.selectedpoints) {\n        Drawing.selectedPointStyle(pts, trace);\n    } else {\n        Drawing.pointStyle(pts, trace, gd);\n    }\n}\n\nmodule.exports = {\n    style: style,\n    styleOnSelect: styleOnSelect\n};\n","'use strict';\n\nvar heatmapAttrs = require('../heatmap/attributes');\nvar scatterAttrs = require('../scatter/attributes');\nvar axisFormat = require('../../plots/cartesian/axis_format_attributes');\nvar axisHoverFormat = axisFormat.axisHoverFormat;\nvar descriptionOnlyNumbers = axisFormat.descriptionOnlyNumbers;\nvar colorScaleAttrs = require('../../components/colorscale/attributes');\nvar dash = require('../../components/drawing/attributes').dash;\nvar fontAttrs = require('../../plots/font_attributes');\nvar extendFlat = require('../../lib/extend').extendFlat;\n\nvar filterOps = require('../../constants/filter_ops');\nvar COMPARISON_OPS2 = filterOps.COMPARISON_OPS2;\nvar INTERVAL_OPS = filterOps.INTERVAL_OPS;\n\n\nvar scatterLineAttrs = scatterAttrs.line;\n\nmodule.exports = extendFlat({\n    z: heatmapAttrs.z,\n    x: heatmapAttrs.x,\n    x0: heatmapAttrs.x0,\n    dx: heatmapAttrs.dx,\n    y: heatmapAttrs.y,\n    y0: heatmapAttrs.y0,\n    dy: heatmapAttrs.dy,\n\n    xperiod: heatmapAttrs.xperiod,\n    yperiod: heatmapAttrs.yperiod,\n    xperiod0: scatterAttrs.xperiod0,\n    yperiod0: scatterAttrs.yperiod0,\n    xperiodalignment: heatmapAttrs.xperiodalignment,\n    yperiodalignment: heatmapAttrs.yperiodalignment,\n\n    text: heatmapAttrs.text,\n    hovertext: heatmapAttrs.hovertext,\n    transpose: heatmapAttrs.transpose,\n    xtype: heatmapAttrs.xtype,\n    ytype: heatmapAttrs.ytype,\n    xhoverformat: axisHoverFormat('x'),\n    yhoverformat: axisHoverFormat('y'),\n    zhoverformat: axisHoverFormat('z', 1),\n    hovertemplate: heatmapAttrs.hovertemplate,\n    hoverongaps: heatmapAttrs.hoverongaps,\n    connectgaps: extendFlat({}, heatmapAttrs.connectgaps, {\n        description: [\n            'Determines whether or not gaps',\n            '(i.e. {nan} or missing values)',\n            'in the `z` data are filled in.',\n            'It is defaulted to true if `z` is a',\n            'one dimensional array',\n            'otherwise it is defaulted to false.'\n        ].join(' ')\n    }),\n\n    fillcolor: {\n        valType: 'color',\n        editType: 'calc',\n        description: [\n            'Sets the fill color if `contours.type` is *constraint*.',\n            'Defaults to a half-transparent variant of the line color,',\n            'marker color, or marker line color, whichever is available.'\n        ].join(' ')\n    },\n\n    autocontour: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'calc',\n        impliedEdits: {\n            'contours.start': undefined,\n            'contours.end': undefined,\n            'contours.size': undefined\n        },\n        description: [\n            'Determines whether or not the contour level attributes are',\n            'picked by an algorithm.',\n            'If *true*, the number of contour levels can be set in `ncontours`.',\n            'If *false*, set the contour level attributes in `contours`.'\n        ].join(' ')\n    },\n    ncontours: {\n        valType: 'integer',\n        dflt: 15,\n        min: 1,\n        editType: 'calc',\n        description: [\n            'Sets the maximum number of contour levels. The actual number',\n            'of contours will be chosen automatically to be less than or',\n            'equal to the value of `ncontours`.',\n            'Has an effect only if `autocontour` is *true* or if',\n            '`contours.size` is missing.'\n        ].join(' ')\n    },\n\n    contours: {\n        type: {\n            valType: 'enumerated',\n            values: ['levels', 'constraint'],\n            dflt: 'levels',\n            editType: 'calc',\n            description: [\n                'If `levels`, the data is represented as a contour plot with multiple',\n                'levels displayed. If `constraint`, the data is represented as constraints',\n                'with the invalid region shaded as specified by the `operation` and',\n                '`value` parameters.'\n            ].join(' ')\n        },\n        start: {\n            valType: 'number',\n            dflt: null,\n            editType: 'plot',\n            impliedEdits: {'^autocontour': false},\n            description: [\n                'Sets the starting contour level value.',\n                'Must be less than `contours.end`'\n            ].join(' ')\n        },\n        end: {\n            valType: 'number',\n            dflt: null,\n            editType: 'plot',\n            impliedEdits: {'^autocontour': false},\n            description: [\n                'Sets the end contour level value.',\n                'Must be more than `contours.start`'\n            ].join(' ')\n        },\n        size: {\n            valType: 'number',\n            dflt: null,\n            min: 0,\n            editType: 'plot',\n            impliedEdits: {'^autocontour': false},\n            description: [\n                'Sets the step between each contour level.',\n                'Must be positive.'\n            ].join(' ')\n        },\n        coloring: {\n            valType: 'enumerated',\n            values: ['fill', 'heatmap', 'lines', 'none'],\n            dflt: 'fill',\n            editType: 'calc',\n            description: [\n                'Determines the coloring method showing the contour values.',\n                'If *fill*, coloring is done evenly between each contour level',\n                'If *heatmap*, a heatmap gradient coloring is applied',\n                'between each contour level.',\n                'If *lines*, coloring is done on the contour lines.',\n                'If *none*, no coloring is applied on this trace.'\n            ].join(' ')\n        },\n        showlines: {\n            valType: 'boolean',\n            dflt: true,\n            editType: 'plot',\n            description: [\n                'Determines whether or not the contour lines are drawn.',\n                'Has an effect only if `contours.coloring` is set to *fill*.'\n            ].join(' ')\n        },\n        showlabels: {\n            valType: 'boolean',\n            dflt: false,\n            editType: 'plot',\n            description: [\n                'Determines whether to label the contour lines with their values.'\n            ].join(' ')\n        },\n        labelfont: fontAttrs({\n            editType: 'plot',\n            colorEditType: 'style',\n            description: [\n                'Sets the font used for labeling the contour levels.',\n                'The default color comes from the lines, if shown.',\n                'The default family and size come from `layout.font`.'\n            ].join(' '),\n        }),\n        labelformat: {\n            valType: 'string',\n            dflt: '',\n            editType: 'plot',\n            description: descriptionOnlyNumbers('contour label')\n        },\n        operation: {\n            valType: 'enumerated',\n            values: [].concat(COMPARISON_OPS2).concat(INTERVAL_OPS),\n            dflt: '=',\n            editType: 'calc',\n            description: [\n                'Sets the constraint operation.',\n\n                '*=* keeps regions equal to `value`',\n\n                '*<* and *<=* keep regions less than `value`',\n\n                '*>* and *>=* keep regions greater than `value`',\n\n                '*[]*, *()*, *[)*, and *(]* keep regions inside `value[0]` to `value[1]`',\n\n                '*][*, *)(*, *](*, *)[* keep regions outside `value[0]` to value[1]`',\n\n                'Open vs. closed intervals make no difference to constraint display, but',\n                'all versions are allowed for consistency with filter transforms.'\n            ].join(' ')\n        },\n        value: {\n            valType: 'any',\n            dflt: 0,\n            editType: 'calc',\n            description: [\n                'Sets the value or values of the constraint boundary.',\n\n                'When `operation` is set to one of the comparison values',\n                '(' + COMPARISON_OPS2 + ')',\n                '*value* is expected to be a number.',\n\n                'When `operation` is set to one of the interval values',\n                '(' + INTERVAL_OPS + ')',\n                '*value* is expected to be an array of two numbers where the first',\n                'is the lower bound and the second is the upper bound.',\n            ].join(' ')\n        },\n        editType: 'calc',\n        impliedEdits: {'autocontour': false}\n    },\n\n    line: {\n        color: extendFlat({}, scatterLineAttrs.color, {\n            editType: 'style+colorbars',\n            description: [\n                'Sets the color of the contour level.',\n                'Has no effect if `contours.coloring` is set to *lines*.'\n            ].join(' ')\n        }),\n        width: {\n            valType: 'number',\n            min: 0,\n            editType: 'style+colorbars',\n            description: [\n                'Sets the contour line width in (in px)',\n                'Defaults to *0.5* when `contours.type` is *levels*.',\n                'Defaults to *2* when `contour.type` is *constraint*.'\n            ].join(' ')\n        },\n        dash: dash,\n        smoothing: extendFlat({}, scatterLineAttrs.smoothing, {\n            description: [\n                'Sets the amount of smoothing for the contour lines,',\n                'where *0* corresponds to no smoothing.'\n            ].join(' ')\n        }),\n        editType: 'plot'\n    }\n},\n    colorScaleAttrs('', {\n        cLetter: 'z',\n        autoColorDflt: false,\n        editTypeOverride: 'calc'\n    })\n);\n","'use strict';\n\nvar Colorscale = require('../../components/colorscale');\n\nvar heatmapCalc = require('../heatmap/calc');\nvar setContours = require('./set_contours');\nvar endPlus = require('./end_plus');\n\n// most is the same as heatmap calc, then adjust it\n// though a few things inside heatmap calc still look for\n// contour maps, because the makeBoundArray calls are too entangled\nmodule.exports = function calc(gd, trace) {\n    var cd = heatmapCalc(gd, trace);\n\n    var zOut = cd[0].z;\n    setContours(trace, zOut);\n\n    var contours = trace.contours;\n    var cOpts = Colorscale.extractOpts(trace);\n    var cVals;\n\n    if(contours.coloring === 'heatmap' && cOpts.auto && trace.autocontour === false) {\n        var start = contours.start;\n        var end = endPlus(contours);\n        var cs = contours.size || 1;\n        var nc = Math.floor((end - start) / cs) + 1;\n\n        if(!isFinite(cs)) {\n            cs = 1;\n            nc = 1;\n        }\n\n        var min0 = start - cs / 2;\n        var max0 = min0 + nc * cs;\n        cVals = [min0, max0];\n    } else {\n        cVals = zOut;\n    }\n\n    Colorscale.calc(gd, trace, {vals: cVals, cLetter: 'z'});\n\n    return cd;\n};\n","'use strict';\n\nmodule.exports = function(pathinfo, contours) {\n    var pi0 = pathinfo[0];\n    var z = pi0.z;\n    var i;\n\n    switch(contours.type) {\n        case 'levels':\n            // Why (just) use z[0][0] and z[0][1]?\n            //\n            // N.B. using boundaryMin instead of edgeVal2 here makes the\n            //      `contour_scatter` mock fail\n            var edgeVal2 = Math.min(z[0][0], z[0][1]);\n\n            for(i = 0; i < pathinfo.length; i++) {\n                var pi = pathinfo[i];\n                pi.prefixBoundary = !pi.edgepaths.length &&\n                    (edgeVal2 > pi.level || pi.starts.length && edgeVal2 === pi.level);\n            }\n            break;\n        case 'constraint':\n            // after convertToConstraints, pathinfo has length=0\n            pi0.prefixBoundary = false;\n\n            // joinAllPaths does enough already when edgepaths are present\n            if(pi0.edgepaths.length) return;\n\n            var na = pi0.x.length;\n            var nb = pi0.y.length;\n            var boundaryMax = -Infinity;\n            var boundaryMin = Infinity;\n\n            for(i = 0; i < nb; i++) {\n                boundaryMin = Math.min(boundaryMin, z[i][0]);\n                boundaryMin = Math.min(boundaryMin, z[i][na - 1]);\n                boundaryMax = Math.max(boundaryMax, z[i][0]);\n                boundaryMax = Math.max(boundaryMax, z[i][na - 1]);\n            }\n            for(i = 1; i < na - 1; i++) {\n                boundaryMin = Math.min(boundaryMin, z[0][i]);\n                boundaryMin = Math.min(boundaryMin, z[nb - 1][i]);\n                boundaryMax = Math.max(boundaryMax, z[0][i]);\n                boundaryMax = Math.max(boundaryMax, z[nb - 1][i]);\n            }\n\n            var contoursValue = contours.value;\n            var v1, v2;\n\n            switch(contours._operation) {\n                case '>':\n                    if(contoursValue > boundaryMax) {\n                        pi0.prefixBoundary = true;\n                    }\n                    break;\n                case '<':\n                    if(contoursValue < boundaryMin ||\n                        (pi0.starts.length && contoursValue === boundaryMin)) {\n                        pi0.prefixBoundary = true;\n                    }\n                    break;\n                case '[]':\n                    v1 = Math.min(contoursValue[0], contoursValue[1]);\n                    v2 = Math.max(contoursValue[0], contoursValue[1]);\n                    if(v2 < boundaryMin || v1 > boundaryMax ||\n                        (pi0.starts.length && v2 === boundaryMin)) {\n                        pi0.prefixBoundary = true;\n                    }\n                    break;\n                case '][':\n                    v1 = Math.min(contoursValue[0], contoursValue[1]);\n                    v2 = Math.max(contoursValue[0], contoursValue[1]);\n                    if(v1 < boundaryMin && v2 > boundaryMax) {\n                        pi0.prefixBoundary = true;\n                    }\n                    break;\n            }\n            break;\n    }\n};\n","'use strict';\n\nvar Colorscale = require('../../components/colorscale');\nvar makeColorMap = require('./make_color_map');\nvar endPlus = require('./end_plus');\n\nfunction calc(gd, trace, opts) {\n    var contours = trace.contours;\n    var line = trace.line;\n    var cs = contours.size || 1;\n    var coloring = contours.coloring;\n    var colorMap = makeColorMap(trace, {isColorbar: true});\n\n    if(coloring === 'heatmap') {\n        var cOpts = Colorscale.extractOpts(trace);\n        opts._fillgradient = cOpts.reversescale ?\n            Colorscale.flipScale(cOpts.colorscale) :\n            cOpts.colorscale;\n        opts._zrange = [cOpts.min, cOpts.max];\n    } else if(coloring === 'fill') {\n        opts._fillcolor = colorMap;\n    }\n\n    opts._line = {\n        color: coloring === 'lines' ? colorMap : line.color,\n        width: contours.showlines !== false ? line.width : 0,\n        dash: line.dash\n    };\n\n    opts._levels = {\n        start: contours.start,\n        end: endPlus(contours),\n        size: cs\n    };\n}\n\nmodule.exports = {\n    min: 'zmin',\n    max: 'zmax',\n    calc: calc\n};\n","'use strict';\nmodule.exports = {\n    // some constants to help with marching squares algorithm\n    // where does the path start for each index?\n    BOTTOMSTART: [1, 9, 13, 104, 713],\n    TOPSTART: [4, 6, 7, 104, 713],\n    LEFTSTART: [8, 12, 14, 208, 1114],\n    RIGHTSTART: [2, 3, 11, 208, 1114],\n\n    // which way [dx,dy] do we leave a given index?\n    // saddles are already disambiguated\n    NEWDELTA: [\n        null, [-1, 0], [0, -1], [-1, 0],\n        [1, 0], null, [0, -1], [-1, 0],\n        [0, 1], [0, 1], null, [0, 1],\n        [1, 0], [1, 0], [0, -1]\n    ],\n\n    // for each saddle, the first index here is used\n    // for dx||dy<0, the second for dx||dy>0\n    CHOOSESADDLE: {\n        104: [4, 1],\n        208: [2, 8],\n        713: [7, 13],\n        1114: [11, 14]\n    },\n\n    // after one index has been used for a saddle, which do we\n    // substitute to be used up later?\n    SADDLEREMAINDER: {1: 4, 2: 8, 4: 1, 7: 13, 8: 2, 11: 14, 13: 7, 14: 11},\n\n    // length of a contour, as a multiple of the plot area diagonal, per label\n    LABELDISTANCE: 2,\n\n    // number of contour levels after which we start increasing the number of\n    // labels we draw. Many contours means they will generally be close\n    // together, so it will be harder to follow a long way to find a label\n    LABELINCREASE: 10,\n\n    // minimum length of a contour line, as a multiple of the label length,\n    // at which we draw *any* labels\n    LABELMIN: 3,\n\n    // max number of labels to draw on a single contour path, no matter how long\n    LABELMAX: 10,\n\n    // constants for the label position cost function\n    LABELOPTIMIZER: {\n        // weight given to edge proximity\n        EDGECOST: 1,\n        // weight given to the angle off horizontal\n        ANGLECOST: 1,\n        // weight given to distance from already-placed labels\n        NEIGHBORCOST: 5,\n        // cost multiplier for labels on the same level\n        SAMELEVELFACTOR: 10,\n        // minimum distance (as a multiple of the label length)\n        // for labels on the same level\n        SAMELEVELDISTANCE: 5,\n        // maximum cost before we won't even place the label\n        MAXCOST: 100,\n        // number of evenly spaced points to look at in the first\n        // iteration of the search\n        INITIALSEARCHPOINTS: 10,\n        // number of binary search iterations after the initial wide search\n        ITERATIONS: 5\n    }\n};\n","'use strict';\nvar isNumeric = require('fast-isnumeric');\n\nvar handleLabelDefaults = require('./label_defaults');\n\nvar Color = require('../../components/color');\nvar addOpacity = Color.addOpacity;\nvar opacity = Color.opacity;\n\nvar filterOps = require('../../constants/filter_ops');\nvar CONSTRAINT_REDUCTION = filterOps.CONSTRAINT_REDUCTION;\nvar COMPARISON_OPS2 = filterOps.COMPARISON_OPS2;\n\nmodule.exports = function handleConstraintDefaults(traceIn, traceOut, coerce, layout, defaultColor, opts) {\n    var contours = traceOut.contours;\n    var showLines, lineColor, fillColor;\n\n    var operation = coerce('contours.operation');\n    contours._operation = CONSTRAINT_REDUCTION[operation];\n\n    handleConstraintValueDefaults(coerce, contours);\n\n    if(operation === '=') {\n        showLines = contours.showlines = true;\n    } else {\n        showLines = coerce('contours.showlines');\n        fillColor = coerce('fillcolor', addOpacity(\n            (traceIn.line || {}).color || defaultColor, 0.5\n        ));\n    }\n\n    if(showLines) {\n        var lineDfltColor = fillColor && opacity(fillColor) ?\n            addOpacity(traceOut.fillcolor, 1) :\n            defaultColor;\n        lineColor = coerce('line.color', lineDfltColor);\n        coerce('line.width', 2);\n        coerce('line.dash');\n    }\n\n    coerce('line.smoothing');\n\n    handleLabelDefaults(coerce, layout, lineColor, opts);\n};\n\nfunction handleConstraintValueDefaults(coerce, contours) {\n    var zvalue;\n\n    if(COMPARISON_OPS2.indexOf(contours.operation) === -1) {\n        // Requires an array of two numbers:\n        coerce('contours.value', [0, 1]);\n\n        if(!Array.isArray(contours.value)) {\n            if(isNumeric(contours.value)) {\n                zvalue = parseFloat(contours.value);\n                contours.value = [zvalue, zvalue + 1];\n            }\n        } else if(contours.value.length > 2) {\n            contours.value = contours.value.slice(2);\n        } else if(contours.length === 0) {\n            contours.value = [0, 1];\n        } else if(contours.length < 2) {\n            zvalue = parseFloat(contours.value[0]);\n            contours.value = [zvalue, zvalue + 1];\n        } else {\n            contours.value = [\n                parseFloat(contours.value[0]),\n                parseFloat(contours.value[1])\n            ];\n        }\n    } else {\n        // Requires a single scalar:\n        coerce('contours.value', 0);\n\n        if(!isNumeric(contours.value)) {\n            if(Array.isArray(contours.value)) {\n                contours.value = parseFloat(contours.value[0]);\n            } else {\n                contours.value = 0;\n            }\n        }\n    }\n}\n","'use strict';\n\nvar filterOps = require('../../constants/filter_ops');\nvar isNumeric = require('fast-isnumeric');\n\n// This syntax conforms to the existing filter transform syntax, but we don't care\n// about open vs. closed intervals for simply drawing contours constraints:\nmodule.exports = {\n    '[]': makeRangeSettings('[]'),\n    '][': makeRangeSettings(']['),\n    '>': makeInequalitySettings('>'),\n    '<': makeInequalitySettings('<'),\n    '=': makeInequalitySettings('=')\n};\n\n// This does not in any way shape or form support calendars. It's adapted from\n// transforms/filter.js.\nfunction coerceValue(operation, value) {\n    var hasArrayValue = Array.isArray(value);\n\n    var coercedValue;\n\n    function coerce(value) {\n        return isNumeric(value) ? (+value) : null;\n    }\n\n    if(filterOps.COMPARISON_OPS2.indexOf(operation) !== -1) {\n        coercedValue = hasArrayValue ? coerce(value[0]) : coerce(value);\n    } else if(filterOps.INTERVAL_OPS.indexOf(operation) !== -1) {\n        coercedValue = hasArrayValue ?\n            [coerce(value[0]), coerce(value[1])] :\n            [coerce(value), coerce(value)];\n    } else if(filterOps.SET_OPS.indexOf(operation) !== -1) {\n        coercedValue = hasArrayValue ? value.map(coerce) : [coerce(value)];\n    }\n\n    return coercedValue;\n}\n\n// Returns a parabola scaled so that the min/max is either +/- 1 and zero at the two values\n// provided. The data is mapped by this function when constructing intervals so that it's\n// very easy to construct contours as normal.\nfunction makeRangeSettings(operation) {\n    return function(value) {\n        value = coerceValue(operation, value);\n\n        // Ensure proper ordering:\n        var min = Math.min(value[0], value[1]);\n        var max = Math.max(value[0], value[1]);\n\n        return {\n            start: min,\n            end: max,\n            size: max - min\n        };\n    };\n}\n\nfunction makeInequalitySettings(operation) {\n    return function(value) {\n        value = coerceValue(operation, value);\n\n        return {\n            start: value,\n            end: Infinity,\n            size: Infinity\n        };\n    };\n}\n","'use strict';\n\nmodule.exports = function handleContourDefaults(traceIn, traceOut, coerce, coerce2) {\n    var contourStart = coerce2('contours.start');\n    var contourEnd = coerce2('contours.end');\n    var missingEnd = (contourStart === false) || (contourEnd === false);\n\n    // normally we only need size if autocontour is off. But contour.calc\n    // pushes its calculated contour size back to the input trace, so for\n    // things like restyle that can call supplyDefaults without calc\n    // after the initial draw, we can just reuse the previous calculation\n    var contourSize = coerce('contours.size');\n    var autoContour;\n\n    if(missingEnd) autoContour = traceOut.autocontour = true;\n    else autoContour = coerce('autocontour', false);\n\n    if(autoContour || !contourSize) coerce('ncontours');\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\n// The contour extraction is great, except it totally fails for constraints because we\n// need weird range loops and flipped contours instead of the usual format. This function\n// does some weird manipulation of the extracted pathinfo data such that it magically\n// draws contours correctly *as* constraints.\n//\n// ** I do not know which \"weird range loops\" the comment above is referring to.\nmodule.exports = function(pathinfo, operation) {\n    var i, pi0, pi1;\n\n    var op0 = function(arr) { return arr.reverse(); };\n    var op1 = function(arr) { return arr; };\n\n    switch(operation) {\n        case '=':\n        case '<':\n            return pathinfo;\n        case '>':\n            if(pathinfo.length !== 1) {\n                Lib.warn('Contour data invalid for the specified inequality operation.');\n            }\n\n            // In this case there should be exactly one contour levels in pathinfo.\n            // We flip all of the data. This will draw the contour as closed.\n            pi0 = pathinfo[0];\n\n            for(i = 0; i < pi0.edgepaths.length; i++) {\n                pi0.edgepaths[i] = op0(pi0.edgepaths[i]);\n            }\n            for(i = 0; i < pi0.paths.length; i++) {\n                pi0.paths[i] = op0(pi0.paths[i]);\n            }\n            for(i = 0; i < pi0.starts.length; i++) {\n                pi0.starts[i] = op0(pi0.starts[i]);\n            }\n\n            return pathinfo;\n        case '][':\n            var tmp = op0;\n            op0 = op1;\n            op1 = tmp;\n            // It's a nice rule, except this definitely *is* what's intended here.\n            /* eslint-disable: no-fallthrough */\n        case '[]':\n            /* eslint-enable: no-fallthrough */\n            if(pathinfo.length !== 2) {\n                Lib.warn('Contour data invalid for the specified inequality range operation.');\n            }\n\n            // In this case there should be exactly two contour levels in pathinfo.\n            // - We concatenate the info into one pathinfo.\n            // - We must also flip all of the data in the `[]` case.\n            // This will draw the contours as closed.\n            pi0 = copyPathinfo(pathinfo[0]);\n            pi1 = copyPathinfo(pathinfo[1]);\n\n            for(i = 0; i < pi0.edgepaths.length; i++) {\n                pi0.edgepaths[i] = op0(pi0.edgepaths[i]);\n            }\n            for(i = 0; i < pi0.paths.length; i++) {\n                pi0.paths[i] = op0(pi0.paths[i]);\n            }\n            for(i = 0; i < pi0.starts.length; i++) {\n                pi0.starts[i] = op0(pi0.starts[i]);\n            }\n\n            while(pi1.edgepaths.length) {\n                pi0.edgepaths.push(op1(pi1.edgepaths.shift()));\n            }\n            while(pi1.paths.length) {\n                pi0.paths.push(op1(pi1.paths.shift()));\n            }\n            while(pi1.starts.length) {\n                pi0.starts.push(op1(pi1.starts.shift()));\n            }\n\n            return [pi0];\n    }\n};\n\nfunction copyPathinfo(pi) {\n    return Lib.extendFlat({}, pi, {\n        edgepaths: Lib.extendDeep([], pi.edgepaths),\n        paths: Lib.extendDeep([], pi.paths),\n        starts: Lib.extendDeep([], pi.starts)\n    });\n}\n","'use strict';\n\nvar Lib = require('../../lib');\n\nvar handleXYZDefaults = require('../heatmap/xyz_defaults');\nvar handlePeriodDefaults = require('../scatter/period_defaults');\nvar handleConstraintDefaults = require('./constraint_defaults');\nvar handleContoursDefaults = require('./contours_defaults');\nvar handleStyleDefaults = require('./style_defaults');\nvar attributes = require('./attributes');\n\n\nmodule.exports = function supplyDefaults(traceIn, traceOut, defaultColor, layout) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(traceIn, traceOut, attributes, attr, dflt);\n    }\n\n    function coerce2(attr) {\n        return Lib.coerce2(traceIn, traceOut, attributes, attr);\n    }\n\n    var len = handleXYZDefaults(traceIn, traceOut, coerce, layout);\n    if(!len) {\n        traceOut.visible = false;\n        return;\n    }\n\n    handlePeriodDefaults(traceIn, traceOut, layout, coerce);\n    coerce('xhoverformat');\n    coerce('yhoverformat');\n\n    coerce('text');\n    coerce('hovertext');\n    coerce('hovertemplate');\n    coerce('hoverongaps');\n\n    var isConstraint = (coerce('contours.type') === 'constraint');\n    coerce('connectgaps', Lib.isArray1D(traceOut.z));\n\n    if(isConstraint) {\n        handleConstraintDefaults(traceIn, traceOut, coerce, layout, defaultColor);\n    } else {\n        handleContoursDefaults(traceIn, traceOut, coerce, coerce2);\n        handleStyleDefaults(traceIn, traceOut, coerce, layout);\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar constraintMapping = require('./constraint_mapping');\nvar endPlus = require('./end_plus');\n\nmodule.exports = function emptyPathinfo(contours, plotinfo, cd0) {\n    var contoursFinal = (contours.type === 'constraint') ?\n        constraintMapping[contours._operation](contours.value) :\n        contours;\n\n    var cs = contoursFinal.size;\n    var pathinfo = [];\n    var end = endPlus(contoursFinal);\n\n    var carpet = cd0.trace._carpetTrace;\n\n    var basePathinfo = carpet ? {\n        // store axes so we can convert to px\n        xaxis: carpet.aaxis,\n        yaxis: carpet.baxis,\n        // full data arrays to use for interpolation\n        x: cd0.a,\n        y: cd0.b\n    } : {\n        xaxis: plotinfo.xaxis,\n        yaxis: plotinfo.yaxis,\n        x: cd0.x,\n        y: cd0.y\n    };\n\n    for(var ci = contoursFinal.start; ci < end; ci += cs) {\n        pathinfo.push(Lib.extendFlat({\n            level: ci,\n            // all the cells with nontrivial marching index\n            crossings: {},\n            // starting points on the edges of the lattice for each contour\n            starts: [],\n            // all unclosed paths (may have less items than starts,\n            // if a path is closed by rounding)\n            edgepaths: [],\n            // all closed paths\n            paths: [],\n            z: cd0.z,\n            smoothing: cd0.trace.line.smoothing\n        }, basePathinfo));\n\n        if(pathinfo.length > 1000) {\n            Lib.warn('Too many contours, clipping at 1000', contours);\n            break;\n        }\n    }\n    return pathinfo;\n};\n","'use strict';\n\n/*\n * tiny helper to move the end of the contours a little to prevent\n * losing the last contour to rounding errors\n */\nmodule.exports = function endPlus(contours) {\n    return contours.end + contours.size / 1e6;\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar constants = require('./constants');\n\nmodule.exports = function findAllPaths(pathinfo, xtol, ytol) {\n    var cnt,\n        startLoc,\n        i,\n        pi,\n        j;\n\n    // Default just passes these values through as they were before:\n    xtol = xtol || 0.01;\n    ytol = ytol || 0.01;\n\n    for(i = 0; i < pathinfo.length; i++) {\n        pi = pathinfo[i];\n\n        for(j = 0; j < pi.starts.length; j++) {\n            startLoc = pi.starts[j];\n            makePath(pi, startLoc, 'edge', xtol, ytol);\n        }\n\n        cnt = 0;\n        while(Object.keys(pi.crossings).length && cnt < 10000) {\n            cnt++;\n            startLoc = Object.keys(pi.crossings)[0].split(',').map(Number);\n            makePath(pi, startLoc, undefined, xtol, ytol);\n        }\n        if(cnt === 10000) Lib.log('Infinite loop in contour?');\n    }\n};\n\nfunction equalPts(pt1, pt2, xtol, ytol) {\n    return Math.abs(pt1[0] - pt2[0]) < xtol &&\n           Math.abs(pt1[1] - pt2[1]) < ytol;\n}\n\n// distance in index units - uses the 3rd and 4th items in points\nfunction ptDist(pt1, pt2) {\n    var dx = pt1[2] - pt2[2];\n    var dy = pt1[3] - pt2[3];\n    return Math.sqrt(dx * dx + dy * dy);\n}\n\nfunction makePath(pi, loc, edgeflag, xtol, ytol) {\n    var locStr = loc.join(',');\n    var mi = pi.crossings[locStr];\n    var marchStep = getStartStep(mi, edgeflag, loc);\n    // start by going backward a half step and finding the crossing point\n    var pts = [getInterpPx(pi, loc, [-marchStep[0], -marchStep[1]])];\n    var m = pi.z.length;\n    var n = pi.z[0].length;\n    var startLoc = loc.slice();\n    var startStep = marchStep.slice();\n    var cnt;\n\n    // now follow the path\n    for(cnt = 0; cnt < 10000; cnt++) { // just to avoid infinite loops\n        if(mi > 20) {\n            mi = constants.CHOOSESADDLE[mi][(marchStep[0] || marchStep[1]) < 0 ? 0 : 1];\n            pi.crossings[locStr] = constants.SADDLEREMAINDER[mi];\n        } else {\n            delete pi.crossings[locStr];\n        }\n\n        marchStep = constants.NEWDELTA[mi];\n        if(!marchStep) {\n            Lib.log('Found bad marching index:', mi, loc, pi.level);\n            break;\n        }\n\n        // find the crossing a half step forward, and then take the full step\n        pts.push(getInterpPx(pi, loc, marchStep));\n        loc[0] += marchStep[0];\n        loc[1] += marchStep[1];\n        locStr = loc.join(',');\n\n        // don't include the same point multiple times\n        if(equalPts(pts[pts.length - 1], pts[pts.length - 2], xtol, ytol)) pts.pop();\n\n        var atEdge = (marchStep[0] && (loc[0] < 0 || loc[0] > n - 2)) ||\n                (marchStep[1] && (loc[1] < 0 || loc[1] > m - 2));\n\n        var closedLoop = loc[0] === startLoc[0] && loc[1] === startLoc[1] &&\n                marchStep[0] === startStep[0] && marchStep[1] === startStep[1];\n\n        // have we completed a loop, or reached an edge?\n        if((closedLoop) || (edgeflag && atEdge)) break;\n\n        mi = pi.crossings[locStr];\n    }\n\n    if(cnt === 10000) {\n        Lib.log('Infinite loop in contour?');\n    }\n    var closedpath = equalPts(pts[0], pts[pts.length - 1], xtol, ytol);\n    var totaldist = 0;\n    var distThresholdFactor = 0.2 * pi.smoothing;\n    var alldists = [];\n    var cropstart = 0;\n    var distgroup, cnt2, cnt3, newpt, ptcnt, ptavg, thisdist,\n        i, j, edgepathi, edgepathj;\n\n    /*\n     * Check for points that are too close together (<1/5 the average dist\n     * *in grid index units* (important for log axes and nonuniform grids),\n     * less if less smoothed) and just take the center (or avg of center 2).\n     * This cuts down on funny behavior when a point is very close to a\n     * contour level.\n     */\n    for(cnt = 1; cnt < pts.length; cnt++) {\n        thisdist = ptDist(pts[cnt], pts[cnt - 1]);\n        totaldist += thisdist;\n        alldists.push(thisdist);\n    }\n\n    var distThreshold = totaldist / alldists.length * distThresholdFactor;\n\n    function getpt(i) { return pts[i % pts.length]; }\n\n    for(cnt = pts.length - 2; cnt >= cropstart; cnt--) {\n        distgroup = alldists[cnt];\n        if(distgroup < distThreshold) {\n            cnt3 = 0;\n            for(cnt2 = cnt - 1; cnt2 >= cropstart; cnt2--) {\n                if(distgroup + alldists[cnt2] < distThreshold) {\n                    distgroup += alldists[cnt2];\n                } else break;\n            }\n\n            // closed path with close points wrapping around the boundary?\n            if(closedpath && cnt === pts.length - 2) {\n                for(cnt3 = 0; cnt3 < cnt2; cnt3++) {\n                    if(distgroup + alldists[cnt3] < distThreshold) {\n                        distgroup += alldists[cnt3];\n                    } else break;\n                }\n            }\n            ptcnt = cnt - cnt2 + cnt3 + 1;\n            ptavg = Math.floor((cnt + cnt2 + cnt3 + 2) / 2);\n\n            // either endpoint included: keep the endpoint\n            if(!closedpath && cnt === pts.length - 2) newpt = pts[pts.length - 1];\n            else if(!closedpath && cnt2 === -1) newpt = pts[0];\n\n            // odd # of points - just take the central one\n            else if(ptcnt % 2) newpt = getpt(ptavg);\n\n            // even # of pts - average central two\n            else {\n                newpt = [(getpt(ptavg)[0] + getpt(ptavg + 1)[0]) / 2,\n                    (getpt(ptavg)[1] + getpt(ptavg + 1)[1]) / 2];\n            }\n\n            pts.splice(cnt2 + 1, cnt - cnt2 + 1, newpt);\n            cnt = cnt2 + 1;\n            if(cnt3) cropstart = cnt3;\n            if(closedpath) {\n                if(cnt === pts.length - 2) pts[cnt3] = pts[pts.length - 1];\n                else if(cnt === 0) pts[pts.length - 1] = pts[0];\n            }\n        }\n    }\n    pts.splice(0, cropstart);\n\n    // done with the index parts - remove them so path generation works right\n    // because it depends on only having [xpx, ypx]\n    for(cnt = 0; cnt < pts.length; cnt++) pts[cnt].length = 2;\n\n    // don't return single-point paths (ie all points were the same\n    // so they got deleted?)\n    if(pts.length < 2) return;\n    else if(closedpath) {\n        pts.pop();\n        pi.paths.push(pts);\n    } else {\n        if(!edgeflag) {\n            Lib.log('Unclosed interior contour?',\n                pi.level, startLoc.join(','), pts.join('L'));\n        }\n\n        // edge path - does it start where an existing edge path ends, or vice versa?\n        var merged = false;\n        for(i = 0; i < pi.edgepaths.length; i++) {\n            edgepathi = pi.edgepaths[i];\n            if(!merged && equalPts(edgepathi[0], pts[pts.length - 1], xtol, ytol)) {\n                pts.pop();\n                merged = true;\n\n                // now does it ALSO meet the end of another (or the same) path?\n                var doublemerged = false;\n                for(j = 0; j < pi.edgepaths.length; j++) {\n                    edgepathj = pi.edgepaths[j];\n                    if(equalPts(edgepathj[edgepathj.length - 1], pts[0], xtol, ytol)) {\n                        doublemerged = true;\n                        pts.shift();\n                        pi.edgepaths.splice(i, 1);\n                        if(j === i) {\n                            // the path is now closed\n                            pi.paths.push(pts.concat(edgepathj));\n                        } else {\n                            if(j > i) j--;\n                            pi.edgepaths[j] = edgepathj.concat(pts, edgepathi);\n                        }\n                        break;\n                    }\n                }\n                if(!doublemerged) {\n                    pi.edgepaths[i] = pts.concat(edgepathi);\n                }\n            }\n        }\n        for(i = 0; i < pi.edgepaths.length; i++) {\n            if(merged) break;\n            edgepathi = pi.edgepaths[i];\n            if(equalPts(edgepathi[edgepathi.length - 1], pts[0], xtol, ytol)) {\n                pts.shift();\n                pi.edgepaths[i] = edgepathi.concat(pts);\n                merged = true;\n            }\n        }\n\n        if(!merged) pi.edgepaths.push(pts);\n    }\n}\n\n// special function to get the marching step of the\n// first point in the path (leading to loc)\nfunction getStartStep(mi, edgeflag, loc) {\n    var dx = 0;\n    var dy = 0;\n    if(mi > 20 && edgeflag) {\n        // these saddles start at +/- x\n        if(mi === 208 || mi === 1114) {\n            // if we're starting at the left side, we must be going right\n            dx = loc[0] === 0 ? 1 : -1;\n        } else {\n            // if we're starting at the bottom, we must be going up\n            dy = loc[1] === 0 ? 1 : -1;\n        }\n    } else if(constants.BOTTOMSTART.indexOf(mi) !== -1) dy = 1;\n    else if(constants.LEFTSTART.indexOf(mi) !== -1) dx = 1;\n    else if(constants.TOPSTART.indexOf(mi) !== -1) dy = -1;\n    else dx = -1;\n    return [dx, dy];\n}\n\n/*\n * Find the pixel coordinates of a particular crossing\n *\n * @param {object} pi: the pathinfo object at this level\n * @param {array} loc: the grid index [x, y] of the crossing\n * @param {array} step: the direction [dx, dy] we're moving on the grid\n *\n * @return {array} [xpx, ypx, xi, yi]: the first two are the pixel location,\n *   the next two are the interpolated grid indices, which we use for\n *   distance calculations to delete points that are too close together.\n *   This is important when the grid is nonuniform (and most dramatically when\n *   we're on log axes and include invalid (0 or negative) values.\n *   It's crucial to delete these extra two before turning an array of these\n *   points into a path, because those routines require length-2 points.\n */\nfunction getInterpPx(pi, loc, step) {\n    var locx = loc[0] + Math.max(step[0], 0);\n    var locy = loc[1] + Math.max(step[1], 0);\n    var zxy = pi.z[locy][locx];\n    var xa = pi.xaxis;\n    var ya = pi.yaxis;\n\n    if(step[1]) {\n        var dx = (pi.level - zxy) / (pi.z[locy][locx + 1] - zxy);\n\n        return [xa.c2p((1 - dx) * pi.x[locx] + dx * pi.x[locx + 1], true),\n            ya.c2p(pi.y[locy], true),\n            locx + dx, locy];\n    } else {\n        var dy = (pi.level - zxy) / (pi.z[locy + 1][locx] - zxy);\n        return [xa.c2p(pi.x[locx], true),\n            ya.c2p((1 - dy) * pi.y[locy] + dy * pi.y[locy + 1], true),\n            locx, locy + dy];\n    }\n}\n","'use strict';\n\nvar Color = require('../../components/color');\n\nvar heatmapHoverPoints = require('../heatmap/hover');\n\nmodule.exports = function hoverPoints(pointData, xval, yval, hovermode, opts) {\n    if(!opts) opts = {};\n    opts.isContour = true;\n\n    var hoverData = heatmapHoverPoints(pointData, xval, yval, hovermode, opts);\n\n    if(hoverData) {\n        hoverData.forEach(function(hoverPt) {\n            var trace = hoverPt.trace;\n            if(trace.contours.type === 'constraint') {\n                if(trace.fillcolor && Color.opacity(trace.fillcolor)) {\n                    hoverPt.color = Color.addOpacity(trace.fillcolor, 1);\n                } else if(trace.contours.showlines && Color.opacity(trace.line.color)) {\n                    hoverPt.color = Color.addOpacity(trace.line.color, 1);\n                }\n            }\n        });\n    }\n\n    return hoverData;\n};\n","'use strict';\n\nmodule.exports = {\n    attributes: require('./attributes'),\n    supplyDefaults: require('./defaults'),\n    calc: require('./calc'),\n    plot: require('./plot').plot,\n    style: require('./style'),\n    colorbar: require('./colorbar'),\n    hoverPoints: require('./hover'),\n\n    moduleType: 'trace',\n    name: 'contour',\n    basePlotModule: require('../../plots/cartesian'),\n    categories: ['cartesian', 'svg', '2dMap', 'contour', 'showLegend'],\n    meta: {\n        description: [\n            'The data from which contour lines are computed is set in `z`.',\n            'Data in `z` must be a {2D array} of numbers.',\n\n            'Say that `z` has N rows and M columns, then by default,',\n            'these N rows correspond to N y coordinates',\n            '(set in `y` or auto-generated) and the M columns',\n            'correspond to M x coordinates (set in `x` or auto-generated).',\n            'By setting `transpose` to *true*, the above behavior is flipped.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\nmodule.exports = function handleLabelDefaults(coerce, layout, lineColor, opts) {\n    if(!opts) opts = {};\n    var showLabels = coerce('contours.showlabels');\n    if(showLabels) {\n        var globalFont = layout.font;\n        Lib.coerceFont(coerce, 'contours.labelfont', {\n            family: globalFont.family,\n            size: globalFont.size,\n            color: lineColor\n        });\n        coerce('contours.labelformat');\n    }\n\n    if(opts.hasHover !== false) coerce('zhoverformat');\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Colorscale = require('../../components/colorscale');\nvar endPlus = require('./end_plus');\n\nmodule.exports = function makeColorMap(trace) {\n    var contours = trace.contours;\n    var start = contours.start;\n    var end = endPlus(contours);\n    var cs = contours.size || 1;\n    var nc = Math.floor((end - start) / cs) + 1;\n    var extra = contours.coloring === 'lines' ? 0 : 1;\n    var cOpts = Colorscale.extractOpts(trace);\n\n    if(!isFinite(cs)) {\n        cs = 1;\n        nc = 1;\n    }\n\n    var scl = cOpts.reversescale ?\n        Colorscale.flipScale(cOpts.colorscale) :\n        cOpts.colorscale;\n\n    var len = scl.length;\n    var domain = new Array(len);\n    var range = new Array(len);\n\n    var si, i;\n\n    if(contours.coloring === 'heatmap') {\n        var zmin0 = cOpts.min;\n        var zmax0 = cOpts.max;\n\n        for(i = 0; i < len; i++) {\n            si = scl[i];\n            domain[i] = si[0] * (zmax0 - zmin0) + zmin0;\n            range[i] = si[1];\n        }\n\n        // do the contours extend beyond the colorscale?\n        // if so, extend the colorscale with constants\n        var zRange = d3.extent([\n            zmin0,\n            zmax0,\n            contours.start,\n            contours.start + cs * (nc - 1)\n        ]);\n        var zmin = zRange[zmin0 < zmax0 ? 0 : 1];\n        var zmax = zRange[zmin0 < zmax0 ? 1 : 0];\n\n        if(zmin !== zmin0) {\n            domain.splice(0, 0, zmin);\n            range.splice(0, 0, range[0]);\n        }\n\n        if(zmax !== zmax0) {\n            domain.push(zmax);\n            range.push(range[range.length - 1]);\n        }\n    } else {\n        for(i = 0; i < len; i++) {\n            si = scl[i];\n            domain[i] = (si[0] * (nc + extra - 1) - (extra / 2)) * cs + start;\n            range[i] = si[1];\n        }\n    }\n\n    return Colorscale.makeColorScaleFunc(\n        {domain: domain, range: range},\n        {noNumericCheck: true}\n    );\n};\n","'use strict';\n\nvar constants = require('./constants');\n\n// Calculate all the marching indices, for ALL levels at once.\n// since we want to be exhaustive we'll check for contour crossings\n// at every intersection, rather than just following a path\n// TODO: shorten the inner loop to only the relevant levels\nmodule.exports = function makeCrossings(pathinfo) {\n    var z = pathinfo[0].z;\n    var m = z.length;\n    var n = z[0].length; // we already made sure z isn't ragged in interp2d\n    var twoWide = m === 2 || n === 2;\n    var xi;\n    var yi;\n    var startIndices;\n    var ystartIndices;\n    var label;\n    var corners;\n    var mi;\n    var pi;\n    var i;\n\n    for(yi = 0; yi < m - 1; yi++) {\n        ystartIndices = [];\n        if(yi === 0) ystartIndices = ystartIndices.concat(constants.BOTTOMSTART);\n        if(yi === m - 2) ystartIndices = ystartIndices.concat(constants.TOPSTART);\n\n        for(xi = 0; xi < n - 1; xi++) {\n            startIndices = ystartIndices.slice();\n            if(xi === 0) startIndices = startIndices.concat(constants.LEFTSTART);\n            if(xi === n - 2) startIndices = startIndices.concat(constants.RIGHTSTART);\n\n            label = xi + ',' + yi;\n            corners = [[z[yi][xi], z[yi][xi + 1]],\n                       [z[yi + 1][xi], z[yi + 1][xi + 1]]];\n            for(i = 0; i < pathinfo.length; i++) {\n                pi = pathinfo[i];\n                mi = getMarchingIndex(pi.level, corners);\n                if(!mi) continue;\n\n                pi.crossings[label] = mi;\n                if(startIndices.indexOf(mi) !== -1) {\n                    pi.starts.push([xi, yi]);\n                    if(twoWide && startIndices.indexOf(mi,\n                            startIndices.indexOf(mi) + 1) !== -1) {\n                        // the same square has starts from opposite sides\n                        // it's not possible to have starts on opposite edges\n                        // of a corner, only a start and an end...\n                        // but if the array is only two points wide (either way)\n                        // you can have starts on opposite sides.\n                        pi.starts.push([xi, yi]);\n                    }\n                }\n            }\n        }\n    }\n};\n\n// modified marching squares algorithm,\n// so we disambiguate the saddle points from the start\n// and we ignore the cases with no crossings\n// the index I'm using is based on:\n// http://en.wikipedia.org/wiki/Marching_squares\n// except that the saddles bifurcate and I represent them\n// as the decimal combination of the two appropriate\n// non-saddle indices\nfunction getMarchingIndex(val, corners) {\n    var mi = (corners[0][0] > val ? 0 : 1) +\n             (corners[0][1] > val ? 0 : 2) +\n             (corners[1][1] > val ? 0 : 4) +\n             (corners[1][0] > val ? 0 : 8);\n    if(mi === 5 || mi === 10) {\n        var avg = (corners[0][0] + corners[0][1] +\n                   corners[1][0] + corners[1][1]) / 4;\n        // two peaks with a big valley\n        if(val > avg) return (mi === 5) ? 713 : 1114;\n        // two valleys with a big ridge\n        return (mi === 5) ? 104 : 208;\n    }\n    return (mi === 15) ? 0 : mi;\n}\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Lib = require('../../lib');\nvar Drawing = require('../../components/drawing');\nvar Colorscale = require('../../components/colorscale');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar Axes = require('../../plots/cartesian/axes');\nvar setConvert = require('../../plots/cartesian/set_convert');\n\nvar heatmapPlot = require('../heatmap/plot');\nvar makeCrossings = require('./make_crossings');\nvar findAllPaths = require('./find_all_paths');\nvar emptyPathinfo = require('./empty_pathinfo');\nvar convertToConstraints = require('./convert_to_constraints');\nvar closeBoundaries = require('./close_boundaries');\nvar constants = require('./constants');\nvar costConstants = constants.LABELOPTIMIZER;\n\nexports.plot = function plot(gd, plotinfo, cdcontours, contourLayer) {\n    var xa = plotinfo.xaxis;\n    var ya = plotinfo.yaxis;\n\n    Lib.makeTraceGroups(contourLayer, cdcontours, 'contour').each(function(cd) {\n        var plotGroup = d3.select(this);\n        var cd0 = cd[0];\n        var trace = cd0.trace;\n        var x = cd0.x;\n        var y = cd0.y;\n        var contours = trace.contours;\n        var pathinfo = emptyPathinfo(contours, plotinfo, cd0);\n\n        // use a heatmap to fill - draw it behind the lines\n        var heatmapColoringLayer = Lib.ensureSingle(plotGroup, 'g', 'heatmapcoloring');\n        var cdheatmaps = [];\n        if(contours.coloring === 'heatmap') {\n            cdheatmaps = [cd];\n        }\n        heatmapPlot(gd, plotinfo, cdheatmaps, heatmapColoringLayer);\n\n        makeCrossings(pathinfo);\n        findAllPaths(pathinfo);\n\n        var leftedge = xa.c2p(x[0], true);\n        var rightedge = xa.c2p(x[x.length - 1], true);\n        var bottomedge = ya.c2p(y[0], true);\n        var topedge = ya.c2p(y[y.length - 1], true);\n        var perimeter = [\n            [leftedge, topedge],\n            [rightedge, topedge],\n            [rightedge, bottomedge],\n            [leftedge, bottomedge]\n        ];\n\n        var fillPathinfo = pathinfo;\n        if(contours.type === 'constraint') {\n            // N.B. this also mutates pathinfo\n            fillPathinfo = convertToConstraints(pathinfo, contours._operation);\n        }\n\n        // draw everything\n        makeBackground(plotGroup, perimeter, contours);\n        makeFills(plotGroup, fillPathinfo, perimeter, contours);\n        makeLinesAndLabels(plotGroup, pathinfo, gd, cd0, contours);\n        clipGaps(plotGroup, plotinfo, gd, cd0, perimeter);\n    });\n};\n\nfunction makeBackground(plotgroup, perimeter, contours) {\n    var bggroup = Lib.ensureSingle(plotgroup, 'g', 'contourbg');\n\n    var bgfill = bggroup.selectAll('path')\n        .data(contours.coloring === 'fill' ? [0] : []);\n    bgfill.enter().append('path');\n    bgfill.exit().remove();\n    bgfill\n        .attr('d', 'M' + perimeter.join('L') + 'Z')\n        .style('stroke', 'none');\n}\n\nfunction makeFills(plotgroup, pathinfo, perimeter, contours) {\n    var hasFills = contours.coloring === 'fill' || (contours.type === 'constraint' && contours._operation !== '=');\n    var boundaryPath = 'M' + perimeter.join('L') + 'Z';\n\n    // fills prefixBoundary in pathinfo items\n    if(hasFills) {\n        closeBoundaries(pathinfo, contours);\n    }\n\n    var fillgroup = Lib.ensureSingle(plotgroup, 'g', 'contourfill');\n\n    var fillitems = fillgroup.selectAll('path').data(hasFills ? pathinfo : []);\n    fillitems.enter().append('path');\n    fillitems.exit().remove();\n    fillitems.each(function(pi) {\n        // join all paths for this level together into a single path\n        // first follow clockwise around the perimeter to close any open paths\n        // if the whole perimeter is above this level, start with a path\n        // enclosing the whole thing. With all that, the parity should mean\n        // that we always fill everything above the contour, nothing below\n        var fullpath = (pi.prefixBoundary ? boundaryPath : '') +\n            joinAllPaths(pi, perimeter);\n\n        if(!fullpath) {\n            d3.select(this).remove();\n        } else {\n            d3.select(this)\n                .attr('d', fullpath)\n                .style('stroke', 'none');\n        }\n    });\n}\n\nfunction joinAllPaths(pi, perimeter) {\n    var fullpath = '';\n    var i = 0;\n    var startsleft = pi.edgepaths.map(function(v, i) { return i; });\n    var newloop = true;\n    var endpt;\n    var newendpt;\n    var cnt;\n    var nexti;\n    var possiblei;\n    var addpath;\n\n    function istop(pt) { return Math.abs(pt[1] - perimeter[0][1]) < 0.01; }\n    function isbottom(pt) { return Math.abs(pt[1] - perimeter[2][1]) < 0.01; }\n    function isleft(pt) { return Math.abs(pt[0] - perimeter[0][0]) < 0.01; }\n    function isright(pt) { return Math.abs(pt[0] - perimeter[2][0]) < 0.01; }\n\n    while(startsleft.length) {\n        addpath = Drawing.smoothopen(pi.edgepaths[i], pi.smoothing);\n        fullpath += newloop ? addpath : addpath.replace(/^M/, 'L');\n        startsleft.splice(startsleft.indexOf(i), 1);\n        endpt = pi.edgepaths[i][pi.edgepaths[i].length - 1];\n        nexti = -1;\n\n        // now loop through sides, moving our endpoint until we find a new start\n        for(cnt = 0; cnt < 4; cnt++) { // just to prevent infinite loops\n            if(!endpt) {\n                Lib.log('Missing end?', i, pi);\n                break;\n            }\n\n            if(istop(endpt) && !isright(endpt)) newendpt = perimeter[1]; // right top\n            else if(isleft(endpt)) newendpt = perimeter[0]; // left top\n            else if(isbottom(endpt)) newendpt = perimeter[3]; // right bottom\n            else if(isright(endpt)) newendpt = perimeter[2]; // left bottom\n\n            for(possiblei = 0; possiblei < pi.edgepaths.length; possiblei++) {\n                var ptNew = pi.edgepaths[possiblei][0];\n                // is ptNew on the (horz. or vert.) segment from endpt to newendpt?\n                if(Math.abs(endpt[0] - newendpt[0]) < 0.01) {\n                    if(Math.abs(endpt[0] - ptNew[0]) < 0.01 &&\n                            (ptNew[1] - endpt[1]) * (newendpt[1] - ptNew[1]) >= 0) {\n                        newendpt = ptNew;\n                        nexti = possiblei;\n                    }\n                } else if(Math.abs(endpt[1] - newendpt[1]) < 0.01) {\n                    if(Math.abs(endpt[1] - ptNew[1]) < 0.01 &&\n                            (ptNew[0] - endpt[0]) * (newendpt[0] - ptNew[0]) >= 0) {\n                        newendpt = ptNew;\n                        nexti = possiblei;\n                    }\n                } else {\n                    Lib.log('endpt to newendpt is not vert. or horz.',\n                        endpt, newendpt, ptNew);\n                }\n            }\n\n            endpt = newendpt;\n\n            if(nexti >= 0) break;\n            fullpath += 'L' + newendpt;\n        }\n\n        if(nexti === pi.edgepaths.length) {\n            Lib.log('unclosed perimeter path');\n            break;\n        }\n\n        i = nexti;\n\n        // if we closed back on a loop we already included,\n        // close it and start a new loop\n        newloop = (startsleft.indexOf(i) === -1);\n        if(newloop) {\n            i = startsleft[0];\n            fullpath += 'Z';\n        }\n    }\n\n    // finally add the interior paths\n    for(i = 0; i < pi.paths.length; i++) {\n        fullpath += Drawing.smoothclosed(pi.paths[i], pi.smoothing);\n    }\n\n    return fullpath;\n}\n\nfunction makeLinesAndLabels(plotgroup, pathinfo, gd, cd0, contours) {\n    var lineContainer = Lib.ensureSingle(plotgroup, 'g', 'contourlines');\n    var showLines = contours.showlines !== false;\n    var showLabels = contours.showlabels;\n    var clipLinesForLabels = showLines && showLabels;\n\n    // Even if we're not going to show lines, we need to create them\n    // if we're showing labels, because the fill paths include the perimeter\n    // so can't be used to position the labels correctly.\n    // In this case we'll remove the lines after making the labels.\n    var linegroup = exports.createLines(lineContainer, showLines || showLabels, pathinfo);\n\n    var lineClip = exports.createLineClip(lineContainer, clipLinesForLabels, gd, cd0.trace.uid);\n\n    var labelGroup = plotgroup.selectAll('g.contourlabels')\n        .data(showLabels ? [0] : []);\n\n    labelGroup.exit().remove();\n\n    labelGroup.enter().append('g')\n        .classed('contourlabels', true);\n\n    if(showLabels) {\n        var labelClipPathData = [];\n        var labelData = [];\n\n        // invalidate the getTextLocation cache in case paths changed\n        Lib.clearLocationCache();\n\n        var contourFormat = exports.labelFormatter(gd, cd0);\n\n        var dummyText = Drawing.tester.append('text')\n            .attr('data-notex', 1)\n            .call(Drawing.font, contours.labelfont);\n\n        var xa = pathinfo[0].xaxis;\n        var ya = pathinfo[0].yaxis;\n        var xLen = xa._length;\n        var yLen = ya._length;\n        var xRng = xa.range;\n        var yRng = ya.range;\n        var xMin = Lib.aggNums(Math.min, null, cd0.x);\n        var xMax = Lib.aggNums(Math.max, null, cd0.x);\n        var yMin = Lib.aggNums(Math.min, null, cd0.y);\n        var yMax = Lib.aggNums(Math.max, null, cd0.y);\n        var x0 = Math.max(xa.c2p(xMin, true), 0);\n        var x1 = Math.min(xa.c2p(xMax, true), xLen);\n        var y0 = Math.max(ya.c2p(yMax, true), 0);\n        var y1 = Math.min(ya.c2p(yMin, true), yLen);\n\n        // visible bounds of the contour trace (and the midpoints, to\n        // help with cost calculations)\n        var bounds = {};\n\n        if(xRng[0] < xRng[1]) {\n            bounds.left = x0;\n            bounds.right = x1;\n        } else {\n            bounds.left = x1;\n            bounds.right = x0;\n        }\n\n        if(yRng[0] < yRng[1]) {\n            bounds.top = y0;\n            bounds.bottom = y1;\n        } else {\n            bounds.top = y1;\n            bounds.bottom = y0;\n        }\n\n        bounds.middle = (bounds.top + bounds.bottom) / 2;\n        bounds.center = (bounds.left + bounds.right) / 2;\n\n        labelClipPathData.push([\n            [bounds.left, bounds.top],\n            [bounds.right, bounds.top],\n            [bounds.right, bounds.bottom],\n            [bounds.left, bounds.bottom]\n        ]);\n\n        var plotDiagonal = Math.sqrt(xLen * xLen + yLen * yLen);\n\n        // the path length to use to scale the number of labels to draw:\n        var normLength = constants.LABELDISTANCE * plotDiagonal /\n            Math.max(1, pathinfo.length / constants.LABELINCREASE);\n\n        linegroup.each(function(d) {\n            var textOpts = exports.calcTextOpts(d.level, contourFormat, dummyText, gd);\n\n            d3.select(this).selectAll('path').each(function() {\n                var path = this;\n                var pathBounds = Lib.getVisibleSegment(path, bounds, textOpts.height / 2);\n                if(!pathBounds) return;\n\n                if(pathBounds.len < (textOpts.width + textOpts.height) * constants.LABELMIN) return;\n\n                var maxLabels = Math.min(Math.ceil(pathBounds.len / normLength),\n                    constants.LABELMAX);\n\n                for(var i = 0; i < maxLabels; i++) {\n                    var loc = exports.findBestTextLocation(path, pathBounds, textOpts,\n                        labelData, bounds);\n\n                    if(!loc) break;\n\n                    exports.addLabelData(loc, textOpts, labelData, labelClipPathData);\n                }\n            });\n        });\n\n        dummyText.remove();\n\n        exports.drawLabels(labelGroup, labelData, gd, lineClip,\n            clipLinesForLabels ? labelClipPathData : null);\n    }\n\n    if(showLabels && !showLines) linegroup.remove();\n}\n\nexports.createLines = function(lineContainer, makeLines, pathinfo) {\n    var smoothing = pathinfo[0].smoothing;\n\n    var linegroup = lineContainer.selectAll('g.contourlevel')\n        .data(makeLines ? pathinfo : []);\n\n    linegroup.exit().remove();\n    linegroup.enter().append('g')\n        .classed('contourlevel', true);\n\n    if(makeLines) {\n        // pedgepaths / ppaths are used by contourcarpet, for the paths transformed from a/b to x/y\n        // edgepaths / paths are used by contour since it's in x/y from the start\n        var opencontourlines = linegroup.selectAll('path.openline')\n            .data(function(d) { return d.pedgepaths || d.edgepaths; });\n\n        opencontourlines.exit().remove();\n        opencontourlines.enter().append('path')\n            .classed('openline', true);\n\n        opencontourlines\n            .attr('d', function(d) {\n                return Drawing.smoothopen(d, smoothing);\n            })\n            .style('stroke-miterlimit', 1)\n            .style('vector-effect', 'non-scaling-stroke');\n\n        var closedcontourlines = linegroup.selectAll('path.closedline')\n            .data(function(d) { return d.ppaths || d.paths; });\n\n        closedcontourlines.exit().remove();\n        closedcontourlines.enter().append('path')\n            .classed('closedline', true);\n\n        closedcontourlines\n            .attr('d', function(d) {\n                return Drawing.smoothclosed(d, smoothing);\n            })\n            .style('stroke-miterlimit', 1)\n            .style('vector-effect', 'non-scaling-stroke');\n    }\n\n    return linegroup;\n};\n\nexports.createLineClip = function(lineContainer, clipLinesForLabels, gd, uid) {\n    var clips = gd._fullLayout._clips;\n    var clipId = clipLinesForLabels ? ('clipline' + uid) : null;\n\n    var lineClip = clips.selectAll('#' + clipId)\n        .data(clipLinesForLabels ? [0] : []);\n    lineClip.exit().remove();\n\n    lineClip.enter().append('clipPath')\n        .classed('contourlineclip', true)\n        .attr('id', clipId);\n\n    Drawing.setClipUrl(lineContainer, clipId, gd);\n\n    return lineClip;\n};\n\nexports.labelFormatter = function(gd, cd0) {\n    var fullLayout = gd._fullLayout;\n    var trace = cd0.trace;\n    var contours = trace.contours;\n\n    var formatAxis = {\n        type: 'linear',\n        _id: 'ycontour',\n        showexponent: 'all',\n        exponentformat: 'B'\n    };\n\n    if(contours.labelformat) {\n        formatAxis.tickformat = contours.labelformat;\n        setConvert(formatAxis, fullLayout);\n    } else {\n        var cOpts = Colorscale.extractOpts(trace);\n        if(cOpts && cOpts.colorbar && cOpts.colorbar._axis) {\n            formatAxis = cOpts.colorbar._axis;\n        } else {\n            if(contours.type === 'constraint') {\n                var value = contours.value;\n                if(Array.isArray(value)) {\n                    formatAxis.range = [value[0], value[value.length - 1]];\n                } else formatAxis.range = [value, value];\n            } else {\n                formatAxis.range = [contours.start, contours.end];\n                formatAxis.nticks = (contours.end - contours.start) / contours.size;\n            }\n\n            if(formatAxis.range[0] === formatAxis.range[1]) {\n                formatAxis.range[1] += formatAxis.range[0] || 1;\n            }\n            if(!formatAxis.nticks) formatAxis.nticks = 1000;\n\n            setConvert(formatAxis, fullLayout);\n            Axes.prepTicks(formatAxis);\n            formatAxis._tmin = null;\n            formatAxis._tmax = null;\n        }\n    }\n\n    return function(v) { return Axes.tickText(formatAxis, v).text; };\n};\n\nexports.calcTextOpts = function(level, contourFormat, dummyText, gd) {\n    var text = contourFormat(level);\n    dummyText.text(text)\n        .call(svgTextUtils.convertToTspans, gd);\n\n    var el = dummyText.node();\n    var bBox = Drawing.bBox(el, true);\n\n    return {\n        text: text,\n        width: bBox.width,\n        height: bBox.height,\n        fontSize: +(el.style['font-size'].replace('px', '')),\n        level: level,\n        dy: (bBox.top + bBox.bottom) / 2\n    };\n};\n\nexports.findBestTextLocation = function(path, pathBounds, textOpts, labelData, plotBounds) {\n    var textWidth = textOpts.width;\n\n    var p0, dp, pMax, pMin, loc;\n    if(pathBounds.isClosed) {\n        dp = pathBounds.len / costConstants.INITIALSEARCHPOINTS;\n        p0 = pathBounds.min + dp / 2;\n        pMax = pathBounds.max;\n    } else {\n        dp = (pathBounds.len - textWidth) / (costConstants.INITIALSEARCHPOINTS + 1);\n        p0 = pathBounds.min + dp + textWidth / 2;\n        pMax = pathBounds.max - (dp + textWidth) / 2;\n    }\n\n    var cost = Infinity;\n    for(var j = 0; j < costConstants.ITERATIONS; j++) {\n        for(var p = p0; p < pMax; p += dp) {\n            var newLocation = Lib.getTextLocation(path, pathBounds.total, p, textWidth);\n            var newCost = locationCost(newLocation, textOpts, labelData, plotBounds);\n            if(newCost < cost) {\n                cost = newCost;\n                loc = newLocation;\n                pMin = p;\n            }\n        }\n        if(cost > costConstants.MAXCOST * 2) break;\n\n        // subsequent iterations just look half steps away from the\n        // best we found in the previous iteration\n        if(j) dp /= 2;\n        p0 = pMin - dp / 2;\n        pMax = p0 + dp * 1.5;\n    }\n    if(cost <= costConstants.MAXCOST) return loc;\n};\n\n/*\n * locationCost: a cost function for label locations\n * composed of three kinds of penalty:\n * - for open paths, being close to the end of the path\n * - the angle away from horizontal\n * - being too close to already placed neighbors\n */\nfunction locationCost(loc, textOpts, labelData, bounds) {\n    var halfWidth = textOpts.width / 2;\n    var halfHeight = textOpts.height / 2;\n    var x = loc.x;\n    var y = loc.y;\n    var theta = loc.theta;\n    var dx = Math.cos(theta) * halfWidth;\n    var dy = Math.sin(theta) * halfWidth;\n\n    // cost for being near an edge\n    var normX = ((x > bounds.center) ? (bounds.right - x) : (x - bounds.left)) /\n        (dx + Math.abs(Math.sin(theta) * halfHeight));\n    var normY = ((y > bounds.middle) ? (bounds.bottom - y) : (y - bounds.top)) /\n        (Math.abs(dy) + Math.cos(theta) * halfHeight);\n    if(normX < 1 || normY < 1) return Infinity;\n    var cost = costConstants.EDGECOST * (1 / (normX - 1) + 1 / (normY - 1));\n\n    // cost for not being horizontal\n    cost += costConstants.ANGLECOST * theta * theta;\n\n    // cost for being close to other labels\n    var x1 = x - dx;\n    var y1 = y - dy;\n    var x2 = x + dx;\n    var y2 = y + dy;\n    for(var i = 0; i < labelData.length; i++) {\n        var labeli = labelData[i];\n        var dxd = Math.cos(labeli.theta) * labeli.width / 2;\n        var dyd = Math.sin(labeli.theta) * labeli.width / 2;\n        var dist = Lib.segmentDistance(\n            x1, y1,\n            x2, y2,\n            labeli.x - dxd, labeli.y - dyd,\n            labeli.x + dxd, labeli.y + dyd\n        ) * 2 / (textOpts.height + labeli.height);\n\n        var sameLevel = labeli.level === textOpts.level;\n        var distOffset = sameLevel ? costConstants.SAMELEVELDISTANCE : 1;\n\n        if(dist <= distOffset) return Infinity;\n\n        var distFactor = costConstants.NEIGHBORCOST *\n            (sameLevel ? costConstants.SAMELEVELFACTOR : 1);\n\n        cost += distFactor / (dist - distOffset);\n    }\n\n    return cost;\n}\n\nexports.addLabelData = function(loc, textOpts, labelData, labelClipPathData) {\n    var fontSize = textOpts.fontSize;\n    var w = textOpts.width + fontSize / 3;\n    var h = Math.max(0, textOpts.height - fontSize / 3);\n\n    var x = loc.x;\n    var y = loc.y;\n    var theta = loc.theta;\n\n    var sin = Math.sin(theta);\n    var cos = Math.cos(theta);\n\n    var rotateXY = function(dx, dy) {\n        return [\n            x + dx * cos - dy * sin,\n            y + dx * sin + dy * cos\n        ];\n    };\n\n    var bBoxPts = [\n        rotateXY(-w / 2, -h / 2),\n        rotateXY(-w / 2, h / 2),\n        rotateXY(w / 2, h / 2),\n        rotateXY(w / 2, -h / 2)\n    ];\n\n    labelData.push({\n        text: textOpts.text,\n        x: x,\n        y: y,\n        dy: textOpts.dy,\n        theta: theta,\n        level: textOpts.level,\n        width: w,\n        height: h\n    });\n\n    labelClipPathData.push(bBoxPts);\n};\n\nexports.drawLabels = function(labelGroup, labelData, gd, lineClip, labelClipPathData) {\n    var labels = labelGroup.selectAll('text')\n        .data(labelData, function(d) {\n            return d.text + ',' + d.x + ',' + d.y + ',' + d.theta;\n        });\n\n    labels.exit().remove();\n\n    labels.enter().append('text')\n        .attr({\n            'data-notex': 1,\n            'text-anchor': 'middle'\n        })\n        .each(function(d) {\n            var x = d.x + Math.sin(d.theta) * d.dy;\n            var y = d.y - Math.cos(d.theta) * d.dy;\n            d3.select(this)\n                .text(d.text)\n                .attr({\n                    x: x,\n                    y: y,\n                    transform: 'rotate(' + (180 * d.theta / Math.PI) + ' ' + x + ' ' + y + ')'\n                })\n                .call(svgTextUtils.convertToTspans, gd);\n        });\n\n    if(labelClipPathData) {\n        var clipPath = '';\n        for(var i = 0; i < labelClipPathData.length; i++) {\n            clipPath += 'M' + labelClipPathData[i].join('L') + 'Z';\n        }\n\n        var lineClipPath = Lib.ensureSingle(lineClip, 'path', '');\n        lineClipPath.attr('d', clipPath);\n    }\n};\n\nfunction clipGaps(plotGroup, plotinfo, gd, cd0, perimeter) {\n    var trace = cd0.trace;\n    var clips = gd._fullLayout._clips;\n    var clipId = 'clip' + trace.uid;\n\n    var clipPath = clips.selectAll('#' + clipId)\n        .data(trace.connectgaps ? [] : [0]);\n    clipPath.enter().append('clipPath')\n        .classed('contourclip', true)\n        .attr('id', clipId);\n    clipPath.exit().remove();\n\n    if(trace.connectgaps === false) {\n        var clipPathInfo = {\n            // fraction of the way from missing to present point\n            // to draw the boundary.\n            // if you make this 1 (or 1-epsilon) then a point in\n            // a sea of missing data will disappear entirely.\n            level: 0.9,\n            crossings: {},\n            starts: [],\n            edgepaths: [],\n            paths: [],\n            xaxis: plotinfo.xaxis,\n            yaxis: plotinfo.yaxis,\n            x: cd0.x,\n            y: cd0.y,\n            // 0 = no data, 1 = data\n            z: makeClipMask(cd0),\n            smoothing: 0\n        };\n\n        makeCrossings([clipPathInfo]);\n        findAllPaths([clipPathInfo]);\n        closeBoundaries([clipPathInfo], {type: 'levels'});\n\n        var path = Lib.ensureSingle(clipPath, 'path', '');\n        path.attr('d',\n            (clipPathInfo.prefixBoundary ? 'M' + perimeter.join('L') + 'Z' : '') +\n            joinAllPaths(clipPathInfo, perimeter)\n        );\n    } else clipId = null;\n\n    Drawing.setClipUrl(plotGroup, clipId, gd);\n}\n\nfunction makeClipMask(cd0) {\n    var empties = cd0.trace._emptypoints;\n    var z = [];\n    var m = cd0.z.length;\n    var n = cd0.z[0].length;\n    var i;\n    var row = [];\n    var emptyPoint;\n\n    for(i = 0; i < n; i++) row.push(1);\n    for(i = 0; i < m; i++) z.push(row.slice());\n    for(i = 0; i < empties.length; i++) {\n        emptyPoint = empties[i];\n        z[emptyPoint[0]][emptyPoint[1]] = 0;\n    }\n    // save this mask to determine whether to show this data in hover\n    cd0.zmask = z;\n    return z;\n}\n","'use strict';\n\nvar Axes = require('../../plots/cartesian/axes');\nvar Lib = require('../../lib');\n\nmodule.exports = function setContours(trace, vals) {\n    var contours = trace.contours;\n\n    // check if we need to auto-choose contour levels\n    if(trace.autocontour) {\n        // N.B. do not try to use coloraxis cmin/cmax,\n        // these values here are meant to remain \"per-trace\" for now\n        var zmin = trace.zmin;\n        var zmax = trace.zmax;\n        if(trace.zauto || zmin === undefined) {\n            zmin = Lib.aggNums(Math.min, null, vals);\n        }\n        if(trace.zauto || zmax === undefined) {\n            zmax = Lib.aggNums(Math.max, null, vals);\n        }\n\n        var dummyAx = autoContours(zmin, zmax, trace.ncontours);\n        contours.size = dummyAx.dtick;\n        contours.start = Axes.tickFirst(dummyAx);\n        dummyAx.range.reverse();\n        contours.end = Axes.tickFirst(dummyAx);\n\n        if(contours.start === zmin) contours.start += contours.size;\n        if(contours.end === zmax) contours.end -= contours.size;\n\n        // if you set a small ncontours, *and* the ends are exactly on zmin/zmax\n        // there's an edge case where start > end now. Make sure there's at least\n        // one meaningful contour, put it midway between the crossed values\n        if(contours.start > contours.end) {\n            contours.start = contours.end = (contours.start + contours.end) / 2;\n        }\n\n        // copy auto-contour info back to the source data.\n        // previously we copied the whole contours object back, but that had\n        // other info (coloring, showlines) that should be left to supplyDefaults\n        if(!trace._input.contours) trace._input.contours = {};\n        Lib.extendFlat(trace._input.contours, {\n            start: contours.start,\n            end: contours.end,\n            size: contours.size\n        });\n        trace._input.autocontour = true;\n    } else if(contours.type !== 'constraint') {\n        // sanity checks on manually-supplied start/end/size\n        var start = contours.start;\n        var end = contours.end;\n        var inputContours = trace._input.contours;\n\n        if(start > end) {\n            contours.start = inputContours.start = end;\n            end = contours.end = inputContours.end = start;\n            start = contours.start;\n        }\n\n        if(!(contours.size > 0)) {\n            var sizeOut;\n            if(start === end) sizeOut = 1;\n            else sizeOut = autoContours(start, end, trace.ncontours).dtick;\n\n            inputContours.size = contours.size = sizeOut;\n        }\n    }\n};\n\n\n/*\n * autoContours: make a dummy axis object with dtick we can use\n * as contours.size, and if needed we can use Axes.tickFirst\n * with this axis object to calculate the start and end too\n *\n * start: the value to start the contours at\n * end: the value to end at (must be > start)\n * ncontours: max number of contours to make, like roughDTick\n *\n * returns: an axis object\n */\nfunction autoContours(start, end, ncontours) {\n    var dummyAx = {\n        type: 'linear',\n        range: [start, end]\n    };\n\n    Axes.autoTicks(\n        dummyAx,\n        (end - start) / (ncontours || 15)\n    );\n\n    return dummyAx;\n}\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Drawing = require('../../components/drawing');\nvar heatmapStyle = require('../heatmap/style');\n\nvar makeColorMap = require('./make_color_map');\n\n\nmodule.exports = function style(gd) {\n    var contours = d3.select(gd).selectAll('g.contour');\n\n    contours.style('opacity', function(d) {\n        return d[0].trace.opacity;\n    });\n\n    contours.each(function(d) {\n        var c = d3.select(this);\n        var trace = d[0].trace;\n        var contours = trace.contours;\n        var line = trace.line;\n        var cs = contours.size || 1;\n        var start = contours.start;\n\n        // for contourcarpet only - is this a constraint-type contour trace?\n        var isConstraintType = contours.type === 'constraint';\n        var colorLines = !isConstraintType && contours.coloring === 'lines';\n        var colorFills = !isConstraintType && contours.coloring === 'fill';\n\n        var colorMap = (colorLines || colorFills) ? makeColorMap(trace) : null;\n\n        c.selectAll('g.contourlevel').each(function(d) {\n            d3.select(this).selectAll('path')\n                .call(Drawing.lineGroupStyle,\n                    line.width,\n                    colorLines ? colorMap(d.level) : line.color,\n                    line.dash);\n        });\n\n        var labelFont = contours.labelfont;\n        c.selectAll('g.contourlabels text').each(function(d) {\n            Drawing.font(d3.select(this), {\n                family: labelFont.family,\n                size: labelFont.size,\n                color: labelFont.color || (colorLines ? colorMap(d.level) : line.color)\n            });\n        });\n\n        if(isConstraintType) {\n            c.selectAll('g.contourfill path')\n                .style('fill', trace.fillcolor);\n        } else if(colorFills) {\n            var firstFill;\n\n            c.selectAll('g.contourfill path')\n                .style('fill', function(d) {\n                    if(firstFill === undefined) firstFill = d.level;\n                    return colorMap(d.level + 0.5 * cs);\n                });\n\n            if(firstFill === undefined) firstFill = start;\n\n            c.selectAll('g.contourbg path')\n                .style('fill', colorMap(firstFill - 0.5 * cs));\n        }\n    });\n\n    heatmapStyle(gd);\n};\n","'use strict';\n\nvar colorscaleDefaults = require('../../components/colorscale/defaults');\nvar handleLabelDefaults = require('./label_defaults');\n\n\nmodule.exports = function handleStyleDefaults(traceIn, traceOut, coerce, layout, opts) {\n    var coloring = coerce('contours.coloring');\n\n    var showLines;\n    var lineColor = '';\n    if(coloring === 'fill') showLines = coerce('contours.showlines');\n\n    if(showLines !== false) {\n        if(coloring !== 'lines') lineColor = coerce('line.color', '#000');\n        coerce('line.width', 0.5);\n        coerce('line.dash');\n    }\n\n    if(coloring !== 'none') {\n        // plots/plots always coerces showlegend to true, but in this case\n        // we default to false and (by default) show a colorbar instead\n        if(traceIn.showlegend !== true) traceOut.showlegend = false;\n        traceOut._dfltShowLegend = false;\n\n        colorscaleDefaults(\n            traceIn, traceOut, layout, coerce, {prefix: '', cLetter: 'z'}\n        );\n    }\n\n    coerce('line.smoothing');\n\n    handleLabelDefaults(coerce, layout, lineColor, opts);\n};\n","'use strict';\n\nvar scatterAttrs = require('../scatter/attributes');\nvar baseAttrs = require('../../plots/attributes');\nvar axisHoverFormat = require('../../plots/cartesian/axis_format_attributes').axisHoverFormat;\nvar hovertemplateAttrs = require('../../plots/template_attributes').hovertemplateAttrs;\nvar colorScaleAttrs = require('../../components/colorscale/attributes');\n\nvar extendFlat = require('../../lib/extend').extendFlat;\n\nmodule.exports = extendFlat({\n    z: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: 'Sets the z data.'\n    },\n    x: extendFlat({}, scatterAttrs.x, {impliedEdits: {xtype: 'array'}}),\n    x0: extendFlat({}, scatterAttrs.x0, {impliedEdits: {xtype: 'scaled'}}),\n    dx: extendFlat({}, scatterAttrs.dx, {impliedEdits: {xtype: 'scaled'}}),\n    y: extendFlat({}, scatterAttrs.y, {impliedEdits: {ytype: 'array'}}),\n    y0: extendFlat({}, scatterAttrs.y0, {impliedEdits: {ytype: 'scaled'}}),\n    dy: extendFlat({}, scatterAttrs.dy, {impliedEdits: {ytype: 'scaled'}}),\n\n    xperiod: extendFlat({}, scatterAttrs.xperiod, {impliedEdits: {xtype: 'scaled'}}),\n    yperiod: extendFlat({}, scatterAttrs.yperiod, {impliedEdits: {ytype: 'scaled'}}),\n    xperiod0: extendFlat({}, scatterAttrs.xperiod0, {impliedEdits: {xtype: 'scaled'}}),\n    yperiod0: extendFlat({}, scatterAttrs.yperiod0, {impliedEdits: {ytype: 'scaled'}}),\n    xperiodalignment: extendFlat({}, scatterAttrs.xperiodalignment, {impliedEdits: {xtype: 'scaled'}}),\n    yperiodalignment: extendFlat({}, scatterAttrs.yperiodalignment, {impliedEdits: {ytype: 'scaled'}}),\n\n    text: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: 'Sets the text elements associated with each z value.'\n    },\n    hovertext: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: 'Same as `text`.'\n    },\n    transpose: {\n        valType: 'boolean',\n        dflt: false,\n        editType: 'calc',\n        description: 'Transposes the z data.'\n    },\n    xtype: {\n        valType: 'enumerated',\n        values: ['array', 'scaled'],\n        editType: 'calc+clearAxisTypes',\n        description: [\n            'If *array*, the heatmap\\'s x coordinates are given by *x*',\n            '(the default behavior when `x` is provided).',\n            'If *scaled*, the heatmap\\'s x coordinates are given by *x0* and *dx*',\n            '(the default behavior when `x` is not provided).'\n        ].join(' ')\n    },\n    ytype: {\n        valType: 'enumerated',\n        values: ['array', 'scaled'],\n        editType: 'calc+clearAxisTypes',\n        description: [\n            'If *array*, the heatmap\\'s y coordinates are given by *y*',\n            '(the default behavior when `y` is provided)',\n            'If *scaled*, the heatmap\\'s y coordinates are given by *y0* and *dy*',\n            '(the default behavior when `y` is not provided)'\n        ].join(' ')\n    },\n    zsmooth: {\n        valType: 'enumerated',\n        values: ['fast', 'best', false],\n        dflt: false,\n        editType: 'calc',\n        description: [\n            'Picks a smoothing algorithm use to smooth `z` data.'\n        ].join(' ')\n    },\n    hoverongaps: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'none',\n        description: [\n            'Determines whether or not gaps',\n            '(i.e. {nan} or missing values)',\n            'in the `z` data have hover labels associated with them.'\n        ].join(' ')\n    },\n    connectgaps: {\n        valType: 'boolean',\n        editType: 'calc',\n        description: [\n            'Determines whether or not gaps',\n            '(i.e. {nan} or missing values)',\n            'in the `z` data are filled in.',\n            'It is defaulted to true if `z` is a',\n            'one dimensional array and `zsmooth` is not false;',\n            'otherwise it is defaulted to false.'\n        ].join(' ')\n    },\n    xgap: {\n        valType: 'number',\n        dflt: 0,\n        min: 0,\n        editType: 'plot',\n        description: 'Sets the horizontal gap (in pixels) between bricks.'\n    },\n    ygap: {\n        valType: 'number',\n        dflt: 0,\n        min: 0,\n        editType: 'plot',\n        description: 'Sets the vertical gap (in pixels) between bricks.'\n    },\n    xhoverformat: axisHoverFormat('x'),\n    yhoverformat: axisHoverFormat('y'),\n    zhoverformat: axisHoverFormat('z', 1),\n\n    hovertemplate: hovertemplateAttrs(),\n    showlegend: extendFlat({}, baseAttrs.showlegend, {dflt: false})\n}, {\n    transforms: undefined\n},\n    colorScaleAttrs('', {cLetter: 'z', autoColorDflt: false})\n);\n","'use strict';\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar Axes = require('../../plots/cartesian/axes');\nvar alignPeriod = require('../../plots/cartesian/align_period');\n\nvar histogram2dCalc = require('../histogram2d/calc');\nvar colorscaleCalc = require('../../components/colorscale/calc');\nvar convertColumnData = require('./convert_column_xyz');\nvar clean2dArray = require('./clean_2d_array');\nvar interp2d = require('./interp2d');\nvar findEmpties = require('./find_empties');\nvar makeBoundArray = require('./make_bound_array');\nvar BADNUM = require('../../constants/numerical').BADNUM;\n\nmodule.exports = function calc(gd, trace) {\n    // prepare the raw data\n    // run makeCalcdata on x and y even for heatmaps, in case of category mappings\n    var xa = Axes.getFromId(gd, trace.xaxis || 'x');\n    var ya = Axes.getFromId(gd, trace.yaxis || 'y');\n    var isContour = Registry.traceIs(trace, 'contour');\n    var isHist = Registry.traceIs(trace, 'histogram');\n    var isGL2D = Registry.traceIs(trace, 'gl2d');\n    var zsmooth = isContour ? 'best' : trace.zsmooth;\n    var x, x0, dx, origX;\n    var y, y0, dy, origY;\n    var z, i, binned;\n\n    // cancel minimum tick spacings (only applies to bars and boxes)\n    xa._minDtick = 0;\n    ya._minDtick = 0;\n\n    if(isHist) {\n        binned = histogram2dCalc(gd, trace);\n        origX = binned.orig_x;\n        x = binned.x;\n        x0 = binned.x0;\n        dx = binned.dx;\n\n        origY = binned.orig_y;\n        y = binned.y;\n        y0 = binned.y0;\n        dy = binned.dy;\n\n        z = binned.z;\n    } else {\n        var zIn = trace.z;\n        if(Lib.isArray1D(zIn)) {\n            convertColumnData(trace, xa, ya, 'x', 'y', ['z']);\n            x = trace._x;\n            y = trace._y;\n            zIn = trace._z;\n        } else {\n            origX = trace.x ? xa.makeCalcdata(trace, 'x') : [];\n            origY = trace.y ? ya.makeCalcdata(trace, 'y') : [];\n            x = alignPeriod(trace, xa, 'x', origX);\n            y = alignPeriod(trace, ya, 'y', origY);\n            trace._x = x;\n            trace._y = y;\n        }\n\n        x0 = trace.x0;\n        dx = trace.dx;\n        y0 = trace.y0;\n        dy = trace.dy;\n\n        z = clean2dArray(zIn, trace, xa, ya);\n    }\n\n    if(xa.rangebreaks || ya.rangebreaks) {\n        z = dropZonBreaks(x, y, z);\n\n        if(!isHist) {\n            x = skipBreaks(x);\n            y = skipBreaks(y);\n\n            trace._x = x;\n            trace._y = y;\n        }\n    }\n\n    if(!isHist && (isContour || trace.connectgaps)) {\n        trace._emptypoints = findEmpties(z);\n        interp2d(z, trace._emptypoints);\n    }\n\n    function noZsmooth(msg) {\n        zsmooth = trace._input.zsmooth = trace.zsmooth = false;\n        Lib.warn('cannot use zsmooth: \"fast\": ' + msg);\n    }\n\n    // check whether we really can smooth (ie all boxes are about the same size)\n    if(zsmooth === 'fast') {\n        if(xa.type === 'log' || ya.type === 'log') {\n            noZsmooth('log axis found');\n        } else if(!isHist) {\n            if(x.length) {\n                var avgdx = (x[x.length - 1] - x[0]) / (x.length - 1);\n                var maxErrX = Math.abs(avgdx / 100);\n                for(i = 0; i < x.length - 1; i++) {\n                    if(Math.abs(x[i + 1] - x[i] - avgdx) > maxErrX) {\n                        noZsmooth('x scale is not linear');\n                        break;\n                    }\n                }\n            }\n            if(y.length && zsmooth === 'fast') {\n                var avgdy = (y[y.length - 1] - y[0]) / (y.length - 1);\n                var maxErrY = Math.abs(avgdy / 100);\n                for(i = 0; i < y.length - 1; i++) {\n                    if(Math.abs(y[i + 1] - y[i] - avgdy) > maxErrY) {\n                        noZsmooth('y scale is not linear');\n                        break;\n                    }\n                }\n            }\n        }\n    }\n\n    // create arrays of brick boundaries, to be used by autorange and heatmap.plot\n    var xlen = Lib.maxRowLength(z);\n    var xIn = trace.xtype === 'scaled' ? '' : x;\n    var xArray = makeBoundArray(trace, xIn, x0, dx, xlen, xa);\n    var yIn = trace.ytype === 'scaled' ? '' : y;\n    var yArray = makeBoundArray(trace, yIn, y0, dy, z.length, ya);\n\n    // handled in gl2d convert step\n    if(!isGL2D) {\n        trace._extremes[xa._id] = Axes.findExtremes(xa, xArray);\n        trace._extremes[ya._id] = Axes.findExtremes(ya, yArray);\n    }\n\n    var cd0 = {\n        x: xArray,\n        y: yArray,\n        z: z,\n        text: trace._text || trace.text,\n        hovertext: trace._hovertext || trace.hovertext\n    };\n\n    if(trace.xperiodalignment && origX) {\n        cd0.orig_x = origX;\n    }\n    if(trace.yperiodalignment && origY) {\n        cd0.orig_y = origY;\n    }\n\n    if(xIn && xIn.length === xArray.length - 1) cd0.xCenter = xIn;\n    if(yIn && yIn.length === yArray.length - 1) cd0.yCenter = yIn;\n\n    if(isHist) {\n        cd0.xRanges = binned.xRanges;\n        cd0.yRanges = binned.yRanges;\n        cd0.pts = binned.pts;\n    }\n\n    if(!isContour) {\n        colorscaleCalc(gd, trace, {vals: z, cLetter: 'z'});\n    }\n\n    if(isContour && trace.contours && trace.contours.coloring === 'heatmap') {\n        var dummyTrace = {\n            type: trace.type === 'contour' ? 'heatmap' : 'histogram2d',\n            xcalendar: trace.xcalendar,\n            ycalendar: trace.ycalendar\n        };\n        cd0.xfill = makeBoundArray(dummyTrace, xIn, x0, dx, xlen, xa);\n        cd0.yfill = makeBoundArray(dummyTrace, yIn, y0, dy, z.length, ya);\n    }\n\n    return [cd0];\n};\n\nfunction skipBreaks(a) {\n    var b = [];\n    var len = a.length;\n    for(var i = 0; i < len; i++) {\n        var v = a[i];\n        if(v !== BADNUM) b.push(v);\n    }\n    return b;\n}\n\nfunction dropZonBreaks(x, y, z) {\n    var newZ = [];\n    var k = -1;\n    for(var i = 0; i < z.length; i++) {\n        if(y[i] === BADNUM) continue;\n        k++;\n        newZ[k] = [];\n        for(var j = 0; j < z[i].length; j++) {\n            if(x[j] === BADNUM) continue;\n\n            newZ[k].push(z[i][j]);\n        }\n    }\n    return newZ;\n}\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar Lib = require('../../lib');\nvar BADNUM = require('../../constants/numerical').BADNUM;\n\nmodule.exports = function clean2dArray(zOld, trace, xa, ya) {\n    var rowlen, collen, getCollen, old2new, i, j;\n\n    function cleanZvalue(v) {\n        if(!isNumeric(v)) return undefined;\n        return +v;\n    }\n\n    if(trace && trace.transpose) {\n        rowlen = 0;\n        for(i = 0; i < zOld.length; i++) rowlen = Math.max(rowlen, zOld[i].length);\n        if(rowlen === 0) return false;\n        getCollen = function(zOld) { return zOld.length; };\n        old2new = function(zOld, i, j) { return (zOld[j] || [])[i]; };\n    } else {\n        rowlen = zOld.length;\n        getCollen = function(zOld, i) { return zOld[i].length; };\n        old2new = function(zOld, i, j) { return (zOld[i] || [])[j]; };\n    }\n\n    var padOld2new = function(zOld, i, j) {\n        if(i === BADNUM || j === BADNUM) return BADNUM;\n        return old2new(zOld, i, j);\n    };\n\n    function axisMapping(ax) {\n        if(trace && trace.type !== 'carpet' && trace.type !== 'contourcarpet' &&\n            ax && ax.type === 'category' && trace['_' + ax._id.charAt(0)].length) {\n            var axLetter = ax._id.charAt(0);\n            var axMapping = {};\n            var traceCategories = trace['_' + axLetter + 'CategoryMap'] || trace[axLetter];\n            for(i = 0; i < traceCategories.length; i++) {\n                axMapping[traceCategories[i]] = i;\n            }\n            return function(i) {\n                var ind = axMapping[ax._categories[i]];\n                return ind + 1 ? ind : BADNUM;\n            };\n        } else {\n            return Lib.identity;\n        }\n    }\n\n    var xMap = axisMapping(xa);\n    var yMap = axisMapping(ya);\n\n    if(ya && ya.type === 'category') rowlen = ya._categories.length;\n    var zNew = new Array(rowlen);\n\n    for(i = 0; i < rowlen; i++) {\n        if(xa && xa.type === 'category') {\n            collen = xa._categories.length;\n        } else {\n            collen = getCollen(zOld, i);\n        }\n        zNew[i] = new Array(collen);\n        for(j = 0; j < collen; j++) zNew[i][j] = cleanZvalue(padOld2new(zOld, yMap(i), xMap(j)));\n    }\n\n    return zNew;\n};\n","'use strict';\n\nmodule.exports = {\n    min: 'zmin',\n    max: 'zmax'\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar BADNUM = require('../../constants/numerical').BADNUM;\nvar alignPeriod = require('../../plots/cartesian/align_period');\n\nmodule.exports = function convertColumnData(trace, ax1, ax2, var1Name, var2Name, arrayVarNames) {\n    var colLen = trace._length;\n    var col1 = ax1.makeCalcdata(trace, var1Name);\n    var col2 = ax2.makeCalcdata(trace, var2Name);\n    col1 = alignPeriod(trace, ax1, var1Name, col1);\n    col2 = alignPeriod(trace, ax2, var2Name, col2);\n\n    var textCol = trace.text;\n    var hasColumnText = (textCol !== undefined && Lib.isArray1D(textCol));\n    var hoverTextCol = trace.hovertext;\n    var hasColumnHoverText = (hoverTextCol !== undefined && Lib.isArray1D(hoverTextCol));\n    var i, j;\n\n    var col1dv = Lib.distinctVals(col1);\n    var col1vals = col1dv.vals;\n    var col2dv = Lib.distinctVals(col2);\n    var col2vals = col2dv.vals;\n    var newArrays = [];\n    var text;\n    var hovertext;\n\n    var nI = col2vals.length;\n    var nJ = col1vals.length;\n\n    for(i = 0; i < arrayVarNames.length; i++) {\n        newArrays[i] = Lib.init2dArray(nI, nJ);\n    }\n\n    if(hasColumnText) {\n        text = Lib.init2dArray(nI, nJ);\n    }\n    if(hasColumnHoverText) {\n        hovertext = Lib.init2dArray(nI, nJ);\n    }\n\n    var after2before = Lib.init2dArray(nI, nJ);\n\n    for(i = 0; i < colLen; i++) {\n        if(col1[i] !== BADNUM && col2[i] !== BADNUM) {\n            var i1 = Lib.findBin(col1[i] + col1dv.minDiff / 2, col1vals);\n            var i2 = Lib.findBin(col2[i] + col2dv.minDiff / 2, col2vals);\n\n            for(j = 0; j < arrayVarNames.length; j++) {\n                var arrayVarName = arrayVarNames[j];\n                var arrayVar = trace[arrayVarName];\n                var newArray = newArrays[j];\n                newArray[i2][i1] = arrayVar[i];\n                after2before[i2][i1] = i;\n            }\n\n            if(hasColumnText) text[i2][i1] = textCol[i];\n            if(hasColumnHoverText) hovertext[i2][i1] = hoverTextCol[i];\n        }\n    }\n\n    trace['_' + var1Name] = col1vals;\n    trace['_' + var2Name] = col2vals;\n    for(j = 0; j < arrayVarNames.length; j++) {\n        trace['_' + arrayVarNames[j]] = newArrays[j];\n    }\n    if(hasColumnText) trace._text = text;\n    if(hasColumnHoverText) trace._hovertext = hovertext;\n\n    if(ax1 && ax1.type === 'category') {\n        trace['_' + var1Name + 'CategoryMap'] = col1vals.map(function(v) { return ax1._categories[v];});\n    }\n\n    if(ax2 && ax2.type === 'category') {\n        trace['_' + var2Name + 'CategoryMap'] = col2vals.map(function(v) { return ax2._categories[v];});\n    }\n\n    trace._after2before = after2before;\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\nvar handleXYZDefaults = require('./xyz_defaults');\nvar handlePeriodDefaults = require('../scatter/period_defaults');\nvar handleStyleDefaults = require('./style_defaults');\nvar colorscaleDefaults = require('../../components/colorscale/defaults');\nvar attributes = require('./attributes');\n\n\nmodule.exports = function supplyDefaults(traceIn, traceOut, defaultColor, layout) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(traceIn, traceOut, attributes, attr, dflt);\n    }\n\n    var validData = handleXYZDefaults(traceIn, traceOut, coerce, layout);\n    if(!validData) {\n        traceOut.visible = false;\n        return;\n    }\n\n    handlePeriodDefaults(traceIn, traceOut, layout, coerce);\n    coerce('xhoverformat');\n    coerce('yhoverformat');\n\n    coerce('text');\n    coerce('hovertext');\n    coerce('hovertemplate');\n\n    handleStyleDefaults(traceIn, traceOut, coerce, layout);\n\n    coerce('hoverongaps');\n    coerce('connectgaps', Lib.isArray1D(traceOut.z) && (traceOut.zsmooth !== false));\n\n    colorscaleDefaults(traceIn, traceOut, layout, coerce, {prefix: '', cLetter: 'z'});\n};\n","'use strict';\n\nvar maxRowLength = require('../../lib').maxRowLength;\n\n/* Return a list of empty points in 2D array z\n * each empty point z[i][j] gives an array [i, j, neighborCount]\n * neighborCount is the count of 4 nearest neighbors that DO exist\n * this is to give us an order of points to evaluate for interpolation.\n * if no neighbors exist, we iteratively look for neighbors that HAVE\n * neighbors, and add a fractional neighborCount\n */\nmodule.exports = function findEmpties(z) {\n    var empties = [];\n    var neighborHash = {};\n    var noNeighborList = [];\n    var nextRow = z[0];\n    var row = [];\n    var blank = [0, 0, 0];\n    var rowLength = maxRowLength(z);\n    var prevRow;\n    var i;\n    var j;\n    var thisPt;\n    var p;\n    var neighborCount;\n    var newNeighborHash;\n    var foundNewNeighbors;\n\n    for(i = 0; i < z.length; i++) {\n        prevRow = row;\n        row = nextRow;\n        nextRow = z[i + 1] || [];\n        for(j = 0; j < rowLength; j++) {\n            if(row[j] === undefined) {\n                neighborCount = (row[j - 1] !== undefined ? 1 : 0) +\n                    (row[j + 1] !== undefined ? 1 : 0) +\n                    (prevRow[j] !== undefined ? 1 : 0) +\n                    (nextRow[j] !== undefined ? 1 : 0);\n\n                if(neighborCount) {\n                    // for this purpose, don't count off-the-edge points\n                    // as undefined neighbors\n                    if(i === 0) neighborCount++;\n                    if(j === 0) neighborCount++;\n                    if(i === z.length - 1) neighborCount++;\n                    if(j === row.length - 1) neighborCount++;\n\n                    // if all neighbors that could exist do, we don't\n                    // need this for finding farther neighbors\n                    if(neighborCount < 4) {\n                        neighborHash[[i, j]] = [i, j, neighborCount];\n                    }\n\n                    empties.push([i, j, neighborCount]);\n                } else noNeighborList.push([i, j]);\n            }\n        }\n    }\n\n    while(noNeighborList.length) {\n        newNeighborHash = {};\n        foundNewNeighbors = false;\n\n        // look for cells that now have neighbors but didn't before\n        for(p = noNeighborList.length - 1; p >= 0; p--) {\n            thisPt = noNeighborList[p];\n            i = thisPt[0];\n            j = thisPt[1];\n\n            neighborCount = ((neighborHash[[i - 1, j]] || blank)[2] +\n                (neighborHash[[i + 1, j]] || blank)[2] +\n                (neighborHash[[i, j - 1]] || blank)[2] +\n                (neighborHash[[i, j + 1]] || blank)[2]) / 20;\n\n            if(neighborCount) {\n                newNeighborHash[thisPt] = [i, j, neighborCount];\n                noNeighborList.splice(p, 1);\n                foundNewNeighbors = true;\n            }\n        }\n\n        if(!foundNewNeighbors) {\n            throw 'findEmpties iterated with no new neighbors';\n        }\n\n        // put these new cells into the main neighbor list\n        for(thisPt in newNeighborHash) {\n            neighborHash[thisPt] = newNeighborHash[thisPt];\n            empties.push(newNeighborHash[thisPt]);\n        }\n    }\n\n    // sort the full list in descending order of neighbor count\n    return empties.sort(function(a, b) { return b[2] - a[2]; });\n};\n","'use strict';\n\nvar Fx = require('../../components/fx');\nvar Lib = require('../../lib');\nvar Axes = require('../../plots/cartesian/axes');\nvar extractOpts = require('../../components/colorscale').extractOpts;\n\nmodule.exports = function hoverPoints(pointData, xval, yval, hovermode, opts) {\n    if(!opts) opts = {};\n    var isContour = opts.isContour;\n\n    var cd0 = pointData.cd[0];\n    var trace = cd0.trace;\n    var xa = pointData.xa;\n    var ya = pointData.ya;\n    var x = cd0.x;\n    var y = cd0.y;\n    var z = cd0.z;\n    var xc = cd0.xCenter;\n    var yc = cd0.yCenter;\n    var zmask = cd0.zmask;\n    var zhoverformat = trace.zhoverformat;\n    var x2 = x;\n    var y2 = y;\n\n    var xl, yl, nx, ny;\n\n    if(pointData.index !== false) {\n        try {\n            nx = Math.round(pointData.index[1]);\n            ny = Math.round(pointData.index[0]);\n        } catch(e) {\n            Lib.error('Error hovering on heatmap, ' +\n                'pointNumber must be [row,col], found:', pointData.index);\n            return;\n        }\n        if(nx < 0 || nx >= z[0].length || ny < 0 || ny > z.length) {\n            return;\n        }\n    } else if(Fx.inbox(xval - x[0], xval - x[x.length - 1], 0) > 0 ||\n            Fx.inbox(yval - y[0], yval - y[y.length - 1], 0) > 0) {\n        return;\n    } else {\n        if(isContour) {\n            var i2;\n            x2 = [2 * x[0] - x[1]];\n\n            for(i2 = 1; i2 < x.length; i2++) {\n                x2.push((x[i2] + x[i2 - 1]) / 2);\n            }\n            x2.push([2 * x[x.length - 1] - x[x.length - 2]]);\n\n            y2 = [2 * y[0] - y[1]];\n            for(i2 = 1; i2 < y.length; i2++) {\n                y2.push((y[i2] + y[i2 - 1]) / 2);\n            }\n            y2.push([2 * y[y.length - 1] - y[y.length - 2]]);\n        }\n        nx = Math.max(0, Math.min(x2.length - 2, Lib.findBin(xval, x2)));\n        ny = Math.max(0, Math.min(y2.length - 2, Lib.findBin(yval, y2)));\n    }\n\n    var x0 = xa.c2p(x[nx]);\n    var x1 = xa.c2p(x[nx + 1]);\n    var y0 = ya.c2p(y[ny]);\n    var y1 = ya.c2p(y[ny + 1]);\n\n    var _x, _y;\n    if(isContour) {\n        _x = cd0.orig_x || x;\n        _y = cd0.orig_y || y;\n\n        x1 = x0;\n        xl = _x[nx];\n        y1 = y0;\n        yl = _y[ny];\n    } else {\n        _x = cd0.orig_x || xc || x;\n        _y = cd0.orig_y || yc || y;\n\n        xl = xc ? _x[nx] : ((_x[nx] + _x[nx + 1]) / 2);\n        yl = yc ? _y[ny] : ((_y[ny] + _y[ny + 1]) / 2);\n\n        if(xa && xa.type === 'category') xl = x[nx];\n        if(ya && ya.type === 'category') yl = y[ny];\n\n        if(trace.zsmooth) {\n            x0 = x1 = xa.c2p(xl);\n            y0 = y1 = ya.c2p(yl);\n        }\n    }\n\n    var zVal = z[ny][nx];\n    if(zmask && !zmask[ny][nx]) zVal = undefined;\n\n    if(zVal === undefined && !trace.hoverongaps) return;\n\n    var text;\n    if(Array.isArray(cd0.hovertext) && Array.isArray(cd0.hovertext[ny])) {\n        text = cd0.hovertext[ny][nx];\n    } else if(Array.isArray(cd0.text) && Array.isArray(cd0.text[ny])) {\n        text = cd0.text[ny][nx];\n    }\n\n    // dummy axis for formatting the z value\n    var cOpts = extractOpts(trace);\n    var dummyAx = {\n        type: 'linear',\n        range: [cOpts.min, cOpts.max],\n        hoverformat: zhoverformat,\n        _separators: xa._separators,\n        _numFormat: xa._numFormat\n    };\n    var zLabel = Axes.tickText(dummyAx, zVal, 'hover').text;\n\n    return [Lib.extendFlat(pointData, {\n        index: trace._after2before ? trace._after2before[ny][nx] : [ny, nx],\n        // never let a 2D override 1D type as closest point\n        distance: pointData.maxHoverDistance,\n        spikeDistance: pointData.maxSpikeDistance,\n        x0: x0,\n        x1: x1,\n        y0: y0,\n        y1: y1,\n        xLabelVal: xl,\n        yLabelVal: yl,\n        zLabelVal: zVal,\n        zLabel: zLabel,\n        text: text\n    })];\n};\n","'use strict';\n\nmodule.exports = {\n    attributes: require('./attributes'),\n    supplyDefaults: require('./defaults'),\n    calc: require('./calc'),\n    plot: require('./plot'),\n    colorbar: require('./colorbar'),\n    style: require('./style'),\n    hoverPoints: require('./hover'),\n\n    moduleType: 'trace',\n    name: 'heatmap',\n    basePlotModule: require('../../plots/cartesian'),\n    categories: ['cartesian', 'svg', '2dMap', 'showLegend'],\n    meta: {\n        description: [\n            'The data that describes the heatmap value-to-color mapping',\n            'is set in `z`.',\n            'Data in `z` can either be a {2D array} of values (ragged or not)',\n            'or a 1D array of values.',\n\n            'In the case where `z` is a {2D array},',\n            'say that `z` has N rows and M columns.',\n            'Then, by default, the resulting heatmap will have N partitions along',\n            'the y axis and M partitions along the x axis.',\n            'In other words, the i-th row/ j-th column cell in `z`',\n            'is mapped to the i-th partition of the y axis',\n            '(starting from the bottom of the plot) and the j-th partition',\n            'of the x-axis (starting from the left of the plot).',\n            'This behavior can be flipped by using `transpose`.',\n            'Moreover, `x` (`y`) can be provided with M or M+1 (N or N+1) elements.',\n            'If M (N), then the coordinates correspond to the center of the',\n            'heatmap cells and the cells have equal width.',\n            'If M+1 (N+1), then the coordinates correspond to the edges of the',\n            'heatmap cells.',\n\n            'In the case where `z` is a 1D {array}, the x and y coordinates must be',\n            'provided in `x` and `y` respectively to form data triplets.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\nvar INTERPTHRESHOLD = 1e-2;\nvar NEIGHBORSHIFTS = [[-1, 0], [1, 0], [0, -1], [0, 1]];\n\nfunction correctionOvershoot(maxFractionalChange) {\n    // start with less overshoot, until we know it's converging,\n    // then ramp up the overshoot for faster convergence\n    return 0.5 - 0.25 * Math.min(1, maxFractionalChange * 0.5);\n}\n\n/*\n * interp2d: Fill in missing data from a 2D array using an iterative\n *   poisson equation solver with zero-derivative BC at edges.\n *   Amazingly, this just amounts to repeatedly averaging all the existing\n *   nearest neighbors, at least if we don't take x/y scaling into account,\n *   which is the right approach here where x and y may not even have the\n *   same units.\n *\n * @param {array of arrays} z\n *      The 2D array to fill in. Will be mutated here. Assumed to already be\n *      cleaned, so all entries are numbers except gaps, which are `undefined`.\n * @param {array of arrays} emptyPoints\n *      Each entry [i, j, neighborCount] for empty points z[i][j] and the number\n *      of neighbors that are *not* missing. Assumed to be sorted from most to\n *      least neighbors, as produced by heatmap/find_empties.\n */\nmodule.exports = function interp2d(z, emptyPoints) {\n    var maxFractionalChange = 1;\n    var i;\n\n    // one pass to fill in a starting value for all the empties\n    iterateInterp2d(z, emptyPoints);\n\n    // we're don't need to iterate lone empties - remove them\n    for(i = 0; i < emptyPoints.length; i++) {\n        if(emptyPoints[i][2] < 4) break;\n    }\n    // but don't remove these points from the original array,\n    // we'll use them for masking, so make a copy.\n    emptyPoints = emptyPoints.slice(i);\n\n    for(i = 0; i < 100 && maxFractionalChange > INTERPTHRESHOLD; i++) {\n        maxFractionalChange = iterateInterp2d(z, emptyPoints,\n            correctionOvershoot(maxFractionalChange));\n    }\n    if(maxFractionalChange > INTERPTHRESHOLD) {\n        Lib.log('interp2d didn\\'t converge quickly', maxFractionalChange);\n    }\n\n    return z;\n};\n\nfunction iterateInterp2d(z, emptyPoints, overshoot) {\n    var maxFractionalChange = 0;\n    var thisPt;\n    var i;\n    var j;\n    var p;\n    var q;\n    var neighborShift;\n    var neighborRow;\n    var neighborVal;\n    var neighborCount;\n    var neighborSum;\n    var initialVal;\n    var minNeighbor;\n    var maxNeighbor;\n\n    for(p = 0; p < emptyPoints.length; p++) {\n        thisPt = emptyPoints[p];\n        i = thisPt[0];\n        j = thisPt[1];\n        initialVal = z[i][j];\n        neighborSum = 0;\n        neighborCount = 0;\n\n        for(q = 0; q < 4; q++) {\n            neighborShift = NEIGHBORSHIFTS[q];\n            neighborRow = z[i + neighborShift[0]];\n            if(!neighborRow) continue;\n            neighborVal = neighborRow[j + neighborShift[1]];\n            if(neighborVal !== undefined) {\n                if(neighborSum === 0) {\n                    minNeighbor = maxNeighbor = neighborVal;\n                } else {\n                    minNeighbor = Math.min(minNeighbor, neighborVal);\n                    maxNeighbor = Math.max(maxNeighbor, neighborVal);\n                }\n                neighborCount++;\n                neighborSum += neighborVal;\n            }\n        }\n\n        if(neighborCount === 0) {\n            throw 'iterateInterp2d order is wrong: no defined neighbors';\n        }\n\n        // this is the laplace equation interpolation:\n        // each point is just the average of its neighbors\n        // note that this ignores differential x/y scaling\n        // which I think is the right approach, since we\n        // don't know what that scaling means\n        z[i][j] = neighborSum / neighborCount;\n\n        if(initialVal === undefined) {\n            if(neighborCount < 4) maxFractionalChange = 1;\n        } else {\n            // we can make large empty regions converge faster\n            // if we overshoot the change vs the previous value\n            z[i][j] = (1 + overshoot) * z[i][j] - overshoot * initialVal;\n\n            if(maxNeighbor > minNeighbor) {\n                maxFractionalChange = Math.max(maxFractionalChange,\n                    Math.abs(z[i][j] - initialVal) / (maxNeighbor - minNeighbor));\n            }\n        }\n    }\n\n    return maxFractionalChange;\n}\n","'use strict';\n\nvar Registry = require('../../registry');\nvar isArrayOrTypedArray = require('../../lib').isArrayOrTypedArray;\n\nmodule.exports = function makeBoundArray(trace, arrayIn, v0In, dvIn, numbricks, ax) {\n    var arrayOut = [];\n    var isContour = Registry.traceIs(trace, 'contour');\n    var isHist = Registry.traceIs(trace, 'histogram');\n    var isGL2D = Registry.traceIs(trace, 'gl2d');\n    var v0;\n    var dv;\n    var i;\n\n    var isArrayOfTwoItemsOrMore = isArrayOrTypedArray(arrayIn) && arrayIn.length > 1;\n\n    if(isArrayOfTwoItemsOrMore && !isHist && (ax.type !== 'category')) {\n        var len = arrayIn.length;\n\n        // given vals are brick centers\n        // hopefully length === numbricks, but use this method even if too few are supplied\n        // and extend it linearly based on the last two points\n        if(len <= numbricks) {\n            // contour plots only want the centers\n            if(isContour || isGL2D) arrayOut = arrayIn.slice(0, numbricks);\n            else if(numbricks === 1) {\n                arrayOut = [arrayIn[0] - 0.5, arrayIn[0] + 0.5];\n            } else {\n                arrayOut = [1.5 * arrayIn[0] - 0.5 * arrayIn[1]];\n\n                for(i = 1; i < len; i++) {\n                    arrayOut.push((arrayIn[i - 1] + arrayIn[i]) * 0.5);\n                }\n\n                arrayOut.push(1.5 * arrayIn[len - 1] - 0.5 * arrayIn[len - 2]);\n            }\n\n            if(len < numbricks) {\n                var lastPt = arrayOut[arrayOut.length - 1];\n                var delta = lastPt - arrayOut[arrayOut.length - 2];\n\n                for(i = len; i < numbricks; i++) {\n                    lastPt += delta;\n                    arrayOut.push(lastPt);\n                }\n            }\n        } else {\n            // hopefully length === numbricks+1, but do something regardless:\n            // given vals are brick boundaries\n            return isContour ?\n                arrayIn.slice(0, numbricks) :  // we must be strict for contours\n                arrayIn.slice(0, numbricks + 1);\n        }\n    } else {\n        var calendar = trace[ax._id.charAt(0) + 'calendar'];\n\n        if(isHist) {\n            v0 = ax.r2c(v0In, 0, calendar);\n        } else {\n            if(isArrayOrTypedArray(arrayIn) && arrayIn.length === 1) {\n                v0 = arrayIn[0];\n            } else if(v0In === undefined) {\n                v0 = 0;\n            } else {\n                var fn = ax.type === 'log' ? ax.d2c : ax.r2c;\n                v0 = fn(v0In, 0, calendar);\n            }\n        }\n\n        dv = dvIn || 1;\n\n        for(i = (isContour || isGL2D) ? 0 : -0.5; i < numbricks; i++) {\n            arrayOut.push(v0 + dv * i);\n        }\n    }\n\n    return arrayOut;\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar tinycolor = require('tinycolor2');\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar makeColorScaleFuncFromTrace = require('../../components/colorscale').makeColorScaleFuncFromTrace;\nvar xmlnsNamespaces = require('../../constants/xmlns_namespaces');\n\nmodule.exports = function(gd, plotinfo, cdheatmaps, heatmapLayer) {\n    var xa = plotinfo.xaxis;\n    var ya = plotinfo.yaxis;\n\n    Lib.makeTraceGroups(heatmapLayer, cdheatmaps, 'hm').each(function(cd) {\n        var plotGroup = d3.select(this);\n        var cd0 = cd[0];\n        var trace = cd0.trace;\n\n        var z = cd0.z;\n        var x = cd0.x;\n        var y = cd0.y;\n        var xc = cd0.xCenter;\n        var yc = cd0.yCenter;\n        var isContour = Registry.traceIs(trace, 'contour');\n        var zsmooth = isContour ? 'best' : trace.zsmooth;\n\n        // get z dims\n        var m = z.length;\n        var n = Lib.maxRowLength(z);\n        var xrev = false;\n        var yrev = false;\n\n        var left, right, temp, top, bottom, i;\n\n        // TODO: if there are multiple overlapping categorical heatmaps,\n        // or if we allow category sorting, then the categories may not be\n        // sequential... may need to reorder and/or expand z\n\n        // Get edges of png in pixels (xa.c2p() maps axes coordinates to pixel coordinates)\n        // figure out if either axis is reversed (y is usually reversed, in pixel coords)\n        // also clip the image to maximum 50% outside the visible plot area\n        // bigger image lets you pan more naturally, but slows performance.\n        // TODO: use low-resolution images outside the visible plot for panning\n        // these while loops find the first and last brick bounds that are defined\n        // (in case of log of a negative)\n        i = 0;\n        while(left === undefined && i < x.length - 1) {\n            left = xa.c2p(x[i]);\n            i++;\n        }\n        i = x.length - 1;\n        while(right === undefined && i > 0) {\n            right = xa.c2p(x[i]);\n            i--;\n        }\n\n        if(right < left) {\n            temp = right;\n            right = left;\n            left = temp;\n            xrev = true;\n        }\n\n        i = 0;\n        while(top === undefined && i < y.length - 1) {\n            top = ya.c2p(y[i]);\n            i++;\n        }\n        i = y.length - 1;\n        while(bottom === undefined && i > 0) {\n            bottom = ya.c2p(y[i]);\n            i--;\n        }\n\n        if(bottom < top) {\n            temp = top;\n            top = bottom;\n            bottom = temp;\n            yrev = true;\n        }\n\n        // for contours with heatmap fill, we generate the boundaries based on\n        // brick centers but then use the brick edges for drawing the bricks\n        if(isContour) {\n            xc = x;\n            yc = y;\n            x = cd0.xfill;\n            y = cd0.yfill;\n        }\n\n        // make an image that goes at most half a screen off either side, to keep\n        // time reasonable when you zoom in. if zsmooth is true/fast, don't worry\n        // about this, because zooming doesn't increase number of pixels\n        // if zsmooth is best, don't include anything off screen because it takes too long\n        if(zsmooth !== 'fast') {\n            var extra = zsmooth === 'best' ? 0 : 0.5;\n            left = Math.max(-extra * xa._length, left);\n            right = Math.min((1 + extra) * xa._length, right);\n            top = Math.max(-extra * ya._length, top);\n            bottom = Math.min((1 + extra) * ya._length, bottom);\n        }\n\n        var imageWidth = Math.round(right - left);\n        var imageHeight = Math.round(bottom - top);\n\n        // setup image nodes\n\n        // if image is entirely off-screen, don't even draw it\n        var isOffScreen = (imageWidth <= 0 || imageHeight <= 0);\n\n        if(isOffScreen) {\n            var noImage = plotGroup.selectAll('image').data([]);\n            noImage.exit().remove();\n            return;\n        }\n\n        // generate image data\n\n        var canvasW, canvasH;\n        if(zsmooth === 'fast') {\n            canvasW = n;\n            canvasH = m;\n        } else {\n            canvasW = imageWidth;\n            canvasH = imageHeight;\n        }\n\n        var canvas = document.createElement('canvas');\n        canvas.width = canvasW;\n        canvas.height = canvasH;\n        var context = canvas.getContext('2d');\n\n        var sclFunc = makeColorScaleFuncFromTrace(trace, {noNumericCheck: true, returnArray: true});\n\n        // map brick boundaries to image pixels\n        var xpx,\n            ypx;\n        if(zsmooth === 'fast') {\n            xpx = xrev ?\n                function(index) { return n - 1 - index; } :\n                Lib.identity;\n            ypx = yrev ?\n                function(index) { return m - 1 - index; } :\n                Lib.identity;\n        } else {\n            xpx = function(index) {\n                return Lib.constrain(Math.round(xa.c2p(x[index]) - left),\n                    0, imageWidth);\n            };\n            ypx = function(index) {\n                return Lib.constrain(Math.round(ya.c2p(y[index]) - top),\n                    0, imageHeight);\n            };\n        }\n\n        // build the pixel map brick-by-brick\n        // cruise through z-matrix row-by-row\n        // build a brick at each z-matrix value\n        var yi = ypx(0);\n        var yb = [yi, yi];\n        var xbi = xrev ? 0 : 1;\n        var ybi = yrev ? 0 : 1;\n        // for collecting an average luminosity of the heatmap\n        var pixcount = 0;\n        var rcount = 0;\n        var gcount = 0;\n        var bcount = 0;\n\n        var xb, j, xi, v, row, c;\n\n        function setColor(v, pixsize) {\n            if(v !== undefined) {\n                var c = sclFunc(v);\n                c[0] = Math.round(c[0]);\n                c[1] = Math.round(c[1]);\n                c[2] = Math.round(c[2]);\n\n                pixcount += pixsize;\n                rcount += c[0] * pixsize;\n                gcount += c[1] * pixsize;\n                bcount += c[2] * pixsize;\n                return c;\n            }\n            return [0, 0, 0, 0];\n        }\n\n        function interpColor(r0, r1, xinterp, yinterp) {\n            var z00 = r0[xinterp.bin0];\n            if(z00 === undefined) return setColor(undefined, 1);\n\n            var z01 = r0[xinterp.bin1];\n            var z10 = r1[xinterp.bin0];\n            var z11 = r1[xinterp.bin1];\n            var dx = (z01 - z00) || 0;\n            var dy = (z10 - z00) || 0;\n            var dxy;\n\n            // the bilinear interpolation term needs different calculations\n            // for all the different permutations of missing data\n            // among the neighbors of the main point, to ensure\n            // continuity across brick boundaries.\n            if(z01 === undefined) {\n                if(z11 === undefined) dxy = 0;\n                else if(z10 === undefined) dxy = 2 * (z11 - z00);\n                else dxy = (2 * z11 - z10 - z00) * 2 / 3;\n            } else if(z11 === undefined) {\n                if(z10 === undefined) dxy = 0;\n                else dxy = (2 * z00 - z01 - z10) * 2 / 3;\n            } else if(z10 === undefined) dxy = (2 * z11 - z01 - z00) * 2 / 3;\n            else dxy = (z11 + z00 - z01 - z10);\n\n            return setColor(z00 + xinterp.frac * dx + yinterp.frac * (dy + xinterp.frac * dxy));\n        }\n\n        if(zsmooth) { // best or fast, works fastest with imageData\n            var pxIndex = 0;\n            var pixels;\n\n            try {\n                pixels = new Uint8Array(imageWidth * imageHeight * 4);\n            } catch(e) {\n                pixels = new Array(imageWidth * imageHeight * 4);\n            }\n\n            if(zsmooth === 'best') {\n                var xForPx = xc || x;\n                var yForPx = yc || y;\n                var xPixArray = new Array(xForPx.length);\n                var yPixArray = new Array(yForPx.length);\n                var xinterpArray = new Array(imageWidth);\n                var findInterpX = xc ? findInterpFromCenters : findInterp;\n                var findInterpY = yc ? findInterpFromCenters : findInterp;\n                var yinterp, r0, r1;\n\n                // first make arrays of x and y pixel locations of brick boundaries\n                for(i = 0; i < xForPx.length; i++) xPixArray[i] = Math.round(xa.c2p(xForPx[i]) - left);\n                for(i = 0; i < yForPx.length; i++) yPixArray[i] = Math.round(ya.c2p(yForPx[i]) - top);\n\n                // then make arrays of interpolations\n                // (bin0=closest, bin1=next, frac=fractional dist.)\n                for(i = 0; i < imageWidth; i++) xinterpArray[i] = findInterpX(i, xPixArray);\n\n                // now do the interpolations and fill the png\n                for(j = 0; j < imageHeight; j++) {\n                    yinterp = findInterpY(j, yPixArray);\n                    r0 = z[yinterp.bin0];\n                    r1 = z[yinterp.bin1];\n                    for(i = 0; i < imageWidth; i++, pxIndex += 4) {\n                        c = interpColor(r0, r1, xinterpArray[i], yinterp);\n                        putColor(pixels, pxIndex, c);\n                    }\n                }\n            } else { // zsmooth = fast\n                for(j = 0; j < m; j++) {\n                    row = z[j];\n                    yb = ypx(j);\n                    for(i = 0; i < imageWidth; i++) {\n                        c = setColor(row[i], 1);\n                        pxIndex = (yb * imageWidth + xpx(i)) * 4;\n                        putColor(pixels, pxIndex, c);\n                    }\n                }\n            }\n\n            var imageData = context.createImageData(imageWidth, imageHeight);\n            try {\n                imageData.data.set(pixels);\n            } catch(e) {\n                var pxArray = imageData.data;\n                var dlen = pxArray.length;\n                for(j = 0; j < dlen; j ++) {\n                    pxArray[j] = pixels[j];\n                }\n            }\n\n            context.putImageData(imageData, 0, 0);\n        } else { // zsmooth = false -> filling potentially large bricks works fastest with fillRect\n            // gaps do not need to be exact integers, but if they *are* we will get\n            // cleaner edges by rounding at least one edge\n            var xGap = trace.xgap;\n            var yGap = trace.ygap;\n            var xGapLeft = Math.floor(xGap / 2);\n            var yGapTop = Math.floor(yGap / 2);\n\n            for(j = 0; j < m; j++) {\n                row = z[j];\n                yb.reverse();\n                yb[ybi] = ypx(j + 1);\n                if(yb[0] === yb[1] || yb[0] === undefined || yb[1] === undefined) {\n                    continue;\n                }\n                xi = xpx(0);\n                xb = [xi, xi];\n                for(i = 0; i < n; i++) {\n                    // build one color brick!\n                    xb.reverse();\n                    xb[xbi] = xpx(i + 1);\n                    if(xb[0] === xb[1] || xb[0] === undefined || xb[1] === undefined) {\n                        continue;\n                    }\n                    v = row[i];\n                    c = setColor(v, (xb[1] - xb[0]) * (yb[1] - yb[0]));\n                    context.fillStyle = 'rgba(' + c.join(',') + ')';\n\n                    context.fillRect(xb[0] + xGapLeft, yb[0] + yGapTop,\n                        xb[1] - xb[0] - xGap, yb[1] - yb[0] - yGap);\n                }\n            }\n        }\n\n        rcount = Math.round(rcount / pixcount);\n        gcount = Math.round(gcount / pixcount);\n        bcount = Math.round(bcount / pixcount);\n        var avgColor = tinycolor('rgb(' + rcount + ',' + gcount + ',' + bcount + ')');\n\n        gd._hmpixcount = (gd._hmpixcount||0) + pixcount;\n        gd._hmlumcount = (gd._hmlumcount||0) + pixcount * avgColor.getLuminance();\n\n        var image3 = plotGroup.selectAll('image')\n            .data(cd);\n\n        image3.enter().append('svg:image').attr({\n            xmlns: xmlnsNamespaces.svg,\n            preserveAspectRatio: 'none'\n        });\n\n        image3.attr({\n            height: imageHeight,\n            width: imageWidth,\n            x: left,\n            y: top,\n            'xlink:href': canvas.toDataURL('image/png')\n        });\n    });\n};\n\n// get interpolated bin value. Returns {bin0:closest bin, frac:fractional dist to next, bin1:next bin}\nfunction findInterp(pixel, pixArray) {\n    var maxBin = pixArray.length - 2;\n    var bin = Lib.constrain(Lib.findBin(pixel, pixArray), 0, maxBin);\n    var pix0 = pixArray[bin];\n    var pix1 = pixArray[bin + 1];\n    var interp = Lib.constrain(bin + (pixel - pix0) / (pix1 - pix0) - 0.5, 0, maxBin);\n    var bin0 = Math.round(interp);\n    var frac = Math.abs(interp - bin0);\n\n    if(!interp || interp === maxBin || !frac) {\n        return {\n            bin0: bin0,\n            bin1: bin0,\n            frac: 0\n        };\n    }\n    return {\n        bin0: bin0,\n        frac: frac,\n        bin1: Math.round(bin0 + frac / (interp - bin0))\n    };\n}\n\nfunction findInterpFromCenters(pixel, centerPixArray) {\n    var maxBin = centerPixArray.length - 1;\n    var bin = Lib.constrain(Lib.findBin(pixel, centerPixArray), 0, maxBin);\n    var pix0 = centerPixArray[bin];\n    var pix1 = centerPixArray[bin + 1];\n    var frac = ((pixel - pix0) / (pix1 - pix0)) || 0;\n    if(frac <= 0) {\n        return {\n            bin0: bin,\n            bin1: bin,\n            frac: 0\n        };\n    }\n    if(frac < 0.5) {\n        return {\n            bin0: bin,\n            bin1: bin + 1,\n            frac: frac\n        };\n    }\n    return {\n        bin0: bin + 1,\n        bin1: bin,\n        frac: 1 - frac\n    };\n}\n\nfunction putColor(pixels, pxIndex, c) {\n    pixels[pxIndex] = c[0];\n    pixels[pxIndex + 1] = c[1];\n    pixels[pxIndex + 2] = c[2];\n    pixels[pxIndex + 3] = Math.round(c[3] * 255);\n}\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nmodule.exports = function style(gd) {\n    d3.select(gd).selectAll('.hm image')\n        .style('opacity', function(d) {\n            return d.trace.opacity;\n        });\n};\n","'use strict';\n\nmodule.exports = function handleStyleDefaults(traceIn, traceOut, coerce) {\n    var zsmooth = coerce('zsmooth');\n    if(zsmooth === false) {\n        // ensure that xgap and ygap are coerced only when zsmooth allows them to have an effect.\n        coerce('xgap');\n        coerce('ygap');\n    }\n\n    coerce('zhoverformat');\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar Lib = require('../../lib');\n\nvar Registry = require('../../registry');\n\nmodule.exports = function handleXYZDefaults(traceIn, traceOut, coerce, layout, xName, yName) {\n    var z = coerce('z');\n    xName = xName || 'x';\n    yName = yName || 'y';\n    var x, y;\n\n    if(z === undefined || !z.length) return 0;\n\n    if(Lib.isArray1D(traceIn.z)) {\n        x = coerce(xName);\n        y = coerce(yName);\n\n        var xlen = Lib.minRowLength(x);\n        var ylen = Lib.minRowLength(y);\n\n        // column z must be accompanied by xName and yName arrays\n        if(xlen === 0 || ylen === 0) return 0;\n\n        traceOut._length = Math.min(xlen, ylen, z.length);\n    } else {\n        x = coordDefaults(xName, coerce);\n        y = coordDefaults(yName, coerce);\n\n        // TODO put z validation elsewhere\n        if(!isValidZ(z)) return 0;\n\n        coerce('transpose');\n\n        traceOut._length = null;\n    }\n\n    if(traceIn.type === 'heatmapgl') return true; // skip calendars until we handle them in those traces\n\n    var handleCalendarDefaults = Registry.getComponentMethod('calendars', 'handleTraceDefaults');\n    handleCalendarDefaults(traceIn, traceOut, [xName, yName], layout);\n\n    return true;\n};\n\nfunction coordDefaults(coordStr, coerce) {\n    var coord = coerce(coordStr);\n    var coordType = coord ? coerce(coordStr + 'type', 'array') : 'scaled';\n\n    if(coordType === 'scaled') {\n        coerce(coordStr + '0');\n        coerce('d' + coordStr);\n    }\n\n    return coord;\n}\n\nfunction isValidZ(z) {\n    var allRowsAreArrays = true;\n    var oneRowIsFilled = false;\n    var hasOneNumber = false;\n    var zi;\n\n    /*\n     * Without this step:\n     *\n     * hasOneNumber = false breaks contour but not heatmap\n     * allRowsAreArrays = false breaks contour but not heatmap\n     * oneRowIsFilled = false breaks both\n     */\n\n    for(var i = 0; i < z.length; i++) {\n        zi = z[i];\n        if(!Lib.isArrayOrTypedArray(zi)) {\n            allRowsAreArrays = false;\n            break;\n        }\n        if(zi.length > 0) oneRowIsFilled = true;\n        for(var j = 0; j < zi.length; j++) {\n            if(isNumeric(zi[j])) {\n                hasOneNumber = true;\n                break;\n            }\n        }\n    }\n\n    return (allRowsAreArrays && oneRowIsFilled && hasOneNumber);\n}\n","'use strict';\n\nvar histogramAttrs = require('../histogram/attributes');\nvar makeBinAttrs = require('../histogram/bin_attributes');\nvar heatmapAttrs = require('../heatmap/attributes');\nvar baseAttrs = require('../../plots/attributes');\nvar axisHoverFormat = require('../../plots/cartesian/axis_format_attributes').axisHoverFormat;\nvar hovertemplateAttrs = require('../../plots/template_attributes').hovertemplateAttrs;\nvar colorScaleAttrs = require('../../components/colorscale/attributes');\n\nvar extendFlat = require('../../lib/extend').extendFlat;\n\nmodule.exports = extendFlat(\n    {\n        x: histogramAttrs.x,\n        y: histogramAttrs.y,\n\n        z: {\n            valType: 'data_array',\n            editType: 'calc',\n            description: 'Sets the aggregation data.'\n        },\n        marker: {\n            color: {\n                valType: 'data_array',\n                editType: 'calc',\n                description: 'Sets the aggregation data.'\n            },\n            editType: 'calc'\n        },\n\n        histnorm: histogramAttrs.histnorm,\n        histfunc: histogramAttrs.histfunc,\n        nbinsx: histogramAttrs.nbinsx,\n        xbins: makeBinAttrs('x'),\n        nbinsy: histogramAttrs.nbinsy,\n        ybins: makeBinAttrs('y'),\n        autobinx: histogramAttrs.autobinx,\n        autobiny: histogramAttrs.autobiny,\n\n        bingroup: extendFlat({}, histogramAttrs.bingroup, {\n            description: [\n                'Set the `xbingroup` and `ybingroup` default prefix',\n                'For example, setting a `bingroup` of *1* on two histogram2d traces',\n                'will make them their x-bins and y-bins match separately.'\n            ].join(' ')\n        }),\n        xbingroup: extendFlat({}, histogramAttrs.bingroup, {\n            description: [\n                'Set a group of histogram traces which will have compatible x-bin settings.',\n                'Using `xbingroup`, histogram2d and histogram2dcontour traces ',\n                '(on axes of the same axis type) can have compatible x-bin settings.',\n                'Note that the same `xbingroup` value can be used to set (1D) histogram `bingroup`'\n            ].join(' ')\n        }),\n        ybingroup: extendFlat({}, histogramAttrs.bingroup, {\n            description: [\n                'Set a group of histogram traces which will have compatible y-bin settings.',\n                'Using `ybingroup`, histogram2d and histogram2dcontour traces ',\n                '(on axes of the same axis type) can have compatible y-bin settings.',\n                'Note that the same `ybingroup` value can be used to set (1D) histogram `bingroup`'\n            ].join(' ')\n        }),\n\n        xgap: heatmapAttrs.xgap,\n        ygap: heatmapAttrs.ygap,\n        zsmooth: heatmapAttrs.zsmooth,\n        xhoverformat: axisHoverFormat('x'),\n        yhoverformat: axisHoverFormat('y'),\n        zhoverformat: axisHoverFormat('z', 1),\n        hovertemplate: hovertemplateAttrs({}, {keys: 'z'}),\n        showlegend: extendFlat({}, baseAttrs.showlegend, {dflt: false})\n    },\n    colorScaleAttrs('', {cLetter: 'z', autoColorDflt: false})\n);\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Axes = require('../../plots/cartesian/axes');\n\nvar binFunctions = require('../histogram/bin_functions');\nvar normFunctions = require('../histogram/norm_functions');\nvar doAvg = require('../histogram/average');\nvar getBinSpanLabelRound = require('../histogram/bin_label_vals');\nvar calcAllAutoBins = require('../histogram/calc').calcAllAutoBins;\n\nmodule.exports = function calc(gd, trace) {\n    var xa = Axes.getFromId(gd, trace.xaxis);\n    var ya = Axes.getFromId(gd, trace.yaxis);\n\n    var xcalendar = trace.xcalendar;\n    var ycalendar = trace.ycalendar;\n    var xr2c = function(v) { return xa.r2c(v, 0, xcalendar); };\n    var yr2c = function(v) { return ya.r2c(v, 0, ycalendar); };\n    var xc2r = function(v) { return xa.c2r(v, 0, xcalendar); };\n    var yc2r = function(v) { return ya.c2r(v, 0, ycalendar); };\n\n    var i, j, n, m;\n\n    // calculate the bins\n    var xBinsAndPos = calcAllAutoBins(gd, trace, xa, 'x');\n    var xBinSpec = xBinsAndPos[0];\n    var xPos0 = xBinsAndPos[1];\n    var yBinsAndPos = calcAllAutoBins(gd, trace, ya, 'y');\n    var yBinSpec = yBinsAndPos[0];\n    var yPos0 = yBinsAndPos[1];\n\n    var serieslen = trace._length;\n    if(xPos0.length > serieslen) xPos0.splice(serieslen, xPos0.length - serieslen);\n    if(yPos0.length > serieslen) yPos0.splice(serieslen, yPos0.length - serieslen);\n\n    // make the empty bin array & scale the map\n    var z = [];\n    var onecol = [];\n    var zerocol = [];\n    var nonuniformBinsX = typeof xBinSpec.size === 'string';\n    var nonuniformBinsY = typeof yBinSpec.size === 'string';\n    var xEdges = [];\n    var yEdges = [];\n    var xbins = nonuniformBinsX ? xEdges : xBinSpec;\n    var ybins = nonuniformBinsY ? yEdges : yBinSpec;\n    var total = 0;\n    var counts = [];\n    var inputPoints = [];\n    var norm = trace.histnorm;\n    var func = trace.histfunc;\n    var densitynorm = norm.indexOf('density') !== -1;\n    var extremefunc = func === 'max' || func === 'min';\n    var sizeinit = extremefunc ? null : 0;\n    var binfunc = binFunctions.count;\n    var normfunc = normFunctions[norm];\n    var doavg = false;\n    var xinc = [];\n    var yinc = [];\n\n    // set a binning function other than count?\n    // for binning functions: check first for 'z',\n    // then 'mc' in case we had a colored scatter plot\n    // and want to transfer these colors to the 2D histo\n    // TODO: axe this, make it the responsibility of the app changing type? or an impliedEdit?\n    var rawCounterData = ('z' in trace) ?\n        trace.z :\n        (('marker' in trace && Array.isArray(trace.marker.color)) ?\n            trace.marker.color : '');\n    if(rawCounterData && func !== 'count') {\n        doavg = func === 'avg';\n        binfunc = binFunctions[func];\n    }\n\n    // decrease end a little in case of rounding errors\n    var xBinSize = xBinSpec.size;\n    var xBinStart = xr2c(xBinSpec.start);\n    var xBinEnd = xr2c(xBinSpec.end) +\n        (xBinStart - Axes.tickIncrement(xBinStart, xBinSize, false, xcalendar)) / 1e6;\n\n    for(i = xBinStart; i < xBinEnd; i = Axes.tickIncrement(i, xBinSize, false, xcalendar)) {\n        onecol.push(sizeinit);\n        xEdges.push(i);\n        if(doavg) zerocol.push(0);\n    }\n    xEdges.push(i);\n\n    var nx = onecol.length;\n    var dx = (i - xBinStart) / nx;\n    var x0 = xc2r(xBinStart + dx / 2);\n\n    var yBinSize = yBinSpec.size;\n    var yBinStart = yr2c(yBinSpec.start);\n    var yBinEnd = yr2c(yBinSpec.end) +\n        (yBinStart - Axes.tickIncrement(yBinStart, yBinSize, false, ycalendar)) / 1e6;\n\n    for(i = yBinStart; i < yBinEnd; i = Axes.tickIncrement(i, yBinSize, false, ycalendar)) {\n        z.push(onecol.slice());\n        yEdges.push(i);\n        var ipCol = new Array(nx);\n        for(j = 0; j < nx; j++) ipCol[j] = [];\n        inputPoints.push(ipCol);\n        if(doavg) counts.push(zerocol.slice());\n    }\n    yEdges.push(i);\n\n    var ny = z.length;\n    var dy = (i - yBinStart) / ny;\n    var y0 = yc2r(yBinStart + dy / 2);\n\n    if(densitynorm) {\n        xinc = makeIncrements(onecol.length, xbins, dx, nonuniformBinsX);\n        yinc = makeIncrements(z.length, ybins, dy, nonuniformBinsY);\n    }\n\n    // for date axes we need bin bounds to be calcdata. For nonuniform bins\n    // we already have this, but uniform with start/end/size they're still strings.\n    if(!nonuniformBinsX && xa.type === 'date') xbins = binsToCalc(xr2c, xbins);\n    if(!nonuniformBinsY && ya.type === 'date') ybins = binsToCalc(yr2c, ybins);\n\n    // put data into bins\n    var uniqueValsPerX = true;\n    var uniqueValsPerY = true;\n    var xVals = new Array(nx);\n    var yVals = new Array(ny);\n    var xGapLow = Infinity;\n    var xGapHigh = Infinity;\n    var yGapLow = Infinity;\n    var yGapHigh = Infinity;\n    for(i = 0; i < serieslen; i++) {\n        var xi = xPos0[i];\n        var yi = yPos0[i];\n        n = Lib.findBin(xi, xbins);\n        m = Lib.findBin(yi, ybins);\n        if(n >= 0 && n < nx && m >= 0 && m < ny) {\n            total += binfunc(n, i, z[m], rawCounterData, counts[m]);\n            inputPoints[m][n].push(i);\n\n            if(uniqueValsPerX) {\n                if(xVals[n] === undefined) xVals[n] = xi;\n                else if(xVals[n] !== xi) uniqueValsPerX = false;\n            }\n            if(uniqueValsPerY) {\n                if(yVals[m] === undefined) yVals[m] = yi;\n                else if(yVals[m] !== yi) uniqueValsPerY = false;\n            }\n\n            xGapLow = Math.min(xGapLow, xi - xEdges[n]);\n            xGapHigh = Math.min(xGapHigh, xEdges[n + 1] - xi);\n            yGapLow = Math.min(yGapLow, yi - yEdges[m]);\n            yGapHigh = Math.min(yGapHigh, yEdges[m + 1] - yi);\n        }\n    }\n    // normalize, if needed\n    if(doavg) {\n        for(m = 0; m < ny; m++) total += doAvg(z[m], counts[m]);\n    }\n    if(normfunc) {\n        for(m = 0; m < ny; m++) normfunc(z[m], total, xinc, yinc[m]);\n    }\n\n    return {\n        x: xPos0,\n        xRanges: getRanges(xEdges, uniqueValsPerX && xVals, xGapLow, xGapHigh, xa, xcalendar),\n        x0: x0,\n        dx: dx,\n        y: yPos0,\n        yRanges: getRanges(yEdges, uniqueValsPerY && yVals, yGapLow, yGapHigh, ya, ycalendar),\n        y0: y0,\n        dy: dy,\n        z: z,\n        pts: inputPoints\n    };\n};\n\nfunction makeIncrements(len, bins, dv, nonuniform) {\n    var out = new Array(len);\n    var i;\n    if(nonuniform) {\n        for(i = 0; i < len; i++) out[i] = 1 / (bins[i + 1] - bins[i]);\n    } else {\n        var inc = 1 / dv;\n        for(i = 0; i < len; i++) out[i] = inc;\n    }\n    return out;\n}\n\nfunction binsToCalc(r2c, bins) {\n    return {\n        start: r2c(bins.start),\n        end: r2c(bins.end),\n        size: bins.size\n    };\n}\n\nfunction getRanges(edges, uniqueVals, gapLow, gapHigh, ax, calendar) {\n    var i;\n    var len = edges.length - 1;\n    var out = new Array(len);\n    var roundFn = getBinSpanLabelRound(gapLow, gapHigh, edges, ax, calendar);\n\n    for(i = 0; i < len; i++) {\n        var v = (uniqueVals || [])[i];\n        out[i] = v === undefined ?\n            [roundFn(edges[i]), roundFn(edges[i + 1], true)] :\n            [v, v];\n    }\n    return out;\n}\n","'use strict';\n\nvar Lib = require('../../lib');\n\nvar handleSampleDefaults = require('./sample_defaults');\nvar handleStyleDefaults = require('../heatmap/style_defaults');\nvar colorscaleDefaults = require('../../components/colorscale/defaults');\nvar attributes = require('./attributes');\n\n\nmodule.exports = function supplyDefaults(traceIn, traceOut, defaultColor, layout) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(traceIn, traceOut, attributes, attr, dflt);\n    }\n\n    handleSampleDefaults(traceIn, traceOut, coerce, layout);\n    if(traceOut.visible === false) return;\n\n    handleStyleDefaults(traceIn, traceOut, coerce, layout);\n    colorscaleDefaults(traceIn, traceOut, layout, coerce, {prefix: '', cLetter: 'z'});\n    coerce('hovertemplate');\n    coerce('xhoverformat');\n    coerce('yhoverformat');\n};\n","'use strict';\n\nvar heatmapHover = require('../heatmap/hover');\nvar hoverLabelText = require('../../plots/cartesian/axes').hoverLabelText;\n\nmodule.exports = function hoverPoints(pointData, xval, yval, hovermode, opts) {\n    var pts = heatmapHover(pointData, xval, yval, hovermode, opts);\n\n    if(!pts) return;\n\n    pointData = pts[0];\n    var indices = pointData.index;\n    var ny = indices[0];\n    var nx = indices[1];\n    var cd0 = pointData.cd[0];\n    var trace = cd0.trace;\n    var xRange = cd0.xRanges[nx];\n    var yRange = cd0.yRanges[ny];\n\n    pointData.xLabel = hoverLabelText(pointData.xa, [xRange[0], xRange[1]], trace.xhoverformat);\n    pointData.yLabel = hoverLabelText(pointData.ya, [yRange[0], yRange[1]], trace.yhoverformat);\n\n    return pts;\n};\n","'use strict';\n\nmodule.exports = {\n    attributes: require('./attributes'),\n    supplyDefaults: require('./defaults'),\n    crossTraceDefaults: require('../histogram/cross_trace_defaults'),\n    calc: require('../heatmap/calc'),\n    plot: require('../heatmap/plot'),\n    layerName: 'heatmaplayer',\n    colorbar: require('../heatmap/colorbar'),\n    style: require('../heatmap/style'),\n    hoverPoints: require('./hover'),\n    eventData: require('../histogram/event_data'),\n\n    moduleType: 'trace',\n    name: 'histogram2d',\n    basePlotModule: require('../../plots/cartesian'),\n    categories: ['cartesian', 'svg', '2dMap', 'histogram', 'showLegend'],\n    meta: {\n        hrName: 'histogram_2d',\n        description: [\n            'The sample data from which statistics are computed is set in `x`',\n            'and `y` (where `x` and `y` represent marginal distributions,',\n            'binning is set in `xbins` and `ybins` in this case)',\n            'or `z` (where `z` represent the 2D distribution and binning set,',\n            'binning is set by `x` and `y` in this case).',\n            'The resulting distribution is visualized as a heatmap.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\n\nmodule.exports = function handleSampleDefaults(traceIn, traceOut, coerce, layout) {\n    var x = coerce('x');\n    var y = coerce('y');\n    var xlen = Lib.minRowLength(x);\n    var ylen = Lib.minRowLength(y);\n\n    // we could try to accept x0 and dx, etc...\n    // but that's a pretty weird use case.\n    // for now require both x and y explicitly specified.\n    if(!xlen || !ylen) {\n        traceOut.visible = false;\n        return;\n    }\n\n    traceOut._length = Math.min(xlen, ylen);\n\n    var handleCalendarDefaults = Registry.getComponentMethod('calendars', 'handleTraceDefaults');\n    handleCalendarDefaults(traceIn, traceOut, ['x', 'y'], layout);\n\n    // if marker.color is an array, we can use it in aggregation instead of z\n    var hasAggregationData = coerce('z') || coerce('marker.color');\n\n    if(hasAggregationData) coerce('histfunc');\n    coerce('histnorm');\n\n    // Note: bin defaults are now handled in Histogram2D.crossTraceDefaults\n    // autobin(x|y) are only included here to appease Plotly.validate\n    coerce('autobinx');\n    coerce('autobiny');\n};\n","'use strict';\n\nvar histogram2dAttrs = require('../histogram2d/attributes');\nvar contourAttrs = require('../contour/attributes');\nvar colorScaleAttrs = require('../../components/colorscale/attributes');\nvar axisHoverFormat = require('../../plots/cartesian/axis_format_attributes').axisHoverFormat;\n\nvar extendFlat = require('../../lib/extend').extendFlat;\n\nmodule.exports = extendFlat({\n    x: histogram2dAttrs.x,\n    y: histogram2dAttrs.y,\n    z: histogram2dAttrs.z,\n    marker: histogram2dAttrs.marker,\n\n    histnorm: histogram2dAttrs.histnorm,\n    histfunc: histogram2dAttrs.histfunc,\n    nbinsx: histogram2dAttrs.nbinsx,\n    xbins: histogram2dAttrs.xbins,\n    nbinsy: histogram2dAttrs.nbinsy,\n    ybins: histogram2dAttrs.ybins,\n    autobinx: histogram2dAttrs.autobinx,\n    autobiny: histogram2dAttrs.autobiny,\n\n    bingroup: histogram2dAttrs.bingroup,\n    xbingroup: histogram2dAttrs.xbingroup,\n    ybingroup: histogram2dAttrs.ybingroup,\n\n    autocontour: contourAttrs.autocontour,\n    ncontours: contourAttrs.ncontours,\n    contours: contourAttrs.contours,\n    line: {\n        color: contourAttrs.line.color,\n        width: extendFlat({}, contourAttrs.line.width, {\n            dflt: 0.5,\n            description: 'Sets the contour line width in (in px)'\n        }),\n        dash: contourAttrs.line.dash,\n        smoothing: contourAttrs.line.smoothing,\n        editType: 'plot'\n    },\n    xhoverformat: axisHoverFormat('x'),\n    yhoverformat: axisHoverFormat('y'),\n    zhoverformat: axisHoverFormat('z', 1),\n    hovertemplate: histogram2dAttrs.hovertemplate\n},\n    colorScaleAttrs('', {\n        cLetter: 'z',\n        editTypeOverride: 'calc'\n    })\n);\n","'use strict';\n\nvar Lib = require('../../lib');\n\nvar handleSampleDefaults = require('../histogram2d/sample_defaults');\nvar handleContoursDefaults = require('../contour/contours_defaults');\nvar handleStyleDefaults = require('../contour/style_defaults');\nvar attributes = require('./attributes');\n\n\nmodule.exports = function supplyDefaults(traceIn, traceOut, defaultColor, layout) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(traceIn, traceOut, attributes, attr, dflt);\n    }\n\n    function coerce2(attr) {\n        return Lib.coerce2(traceIn, traceOut, attributes, attr);\n    }\n\n    handleSampleDefaults(traceIn, traceOut, coerce, layout);\n    if(traceOut.visible === false) return;\n\n    handleContoursDefaults(traceIn, traceOut, coerce, coerce2);\n    handleStyleDefaults(traceIn, traceOut, coerce, layout);\n    coerce('hovertemplate');\n    coerce('xhoverformat');\n    coerce('yhoverformat');\n};\n","'use strict';\n\nmodule.exports = {\n    attributes: require('./attributes'),\n    supplyDefaults: require('./defaults'),\n    crossTraceDefaults: require('../histogram/cross_trace_defaults'),\n    calc: require('../contour/calc'),\n    plot: require('../contour/plot').plot,\n    layerName: 'contourlayer',\n    style: require('../contour/style'),\n    colorbar: require('../contour/colorbar'),\n    hoverPoints: require('../contour/hover'),\n\n    moduleType: 'trace',\n    name: 'histogram2dcontour',\n    basePlotModule: require('../../plots/cartesian'),\n    categories: ['cartesian', 'svg', '2dMap', 'contour', 'histogram', 'showLegend'],\n    meta: {\n        hrName: 'histogram_2d_contour',\n        description: [\n            'The sample data from which statistics are computed is set in `x`',\n            'and `y` (where `x` and `y` represent marginal distributions,',\n            'binning is set in `xbins` and `ybins` in this case)',\n            'or `z` (where `z` represent the 2D distribution and binning set,',\n            'binning is set by `x` and `y` in this case).',\n            'The resulting distribution is visualized as a contour plot.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar barAttrs = require('../bar/attributes');\nvar axisHoverFormat = require('../../plots/cartesian/axis_format_attributes').axisHoverFormat;\nvar hovertemplateAttrs = require('../../plots/template_attributes').hovertemplateAttrs;\nvar makeBinAttrs = require('./bin_attributes');\nvar constants = require('./constants');\nvar extendFlat = require('../../lib/extend').extendFlat;\n\nmodule.exports = {\n    x: {\n        valType: 'data_array',\n        editType: 'calc+clearAxisTypes',\n        description: [\n            'Sets the sample data to be binned on the x axis.'\n        ].join(' ')\n    },\n    y: {\n        valType: 'data_array',\n        editType: 'calc+clearAxisTypes',\n        description: [\n            'Sets the sample data to be binned on the y axis.'\n        ].join(' ')\n    },\n\n    xhoverformat: axisHoverFormat('x'),\n    yhoverformat: axisHoverFormat('y'),\n\n    text: extendFlat({}, barAttrs.text, {\n        description: [\n            'Sets hover text elements associated with each bar.',\n            'If a single string, the same string appears over all bars.',\n            'If an array of string, the items are mapped in order to the',\n            'this trace\\'s coordinates.'\n        ].join(' ')\n    }),\n    hovertext: extendFlat({}, barAttrs.hovertext, {\n        description: 'Same as `text`.'\n    }),\n    orientation: barAttrs.orientation,\n\n    histfunc: {\n        valType: 'enumerated',\n        values: ['count', 'sum', 'avg', 'min', 'max'],\n        dflt: 'count',\n        editType: 'calc',\n        description: [\n            'Specifies the binning function used for this histogram trace.',\n\n            'If *count*, the histogram values are computed by counting the',\n            'number of values lying inside each bin.',\n\n            'If *sum*, *avg*, *min*, *max*,',\n            'the histogram values are computed using',\n            'the sum, the average, the minimum or the maximum',\n            'of the values lying inside each bin respectively.'\n        ].join(' ')\n    },\n    histnorm: {\n        valType: 'enumerated',\n        values: ['', 'percent', 'probability', 'density', 'probability density'],\n        dflt: '',\n        editType: 'calc',\n        description: [\n            'Specifies the type of normalization used for this histogram trace.',\n\n            'If **, the span of each bar corresponds to the number of',\n            'occurrences (i.e. the number of data points lying inside the bins).',\n\n            'If *percent* / *probability*, the span of each bar corresponds to',\n            'the percentage / fraction of occurrences with respect to the total',\n            'number of sample points',\n            '(here, the sum of all bin HEIGHTS equals 100% / 1).',\n\n            'If *density*, the span of each bar corresponds to the number of',\n            'occurrences in a bin divided by the size of the bin interval',\n            '(here, the sum of all bin AREAS equals the',\n            'total number of sample points).',\n\n            'If *probability density*, the area of each bar corresponds to the',\n            'probability that an event will fall into the corresponding bin',\n            '(here, the sum of all bin AREAS equals 1).'\n        ].join(' ')\n    },\n\n    cumulative: {\n        enabled: {\n            valType: 'boolean',\n            dflt: false,\n            editType: 'calc',\n            description: [\n                'If true, display the cumulative distribution by summing the',\n                'binned values. Use the `direction` and `centralbin` attributes',\n                'to tune the accumulation method.',\n                'Note: in this mode, the *density* `histnorm` settings behave',\n                'the same as their equivalents without *density*:',\n                '** and *density* both rise to the number of data points, and',\n                '*probability* and *probability density* both rise to the',\n                'number of sample points.'\n            ].join(' ')\n        },\n\n        direction: {\n            valType: 'enumerated',\n            values: ['increasing', 'decreasing'],\n            dflt: 'increasing',\n            editType: 'calc',\n            description: [\n                'Only applies if cumulative is enabled.',\n                'If *increasing* (default) we sum all prior bins, so the result',\n                'increases from left to right. If *decreasing* we sum later bins',\n                'so the result decreases from left to right.'\n            ].join(' ')\n        },\n\n        currentbin: {\n            valType: 'enumerated',\n            values: ['include', 'exclude', 'half'],\n            dflt: 'include',\n            editType: 'calc',\n            description: [\n                'Only applies if cumulative is enabled.',\n                'Sets whether the current bin is included, excluded, or has half',\n                'of its value included in the current cumulative value.',\n                '*include* is the default for compatibility with various other',\n                'tools, however it introduces a half-bin bias to the results.',\n                '*exclude* makes the opposite half-bin bias, and *half* removes',\n                'it.'\n            ].join(' ')\n        },\n        editType: 'calc'\n    },\n    nbinsx: {\n        valType: 'integer',\n        min: 0,\n        dflt: 0,\n        editType: 'calc',\n        description: [\n            'Specifies the maximum number of desired bins. This value will be used',\n            'in an algorithm that will decide the optimal bin size such that the',\n            'histogram best visualizes the distribution of the data.',\n            'Ignored if `xbins.size` is provided.'\n        ].join(' ')\n    },\n    xbins: makeBinAttrs('x', true),\n\n    nbinsy: {\n        valType: 'integer',\n        min: 0,\n        dflt: 0,\n        editType: 'calc',\n        description: [\n            'Specifies the maximum number of desired bins. This value will be used',\n            'in an algorithm that will decide the optimal bin size such that the',\n            'histogram best visualizes the distribution of the data.',\n            'Ignored if `ybins.size` is provided.'\n        ].join(' ')\n    },\n    ybins: makeBinAttrs('y', true),\n    autobinx: {\n        valType: 'boolean',\n        dflt: null,\n        editType: 'calc',\n        description: [\n            'Obsolete: since v1.42 each bin attribute is auto-determined',\n            'separately and `autobinx` is not needed. However, we accept',\n            '`autobinx: true` or `false` and will update `xbins` accordingly',\n            'before deleting `autobinx` from the trace.'\n        ].join(' ')\n    },\n    autobiny: {\n        valType: 'boolean',\n        dflt: null,\n        editType: 'calc',\n        description: [\n            'Obsolete: since v1.42 each bin attribute is auto-determined',\n            'separately and `autobiny` is not needed. However, we accept',\n            '`autobiny: true` or `false` and will update `ybins` accordingly',\n            'before deleting `autobiny` from the trace.'\n        ].join(' ')\n    },\n\n    bingroup: {\n        valType: 'string',\n        dflt: '',\n        editType: 'calc',\n        description: [\n            'Set a group of histogram traces which will have compatible bin settings.',\n            'Note that traces on the same subplot and with the same *orientation*',\n            'under `barmode` *stack*, *relative* and *group* are forced into the same bingroup,',\n            'Using `bingroup`, traces under `barmode` *overlay* and on different axes',\n            '(of the same axis type) can have compatible bin settings.',\n            'Note that histogram and histogram2d* trace can share the same `bingroup`'\n        ].join(' ')\n    },\n\n    hovertemplate: hovertemplateAttrs({}, {\n        keys: constants.eventDataKeys\n    }),\n\n    marker: barAttrs.marker,\n\n    offsetgroup: barAttrs.offsetgroup,\n    alignmentgroup: barAttrs.alignmentgroup,\n\n    selected: barAttrs.selected,\n    unselected: barAttrs.unselected,\n\n    _deprecated: {\n        bardir: barAttrs._deprecated.bardir\n    }\n};\n","'use strict';\n\n\nmodule.exports = function doAvg(size, counts) {\n    var nMax = size.length;\n    var total = 0;\n    for(var i = 0; i < nMax; i++) {\n        if(counts[i]) {\n            size[i] /= counts[i];\n            total += size[i];\n        } else size[i] = null;\n    }\n    return total;\n};\n","'use strict';\n\nmodule.exports = function makeBinAttrs(axLetter, match) {\n    return {\n        start: {\n            valType: 'any', // for date axes\n            editType: 'calc',\n            description: [\n                'Sets the starting value for the', axLetter,\n                'axis bins. Defaults to the minimum data value,',\n                'shifted down if necessary to make nice round values',\n                'and to remove ambiguous bin edges. For example, if most of the',\n                'data is integers we shift the bin edges 0.5 down, so a `size`',\n                'of 5 would have a default `start` of -0.5, so it is clear',\n                'that 0-4 are in the first bin, 5-9 in the second, but',\n                'continuous data gets a start of 0 and bins [0,5), [5,10) etc.',\n                'Dates behave similarly, and `start` should be a date string.',\n                'For category data, `start` is based on the category serial',\n                'numbers, and defaults to -0.5.',\n                (match ? (\n                    'If multiple non-overlaying histograms share a subplot, ' +\n                    'the first explicit `start` is used exactly and all others ' +\n                    'are shifted down (if necessary) to differ from that one ' +\n                    'by an integer number of bins.'\n                ) : '')\n            ].join(' ')\n        },\n        end: {\n            valType: 'any', // for date axes\n            editType: 'calc',\n            description: [\n                'Sets the end value for the', axLetter,\n                'axis bins. The last bin may not end exactly at this value,',\n                'we increment the bin edge by `size` from `start` until we',\n                'reach or exceed `end`. Defaults to the maximum data value.',\n                'Like `start`, for dates use a date string, and for category',\n                'data `end` is based on the category serial numbers.'\n            ].join(' ')\n        },\n        size: {\n            valType: 'any', // for date axes\n            editType: 'calc',\n            description: [\n                'Sets the size of each', axLetter, 'axis bin.',\n                'Default behavior: If `nbins' + axLetter + '` is 0 or omitted,',\n                'we choose a nice round bin size such that the number of bins',\n                'is about the same as the typical number of samples in each bin.',\n                'If `nbins' + axLetter + '` is provided, we choose a nice round',\n                'bin size giving no more than that many bins.',\n                'For date data, use milliseconds or *M<n>* for months, as in',\n                '`axis.dtick`. For category data, the number of categories to',\n                'bin together (always defaults to 1).',\n                (match ? (\n                    'If multiple non-overlaying histograms share a subplot, ' +\n                    'the first explicit `size` is used and all others discarded. ' +\n                    'If no `size` is provided,the sample data from all traces ' +\n                    'is combined to determine `size` as described above.'\n                ) : '')\n            ].join(' ')\n        },\n        editType: 'calc'\n    };\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\n\nmodule.exports = {\n    count: function(n, i, size) {\n        size[n]++;\n        return 1;\n    },\n\n    sum: function(n, i, size, counterData) {\n        var v = counterData[i];\n        if(isNumeric(v)) {\n            v = Number(v);\n            size[n] += v;\n            return v;\n        }\n        return 0;\n    },\n\n    avg: function(n, i, size, counterData, counts) {\n        var v = counterData[i];\n        if(isNumeric(v)) {\n            v = Number(v);\n            size[n] += v;\n            counts[n]++;\n        }\n        return 0;\n    },\n\n    min: function(n, i, size, counterData) {\n        var v = counterData[i];\n        if(isNumeric(v)) {\n            v = Number(v);\n            if(!isNumeric(size[n])) {\n                size[n] = v;\n                return v;\n            } else if(size[n] > v) {\n                var delta = v - size[n];\n                size[n] = v;\n                return delta;\n            }\n        }\n        return 0;\n    },\n\n    max: function(n, i, size, counterData) {\n        var v = counterData[i];\n        if(isNumeric(v)) {\n            v = Number(v);\n            if(!isNumeric(size[n])) {\n                size[n] = v;\n                return v;\n            } else if(size[n] < v) {\n                var delta = v - size[n];\n                size[n] = v;\n                return delta;\n            }\n        }\n        return 0;\n    }\n};\n","'use strict';\n\nvar numConstants = require('../../constants/numerical');\nvar oneYear = numConstants.ONEAVGYEAR;\nvar oneMonth = numConstants.ONEAVGMONTH;\nvar oneDay = numConstants.ONEDAY;\nvar oneHour = numConstants.ONEHOUR;\nvar oneMin = numConstants.ONEMIN;\nvar oneSec = numConstants.ONESEC;\nvar tickIncrement = require('../../plots/cartesian/axes').tickIncrement;\n\n\n/*\n * make a function that will find rounded bin edges\n * @param {number} leftGap: how far from the left edge of any bin is the closest data value?\n * @param {number} rightGap: how far from the right edge of any bin is the closest data value?\n * @param {Array[number]} binEdges: the actual edge values used in binning\n * @param {object} pa: the position axis\n * @param {string} calendar: the data calendar\n *\n * @return {function(v, isRightEdge)}:\n *   find the start (isRightEdge is falsy) or end (truthy) label value for a bin edge `v`\n */\nmodule.exports = function getBinSpanLabelRound(leftGap, rightGap, binEdges, pa, calendar) {\n    // the rounding digit is the largest digit that changes in *all* of 4 regions:\n    // - inside the rightGap before binEdges[0] (shifted 10% to the left)\n    // - inside the leftGap after binEdges[0] (expanded by 10% of rightGap on each end)\n    // - same for binEdges[1]\n    var dv0 = -1.1 * rightGap;\n    var dv1 = -0.1 * rightGap;\n    var dv2 = leftGap - dv1;\n    var edge0 = binEdges[0];\n    var edge1 = binEdges[1];\n    var leftDigit = Math.min(\n        biggestDigitChanged(edge0 + dv1, edge0 + dv2, pa, calendar),\n        biggestDigitChanged(edge1 + dv1, edge1 + dv2, pa, calendar)\n    );\n    var rightDigit = Math.min(\n        biggestDigitChanged(edge0 + dv0, edge0 + dv1, pa, calendar),\n        biggestDigitChanged(edge1 + dv0, edge1 + dv1, pa, calendar)\n    );\n\n    // normally we try to make the label for the right edge different from\n    // the left edge label, so it's unambiguous which bin gets data on the edge.\n    // but if this results in more than 3 extra digits (or for dates, more than\n    // 2 fields ie hr&min or min&sec, which is 3600x), it'll be more clutter than\n    // useful so keep the label cleaner instead\n    var digit, disambiguateEdges;\n    if(leftDigit > rightDigit && rightDigit < Math.abs(edge1 - edge0) / 4000) {\n        digit = leftDigit;\n        disambiguateEdges = false;\n    } else {\n        digit = Math.min(leftDigit, rightDigit);\n        disambiguateEdges = true;\n    }\n\n    if(pa.type === 'date' && digit > oneDay) {\n        var dashExclude = (digit === oneYear) ? 1 : 6;\n        var increment = (digit === oneYear) ? 'M12' : 'M1';\n\n        return function(v, isRightEdge) {\n            var dateStr = pa.c2d(v, oneYear, calendar);\n            var dashPos = dateStr.indexOf('-', dashExclude);\n            if(dashPos > 0) dateStr = dateStr.substr(0, dashPos);\n            var roundedV = pa.d2c(dateStr, 0, calendar);\n\n            if(roundedV < v) {\n                var nextV = tickIncrement(roundedV, increment, false, calendar);\n                if((roundedV + nextV) / 2 < v + leftGap) roundedV = nextV;\n            }\n\n            if(isRightEdge && disambiguateEdges) {\n                return tickIncrement(roundedV, increment, true, calendar);\n            }\n\n            return roundedV;\n        };\n    }\n\n    return function(v, isRightEdge) {\n        var roundedV = digit * Math.round(v / digit);\n        // if we rounded down and we could round up and still be < leftGap\n        // (or what leftGap values round to), do that\n        if(roundedV + (digit / 10) < v && roundedV + (digit * 0.9) < v + leftGap) {\n            roundedV += digit;\n        }\n        // finally for the right edge back off one digit - but only if we can do that\n        // and not clip off any data that's potentially in the bin\n        if(isRightEdge && disambiguateEdges) {\n            roundedV -= digit;\n        }\n        return roundedV;\n    };\n};\n\n/*\n * Find the largest digit that changes within a (calcdata) region [v1, v2]\n * if dates, \"digit\" means date/time part when it's bigger than a second\n * returns the unit value to round to this digit, eg 0.01 to round to hundredths, or\n * 100 to round to hundreds. returns oneMonth or oneYear for month or year rounding,\n * so that Math.min will work, rather than 'M1' and 'M12'\n */\nfunction biggestDigitChanged(v1, v2, pa, calendar) {\n    // are we crossing zero? can't say anything.\n    // in principle this doesn't apply to dates but turns out this doesn't matter.\n    if(v1 * v2 <= 0) return Infinity;\n\n    var dv = Math.abs(v2 - v1);\n    var isDate = pa.type === 'date';\n    var digit = biggestGuaranteedDigitChanged(dv, isDate);\n    // see if a larger digit also changed\n    for(var i = 0; i < 10; i++) {\n        // numbers: next digit needs to be >10x but <100x then gets rounded down.\n        // dates: next digit can be as much as 60x (then rounded down)\n        var nextDigit = biggestGuaranteedDigitChanged(digit * 80, isDate);\n        // if we get to years, the chain stops\n        if(digit === nextDigit) break;\n        if(didDigitChange(nextDigit, v1, v2, isDate, pa, calendar)) digit = nextDigit;\n        else break;\n    }\n    return digit;\n}\n\n/*\n * Find the largest digit that *definitely* changes in a region [v, v + dv] for any v\n * for nonuniform date regions (months/years) pick the largest\n */\nfunction biggestGuaranteedDigitChanged(dv, isDate) {\n    if(isDate && dv > oneSec) {\n        // this is supposed to be the biggest *guaranteed* change\n        // so compare to the longest month and year across any calendar,\n        // and we'll iterate back up later\n        // note: does not support rounding larger than one year. We could add\n        // that if anyone wants it, but seems unusual and not strictly necessary.\n        if(dv > oneDay) {\n            if(dv > oneYear * 1.1) return oneYear;\n            if(dv > oneMonth * 1.1) return oneMonth;\n            return oneDay;\n        }\n\n        if(dv > oneHour) return oneHour;\n        if(dv > oneMin) return oneMin;\n        return oneSec;\n    }\n    return Math.pow(10, Math.floor(Math.log(dv) / Math.LN10));\n}\n\nfunction didDigitChange(digit, v1, v2, isDate, pa, calendar) {\n    if(isDate && digit > oneDay) {\n        var dateParts1 = dateParts(v1, pa, calendar);\n        var dateParts2 = dateParts(v2, pa, calendar);\n        var parti = (digit === oneYear) ? 0 : 1;\n        return dateParts1[parti] !== dateParts2[parti];\n    }\n    return Math.floor(v2 / digit) - Math.floor(v1 / digit) > 0.1;\n}\n\nfunction dateParts(v, pa, calendar) {\n    var parts = pa.c2d(v, oneYear, calendar).split('-');\n    if(parts[0] === '') {\n        parts.unshift();\n        parts[0] = '-' + parts[0];\n    }\n    return parts;\n}\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\nvar Lib = require('../../lib');\nvar Registry = require('../../registry');\nvar Axes = require('../../plots/cartesian/axes');\n\nvar arraysToCalcdata = require('../bar/arrays_to_calcdata');\nvar binFunctions = require('./bin_functions');\nvar normFunctions = require('./norm_functions');\nvar doAvg = require('./average');\nvar getBinSpanLabelRound = require('./bin_label_vals');\n\nfunction calc(gd, trace) {\n    var pos = [];\n    var size = [];\n    var pa = Axes.getFromId(gd, trace.orientation === 'h' ? trace.yaxis : trace.xaxis);\n    var mainData = trace.orientation === 'h' ? 'y' : 'x';\n    var counterData = {x: 'y', y: 'x'}[mainData];\n    var calendar = trace[mainData + 'calendar'];\n    var cumulativeSpec = trace.cumulative;\n    var i;\n\n    var binsAndPos = calcAllAutoBins(gd, trace, pa, mainData);\n    var binSpec = binsAndPos[0];\n    var pos0 = binsAndPos[1];\n\n    var nonuniformBins = typeof binSpec.size === 'string';\n    var binEdges = [];\n    var bins = nonuniformBins ? binEdges : binSpec;\n    // make the empty bin array\n    var inc = [];\n    var counts = [];\n    var inputPoints = [];\n    var total = 0;\n    var norm = trace.histnorm;\n    var func = trace.histfunc;\n    var densityNorm = norm.indexOf('density') !== -1;\n    var i2, binEnd, n;\n\n    if(cumulativeSpec.enabled && densityNorm) {\n        // we treat \"cumulative\" like it means \"integral\" if you use a density norm,\n        // which in the end means it's the same as without \"density\"\n        norm = norm.replace(/ ?density$/, '');\n        densityNorm = false;\n    }\n\n    var extremeFunc = func === 'max' || func === 'min';\n    var sizeInit = extremeFunc ? null : 0;\n    var binFunc = binFunctions.count;\n    var normFunc = normFunctions[norm];\n    var isAvg = false;\n    var pr2c = function(v) { return pa.r2c(v, 0, calendar); };\n    var rawCounterData;\n\n    if(Lib.isArrayOrTypedArray(trace[counterData]) && func !== 'count') {\n        rawCounterData = trace[counterData];\n        isAvg = func === 'avg';\n        binFunc = binFunctions[func];\n    }\n\n    // create the bins (and any extra arrays needed)\n    // assume more than 1e6 bins is an error, so we don't crash the browser\n    i = pr2c(binSpec.start);\n\n    // decrease end a little in case of rounding errors\n    binEnd = pr2c(binSpec.end) + (i - Axes.tickIncrement(i, binSpec.size, false, calendar)) / 1e6;\n\n    while(i < binEnd && pos.length < 1e6) {\n        i2 = Axes.tickIncrement(i, binSpec.size, false, calendar);\n        pos.push((i + i2) / 2);\n        size.push(sizeInit);\n        inputPoints.push([]);\n        // nonuniform bins (like months) we need to search,\n        // rather than straight calculate the bin we're in\n        binEdges.push(i);\n        // nonuniform bins also need nonuniform normalization factors\n        if(densityNorm) inc.push(1 / (i2 - i));\n        if(isAvg) counts.push(0);\n        // break to avoid infinite loops\n        if(i2 <= i) break;\n        i = i2;\n    }\n    binEdges.push(i);\n\n    // for date axes we need bin bounds to be calcdata. For nonuniform bins\n    // we already have this, but uniform with start/end/size they're still strings.\n    if(!nonuniformBins && pa.type === 'date') {\n        bins = {\n            start: pr2c(bins.start),\n            end: pr2c(bins.end),\n            size: bins.size\n        };\n    }\n\n    // stash left and right gaps by group\n    if(!gd._fullLayout._roundFnOpts) gd._fullLayout._roundFnOpts = {};\n    var groupName = trace['_' + mainData + 'bingroup'];\n    var roundFnOpts = {leftGap: Infinity, rightGap: Infinity};\n    if(groupName) {\n        if(!gd._fullLayout._roundFnOpts[groupName]) gd._fullLayout._roundFnOpts[groupName] = roundFnOpts;\n        roundFnOpts = gd._fullLayout._roundFnOpts[groupName];\n    }\n\n    // bin the data\n    // and make histogram-specific pt-number-to-cd-index map object\n    var nMax = size.length;\n    var uniqueValsPerBin = true;\n    var leftGap = roundFnOpts.leftGap;\n    var rightGap = roundFnOpts.rightGap;\n    var ptNumber2cdIndex = {};\n    for(i = 0; i < pos0.length; i++) {\n        var posi = pos0[i];\n        n = Lib.findBin(posi, bins);\n        if(n >= 0 && n < nMax) {\n            total += binFunc(n, i, size, rawCounterData, counts);\n            if(uniqueValsPerBin && inputPoints[n].length && posi !== pos0[inputPoints[n][0]]) {\n                uniqueValsPerBin = false;\n            }\n            inputPoints[n].push(i);\n            ptNumber2cdIndex[i] = n;\n\n            leftGap = Math.min(leftGap, posi - binEdges[n]);\n            rightGap = Math.min(rightGap, binEdges[n + 1] - posi);\n        }\n    }\n    roundFnOpts.leftGap = leftGap;\n    roundFnOpts.rightGap = rightGap;\n\n    var roundFn;\n    if(!uniqueValsPerBin) {\n        roundFn = function(v, isRightEdge) {\n            return function() {\n                var roundFnOpts = gd._fullLayout._roundFnOpts[groupName];\n                return getBinSpanLabelRound(\n                    roundFnOpts.leftGap,\n                    roundFnOpts.rightGap,\n                    binEdges, pa, calendar\n                )(v, isRightEdge);\n            };\n        };\n    }\n\n    // average and/or normalize the data, if needed\n    if(isAvg) total = doAvg(size, counts);\n    if(normFunc) normFunc(size, total, inc);\n\n    // after all normalization etc, now we can accumulate if desired\n    if(cumulativeSpec.enabled) cdf(size, cumulativeSpec.direction, cumulativeSpec.currentbin);\n\n    var seriesLen = Math.min(pos.length, size.length);\n    var cd = [];\n    var firstNonzero = 0;\n    var lastNonzero = seriesLen - 1;\n\n    // look for empty bins at the ends to remove, so autoscale omits them\n    for(i = 0; i < seriesLen; i++) {\n        if(size[i]) {\n            firstNonzero = i;\n            break;\n        }\n    }\n    for(i = seriesLen - 1; i >= firstNonzero; i--) {\n        if(size[i]) {\n            lastNonzero = i;\n            break;\n        }\n    }\n\n    // create the \"calculated data\" to plot\n    for(i = firstNonzero; i <= lastNonzero; i++) {\n        if((isNumeric(pos[i]) && isNumeric(size[i]))) {\n            var cdi = {\n                p: pos[i],\n                s: size[i],\n                b: 0\n            };\n\n            // setup hover and event data fields,\n            // N.B. pts and \"hover\" positions ph0/ph1 don't seem to make much sense\n            // for cumulative distributions\n            if(!cumulativeSpec.enabled) {\n                cdi.pts = inputPoints[i];\n                if(uniqueValsPerBin) {\n                    cdi.ph0 = cdi.ph1 = (inputPoints[i].length) ? pos0[inputPoints[i][0]] : pos[i];\n                } else {\n                    // Defer evaluation of ph(0|1) in crossTraceCalc\n                    trace._computePh = true;\n                    cdi.ph0 = roundFn(binEdges[i]);\n                    cdi.ph1 = roundFn(binEdges[i + 1], true);\n                }\n            }\n            cd.push(cdi);\n        }\n    }\n\n    if(cd.length === 1) {\n        // when we collapse to a single bin, calcdata no longer describes bin size\n        // so we need to explicitly specify it\n        cd[0].width1 = Axes.tickIncrement(cd[0].p, binSpec.size, false, calendar) - cd[0].p;\n    }\n\n    arraysToCalcdata(cd, trace);\n\n    if(Lib.isArrayOrTypedArray(trace.selectedpoints)) {\n        Lib.tagSelected(cd, trace, ptNumber2cdIndex);\n    }\n\n    return cd;\n}\n\n/*\n * calcAllAutoBins: we want all histograms inside the same bingroup\n * (see logic in Histogram.crossTraceDefaults) to share bin specs\n *\n * If the user has explicitly specified differing\n * bin specs, there's nothing we can do, but if possible we will try to use the\n * smallest bins of any of the auto values for all histograms inside the same\n * bingroup.\n */\nfunction calcAllAutoBins(gd, trace, pa, mainData, _overlayEdgeCase) {\n    var binAttr = mainData + 'bins';\n    var fullLayout = gd._fullLayout;\n    var groupName = trace['_' + mainData + 'bingroup'];\n    var binOpts = fullLayout._histogramBinOpts[groupName];\n    var isOverlay = fullLayout.barmode === 'overlay';\n    var i, traces, tracei, calendar, pos0, autoVals, cumulativeSpec;\n\n    var r2c = function(v) { return pa.r2c(v, 0, calendar); };\n    var c2r = function(v) { return pa.c2r(v, 0, calendar); };\n\n    var cleanBound = pa.type === 'date' ?\n        function(v) { return (v || v === 0) ? Lib.cleanDate(v, null, calendar) : null; } :\n        function(v) { return isNumeric(v) ? Number(v) : null; };\n\n    function setBound(attr, bins, newBins) {\n        if(bins[attr + 'Found']) {\n            bins[attr] = cleanBound(bins[attr]);\n            if(bins[attr] === null) bins[attr] = newBins[attr];\n        } else {\n            autoVals[attr] = bins[attr] = newBins[attr];\n            Lib.nestedProperty(traces[0], binAttr + '.' + attr).set(newBins[attr]);\n        }\n    }\n\n    // all but the first trace in this group has already been marked finished\n    // clear this flag, so next time we run calc we will run autobin again\n    if(trace['_' + mainData + 'autoBinFinished']) {\n        delete trace['_' + mainData + 'autoBinFinished'];\n    } else {\n        traces = binOpts.traces;\n        var allPos = [];\n\n        // Note: we're including `legendonly` traces here for autobin purposes,\n        // so that showing & hiding from the legend won't affect bins.\n        // But this complicates things a bit since those traces don't `calc`,\n        // hence `isFirstVisible`.\n        var isFirstVisible = true;\n        var has2dMap = false;\n        var hasHist2dContour = false;\n        for(i = 0; i < traces.length; i++) {\n            tracei = traces[i];\n\n            if(tracei.visible) {\n                var mainDatai = binOpts.dirs[i];\n                pos0 = tracei['_' + mainDatai + 'pos0'] = pa.makeCalcdata(tracei, mainDatai);\n\n                allPos = Lib.concat(allPos, pos0);\n                delete tracei['_' + mainData + 'autoBinFinished'];\n\n                if(trace.visible === true) {\n                    if(isFirstVisible) {\n                        isFirstVisible = false;\n                    } else {\n                        delete tracei._autoBin;\n                        tracei['_' + mainData + 'autoBinFinished'] = 1;\n                    }\n                    if(Registry.traceIs(tracei, '2dMap')) {\n                        has2dMap = true;\n                    }\n                    if(tracei.type === 'histogram2dcontour') {\n                        hasHist2dContour = true;\n                    }\n                }\n            }\n        }\n\n        calendar = traces[0][mainData + 'calendar'];\n        var newBinSpec = Axes.autoBin(allPos, pa, binOpts.nbins, has2dMap, calendar, binOpts.sizeFound && binOpts.size);\n\n        var autoBin = traces[0]._autoBin = {};\n        autoVals = autoBin[binOpts.dirs[0]] = {};\n\n        if(hasHist2dContour) {\n            // the \"true\" 2nd argument reverses the tick direction (which we can't\n            // just do with a minus sign because of month bins)\n            if(!binOpts.size) {\n                newBinSpec.start = c2r(Axes.tickIncrement(\n                    r2c(newBinSpec.start), newBinSpec.size, true, calendar));\n            }\n            if(binOpts.end === undefined) {\n                newBinSpec.end = c2r(Axes.tickIncrement(\n                    r2c(newBinSpec.end), newBinSpec.size, false, calendar));\n            }\n        }\n\n        // Edge case: single-valued histogram overlaying others\n        // Use them all together to calculate the bin size for the single-valued one\n        if(isOverlay && !Registry.traceIs(trace, '2dMap') && newBinSpec._dataSpan === 0 &&\n            pa.type !== 'category' && pa.type !== 'multicategory') {\n            // Several single-valued histograms! Stop infinite recursion,\n            // just return an extra flag that tells handleSingleValueOverlays\n            // to sort out this trace too\n            if(_overlayEdgeCase) return [newBinSpec, pos0, true];\n\n            newBinSpec = handleSingleValueOverlays(gd, trace, pa, mainData, binAttr);\n        }\n\n        // adjust for CDF edge cases\n        cumulativeSpec = tracei.cumulative || {};\n        if(cumulativeSpec.enabled && (cumulativeSpec.currentbin !== 'include')) {\n            if(cumulativeSpec.direction === 'decreasing') {\n                newBinSpec.start = c2r(Axes.tickIncrement(\n                    r2c(newBinSpec.start), newBinSpec.size, true, calendar));\n            } else {\n                newBinSpec.end = c2r(Axes.tickIncrement(\n                    r2c(newBinSpec.end), newBinSpec.size, false, calendar));\n            }\n        }\n\n        binOpts.size = newBinSpec.size;\n        if(!binOpts.sizeFound) {\n            autoVals.size = newBinSpec.size;\n            Lib.nestedProperty(traces[0], binAttr + '.size').set(newBinSpec.size);\n        }\n\n        setBound('start', binOpts, newBinSpec);\n        setBound('end', binOpts, newBinSpec);\n    }\n\n    pos0 = trace['_' + mainData + 'pos0'];\n    delete trace['_' + mainData + 'pos0'];\n\n    // Each trace can specify its own start/end, or if omitted\n    // we ensure they're beyond the bounds of this trace's data,\n    // and we need to make sure start is aligned with the main start\n    var traceInputBins = trace._input[binAttr] || {};\n    var traceBinOptsCalc = Lib.extendFlat({}, binOpts);\n    var mainStart = binOpts.start;\n    var startIn = pa.r2l(traceInputBins.start);\n    var hasStart = startIn !== undefined;\n    if((binOpts.startFound || hasStart) && startIn !== pa.r2l(mainStart)) {\n        // We have an explicit start to reconcile across traces\n        // if this trace has an explicit start, shift it down to a bin edge\n        // if another trace had an explicit start, shift it down to a\n        // bin edge past our data\n        var traceStart = hasStart ?\n            startIn :\n            Lib.aggNums(Math.min, null, pos0);\n\n        var dummyAx = {\n            type: (pa.type === 'category' || pa.type === 'multicategory') ? 'linear' : pa.type,\n            r2l: pa.r2l,\n            dtick: binOpts.size,\n            tick0: mainStart,\n            calendar: calendar,\n            range: ([traceStart, Axes.tickIncrement(traceStart, binOpts.size, false, calendar)]).map(pa.l2r)\n        };\n        var newStart = Axes.tickFirst(dummyAx);\n        if(newStart > pa.r2l(traceStart)) {\n            newStart = Axes.tickIncrement(newStart, binOpts.size, true, calendar);\n        }\n        traceBinOptsCalc.start = pa.l2r(newStart);\n        if(!hasStart) Lib.nestedProperty(trace, binAttr + '.start').set(traceBinOptsCalc.start);\n    }\n\n    var mainEnd = binOpts.end;\n    var endIn = pa.r2l(traceInputBins.end);\n    var hasEnd = endIn !== undefined;\n    if((binOpts.endFound || hasEnd) && endIn !== pa.r2l(mainEnd)) {\n        // Reconciling an explicit end is easier, as it doesn't need to\n        // match bin edges\n        var traceEnd = hasEnd ?\n            endIn :\n            Lib.aggNums(Math.max, null, pos0);\n\n        traceBinOptsCalc.end = pa.l2r(traceEnd);\n        if(!hasEnd) Lib.nestedProperty(trace, binAttr + '.start').set(traceBinOptsCalc.end);\n    }\n\n    // Backward compatibility for one-time autobinning.\n    // autobin: true is handled in cleanData, but autobin: false\n    // needs to be here where we have determined the values.\n    var autoBinAttr = 'autobin' + mainData;\n    if(trace._input[autoBinAttr] === false) {\n        trace._input[binAttr] = Lib.extendFlat({}, trace[binAttr] || {});\n        delete trace._input[autoBinAttr];\n        delete trace[autoBinAttr];\n    }\n\n    return [traceBinOptsCalc, pos0];\n}\n\n/*\n * Adjust single-value histograms in overlay mode to make as good a\n * guess as we can at autobin values the user would like.\n *\n * Returns the binSpec for the trace that sparked all this\n */\nfunction handleSingleValueOverlays(gd, trace, pa, mainData, binAttr) {\n    var fullLayout = gd._fullLayout;\n    var overlaidTraceGroup = getConnectedHistograms(gd, trace);\n    var pastThisTrace = false;\n    var minSize = Infinity;\n    var singleValuedTraces = [trace];\n    var i, tracei, binOpts;\n\n    // first collect all the:\n    // - min bin size from all multi-valued traces\n    // - single-valued traces\n    for(i = 0; i < overlaidTraceGroup.length; i++) {\n        tracei = overlaidTraceGroup[i];\n\n        if(tracei === trace) {\n            pastThisTrace = true;\n        } else if(!pastThisTrace) {\n            // This trace has already had its autobins calculated, so either:\n            // - it is part of a bingroup\n            // - it is NOT a single-valued trace\n            binOpts = fullLayout._histogramBinOpts[tracei['_' + mainData + 'bingroup']];\n            minSize = Math.min(minSize, binOpts.size || tracei[binAttr].size);\n        } else {\n            var resulti = calcAllAutoBins(gd, tracei, pa, mainData, true);\n            var binSpeci = resulti[0];\n            var isSingleValued = resulti[2];\n\n            // so we can use this result when we get to tracei in the normal\n            // course of events, mark it as done and put _pos0 back\n            tracei['_' + mainData + 'autoBinFinished'] = 1;\n            tracei['_' + mainData + 'pos0'] = resulti[1];\n\n            if(isSingleValued) {\n                singleValuedTraces.push(tracei);\n            } else {\n                minSize = Math.min(minSize, binSpeci.size);\n            }\n        }\n    }\n\n    // find the real data values for each single-valued trace\n    // hunt through pos0 for the first valid value\n    var dataVals = new Array(singleValuedTraces.length);\n    for(i = 0; i < singleValuedTraces.length; i++) {\n        var pos0 = singleValuedTraces[i]['_' + mainData + 'pos0'];\n        for(var j = 0; j < pos0.length; j++) {\n            if(pos0[j] !== undefined) {\n                dataVals[i] = pos0[j];\n                break;\n            }\n        }\n    }\n\n    // are ALL traces are single-valued? use the min difference between\n    // all of their values (which defaults to 1 if there's still only one)\n    if(!isFinite(minSize)) {\n        minSize = Lib.distinctVals(dataVals).minDiff;\n    }\n\n    // now apply the min size we found to all single-valued traces\n    for(i = 0; i < singleValuedTraces.length; i++) {\n        tracei = singleValuedTraces[i];\n        var calendar = tracei[mainData + 'calendar'];\n\n        var newBins = {\n            start: pa.c2r(dataVals[i] - minSize / 2, 0, calendar),\n            end: pa.c2r(dataVals[i] + minSize / 2, 0, calendar),\n            size: minSize\n        };\n\n        tracei._input[binAttr] = tracei[binAttr] = newBins;\n\n        binOpts = fullLayout._histogramBinOpts[tracei['_' + mainData + 'bingroup']];\n        if(binOpts) Lib.extendFlat(binOpts, newBins);\n    }\n\n    return trace[binAttr];\n}\n\n/*\n * Return an array of histograms that share axes and orientation.\n *\n * Only considers histograms. In principle we could include bars in a\n * similar way to how we do manually binned histograms, though this\n * would have tons of edge cases and value judgments to make.\n */\nfunction getConnectedHistograms(gd, trace) {\n    var xid = trace.xaxis;\n    var yid = trace.yaxis;\n    var orientation = trace.orientation;\n\n    var out = [];\n    var fullData = gd._fullData;\n    for(var i = 0; i < fullData.length; i++) {\n        var tracei = fullData[i];\n        if(tracei.type === 'histogram' &&\n            tracei.visible === true &&\n            tracei.orientation === orientation &&\n            tracei.xaxis === xid && tracei.yaxis === yid\n        ) {\n            out.push(tracei);\n        }\n    }\n\n    return out;\n}\n\nfunction cdf(size, direction, currentBin) {\n    var i, vi, prevSum;\n\n    function firstHalfPoint(i) {\n        prevSum = size[i];\n        size[i] /= 2;\n    }\n\n    function nextHalfPoint(i) {\n        vi = size[i];\n        size[i] = prevSum + vi / 2;\n        prevSum += vi;\n    }\n\n    if(currentBin === 'half') {\n        if(direction === 'increasing') {\n            firstHalfPoint(0);\n            for(i = 1; i < size.length; i++) {\n                nextHalfPoint(i);\n            }\n        } else {\n            firstHalfPoint(size.length - 1);\n            for(i = size.length - 2; i >= 0; i--) {\n                nextHalfPoint(i);\n            }\n        }\n    } else if(direction === 'increasing') {\n        for(i = 1; i < size.length; i++) {\n            size[i] += size[i - 1];\n        }\n\n        // 'exclude' is identical to 'include' just shifted one bin over\n        if(currentBin === 'exclude') {\n            size.unshift(0);\n            size.pop();\n        }\n    } else {\n        for(i = size.length - 2; i >= 0; i--) {\n            size[i] += size[i + 1];\n        }\n\n        if(currentBin === 'exclude') {\n            size.push(0);\n            size.shift();\n        }\n    }\n}\n\nmodule.exports = {\n    calc: calc,\n    calcAllAutoBins: calcAllAutoBins\n};\n","'use strict';\n\nmodule.exports = {\n    eventDataKeys: ['binNumber']\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar axisIds = require('../../plots/cartesian/axis_ids');\n\nvar traceIs = require('../../registry').traceIs;\nvar handleGroupingDefaults = require('../bar/defaults').handleGroupingDefaults;\n\nvar nestedProperty = Lib.nestedProperty;\nvar getAxisGroup = require('../../plots/cartesian/constraints').getAxisGroup;\n\nvar BINATTRS = [\n    {aStr: {x: 'xbins.start', y: 'ybins.start'}, name: 'start'},\n    {aStr: {x: 'xbins.end', y: 'ybins.end'}, name: 'end'},\n    {aStr: {x: 'xbins.size', y: 'ybins.size'}, name: 'size'},\n    {aStr: {x: 'nbinsx', y: 'nbinsy'}, name: 'nbins'}\n];\n\nvar BINDIRECTIONS = ['x', 'y'];\n\n// handle bin attrs and relink auto-determined values so fullData is complete\nmodule.exports = function crossTraceDefaults(fullData, fullLayout) {\n    var allBinOpts = fullLayout._histogramBinOpts = {};\n    var histTraces = [];\n    var mustMatchTracesLookup = {};\n    var otherTracesList = [];\n\n    var traceOut, traces, groupName, binDir;\n    var i, j, k;\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(traceOut._input, traceOut, traceOut._module.attributes, attr, dflt);\n    }\n\n    function orientation2binDir(traceOut) {\n        return traceOut.orientation === 'v' ? 'x' : 'y';\n    }\n\n    function getAxisType(traceOut, binDir) {\n        var ax = axisIds.getFromTrace({_fullLayout: fullLayout}, traceOut, binDir);\n        return ax.type;\n    }\n\n    function fillBinOpts(traceOut, groupName, binDir) {\n        // N.B. group traces that don't have a bingroup with themselves\n        var fallbackGroupName = traceOut.uid + '__' + binDir;\n        if(!groupName) groupName = fallbackGroupName;\n\n        var axType = getAxisType(traceOut, binDir);\n        var calendar = traceOut[binDir + 'calendar'] || '';\n        var binOpts = allBinOpts[groupName];\n        var needsNewItem = true;\n\n        if(binOpts) {\n            if(axType === binOpts.axType && calendar === binOpts.calendar) {\n                needsNewItem = false;\n                binOpts.traces.push(traceOut);\n                binOpts.dirs.push(binDir);\n            } else {\n                groupName = fallbackGroupName;\n\n                if(axType !== binOpts.axType) {\n                    Lib.warn([\n                        'Attempted to group the bins of trace', traceOut.index,\n                        'set on a', 'type:' + axType, 'axis',\n                        'with bins on', 'type:' + binOpts.axType, 'axis.'\n                    ].join(' '));\n                }\n                if(calendar !== binOpts.calendar) {\n                    // prohibit bingroup for traces using different calendar,\n                    // there's probably a way to make this work, but skip for now\n                    Lib.warn([\n                        'Attempted to group the bins of trace', traceOut.index,\n                        'set with a', calendar, 'calendar',\n                        'with bins',\n                        (binOpts.calendar ? 'on a ' + binOpts.calendar + ' calendar' : 'w/o a set calendar')\n                    ].join(' '));\n                }\n            }\n        }\n\n        if(needsNewItem) {\n            allBinOpts[groupName] = {\n                traces: [traceOut],\n                dirs: [binDir],\n                axType: axType,\n                calendar: traceOut[binDir + 'calendar'] || ''\n            };\n        }\n        traceOut['_' + binDir + 'bingroup'] = groupName;\n    }\n\n    for(i = 0; i < fullData.length; i++) {\n        traceOut = fullData[i];\n\n        if(traceIs(traceOut, 'histogram')) {\n            histTraces.push(traceOut);\n\n            // TODO: this shouldn't be relinked as it's only used within calc\n            // https://github.com/plotly/plotly.js/issues/749\n            delete traceOut._xautoBinFinished;\n            delete traceOut._yautoBinFinished;\n\n            // N.B. need to coerce *alignmentgroup* before *bingroup*, as traces\n            // in same alignmentgroup \"have to match\"\n            if(!traceIs(traceOut, '2dMap')) {\n                handleGroupingDefaults(traceOut._input, traceOut, fullLayout, coerce);\n            }\n        }\n    }\n\n    var alignmentOpts = fullLayout._alignmentOpts || {};\n\n    // Look for traces that \"have to match\", that is:\n    // - 1d histogram traces on the same subplot with same orientation under barmode:stack,\n    // - 1d histogram traces on the same subplot with same orientation under barmode:group\n    // - 1d histogram traces on the same position axis with the same orientation\n    //   and the same *alignmentgroup* (coerced under barmode:group)\n    // - Once `stackgroup` gets implemented (see https://github.com/plotly/plotly.js/issues/3614),\n    //   traces within the same stackgroup will also \"have to match\"\n    for(i = 0; i < histTraces.length; i++) {\n        traceOut = histTraces[i];\n        groupName = '';\n\n        if(!traceIs(traceOut, '2dMap')) {\n            binDir = orientation2binDir(traceOut);\n\n            if(fullLayout.barmode === 'group' && traceOut.alignmentgroup) {\n                var pa = traceOut[binDir + 'axis'];\n                var aGroupId = getAxisGroup(fullLayout, pa) + traceOut.orientation;\n                if((alignmentOpts[aGroupId] || {})[traceOut.alignmentgroup]) {\n                    groupName = aGroupId;\n                }\n            }\n\n            if(!groupName && fullLayout.barmode !== 'overlay') {\n                groupName = (\n                    getAxisGroup(fullLayout, traceOut.xaxis) +\n                    getAxisGroup(fullLayout, traceOut.yaxis) +\n                    orientation2binDir(traceOut)\n                );\n            }\n        }\n\n        if(groupName) {\n            if(!mustMatchTracesLookup[groupName]) {\n                mustMatchTracesLookup[groupName] = [];\n            }\n            mustMatchTracesLookup[groupName].push(traceOut);\n        } else {\n            otherTracesList.push(traceOut);\n        }\n    }\n\n    // Setup binOpts for traces that have to match,\n    // if the traces have a valid bingroup, use that\n    // if not use axis+binDir groupName\n    for(groupName in mustMatchTracesLookup) {\n        traces = mustMatchTracesLookup[groupName];\n\n        // no need to 'force' anything when a single\n        // trace is detected as \"must match\"\n        if(traces.length === 1) {\n            otherTracesList.push(traces[0]);\n            continue;\n        }\n\n        var binGroupFound = false;\n        if(traces.length) {\n            traceOut = traces[0];\n            binGroupFound = coerce('bingroup');\n        }\n\n        groupName = binGroupFound || groupName;\n\n        for(i = 0; i < traces.length; i++) {\n            traceOut = traces[i];\n            var bingroupIn = traceOut._input.bingroup;\n            if(bingroupIn && bingroupIn !== groupName) {\n                Lib.warn([\n                    'Trace', traceOut.index, 'must match',\n                    'within bingroup', groupName + '.',\n                    'Ignoring its bingroup:', bingroupIn, 'setting.'\n                ].join(' '));\n            }\n            traceOut.bingroup = groupName;\n\n            // N.B. no need to worry about 2dMap case\n            // (where both bin direction are set in each trace)\n            // as 2dMap trace never \"have to match\"\n            fillBinOpts(traceOut, groupName, orientation2binDir(traceOut));\n        }\n    }\n\n    // setup binOpts for traces that can but don't have to match,\n    // notice that these traces can be matched with traces that have to match\n    for(i = 0; i < otherTracesList.length; i++) {\n        traceOut = otherTracesList[i];\n\n        var binGroup = coerce('bingroup');\n\n        if(traceIs(traceOut, '2dMap')) {\n            for(k = 0; k < 2; k++) {\n                binDir = BINDIRECTIONS[k];\n                var binGroupInDir = coerce(binDir + 'bingroup',\n                    binGroup ? binGroup + '__' + binDir : null\n                );\n                fillBinOpts(traceOut, binGroupInDir, binDir);\n            }\n        } else {\n            fillBinOpts(traceOut, binGroup, orientation2binDir(traceOut));\n        }\n    }\n\n    // coerce bin attrs!\n    for(groupName in allBinOpts) {\n        var binOpts = allBinOpts[groupName];\n        traces = binOpts.traces;\n\n        for(j = 0; j < BINATTRS.length; j++) {\n            var attrSpec = BINATTRS[j];\n            var attr = attrSpec.name;\n            var aStr;\n            var autoVals;\n\n            // nbins(x|y) is moot if we have a size. This depends on\n            // nbins coming after size in binAttrs.\n            if(attr === 'nbins' && binOpts.sizeFound) continue;\n\n            for(i = 0; i < traces.length; i++) {\n                traceOut = traces[i];\n                binDir = binOpts.dirs[i];\n                aStr = attrSpec.aStr[binDir];\n\n                if(nestedProperty(traceOut._input, aStr).get() !== undefined) {\n                    binOpts[attr] = coerce(aStr);\n                    binOpts[attr + 'Found'] = true;\n                    break;\n                }\n\n                autoVals = (traceOut._autoBin || {})[binDir] || {};\n                if(autoVals[attr]) {\n                    // if this is the *first* autoval\n                    nestedProperty(traceOut, aStr).set(autoVals[attr]);\n                }\n            }\n\n            // start and end we need to coerce anyway, after having collected the\n            // first of each into binOpts, in case a trace wants to restrict its\n            // data to a certain range\n            if(attr === 'start' || attr === 'end') {\n                for(; i < traces.length; i++) {\n                    traceOut = traces[i];\n                    if(traceOut['_' + binDir + 'bingroup']) {\n                        autoVals = (traceOut._autoBin || {})[binDir] || {};\n                        coerce(aStr, autoVals[attr]);\n                    }\n                }\n            }\n\n            if(attr === 'nbins' && !binOpts.sizeFound && !binOpts.nbinsFound) {\n                traceOut = traces[0];\n                binOpts[attr] = coerce(aStr);\n            }\n        }\n    }\n};\n","'use strict';\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar Color = require('../../components/color');\n\nvar handleStyleDefaults = require('../bar/style_defaults');\nvar attributes = require('./attributes');\n\nmodule.exports = function supplyDefaults(traceIn, traceOut, defaultColor, layout) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(traceIn, traceOut, attributes, attr, dflt);\n    }\n\n    var x = coerce('x');\n    var y = coerce('y');\n\n    var cumulative = coerce('cumulative.enabled');\n    if(cumulative) {\n        coerce('cumulative.direction');\n        coerce('cumulative.currentbin');\n    }\n\n    coerce('text');\n    coerce('hovertext');\n    coerce('hovertemplate');\n    coerce('xhoverformat');\n    coerce('yhoverformat');\n\n    var orientation = coerce('orientation', (y && !x) ? 'h' : 'v');\n    var sampleLetter = orientation === 'v' ? 'x' : 'y';\n    var aggLetter = orientation === 'v' ? 'y' : 'x';\n\n    var len = (x && y) ?\n        Math.min(Lib.minRowLength(x) && Lib.minRowLength(y)) :\n        Lib.minRowLength(traceOut[sampleLetter] || []);\n\n    if(!len) {\n        traceOut.visible = false;\n        return;\n    }\n\n    traceOut._length = len;\n\n    var handleCalendarDefaults = Registry.getComponentMethod('calendars', 'handleTraceDefaults');\n    handleCalendarDefaults(traceIn, traceOut, ['x', 'y'], layout);\n\n    var hasAggregationData = traceOut[aggLetter];\n    if(hasAggregationData) coerce('histfunc');\n    coerce('histnorm');\n\n    // Note: bin defaults are now handled in Histogram.crossTraceDefaults\n    // autobin(x|y) are only included here to appease Plotly.validate\n    coerce('autobin' + sampleLetter);\n\n    handleStyleDefaults(traceIn, traceOut, coerce, defaultColor, layout);\n\n    Lib.coerceSelectionMarkerOpacity(traceOut, coerce);\n\n    var lineColor = (traceOut.marker.line || {}).color;\n\n    // override defaultColor for error bars with defaultLine\n    var errorBarsSupplyDefaults = Registry.getComponentMethod('errorbars', 'supplyDefaults');\n    errorBarsSupplyDefaults(traceIn, traceOut, lineColor || Color.defaultLine, {axis: 'y'});\n    errorBarsSupplyDefaults(traceIn, traceOut, lineColor || Color.defaultLine, {axis: 'x', inherit: 'y'});\n};\n","'use strict';\n\nmodule.exports = function eventData(out, pt, trace, cd, pointNumber) {\n    // standard cartesian event data\n    out.x = 'xVal' in pt ? pt.xVal : pt.x;\n    out.y = 'yVal' in pt ? pt.yVal : pt.y;\n\n    // for 2d histograms\n    if('zLabelVal' in pt) out.z = pt.zLabelVal;\n\n    if(pt.xa) out.xaxis = pt.xa;\n    if(pt.ya) out.yaxis = pt.ya;\n\n    // specific to histogram - CDFs do not have pts (yet?)\n    if(!(trace.cumulative || {}).enabled) {\n        var pts = Array.isArray(pointNumber) ?\n            cd[0].pts[pointNumber[0]][pointNumber[1]] :\n            cd[pointNumber].pts;\n\n        out.pointNumbers = pts;\n        out.binNumber = out.pointNumber;\n        delete out.pointNumber;\n        delete out.pointIndex;\n\n        var pointIndices;\n        if(trace._indexToPoints) {\n            pointIndices = [];\n            for(var i = 0; i < pts.length; i++) {\n                pointIndices = pointIndices.concat(trace._indexToPoints[pts[i]]);\n            }\n        } else {\n            pointIndices = pts;\n        }\n\n        out.pointIndices = pointIndices;\n    }\n\n    return out;\n};\n","'use strict';\n\nvar barHover = require('../bar/hover').hoverPoints;\nvar hoverLabelText = require('../../plots/cartesian/axes').hoverLabelText;\n\nmodule.exports = function hoverPoints(pointData, xval, yval, hovermode, opts) {\n    var pts = barHover(pointData, xval, yval, hovermode, opts);\n\n    if(!pts) return;\n\n    pointData = pts[0];\n    var di = pointData.cd[pointData.index];\n    var trace = pointData.cd[0].trace;\n\n    if(!trace.cumulative.enabled) {\n        var posLetter = trace.orientation === 'h' ? 'y' : 'x';\n\n        pointData[posLetter + 'Label'] = hoverLabelText(pointData[posLetter + 'a'], [di.ph0, di.ph1], trace[posLetter + 'hoverformat']);\n    }\n\n    return pts;\n};\n","'use strict';\n\n/**\n * Histogram has its own attribute, defaults and calc steps,\n * but uses bar's plot to display\n * and bar's crossTraceCalc (formerly known as setPositions) for stacking and grouping\n */\n\n/**\n * histogram errorBarsOK is debatable, but it's put in for backward compat.\n * there are use cases for it - sqrt for a simple histogram works right now,\n * constant and % work but they're not so meaningful. I guess it could be cool\n * to allow quadrature combination of errors in summed histograms...\n */\n\nmodule.exports = {\n    attributes: require('./attributes'),\n    layoutAttributes: require('../bar/layout_attributes'),\n    supplyDefaults: require('./defaults'),\n    crossTraceDefaults: require('./cross_trace_defaults'),\n    supplyLayoutDefaults: require('../bar/layout_defaults'),\n    calc: require('./calc').calc,\n    crossTraceCalc: require('../bar/cross_trace_calc').crossTraceCalc,\n    plot: require('../bar/plot').plot,\n    layerName: 'barlayer',\n    style: require('../bar/style').style,\n    styleOnSelect: require('../bar/style').styleOnSelect,\n    colorbar: require('../scatter/marker_colorbar'),\n    hoverPoints: require('./hover'),\n    selectPoints: require('../bar/select'),\n    eventData: require('./event_data'),\n\n    moduleType: 'trace',\n    name: 'histogram',\n    basePlotModule: require('../../plots/cartesian'),\n    categories: ['bar-like', 'cartesian', 'svg', 'bar', 'histogram', 'oriented', 'errorBarsOK', 'showLegend'],\n    meta: {\n        description: [\n            'The sample data from which statistics are computed is set in `x`',\n            'for vertically spanning histograms and',\n            'in `y` for horizontally spanning histograms.',\n            'Binning options are set `xbins` and `ybins` respectively',\n            'if no aggregation data is provided.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\n\nmodule.exports = {\n    percent: function(size, total) {\n        var nMax = size.length;\n        var norm = 100 / total;\n        for(var n = 0; n < nMax; n++) size[n] *= norm;\n    },\n    probability: function(size, total) {\n        var nMax = size.length;\n        for(var n = 0; n < nMax; n++) size[n] /= total;\n    },\n    density: function(size, total, inc, yinc) {\n        var nMax = size.length;\n        yinc = yinc || 1;\n        for(var n = 0; n < nMax; n++) size[n] *= inc[n] * yinc;\n    },\n    'probability density': function(size, total, inc, yinc) {\n        var nMax = size.length;\n        if(yinc) total /= yinc;\n        for(var n = 0; n < nMax; n++) size[n] *= inc[n] / total;\n    }\n};\n","'use strict';\n\nvar baseAttrs = require('../../plots/attributes');\nvar hovertemplateAttrs = require('../../plots/template_attributes').hovertemplateAttrs;\nvar extendFlat = require('../../lib/extend').extendFlat;\nvar colormodel = require('./constants').colormodel;\n\nvar cm = ['rgb', 'rgba', 'rgba256', 'hsl', 'hsla'];\nvar zminDesc = [];\nvar zmaxDesc = [];\nfor(var i = 0; i < cm.length; i++) {\n    var cr = colormodel[cm[i]];\n    zminDesc.push('For the `' + cm[i] + '` colormodel, it is [' + (cr.zminDflt || cr.min).join(', ') + '].');\n    zmaxDesc.push('For the `' + cm[i] + '` colormodel, it is [' + (cr.zmaxDflt || cr.max).join(', ') + '].');\n}\n\nmodule.exports = extendFlat({\n    source: {\n        valType: 'string',\n        editType: 'calc',\n        description: [\n            'Specifies the data URI of the image to be visualized.',\n            'The URI consists of \"data:image/[<media subtype>][;base64],<data>\"'\n        ].join(' ')\n    },\n    z: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: [\n            'A 2-dimensional array in which each element is an array of 3 or 4 numbers representing a color.',\n        ].join(' ')\n    },\n    colormodel: {\n        valType: 'enumerated',\n        values: cm,\n        editType: 'calc',\n        description: [\n            'Color model used to map the numerical color components described in `z` into colors.',\n            'If `source` is specified, this attribute will be set to `rgba256`',\n            'otherwise it defaults to `rgb`.'\n        ].join(' ')\n    },\n    zsmooth: {\n        valType: 'enumerated',\n        values: ['fast', false],\n        dflt: false,\n        editType: 'plot',\n        description: [\n            'Picks a smoothing algorithm used to smooth `z` data.',\n            'This only applies for image traces that use the `source` attribute.'\n        ].join(' ')\n    },\n    zmin: {\n        valType: 'info_array',\n        items: [\n            {valType: 'number', editType: 'calc'},\n            {valType: 'number', editType: 'calc'},\n            {valType: 'number', editType: 'calc'},\n            {valType: 'number', editType: 'calc'}\n        ],\n        editType: 'calc',\n        description: [\n            'Array defining the lower bound for each color component.',\n            'Note that the default value will depend on the colormodel.',\n            zminDesc.join(' ')\n        ].join(' ')\n    },\n    zmax: {\n        valType: 'info_array',\n        items: [\n            {valType: 'number', editType: 'calc'},\n            {valType: 'number', editType: 'calc'},\n            {valType: 'number', editType: 'calc'},\n            {valType: 'number', editType: 'calc'}\n        ],\n        editType: 'calc',\n        description: [\n            'Array defining the higher bound for each color component.',\n            'Note that the default value will depend on the colormodel.',\n            zmaxDesc.join(' ')\n        ].join(' ')\n    },\n    x0: {\n        valType: 'any',\n        dflt: 0,\n        editType: 'calc+clearAxisTypes',\n        description: 'Set the image\\'s x position.'\n    },\n    y0: {\n        valType: 'any',\n        dflt: 0,\n        editType: 'calc+clearAxisTypes',\n        description: 'Set the image\\'s y position.'\n    },\n    dx: {\n        valType: 'number',\n        dflt: 1,\n        editType: 'calc',\n        description: 'Set the pixel\\'s horizontal size.'\n    },\n    dy: {\n        valType: 'number',\n        dflt: 1,\n        editType: 'calc',\n        description: 'Set the pixel\\'s vertical size'\n    },\n    text: {\n        valType: 'data_array',\n        editType: 'plot',\n        description: 'Sets the text elements associated with each z value.'\n    },\n    hovertext: {\n        valType: 'data_array',\n        editType: 'plot',\n        description: 'Same as `text`.'\n    },\n    hoverinfo: extendFlat({}, baseAttrs.hoverinfo, {\n        flags: ['x', 'y', 'z', 'color', 'name', 'text'],\n        dflt: 'x+y+z+text+name'\n    }),\n    hovertemplate: hovertemplateAttrs({}, {\n        keys: ['z', 'color', 'colormodel']\n    }),\n\n    transforms: undefined\n});\n","'use strict';\n\nvar Lib = require('../../lib');\nvar constants = require('./constants');\nvar isNumeric = require('fast-isnumeric');\nvar Axes = require('../../plots/cartesian/axes');\nvar maxRowLength = require('../../lib').maxRowLength;\nvar getImageSize = require('./helpers').getImageSize;\n\nmodule.exports = function calc(gd, trace) {\n    var h;\n    var w;\n    if(trace._hasZ) {\n        h = trace.z.length;\n        w = maxRowLength(trace.z);\n    } else if(trace._hasSource) {\n        var size = getImageSize(trace.source);\n        h = size.height;\n        w = size.width;\n    }\n\n    var xa = Axes.getFromId(gd, trace.xaxis || 'x');\n    var ya = Axes.getFromId(gd, trace.yaxis || 'y');\n\n    var x0 = xa.d2c(trace.x0) - trace.dx / 2;\n    var y0 = ya.d2c(trace.y0) - trace.dy / 2;\n\n    // Set axis range\n    var i;\n    var xrange = [x0, x0 + w * trace.dx];\n    var yrange = [y0, y0 + h * trace.dy];\n    if(xa && xa.type === 'log') for(i = 0; i < w; i++) xrange.push(x0 + i * trace.dx);\n    if(ya && ya.type === 'log') for(i = 0; i < h; i++) yrange.push(y0 + i * trace.dy);\n    trace._extremes[xa._id] = Axes.findExtremes(xa, xrange);\n    trace._extremes[ya._id] = Axes.findExtremes(ya, yrange);\n    trace._scaler = makeScaler(trace);\n\n    var cd0 = {\n        x0: x0,\n        y0: y0,\n        z: trace.z,\n        w: w,\n        h: h\n    };\n    return [cd0];\n};\n\nfunction scale(zero, ratio, min, max) {\n    return function(c) {\n        return Lib.constrain((c - zero) * ratio, min, max);\n    };\n}\n\nfunction constrain(min, max) {\n    return function(c) { return Lib.constrain(c, min, max);};\n}\n\n// Generate a function to scale color components according to zmin/zmax and the colormodel\nfunction makeScaler(trace) {\n    var cr = constants.colormodel[trace.colormodel];\n    var colormodel = (cr.colormodel || trace.colormodel);\n    var n = colormodel.length;\n\n    trace._sArray = [];\n    // Loop over all color components\n    for(var k = 0; k < n; k++) {\n        if(cr.min[k] !== trace.zmin[k] || cr.max[k] !== trace.zmax[k]) {\n            trace._sArray.push(scale(\n                trace.zmin[k],\n                (cr.max[k] - cr.min[k]) / (trace.zmax[k] - trace.zmin[k]),\n                cr.min[k],\n                cr.max[k]\n            ));\n        } else {\n            trace._sArray.push(constrain(cr.min[k], cr.max[k]));\n        }\n    }\n\n    return function(pixel) {\n        var c = pixel.slice(0, n);\n        for(var k = 0; k < n; k++) {\n            var ck = c[k];\n            if(!isNumeric(ck)) return false;\n            c[k] = trace._sArray[k](ck);\n        }\n        return c;\n    };\n}\n","'use strict';\n\nmodule.exports = {\n    colormodel: {\n        // min and max define the numerical range accepted in CSS\n        // If z(min|max)Dflt are not defined, z(min|max) will default to min/max\n        rgb: {\n            min: [0, 0, 0],\n            max: [255, 255, 255],\n            fmt: function(c) {return c.slice(0, 3);},\n            suffix: ['', '', '']\n        },\n        rgba: {\n            min: [0, 0, 0, 0],\n            max: [255, 255, 255, 1],\n            fmt: function(c) {return c.slice(0, 4);},\n            suffix: ['', '', '', '']\n        },\n        rgba256: {\n            colormodel: 'rgba', // because rgba256 is not an accept colormodel in CSS\n            zminDflt: [0, 0, 0, 0],\n            zmaxDflt: [255, 255, 255, 255],\n            min: [0, 0, 0, 0],\n            max: [255, 255, 255, 1],\n            fmt: function(c) {return c.slice(0, 4);},\n            suffix: ['', '', '', '']\n        },\n        hsl: {\n            min: [0, 0, 0],\n            max: [360, 100, 100],\n            fmt: function(c) {\n                var p = c.slice(0, 3);\n                p[1] = p[1] + '%';\n                p[2] = p[2] + '%';\n                return p;\n            },\n            suffix: ['', '%', '%']\n        },\n        hsla: {\n            min: [0, 0, 0, 0],\n            max: [360, 100, 100, 1],\n            fmt: function(c) {\n                var p = c.slice(0, 4);\n                p[1] = p[1] + '%';\n                p[2] = p[2] + '%';\n                return p;\n            },\n            suffix: ['', '%', '%', '']\n        }\n    },\n    // For pixelated image rendering\n    // http://phrogz.net/tmp/canvas_image_zoom.html\n    // https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering\n    pixelatedStyle: [\n        'image-rendering: optimizeSpeed',\n        'image-rendering: -moz-crisp-edges',\n        'image-rendering: -o-crisp-edges',\n        'image-rendering: -webkit-optimize-contrast',\n        'image-rendering: optimize-contrast',\n        'image-rendering: crisp-edges',\n        'image-rendering: pixelated',\n        ''\n    ].join('; ')\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar attributes = require('./attributes');\nvar constants = require('./constants');\nvar dataUri = require('../../snapshot/helpers').IMAGE_URL_PREFIX;\n\nmodule.exports = function supplyDefaults(traceIn, traceOut) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(traceIn, traceOut, attributes, attr, dflt);\n    }\n    coerce('source');\n    // sanitize source to only allow for data URI representing images\n    if(traceOut.source && !traceOut.source.match(dataUri)) delete traceOut.source;\n    traceOut._hasSource = !!traceOut.source;\n\n    var z = coerce('z');\n    traceOut._hasZ = !(z === undefined || !z.length || !z[0] || !z[0].length);\n    if(!traceOut._hasZ && !traceOut._hasSource) {\n        traceOut.visible = false;\n        return;\n    }\n\n    coerce('x0');\n    coerce('y0');\n    coerce('dx');\n    coerce('dy');\n\n    var cm;\n    if(traceOut._hasZ) {\n        coerce('colormodel', 'rgb');\n        cm = constants.colormodel[traceOut.colormodel];\n        coerce('zmin', (cm.zminDflt || cm.min));\n        coerce('zmax', (cm.zmaxDflt || cm.max));\n    } else if(traceOut._hasSource) {\n        traceOut.colormodel = 'rgba256';\n        cm = constants.colormodel[traceOut.colormodel];\n        traceOut.zmin = cm.zminDflt;\n        traceOut.zmax = cm.zmaxDflt;\n    }\n\n    coerce('zsmooth');\n    coerce('text');\n    coerce('hovertext');\n    coerce('hovertemplate');\n\n    traceOut._length = null;\n};\n","'use strict';\n\nmodule.exports = function eventData(out, pt) {\n    if('xVal' in pt) out.x = pt.xVal;\n    if('yVal' in pt) out.y = pt.yVal;\n    if(pt.xa) out.xaxis = pt.xa;\n    if(pt.ya) out.yaxis = pt.ya;\n    out.color = pt.color;\n    out.colormodel = pt.trace.colormodel;\n    if(!out.z) out.z = pt.color;\n    return out;\n};\n","'use strict';\n\nvar probeSync = require('probe-image-size/sync');\nvar dataUri = require('../../snapshot/helpers').IMAGE_URL_PREFIX;\nvar Buffer = require('buffer/').Buffer;  // note: the trailing slash is important!\n\nexports.getImageSize = function(src) {\n    var data = src.replace(dataUri, '');\n    var buff = new Buffer(data, 'base64');\n    return probeSync(buff);\n};\n","'use strict';\n\nvar Fx = require('../../components/fx');\nvar Lib = require('../../lib');\nvar constants = require('./constants');\n\nmodule.exports = function hoverPoints(pointData, xval, yval) {\n    var cd0 = pointData.cd[0];\n    var trace = cd0.trace;\n    var xa = pointData.xa;\n    var ya = pointData.ya;\n\n    // Return early if not on image\n    if(Fx.inbox(xval - cd0.x0, xval - (cd0.x0 + cd0.w * trace.dx), 0) > 0 ||\n            Fx.inbox(yval - cd0.y0, yval - (cd0.y0 + cd0.h * trace.dy), 0) > 0) {\n        return;\n    }\n\n    // Find nearest pixel's index\n    var nx = Math.floor((xval - cd0.x0) / trace.dx);\n    var ny = Math.floor(Math.abs(yval - cd0.y0) / trace.dy);\n\n    var pixel;\n    if(trace._hasZ) {\n        pixel = cd0.z[ny][nx];\n    } else if(trace._hasSource) {\n        pixel = trace._canvas.el.getContext('2d').getImageData(nx, ny, 1, 1).data;\n    }\n\n    // return early if pixel is undefined\n    if(!pixel) return;\n\n    var hoverinfo = cd0.hi || trace.hoverinfo;\n    var fmtColor;\n    if(hoverinfo) {\n        var parts = hoverinfo.split('+');\n        if(parts.indexOf('all') !== -1) parts = ['color'];\n        if(parts.indexOf('color') !== -1) fmtColor = true;\n    }\n\n    var cr = constants.colormodel[trace.colormodel];\n    var colormodel = cr.colormodel || trace.colormodel;\n    var dims = colormodel.length;\n    var c = trace._scaler(pixel);\n    var s = cr.suffix;\n\n    var colorstring = [];\n    if(trace.hovertemplate || fmtColor) {\n        colorstring.push('[' + [c[0] + s[0], c[1] + s[1], c[2] + s[2]].join(', '));\n        if(dims === 4) colorstring.push(', ' + c[3] + s[3]);\n        colorstring.push(']');\n        colorstring = colorstring.join('');\n        pointData.extraText = colormodel.toUpperCase() + ': ' + colorstring;\n    }\n\n    var text;\n    if(Array.isArray(trace.hovertext) && Array.isArray(trace.hovertext[ny])) {\n        text = trace.hovertext[ny][nx];\n    } else if(Array.isArray(trace.text) && Array.isArray(trace.text[ny])) {\n        text = trace.text[ny][nx];\n    }\n\n    // TODO: for color model with 3 dims, display something useful for hovertemplate `%{color[3]}`\n    var py = ya.c2p(cd0.y0 + (ny + 0.5) * trace.dy);\n    var xVal = cd0.x0 + (nx + 0.5) * trace.dx;\n    var yVal = cd0.y0 + (ny + 0.5) * trace.dy;\n    var zLabel = '[' + pixel.slice(0, trace.colormodel.length).join(', ') + ']';\n    return [Lib.extendFlat(pointData, {\n        index: [ny, nx],\n        x0: xa.c2p(cd0.x0 + nx * trace.dx),\n        x1: xa.c2p(cd0.x0 + (nx + 1) * trace.dx),\n        y0: py,\n        y1: py,\n        color: c,\n        xVal: xVal,\n        xLabelVal: xVal,\n        yVal: yVal,\n        yLabelVal: yVal,\n        zLabelVal: zLabel,\n        text: text,\n        hovertemplateLabels: {\n            'zLabel': zLabel,\n            'colorLabel': colorstring,\n            'color[0]Label': c[0] + s[0],\n            'color[1]Label': c[1] + s[1],\n            'color[2]Label': c[2] + s[2],\n            'color[3]Label': c[3] + s[3]\n        }\n    })];\n};\n","'use strict';\n\nmodule.exports = {\n    attributes: require('./attributes'),\n    supplyDefaults: require('./defaults'),\n    calc: require('./calc'),\n    plot: require('./plot'),\n    style: require('./style'),\n    hoverPoints: require('./hover'),\n    eventData: require('./event_data'),\n\n    moduleType: 'trace',\n    name: 'image',\n    basePlotModule: require('../../plots/cartesian'),\n    categories: ['cartesian', 'svg', '2dMap', 'noSortingByValue'],\n    animatable: false,\n    meta: {\n        description: [\n            'Display an image, i.e. data on a 2D regular raster.',\n            'By default, when an image is displayed in a subplot,',\n            'its y axis will be reversed (ie. `autorange: \\'reversed\\'`),',\n            'constrained to the domain (ie. `constrain: \\'domain\\'`)',\n            'and it will have the same scale as its x axis (ie. `scaleanchor: \\'x\\,`)',\n            'in order for pixels to be rendered as squares.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar xmlnsNamespaces = require('../../constants/xmlns_namespaces');\nvar constants = require('./constants');\n\nvar unsupportedBrowsers = Lib.isIOS() || Lib.isSafari() || Lib.isIE();\n\nmodule.exports = function plot(gd, plotinfo, cdimage, imageLayer) {\n    var xa = plotinfo.xaxis;\n    var ya = plotinfo.yaxis;\n\n    var supportsPixelatedImage = !(unsupportedBrowsers || gd._context._exportedPlot);\n\n    Lib.makeTraceGroups(imageLayer, cdimage, 'im').each(function(cd) {\n        var plotGroup = d3.select(this);\n        var cd0 = cd[0];\n        var trace = cd0.trace;\n        var realImage = (\n            ((trace.zsmooth === 'fast') || (trace.zsmooth === false && supportsPixelatedImage)) &&\n            !trace._hasZ && trace._hasSource && xa.type === 'linear' && ya.type === 'linear'\n        );\n        trace._realImage = realImage;\n\n        var z = cd0.z;\n        var x0 = cd0.x0;\n        var y0 = cd0.y0;\n        var w = cd0.w;\n        var h = cd0.h;\n        var dx = trace.dx;\n        var dy = trace.dy;\n\n        var left, right, temp, top, bottom, i;\n        // in case of log of a negative\n        i = 0;\n        while(left === undefined && i < w) {\n            left = xa.c2p(x0 + i * dx);\n            i++;\n        }\n        i = w;\n        while(right === undefined && i > 0) {\n            right = xa.c2p(x0 + i * dx);\n            i--;\n        }\n        i = 0;\n        while(top === undefined && i < h) {\n            top = ya.c2p(y0 + i * dy);\n            i++;\n        }\n        i = h;\n        while(bottom === undefined && i > 0) {\n            bottom = ya.c2p(y0 + i * dy);\n            i--;\n        }\n\n        if(right < left) {\n            temp = right;\n            right = left;\n            left = temp;\n        }\n\n        if(bottom < top) {\n            temp = top;\n            top = bottom;\n            bottom = temp;\n        }\n\n        // Reduce image size when zoomed in to save memory\n        if(!realImage) {\n            var extra = 0.5; // half the axis size\n            left = Math.max(-extra * xa._length, left);\n            right = Math.min((1 + extra) * xa._length, right);\n            top = Math.max(-extra * ya._length, top);\n            bottom = Math.min((1 + extra) * ya._length, bottom);\n        }\n\n        var imageWidth = Math.round(right - left);\n        var imageHeight = Math.round(bottom - top);\n\n        // if image is entirely off-screen, don't even draw it\n        var isOffScreen = (imageWidth <= 0 || imageHeight <= 0);\n        if(isOffScreen) {\n            var noImage = plotGroup.selectAll('image').data([]);\n            noImage.exit().remove();\n            return;\n        }\n\n        // Create a new canvas and draw magnified pixels on it\n        function drawMagnifiedPixelsOnCanvas(readPixel) {\n            var canvas = document.createElement('canvas');\n            canvas.width = imageWidth;\n            canvas.height = imageHeight;\n            var context = canvas.getContext('2d');\n\n            var ipx = function(i) {return Lib.constrain(Math.round(xa.c2p(x0 + i * dx) - left), 0, imageWidth);};\n            var jpx = function(j) {return Lib.constrain(Math.round(ya.c2p(y0 + j * dy) - top), 0, imageHeight);};\n\n            var cr = constants.colormodel[trace.colormodel];\n            var colormodel = (cr.colormodel || trace.colormodel);\n            var fmt = cr.fmt;\n            var c;\n            for(i = 0; i < cd0.w; i++) {\n                var ipx0 = ipx(i); var ipx1 = ipx(i + 1);\n                if(ipx1 === ipx0 || isNaN(ipx1) || isNaN(ipx0)) continue;\n                for(var j = 0; j < cd0.h; j++) {\n                    var jpx0 = jpx(j); var jpx1 = jpx(j + 1);\n                    if(jpx1 === jpx0 || isNaN(jpx1) || isNaN(jpx0) || !readPixel(i, j)) continue;\n                    c = trace._scaler(readPixel(i, j));\n                    if(c) {\n                        context.fillStyle = colormodel + '(' + fmt(c).join(',') + ')';\n                    } else {\n                        // Return a transparent pixel\n                        context.fillStyle = 'rgba(0,0,0,0)';\n                    }\n                    context.fillRect(ipx0, jpx0, ipx1 - ipx0, jpx1 - jpx0);\n                }\n            }\n\n            return canvas;\n        }\n\n        var image3 = plotGroup.selectAll('image')\n            .data([cd]);\n\n        image3.enter().append('svg:image').attr({\n            xmlns: xmlnsNamespaces.svg,\n            preserveAspectRatio: 'none'\n        });\n\n        image3.exit().remove();\n\n        var style = (trace.zsmooth === false) ? constants.pixelatedStyle : '';\n\n        if(realImage) {\n            var xRange = Lib.simpleMap(xa.range, xa.r2l);\n            var yRange = Lib.simpleMap(ya.range, ya.r2l);\n\n            var flipX = xRange[1] < xRange[0];\n            var flipY = yRange[1] > yRange[0];\n            if(flipX || flipY) {\n                var tx = left + imageWidth / 2;\n                var ty = top + imageHeight / 2;\n                style += 'transform:' +\n                    strTranslate(tx + 'px', ty + 'px') +\n                    'scale(' + (flipX ? -1 : 1) + ',' + (flipY ? -1 : 1) + ')' +\n                    strTranslate(-tx + 'px', -ty + 'px') + ';';\n            }\n        }\n        image3.attr('style', style);\n\n        var p = new Promise(function(resolve) {\n            if(trace._hasZ) {\n                resolve();\n            } else if(trace._hasSource) {\n                // Check if canvas already exists and has the right data\n                if(\n                    trace._canvas &&\n                    trace._canvas.el.width === w &&\n                    trace._canvas.el.height === h &&\n                    trace._canvas.source === trace.source\n                ) {\n                    resolve();\n                } else {\n                    // Create a canvas and transfer image onto it to access pixel information\n                    var canvas = document.createElement('canvas');\n                    canvas.width = w;\n                    canvas.height = h;\n                    var context = canvas.getContext('2d');\n\n                    trace._image = trace._image || new Image();\n                    var image = trace._image;\n                    image.onload = function() {\n                        context.drawImage(image, 0, 0);\n                        trace._canvas = {\n                            el: canvas,\n                            source: trace.source\n                        };\n                        resolve();\n                    };\n                    image.setAttribute('src', trace.source);\n                }\n            }\n        })\n        .then(function() {\n            var href, canvas;\n            if(trace._hasZ) {\n                canvas = drawMagnifiedPixelsOnCanvas(function(i, j) {return z[j][i];});\n                href = canvas.toDataURL('image/png');\n            } else if(trace._hasSource) {\n                if(realImage) {\n                    href = trace.source;\n                } else {\n                    var context = trace._canvas.el.getContext('2d');\n                    var data = context.getImageData(0, 0, w, h).data;\n                    canvas = drawMagnifiedPixelsOnCanvas(function(i, j) {\n                        var index = 4 * (j * w + i);\n                        return [\n                            data[index],\n                            data[index + 1],\n                            data[index + 2],\n                            data[index + 3]\n                        ];\n                    });\n                    href = canvas.toDataURL('image/png');\n                }\n            }\n\n            image3.attr({\n                'xlink:href': href,\n                height: imageHeight,\n                width: imageWidth,\n                x: left,\n                y: top\n            });\n        });\n\n        gd._promises.push(p);\n    });\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nmodule.exports = function style(gd) {\n    d3.select(gd).selectAll('.im image')\n        .style('opacity', function(d) {\n            return d[0].trace.opacity;\n        });\n};\n","'use strict';\n\nvar baseAttrs = require('../../plots/attributes');\nvar domainAttrs = require('../../plots/domain').attributes;\nvar fontAttrs = require('../../plots/font_attributes');\nvar colorAttrs = require('../../components/color/attributes');\nvar hovertemplateAttrs = require('../../plots/template_attributes').hovertemplateAttrs;\nvar texttemplateAttrs = require('../../plots/template_attributes').texttemplateAttrs;\n\nvar extendFlat = require('../../lib/extend').extendFlat;\n\nvar textFontAttrs = fontAttrs({\n    editType: 'plot',\n    arrayOk: true,\n    colorEditType: 'plot',\n    description: 'Sets the font used for `textinfo`.'\n});\n\nmodule.exports = {\n    labels: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: [\n            'Sets the sector labels.',\n            'If `labels` entries are duplicated, we sum associated `values`',\n            'or simply count occurrences if `values` is not provided.',\n            'For other array attributes (including color) we use the first',\n            'non-empty entry among all occurrences of the label.'\n        ].join(' ')\n    },\n    // equivalent of x0 and dx, if label is missing\n    label0: {\n        valType: 'number',\n        dflt: 0,\n        editType: 'calc',\n        description: [\n            'Alternate to `labels`.',\n            'Builds a numeric set of labels.',\n            'Use with `dlabel`',\n            'where `label0` is the starting label and `dlabel` the step.'\n        ].join(' ')\n    },\n    dlabel: {\n        valType: 'number',\n        dflt: 1,\n        editType: 'calc',\n        description: 'Sets the label step. See `label0` for more info.'\n    },\n\n    values: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: [\n            'Sets the values of the sectors.',\n            'If omitted, we count occurrences of each label.'\n        ].join(' ')\n    },\n\n    marker: {\n        colors: {\n            valType: 'data_array',  // TODO 'color_array' ?\n            editType: 'calc',\n            description: [\n                'Sets the color of each sector.',\n                'If not specified, the default trace color set is used',\n                'to pick the sector colors.'\n            ].join(' ')\n        },\n\n        line: {\n            color: {\n                valType: 'color',\n                dflt: colorAttrs.defaultLine,\n                arrayOk: true,\n                editType: 'style',\n                description: [\n                    'Sets the color of the line enclosing each sector.'\n                ].join(' ')\n            },\n            width: {\n                valType: 'number',\n                min: 0,\n                dflt: 0,\n                arrayOk: true,\n                editType: 'style',\n                description: [\n                    'Sets the width (in px) of the line enclosing each sector.'\n                ].join(' ')\n            },\n            editType: 'calc'\n        },\n        editType: 'calc'\n    },\n\n    text: {\n        valType: 'data_array',\n        editType: 'plot',\n        description: [\n            'Sets text elements associated with each sector.',\n            'If trace `textinfo` contains a *text* flag, these elements will be seen',\n            'on the chart.',\n            'If trace `hoverinfo` contains a *text* flag and *hovertext* is not set,',\n            'these elements will be seen in the hover labels.'\n        ].join(' ')\n    },\n    hovertext: {\n        valType: 'string',\n        dflt: '',\n        arrayOk: true,\n        editType: 'style',\n        description: [\n            'Sets hover text elements associated with each sector.',\n            'If a single string, the same string appears for',\n            'all data points.',\n            'If an array of string, the items are mapped in order of',\n            'this trace\\'s sectors.',\n            'To be seen, trace `hoverinfo` must contain a *text* flag.'\n        ].join(' ')\n    },\n\n// 'see eg:'\n// 'https://www.e-education.psu.edu/natureofgeoinfo/sites/www.e-education.psu.edu.natureofgeoinfo/files/image/hisp_pies.gif',\n// '(this example involves a map too - may someday be a whole trace type',\n// 'of its own. but the point is the size of the whole pie is important.)'\n    scalegroup: {\n        valType: 'string',\n        dflt: '',\n        editType: 'calc',\n        description: [\n            'If there are multiple pie charts that should be sized according to',\n            'their totals, link them by providing a non-empty group id here',\n            'shared by every trace in the same group.'\n        ].join(' ')\n    },\n\n    // labels (legend is handled by plots.attributes.showlegend and layout.hiddenlabels)\n    textinfo: {\n        valType: 'flaglist',\n        flags: ['label', 'text', 'value', 'percent'],\n        extras: ['none'],\n        editType: 'calc',\n        description: [\n            'Determines which trace information appear on the graph.'\n        ].join(' ')\n    },\n    hoverinfo: extendFlat({}, baseAttrs.hoverinfo, {\n        flags: ['label', 'text', 'value', 'percent', 'name']\n    }),\n    hovertemplate: hovertemplateAttrs({}, {\n        keys: ['label', 'color', 'value', 'percent', 'text']\n    }),\n    texttemplate: texttemplateAttrs({editType: 'plot'}, {\n        keys: ['label', 'color', 'value', 'percent', 'text']\n    }),\n    textposition: {\n        valType: 'enumerated',\n        values: ['inside', 'outside', 'auto', 'none'],\n        dflt: 'auto',\n        arrayOk: true,\n        editType: 'plot',\n        description: [\n            'Specifies the location of the `textinfo`.'\n        ].join(' ')\n    },\n    textfont: extendFlat({}, textFontAttrs, {\n        description: 'Sets the font used for `textinfo`.'\n    }),\n    insidetextorientation: {\n        valType: 'enumerated',\n        values: ['horizontal', 'radial', 'tangential', 'auto'],\n        dflt: 'auto',\n        editType: 'plot',\n        description: [\n            'Controls the orientation of the text inside chart sectors.',\n            'When set to *auto*, text may be oriented in any direction in order',\n            'to be as big as possible in the middle of a sector.',\n            'The *horizontal* option orients text to be parallel with the bottom',\n            'of the chart, and may make text smaller in order to achieve that goal.',\n            'The *radial* option orients text along the radius of the sector.',\n            'The *tangential* option orients text perpendicular to the radius of the sector.'\n        ].join(' ')\n    },\n    insidetextfont: extendFlat({}, textFontAttrs, {\n        description: 'Sets the font used for `textinfo` lying inside the sector.'\n    }),\n    outsidetextfont: extendFlat({}, textFontAttrs, {\n        description: 'Sets the font used for `textinfo` lying outside the sector.'\n    }),\n    automargin: {\n        valType: 'boolean',\n        dflt: false,\n        editType: 'plot',\n        description: [\n            'Determines whether outside text labels can push the margins.'\n        ].join(' ')\n    },\n\n    title: {\n        text: {\n            valType: 'string',\n            dflt: '',\n            editType: 'plot',\n            description: [\n                'Sets the title of the chart.',\n                'If it is empty, no title is displayed.',\n                'Note that before the existence of `title.text`, the title\\'s',\n                'contents used to be defined as the `title` attribute itself.',\n                'This behavior has been deprecated.'\n            ].join(' ')\n        },\n        font: extendFlat({}, textFontAttrs, {\n            description: [\n                'Sets the font used for `title`.',\n                'Note that the title\\'s font used to be set',\n                'by the now deprecated `titlefont` attribute.'\n            ].join(' ')\n        }),\n        position: {\n            valType: 'enumerated',\n            values: [\n                'top left', 'top center', 'top right',\n                'middle center',\n                'bottom left', 'bottom center', 'bottom right'\n            ],\n            editType: 'plot',\n            description: [\n                'Specifies the location of the `title`.',\n                'Note that the title\\'s position used to be set',\n                'by the now deprecated `titleposition` attribute.'\n            ].join(' ')\n        },\n\n        editType: 'plot'\n    },\n\n    // position and shape\n    domain: domainAttrs({name: 'pie', trace: true, editType: 'calc'}),\n\n    hole: {\n        valType: 'number',\n        min: 0,\n        max: 1,\n        dflt: 0,\n        editType: 'calc',\n        description: [\n            'Sets the fraction of the radius to cut out of the pie.',\n            'Use this to make a donut chart.'\n        ].join(' ')\n    },\n\n    // ordering and direction\n    sort: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'calc',\n        description: [\n            'Determines whether or not the sectors are reordered',\n            'from largest to smallest.'\n        ].join(' ')\n    },\n    direction: {\n        /**\n         * there are two common conventions, both of which place the first\n         * (largest, if sorted) slice with its left edge at 12 o'clock but\n         * succeeding slices follow either cw or ccw from there.\n         *\n         * see http://visage.co/data-visualization-101-pie-charts/\n         */\n        valType: 'enumerated',\n        values: ['clockwise', 'counterclockwise'],\n        dflt: 'counterclockwise',\n        editType: 'calc',\n        description: [\n            'Specifies the direction at which succeeding sectors follow',\n            'one another.'\n        ].join(' ')\n    },\n    rotation: {\n        valType: 'number',\n        min: -360,\n        max: 360,\n        dflt: 0,\n        editType: 'calc',\n        description: [\n            'Instead of the first slice starting at 12 o\\'clock,',\n            'rotate to some other angle.'\n        ].join(' ')\n    },\n\n    pull: {\n        valType: 'number',\n        min: 0,\n        max: 1,\n        dflt: 0,\n        arrayOk: true,\n        editType: 'calc',\n        description: [\n            'Sets the fraction of larger radius to pull the sectors',\n            'out from the center. This can be a constant',\n            'to pull all slices apart from each other equally',\n            'or an array to highlight one or more slices.'\n        ].join(' ')\n    },\n\n    _deprecated: {\n        title: {\n            valType: 'string',\n            dflt: '',\n            editType: 'calc',\n            description: [\n                'Deprecated in favor of `title.text`.',\n                'Note that value of `title` is no longer a simple',\n                '*string* but a set of sub-attributes.'\n            ].join(' ')\n        },\n        titlefont: extendFlat({}, textFontAttrs, {\n            description: 'Deprecated in favor of `title.font`.'\n        }),\n        titleposition: {\n            valType: 'enumerated',\n            values: [\n                'top left', 'top center', 'top right',\n                'middle center',\n                'bottom left', 'bottom center', 'bottom right'\n            ],\n            editType: 'calc',\n            description: 'Deprecated in favor of `title.position`.'\n        }\n    }\n};\n","'use strict';\n\nvar plots = require('../../plots/plots');\n\nexports.name = 'pie';\n\nexports.plot = function(gd, traces, transitionOpts, makeOnCompleteCallback) {\n    plots.plotBasePlot(exports.name, gd, traces, transitionOpts, makeOnCompleteCallback);\n};\n\nexports.clean = function(newFullData, newFullLayout, oldFullData, oldFullLayout) {\n    plots.cleanBasePlot(exports.name, newFullData, newFullLayout, oldFullData, oldFullLayout);\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar tinycolor = require('tinycolor2');\n\nvar Color = require('../../components/color');\n\nvar extendedColorWayList = {};\n\nfunction calc(gd, trace) {\n    var cd = [];\n\n    var fullLayout = gd._fullLayout;\n    var hiddenLabels = fullLayout.hiddenlabels || [];\n\n    var labels = trace.labels;\n    var colors = trace.marker.colors || [];\n    var vals = trace.values;\n    var len = trace._length;\n    var hasValues = trace._hasValues && len;\n\n    var i, pt;\n\n    if(trace.dlabel) {\n        labels = new Array(len);\n        for(i = 0; i < len; i++) {\n            labels[i] = String(trace.label0 + i * trace.dlabel);\n        }\n    }\n\n    var allThisTraceLabels = {};\n    var pullColor = makePullColorFn(fullLayout['_' + trace.type + 'colormap']);\n    var vTotal = 0;\n    var isAggregated = false;\n\n    for(i = 0; i < len; i++) {\n        var v, label, hidden;\n        if(hasValues) {\n            v = vals[i];\n            if(!isNumeric(v)) continue;\n            v = +v;\n            if(v < 0) continue;\n        } else v = 1;\n\n        label = labels[i];\n        if(label === undefined || label === '') label = i;\n        label = String(label);\n\n        var thisLabelIndex = allThisTraceLabels[label];\n        if(thisLabelIndex === undefined) {\n            allThisTraceLabels[label] = cd.length;\n\n            hidden = hiddenLabels.indexOf(label) !== -1;\n\n            if(!hidden) vTotal += v;\n\n            cd.push({\n                v: v,\n                label: label,\n                color: pullColor(colors[i], label),\n                i: i,\n                pts: [i],\n                hidden: hidden\n            });\n        } else {\n            isAggregated = true;\n\n            pt = cd[thisLabelIndex];\n            pt.v += v;\n            pt.pts.push(i);\n            if(!pt.hidden) vTotal += v;\n\n            if(pt.color === false && colors[i]) {\n                pt.color = pullColor(colors[i], label);\n            }\n        }\n    }\n\n    var shouldSort = (trace.type === 'funnelarea') ? isAggregated : trace.sort;\n    if(shouldSort) cd.sort(function(a, b) { return b.v - a.v; });\n\n    // include the sum of all values in the first point\n    if(cd[0]) cd[0].vTotal = vTotal;\n\n    return cd;\n}\n\nfunction makePullColorFn(colorMap) {\n    return function pullColor(color, id) {\n        if(!color) return false;\n\n        color = tinycolor(color);\n        if(!color.isValid()) return false;\n\n        color = Color.addOpacity(color, color.getAlpha());\n        if(!colorMap[id]) colorMap[id] = color;\n\n        return color;\n    };\n}\n\n/*\n * `calc` filled in (and collated) explicit colors.\n * Now we need to propagate these explicit colors to other traces,\n * and fill in default colors.\n * This is done after sorting, so we pick defaults\n * in the order slices will be displayed\n */\nfunction crossTraceCalc(gd, plotinfo) { // TODO: should we name the second argument opts?\n    var desiredType = (plotinfo || {}).type;\n    if(!desiredType) desiredType = 'pie';\n\n    var fullLayout = gd._fullLayout;\n    var calcdata = gd.calcdata;\n    var colorWay = fullLayout[desiredType + 'colorway'];\n    var colorMap = fullLayout['_' + desiredType + 'colormap'];\n\n    if(fullLayout['extend' + desiredType + 'colors']) {\n        colorWay = generateExtendedColors(colorWay, extendedColorWayList);\n    }\n    var dfltColorCount = 0;\n\n    for(var i = 0; i < calcdata.length; i++) {\n        var cd = calcdata[i];\n        var traceType = cd[0].trace.type;\n        if(traceType !== desiredType) continue;\n\n        for(var j = 0; j < cd.length; j++) {\n            var pt = cd[j];\n            if(pt.color === false) {\n                // have we seen this label and assigned a color to it in a previous trace?\n                if(colorMap[pt.label]) {\n                    pt.color = colorMap[pt.label];\n                } else {\n                    colorMap[pt.label] = pt.color = colorWay[dfltColorCount % colorWay.length];\n                    dfltColorCount++;\n                }\n            }\n        }\n    }\n}\n\n/**\n * pick a default color from the main default set, augmented by\n * itself lighter then darker before repeating\n */\nfunction generateExtendedColors(colorList, extendedColorWays) {\n    var i;\n    var colorString = JSON.stringify(colorList);\n    var colors = extendedColorWays[colorString];\n    if(!colors) {\n        colors = colorList.slice();\n\n        for(i = 0; i < colorList.length; i++) {\n            colors.push(tinycolor(colorList[i]).lighten(20).toHexString());\n        }\n\n        for(i = 0; i < colorList.length; i++) {\n            colors.push(tinycolor(colorList[i]).darken(20).toHexString());\n        }\n        extendedColorWays[colorString] = colors;\n    }\n\n    return colors;\n}\n\nmodule.exports = {\n    calc: calc,\n    crossTraceCalc: crossTraceCalc,\n\n    makePullColorFn: makePullColorFn,\n    generateExtendedColors: generateExtendedColors\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar Lib = require('../../lib');\nvar attributes = require('./attributes');\nvar handleDomainDefaults = require('../../plots/domain').defaults;\nvar handleText = require('../bar/defaults').handleText;\n\nfunction handleLabelsAndValues(labels, values) {\n    var hasLabels = Array.isArray(labels);\n    var hasValues = Lib.isArrayOrTypedArray(values);\n    var len = Math.min(\n        hasLabels ? labels.length : Infinity,\n        hasValues ? values.length : Infinity\n    );\n\n    if(!isFinite(len)) len = 0;\n\n    if(len && hasValues) {\n        var hasPositive;\n        for(var i = 0; i < len; i++) {\n            var v = values[i];\n            if(isNumeric(v) && v > 0) {\n                hasPositive = true;\n                break;\n            }\n        }\n        if(!hasPositive) len = 0;\n    }\n\n    return {\n        hasLabels: hasLabels,\n        hasValues: hasValues,\n        len: len\n    };\n}\n\nfunction supplyDefaults(traceIn, traceOut, defaultColor, layout) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(traceIn, traceOut, attributes, attr, dflt);\n    }\n\n    var labels = coerce('labels');\n    var values = coerce('values');\n\n    var res = handleLabelsAndValues(labels, values);\n    var len = res.len;\n    traceOut._hasLabels = res.hasLabels;\n    traceOut._hasValues = res.hasValues;\n\n    if(!traceOut._hasLabels &&\n        traceOut._hasValues\n    ) {\n        coerce('label0');\n        coerce('dlabel');\n    }\n\n    if(!len) {\n        traceOut.visible = false;\n        return;\n    }\n    traceOut._length = len;\n\n    var lineWidth = coerce('marker.line.width');\n    if(lineWidth) coerce('marker.line.color');\n\n    coerce('marker.colors');\n\n    coerce('scalegroup');\n    // TODO: hole needs to be coerced to the same value within a scaleegroup\n\n    var textData = coerce('text');\n    var textTemplate = coerce('texttemplate');\n    var textInfo;\n    if(!textTemplate) textInfo = coerce('textinfo', Array.isArray(textData) ? 'text+percent' : 'percent');\n\n    coerce('hovertext');\n    coerce('hovertemplate');\n\n    if(textTemplate || (textInfo && textInfo !== 'none')) {\n        var textposition = coerce('textposition');\n        handleText(traceIn, traceOut, layout, coerce, textposition, {\n            moduleHasSelected: false,\n            moduleHasUnselected: false,\n            moduleHasConstrain: false,\n            moduleHasCliponaxis: false,\n            moduleHasTextangle: false,\n            moduleHasInsideanchor: false\n        });\n\n        var hasBoth = Array.isArray(textposition) || textposition === 'auto';\n        var hasOutside = hasBoth || textposition === 'outside';\n        if(hasOutside) {\n            coerce('automargin');\n        }\n\n        if(textposition === 'inside' || textposition === 'auto' || Array.isArray(textposition)) {\n            coerce('insidetextorientation');\n        }\n    }\n\n    handleDomainDefaults(traceOut, layout, coerce);\n\n    var hole = coerce('hole');\n    var title = coerce('title.text');\n    if(title) {\n        var titlePosition = coerce('title.position', hole ? 'middle center' : 'top center');\n        if(!hole && titlePosition === 'middle center') traceOut.title.position = 'top center';\n        Lib.coerceFont(coerce, 'title.font', layout.font);\n    }\n\n    coerce('sort');\n    coerce('direction');\n    coerce('rotation');\n    coerce('pull');\n}\n\nmodule.exports = {\n    handleLabelsAndValues: handleLabelsAndValues,\n    supplyDefaults: supplyDefaults\n};\n","'use strict';\n\nvar appendArrayMultiPointValues = require('../../components/fx/helpers').appendArrayMultiPointValues;\n\n// Note: like other eventData routines, this creates the data for hover/unhover/click events\n// but it has a different API and goes through a totally different pathway.\n// So to ensure it doesn't get misused, it's not attached to the Pie module.\nmodule.exports = function eventData(pt, trace) {\n    var out = {\n        curveNumber: trace.index,\n        pointNumbers: pt.pts,\n        data: trace._input,\n        fullData: trace,\n        label: pt.label,\n        color: pt.color,\n        value: pt.v,\n        percent: pt.percent,\n        text: pt.text,\n\n        // pt.v (and pt.i below) for backward compatibility\n        v: pt.v\n    };\n\n    // Only include pointNumber if it's unambiguous\n    if(pt.pts.length === 1) out.pointNumber = out.i = pt.pts[0];\n\n    // Add extra data arrays to the output\n    // notice that this is the multi-point version ('s' on the end!)\n    // so added data will be arrays matching the pointNumbers array.\n    appendArrayMultiPointValues(out, trace, pt.pts);\n\n    // don't include obsolete fields in new funnelarea traces\n    if(trace.type === 'funnelarea') {\n        delete out.v;\n        delete out.i;\n    }\n\n    return out;\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\nfunction format(vRounded) {\n    return (\n        vRounded.indexOf('e') !== -1 ? vRounded.replace(/[.]?0+e/, 'e') :\n        vRounded.indexOf('.') !== -1 ? vRounded.replace(/[.]?0+$/, '') :\n        vRounded\n    );\n}\n\nexports.formatPiePercent = function formatPiePercent(v, separators) {\n    var vRounded = format((v * 100).toPrecision(3));\n    return Lib.numSeparate(vRounded, separators) + '%';\n};\n\nexports.formatPieValue = function formatPieValue(v, separators) {\n    var vRounded = format(v.toPrecision(10));\n    return Lib.numSeparate(vRounded, separators);\n};\n\nexports.getFirstFilled = function getFirstFilled(array, indices) {\n    if(!Array.isArray(array)) return;\n    for(var i = 0; i < indices.length; i++) {\n        var v = array[indices[i]];\n        if(v || v === 0 || v === '') return v;\n    }\n};\n\nexports.castOption = function castOption(item, indices) {\n    if(Array.isArray(item)) return exports.getFirstFilled(item, indices);\n    else if(item) return item;\n};\n\nexports.getRotationAngle = function(rotation) {\n    return (rotation === 'auto' ? 0 : rotation) * Math.PI / 180;\n};\n","'use strict';\n\nmodule.exports = {\n    attributes: require('./attributes'),\n    supplyDefaults: require('./defaults').supplyDefaults,\n    supplyLayoutDefaults: require('./layout_defaults'),\n    layoutAttributes: require('./layout_attributes'),\n\n    calc: require('./calc').calc,\n    crossTraceCalc: require('./calc').crossTraceCalc,\n\n    plot: require('./plot').plot,\n    style: require('./style'),\n    styleOne: require('./style_one'),\n\n    moduleType: 'trace',\n    name: 'pie',\n    basePlotModule: require('./base_plot'),\n    categories: ['pie-like', 'pie', 'showLegend'],\n    meta: {\n        description: [\n            'A data visualized by the sectors of the pie is set in `values`.',\n            'The sector labels are set in `labels`.',\n            'The sector colors are set in `marker.colors`'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nmodule.exports = {\n    hiddenlabels: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: [\n            'hiddenlabels is the funnelarea & pie chart analog of',\n            'visible:\\'legendonly\\'',\n            'but it can contain many labels, and can simultaneously',\n            'hide slices from several pies/funnelarea charts'\n        ].join(' ')\n    },\n    piecolorway: {\n        valType: 'colorlist',\n        editType: 'calc',\n        description: [\n            'Sets the default pie slice colors. Defaults to the main',\n            '`colorway` used for trace colors. If you specify a new',\n            'list here it can still be extended with lighter and darker',\n            'colors, see `extendpiecolors`.'\n        ].join(' ')\n    },\n    extendpiecolors: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'calc',\n        description: [\n            'If `true`, the pie slice colors (whether given by `piecolorway` or',\n            'inherited from `colorway`) will be extended to three times its',\n            'original length by first repeating every color 20% lighter then',\n            'each color 20% darker. This is intended to reduce the likelihood',\n            'of reusing the same color when you have many slices, but you can',\n            'set `false` to disable.',\n            'Colors provided in the trace, using `marker.colors`, are never',\n            'extended.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\nvar layoutAttributes = require('./layout_attributes');\n\nmodule.exports = function supplyLayoutDefaults(layoutIn, layoutOut) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(layoutIn, layoutOut, layoutAttributes, attr, dflt);\n    }\n\n    coerce('hiddenlabels');\n    coerce('piecolorway', layoutOut.colorway);\n    coerce('extendpiecolors');\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Plots = require('../../plots/plots');\nvar Fx = require('../../components/fx');\nvar Color = require('../../components/color');\nvar Drawing = require('../../components/drawing');\nvar Lib = require('../../lib');\nvar strScale = Lib.strScale;\nvar strTranslate = Lib.strTranslate;\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar uniformText = require('../bar/uniform_text');\nvar recordMinTextSize = uniformText.recordMinTextSize;\nvar clearMinTextSize = uniformText.clearMinTextSize;\nvar TEXTPAD = require('../bar/constants').TEXTPAD;\n\nvar helpers = require('./helpers');\nvar eventData = require('./event_data');\nvar isValidTextValue = require('../../lib').isValidTextValue;\n\nfunction plot(gd, cdModule) {\n    var fullLayout = gd._fullLayout;\n    var gs = fullLayout._size;\n\n    clearMinTextSize('pie', fullLayout);\n\n    prerenderTitles(cdModule, gd);\n    layoutAreas(cdModule, gs);\n\n    var plotGroups = Lib.makeTraceGroups(fullLayout._pielayer, cdModule, 'trace').each(function(cd) {\n        var plotGroup = d3.select(this);\n        var cd0 = cd[0];\n        var trace = cd0.trace;\n\n        setCoords(cd);\n\n        // TODO: miter might look better but can sometimes cause problems\n        // maybe miter with a small-ish stroke-miterlimit?\n        plotGroup.attr('stroke-linejoin', 'round');\n\n        plotGroup.each(function() {\n            var slices = d3.select(this).selectAll('g.slice').data(cd);\n\n            slices.enter().append('g')\n                .classed('slice', true);\n            slices.exit().remove();\n\n            var quadrants = [\n                [[], []], // y<0: x<0, x>=0\n                [[], []] // y>=0: x<0, x>=0\n            ];\n            var hasOutsideText = false;\n\n            slices.each(function(pt, i) {\n                if(pt.hidden) {\n                    d3.select(this).selectAll('path,g').remove();\n                    return;\n                }\n\n                // to have consistent event data compared to other traces\n                pt.pointNumber = pt.i;\n                pt.curveNumber = trace.index;\n\n                quadrants[pt.pxmid[1] < 0 ? 0 : 1][pt.pxmid[0] < 0 ? 0 : 1].push(pt);\n\n                var cx = cd0.cx;\n                var cy = cd0.cy;\n                var sliceTop = d3.select(this);\n                var slicePath = sliceTop.selectAll('path.surface').data([pt]);\n\n                slicePath.enter().append('path')\n                    .classed('surface', true)\n                    .style({'pointer-events': 'all'});\n\n                sliceTop.call(attachFxHandlers, gd, cd);\n\n                if(trace.pull) {\n                    var pull = +helpers.castOption(trace.pull, pt.pts) || 0;\n                    if(pull > 0) {\n                        cx += pull * pt.pxmid[0];\n                        cy += pull * pt.pxmid[1];\n                    }\n                }\n\n                pt.cxFinal = cx;\n                pt.cyFinal = cy;\n\n                function arc(start, finish, cw, scale) {\n                    var dx = scale * (finish[0] - start[0]);\n                    var dy = scale * (finish[1] - start[1]);\n\n                    return 'a' +\n                        (scale * cd0.r) + ',' + (scale * cd0.r) + ' 0 ' +\n                        pt.largeArc + (cw ? ' 1 ' : ' 0 ') + dx + ',' + dy;\n                }\n\n                var hole = trace.hole;\n                if(pt.v === cd0.vTotal) { // 100% fails bcs arc start and end are identical\n                    var outerCircle = 'M' + (cx + pt.px0[0]) + ',' + (cy + pt.px0[1]) +\n                        arc(pt.px0, pt.pxmid, true, 1) +\n                        arc(pt.pxmid, pt.px0, true, 1) + 'Z';\n                    if(hole) {\n                        slicePath.attr('d',\n                            'M' + (cx + hole * pt.px0[0]) + ',' + (cy + hole * pt.px0[1]) +\n                            arc(pt.px0, pt.pxmid, false, hole) +\n                            arc(pt.pxmid, pt.px0, false, hole) +\n                            'Z' + outerCircle);\n                    } else slicePath.attr('d', outerCircle);\n                } else {\n                    var outerArc = arc(pt.px0, pt.px1, true, 1);\n\n                    if(hole) {\n                        var rim = 1 - hole;\n                        slicePath.attr('d',\n                            'M' + (cx + hole * pt.px1[0]) + ',' + (cy + hole * pt.px1[1]) +\n                            arc(pt.px1, pt.px0, false, hole) +\n                            'l' + (rim * pt.px0[0]) + ',' + (rim * pt.px0[1]) +\n                            outerArc +\n                            'Z');\n                    } else {\n                        slicePath.attr('d',\n                            'M' + cx + ',' + cy +\n                            'l' + pt.px0[0] + ',' + pt.px0[1] +\n                            outerArc +\n                            'Z');\n                    }\n                }\n\n                // add text\n                formatSliceLabel(gd, pt, cd0);\n                var textPosition = helpers.castOption(trace.textposition, pt.pts);\n                var sliceTextGroup = sliceTop.selectAll('g.slicetext')\n                    .data(pt.text && (textPosition !== 'none') ? [0] : []);\n\n                sliceTextGroup.enter().append('g')\n                    .classed('slicetext', true);\n                sliceTextGroup.exit().remove();\n\n                sliceTextGroup.each(function() {\n                    var sliceText = Lib.ensureSingle(d3.select(this), 'text', '', function(s) {\n                        // prohibit tex interpretation until we can handle\n                        // tex and regular text together\n                        s.attr('data-notex', 1);\n                    });\n\n                    var font = Lib.ensureUniformFontSize(gd, textPosition === 'outside' ?\n                        determineOutsideTextFont(trace, pt, fullLayout.font) :\n                        determineInsideTextFont(trace, pt, fullLayout.font)\n                    );\n\n                    sliceText.text(pt.text)\n                        .attr({\n                            'class': 'slicetext',\n                            transform: '',\n                            'text-anchor': 'middle'\n                        })\n                        .call(Drawing.font, font)\n                        .call(svgTextUtils.convertToTspans, gd);\n\n                    // position the text relative to the slice\n                    var textBB = Drawing.bBox(sliceText.node());\n                    var transform;\n\n                    if(textPosition === 'outside') {\n                        transform = transformOutsideText(textBB, pt);\n                    } else {\n                        transform = transformInsideText(textBB, pt, cd0);\n                        if(textPosition === 'auto' && transform.scale < 1) {\n                            var newFont = Lib.ensureUniformFontSize(gd, trace.outsidetextfont);\n\n                            sliceText.call(Drawing.font, newFont);\n                            textBB = Drawing.bBox(sliceText.node());\n\n                            transform = transformOutsideText(textBB, pt);\n                        }\n                    }\n\n                    var textPosAngle = transform.textPosAngle;\n                    var textXY = textPosAngle === undefined ? pt.pxmid : getCoords(cd0.r, textPosAngle);\n                    transform.targetX = cx + textXY[0] * transform.rCenter + (transform.x || 0);\n                    transform.targetY = cy + textXY[1] * transform.rCenter + (transform.y || 0);\n                    computeTransform(transform, textBB);\n\n                    // save some stuff to use later ensure no labels overlap\n                    if(transform.outside) {\n                        var targetY = transform.targetY;\n                        pt.yLabelMin = targetY - textBB.height / 2;\n                        pt.yLabelMid = targetY;\n                        pt.yLabelMax = targetY + textBB.height / 2;\n                        pt.labelExtraX = 0;\n                        pt.labelExtraY = 0;\n                        hasOutsideText = true;\n                    }\n\n                    transform.fontSize = font.size;\n                    recordMinTextSize(trace.type, transform, fullLayout);\n                    cd[i].transform = transform;\n\n                    sliceText.attr('transform', Lib.getTextTransform(transform));\n                });\n            });\n\n            // add the title\n            var titleTextGroup = d3.select(this).selectAll('g.titletext')\n                .data(trace.title.text ? [0] : []);\n\n            titleTextGroup.enter().append('g')\n                .classed('titletext', true);\n            titleTextGroup.exit().remove();\n\n            titleTextGroup.each(function() {\n                var titleText = Lib.ensureSingle(d3.select(this), 'text', '', function(s) {\n                    // prohibit tex interpretation as above\n                    s.attr('data-notex', 1);\n                });\n\n                var txt = trace.title.text;\n                if(trace._meta) {\n                    txt = Lib.templateString(txt, trace._meta);\n                }\n\n                titleText.text(txt)\n                    .attr({\n                        'class': 'titletext',\n                        transform: '',\n                        'text-anchor': 'middle',\n                    })\n                .call(Drawing.font, trace.title.font)\n                .call(svgTextUtils.convertToTspans, gd);\n\n                var transform;\n\n                if(trace.title.position === 'middle center') {\n                    transform = positionTitleInside(cd0);\n                } else {\n                    transform = positionTitleOutside(cd0, gs);\n                }\n\n                titleText.attr('transform',\n                    strTranslate(transform.x, transform.y) +\n                    strScale(Math.min(1, transform.scale)) +\n                    strTranslate(transform.tx, transform.ty));\n            });\n\n            // now make sure no labels overlap (at least within one pie)\n            if(hasOutsideText) scootLabels(quadrants, trace);\n\n            plotTextLines(slices, trace);\n\n            if(hasOutsideText && trace.automargin) {\n                // TODO if we ever want to improve perf,\n                // we could reuse the textBB computed above together\n                // with the sliceText transform info\n                var traceBbox = Drawing.bBox(plotGroup.node());\n\n                var domain = trace.domain;\n                var vpw = gs.w * (domain.x[1] - domain.x[0]);\n                var vph = gs.h * (domain.y[1] - domain.y[0]);\n                var xgap = (0.5 * vpw - cd0.r) / gs.w;\n                var ygap = (0.5 * vph - cd0.r) / gs.h;\n\n                Plots.autoMargin(gd, 'pie.' + trace.uid + '.automargin', {\n                    xl: domain.x[0] - xgap,\n                    xr: domain.x[1] + xgap,\n                    yb: domain.y[0] - ygap,\n                    yt: domain.y[1] + ygap,\n                    l: Math.max(cd0.cx - cd0.r - traceBbox.left, 0),\n                    r: Math.max(traceBbox.right - (cd0.cx + cd0.r), 0),\n                    b: Math.max(traceBbox.bottom - (cd0.cy + cd0.r), 0),\n                    t: Math.max(cd0.cy - cd0.r - traceBbox.top, 0),\n                    pad: 5\n                });\n            }\n        });\n    });\n\n    // This is for a bug in Chrome (as of 2015-07-22, and does not affect FF)\n    // if insidetextfont and outsidetextfont are different sizes, sometimes the size\n    // of an \"em\" gets taken from the wrong element at first so lines are\n    // spaced wrong. You just have to tell it to try again later and it gets fixed.\n    // I have no idea why we haven't seen this in other contexts. Also, sometimes\n    // it gets the initial draw correct but on redraw it gets confused.\n    setTimeout(function() {\n        plotGroups.selectAll('tspan').each(function() {\n            var s = d3.select(this);\n            if(s.attr('dy')) s.attr('dy', s.attr('dy'));\n        });\n    }, 0);\n}\n\n// TODO add support for transition\nfunction plotTextLines(slices, trace) {\n    slices.each(function(pt) {\n        var sliceTop = d3.select(this);\n\n        if(!pt.labelExtraX && !pt.labelExtraY) {\n            sliceTop.select('path.textline').remove();\n            return;\n        }\n\n        // first move the text to its new location\n        var sliceText = sliceTop.select('g.slicetext text');\n\n        pt.transform.targetX += pt.labelExtraX;\n        pt.transform.targetY += pt.labelExtraY;\n\n        sliceText.attr('transform', Lib.getTextTransform(pt.transform));\n\n        // then add a line to the new location\n        var lineStartX = pt.cxFinal + pt.pxmid[0];\n        var lineStartY = pt.cyFinal + pt.pxmid[1];\n        var textLinePath = 'M' + lineStartX + ',' + lineStartY;\n        var finalX = (pt.yLabelMax - pt.yLabelMin) * (pt.pxmid[0] < 0 ? -1 : 1) / 4;\n\n        if(pt.labelExtraX) {\n            var yFromX = pt.labelExtraX * pt.pxmid[1] / pt.pxmid[0];\n            var yNet = pt.yLabelMid + pt.labelExtraY - (pt.cyFinal + pt.pxmid[1]);\n\n            if(Math.abs(yFromX) > Math.abs(yNet)) {\n                textLinePath +=\n                    'l' + (yNet * pt.pxmid[0] / pt.pxmid[1]) + ',' + yNet +\n                    'H' + (lineStartX + pt.labelExtraX + finalX);\n            } else {\n                textLinePath += 'l' + pt.labelExtraX + ',' + yFromX +\n                    'v' + (yNet - yFromX) +\n                    'h' + finalX;\n            }\n        } else {\n            textLinePath +=\n                'V' + (pt.yLabelMid + pt.labelExtraY) +\n                'h' + finalX;\n        }\n\n        Lib.ensureSingle(sliceTop, 'path', 'textline')\n            .call(Color.stroke, trace.outsidetextfont.color)\n            .attr({\n                'stroke-width': Math.min(2, trace.outsidetextfont.size / 8),\n                d: textLinePath,\n                fill: 'none'\n            });\n    });\n}\n\nfunction attachFxHandlers(sliceTop, gd, cd) {\n    var cd0 = cd[0];\n    var trace = cd0.trace;\n    var cx = cd0.cx;\n    var cy = cd0.cy;\n\n    // hover state vars\n    // have we drawn a hover label, so it should be cleared later\n    if(!('_hasHoverLabel' in trace)) trace._hasHoverLabel = false;\n    // have we emitted a hover event, so later an unhover event should be emitted\n    // note that click events do not depend on this - you can still get them\n    // with hovermode: false or if you were earlier dragging, then clicked\n    // in the same slice that you moused up in\n    if(!('_hasHoverEvent' in trace)) trace._hasHoverEvent = false;\n\n    sliceTop.on('mouseover', function(pt) {\n        // in case fullLayout or fullData has changed without a replot\n        var fullLayout2 = gd._fullLayout;\n        var trace2 = gd._fullData[trace.index];\n\n        if(gd._dragging || fullLayout2.hovermode === false) return;\n\n        var hoverinfo = trace2.hoverinfo;\n        if(Array.isArray(hoverinfo)) {\n            // super hacky: we need to pull out the *first* hoverinfo from\n            // pt.pts, then put it back into an array in a dummy trace\n            // and call castHoverinfo on that.\n            // TODO: do we want to have Fx.castHoverinfo somehow handle this?\n            // it already takes an array for index, for 2D, so this seems tricky.\n            hoverinfo = Fx.castHoverinfo({\n                hoverinfo: [helpers.castOption(hoverinfo, pt.pts)],\n                _module: trace._module\n            }, fullLayout2, 0);\n        }\n\n        if(hoverinfo === 'all') hoverinfo = 'label+text+value+percent+name';\n\n        // in case we dragged over the pie from another subplot,\n        // or if hover is turned off\n        if(trace2.hovertemplate || (hoverinfo !== 'none' && hoverinfo !== 'skip' && hoverinfo)) {\n            var rInscribed = pt.rInscribed || 0;\n            var hoverCenterX = cx + pt.pxmid[0] * (1 - rInscribed);\n            var hoverCenterY = cy + pt.pxmid[1] * (1 - rInscribed);\n            var separators = fullLayout2.separators;\n            var text = [];\n\n            if(hoverinfo && hoverinfo.indexOf('label') !== -1) text.push(pt.label);\n            pt.text = helpers.castOption(trace2.hovertext || trace2.text, pt.pts);\n            if(hoverinfo && hoverinfo.indexOf('text') !== -1) {\n                var tx = pt.text;\n                if(Lib.isValidTextValue(tx)) text.push(tx);\n            }\n            pt.value = pt.v;\n            pt.valueLabel = helpers.formatPieValue(pt.v, separators);\n            if(hoverinfo && hoverinfo.indexOf('value') !== -1) text.push(pt.valueLabel);\n            pt.percent = pt.v / cd0.vTotal;\n            pt.percentLabel = helpers.formatPiePercent(pt.percent, separators);\n            if(hoverinfo && hoverinfo.indexOf('percent') !== -1) text.push(pt.percentLabel);\n\n            var hoverLabel = trace2.hoverlabel;\n            var hoverFont = hoverLabel.font;\n\n            Fx.loneHover({\n                trace: trace,\n                x0: hoverCenterX - rInscribed * cd0.r,\n                x1: hoverCenterX + rInscribed * cd0.r,\n                y: hoverCenterY,\n                text: text.join('<br>'),\n                name: (trace2.hovertemplate || hoverinfo.indexOf('name') !== -1) ? trace2.name : undefined,\n                idealAlign: pt.pxmid[0] < 0 ? 'left' : 'right',\n                color: helpers.castOption(hoverLabel.bgcolor, pt.pts) || pt.color,\n                borderColor: helpers.castOption(hoverLabel.bordercolor, pt.pts),\n                fontFamily: helpers.castOption(hoverFont.family, pt.pts),\n                fontSize: helpers.castOption(hoverFont.size, pt.pts),\n                fontColor: helpers.castOption(hoverFont.color, pt.pts),\n                nameLength: helpers.castOption(hoverLabel.namelength, pt.pts),\n                textAlign: helpers.castOption(hoverLabel.align, pt.pts),\n                hovertemplate: helpers.castOption(trace2.hovertemplate, pt.pts),\n                hovertemplateLabels: pt,\n                eventData: [eventData(pt, trace2)]\n            }, {\n                container: fullLayout2._hoverlayer.node(),\n                outerContainer: fullLayout2._paper.node(),\n                gd: gd\n            });\n\n            trace._hasHoverLabel = true;\n        }\n\n        trace._hasHoverEvent = true;\n        gd.emit('plotly_hover', {\n            points: [eventData(pt, trace2)],\n            event: d3.event\n        });\n    });\n\n    sliceTop.on('mouseout', function(evt) {\n        var fullLayout2 = gd._fullLayout;\n        var trace2 = gd._fullData[trace.index];\n        var pt = d3.select(this).datum();\n\n        if(trace._hasHoverEvent) {\n            evt.originalEvent = d3.event;\n            gd.emit('plotly_unhover', {\n                points: [eventData(pt, trace2)],\n                event: d3.event\n            });\n            trace._hasHoverEvent = false;\n        }\n\n        if(trace._hasHoverLabel) {\n            Fx.loneUnhover(fullLayout2._hoverlayer.node());\n            trace._hasHoverLabel = false;\n        }\n    });\n\n    sliceTop.on('click', function(pt) {\n        // TODO: this does not support right-click. If we want to support it, we\n        // would likely need to change pie to use dragElement instead of straight\n        // mapbox event binding. Or perhaps better, make a simple wrapper with the\n        // right mousedown, mousemove, and mouseup handlers just for a left/right click\n        // mapbox would use this too.\n        var fullLayout2 = gd._fullLayout;\n        var trace2 = gd._fullData[trace.index];\n\n        if(gd._dragging || fullLayout2.hovermode === false) return;\n\n        gd._hoverdata = [eventData(pt, trace2)];\n        Fx.click(gd, d3.event);\n    });\n}\n\nfunction determineOutsideTextFont(trace, pt, layoutFont) {\n    var color =\n        helpers.castOption(trace.outsidetextfont.color, pt.pts) ||\n        helpers.castOption(trace.textfont.color, pt.pts) ||\n        layoutFont.color;\n\n    var family =\n        helpers.castOption(trace.outsidetextfont.family, pt.pts) ||\n        helpers.castOption(trace.textfont.family, pt.pts) ||\n        layoutFont.family;\n\n    var size =\n        helpers.castOption(trace.outsidetextfont.size, pt.pts) ||\n        helpers.castOption(trace.textfont.size, pt.pts) ||\n        layoutFont.size;\n\n    return {\n        color: color,\n        family: family,\n        size: size\n    };\n}\n\nfunction determineInsideTextFont(trace, pt, layoutFont) {\n    var customColor = helpers.castOption(trace.insidetextfont.color, pt.pts);\n    if(!customColor && trace._input.textfont) {\n        // Why not simply using trace.textfont? Because if not set, it\n        // defaults to layout.font which has a default color. But if\n        // textfont.color and insidetextfont.color don't supply a value,\n        // a contrasting color shall be used.\n        customColor = helpers.castOption(trace._input.textfont.color, pt.pts);\n    }\n\n    var family =\n        helpers.castOption(trace.insidetextfont.family, pt.pts) ||\n        helpers.castOption(trace.textfont.family, pt.pts) ||\n        layoutFont.family;\n\n    var size =\n        helpers.castOption(trace.insidetextfont.size, pt.pts) ||\n        helpers.castOption(trace.textfont.size, pt.pts) ||\n        layoutFont.size;\n\n    return {\n        color: customColor || Color.contrast(pt.color),\n        family: family,\n        size: size\n    };\n}\n\nfunction prerenderTitles(cdModule, gd) {\n    var cd0, trace;\n\n    // Determine the width and height of the title for each pie.\n    for(var i = 0; i < cdModule.length; i++) {\n        cd0 = cdModule[i][0];\n        trace = cd0.trace;\n\n        if(trace.title.text) {\n            var txt = trace.title.text;\n            if(trace._meta) {\n                txt = Lib.templateString(txt, trace._meta);\n            }\n\n            var dummyTitle = Drawing.tester.append('text')\n              .attr('data-notex', 1)\n              .text(txt)\n              .call(Drawing.font, trace.title.font)\n              .call(svgTextUtils.convertToTspans, gd);\n            var bBox = Drawing.bBox(dummyTitle.node(), true);\n            cd0.titleBox = {\n                width: bBox.width,\n                height: bBox.height,\n            };\n            dummyTitle.remove();\n        }\n    }\n}\n\nfunction transformInsideText(textBB, pt, cd0) {\n    var r = cd0.r || pt.rpx1;\n    var rInscribed = pt.rInscribed;\n\n    var isEmpty = pt.startangle === pt.stopangle;\n    if(isEmpty) {\n        return {\n            rCenter: 1 - rInscribed,\n            scale: 0,\n            rotate: 0,\n            textPosAngle: 0\n        };\n    }\n\n    var ring = pt.ring;\n    var isCircle = (ring === 1) && (Math.abs(pt.startangle - pt.stopangle) === Math.PI * 2);\n\n    var halfAngle = pt.halfangle;\n    var midAngle = pt.midangle;\n\n    var orientation = cd0.trace.insidetextorientation;\n    var isHorizontal = orientation === 'horizontal';\n    var isTangential = orientation === 'tangential';\n    var isRadial = orientation === 'radial';\n    var isAuto = orientation === 'auto';\n\n    var allTransforms = [];\n    var newT;\n\n    if(!isAuto) {\n        // max size if text is placed (horizontally) at the top or bottom of the arc\n\n        var considerCrossing = function(angle, key) {\n            if(isCrossing(pt, angle)) {\n                var dStart = Math.abs(angle - pt.startangle);\n                var dStop = Math.abs(angle - pt.stopangle);\n\n                var closestEdge = dStart < dStop ? dStart : dStop;\n\n                if(key === 'tan') {\n                    newT = calcTanTransform(textBB, r, ring, closestEdge, 0);\n                } else { // case of 'rad'\n                    newT = calcRadTransform(textBB, r, ring, closestEdge, Math.PI / 2);\n                }\n                newT.textPosAngle = angle;\n\n                allTransforms.push(newT);\n            }\n        };\n\n        // to cover all cases with trace.rotation added\n        var i;\n        if(isHorizontal || isTangential) {\n            // top\n            for(i = 4; i >= -4; i -= 2) considerCrossing(Math.PI * i, 'tan');\n            // bottom\n            for(i = 4; i >= -4; i -= 2) considerCrossing(Math.PI * (i + 1), 'tan');\n        }\n        if(isHorizontal || isRadial) {\n            // left\n            for(i = 4; i >= -4; i -= 2) considerCrossing(Math.PI * (i + 1.5), 'rad');\n            // right\n            for(i = 4; i >= -4; i -= 2) considerCrossing(Math.PI * (i + 0.5), 'rad');\n        }\n    }\n\n    if(isCircle || isAuto || isHorizontal) {\n        // max size text can be inserted inside without rotating it\n        // this inscribes the text rectangle in a circle, which is then inscribed\n        // in the slice, so it will be an underestimate, which some day we may want\n        // to improve so this case can get more use\n        var textDiameter = Math.sqrt(textBB.width * textBB.width + textBB.height * textBB.height);\n\n        newT = {\n            scale: rInscribed * r * 2 / textDiameter,\n\n            // and the center position and rotation in this case\n            rCenter: 1 - rInscribed,\n            rotate: 0\n        };\n\n        newT.textPosAngle = (pt.startangle + pt.stopangle) / 2;\n        if(newT.scale >= 1) return newT;\n\n        allTransforms.push(newT);\n    }\n\n    if(isAuto || isRadial) {\n        newT = calcRadTransform(textBB, r, ring, halfAngle, midAngle);\n        newT.textPosAngle = (pt.startangle + pt.stopangle) / 2;\n        allTransforms.push(newT);\n    }\n\n    if(isAuto || isTangential) {\n        newT = calcTanTransform(textBB, r, ring, halfAngle, midAngle);\n        newT.textPosAngle = (pt.startangle + pt.stopangle) / 2;\n        allTransforms.push(newT);\n    }\n\n    var id = 0;\n    var maxScale = 0;\n    for(var k = 0; k < allTransforms.length; k++) {\n        var s = allTransforms[k].scale;\n        if(maxScale < s) {\n            maxScale = s;\n            id = k;\n        }\n\n        if(!isAuto && maxScale >= 1) {\n            // respect test order for non-auto options\n            break;\n        }\n    }\n    return allTransforms[id];\n}\n\nfunction isCrossing(pt, angle) {\n    var start = pt.startangle;\n    var stop = pt.stopangle;\n    return (\n        (start > angle && angle > stop) ||\n        (start < angle && angle < stop)\n    );\n}\n\nfunction calcRadTransform(textBB, r, ring, halfAngle, midAngle) {\n    r = Math.max(0, r - 2 * TEXTPAD);\n\n    // max size if text is rotated radially\n    var a = textBB.width / textBB.height;\n    var s = calcMaxHalfSize(a, halfAngle, r, ring);\n    return {\n        scale: s * 2 / textBB.height,\n        rCenter: calcRCenter(a, s / r),\n        rotate: calcRotate(midAngle)\n    };\n}\n\nfunction calcTanTransform(textBB, r, ring, halfAngle, midAngle) {\n    r = Math.max(0, r - 2 * TEXTPAD);\n\n    // max size if text is rotated tangentially\n    var a = textBB.height / textBB.width;\n    var s = calcMaxHalfSize(a, halfAngle, r, ring);\n    return {\n        scale: s * 2 / textBB.width,\n        rCenter: calcRCenter(a, s / r),\n        rotate: calcRotate(midAngle + Math.PI / 2)\n    };\n}\n\nfunction calcRCenter(a, b) {\n    return Math.cos(b) - a * b;\n}\n\nfunction calcRotate(t) {\n    return (180 / Math.PI * t + 720) % 180 - 90;\n}\n\nfunction calcMaxHalfSize(a, halfAngle, r, ring) {\n    var q = a + 1 / (2 * Math.tan(halfAngle));\n    return r * Math.min(\n        1 / (Math.sqrt(q * q + 0.5) + q),\n        ring / (Math.sqrt(a * a + ring / 2) + a)\n    );\n}\n\nfunction getInscribedRadiusFraction(pt, cd0) {\n    if(pt.v === cd0.vTotal && !cd0.trace.hole) return 1;// special case of 100% with no hole\n\n    return Math.min(1 / (1 + 1 / Math.sin(pt.halfangle)), pt.ring / 2);\n}\n\nfunction transformOutsideText(textBB, pt) {\n    var x = pt.pxmid[0];\n    var y = pt.pxmid[1];\n    var dx = textBB.width / 2;\n    var dy = textBB.height / 2;\n\n    if(x < 0) dx *= -1;\n    if(y < 0) dy *= -1;\n\n    return {\n        scale: 1,\n        rCenter: 1,\n        rotate: 0,\n        x: dx + Math.abs(dy) * (dx > 0 ? 1 : -1) / 2,\n        y: dy / (1 + x * x / (y * y)),\n        outside: true\n    };\n}\n\nfunction positionTitleInside(cd0) {\n    var textDiameter =\n        Math.sqrt(cd0.titleBox.width * cd0.titleBox.width + cd0.titleBox.height * cd0.titleBox.height);\n    return {\n        x: cd0.cx,\n        y: cd0.cy,\n        scale: cd0.trace.hole * cd0.r * 2 / textDiameter,\n        tx: 0,\n        ty: - cd0.titleBox.height / 2 + cd0.trace.title.font.size\n    };\n}\n\nfunction positionTitleOutside(cd0, plotSize) {\n    var scaleX = 1;\n    var scaleY = 1;\n    var maxPull;\n\n    var trace = cd0.trace;\n    // position of the baseline point of the text box in the plot, before scaling.\n    // we anchored the text in the middle, so the baseline is on the bottom middle\n    // of the first line of text.\n    var topMiddle = {\n        x: cd0.cx,\n        y: cd0.cy\n    };\n    // relative translation of the text box after scaling\n    var translate = {\n        tx: 0,\n        ty: 0\n    };\n\n    // we reason below as if the baseline is the top middle point of the text box.\n    // so we must add the font size to approximate the y-coord. of the top.\n    // note that this correction must happen after scaling.\n    translate.ty += trace.title.font.size;\n    maxPull = getMaxPull(trace);\n\n    if(trace.title.position.indexOf('top') !== -1) {\n        topMiddle.y -= (1 + maxPull) * cd0.r;\n        translate.ty -= cd0.titleBox.height;\n    } else if(trace.title.position.indexOf('bottom') !== -1) {\n        topMiddle.y += (1 + maxPull) * cd0.r;\n    }\n\n    var rx = applyAspectRatio(cd0.r, cd0.trace.aspectratio);\n\n    var maxWidth = plotSize.w * (trace.domain.x[1] - trace.domain.x[0]) / 2;\n    if(trace.title.position.indexOf('left') !== -1) {\n        // we start the text at the left edge of the pie\n        maxWidth = maxWidth + rx;\n        topMiddle.x -= (1 + maxPull) * rx;\n        translate.tx += cd0.titleBox.width / 2;\n    } else if(trace.title.position.indexOf('center') !== -1) {\n        maxWidth *= 2;\n    } else if(trace.title.position.indexOf('right') !== -1) {\n        maxWidth = maxWidth + rx;\n        topMiddle.x += (1 + maxPull) * rx;\n        translate.tx -= cd0.titleBox.width / 2;\n    }\n    scaleX = maxWidth / cd0.titleBox.width;\n    scaleY = getTitleSpace(cd0, plotSize) / cd0.titleBox.height;\n    return {\n        x: topMiddle.x,\n        y: topMiddle.y,\n        scale: Math.min(scaleX, scaleY),\n        tx: translate.tx,\n        ty: translate.ty\n    };\n}\n\nfunction applyAspectRatio(x, aspectratio) {\n    return x / ((aspectratio === undefined) ? 1 : aspectratio);\n}\n\nfunction getTitleSpace(cd0, plotSize) {\n    var trace = cd0.trace;\n    var pieBoxHeight = plotSize.h * (trace.domain.y[1] - trace.domain.y[0]);\n    // use at most half of the plot for the title\n    return Math.min(cd0.titleBox.height, pieBoxHeight / 2);\n}\n\nfunction getMaxPull(trace) {\n    var maxPull = trace.pull;\n    if(!maxPull) return 0;\n\n    var j;\n    if(Array.isArray(maxPull)) {\n        maxPull = 0;\n        for(j = 0; j < trace.pull.length; j++) {\n            if(trace.pull[j] > maxPull) maxPull = trace.pull[j];\n        }\n    }\n    return maxPull;\n}\n\nfunction scootLabels(quadrants, trace) {\n    var xHalf, yHalf, equatorFirst, farthestX, farthestY,\n        xDiffSign, yDiffSign, thisQuad, oppositeQuad,\n        wholeSide, i, thisQuadOutside, firstOppositeOutsidePt;\n\n    function topFirst(a, b) { return a.pxmid[1] - b.pxmid[1]; }\n    function bottomFirst(a, b) { return b.pxmid[1] - a.pxmid[1]; }\n\n    function scootOneLabel(thisPt, prevPt) {\n        if(!prevPt) prevPt = {};\n\n        var prevOuterY = prevPt.labelExtraY + (yHalf ? prevPt.yLabelMax : prevPt.yLabelMin);\n        var thisInnerY = yHalf ? thisPt.yLabelMin : thisPt.yLabelMax;\n        var thisOuterY = yHalf ? thisPt.yLabelMax : thisPt.yLabelMin;\n        var thisSliceOuterY = thisPt.cyFinal + farthestY(thisPt.px0[1], thisPt.px1[1]);\n        var newExtraY = prevOuterY - thisInnerY;\n\n        var xBuffer, i, otherPt, otherOuterY, otherOuterX, newExtraX;\n\n        // make sure this label doesn't overlap other labels\n        // this *only* has us move these labels vertically\n        if(newExtraY * yDiffSign > 0) thisPt.labelExtraY = newExtraY;\n\n        // make sure this label doesn't overlap any slices\n        if(!Array.isArray(trace.pull)) return; // this can only happen with array pulls\n\n        for(i = 0; i < wholeSide.length; i++) {\n            otherPt = wholeSide[i];\n\n            // overlap can only happen if the other point is pulled more than this one\n            if(otherPt === thisPt || (\n                (helpers.castOption(trace.pull, thisPt.pts) || 0) >=\n                (helpers.castOption(trace.pull, otherPt.pts) || 0))\n            ) {\n                continue;\n            }\n\n            if((thisPt.pxmid[1] - otherPt.pxmid[1]) * yDiffSign > 0) {\n                // closer to the equator - by construction all of these happen first\n                // move the text vertically to get away from these slices\n                otherOuterY = otherPt.cyFinal + farthestY(otherPt.px0[1], otherPt.px1[1]);\n                newExtraY = otherOuterY - thisInnerY - thisPt.labelExtraY;\n\n                if(newExtraY * yDiffSign > 0) thisPt.labelExtraY += newExtraY;\n            } else if((thisOuterY + thisPt.labelExtraY - thisSliceOuterY) * yDiffSign > 0) {\n                // farther from the equator - happens after we've done all the\n                // vertical moving we're going to do\n                // move horizontally to get away from these more polar slices\n\n                // if we're moving horz. based on a slice that's several slices away from this one\n                // then we need some extra space for the lines to labels between them\n                xBuffer = 3 * xDiffSign * Math.abs(i - wholeSide.indexOf(thisPt));\n\n                otherOuterX = otherPt.cxFinal + farthestX(otherPt.px0[0], otherPt.px1[0]);\n                newExtraX = otherOuterX + xBuffer - (thisPt.cxFinal + thisPt.pxmid[0]) - thisPt.labelExtraX;\n\n                if(newExtraX * xDiffSign > 0) thisPt.labelExtraX += newExtraX;\n            }\n        }\n    }\n\n    for(yHalf = 0; yHalf < 2; yHalf++) {\n        equatorFirst = yHalf ? topFirst : bottomFirst;\n        farthestY = yHalf ? Math.max : Math.min;\n        yDiffSign = yHalf ? 1 : -1;\n\n        for(xHalf = 0; xHalf < 2; xHalf++) {\n            farthestX = xHalf ? Math.max : Math.min;\n            xDiffSign = xHalf ? 1 : -1;\n\n            // first sort the array\n            // note this is a copy of cd, so cd itself doesn't get sorted\n            // but we can still modify points in place.\n            thisQuad = quadrants[yHalf][xHalf];\n            thisQuad.sort(equatorFirst);\n\n            oppositeQuad = quadrants[1 - yHalf][xHalf];\n            wholeSide = oppositeQuad.concat(thisQuad);\n\n            thisQuadOutside = [];\n            for(i = 0; i < thisQuad.length; i++) {\n                if(thisQuad[i].yLabelMid !== undefined) thisQuadOutside.push(thisQuad[i]);\n            }\n\n            firstOppositeOutsidePt = false;\n            for(i = 0; yHalf && i < oppositeQuad.length; i++) {\n                if(oppositeQuad[i].yLabelMid !== undefined) {\n                    firstOppositeOutsidePt = oppositeQuad[i];\n                    break;\n                }\n            }\n\n            // each needs to avoid the previous\n            for(i = 0; i < thisQuadOutside.length; i++) {\n                var prevPt = i && thisQuadOutside[i - 1];\n                // bottom half needs to avoid the first label of the top half\n                // top half we still need to call scootOneLabel on the first slice\n                // so we can avoid other slices, but we don't pass a prevPt\n                if(firstOppositeOutsidePt && !i) prevPt = firstOppositeOutsidePt;\n                scootOneLabel(thisQuadOutside[i], prevPt);\n            }\n        }\n    }\n}\n\nfunction layoutAreas(cdModule, plotSize) {\n    var scaleGroups = [];\n\n    // figure out the center and maximum radius\n    for(var i = 0; i < cdModule.length; i++) {\n        var cd0 = cdModule[i][0];\n        var trace = cd0.trace;\n\n        var domain = trace.domain;\n        var width = plotSize.w * (domain.x[1] - domain.x[0]);\n        var height = plotSize.h * (domain.y[1] - domain.y[0]);\n        // leave some space for the title, if it will be displayed outside\n        if(trace.title.text && trace.title.position !== 'middle center') {\n            height -= getTitleSpace(cd0, plotSize);\n        }\n\n        var rx = width / 2;\n        var ry = height / 2;\n        if(trace.type === 'funnelarea' && !trace.scalegroup) {\n            ry /= trace.aspectratio;\n        }\n\n        cd0.r = Math.min(rx, ry) / (1 + getMaxPull(trace));\n\n        cd0.cx = plotSize.l + plotSize.w * (trace.domain.x[1] + trace.domain.x[0]) / 2;\n        cd0.cy = plotSize.t + plotSize.h * (1 - trace.domain.y[0]) - height / 2;\n        if(trace.title.text && trace.title.position.indexOf('bottom') !== -1) {\n            cd0.cy -= getTitleSpace(cd0, plotSize);\n        }\n\n        if(trace.scalegroup && scaleGroups.indexOf(trace.scalegroup) === -1) {\n            scaleGroups.push(trace.scalegroup);\n        }\n    }\n\n    groupScale(cdModule, scaleGroups);\n}\n\nfunction groupScale(cdModule, scaleGroups) {\n    var cd0, i, trace;\n\n    // scale those that are grouped\n    for(var k = 0; k < scaleGroups.length; k++) {\n        var min = Infinity;\n        var g = scaleGroups[k];\n\n        for(i = 0; i < cdModule.length; i++) {\n            cd0 = cdModule[i][0];\n            trace = cd0.trace;\n\n            if(trace.scalegroup === g) {\n                var area;\n                if(trace.type === 'pie') {\n                    area = cd0.r * cd0.r;\n                } else if(trace.type === 'funnelarea') {\n                    var rx, ry;\n\n                    if(trace.aspectratio > 1) {\n                        rx = cd0.r;\n                        ry = rx / trace.aspectratio;\n                    } else {\n                        ry = cd0.r;\n                        rx = ry * trace.aspectratio;\n                    }\n\n                    rx *= (1 + trace.baseratio) / 2;\n\n                    area = rx * ry;\n                }\n\n                min = Math.min(min, area / cd0.vTotal);\n            }\n        }\n\n        for(i = 0; i < cdModule.length; i++) {\n            cd0 = cdModule[i][0];\n            trace = cd0.trace;\n            if(trace.scalegroup === g) {\n                var v = min * cd0.vTotal;\n                if(trace.type === 'funnelarea') {\n                    v /= (1 + trace.baseratio) / 2;\n                    v /= trace.aspectratio;\n                }\n\n                cd0.r = Math.sqrt(v);\n            }\n        }\n    }\n}\n\nfunction setCoords(cd) {\n    var cd0 = cd[0];\n    var r = cd0.r;\n    var trace = cd0.trace;\n    var currentAngle = helpers.getRotationAngle(trace.rotation);\n    var angleFactor = 2 * Math.PI / cd0.vTotal;\n    var firstPt = 'px0';\n    var lastPt = 'px1';\n\n    var i, cdi, currentCoords;\n\n    if(trace.direction === 'counterclockwise') {\n        for(i = 0; i < cd.length; i++) {\n            if(!cd[i].hidden) break; // find the first non-hidden slice\n        }\n        if(i === cd.length) return; // all slices hidden\n\n        currentAngle += angleFactor * cd[i].v;\n        angleFactor *= -1;\n        firstPt = 'px1';\n        lastPt = 'px0';\n    }\n\n    currentCoords = getCoords(r, currentAngle);\n\n    for(i = 0; i < cd.length; i++) {\n        cdi = cd[i];\n        if(cdi.hidden) continue;\n\n        cdi[firstPt] = currentCoords;\n\n        cdi.startangle = currentAngle;\n        currentAngle += angleFactor * cdi.v / 2;\n        cdi.pxmid = getCoords(r, currentAngle);\n        cdi.midangle = currentAngle;\n        currentAngle += angleFactor * cdi.v / 2;\n        currentCoords = getCoords(r, currentAngle);\n        cdi.stopangle = currentAngle;\n\n        cdi[lastPt] = currentCoords;\n\n        cdi.largeArc = (cdi.v > cd0.vTotal / 2) ? 1 : 0;\n\n        cdi.halfangle = Math.PI * Math.min(cdi.v / cd0.vTotal, 0.5);\n        cdi.ring = 1 - trace.hole;\n        cdi.rInscribed = getInscribedRadiusFraction(cdi, cd0);\n    }\n}\n\nfunction getCoords(r, angle) {\n    return [r * Math.sin(angle), -r * Math.cos(angle)];\n}\n\nfunction formatSliceLabel(gd, pt, cd0) {\n    var fullLayout = gd._fullLayout;\n    var trace = cd0.trace;\n    // look for textemplate\n    var texttemplate = trace.texttemplate;\n\n    // now insert text\n    var textinfo = trace.textinfo;\n    if(!texttemplate && textinfo && textinfo !== 'none') {\n        var parts = textinfo.split('+');\n        var hasFlag = function(flag) { return parts.indexOf(flag) !== -1; };\n        var hasLabel = hasFlag('label');\n        var hasText = hasFlag('text');\n        var hasValue = hasFlag('value');\n        var hasPercent = hasFlag('percent');\n\n        var separators = fullLayout.separators;\n        var text;\n\n        text = hasLabel ? [pt.label] : [];\n        if(hasText) {\n            var tx = helpers.getFirstFilled(trace.text, pt.pts);\n            if(isValidTextValue(tx)) text.push(tx);\n        }\n        if(hasValue) text.push(helpers.formatPieValue(pt.v, separators));\n        if(hasPercent) text.push(helpers.formatPiePercent(pt.v / cd0.vTotal, separators));\n        pt.text = text.join('<br>');\n    }\n\n    function makeTemplateVariables(pt) {\n        return {\n            label: pt.label,\n            value: pt.v,\n            valueLabel: helpers.formatPieValue(pt.v, fullLayout.separators),\n            percent: pt.v / cd0.vTotal,\n            percentLabel: helpers.formatPiePercent(pt.v / cd0.vTotal, fullLayout.separators),\n            color: pt.color,\n            text: pt.text,\n            customdata: Lib.castOption(trace, pt.i, 'customdata')\n        };\n    }\n\n    if(texttemplate) {\n        var txt = Lib.castOption(trace, pt.i, 'texttemplate');\n        if(!txt) {\n            pt.text = '';\n        } else {\n            var obj = makeTemplateVariables(pt);\n            var ptTx = helpers.getFirstFilled(trace.text, pt.pts);\n            if(isValidTextValue(ptTx) || ptTx === '') obj.text = ptTx;\n            pt.text = Lib.texttemplateString(txt, obj, gd._fullLayout._d3locale, obj, trace._meta || {});\n        }\n    }\n}\n\nfunction computeTransform(\n    transform,  // inout\n    textBB      // in\n) {\n    var a = transform.rotate * Math.PI / 180;\n    var cosA = Math.cos(a);\n    var sinA = Math.sin(a);\n    var midX = (textBB.left + textBB.right) / 2;\n    var midY = (textBB.top + textBB.bottom) / 2;\n    transform.textX = midX * cosA - midY * sinA;\n    transform.textY = midX * sinA + midY * cosA;\n    transform.noCenter = true;\n}\n\nmodule.exports = {\n    plot: plot,\n    formatSliceLabel: formatSliceLabel,\n    transformInsideText: transformInsideText,\n    determineInsideTextFont: determineInsideTextFont,\n    positionTitleOutside: positionTitleOutside,\n    prerenderTitles: prerenderTitles,\n    layoutAreas: layoutAreas,\n    attachFxHandlers: attachFxHandlers,\n    computeTransform: computeTransform\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar styleOne = require('./style_one');\nvar resizeText = require('../bar/uniform_text').resizeText;\n\nmodule.exports = function style(gd) {\n    var s = gd._fullLayout._pielayer.selectAll('.trace');\n    resizeText(gd, s, 'pie');\n\n    s.each(function(cd) {\n        var cd0 = cd[0];\n        var trace = cd0.trace;\n        var traceSelection = d3.select(this);\n\n        traceSelection.style({opacity: trace.opacity});\n\n        traceSelection.selectAll('path.surface').each(function(pt) {\n            d3.select(this).call(styleOne, pt, trace);\n        });\n    });\n};\n","'use strict';\n\nvar Color = require('../../components/color');\nvar castOption = require('./helpers').castOption;\n\nmodule.exports = function styleOne(s, pt, trace) {\n    var line = trace.marker.line;\n    var lineColor = castOption(line.color, pt.pts) || Color.defaultLine;\n    var lineWidth = castOption(line.width, pt.pts) || 0;\n\n    s.style('stroke-width', lineWidth)\n        .call(Color.fill, pt.color)\n        .call(Color.stroke, lineColor);\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\n\n// arrayOk attributes, merge them into calcdata array\nmodule.exports = function arraysToCalcdata(cd, trace) {\n    // so each point knows which index it originally came from\n    for(var i = 0; i < cd.length; i++) cd[i].i = i;\n\n    Lib.mergeArray(trace.text, cd, 'tx');\n    Lib.mergeArray(trace.texttemplate, cd, 'txt');\n    Lib.mergeArray(trace.hovertext, cd, 'htx');\n    Lib.mergeArray(trace.customdata, cd, 'data');\n    Lib.mergeArray(trace.textposition, cd, 'tp');\n    if(trace.textfont) {\n        Lib.mergeArrayCastPositive(trace.textfont.size, cd, 'ts');\n        Lib.mergeArray(trace.textfont.color, cd, 'tc');\n        Lib.mergeArray(trace.textfont.family, cd, 'tf');\n    }\n\n    var marker = trace.marker;\n    if(marker) {\n        Lib.mergeArrayCastPositive(marker.size, cd, 'ms');\n        Lib.mergeArrayCastPositive(marker.opacity, cd, 'mo');\n        Lib.mergeArray(marker.symbol, cd, 'mx');\n        Lib.mergeArray(marker.color, cd, 'mc');\n\n        var markerLine = marker.line;\n        if(marker.line) {\n            Lib.mergeArray(markerLine.color, cd, 'mlc');\n            Lib.mergeArrayCastPositive(markerLine.width, cd, 'mlw');\n        }\n\n        var markerGradient = marker.gradient;\n        if(markerGradient && markerGradient.type !== 'none') {\n            Lib.mergeArray(markerGradient.type, cd, 'mgt');\n            Lib.mergeArray(markerGradient.color, cd, 'mgc');\n        }\n    }\n};\n","'use strict';\n\nvar axisHoverFormat = require('../../plots/cartesian/axis_format_attributes').axisHoverFormat;\nvar texttemplateAttrs = require('../../plots/template_attributes').texttemplateAttrs;\nvar hovertemplateAttrs = require('../../plots/template_attributes').hovertemplateAttrs;\nvar colorScaleAttrs = require('../../components/colorscale/attributes');\nvar fontAttrs = require('../../plots/font_attributes');\nvar dash = require('../../components/drawing/attributes').dash;\n\nvar Drawing = require('../../components/drawing');\nvar constants = require('./constants');\n\nvar extendFlat = require('../../lib/extend').extendFlat;\n\nfunction axisPeriod(axis) {\n    return {\n        valType: 'any',\n        dflt: 0,\n        editType: 'calc',\n        description: [\n            'Only relevant when the axis `type` is *date*.',\n            'Sets the period positioning in milliseconds or *M<n>* on the ' + axis + ' axis.',\n            'Special values in the form of *M<n>* could be used to declare',\n            'the number of months. In this case `n` must be a positive integer.'\n        ].join(' ')\n    };\n}\n\nfunction axisPeriod0(axis) {\n    return {\n        valType: 'any',\n        editType: 'calc',\n        description: [\n            'Only relevant when the axis `type` is *date*.',\n            'Sets the base for period positioning in milliseconds or date string on the ' + axis + ' axis.',\n            'When `' + axis + 'period` is round number of weeks,',\n            'the `' + axis + 'period0` by default would be on a Sunday i.e. 2000-01-02,',\n            'otherwise it would be at 2000-01-01.'\n        ].join(' ')\n    };\n}\n\nfunction axisPeriodAlignment(axis) {\n    return {\n        valType: 'enumerated',\n        values: [\n            'start', 'middle', 'end'\n        ],\n        dflt: 'middle',\n        editType: 'calc',\n        description: [\n            'Only relevant when the axis `type` is *date*.',\n            'Sets the alignment of data points on the ' + axis + ' axis.'\n        ].join(' ')\n    };\n}\n\nmodule.exports = {\n    x: {\n        valType: 'data_array',\n        editType: 'calc+clearAxisTypes',\n        anim: true,\n        description: 'Sets the x coordinates.'\n    },\n    x0: {\n        valType: 'any',\n        dflt: 0,\n        editType: 'calc+clearAxisTypes',\n        anim: true,\n        description: [\n            'Alternate to `x`.',\n            'Builds a linear space of x coordinates.',\n            'Use with `dx`',\n            'where `x0` is the starting coordinate and `dx` the step.'\n        ].join(' ')\n    },\n    dx: {\n        valType: 'number',\n        dflt: 1,\n        editType: 'calc',\n        anim: true,\n        description: [\n            'Sets the x coordinate step.',\n            'See `x0` for more info.'\n        ].join(' ')\n    },\n    y: {\n        valType: 'data_array',\n        editType: 'calc+clearAxisTypes',\n        anim: true,\n        description: 'Sets the y coordinates.'\n    },\n    y0: {\n        valType: 'any',\n        dflt: 0,\n        editType: 'calc+clearAxisTypes',\n        anim: true,\n        description: [\n            'Alternate to `y`.',\n            'Builds a linear space of y coordinates.',\n            'Use with `dy`',\n            'where `y0` is the starting coordinate and `dy` the step.'\n        ].join(' ')\n    },\n    dy: {\n        valType: 'number',\n        dflt: 1,\n        editType: 'calc',\n        anim: true,\n        description: [\n            'Sets the y coordinate step.',\n            'See `y0` for more info.'\n        ].join(' ')\n    },\n\n    xperiod: axisPeriod('x'),\n    yperiod: axisPeriod('y'),\n    xperiod0: axisPeriod0('x0'),\n    yperiod0: axisPeriod0('y0'),\n    xperiodalignment: axisPeriodAlignment('x'),\n    yperiodalignment: axisPeriodAlignment('y'),\n    xhoverformat: axisHoverFormat('x'),\n    yhoverformat: axisHoverFormat('y'),\n\n    stackgroup: {\n        valType: 'string',\n        dflt: '',\n        editType: 'calc',\n        description: [\n            'Set several scatter traces (on the same subplot) to the same',\n            'stackgroup in order to add their y values (or their x values if',\n            '`orientation` is *h*). If blank or omitted this trace will not be',\n            'stacked. Stacking also turns `fill` on by default, using *tonexty*',\n            '(*tonextx*) if `orientation` is *h* (*v*) and sets the default',\n            '`mode` to *lines* irrespective of point count.',\n            'You can only stack on a numeric (linear or log) axis.',\n            'Traces in a `stackgroup` will only fill to (or be filled to) other',\n            'traces in the same group. With multiple `stackgroup`s or some',\n            'traces stacked and some not, if fill-linked traces are not already',\n            'consecutive, the later ones will be pushed down in the drawing order.'\n        ].join(' ')\n    },\n    orientation: {\n        valType: 'enumerated',\n        values: ['v', 'h'],\n        editType: 'calc',\n        description: [\n            'Only relevant when `stackgroup` is used, and only the first',\n            '`orientation` found in the `stackgroup` will be used - including',\n            'if `visible` is *legendonly* but not if it is `false`. Sets the',\n            'stacking direction. With *v* (*h*), the y (x) values of subsequent',\n            'traces are added. Also affects the default value of `fill`.'\n        ].join(' ')\n    },\n    groupnorm: {\n        valType: 'enumerated',\n        values: ['', 'fraction', 'percent'],\n        dflt: '',\n        editType: 'calc',\n        description: [\n            'Only relevant when `stackgroup` is used, and only the first',\n            '`groupnorm` found in the `stackgroup` will be used - including',\n            'if `visible` is *legendonly* but not if it is `false`.',\n            'Sets the normalization for the sum of this `stackgroup`.',\n            'With *fraction*, the value of each trace at each location is',\n            'divided by the sum of all trace values at that location.',\n            '*percent* is the same but multiplied by 100 to show percentages.',\n            'If there are multiple subplots, or multiple `stackgroup`s on one',\n            'subplot, each will be normalized within its own set.'\n        ].join(' ')\n    },\n    stackgaps: {\n        valType: 'enumerated',\n        values: ['infer zero', 'interpolate'],\n        dflt: 'infer zero',\n        editType: 'calc',\n        description: [\n            'Only relevant when `stackgroup` is used, and only the first',\n            '`stackgaps` found in the `stackgroup` will be used - including',\n            'if `visible` is *legendonly* but not if it is `false`.',\n            'Determines how we handle locations at which other traces in this',\n            'group have data but this one does not.',\n            'With *infer zero* we insert a zero at these locations.',\n            'With *interpolate* we linearly interpolate between existing',\n            'values, and extrapolate a constant beyond the existing values.'\n            // TODO - implement interrupt mode\n            // '*interrupt* omits this trace from the stack at this location by',\n            // 'dropping abruptly, midway between the existing and missing locations.'\n        ].join(' ')\n    },\n\n    text: {\n        valType: 'string',\n        dflt: '',\n        arrayOk: true,\n        editType: 'calc',\n        description: [\n            'Sets text elements associated with each (x,y) pair.',\n            'If a single string, the same string appears over',\n            'all the data points.',\n            'If an array of string, the items are mapped in order to the',\n            'this trace\\'s (x,y) coordinates.',\n            'If trace `hoverinfo` contains a *text* flag and *hovertext* is not set,',\n            'these elements will be seen in the hover labels.'\n        ].join(' ')\n    },\n\n    texttemplate: texttemplateAttrs({}, {\n\n    }),\n    hovertext: {\n        valType: 'string',\n        dflt: '',\n        arrayOk: true,\n        editType: 'style',\n        description: [\n            'Sets hover text elements associated with each (x,y) pair.',\n            'If a single string, the same string appears over',\n            'all the data points.',\n            'If an array of string, the items are mapped in order to the',\n            'this trace\\'s (x,y) coordinates.',\n            'To be seen, trace `hoverinfo` must contain a *text* flag.'\n        ].join(' ')\n    },\n    mode: {\n        valType: 'flaglist',\n        flags: ['lines', 'markers', 'text'],\n        extras: ['none'],\n        editType: 'calc',\n        description: [\n            'Determines the drawing mode for this scatter trace.',\n            'If the provided `mode` includes *text* then the `text` elements',\n            'appear at the coordinates. Otherwise, the `text` elements',\n            'appear on hover.',\n            'If there are less than ' + constants.PTS_LINESONLY + ' points',\n            'and the trace is not stacked',\n            'then the default is *lines+markers*. Otherwise, *lines*.'\n        ].join(' ')\n    },\n    hoveron: {\n        valType: 'flaglist',\n        flags: ['points', 'fills'],\n        editType: 'style',\n        description: [\n            'Do the hover effects highlight individual points (markers or',\n            'line points) or do they highlight filled regions?',\n            'If the fill is *toself* or *tonext* and there are no markers',\n            'or text, then the default is *fills*, otherwise it is *points*.'\n        ].join(' ')\n    },\n    hovertemplate: hovertemplateAttrs({}, {\n        keys: constants.eventDataKeys\n    }),\n\n    line: {\n        color: {\n            valType: 'color',\n            editType: 'style',\n            anim: true,\n            description: 'Sets the line color.'\n        },\n        width: {\n            valType: 'number',\n            min: 0,\n            dflt: 2,\n            editType: 'style',\n            anim: true,\n            description: 'Sets the line width (in px).'\n        },\n        shape: {\n            valType: 'enumerated',\n            values: ['linear', 'spline', 'hv', 'vh', 'hvh', 'vhv'],\n            dflt: 'linear',\n            editType: 'plot',\n            description: [\n                'Determines the line shape.',\n                'With *spline* the lines are drawn using spline interpolation.',\n                'The other available values correspond to step-wise line shapes.'\n            ].join(' ')\n        },\n        smoothing: {\n            valType: 'number',\n            min: 0,\n            max: 1.3,\n            dflt: 1,\n            editType: 'plot',\n            description: [\n                'Has an effect only if `shape` is set to *spline*',\n                'Sets the amount of smoothing.',\n                '*0* corresponds to no smoothing (equivalent to a *linear* shape).'\n            ].join(' ')\n        },\n        dash: extendFlat({}, dash, {editType: 'style'}),\n        simplify: {\n            valType: 'boolean',\n            dflt: true,\n            editType: 'plot',\n            description: [\n                'Simplifies lines by removing nearly-collinear points. When transitioning',\n                'lines, it may be desirable to disable this so that the number of points',\n                'along the resulting SVG path is unaffected.'\n            ].join(' ')\n        },\n        editType: 'plot'\n    },\n\n    connectgaps: {\n        valType: 'boolean',\n        dflt: false,\n        editType: 'calc',\n        description: [\n            'Determines whether or not gaps',\n            '(i.e. {nan} or missing values)',\n            'in the provided data arrays are connected.'\n        ].join(' ')\n    },\n    cliponaxis: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'plot',\n        description: [\n            'Determines whether or not markers and text nodes',\n            'are clipped about the subplot axes.',\n            'To show markers and text nodes above axis lines and tick labels,',\n            'make sure to set `xaxis.layer` and `yaxis.layer` to *below traces*.'\n        ].join(' ')\n    },\n\n    fill: {\n        valType: 'enumerated',\n        values: ['none', 'tozeroy', 'tozerox', 'tonexty', 'tonextx', 'toself', 'tonext'],\n        editType: 'calc',\n        description: [\n            'Sets the area to fill with a solid color.',\n            'Defaults to *none* unless this trace is stacked, then it gets',\n            '*tonexty* (*tonextx*) if `orientation` is *v* (*h*)',\n            'Use with `fillcolor` if not *none*.',\n            '*tozerox* and *tozeroy* fill to x=0 and y=0 respectively.',\n            '*tonextx* and *tonexty* fill between the endpoints of this',\n            'trace and the endpoints of the trace before it, connecting those',\n            'endpoints with straight lines (to make a stacked area graph);',\n            'if there is no trace before it, they behave like *tozerox* and',\n            '*tozeroy*.',\n            '*toself* connects the endpoints of the trace (or each segment',\n            'of the trace if it has gaps) into a closed shape.',\n            '*tonext* fills the space between two traces if one completely',\n            'encloses the other (eg consecutive contour lines), and behaves like',\n            '*toself* if there is no trace before it. *tonext* should not be',\n            'used if one trace does not enclose the other.',\n            'Traces in a `stackgroup` will only fill to (or be filled to) other',\n            'traces in the same group. With multiple `stackgroup`s or some',\n            'traces stacked and some not, if fill-linked traces are not already',\n            'consecutive, the later ones will be pushed down in the drawing order.'\n        ].join(' ')\n    },\n    fillcolor: {\n        valType: 'color',\n        editType: 'style',\n        anim: true,\n        description: [\n            'Sets the fill color.',\n            'Defaults to a half-transparent variant of the line color,',\n            'marker color, or marker line color, whichever is available.'\n        ].join(' ')\n    },\n    marker: extendFlat({\n        symbol: {\n            valType: 'enumerated',\n            values: Drawing.symbolList,\n            dflt: 'circle',\n            arrayOk: true,\n            editType: 'style',\n            description: [\n                'Sets the marker symbol type.',\n                'Adding 100 is equivalent to appending *-open* to a symbol name.',\n                'Adding 200 is equivalent to appending *-dot* to a symbol name.',\n                'Adding 300 is equivalent to appending *-open-dot*',\n                'or *dot-open* to a symbol name.'\n            ].join(' ')\n        },\n        opacity: {\n            valType: 'number',\n            min: 0,\n            max: 1,\n            arrayOk: true,\n            editType: 'style',\n            anim: true,\n            description: 'Sets the marker opacity.'\n        },\n        size: {\n            valType: 'number',\n            min: 0,\n            dflt: 6,\n            arrayOk: true,\n            editType: 'calc',\n            anim: true,\n            description: 'Sets the marker size (in px).'\n        },\n        maxdisplayed: {\n            valType: 'number',\n            min: 0,\n            dflt: 0,\n            editType: 'plot',\n            description: [\n                'Sets a maximum number of points to be drawn on the graph.',\n                '*0* corresponds to no limit.'\n            ].join(' ')\n        },\n        sizeref: {\n            valType: 'number',\n            dflt: 1,\n            editType: 'calc',\n            description: [\n                'Has an effect only if `marker.size` is set to a numerical array.',\n                'Sets the scale factor used to determine the rendered size of',\n                'marker points. Use with `sizemin` and `sizemode`.'\n            ].join(' ')\n        },\n        sizemin: {\n            valType: 'number',\n            min: 0,\n            dflt: 0,\n            editType: 'calc',\n            description: [\n                'Has an effect only if `marker.size` is set to a numerical array.',\n                'Sets the minimum size (in px) of the rendered marker points.'\n            ].join(' ')\n        },\n        sizemode: {\n            valType: 'enumerated',\n            values: ['diameter', 'area'],\n            dflt: 'diameter',\n            editType: 'calc',\n            description: [\n                'Has an effect only if `marker.size` is set to a numerical array.',\n                'Sets the rule for which the data in `size` is converted',\n                'to pixels.'\n            ].join(' ')\n        },\n\n        line: extendFlat({\n            width: {\n                valType: 'number',\n                min: 0,\n                arrayOk: true,\n                editType: 'style',\n                anim: true,\n                description: 'Sets the width (in px) of the lines bounding the marker points.'\n            },\n            editType: 'calc'\n        },\n            colorScaleAttrs('marker.line', {anim: true})\n        ),\n        gradient: {\n            type: {\n                valType: 'enumerated',\n                values: ['radial', 'horizontal', 'vertical', 'none'],\n                arrayOk: true,\n                dflt: 'none',\n                editType: 'calc',\n                description: [\n                    'Sets the type of gradient used to fill the markers'\n                ].join(' ')\n            },\n            color: {\n                valType: 'color',\n                arrayOk: true,\n                editType: 'calc',\n                description: [\n                    'Sets the final color of the gradient fill:',\n                    'the center color for radial, the right for horizontal,',\n                    'or the bottom for vertical.',\n                ].join(' ')\n            },\n            editType: 'calc'\n        },\n        editType: 'calc'\n    },\n        colorScaleAttrs('marker', {anim: true})\n    ),\n    selected: {\n        marker: {\n            opacity: {\n                valType: 'number',\n                min: 0,\n                max: 1,\n                editType: 'style',\n                description: 'Sets the marker opacity of selected points.'\n            },\n            color: {\n                valType: 'color',\n                editType: 'style',\n                description: 'Sets the marker color of selected points.'\n            },\n            size: {\n                valType: 'number',\n                min: 0,\n                editType: 'style',\n                description: 'Sets the marker size of selected points.'\n            },\n            editType: 'style'\n        },\n        textfont: {\n            color: {\n                valType: 'color',\n                editType: 'style',\n                description: 'Sets the text font color of selected points.'\n            },\n            editType: 'style'\n        },\n        editType: 'style'\n    },\n    unselected: {\n        marker: {\n            opacity: {\n                valType: 'number',\n                min: 0,\n                max: 1,\n                editType: 'style',\n                description: 'Sets the marker opacity of unselected points, applied only when a selection exists.'\n            },\n            color: {\n                valType: 'color',\n                editType: 'style',\n                description: 'Sets the marker color of unselected points, applied only when a selection exists.'\n            },\n            size: {\n                valType: 'number',\n                min: 0,\n                editType: 'style',\n                description: 'Sets the marker size of unselected points, applied only when a selection exists.'\n            },\n            editType: 'style'\n        },\n        textfont: {\n            color: {\n                valType: 'color',\n                editType: 'style',\n                description: 'Sets the text font color of unselected points, applied only when a selection exists.'\n            },\n            editType: 'style'\n        },\n        editType: 'style'\n    },\n\n    textposition: {\n        valType: 'enumerated',\n        values: [\n            'top left', 'top center', 'top right',\n            'middle left', 'middle center', 'middle right',\n            'bottom left', 'bottom center', 'bottom right'\n        ],\n        dflt: 'middle center',\n        arrayOk: true,\n        editType: 'calc',\n        description: [\n            'Sets the positions of the `text` elements',\n            'with respects to the (x,y) coordinates.'\n        ].join(' ')\n    },\n    textfont: fontAttrs({\n        editType: 'calc',\n        colorEditType: 'style',\n        arrayOk: true,\n        description: 'Sets the text font.'\n    }),\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar Lib = require('../../lib');\n\nvar Axes = require('../../plots/cartesian/axes');\nvar alignPeriod = require('../../plots/cartesian/align_period');\nvar BADNUM = require('../../constants/numerical').BADNUM;\n\nvar subTypes = require('./subtypes');\nvar calcColorscale = require('./colorscale_calc');\nvar arraysToCalcdata = require('./arrays_to_calcdata');\nvar calcSelection = require('./calc_selection');\n\nfunction calc(gd, trace) {\n    var fullLayout = gd._fullLayout;\n    var xa = Axes.getFromId(gd, trace.xaxis || 'x');\n    var ya = Axes.getFromId(gd, trace.yaxis || 'y');\n    var origX = xa.makeCalcdata(trace, 'x');\n    var origY = ya.makeCalcdata(trace, 'y');\n    var x = alignPeriod(trace, xa, 'x', origX);\n    var y = alignPeriod(trace, ya, 'y', origY);\n\n    var serieslen = trace._length;\n    var cd = new Array(serieslen);\n    var ids = trace.ids;\n    var stackGroupOpts = getStackOpts(trace, fullLayout, xa, ya);\n    var interpolateGaps = false;\n    var isV, i, j, k, interpolate, vali;\n\n    setFirstScatter(fullLayout, trace);\n\n    var xAttr = 'x';\n    var yAttr = 'y';\n    var posAttr;\n    if(stackGroupOpts) {\n        Lib.pushUnique(stackGroupOpts.traceIndices, trace._expandedIndex);\n        isV = stackGroupOpts.orientation === 'v';\n\n        // size, like we use for bar\n        if(isV) {\n            yAttr = 's';\n            posAttr = 'x';\n        } else {\n            xAttr = 's';\n            posAttr = 'y';\n        }\n        interpolate = stackGroupOpts.stackgaps === 'interpolate';\n    } else {\n        var ppad = calcMarkerSize(trace, serieslen);\n        calcAxisExpansion(gd, trace, xa, ya, x, y, ppad);\n    }\n\n    var hasPeriodX = !!trace.xperiodalignment;\n    var hasPeriodY = !!trace.yperiodalignment;\n\n    for(i = 0; i < serieslen; i++) {\n        var cdi = cd[i] = {};\n        var xValid = isNumeric(x[i]);\n        var yValid = isNumeric(y[i]);\n        if(xValid && yValid) {\n            cdi[xAttr] = x[i];\n            cdi[yAttr] = y[i];\n\n            if(hasPeriodX) {\n                cdi.orig_x = origX[i]; // used by hover\n            }\n            if(hasPeriodY) {\n                cdi.orig_y = origY[i]; // used by hover\n            }\n        } else if(stackGroupOpts && (isV ? xValid : yValid)) {\n            // if we're stacking we need to hold on to all valid positions\n            // even with invalid sizes\n\n            cdi[posAttr] = isV ? x[i] : y[i];\n            cdi.gap = true;\n            if(interpolate) {\n                cdi.s = BADNUM;\n                interpolateGaps = true;\n            } else {\n                cdi.s = 0;\n            }\n        } else {\n            cdi[xAttr] = cdi[yAttr] = BADNUM;\n        }\n\n        if(ids) {\n            cdi.id = String(ids[i]);\n        }\n    }\n\n    arraysToCalcdata(cd, trace);\n    calcColorscale(gd, trace);\n    calcSelection(cd, trace);\n\n    if(stackGroupOpts) {\n        // remove bad positions and sort\n        // note that original indices get added to cd in arraysToCalcdata\n        i = 0;\n        while(i < cd.length) {\n            if(cd[i][posAttr] === BADNUM) {\n                cd.splice(i, 1);\n            } else i++;\n        }\n\n        Lib.sort(cd, function(a, b) {\n            return (a[posAttr] - b[posAttr]) || (a.i - b.i);\n        });\n\n        if(interpolateGaps) {\n            // first fill the beginning with constant from the first point\n            i = 0;\n            while(i < cd.length - 1 && cd[i].gap) {\n                i++;\n            }\n            vali = cd[i].s;\n            if(!vali) vali = cd[i].s = 0; // in case of no data AT ALL in this trace - use 0\n            for(j = 0; j < i; j++) {\n                cd[j].s = vali;\n            }\n            // then fill the end with constant from the last point\n            k = cd.length - 1;\n            while(k > i && cd[k].gap) {\n                k--;\n            }\n            vali = cd[k].s;\n            for(j = cd.length - 1; j > k; j--) {\n                cd[j].s = vali;\n            }\n            // now interpolate internal gaps linearly\n            while(i < k) {\n                i++;\n                if(cd[i].gap) {\n                    j = i + 1;\n                    while(cd[j].gap) {\n                        j++;\n                    }\n                    var pos0 = cd[i - 1][posAttr];\n                    var size0 = cd[i - 1].s;\n                    var m = (cd[j].s - size0) / (cd[j][posAttr] - pos0);\n                    while(i < j) {\n                        cd[i].s = size0 + (cd[i][posAttr] - pos0) * m;\n                        i++;\n                    }\n                }\n            }\n        }\n    }\n\n    return cd;\n}\n\nfunction calcAxisExpansion(gd, trace, xa, ya, x, y, ppad) {\n    var serieslen = trace._length;\n    var fullLayout = gd._fullLayout;\n    var xId = xa._id;\n    var yId = ya._id;\n    var firstScatter = fullLayout._firstScatter[firstScatterGroup(trace)] === trace.uid;\n    var stackOrientation = (getStackOpts(trace, fullLayout, xa, ya) || {}).orientation;\n    var fill = trace.fill;\n\n    // cancel minimum tick spacings (only applies to bars and boxes)\n    xa._minDtick = 0;\n    ya._minDtick = 0;\n\n    // check whether bounds should be tight, padded, extended to zero...\n    // most cases both should be padded on both ends, so start with that.\n    var xOptions = {padded: true};\n    var yOptions = {padded: true};\n\n    if(ppad) {\n        xOptions.ppad = yOptions.ppad = ppad;\n    }\n\n    // TODO: text size\n\n    var openEnded = serieslen < 2 || (x[0] !== x[serieslen - 1]) || (y[0] !== y[serieslen - 1]);\n\n    if(openEnded && (\n        (fill === 'tozerox') ||\n        ((fill === 'tonextx') && (firstScatter || stackOrientation === 'h'))\n    )) {\n        // include zero (tight) and extremes (padded) if fill to zero\n        // (unless the shape is closed, then it's just filling the shape regardless)\n\n        xOptions.tozero = true;\n    } else if(!(trace.error_y || {}).visible && (\n        // if no error bars, markers or text, or fill to y=0 remove x padding\n\n            (fill === 'tonexty' || fill === 'tozeroy') ||\n            (!subTypes.hasMarkers(trace) && !subTypes.hasText(trace))\n        )) {\n        xOptions.padded = false;\n        xOptions.ppad = 0;\n    }\n\n    if(openEnded && (\n        (fill === 'tozeroy') ||\n        ((fill === 'tonexty') && (firstScatter || stackOrientation === 'v'))\n    )) {\n        // now check for y - rather different logic, though still mostly padded both ends\n        // include zero (tight) and extremes (padded) if fill to zero\n        // (unless the shape is closed, then it's just filling the shape regardless)\n\n        yOptions.tozero = true;\n    } else if(fill === 'tonextx' || fill === 'tozerox') {\n        // tight y: any x fill\n\n        yOptions.padded = false;\n    }\n\n    // N.B. asymmetric splom traces call this with blank {} xa or ya\n    if(xId) trace._extremes[xId] = Axes.findExtremes(xa, x, xOptions);\n    if(yId) trace._extremes[yId] = Axes.findExtremes(ya, y, yOptions);\n}\n\nfunction calcMarkerSize(trace, serieslen) {\n    if(!subTypes.hasMarkers(trace)) return;\n\n    // Treat size like x or y arrays --- Run d2c\n    // this needs to go before ppad computation\n    var marker = trace.marker;\n    var sizeref = 1.6 * (trace.marker.sizeref || 1);\n    var markerTrans;\n\n    if(trace.marker.sizemode === 'area') {\n        markerTrans = function(v) {\n            return Math.max(Math.sqrt((v || 0) / sizeref), 3);\n        };\n    } else {\n        markerTrans = function(v) {\n            return Math.max((v || 0) / sizeref, 3);\n        };\n    }\n\n    if(Lib.isArrayOrTypedArray(marker.size)) {\n        // I tried auto-type but category and dates dont make much sense.\n        var ax = {type: 'linear'};\n        Axes.setConvert(ax);\n\n        var s = ax.makeCalcdata(trace.marker, 'size');\n\n        var sizeOut = new Array(serieslen);\n        for(var i = 0; i < serieslen; i++) {\n            sizeOut[i] = markerTrans(s[i]);\n        }\n        return sizeOut;\n    } else {\n        return markerTrans(marker.size);\n    }\n}\n\n/**\n * mark the first scatter trace for each subplot\n * note that scatter and scattergl each get their own first trace\n * note also that I'm doing this during calc rather than supplyDefaults\n * so I don't need to worry about transforms, but if we ever do\n * per-trace calc this will get confused.\n */\nfunction setFirstScatter(fullLayout, trace) {\n    var group = firstScatterGroup(trace);\n    var firstScatter = fullLayout._firstScatter;\n    if(!firstScatter[group]) firstScatter[group] = trace.uid;\n}\n\nfunction firstScatterGroup(trace) {\n    var stackGroup = trace.stackgroup;\n    return trace.xaxis + trace.yaxis + trace.type +\n        (stackGroup ? '-' + stackGroup : '');\n}\n\nfunction getStackOpts(trace, fullLayout, xa, ya) {\n    var stackGroup = trace.stackgroup;\n    if(!stackGroup) return;\n    var stackOpts = fullLayout._scatterStackOpts[xa._id + ya._id][stackGroup];\n    var stackAx = stackOpts.orientation === 'v' ? ya : xa;\n    // Allow stacking only on numeric axes\n    // calc is a little late to be figuring this out, but during supplyDefaults\n    // we don't know the axis type yet\n    if(stackAx.type === 'linear' || stackAx.type === 'log') return stackOpts;\n}\n\nmodule.exports = {\n    calc: calc,\n    calcMarkerSize: calcMarkerSize,\n    calcAxisExpansion: calcAxisExpansion,\n    setFirstScatter: setFirstScatter,\n    getStackOpts: getStackOpts\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\nmodule.exports = function calcSelection(cd, trace) {\n    if(Lib.isArrayOrTypedArray(trace.selectedpoints)) {\n        Lib.tagSelected(cd, trace);\n    }\n};\n","'use strict';\n\nvar hasColorscale = require('../../components/colorscale/helpers').hasColorscale;\nvar calcColorscale = require('../../components/colorscale/calc');\n\nvar subTypes = require('./subtypes');\n\nmodule.exports = function calcMarkerColorscale(gd, trace) {\n    if(subTypes.hasLines(trace) && hasColorscale(trace, 'line')) {\n        calcColorscale(gd, trace, {\n            vals: trace.line.color,\n            containerStr: 'line',\n            cLetter: 'c'\n        });\n    }\n\n    if(subTypes.hasMarkers(trace)) {\n        if(hasColorscale(trace, 'marker')) {\n            calcColorscale(gd, trace, {\n                vals: trace.marker.color,\n                containerStr: 'marker',\n                cLetter: 'c'\n            });\n        }\n        if(hasColorscale(trace, 'marker.line')) {\n            calcColorscale(gd, trace, {\n                vals: trace.marker.line.color,\n                containerStr: 'marker.line',\n                cLetter: 'c'\n            });\n        }\n    }\n};\n","'use strict';\n\nmodule.exports = {\n    PTS_LINESONLY: 20,\n\n    // fixed parameters of clustering and clipping algorithms\n\n    // fraction of clustering tolerance \"so close we don't even consider it a new point\"\n    minTolerance: 0.2,\n    // how fast does clustering tolerance increase as you get away from the visible region\n    toleranceGrowth: 10,\n\n    // number of viewport sizes away from the visible region\n    // at which we clip all lines to the perimeter\n    maxScreensAway: 20,\n\n    eventDataKeys: []\n};\n","'use strict';\n\nvar calc = require('./calc');\n\n/*\n * Scatter stacking & normalization calculations\n * runs per subplot, and can handle multiple stacking groups\n */\n\nmodule.exports = function crossTraceCalc(gd, plotinfo) {\n    var xa = plotinfo.xaxis;\n    var ya = plotinfo.yaxis;\n    var subplot = xa._id + ya._id;\n\n    var subplotStackOpts = gd._fullLayout._scatterStackOpts[subplot];\n    if(!subplotStackOpts) return;\n\n    var calcTraces = gd.calcdata;\n\n    var i, j, k, i2, cd, cd0, posj, sumj, norm;\n    var groupOpts, interpolate, groupnorm, posAttr, valAttr;\n    var hasAnyBlanks;\n\n    for(var stackGroup in subplotStackOpts) {\n        groupOpts = subplotStackOpts[stackGroup];\n        var indices = groupOpts.traceIndices;\n\n        // can get here with no indices if the stack axis is non-numeric\n        if(!indices.length) continue;\n\n        interpolate = groupOpts.stackgaps === 'interpolate';\n        groupnorm = groupOpts.groupnorm;\n        if(groupOpts.orientation === 'v') {\n            posAttr = 'x';\n            valAttr = 'y';\n        } else {\n            posAttr = 'y';\n            valAttr = 'x';\n        }\n        hasAnyBlanks = new Array(indices.length);\n        for(i = 0; i < hasAnyBlanks.length; i++) {\n            hasAnyBlanks[i] = false;\n        }\n\n        // Collect the complete set of all positions across ALL traces.\n        // Start with the first trace, then interleave items from later traces\n        // as needed.\n        // Fill in mising items as we go.\n        cd0 = calcTraces[indices[0]];\n        var allPositions = new Array(cd0.length);\n        for(i = 0; i < cd0.length; i++) {\n            allPositions[i] = cd0[i][posAttr];\n        }\n\n        for(i = 1; i < indices.length; i++) {\n            cd = calcTraces[indices[i]];\n\n            for(j = k = 0; j < cd.length; j++) {\n                posj = cd[j][posAttr];\n                for(; posj > allPositions[k] && k < allPositions.length; k++) {\n                    // the current trace is missing a position from some previous trace(s)\n                    insertBlank(cd, j, allPositions[k], i, hasAnyBlanks, interpolate, posAttr);\n                    j++;\n                }\n                if(posj !== allPositions[k]) {\n                    // previous trace(s) are missing a position from the current trace\n                    for(i2 = 0; i2 < i; i2++) {\n                        insertBlank(calcTraces[indices[i2]], k, posj, i2, hasAnyBlanks, interpolate, posAttr);\n                    }\n                    allPositions.splice(k, 0, posj);\n                }\n                k++;\n            }\n            for(; k < allPositions.length; k++) {\n                insertBlank(cd, j, allPositions[k], i, hasAnyBlanks, interpolate, posAttr);\n                j++;\n            }\n        }\n\n        var serieslen = allPositions.length;\n\n        // stack (and normalize)!\n        for(j = 0; j < cd0.length; j++) {\n            sumj = cd0[j][valAttr] = cd0[j].s;\n            for(i = 1; i < indices.length; i++) {\n                cd = calcTraces[indices[i]];\n                cd[0].trace._rawLength = cd[0].trace._length;\n                cd[0].trace._length = serieslen;\n                sumj += cd[j].s;\n                cd[j][valAttr] = sumj;\n            }\n\n            if(groupnorm) {\n                norm = ((groupnorm === 'fraction') ? sumj : (sumj / 100)) || 1;\n                for(i = 0; i < indices.length; i++) {\n                    var cdj = calcTraces[indices[i]][j];\n                    cdj[valAttr] /= norm;\n                    cdj.sNorm = cdj.s / norm;\n                }\n            }\n        }\n\n        // autorange\n        for(i = 0; i < indices.length; i++) {\n            cd = calcTraces[indices[i]];\n            var trace = cd[0].trace;\n            var ppad = calc.calcMarkerSize(trace, trace._rawLength);\n            var arrayPad = Array.isArray(ppad);\n            if((ppad && hasAnyBlanks[i]) || arrayPad) {\n                var ppadRaw = ppad;\n                ppad = new Array(serieslen);\n                for(j = 0; j < serieslen; j++) {\n                    ppad[j] = cd[j].gap ? 0 : (arrayPad ? ppadRaw[cd[j].i] : ppadRaw);\n                }\n            }\n            var x = new Array(serieslen);\n            var y = new Array(serieslen);\n            for(j = 0; j < serieslen; j++) {\n                x[j] = cd[j].x;\n                y[j] = cd[j].y;\n            }\n            calc.calcAxisExpansion(gd, trace, xa, ya, x, y, ppad);\n\n            // while we're here (in a loop over all traces in the stack)\n            // record the orientation, so hover can find it easily\n            cd[0].t.orientation = groupOpts.orientation;\n        }\n    }\n};\n\nfunction insertBlank(calcTrace, index, position, traceIndex, hasAnyBlanks, interpolate, posAttr) {\n    hasAnyBlanks[traceIndex] = true;\n    var newEntry = {\n        i: null,\n        gap: true,\n        s: 0\n    };\n    newEntry[posAttr] = position;\n    calcTrace.splice(index, 0, newEntry);\n    // Even if we're not interpolating, if one trace has multiple\n    // values at the same position and this trace only has one value there,\n    // we just duplicate that one value rather than insert a zero.\n    // We also make it look like a real point - because it's ambiguous which\n    // one really is the real one!\n    if(index && position === calcTrace[index - 1][posAttr]) {\n        var prevEntry = calcTrace[index - 1];\n        newEntry.s = prevEntry.s;\n        // TODO is it going to cause any problems to have multiple\n        // calcdata points with the same index?\n        newEntry.i = prevEntry.i;\n        newEntry.gap = prevEntry.gap;\n    } else if(interpolate) {\n        newEntry.s = getInterp(calcTrace, index, position, posAttr);\n    }\n    if(!index) {\n        // t and trace need to stay on the first cd entry\n        calcTrace[0].t = calcTrace[1].t;\n        calcTrace[0].trace = calcTrace[1].trace;\n        delete calcTrace[1].t;\n        delete calcTrace[1].trace;\n    }\n}\n\nfunction getInterp(calcTrace, index, position, posAttr) {\n    var pt0 = calcTrace[index - 1];\n    var pt1 = calcTrace[index + 1];\n    if(!pt1) return pt0.s;\n    if(!pt0) return pt1.s;\n    return pt0.s + (pt1.s - pt0.s) * (position - pt0[posAttr]) / (pt1[posAttr] - pt0[posAttr]);\n}\n","'use strict';\n\n\n// remove opacity for any trace that has a fill or is filled to\nmodule.exports = function crossTraceDefaults(fullData) {\n    for(var i = 0; i < fullData.length; i++) {\n        var tracei = fullData[i];\n        if(tracei.type !== 'scatter') continue;\n\n        var filli = tracei.fill;\n        if(filli === 'none' || filli === 'toself') continue;\n\n        tracei.opacity = undefined;\n\n        if(filli === 'tonexty' || filli === 'tonextx') {\n            for(var j = i - 1; j >= 0; j--) {\n                var tracej = fullData[j];\n\n                if((tracej.type === 'scatter') &&\n                        (tracej.xaxis === tracei.xaxis) &&\n                        (tracej.yaxis === tracei.yaxis)) {\n                    tracej.opacity = undefined;\n                    break;\n                }\n            }\n        }\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Registry = require('../../registry');\n\nvar attributes = require('./attributes');\nvar constants = require('./constants');\nvar subTypes = require('./subtypes');\nvar handleXYDefaults = require('./xy_defaults');\nvar handlePeriodDefaults = require('./period_defaults');\nvar handleStackDefaults = require('./stack_defaults');\nvar handleMarkerDefaults = require('./marker_defaults');\nvar handleLineDefaults = require('./line_defaults');\nvar handleLineShapeDefaults = require('./line_shape_defaults');\nvar handleTextDefaults = require('./text_defaults');\nvar handleFillColorDefaults = require('./fillcolor_defaults');\n\nmodule.exports = function supplyDefaults(traceIn, traceOut, defaultColor, layout) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(traceIn, traceOut, attributes, attr, dflt);\n    }\n\n    var len = handleXYDefaults(traceIn, traceOut, layout, coerce);\n    if(!len) traceOut.visible = false;\n\n    if(!traceOut.visible) return;\n\n    handlePeriodDefaults(traceIn, traceOut, layout, coerce);\n    coerce('xhoverformat');\n    coerce('yhoverformat');\n\n    var stackGroupOpts = handleStackDefaults(traceIn, traceOut, layout, coerce);\n\n    var defaultMode = !stackGroupOpts && (len < constants.PTS_LINESONLY) ?\n        'lines+markers' : 'lines';\n    coerce('text');\n    coerce('hovertext');\n    coerce('mode', defaultMode);\n\n    if(subTypes.hasLines(traceOut)) {\n        handleLineDefaults(traceIn, traceOut, defaultColor, layout, coerce);\n        handleLineShapeDefaults(traceIn, traceOut, coerce);\n        coerce('connectgaps');\n        coerce('line.simplify');\n    }\n\n    if(subTypes.hasMarkers(traceOut)) {\n        handleMarkerDefaults(traceIn, traceOut, defaultColor, layout, coerce, {gradient: true});\n    }\n\n    if(subTypes.hasText(traceOut)) {\n        coerce('texttemplate');\n        handleTextDefaults(traceIn, traceOut, layout, coerce);\n    }\n\n    var dfltHoverOn = [];\n\n    if(subTypes.hasMarkers(traceOut) || subTypes.hasText(traceOut)) {\n        coerce('cliponaxis');\n        coerce('marker.maxdisplayed');\n        dfltHoverOn.push('points');\n    }\n\n    // It's possible for this default to be changed by a later trace.\n    // We handle that case in some hacky code inside handleStackDefaults.\n    coerce('fill', stackGroupOpts ? stackGroupOpts.fillDflt : 'none');\n    if(traceOut.fill !== 'none') {\n        handleFillColorDefaults(traceIn, traceOut, defaultColor, coerce);\n        if(!subTypes.hasLines(traceOut)) handleLineShapeDefaults(traceIn, traceOut, coerce);\n    }\n\n    var lineColor = (traceOut.line || {}).color;\n    var markerColor = (traceOut.marker || {}).color;\n\n    if(traceOut.fill === 'tonext' || traceOut.fill === 'toself') {\n        dfltHoverOn.push('fills');\n    }\n    coerce('hoveron', dfltHoverOn.join('+') || 'points');\n    if(traceOut.hoveron !== 'fills') coerce('hovertemplate');\n    var errorBarsSupplyDefaults = Registry.getComponentMethod('errorbars', 'supplyDefaults');\n    errorBarsSupplyDefaults(traceIn, traceOut, lineColor || markerColor || defaultColor, {axis: 'y'});\n    errorBarsSupplyDefaults(traceIn, traceOut, lineColor || markerColor || defaultColor, {axis: 'x', inherit: 'y'});\n\n    Lib.coerceSelectionMarkerOpacity(traceOut, coerce);\n};\n","'use strict';\n\nvar Color = require('../../components/color');\nvar isArrayOrTypedArray = require('../../lib').isArrayOrTypedArray;\n\nmodule.exports = function fillColorDefaults(traceIn, traceOut, defaultColor, coerce) {\n    var inheritColorFromMarker = false;\n\n    if(traceOut.marker) {\n        // don't try to inherit a color array\n        var markerColor = traceOut.marker.color;\n        var markerLineColor = (traceOut.marker.line || {}).color;\n\n        if(markerColor && !isArrayOrTypedArray(markerColor)) {\n            inheritColorFromMarker = markerColor;\n        } else if(markerLineColor && !isArrayOrTypedArray(markerLineColor)) {\n            inheritColorFromMarker = markerLineColor;\n        }\n    }\n\n    coerce('fillcolor', Color.addOpacity(\n        (traceOut.line || {}).color ||\n        inheritColorFromMarker ||\n        defaultColor, 0.5\n    ));\n};\n","'use strict';\n\nvar Axes = require('../../plots/cartesian/axes');\n\nmodule.exports = function formatLabels(cdi, trace, fullLayout) {\n    var labels = {};\n\n    var mockGd = {_fullLayout: fullLayout};\n    var xa = Axes.getFromTrace(mockGd, trace, 'x');\n    var ya = Axes.getFromTrace(mockGd, trace, 'y');\n\n    labels.xLabel = Axes.tickText(xa, xa.c2l(cdi.x), true).text;\n    labels.yLabel = Axes.tickText(ya, ya.c2l(cdi.y), true).text;\n\n    return labels;\n};\n","'use strict';\n\nvar Color = require('../../components/color');\nvar subtypes = require('./subtypes');\n\n\nmodule.exports = function getTraceColor(trace, di) {\n    var lc, tc;\n\n    // TODO: text modes\n\n    if(trace.mode === 'lines') {\n        lc = trace.line.color;\n        return (lc && Color.opacity(lc)) ?\n            lc : trace.fillcolor;\n    } else if(trace.mode === 'none') {\n        return trace.fill ? trace.fillcolor : '';\n    } else {\n        var mc = di.mcc || (trace.marker || {}).color;\n        var mlc = di.mlcc || ((trace.marker || {}).line || {}).color;\n\n        tc = (mc && Color.opacity(mc)) ? mc :\n            (mlc && Color.opacity(mlc) &&\n                (di.mlw || ((trace.marker || {}).line || {}).width)) ? mlc : '';\n\n        if(tc) {\n            // make sure the points aren't TOO transparent\n            if(Color.opacity(tc) < 0.3) {\n                return Color.addOpacity(tc, 0.3);\n            } else return tc;\n        } else {\n            lc = (trace.line || {}).color;\n            return (lc && Color.opacity(lc) &&\n                subtypes.hasLines(trace) && trace.line.width) ?\n                    lc : trace.fillcolor;\n        }\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Fx = require('../../components/fx');\nvar Registry = require('../../registry');\nvar getTraceColor = require('./get_trace_color');\nvar Color = require('../../components/color');\nvar fillText = Lib.fillText;\n\nmodule.exports = function hoverPoints(pointData, xval, yval, hovermode) {\n    var cd = pointData.cd;\n    var trace = cd[0].trace;\n    var xa = pointData.xa;\n    var ya = pointData.ya;\n    var xpx = xa.c2p(xval);\n    var ypx = ya.c2p(yval);\n    var pt = [xpx, ypx];\n    var hoveron = trace.hoveron || '';\n    var minRad = (trace.mode.indexOf('markers') !== -1) ? 3 : 0.5;\n\n    // look for points to hover on first, then take fills only if we\n    // didn't find a point\n    if(hoveron.indexOf('points') !== -1) {\n        var dx = function(di) {\n            // dx and dy are used in compare modes - here we want to always\n            // prioritize the closest data point, at least as long as markers are\n            // the same size or nonexistent, but still try to prioritize small markers too.\n            var rad = Math.max(3, di.mrc || 0);\n            var kink = 1 - 1 / rad;\n            var dxRaw = Math.abs(xa.c2p(di.x) - xpx);\n            if(di.orig_x !== undefined) dxRaw += xa.c2p(di.orig_x) - xa.c2p(di.x);\n            return (dxRaw < rad) ? (kink * dxRaw / rad) : (dxRaw - rad + kink);\n        };\n        var dy = function(di) {\n            var rad = Math.max(3, di.mrc || 0);\n            var kink = 1 - 1 / rad;\n            var dyRaw = Math.abs(ya.c2p(di.y) - ypx);\n            if(di.orig_y !== undefined) dyRaw += ya.c2p(di.orig_y) - ya.c2p(di.y);\n            return (dyRaw < rad) ? (kink * dyRaw / rad) : (dyRaw - rad + kink);\n        };\n        var dxy = function(di) {\n            // scatter points: d.mrc is the calculated marker radius\n            // adjust the distance so if you're inside the marker it\n            // always will show up regardless of point size, but\n            // prioritize smaller points\n            var rad = Math.max(minRad, di.mrc || 0);\n            var dx = xa.c2p(di.x) - xpx;\n            var dy = ya.c2p(di.y) - ypx;\n            return Math.max(Math.sqrt(dx * dx + dy * dy) - rad, 1 - minRad / rad);\n        };\n        var distfn = Fx.getDistanceFunction(hovermode, dx, dy, dxy);\n\n        Fx.getClosest(cd, distfn, pointData);\n\n        // skip the rest (for this trace) if we didn't find a close point\n        if(pointData.index !== false) {\n            // the closest data point\n            var di = cd[pointData.index];\n            var xc = xa.c2p(di.x, true);\n            var yc = ya.c2p(di.y, true);\n            var rad = di.mrc || 1;\n\n            // now we're done using the whole `calcdata` array, replace the\n            // index with the original index (in case of inserted point from\n            // stacked area)\n            pointData.index = di.i;\n\n            var orientation = cd[0].t.orientation;\n            // TODO: for scatter and bar, option to show (sub)totals and\n            // raw data? Currently stacked and/or normalized bars just show\n            // the normalized individual sizes, so that's what I'm doing here\n            // for now.\n            var sizeVal = orientation && (di.sNorm || di.s);\n            var xLabelVal = (orientation === 'h') ? sizeVal : di.orig_x !== undefined ? di.orig_x : di.x;\n            var yLabelVal = (orientation === 'v') ? sizeVal : di.orig_y !== undefined ? di.orig_y : di.y;\n\n            Lib.extendFlat(pointData, {\n                color: getTraceColor(trace, di),\n\n                x0: xc - rad,\n                x1: xc + rad,\n                xLabelVal: xLabelVal,\n\n                y0: yc - rad,\n                y1: yc + rad,\n                yLabelVal: yLabelVal,\n\n                spikeDistance: dxy(di),\n                hovertemplate: trace.hovertemplate\n            });\n\n            fillText(di, trace, pointData);\n            Registry.getComponentMethod('errorbars', 'hoverInfo')(di, trace, pointData);\n\n            return [pointData];\n        }\n    }\n\n    // even if hoveron is 'fills', only use it if we have polygons too\n    if(hoveron.indexOf('fills') !== -1 && trace._polygons) {\n        var polygons = trace._polygons;\n        var polygonsIn = [];\n        var inside = false;\n        var xmin = Infinity;\n        var xmax = -Infinity;\n        var ymin = Infinity;\n        var ymax = -Infinity;\n\n        var i, j, polygon, pts, xCross, x0, x1, y0, y1;\n\n        for(i = 0; i < polygons.length; i++) {\n            polygon = polygons[i];\n            // TODO: this is not going to work right for curved edges, it will\n            // act as though they're straight. That's probably going to need\n            // the elements themselves to capture the events. Worth it?\n            if(polygon.contains(pt)) {\n                inside = !inside;\n                // TODO: need better than just the overall bounding box\n                polygonsIn.push(polygon);\n                ymin = Math.min(ymin, polygon.ymin);\n                ymax = Math.max(ymax, polygon.ymax);\n            }\n        }\n\n        if(inside) {\n            // constrain ymin/max to the visible plot, so the label goes\n            // at the middle of the piece you can see\n            ymin = Math.max(ymin, 0);\n            ymax = Math.min(ymax, ya._length);\n\n            // find the overall left-most and right-most points of the\n            // polygon(s) we're inside at their combined vertical midpoint.\n            // This is where we will draw the hover label.\n            // Note that this might not be the vertical midpoint of the\n            // whole trace, if it's disjoint.\n            var yAvg = (ymin + ymax) / 2;\n            for(i = 0; i < polygonsIn.length; i++) {\n                pts = polygonsIn[i].pts;\n                for(j = 1; j < pts.length; j++) {\n                    y0 = pts[j - 1][1];\n                    y1 = pts[j][1];\n                    if((y0 > yAvg) !== (y1 >= yAvg)) {\n                        x0 = pts[j - 1][0];\n                        x1 = pts[j][0];\n                        if(y1 - y0) {\n                            xCross = x0 + (x1 - x0) * (yAvg - y0) / (y1 - y0);\n                            xmin = Math.min(xmin, xCross);\n                            xmax = Math.max(xmax, xCross);\n                        }\n                    }\n                }\n            }\n\n            // constrain xmin/max to the visible plot now too\n            xmin = Math.max(xmin, 0);\n            xmax = Math.min(xmax, xa._length);\n\n            // get only fill or line color for the hover color\n            var color = Color.defaultLine;\n            if(Color.opacity(trace.fillcolor)) color = trace.fillcolor;\n            else if(Color.opacity((trace.line || {}).color)) {\n                color = trace.line.color;\n            }\n\n            Lib.extendFlat(pointData, {\n                // never let a 2D override 1D type as closest point\n                // also: no spikeDistance, it's not allowed for fills\n                distance: pointData.maxHoverDistance,\n                x0: xmin,\n                x1: xmax,\n                y0: yAvg,\n                y1: yAvg,\n                color: color,\n                hovertemplate: false\n            });\n\n            delete pointData.index;\n\n            if(trace.text && !Array.isArray(trace.text)) {\n                pointData.text = String(trace.text);\n            } else pointData.text = trace.name;\n\n            return [pointData];\n        }\n    }\n};\n","'use strict';\n\nvar subtypes = require('./subtypes');\n\nmodule.exports = {\n    hasLines: subtypes.hasLines,\n    hasMarkers: subtypes.hasMarkers,\n    hasText: subtypes.hasText,\n    isBubble: subtypes.isBubble,\n\n    attributes: require('./attributes'),\n    supplyDefaults: require('./defaults'),\n    crossTraceDefaults: require('./cross_trace_defaults'),\n    calc: require('./calc').calc,\n    crossTraceCalc: require('./cross_trace_calc'),\n    arraysToCalcdata: require('./arrays_to_calcdata'),\n    plot: require('./plot'),\n    colorbar: require('./marker_colorbar'),\n    formatLabels: require('./format_labels'),\n    style: require('./style').style,\n    styleOnSelect: require('./style').styleOnSelect,\n    hoverPoints: require('./hover'),\n    selectPoints: require('./select'),\n    animatable: true,\n\n    moduleType: 'trace',\n    name: 'scatter',\n    basePlotModule: require('../../plots/cartesian'),\n    categories: [\n        'cartesian', 'svg', 'symbols', 'errorBarsOK', 'showLegend', 'scatter-like',\n        'zoomScale'\n    ],\n    meta: {\n        description: [\n            'The scatter trace type encompasses line charts, scatter charts, text charts, and bubble charts.',\n            'The data visualized as scatter point or lines is set in `x` and `y`.',\n            'Text (appearing either on the chart or on hover only) is via `text`.',\n            'Bubble charts are achieved by setting `marker.size` and/or `marker.color`',\n            'to numerical arrays.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar isArrayOrTypedArray = require('../../lib').isArrayOrTypedArray;\nvar hasColorscale = require('../../components/colorscale/helpers').hasColorscale;\nvar colorscaleDefaults = require('../../components/colorscale/defaults');\n\nmodule.exports = function lineDefaults(traceIn, traceOut, defaultColor, layout, coerce, opts) {\n    var markerColor = (traceIn.marker || {}).color;\n\n    coerce('line.color', defaultColor);\n\n    if(hasColorscale(traceIn, 'line')) {\n        colorscaleDefaults(traceIn, traceOut, layout, coerce, {prefix: 'line.', cLetter: 'c'});\n    } else {\n        var lineColorDflt = (isArrayOrTypedArray(markerColor) ? false : markerColor) || defaultColor;\n        coerce('line.color', lineColorDflt);\n    }\n\n    coerce('line.width');\n    if(!(opts || {}).noDash) coerce('line.dash');\n};\n","'use strict';\n\nvar numConstants = require('../../constants/numerical');\nvar BADNUM = numConstants.BADNUM;\nvar LOG_CLIP = numConstants.LOG_CLIP;\nvar LOG_CLIP_PLUS = LOG_CLIP + 0.5;\nvar LOG_CLIP_MINUS = LOG_CLIP - 0.5;\nvar Lib = require('../../lib');\nvar segmentsIntersect = Lib.segmentsIntersect;\nvar constrain = Lib.constrain;\nvar constants = require('./constants');\n\n\nmodule.exports = function linePoints(d, opts) {\n    var xa = opts.xaxis;\n    var ya = opts.yaxis;\n    var xLog = xa.type === 'log';\n    var yLog = ya.type === 'log';\n    var xLen = xa._length;\n    var yLen = ya._length;\n    var connectGaps = opts.connectGaps;\n    var baseTolerance = opts.baseTolerance;\n    var shape = opts.shape;\n    var linear = shape === 'linear';\n    var fill = opts.fill && opts.fill !== 'none';\n    var segments = [];\n    var minTolerance = constants.minTolerance;\n    var len = d.length;\n    var pts = new Array(len);\n    var pti = 0;\n\n    var i;\n\n    // pt variables are pixel coordinates [x,y] of one point\n    // these four are the outputs of clustering on a line\n    var clusterStartPt, clusterEndPt, clusterHighPt, clusterLowPt;\n\n    // \"this\" is the next point we're considering adding to the cluster\n    var thisPt;\n\n    // did we encounter the high point first, then a low point, or vice versa?\n    var clusterHighFirst;\n\n    // the first two points in the cluster determine its unit vector\n    // so the second is always in the \"High\" direction\n    var clusterUnitVector;\n\n    // the pixel delta from clusterStartPt\n    var thisVector;\n\n    // val variables are (signed) pixel distances along the cluster vector\n    var clusterRefDist, clusterHighVal, clusterLowVal, thisVal;\n\n    // deviation variables are (signed) pixel distances normal to the cluster vector\n    var clusterMinDeviation, clusterMaxDeviation, thisDeviation;\n\n    // turn one calcdata point into pixel coordinates\n    function getPt(index) {\n        var di = d[index];\n        if(!di) return false;\n        var x = opts.linearized ? xa.l2p(di.x) : xa.c2p(di.x);\n        var y = opts.linearized ? ya.l2p(di.y) : ya.c2p(di.y);\n\n        // if non-positive log values, set them VERY far off-screen\n        // so the line looks essentially straight from the previous point.\n        if(x === BADNUM) {\n            if(xLog) x = xa.c2p(di.x, true);\n            if(x === BADNUM) return false;\n            // If BOTH were bad log values, make the line follow a constant\n            // exponent rather than a constant slope\n            if(yLog && y === BADNUM) {\n                x *= Math.abs(xa._m * yLen * (xa._m > 0 ? LOG_CLIP_PLUS : LOG_CLIP_MINUS) /\n                    (ya._m * xLen * (ya._m > 0 ? LOG_CLIP_PLUS : LOG_CLIP_MINUS)));\n            }\n            x *= 1000;\n        }\n        if(y === BADNUM) {\n            if(yLog) y = ya.c2p(di.y, true);\n            if(y === BADNUM) return false;\n            y *= 1000;\n        }\n        return [x, y];\n    }\n\n    function crossesViewport(xFrac0, yFrac0, xFrac1, yFrac1) {\n        var dx = xFrac1 - xFrac0;\n        var dy = yFrac1 - yFrac0;\n        var dx0 = 0.5 - xFrac0;\n        var dy0 = 0.5 - yFrac0;\n        var norm2 = dx * dx + dy * dy;\n        var dot = dx * dx0 + dy * dy0;\n        if(dot > 0 && dot < norm2) {\n            var cross = dx0 * dy - dy0 * dx;\n            if(cross * cross < norm2) return true;\n        }\n    }\n\n    var latestXFrac, latestYFrac;\n    // if we're off-screen, increase tolerance over baseTolerance\n    function getTolerance(pt, nextPt) {\n        var xFrac = pt[0] / xLen;\n        var yFrac = pt[1] / yLen;\n        var offScreenFraction = Math.max(0, -xFrac, xFrac - 1, -yFrac, yFrac - 1);\n        if(offScreenFraction && (latestXFrac !== undefined) &&\n            crossesViewport(xFrac, yFrac, latestXFrac, latestYFrac)\n        ) {\n            offScreenFraction = 0;\n        }\n        if(offScreenFraction && nextPt &&\n            crossesViewport(xFrac, yFrac, nextPt[0] / xLen, nextPt[1] / yLen)\n        ) {\n            offScreenFraction = 0;\n        }\n\n        return (1 + constants.toleranceGrowth * offScreenFraction) * baseTolerance;\n    }\n\n    function ptDist(pt1, pt2) {\n        var dx = pt1[0] - pt2[0];\n        var dy = pt1[1] - pt2[1];\n        return Math.sqrt(dx * dx + dy * dy);\n    }\n\n    // last bit of filtering: clip paths that are VERY far off-screen\n    // so we don't get near the browser's hard limit (+/- 2^29 px in Chrome and FF)\n\n    var maxScreensAway = constants.maxScreensAway;\n\n    // find the intersections between the segment from pt1 to pt2\n    // and the large rectangle maxScreensAway around the viewport\n    // if one of pt1 and pt2 is inside and the other outside, there\n    // will be only one intersection.\n    // if both are outside there will be 0 or 2 intersections\n    // (or 1 if it's right at a corner - we'll treat that like 0)\n    // returns an array of intersection pts\n    var xEdge0 = -xLen * maxScreensAway;\n    var xEdge1 = xLen * (1 + maxScreensAway);\n    var yEdge0 = -yLen * maxScreensAway;\n    var yEdge1 = yLen * (1 + maxScreensAway);\n    var edges = [\n        [xEdge0, yEdge0, xEdge1, yEdge0],\n        [xEdge1, yEdge0, xEdge1, yEdge1],\n        [xEdge1, yEdge1, xEdge0, yEdge1],\n        [xEdge0, yEdge1, xEdge0, yEdge0]\n    ];\n    var xEdge, yEdge, lastXEdge, lastYEdge, lastFarPt, edgePt;\n\n    // for linear line shape, edge intersections should be linearly interpolated\n    // spline uses this too, which isn't precisely correct but is actually pretty\n    // good, because Catmull-Rom weights far-away points less in creating the curvature\n    function getLinearEdgeIntersections(pt1, pt2) {\n        var out = [];\n        var ptCount = 0;\n        for(var i = 0; i < 4; i++) {\n            var edge = edges[i];\n            var ptInt = segmentsIntersect(\n                pt1[0], pt1[1], pt2[0], pt2[1],\n                edge[0], edge[1], edge[2], edge[3]\n            );\n            if(ptInt && (!ptCount ||\n                Math.abs(ptInt.x - out[0][0]) > 1 ||\n                Math.abs(ptInt.y - out[0][1]) > 1\n            )) {\n                ptInt = [ptInt.x, ptInt.y];\n                // if we have 2 intersections, make sure the closest one to pt1 comes first\n                if(ptCount && ptDist(ptInt, pt1) < ptDist(out[0], pt1)) out.unshift(ptInt);\n                else out.push(ptInt);\n                ptCount++;\n            }\n        }\n        return out;\n    }\n\n    function onlyConstrainedPoint(pt) {\n        if(pt[0] < xEdge0 || pt[0] > xEdge1 || pt[1] < yEdge0 || pt[1] > yEdge1) {\n            return [constrain(pt[0], xEdge0, xEdge1), constrain(pt[1], yEdge0, yEdge1)];\n        }\n    }\n\n    function sameEdge(pt1, pt2) {\n        if(pt1[0] === pt2[0] && (pt1[0] === xEdge0 || pt1[0] === xEdge1)) return true;\n        if(pt1[1] === pt2[1] && (pt1[1] === yEdge0 || pt1[1] === yEdge1)) return true;\n    }\n\n    // for line shapes hv and vh, movement in the two dimensions is decoupled,\n    // so all we need to do is constrain each dimension independently\n    function getHVEdgeIntersections(pt1, pt2) {\n        var out = [];\n        var ptInt1 = onlyConstrainedPoint(pt1);\n        var ptInt2 = onlyConstrainedPoint(pt2);\n        if(ptInt1 && ptInt2 && sameEdge(ptInt1, ptInt2)) return out;\n\n        if(ptInt1) out.push(ptInt1);\n        if(ptInt2) out.push(ptInt2);\n        return out;\n    }\n\n    // hvh and vhv we sometimes have to move one of the intersection points\n    // out BEYOND the clipping rect, by a maximum of a factor of 2, so that\n    // the midpoint line is drawn in the right place\n    function getABAEdgeIntersections(dim, limit0, limit1) {\n        return function(pt1, pt2) {\n            var ptInt1 = onlyConstrainedPoint(pt1);\n            var ptInt2 = onlyConstrainedPoint(pt2);\n\n            var out = [];\n            if(ptInt1 && ptInt2 && sameEdge(ptInt1, ptInt2)) return out;\n\n            if(ptInt1) out.push(ptInt1);\n            if(ptInt2) out.push(ptInt2);\n\n            var midShift = 2 * Lib.constrain((pt1[dim] + pt2[dim]) / 2, limit0, limit1) -\n                ((ptInt1 || pt1)[dim] + (ptInt2 || pt2)[dim]);\n            if(midShift) {\n                var ptToAlter;\n                if(ptInt1 && ptInt2) {\n                    ptToAlter = (midShift > 0 === ptInt1[dim] > ptInt2[dim]) ? ptInt1 : ptInt2;\n                } else ptToAlter = ptInt1 || ptInt2;\n\n                ptToAlter[dim] += midShift;\n            }\n\n            return out;\n        };\n    }\n\n    var getEdgeIntersections;\n    if(shape === 'linear' || shape === 'spline') {\n        getEdgeIntersections = getLinearEdgeIntersections;\n    } else if(shape === 'hv' || shape === 'vh') {\n        getEdgeIntersections = getHVEdgeIntersections;\n    } else if(shape === 'hvh') getEdgeIntersections = getABAEdgeIntersections(0, xEdge0, xEdge1);\n    else if(shape === 'vhv') getEdgeIntersections = getABAEdgeIntersections(1, yEdge0, yEdge1);\n\n    // a segment pt1->pt2 entirely outside the nearby region:\n    // find the corner it gets closest to touching\n    function getClosestCorner(pt1, pt2) {\n        var dx = pt2[0] - pt1[0];\n        var m = (pt2[1] - pt1[1]) / dx;\n        var b = (pt1[1] * pt2[0] - pt2[1] * pt1[0]) / dx;\n\n        if(b > 0) return [m > 0 ? xEdge0 : xEdge1, yEdge1];\n        else return [m > 0 ? xEdge1 : xEdge0, yEdge0];\n    }\n\n    function updateEdge(pt) {\n        var x = pt[0];\n        var y = pt[1];\n        var xSame = x === pts[pti - 1][0];\n        var ySame = y === pts[pti - 1][1];\n        // duplicate point?\n        if(xSame && ySame) return;\n        if(pti > 1) {\n            // backtracking along an edge?\n            var xSame2 = x === pts[pti - 2][0];\n            var ySame2 = y === pts[pti - 2][1];\n            if(xSame && (x === xEdge0 || x === xEdge1) && xSame2) {\n                if(ySame2) pti--; // backtracking exactly - drop prev pt and don't add\n                else pts[pti - 1] = pt; // not exact: replace the prev pt\n            } else if(ySame && (y === yEdge0 || y === yEdge1) && ySame2) {\n                if(xSame2) pti--;\n                else pts[pti - 1] = pt;\n            } else pts[pti++] = pt;\n        } else pts[pti++] = pt;\n    }\n\n    function updateEdgesForReentry(pt) {\n        // if we're outside the nearby region and going back in,\n        // we may need to loop around a corner point\n        if(pts[pti - 1][0] !== pt[0] && pts[pti - 1][1] !== pt[1]) {\n            updateEdge([lastXEdge, lastYEdge]);\n        }\n        updateEdge(pt);\n        lastFarPt = null;\n        lastXEdge = lastYEdge = 0;\n    }\n\n    function addPt(pt) {\n        latestXFrac = pt[0] / xLen;\n        latestYFrac = pt[1] / yLen;\n        // Are we more than maxScreensAway off-screen any direction?\n        // if so, clip to this box, but in such a way that on-screen\n        // drawing is unchanged\n        xEdge = (pt[0] < xEdge0) ? xEdge0 : (pt[0] > xEdge1) ? xEdge1 : 0;\n        yEdge = (pt[1] < yEdge0) ? yEdge0 : (pt[1] > yEdge1) ? yEdge1 : 0;\n        if(xEdge || yEdge) {\n            if(!pti) {\n                // to get fills right - if first point is far, push it toward the\n                // screen in whichever direction(s) are far\n\n                pts[pti++] = [xEdge || pt[0], yEdge || pt[1]];\n            } else if(lastFarPt) {\n                // both this point and the last are outside the nearby region\n                // check if we're crossing the nearby region\n                var intersections = getEdgeIntersections(lastFarPt, pt);\n                if(intersections.length > 1) {\n                    updateEdgesForReentry(intersections[0]);\n                    pts[pti++] = intersections[1];\n                }\n            } else {\n                // we're leaving the nearby region - add the point where we left it\n\n                edgePt = getEdgeIntersections(pts[pti - 1], pt)[0];\n                pts[pti++] = edgePt;\n            }\n\n            var lastPt = pts[pti - 1];\n            if(xEdge && yEdge && (lastPt[0] !== xEdge || lastPt[1] !== yEdge)) {\n                // we've gone out beyond a new corner: add the corner too\n                // so that the next point will take the right winding\n                if(lastFarPt) {\n                    if(lastXEdge !== xEdge && lastYEdge !== yEdge) {\n                        if(lastXEdge && lastYEdge) {\n                            // we've gone around to an opposite corner - we\n                            // need to add the correct extra corner\n                            // in order to get the right winding\n                            updateEdge(getClosestCorner(lastFarPt, pt));\n                        } else {\n                            // we're coming from a far edge - the extra corner\n                            // we need is determined uniquely by the sectors\n                            updateEdge([lastXEdge || xEdge, lastYEdge || yEdge]);\n                        }\n                    } else if(lastXEdge && lastYEdge) {\n                        updateEdge([lastXEdge, lastYEdge]);\n                    }\n                }\n                updateEdge([xEdge, yEdge]);\n            } else if((lastXEdge - xEdge) && (lastYEdge - yEdge)) {\n                // we're coming from an edge or far corner to an edge - again the\n                // extra corner we need is uniquely determined by the sectors\n                updateEdge([xEdge || lastXEdge, yEdge || lastYEdge]);\n            }\n            lastFarPt = pt;\n            lastXEdge = xEdge;\n            lastYEdge = yEdge;\n        } else {\n            if(lastFarPt) {\n                // this point is in range but the previous wasn't: add its entry pt first\n                updateEdgesForReentry(getEdgeIntersections(lastFarPt, pt)[0]);\n            }\n\n            pts[pti++] = pt;\n        }\n    }\n\n    // loop over ALL points in this trace\n    for(i = 0; i < len; i++) {\n        clusterStartPt = getPt(i);\n        if(!clusterStartPt) continue;\n\n        pti = 0;\n        lastFarPt = null;\n        addPt(clusterStartPt);\n\n        // loop over one segment of the trace\n        for(i++; i < len; i++) {\n            clusterHighPt = getPt(i);\n            if(!clusterHighPt) {\n                if(connectGaps) continue;\n                else break;\n            }\n\n            // can't decimate if nonlinear line shape\n            // TODO: we *could* decimate [hv]{2,3} shapes if we restricted clusters to horz or vert again\n            // but spline would be verrry awkward to decimate\n            if(!linear || !opts.simplify) {\n                addPt(clusterHighPt);\n                continue;\n            }\n\n            var nextPt = getPt(i + 1);\n\n            clusterRefDist = ptDist(clusterHighPt, clusterStartPt);\n\n            // #3147 - always include the very first and last points for fills\n            if(!(fill && (pti === 0 || pti === len - 1)) &&\n                clusterRefDist < getTolerance(clusterHighPt, nextPt) * minTolerance) continue;\n\n            clusterUnitVector = [\n                (clusterHighPt[0] - clusterStartPt[0]) / clusterRefDist,\n                (clusterHighPt[1] - clusterStartPt[1]) / clusterRefDist\n            ];\n\n            clusterLowPt = clusterStartPt;\n            clusterHighVal = clusterRefDist;\n            clusterLowVal = clusterMinDeviation = clusterMaxDeviation = 0;\n            clusterHighFirst = false;\n            clusterEndPt = clusterHighPt;\n\n            // loop over one cluster of points that collapse onto one line\n            for(i++; i < d.length; i++) {\n                thisPt = nextPt;\n                nextPt = getPt(i + 1);\n                if(!thisPt) {\n                    if(connectGaps) continue;\n                    else break;\n                }\n                thisVector = [\n                    thisPt[0] - clusterStartPt[0],\n                    thisPt[1] - clusterStartPt[1]\n                ];\n                // cross product (or dot with normal to the cluster vector)\n                thisDeviation = thisVector[0] * clusterUnitVector[1] - thisVector[1] * clusterUnitVector[0];\n                clusterMinDeviation = Math.min(clusterMinDeviation, thisDeviation);\n                clusterMaxDeviation = Math.max(clusterMaxDeviation, thisDeviation);\n\n                if(clusterMaxDeviation - clusterMinDeviation > getTolerance(thisPt, nextPt)) break;\n\n                clusterEndPt = thisPt;\n                thisVal = thisVector[0] * clusterUnitVector[0] + thisVector[1] * clusterUnitVector[1];\n\n                if(thisVal > clusterHighVal) {\n                    clusterHighVal = thisVal;\n                    clusterHighPt = thisPt;\n                    clusterHighFirst = false;\n                } else if(thisVal < clusterLowVal) {\n                    clusterLowVal = thisVal;\n                    clusterLowPt = thisPt;\n                    clusterHighFirst = true;\n                }\n            }\n\n            // insert this cluster into pts\n            // we've already inserted the start pt, now check if we have high and low pts\n            if(clusterHighFirst) {\n                addPt(clusterHighPt);\n                if(clusterEndPt !== clusterLowPt) addPt(clusterLowPt);\n            } else {\n                if(clusterLowPt !== clusterStartPt) addPt(clusterLowPt);\n                if(clusterEndPt !== clusterHighPt) addPt(clusterHighPt);\n            }\n            // and finally insert the end pt\n            addPt(clusterEndPt);\n\n            // have we reached the end of this segment?\n            if(i >= d.length || !thisPt) break;\n\n            // otherwise we have an out-of-cluster point to insert as next clusterStartPt\n            addPt(thisPt);\n            clusterStartPt = thisPt;\n        }\n\n        // to get fills right - repeat what we did at the start\n        if(lastFarPt) updateEdge([lastXEdge || lastFarPt[0], lastYEdge || lastFarPt[1]]);\n\n        segments.push(pts.slice(0, pti));\n    }\n\n    return segments;\n};\n","'use strict';\n\n\n// common to 'scatter' and 'scatterternary'\nmodule.exports = function handleLineShapeDefaults(traceIn, traceOut, coerce) {\n    var shape = coerce('line.shape');\n    if(shape === 'spline') coerce('line.smoothing');\n};\n","'use strict';\n\nvar LINKEDFILLS = {tonextx: 1, tonexty: 1, tonext: 1};\n\nmodule.exports = function linkTraces(gd, plotinfo, cdscatter) {\n    var trace, i, group, prevtrace, groupIndex;\n\n    // first sort traces to keep stacks & filled-together groups together\n    var groupIndices = {};\n    var needsSort = false;\n    var prevGroupIndex = -1;\n    var nextGroupIndex = 0;\n    var prevUnstackedGroupIndex = -1;\n    for(i = 0; i < cdscatter.length; i++) {\n        trace = cdscatter[i][0].trace;\n        group = trace.stackgroup || '';\n        if(group) {\n            if(group in groupIndices) {\n                groupIndex = groupIndices[group];\n            } else {\n                groupIndex = groupIndices[group] = nextGroupIndex;\n                nextGroupIndex++;\n            }\n        } else if(trace.fill in LINKEDFILLS && prevUnstackedGroupIndex >= 0) {\n            groupIndex = prevUnstackedGroupIndex;\n        } else {\n            groupIndex = prevUnstackedGroupIndex = nextGroupIndex;\n            nextGroupIndex++;\n        }\n\n        if(groupIndex < prevGroupIndex) needsSort = true;\n        trace._groupIndex = prevGroupIndex = groupIndex;\n    }\n\n    var cdscatterSorted = cdscatter.slice();\n    if(needsSort) {\n        cdscatterSorted.sort(function(a, b) {\n            var traceA = a[0].trace;\n            var traceB = b[0].trace;\n            return (traceA._groupIndex - traceB._groupIndex) ||\n                (traceA.index - traceB.index);\n        });\n    }\n\n    // now link traces to each other\n    var prevtraces = {};\n    for(i = 0; i < cdscatterSorted.length; i++) {\n        trace = cdscatterSorted[i][0].trace;\n        group = trace.stackgroup || '';\n\n        // Note: The check which ensures all cdscatter here are for the same axis and\n        // are either cartesian or scatterternary has been removed. This code assumes\n        // the passed scattertraces have been filtered to the proper plot types and\n        // the proper subplots.\n        if(trace.visible === true) {\n            trace._nexttrace = null;\n\n            if(trace.fill in LINKEDFILLS) {\n                prevtrace = prevtraces[group];\n                trace._prevtrace = prevtrace || null;\n\n                if(prevtrace) {\n                    prevtrace._nexttrace = trace;\n                }\n            }\n\n            trace._ownfill = (trace.fill && (\n                trace.fill.substr(0, 6) === 'tozero' ||\n                trace.fill === 'toself' ||\n                (trace.fill.substr(0, 2) === 'to' && !trace._prevtrace)\n            ));\n\n            prevtraces[group] = trace;\n        } else {\n            trace._prevtrace = trace._nexttrace = trace._ownfill = null;\n        }\n    }\n\n    return cdscatterSorted;\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\n\n// used in the drawing step for 'scatter' and 'scattegeo' and\n// in the convert step for 'scatter3d'\nmodule.exports = function makeBubbleSizeFn(trace) {\n    var marker = trace.marker;\n    var sizeRef = marker.sizeref || 1;\n    var sizeMin = marker.sizemin || 0;\n\n    // for bubble charts, allow scaling the provided value linearly\n    // and by area or diameter.\n    // Note this only applies to the array-value sizes\n\n    var baseFn = (marker.sizemode === 'area') ?\n        function(v) { return Math.sqrt(v / sizeRef); } :\n        function(v) { return v / sizeRef; };\n\n    // TODO add support for position/negative bubbles?\n    // TODO add 'sizeoffset' attribute?\n    return function(v) {\n        var baseSize = baseFn(v / 2);\n\n        // don't show non-numeric and negative sizes\n        return (isNumeric(baseSize) && (baseSize > 0)) ?\n            Math.max(baseSize, sizeMin) :\n            0;\n    };\n};\n","'use strict';\n\nmodule.exports = {\n    container: 'marker',\n    min: 'cmin',\n    max: 'cmax'\n};\n","'use strict';\n\nvar Color = require('../../components/color');\nvar hasColorscale = require('../../components/colorscale/helpers').hasColorscale;\nvar colorscaleDefaults = require('../../components/colorscale/defaults');\n\nvar subTypes = require('./subtypes');\n\n/*\n * opts: object of flags to control features not all marker users support\n *   noLine: caller does not support marker lines\n *   gradient: caller supports gradients\n *   noSelect: caller does not support selected/unselected attribute containers\n */\nmodule.exports = function markerDefaults(traceIn, traceOut, defaultColor, layout, coerce, opts) {\n    var isBubble = subTypes.isBubble(traceIn);\n    var lineColor = (traceIn.line || {}).color;\n    var defaultMLC;\n\n    opts = opts || {};\n\n    // marker.color inherit from line.color (even if line.color is an array)\n    if(lineColor) defaultColor = lineColor;\n\n    coerce('marker.symbol');\n    coerce('marker.opacity', isBubble ? 0.7 : 1);\n    coerce('marker.size');\n\n    coerce('marker.color', defaultColor);\n    if(hasColorscale(traceIn, 'marker')) {\n        colorscaleDefaults(traceIn, traceOut, layout, coerce, {prefix: 'marker.', cLetter: 'c'});\n    }\n\n    if(!opts.noSelect) {\n        coerce('selected.marker.color');\n        coerce('unselected.marker.color');\n        coerce('selected.marker.size');\n        coerce('unselected.marker.size');\n    }\n\n    if(!opts.noLine) {\n        // if there's a line with a different color than the marker, use\n        // that line color as the default marker line color\n        // (except when it's an array)\n        // mostly this is for transparent markers to behave nicely\n        if(lineColor && !Array.isArray(lineColor) && (traceOut.marker.color !== lineColor)) {\n            defaultMLC = lineColor;\n        } else if(isBubble) defaultMLC = Color.background;\n        else defaultMLC = Color.defaultLine;\n\n        coerce('marker.line.color', defaultMLC);\n        if(hasColorscale(traceIn, 'marker.line')) {\n            colorscaleDefaults(traceIn, traceOut, layout, coerce, {prefix: 'marker.line.', cLetter: 'c'});\n        }\n\n        coerce('marker.line.width', isBubble ? 1 : 0);\n    }\n\n    if(isBubble) {\n        coerce('marker.sizeref');\n        coerce('marker.sizemin');\n        coerce('marker.sizemode');\n    }\n\n    if(opts.gradient) {\n        var gradientType = coerce('marker.gradient.type');\n        if(gradientType !== 'none') {\n            coerce('marker.gradient.color');\n        }\n    }\n};\n","'use strict';\n\nvar dateTick0 = require('../../lib').dateTick0;\nvar numConstants = require('../../constants/numerical');\nvar ONEWEEK = numConstants.ONEWEEK;\n\nfunction getPeriod0Dflt(period, calendar) {\n    if(period % ONEWEEK === 0) {\n        return dateTick0(calendar, 1); // Sunday\n    }\n    return dateTick0(calendar, 0);\n}\n\nmodule.exports = function handlePeriodDefaults(traceIn, traceOut, layout, coerce, opts) {\n    if(!opts) {\n        opts = {\n            x: true,\n            y: true\n        };\n    }\n\n    if(opts.x) {\n        var xperiod = coerce('xperiod');\n        if(xperiod) {\n            coerce('xperiod0', getPeriod0Dflt(xperiod, traceOut.xcalendar));\n            coerce('xperiodalignment');\n        }\n    }\n\n    if(opts.y) {\n        var yperiod = coerce('yperiod');\n        if(yperiod) {\n            coerce('yperiod0', getPeriod0Dflt(yperiod, traceOut.ycalendar));\n            coerce('yperiodalignment');\n        }\n    }\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar ensureSingle = Lib.ensureSingle;\nvar identity = Lib.identity;\nvar Drawing = require('../../components/drawing');\n\nvar subTypes = require('./subtypes');\nvar linePoints = require('./line_points');\nvar linkTraces = require('./link_traces');\nvar polygonTester = require('../../lib/polygon').tester;\n\nmodule.exports = function plot(gd, plotinfo, cdscatter, scatterLayer, transitionOpts, makeOnCompleteCallback) {\n    var join, onComplete;\n\n    // If transition config is provided, then it is only a partial replot and traces not\n    // updated are removed.\n    var isFullReplot = !transitionOpts;\n    var hasTransition = !!transitionOpts && transitionOpts.duration > 0;\n\n    // Link traces so the z-order of fill layers is correct\n    var cdscatterSorted = linkTraces(gd, plotinfo, cdscatter);\n\n    join = scatterLayer.selectAll('g.trace')\n        .data(cdscatterSorted, function(d) { return d[0].trace.uid; });\n\n    // Append new traces:\n    join.enter().append('g')\n        .attr('class', function(d) {\n            return 'trace scatter trace' + d[0].trace.uid;\n        })\n        .style('stroke-miterlimit', 2);\n    join.order();\n\n    createFills(gd, join, plotinfo);\n\n    if(hasTransition) {\n        if(makeOnCompleteCallback) {\n            // If it was passed a callback to register completion, make a callback. If\n            // this is created, then it must be executed on completion, otherwise the\n            // pos-transition redraw will not execute:\n            onComplete = makeOnCompleteCallback();\n        }\n\n        var transition = d3.transition()\n            .duration(transitionOpts.duration)\n            .ease(transitionOpts.easing)\n            .each('end', function() {\n                onComplete && onComplete();\n            })\n            .each('interrupt', function() {\n                onComplete && onComplete();\n            });\n\n        transition.each(function() {\n            // Must run the selection again since otherwise enters/updates get grouped together\n            // and these get executed out of order. Except we need them in order!\n            scatterLayer.selectAll('g.trace').each(function(d, i) {\n                plotOne(gd, i, plotinfo, d, cdscatterSorted, this, transitionOpts);\n            });\n        });\n    } else {\n        join.each(function(d, i) {\n            plotOne(gd, i, plotinfo, d, cdscatterSorted, this, transitionOpts);\n        });\n    }\n\n    if(isFullReplot) {\n        join.exit().remove();\n    }\n\n    // remove paths that didn't get used\n    scatterLayer.selectAll('path:not([d])').remove();\n};\n\nfunction createFills(gd, traceJoin, plotinfo) {\n    traceJoin.each(function(d) {\n        var fills = ensureSingle(d3.select(this), 'g', 'fills');\n        Drawing.setClipUrl(fills, plotinfo.layerClipId, gd);\n\n        var trace = d[0].trace;\n\n        var fillData = [];\n        if(trace._ownfill) fillData.push('_ownFill');\n        if(trace._nexttrace) fillData.push('_nextFill');\n\n        var fillJoin = fills.selectAll('g').data(fillData, identity);\n\n        fillJoin.enter().append('g');\n\n        fillJoin.exit()\n            .each(function(d) { trace[d] = null; })\n            .remove();\n\n        fillJoin.order().each(function(d) {\n            // make a path element inside the fill group, just so\n            // we can give it its own data later on and the group can\n            // keep its simple '_*Fill' data\n            trace[d] = ensureSingle(d3.select(this), 'path', 'js-fill');\n        });\n    });\n}\n\nfunction plotOne(gd, idx, plotinfo, cdscatter, cdscatterAll, element, transitionOpts) {\n    var i;\n\n    // Since this has been reorganized and we're executing this on individual traces,\n    // we need to pass it the full list of cdscatter as well as this trace's index (idx)\n    // since it does an internal n^2 loop over comparisons with other traces:\n    selectMarkers(gd, idx, plotinfo, cdscatter, cdscatterAll);\n\n    var hasTransition = !!transitionOpts && transitionOpts.duration > 0;\n\n    function transition(selection) {\n        return hasTransition ? selection.transition() : selection;\n    }\n\n    var xa = plotinfo.xaxis;\n    var ya = plotinfo.yaxis;\n\n    var trace = cdscatter[0].trace;\n    var line = trace.line;\n    var tr = d3.select(element);\n\n    var errorBarGroup = ensureSingle(tr, 'g', 'errorbars');\n    var lines = ensureSingle(tr, 'g', 'lines');\n    var points = ensureSingle(tr, 'g', 'points');\n    var text = ensureSingle(tr, 'g', 'text');\n\n    // error bars are at the bottom\n    Registry.getComponentMethod('errorbars', 'plot')(gd, errorBarGroup, plotinfo, transitionOpts);\n\n    if(trace.visible !== true) return;\n\n    transition(tr).style('opacity', trace.opacity);\n\n    // BUILD LINES AND FILLS\n    var ownFillEl3, tonext;\n    var ownFillDir = trace.fill.charAt(trace.fill.length - 1);\n    if(ownFillDir !== 'x' && ownFillDir !== 'y') ownFillDir = '';\n\n    // store node for tweaking by selectPoints\n    cdscatter[0][plotinfo.isRangePlot ? 'nodeRangePlot3' : 'node3'] = tr;\n\n    var prevRevpath = '';\n    var prevPolygons = [];\n    var prevtrace = trace._prevtrace;\n\n    if(prevtrace) {\n        prevRevpath = prevtrace._prevRevpath || '';\n        tonext = prevtrace._nextFill;\n        prevPolygons = prevtrace._polygons;\n    }\n\n    var thispath;\n    var thisrevpath;\n    // fullpath is all paths for this curve, joined together straight\n    // across gaps, for filling\n    var fullpath = '';\n    // revpath is fullpath reversed, for fill-to-next\n    var revpath = '';\n    // functions for converting a point array to a path\n    var pathfn, revpathbase, revpathfn;\n    // variables used before and after the data join\n    var pt0, lastSegment, pt1, thisPolygons;\n\n    // initialize line join data / method\n    var segments = [];\n    var makeUpdate = Lib.noop;\n\n    ownFillEl3 = trace._ownFill;\n\n    if(subTypes.hasLines(trace) || trace.fill !== 'none') {\n        if(tonext) {\n            // This tells .style which trace to use for fill information:\n            tonext.datum(cdscatter);\n        }\n\n        if(['hv', 'vh', 'hvh', 'vhv'].indexOf(line.shape) !== -1) {\n            pathfn = Drawing.steps(line.shape);\n            revpathbase = Drawing.steps(\n                line.shape.split('').reverse().join('')\n            );\n        } else if(line.shape === 'spline') {\n            pathfn = revpathbase = function(pts) {\n                var pLast = pts[pts.length - 1];\n                if(pts.length > 1 && pts[0][0] === pLast[0] && pts[0][1] === pLast[1]) {\n                    // identical start and end points: treat it as a\n                    // closed curve so we don't get a kink\n                    return Drawing.smoothclosed(pts.slice(1), line.smoothing);\n                } else {\n                    return Drawing.smoothopen(pts, line.smoothing);\n                }\n            };\n        } else {\n            pathfn = revpathbase = function(pts) {\n                return 'M' + pts.join('L');\n            };\n        }\n\n        revpathfn = function(pts) {\n            // note: this is destructive (reverses pts in place) so can't use pts after this\n            return revpathbase(pts.reverse());\n        };\n\n        segments = linePoints(cdscatter, {\n            xaxis: xa,\n            yaxis: ya,\n            connectGaps: trace.connectgaps,\n            baseTolerance: Math.max(line.width || 1, 3) / 4,\n            shape: line.shape,\n            simplify: line.simplify,\n            fill: trace.fill\n        });\n\n        // since we already have the pixel segments here, use them to make\n        // polygons for hover on fill\n        // TODO: can we skip this if hoveron!=fills? That would mean we\n        // need to redraw when you change hoveron...\n        thisPolygons = trace._polygons = new Array(segments.length);\n        for(i = 0; i < segments.length; i++) {\n            trace._polygons[i] = polygonTester(segments[i]);\n        }\n\n        if(segments.length) {\n            pt0 = segments[0][0];\n            lastSegment = segments[segments.length - 1];\n            pt1 = lastSegment[lastSegment.length - 1];\n        }\n\n        makeUpdate = function(isEnter) {\n            return function(pts) {\n                thispath = pathfn(pts);\n                thisrevpath = revpathfn(pts);\n                if(!fullpath) {\n                    fullpath = thispath;\n                    revpath = thisrevpath;\n                } else if(ownFillDir) {\n                    fullpath += 'L' + thispath.substr(1);\n                    revpath = thisrevpath + ('L' + revpath.substr(1));\n                } else {\n                    fullpath += 'Z' + thispath;\n                    revpath = thisrevpath + 'Z' + revpath;\n                }\n\n                if(subTypes.hasLines(trace) && pts.length > 1) {\n                    var el = d3.select(this);\n\n                    // This makes the coloring work correctly:\n                    el.datum(cdscatter);\n\n                    if(isEnter) {\n                        transition(el.style('opacity', 0)\n                            .attr('d', thispath)\n                            .call(Drawing.lineGroupStyle))\n                                .style('opacity', 1);\n                    } else {\n                        var sel = transition(el);\n                        sel.attr('d', thispath);\n                        Drawing.singleLineStyle(cdscatter, sel);\n                    }\n                }\n            };\n        };\n    }\n\n    var lineJoin = lines.selectAll('.js-line').data(segments);\n\n    transition(lineJoin.exit())\n        .style('opacity', 0)\n        .remove();\n\n    lineJoin.each(makeUpdate(false));\n\n    lineJoin.enter().append('path')\n        .classed('js-line', true)\n        .style('vector-effect', 'non-scaling-stroke')\n        .call(Drawing.lineGroupStyle)\n        .each(makeUpdate(true));\n\n    Drawing.setClipUrl(lineJoin, plotinfo.layerClipId, gd);\n\n    function clearFill(selection) {\n        transition(selection).attr('d', 'M0,0Z');\n    }\n\n    if(segments.length) {\n        if(ownFillEl3) {\n            ownFillEl3.datum(cdscatter);\n            if(pt0 && pt1) {\n                if(ownFillDir) {\n                    if(ownFillDir === 'y') {\n                        pt0[1] = pt1[1] = ya.c2p(0, true);\n                    } else if(ownFillDir === 'x') {\n                        pt0[0] = pt1[0] = xa.c2p(0, true);\n                    }\n\n                    // fill to zero: full trace path, plus extension of\n                    // the endpoints to the appropriate axis\n                    // For the sake of animations, wrap the points around so that\n                    // the points on the axes are the first two points. Otherwise\n                    // animations get a little crazy if the number of points changes.\n                    transition(ownFillEl3).attr('d', 'M' + pt1 + 'L' + pt0 + 'L' + fullpath.substr(1))\n                        .call(Drawing.singleFillStyle);\n                } else {\n                    // fill to self: just join the path to itself\n                    transition(ownFillEl3).attr('d', fullpath + 'Z')\n                        .call(Drawing.singleFillStyle);\n                }\n            }\n        } else if(tonext) {\n            if(trace.fill.substr(0, 6) === 'tonext' && fullpath && prevRevpath) {\n                // fill to next: full trace path, plus the previous path reversed\n                if(trace.fill === 'tonext') {\n                    // tonext: for use by concentric shapes, like manually constructed\n                    // contours, we just add the two paths closed on themselves.\n                    // This makes strange results if one path is *not* entirely\n                    // inside the other, but then that is a strange usage.\n                    transition(tonext).attr('d', fullpath + 'Z' + prevRevpath + 'Z')\n                        .call(Drawing.singleFillStyle);\n                } else {\n                    // tonextx/y: for now just connect endpoints with lines. This is\n                    // the correct behavior if the endpoints are at the same value of\n                    // y/x, but if they *aren't*, we should ideally do more complicated\n                    // things depending on whether the new endpoint projects onto the\n                    // existing curve or off the end of it\n                    transition(tonext).attr('d', fullpath + 'L' + prevRevpath.substr(1) + 'Z')\n                        .call(Drawing.singleFillStyle);\n                }\n                trace._polygons = trace._polygons.concat(prevPolygons);\n            } else {\n                clearFill(tonext);\n                trace._polygons = null;\n            }\n        }\n        trace._prevRevpath = revpath;\n        trace._prevPolygons = thisPolygons;\n    } else {\n        if(ownFillEl3) clearFill(ownFillEl3);\n        else if(tonext) clearFill(tonext);\n        trace._polygons = trace._prevRevpath = trace._prevPolygons = null;\n    }\n\n\n    function visFilter(d) {\n        return d.filter(function(v) { return !v.gap && v.vis; });\n    }\n\n    function visFilterWithGaps(d) {\n        return d.filter(function(v) { return v.vis; });\n    }\n\n    function gapFilter(d) {\n        return d.filter(function(v) { return !v.gap; });\n    }\n\n    function keyFunc(d) {\n        return d.id;\n    }\n\n    // Returns a function if the trace is keyed, otherwise returns undefined\n    function getKeyFunc(trace) {\n        if(trace.ids) {\n            return keyFunc;\n        }\n    }\n\n    function hideFilter() {\n        return false;\n    }\n\n    function makePoints(points, text, cdscatter) {\n        var join, selection, hasNode;\n\n        var trace = cdscatter[0].trace;\n        var showMarkers = subTypes.hasMarkers(trace);\n        var showText = subTypes.hasText(trace);\n\n        var keyFunc = getKeyFunc(trace);\n        var markerFilter = hideFilter;\n        var textFilter = hideFilter;\n\n        if(showMarkers || showText) {\n            var showFilter = identity;\n            // if we're stacking, \"infer zero\" gap mode gets markers in the\n            // gap points - because we've inferred a zero there - but other\n            // modes (currently \"interpolate\", later \"interrupt\" hopefully)\n            // we don't draw generated markers\n            var stackGroup = trace.stackgroup;\n            var isInferZero = stackGroup && (\n                gd._fullLayout._scatterStackOpts[xa._id + ya._id][stackGroup].stackgaps === 'infer zero');\n            if(trace.marker.maxdisplayed || trace._needsCull) {\n                showFilter = isInferZero ? visFilterWithGaps : visFilter;\n            } else if(stackGroup && !isInferZero) {\n                showFilter = gapFilter;\n            }\n\n            if(showMarkers) markerFilter = showFilter;\n            if(showText) textFilter = showFilter;\n        }\n\n        // marker points\n\n        selection = points.selectAll('path.point');\n\n        join = selection.data(markerFilter, keyFunc);\n\n        var enter = join.enter().append('path')\n            .classed('point', true);\n\n        if(hasTransition) {\n            enter\n                .call(Drawing.pointStyle, trace, gd)\n                .call(Drawing.translatePoints, xa, ya)\n                .style('opacity', 0)\n                .transition()\n                .style('opacity', 1);\n        }\n\n        join.order();\n\n        var styleFns;\n        if(showMarkers) {\n            styleFns = Drawing.makePointStyleFns(trace);\n        }\n\n        join.each(function(d) {\n            var el = d3.select(this);\n            var sel = transition(el);\n            hasNode = Drawing.translatePoint(d, sel, xa, ya);\n\n            if(hasNode) {\n                Drawing.singlePointStyle(d, sel, trace, styleFns, gd);\n\n                if(plotinfo.layerClipId) {\n                    Drawing.hideOutsideRangePoint(d, sel, xa, ya, trace.xcalendar, trace.ycalendar);\n                }\n\n                if(trace.customdata) {\n                    el.classed('plotly-customdata', d.data !== null && d.data !== undefined);\n                }\n            } else {\n                sel.remove();\n            }\n        });\n\n        if(hasTransition) {\n            join.exit().transition()\n                .style('opacity', 0)\n                .remove();\n        } else {\n            join.exit().remove();\n        }\n\n        // text points\n        selection = text.selectAll('g');\n        join = selection.data(textFilter, keyFunc);\n\n        // each text needs to go in its own 'g' in case\n        // it gets converted to mathjax\n        join.enter().append('g').classed('textpoint', true).append('text');\n\n        join.order();\n\n        join.each(function(d) {\n            var g = d3.select(this);\n            var sel = transition(g.select('text'));\n            hasNode = Drawing.translatePoint(d, sel, xa, ya);\n\n            if(hasNode) {\n                if(plotinfo.layerClipId) {\n                    Drawing.hideOutsideRangePoint(d, g, xa, ya, trace.xcalendar, trace.ycalendar);\n                }\n            } else {\n                g.remove();\n            }\n        });\n\n        join.selectAll('text')\n            .call(Drawing.textPointStyle, trace, gd)\n            .each(function(d) {\n                // This just *has* to be totally custom because of SVG text positioning :(\n                // It's obviously copied from translatePoint; we just can't use that\n                var x = xa.c2p(d.x);\n                var y = ya.c2p(d.y);\n\n                d3.select(this).selectAll('tspan.line').each(function() {\n                    transition(d3.select(this)).attr({x: x, y: y});\n                });\n            });\n\n        join.exit().remove();\n    }\n\n    points.datum(cdscatter);\n    text.datum(cdscatter);\n    makePoints(points, text, cdscatter);\n\n    // lastly, clip points groups of `cliponaxis !== false` traces\n    // on `plotinfo._hasClipOnAxisFalse === true` subplots\n    var hasClipOnAxisFalse = trace.cliponaxis === false;\n    var clipUrl = hasClipOnAxisFalse ? null : plotinfo.layerClipId;\n    Drawing.setClipUrl(points, clipUrl, gd);\n    Drawing.setClipUrl(text, clipUrl, gd);\n}\n\nfunction selectMarkers(gd, idx, plotinfo, cdscatter, cdscatterAll) {\n    var xa = plotinfo.xaxis;\n    var ya = plotinfo.yaxis;\n    var xr = d3.extent(Lib.simpleMap(xa.range, xa.r2c));\n    var yr = d3.extent(Lib.simpleMap(ya.range, ya.r2c));\n\n    var trace = cdscatter[0].trace;\n    if(!subTypes.hasMarkers(trace)) return;\n    // if marker.maxdisplayed is used, select a maximum of\n    // mnum markers to show, from the set that are in the viewport\n    var mnum = trace.marker.maxdisplayed;\n\n    // TODO: remove some as we get away from the viewport?\n    if(mnum === 0) return;\n\n    var cd = cdscatter.filter(function(v) {\n        return v.x >= xr[0] && v.x <= xr[1] && v.y >= yr[0] && v.y <= yr[1];\n    });\n    var inc = Math.ceil(cd.length / mnum);\n    var tnum = 0;\n    cdscatterAll.forEach(function(cdj, j) {\n        var tracei = cdj[0].trace;\n        if(subTypes.hasMarkers(tracei) &&\n                tracei.marker.maxdisplayed > 0 && j < idx) {\n            tnum++;\n        }\n    });\n\n    // if multiple traces use maxdisplayed, stagger which markers we\n    // display this formula offsets successive traces by 1/3 of the\n    // increment, adding an extra small amount after each triplet so\n    // it's not quite periodic\n    var i0 = Math.round(tnum * inc / 3 + Math.floor(tnum / 3) * inc / 7.1);\n\n    // for error bars: save in cd which markers to show\n    // so we don't have to repeat this\n    cdscatter.forEach(function(v) { delete v.vis; });\n    cd.forEach(function(v, i) {\n        if(Math.round((i + i0) % inc) === 0) v.vis = true;\n    });\n}\n","'use strict';\n\nvar subtypes = require('./subtypes');\n\nmodule.exports = function selectPoints(searchInfo, selectionTester) {\n    var cd = searchInfo.cd;\n    var xa = searchInfo.xaxis;\n    var ya = searchInfo.yaxis;\n    var selection = [];\n    var trace = cd[0].trace;\n    var i;\n    var di;\n    var x;\n    var y;\n\n    var hasOnlyLines = (!subtypes.hasMarkers(trace) && !subtypes.hasText(trace));\n    if(hasOnlyLines) return [];\n\n    if(selectionTester === false) { // clear selection\n        for(i = 0; i < cd.length; i++) {\n            cd[i].selected = 0;\n        }\n    } else {\n        for(i = 0; i < cd.length; i++) {\n            di = cd[i];\n            x = xa.c2p(di.x);\n            y = ya.c2p(di.y);\n\n            if((di.i !== null) && selectionTester.contains([x, y], false, i, searchInfo)) {\n                selection.push({\n                    pointNumber: di.i,\n                    x: xa.c2d(di.x),\n                    y: ya.c2d(di.y)\n                });\n                di.selected = 1;\n            } else {\n                di.selected = 0;\n            }\n        }\n    }\n\n    return selection;\n};\n","'use strict';\n\nvar perStackAttrs = ['orientation', 'groupnorm', 'stackgaps'];\n\nmodule.exports = function handleStackDefaults(traceIn, traceOut, layout, coerce) {\n    var stackOpts = layout._scatterStackOpts;\n\n    var stackGroup = coerce('stackgroup');\n    if(stackGroup) {\n        // use independent stacking options per subplot\n        var subplot = traceOut.xaxis + traceOut.yaxis;\n        var subplotStackOpts = stackOpts[subplot];\n        if(!subplotStackOpts) subplotStackOpts = stackOpts[subplot] = {};\n\n        var groupOpts = subplotStackOpts[stackGroup];\n        var firstTrace = false;\n        if(groupOpts) {\n            groupOpts.traces.push(traceOut);\n        } else {\n            groupOpts = subplotStackOpts[stackGroup] = {\n                // keep track of trace indices for use during stacking calculations\n                // this will be filled in during `calc` and used during `crossTraceCalc`\n                // so it's OK if we don't recreate it during a non-calc edit\n                traceIndices: [],\n                // Hold on to the whole set of prior traces\n                // First one is most important, so we can clear defaults\n                // there if we find explicit values only in later traces.\n                // We're only going to *use* the values stored in groupOpts,\n                // but for the editor and validate we want things self-consistent\n                // The full set of traces is used only to fix `fill` default if\n                // we find `orientation: 'h'` beyond the first trace\n                traces: [traceOut]\n            };\n            firstTrace = true;\n        }\n        // TODO: how is this going to work with groupby transforms?\n        // in principle it should be OK I guess, as long as explicit group styles\n        // don't override explicit base-trace styles?\n\n        var dflts = {\n            orientation: (traceOut.x && !traceOut.y) ? 'h' : 'v'\n        };\n\n        for(var i = 0; i < perStackAttrs.length; i++) {\n            var attr = perStackAttrs[i];\n            var attrFound = attr + 'Found';\n            if(!groupOpts[attrFound]) {\n                var traceHasAttr = traceIn[attr] !== undefined;\n                var isOrientation = attr === 'orientation';\n                if(traceHasAttr || firstTrace) {\n                    groupOpts[attr] = coerce(attr, dflts[attr]);\n\n                    if(isOrientation) {\n                        groupOpts.fillDflt = groupOpts[attr] === 'h' ?\n                            'tonextx' : 'tonexty';\n                    }\n\n                    if(traceHasAttr) {\n                        // Note: this will show a value here even if it's invalid\n                        // in which case it will revert to default.\n                        groupOpts[attrFound] = true;\n\n                        // Note: only one trace in the stack will get a _fullData\n                        // entry for a given stack-wide attribute. If no traces\n                        // (or the first trace) specify that attribute, the\n                        // first trace will get it. If the first trace does NOT\n                        // specify it but some later trace does, then it gets\n                        // removed from the first trace and only included in the\n                        // one that specified it. This is mostly important for\n                        // editors (that want to see the full values to know\n                        // what settings are available) and Plotly.react diffing.\n                        // Editors may want to use fullLayout._scatterStackOpts\n                        // directly and make these settings available from all\n                        // traces in the stack... then set the new value into\n                        // the first trace, and clear all later traces.\n                        if(!firstTrace) {\n                            delete groupOpts.traces[0][attr];\n\n                            // orientation can affect default fill of previous traces\n                            if(isOrientation) {\n                                for(var j = 0; j < groupOpts.traces.length - 1; j++) {\n                                    var trace2 = groupOpts.traces[j];\n                                    if(trace2._input.fill !== trace2.fill) {\n                                        trace2.fill = groupOpts.fillDflt;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        return groupOpts;\n    }\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar Drawing = require('../../components/drawing');\nvar Registry = require('../../registry');\n\nfunction style(gd) {\n    var s = d3.select(gd).selectAll('g.trace.scatter');\n\n    s.style('opacity', function(d) {\n        return d[0].trace.opacity;\n    });\n\n    s.selectAll('g.points').each(function(d) {\n        var sel = d3.select(this);\n        var trace = d.trace || d[0].trace;\n        stylePoints(sel, trace, gd);\n    });\n\n    s.selectAll('g.text').each(function(d) {\n        var sel = d3.select(this);\n        var trace = d.trace || d[0].trace;\n        styleText(sel, trace, gd);\n    });\n\n    s.selectAll('g.trace path.js-line')\n        .call(Drawing.lineGroupStyle);\n\n    s.selectAll('g.trace path.js-fill')\n        .call(Drawing.fillGroupStyle);\n\n    Registry.getComponentMethod('errorbars', 'style')(s);\n}\n\nfunction stylePoints(sel, trace, gd) {\n    Drawing.pointStyle(sel.selectAll('path.point'), trace, gd);\n}\n\nfunction styleText(sel, trace, gd) {\n    Drawing.textPointStyle(sel.selectAll('text'), trace, gd);\n}\n\nfunction styleOnSelect(gd, cd, sel) {\n    var trace = cd[0].trace;\n\n    if(trace.selectedpoints) {\n        Drawing.selectedPointStyle(sel.selectAll('path.point'), trace);\n        Drawing.selectedTextStyle(sel.selectAll('text'), trace);\n    } else {\n        stylePoints(sel, trace, gd);\n        styleText(sel, trace, gd);\n    }\n}\n\nmodule.exports = {\n    style: style,\n    stylePoints: stylePoints,\n    styleText: styleText,\n    styleOnSelect: styleOnSelect\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\nmodule.exports = {\n    hasLines: function(trace) {\n        return trace.visible && trace.mode &&\n            trace.mode.indexOf('lines') !== -1;\n    },\n\n    hasMarkers: function(trace) {\n        return trace.visible && (\n            (trace.mode && trace.mode.indexOf('markers') !== -1) ||\n            // until splom implements 'mode'\n            trace.type === 'splom'\n        );\n    },\n\n    hasText: function(trace) {\n        return trace.visible && trace.mode &&\n            trace.mode.indexOf('text') !== -1;\n    },\n\n    isBubble: function(trace) {\n        return Lib.isPlainObject(trace.marker) &&\n            Lib.isArrayOrTypedArray(trace.marker.size);\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\n/*\n * opts: object of flags to control features not all text users support\n *   noSelect: caller does not support selected/unselected attribute containers\n */\nmodule.exports = function(traceIn, traceOut, layout, coerce, opts) {\n    opts = opts || {};\n\n    coerce('textposition');\n    Lib.coerceFont(coerce, 'textfont', layout.font);\n\n    if(!opts.noSelect) {\n        coerce('selected.textfont.color');\n        coerce('unselected.textfont.color');\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Registry = require('../../registry');\n\nmodule.exports = function handleXYDefaults(traceIn, traceOut, layout, coerce) {\n    var x = coerce('x');\n    var y = coerce('y');\n    var len;\n\n    var handleCalendarDefaults = Registry.getComponentMethod('calendars', 'handleTraceDefaults');\n    handleCalendarDefaults(traceIn, traceOut, ['x', 'y'], layout);\n\n    if(x) {\n        var xlen = Lib.minRowLength(x);\n        if(y) {\n            len = Math.min(xlen, Lib.minRowLength(y));\n        } else {\n            len = xlen;\n            coerce('y0');\n            coerce('dy');\n        }\n    } else {\n        if(!y) return 0;\n\n        len = Lib.minRowLength(y);\n        coerce('x0');\n        coerce('dx');\n    }\n\n    traceOut._length = len;\n\n    return len;\n};\n","'use strict';\n\nvar hovertemplateAttrs = require('../../plots/template_attributes').hovertemplateAttrs;\nvar texttemplateAttrs = require('../../plots/template_attributes').texttemplateAttrs;\nvar scatterAttrs = require('../scatter/attributes');\nvar baseAttrs = require('../../plots/attributes');\nvar colorScaleAttrs = require('../../components/colorscale/attributes');\nvar dash = require('../../components/drawing/attributes').dash;\n\nvar extendFlat = require('../../lib/extend').extendFlat;\n\nvar scatterMarkerAttrs = scatterAttrs.marker;\nvar scatterLineAttrs = scatterAttrs.line;\nvar scatterMarkerLineAttrs = scatterMarkerAttrs.line;\n\nmodule.exports = {\n    a: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: [\n            'Sets the quantity of component `a` in each data point.',\n            'If `a`, `b`, and `c` are all provided, they need not be',\n            'normalized, only the relative values matter. If only two',\n            'arrays are provided they must be normalized to match',\n            '`ternary<i>.sum`.'\n        ].join(' ')\n    },\n    b: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: [\n            'Sets the quantity of component `a` in each data point.',\n            'If `a`, `b`, and `c` are all provided, they need not be',\n            'normalized, only the relative values matter. If only two',\n            'arrays are provided they must be normalized to match',\n            '`ternary<i>.sum`.'\n        ].join(' ')\n    },\n    c: {\n        valType: 'data_array',\n        editType: 'calc',\n        description: [\n            'Sets the quantity of component `a` in each data point.',\n            'If `a`, `b`, and `c` are all provided, they need not be',\n            'normalized, only the relative values matter. If only two',\n            'arrays are provided they must be normalized to match',\n            '`ternary<i>.sum`.'\n        ].join(' ')\n    },\n    sum: {\n        valType: 'number',\n        dflt: 0,\n        min: 0,\n        editType: 'calc',\n        description: [\n            'The number each triplet should sum to,',\n            'if only two of `a`, `b`, and `c` are provided.',\n            'This overrides `ternary<i>.sum` to normalize this specific',\n            'trace, but does not affect the values displayed on the axes.',\n            '0 (or missing) means to use ternary<i>.sum'\n        ].join(' ')\n    },\n    mode: extendFlat({}, scatterAttrs.mode, {dflt: 'markers'}),\n    text: extendFlat({}, scatterAttrs.text, {\n        description: [\n            'Sets text elements associated with each (a,b,c) point.',\n            'If a single string, the same string appears over',\n            'all the data points.',\n            'If an array of strings, the items are mapped in order to the',\n            'the data points in (a,b,c).',\n            'If trace `hoverinfo` contains a *text* flag and *hovertext* is not set,',\n            'these elements will be seen in the hover labels.'\n        ].join(' ')\n    }),\n    texttemplate: texttemplateAttrs({editType: 'plot'}, {\n        keys: ['a', 'b', 'c', 'text']\n    }),\n    hovertext: extendFlat({}, scatterAttrs.hovertext, {\n        description: [\n            'Sets hover text elements associated with each (a,b,c) point.',\n            'If a single string, the same string appears over',\n            'all the data points.',\n            'If an array of strings, the items are mapped in order to the',\n            'the data points in (a,b,c).',\n            'To be seen, trace `hoverinfo` must contain a *text* flag.'\n        ].join(' ')\n    }),\n    line: {\n        color: scatterLineAttrs.color,\n        width: scatterLineAttrs.width,\n        dash: dash,\n        shape: extendFlat({}, scatterLineAttrs.shape,\n            {values: ['linear', 'spline']}),\n        smoothing: scatterLineAttrs.smoothing,\n        editType: 'calc'\n    },\n    connectgaps: scatterAttrs.connectgaps,\n    cliponaxis: scatterAttrs.cliponaxis,\n    fill: extendFlat({}, scatterAttrs.fill, {\n        values: ['none', 'toself', 'tonext'],\n        dflt: 'none',\n        description: [\n            'Sets the area to fill with a solid color.',\n            'Use with `fillcolor` if not *none*.',\n            'scatterternary has a subset of the options available to scatter.',\n            '*toself* connects the endpoints of the trace (or each segment',\n            'of the trace if it has gaps) into a closed shape.',\n            '*tonext* fills the space between two traces if one completely',\n            'encloses the other (eg consecutive contour lines), and behaves like',\n            '*toself* if there is no trace before it. *tonext* should not be',\n            'used if one trace does not enclose the other.'\n        ].join(' ')\n    }),\n    fillcolor: scatterAttrs.fillcolor,\n    marker: extendFlat({\n        symbol: scatterMarkerAttrs.symbol,\n        opacity: scatterMarkerAttrs.opacity,\n        maxdisplayed: scatterMarkerAttrs.maxdisplayed,\n        size: scatterMarkerAttrs.size,\n        sizeref: scatterMarkerAttrs.sizeref,\n        sizemin: scatterMarkerAttrs.sizemin,\n        sizemode: scatterMarkerAttrs.sizemode,\n        line: extendFlat({\n            width: scatterMarkerLineAttrs.width,\n            editType: 'calc'\n        },\n            colorScaleAttrs('marker.line')\n        ),\n        gradient: scatterMarkerAttrs.gradient,\n        editType: 'calc'\n    },\n        colorScaleAttrs('marker')\n    ),\n\n    textfont: scatterAttrs.textfont,\n    textposition: scatterAttrs.textposition,\n\n    selected: scatterAttrs.selected,\n    unselected: scatterAttrs.unselected,\n\n    hoverinfo: extendFlat({}, baseAttrs.hoverinfo, {\n        flags: ['a', 'b', 'c', 'text', 'name']\n    }),\n    hoveron: scatterAttrs.hoveron,\n    hovertemplate: hovertemplateAttrs(),\n};\n","'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\nvar calcColorscale = require('../scatter/colorscale_calc');\nvar arraysToCalcdata = require('../scatter/arrays_to_calcdata');\nvar calcSelection = require('../scatter/calc_selection');\nvar calcMarkerSize = require('../scatter/calc').calcMarkerSize;\n\nvar dataArrays = ['a', 'b', 'c'];\nvar arraysToFill = {a: ['b', 'c'], b: ['a', 'c'], c: ['a', 'b']};\n\nmodule.exports = function calc(gd, trace) {\n    var ternary = gd._fullLayout[trace.subplot];\n    var displaySum = ternary.sum;\n    var normSum = trace.sum || displaySum;\n    var arrays = {a: trace.a, b: trace.b, c: trace.c};\n\n    var i, j, dataArray, newArray, fillArray1, fillArray2;\n\n    // fill in one missing component\n    for(i = 0; i < dataArrays.length; i++) {\n        dataArray = dataArrays[i];\n        if(arrays[dataArray]) continue;\n\n        fillArray1 = arrays[arraysToFill[dataArray][0]];\n        fillArray2 = arrays[arraysToFill[dataArray][1]];\n        newArray = new Array(fillArray1.length);\n        for(j = 0; j < fillArray1.length; j++) {\n            newArray[j] = normSum - fillArray1[j] - fillArray2[j];\n        }\n        arrays[dataArray] = newArray;\n    }\n\n    // make the calcdata array\n    var serieslen = trace._length;\n    var cd = new Array(serieslen);\n    var a, b, c, norm, x, y;\n    for(i = 0; i < serieslen; i++) {\n        a = arrays.a[i];\n        b = arrays.b[i];\n        c = arrays.c[i];\n        if(isNumeric(a) && isNumeric(b) && isNumeric(c)) {\n            a = +a;\n            b = +b;\n            c = +c;\n            norm = displaySum / (a + b + c);\n            if(norm !== 1) {\n                a *= norm;\n                b *= norm;\n                c *= norm;\n            }\n            // map a, b, c onto x and y where the full scale of y\n            // is [0, sum], and x is [-sum, sum]\n            // TODO: this makes `a` always the top, `b` the bottom left,\n            // and `c` the bottom right. Do we want options to rearrange\n            // these?\n            y = a;\n            x = c - b;\n            cd[i] = {x: x, y: y, a: a, b: b, c: c};\n        } else cd[i] = {x: false, y: false};\n    }\n\n    calcMarkerSize(trace, serieslen);\n    calcColorscale(gd, trace);\n    arraysToCalcdata(cd, trace);\n    calcSelection(cd, trace);\n\n    return cd;\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\nvar constants = require('../scatter/constants');\nvar subTypes = require('../scatter/subtypes');\nvar handleMarkerDefaults = require('../scatter/marker_defaults');\nvar handleLineDefaults = require('../scatter/line_defaults');\nvar handleLineShapeDefaults = require('../scatter/line_shape_defaults');\nvar handleTextDefaults = require('../scatter/text_defaults');\nvar handleFillColorDefaults = require('../scatter/fillcolor_defaults');\n\nvar attributes = require('./attributes');\n\n\nmodule.exports = function supplyDefaults(traceIn, traceOut, defaultColor, layout) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(traceIn, traceOut, attributes, attr, dflt);\n    }\n\n    var a = coerce('a');\n    var b = coerce('b');\n    var c = coerce('c');\n    var len;\n\n    // allow any one array to be missing, len is the minimum length of those\n    // present. Note that after coerce data_array's are either Arrays (which\n    // are truthy even if empty) or undefined. As in scatter, an empty array\n    // is different from undefined, because it can signify that this data is\n    // not known yet but expected in the future\n    if(a) {\n        len = a.length;\n        if(b) {\n            len = Math.min(len, b.length);\n            if(c) len = Math.min(len, c.length);\n        } else if(c) len = Math.min(len, c.length);\n        else len = 0;\n    } else if(b && c) {\n        len = Math.min(b.length, c.length);\n    }\n\n    if(!len) {\n        traceOut.visible = false;\n        return;\n    }\n\n    traceOut._length = len;\n\n    coerce('sum');\n\n    coerce('text');\n    coerce('hovertext');\n    if(traceOut.hoveron !== 'fills') coerce('hovertemplate');\n\n    var defaultMode = len < constants.PTS_LINESONLY ? 'lines+markers' : 'lines';\n    coerce('mode', defaultMode);\n\n    if(subTypes.hasLines(traceOut)) {\n        handleLineDefaults(traceIn, traceOut, defaultColor, layout, coerce);\n        handleLineShapeDefaults(traceIn, traceOut, coerce);\n        coerce('connectgaps');\n    }\n\n    if(subTypes.hasMarkers(traceOut)) {\n        handleMarkerDefaults(traceIn, traceOut, defaultColor, layout, coerce, {gradient: true});\n    }\n\n    if(subTypes.hasText(traceOut)) {\n        coerce('texttemplate');\n        handleTextDefaults(traceIn, traceOut, layout, coerce);\n    }\n\n    var dfltHoverOn = [];\n\n    if(subTypes.hasMarkers(traceOut) || subTypes.hasText(traceOut)) {\n        coerce('cliponaxis');\n        coerce('marker.maxdisplayed');\n        dfltHoverOn.push('points');\n    }\n\n    coerce('fill');\n    if(traceOut.fill !== 'none') {\n        handleFillColorDefaults(traceIn, traceOut, defaultColor, coerce);\n        if(!subTypes.hasLines(traceOut)) handleLineShapeDefaults(traceIn, traceOut, coerce);\n    }\n\n    if(traceOut.fill === 'tonext' || traceOut.fill === 'toself') {\n        dfltHoverOn.push('fills');\n    }\n    coerce('hoveron', dfltHoverOn.join('+') || 'points');\n\n    Lib.coerceSelectionMarkerOpacity(traceOut, coerce);\n};\n","'use strict';\n\nmodule.exports = function eventData(out, pt, trace, cd, pointNumber) {\n    if(pt.xa) out.xaxis = pt.xa;\n    if(pt.ya) out.yaxis = pt.ya;\n\n    if(cd[pointNumber]) {\n        var cdi = cd[pointNumber];\n\n        // N.B. These are the normalized coordinates.\n        out.a = cdi.a;\n        out.b = cdi.b;\n        out.c = cdi.c;\n    } else {\n        // for fill-hover only\n        out.a = pt.a;\n        out.b = pt.b;\n        out.c = pt.c;\n    }\n\n    return out;\n};\n","'use strict';\n\nvar Axes = require('../../plots/cartesian/axes');\n\nmodule.exports = function formatLabels(cdi, trace, fullLayout) {\n    var labels = {};\n\n    var subplot = fullLayout[trace.subplot]._subplot;\n    labels.aLabel = Axes.tickText(subplot.aaxis, cdi.a, true).text;\n    labels.bLabel = Axes.tickText(subplot.baxis, cdi.b, true).text;\n    labels.cLabel = Axes.tickText(subplot.caxis, cdi.c, true).text;\n\n    return labels;\n};\n","'use strict';\n\nvar scatterHover = require('../scatter/hover');\n\nmodule.exports = function hoverPoints(pointData, xval, yval, hovermode) {\n    var scatterPointData = scatterHover(pointData, xval, yval, hovermode);\n    if(!scatterPointData || scatterPointData[0].index === false) return;\n\n    var newPointData = scatterPointData[0];\n\n    // if hovering on a fill, we don't show any point data so the label is\n    // unchanged from what scatter gives us - except that it needs to\n    // be constrained to the trianglular plot area, not just the rectangular\n    // area defined by the synthetic x and y axes\n    // TODO: in some cases the vertical middle of the shape is not within\n    // the triangular viewport at all, so the label can become disconnected\n    // from the shape entirely. But calculating what portion of the shape\n    // is actually visible, as constrained by the diagonal axis lines, is not\n    // so easy and anyway we lost the information we would have needed to do\n    // this inside scatterHover.\n    if(newPointData.index === undefined) {\n        var yFracUp = 1 - (newPointData.y0 / pointData.ya._length);\n        var xLen = pointData.xa._length;\n        var xMin = xLen * yFracUp / 2;\n        var xMax = xLen - xMin;\n        newPointData.x0 = Math.max(Math.min(newPointData.x0, xMax), xMin);\n        newPointData.x1 = Math.max(Math.min(newPointData.x1, xMax), xMin);\n        return scatterPointData;\n    }\n\n    var cdi = newPointData.cd[newPointData.index];\n    var trace = newPointData.trace;\n    var subplot = newPointData.subplot;\n\n    newPointData.a = cdi.a;\n    newPointData.b = cdi.b;\n    newPointData.c = cdi.c;\n\n    newPointData.xLabelVal = undefined;\n    newPointData.yLabelVal = undefined;\n\n    var fullLayout = {};\n    fullLayout[trace.subplot] = {_subplot: subplot};\n    var labels = trace._module.formatLabels(cdi, trace, fullLayout);\n    newPointData.aLabel = labels.aLabel;\n    newPointData.bLabel = labels.bLabel;\n    newPointData.cLabel = labels.cLabel;\n\n    var hoverinfo = cdi.hi || trace.hoverinfo;\n    var text = [];\n    function textPart(ax, val) {\n        text.push(ax._hovertitle + ': ' + val);\n    }\n    if(!trace.hovertemplate) {\n        var parts = hoverinfo.split('+');\n        if(parts.indexOf('all') !== -1) parts = ['a', 'b', 'c'];\n        if(parts.indexOf('a') !== -1) textPart(subplot.aaxis, newPointData.aLabel);\n        if(parts.indexOf('b') !== -1) textPart(subplot.baxis, newPointData.bLabel);\n        if(parts.indexOf('c') !== -1) textPart(subplot.caxis, newPointData.cLabel);\n    }\n    newPointData.extraText = text.join('<br>');\n    newPointData.hovertemplate = trace.hovertemplate;\n    return scatterPointData;\n};\n","'use strict';\n\nmodule.exports = {\n    attributes: require('./attributes'),\n    supplyDefaults: require('./defaults'),\n    colorbar: require('../scatter/marker_colorbar'),\n    formatLabels: require('./format_labels'),\n    calc: require('./calc'),\n    plot: require('./plot'),\n    style: require('../scatter/style').style,\n    styleOnSelect: require('../scatter/style').styleOnSelect,\n    hoverPoints: require('./hover'),\n    selectPoints: require('../scatter/select'),\n    eventData: require('./event_data'),\n\n    moduleType: 'trace',\n    name: 'scatterternary',\n    basePlotModule: require('../../plots/ternary'),\n    categories: ['ternary', 'symbols', 'showLegend', 'scatter-like'],\n    meta: {\n        hrName: 'scatter_ternary',\n        description: [\n            'Provides similar functionality to the *scatter* type but on a ternary phase diagram.',\n            'The data is provided by at least two arrays out of `a`, `b`, `c` triplets.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar scatterPlot = require('../scatter/plot');\n\nmodule.exports = function plot(gd, ternary, moduleCalcData) {\n    var plotContainer = ternary.plotContainer;\n\n    // remove all nodes inside the scatter layer\n    plotContainer.select('.scatterlayer').selectAll('*').remove();\n\n    // mimic cartesian plotinfo\n    var plotinfo = {\n        xaxis: ternary.xaxis,\n        yaxis: ternary.yaxis,\n        plot: plotContainer,\n        layerClipId: ternary._hasClipOnAxisFalse ? ternary.clipIdRelative : null\n    };\n\n    var scatterLayer = ternary.layers.frontplot.select('g.scatterlayer');\n\n    scatterPlot(gd, plotinfo, moduleCalcData, scatterLayer);\n};\n","'use strict';\n\nvar boxAttrs = require('../box/attributes');\nvar extendFlat = require('../../lib/extend').extendFlat;\nvar axisHoverFormat = require('../../plots/cartesian/axis_format_attributes').axisHoverFormat;\n\nmodule.exports = {\n    y: boxAttrs.y,\n    x: boxAttrs.x,\n    x0: boxAttrs.x0,\n    y0: boxAttrs.y0,\n\n    xhoverformat: axisHoverFormat('x'),\n    yhoverformat: axisHoverFormat('y'),\n\n    name: extendFlat({}, boxAttrs.name, {\n        description: [\n            'Sets the trace name.',\n            'The trace name appear as the legend item and on hover.',\n            'For violin traces, the name will also be used for the position',\n            'coordinate, if `x` and `x0` (`y` and `y0` if horizontal) are',\n            'missing and the position axis is categorical.',\n            'Note that the trace name is also used as a default value',\n            'for attribute `scalegroup` (please see its description for details).'\n        ].join(' ')\n    }),\n    orientation: extendFlat({}, boxAttrs.orientation, {\n        description: [\n            'Sets the orientation of the violin(s).',\n            'If *v* (*h*), the distribution is visualized along',\n            'the vertical (horizontal).'\n        ].join(' ')\n    }),\n\n    bandwidth: {\n        valType: 'number',\n        min: 0,\n        editType: 'calc',\n        description: [\n            'Sets the bandwidth used to compute the kernel density estimate.',\n            'By default, the bandwidth is determined by Silverman\\'s rule of thumb.'\n        ].join(' ')\n    },\n\n    scalegroup: {\n        valType: 'string',\n        dflt: '',\n        editType: 'calc',\n        description: [\n            'If there are multiple violins that should be sized according to',\n            'to some metric (see `scalemode`), link them by providing a non-empty group id here',\n            'shared by every trace in the same group.',\n            'If a violin\\'s `width` is undefined, `scalegroup` will default to the trace\\'s name.',\n            'In this case, violins with the same names will be linked together'\n        ].join(' ')\n    },\n    scalemode: {\n        valType: 'enumerated',\n        values: ['width', 'count'],\n        dflt: 'width',\n        editType: 'calc',\n        description: [\n            'Sets the metric by which the width of each violin is determined.',\n            '*width* means each violin has the same (max) width',\n            '*count* means the violins are scaled by the number of sample points making',\n            'up each violin.'\n        ].join('')\n    },\n\n    spanmode: {\n        valType: 'enumerated',\n        values: ['soft', 'hard', 'manual'],\n        dflt: 'soft',\n        editType: 'calc',\n        description: [\n            'Sets the method by which the span in data space where the density function will be computed.',\n            '*soft* means the span goes from the sample\\'s minimum value minus two bandwidths',\n            'to the sample\\'s maximum value plus two bandwidths.',\n            '*hard* means the span goes from the sample\\'s minimum to its maximum value.',\n            'For custom span settings, use mode *manual* and fill in the `span` attribute.'\n        ].join(' ')\n    },\n    span: {\n        valType: 'info_array',\n        items: [\n            {valType: 'any', editType: 'calc'},\n            {valType: 'any', editType: 'calc'}\n        ],\n        editType: 'calc',\n        description: [\n            'Sets the span in data space for which the density function will be computed.',\n            'Has an effect only when `spanmode` is set to *manual*.'\n        ].join(' ')\n    },\n\n    line: {\n        color: {\n            valType: 'color',\n            editType: 'style',\n            description: 'Sets the color of line bounding the violin(s).'\n        },\n        width: {\n            valType: 'number',\n            min: 0,\n            dflt: 2,\n            editType: 'style',\n            description: 'Sets the width (in px) of line bounding the violin(s).'\n        },\n        editType: 'plot'\n    },\n    fillcolor: boxAttrs.fillcolor,\n\n    points: extendFlat({}, boxAttrs.boxpoints, {\n        description: [\n            'If *outliers*, only the sample points lying outside the whiskers',\n            'are shown',\n            'If *suspectedoutliers*, the outlier points are shown and',\n            'points either less than 4*Q1-3*Q3 or greater than 4*Q3-3*Q1',\n            'are highlighted (see `outliercolor`)',\n            'If *all*, all sample points are shown',\n            'If *false*, only the violins are shown with no sample points.',\n            'Defaults to *suspectedoutliers* when `marker.outliercolor` or',\n            '`marker.line.outliercolor` is set,',\n            'otherwise defaults to *outliers*.'\n        ].join(' ')\n    }),\n    jitter: extendFlat({}, boxAttrs.jitter, {\n        description: [\n            'Sets the amount of jitter in the sample points drawn.',\n            'If *0*, the sample points align along the distribution axis.',\n            'If *1*, the sample points are drawn in a random jitter of width',\n            'equal to the width of the violins.'\n        ].join(' ')\n    }),\n    pointpos: extendFlat({}, boxAttrs.pointpos, {\n        description: [\n            'Sets the position of the sample points in relation to the violins.',\n            'If *0*, the sample points are places over the center of the violins.',\n            'Positive (negative) values correspond to positions to the',\n            'right (left) for vertical violins and above (below) for horizontal violins.'\n        ].join(' ')\n    }),\n\n    width: extendFlat({}, boxAttrs.width, {\n        description: [\n            'Sets the width of the violin in data coordinates.',\n            'If *0* (default value) the width is automatically selected based on the positions',\n            'of other violin traces in the same subplot.',\n        ].join(' ')\n    }),\n\n    marker: boxAttrs.marker,\n    text: boxAttrs.text,\n    hovertext: boxAttrs.hovertext,\n    hovertemplate: boxAttrs.hovertemplate,\n\n    box: {\n        visible: {\n            valType: 'boolean',\n            dflt: false,\n            editType: 'plot',\n            description: [\n                'Determines if an miniature box plot is drawn inside the violins. '\n            ].join(' ')\n        },\n        width: {\n            valType: 'number',\n            min: 0,\n            max: 1,\n            dflt: 0.25,\n            editType: 'plot',\n            description: [\n                'Sets the width of the inner box plots relative to',\n                'the violins\\' width.',\n                'For example, with 1, the inner box plots are as wide as the violins.'\n            ].join(' ')\n        },\n        fillcolor: {\n            valType: 'color',\n            editType: 'style',\n            description: 'Sets the inner box plot fill color.'\n        },\n        line: {\n            color: {\n                valType: 'color',\n                editType: 'style',\n                description: 'Sets the inner box plot bounding line color.'\n            },\n            width: {\n                valType: 'number',\n                min: 0,\n                editType: 'style',\n                description: 'Sets the inner box plot bounding line width.'\n            },\n            editType: 'style'\n        },\n        editType: 'plot'\n    },\n\n    meanline: {\n        visible: {\n            valType: 'boolean',\n            dflt: false,\n            editType: 'plot',\n            description: [\n                'Determines if a line corresponding to the sample\\'s mean is shown',\n                'inside the violins.',\n                'If `box.visible` is turned on, the mean line is drawn inside the inner box.',\n                'Otherwise, the mean line is drawn from one side of the violin to other.'\n            ].join(' ')\n        },\n        color: {\n            valType: 'color',\n            editType: 'style',\n            description: 'Sets the mean line color.'\n        },\n        width: {\n            valType: 'number',\n            min: 0,\n            editType: 'style',\n            description: 'Sets the mean line width.'\n        },\n        editType: 'plot'\n    },\n\n    side: {\n        valType: 'enumerated',\n        values: ['both', 'positive', 'negative'],\n        dflt: 'both',\n        editType: 'calc',\n        description: [\n            'Determines on which side of the position value the density function making up',\n            'one half of a violin is plotted.',\n            'Useful when comparing two violin traces under *overlay* mode, where one trace',\n            'has `side` set to *positive* and the other to *negative*.'\n        ].join(' ')\n    },\n\n    offsetgroup: boxAttrs.offsetgroup,\n    alignmentgroup: boxAttrs.alignmentgroup,\n\n    selected: boxAttrs.selected,\n    unselected: boxAttrs.unselected,\n\n    hoveron: {\n        valType: 'flaglist',\n        flags: ['violins', 'points', 'kde'],\n        dflt: 'violins+points+kde',\n        extras: ['all'],\n        editType: 'style',\n        description: [\n            'Do the hover effects highlight individual violins',\n            'or sample points or the kernel density estimate or any combination of them?'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Axes = require('../../plots/cartesian/axes');\nvar boxCalc = require('../box/calc');\nvar helpers = require('./helpers');\nvar BADNUM = require('../../constants/numerical').BADNUM;\n\nmodule.exports = function calc(gd, trace) {\n    var cd = boxCalc(gd, trace);\n\n    if(cd[0].t.empty) return cd;\n\n    var fullLayout = gd._fullLayout;\n    var valAxis = Axes.getFromId(\n        gd,\n        trace[trace.orientation === 'h' ? 'xaxis' : 'yaxis']\n    );\n\n    var spanMin = Infinity;\n    var spanMax = -Infinity;\n    var maxKDE = 0;\n    var maxCount = 0;\n\n    for(var i = 0; i < cd.length; i++) {\n        var cdi = cd[i];\n        var vals = cdi.pts.map(helpers.extractVal);\n\n        var bandwidth = cdi.bandwidth = calcBandwidth(trace, cdi, vals);\n        var span = cdi.span = calcSpan(trace, cdi, valAxis, bandwidth);\n\n        if(cdi.min === cdi.max && bandwidth === 0) {\n            // if span is zero and bandwidth is zero, we want a violin with zero width\n            span = cdi.span = [cdi.min, cdi.max];\n            cdi.density = [{v: 1, t: span[0]}];\n            cdi.bandwidth = bandwidth;\n            maxKDE = Math.max(maxKDE, 1);\n        } else {\n            // step that well covers the bandwidth and is multiple of span distance\n            var dist = span[1] - span[0];\n            var n = Math.ceil(dist / (bandwidth / 3));\n            var step = dist / n;\n\n            if(!isFinite(step) || !isFinite(n)) {\n                Lib.error('Something went wrong with computing the violin span');\n                cd[0].t.empty = true;\n                return cd;\n            }\n\n            var kde = helpers.makeKDE(cdi, trace, vals);\n            cdi.density = new Array(n);\n\n            for(var k = 0, t = span[0]; t < (span[1] + step / 2); k++, t += step) {\n                var v = kde(t);\n                cdi.density[k] = {v: v, t: t};\n                maxKDE = Math.max(maxKDE, v);\n            }\n        }\n\n        maxCount = Math.max(maxCount, vals.length);\n        spanMin = Math.min(spanMin, span[0]);\n        spanMax = Math.max(spanMax, span[1]);\n    }\n\n    var extremes = Axes.findExtremes(valAxis, [spanMin, spanMax], {padded: true});\n    trace._extremes[valAxis._id] = extremes;\n\n    if(trace.width) {\n        cd[0].t.maxKDE = maxKDE;\n    } else {\n        var violinScaleGroupStats = fullLayout._violinScaleGroupStats;\n        var scaleGroup = trace.scalegroup;\n        var groupStats = violinScaleGroupStats[scaleGroup];\n\n        if(groupStats) {\n            groupStats.maxKDE = Math.max(groupStats.maxKDE, maxKDE);\n            groupStats.maxCount = Math.max(groupStats.maxCount, maxCount);\n        } else {\n            violinScaleGroupStats[scaleGroup] = {\n                maxKDE: maxKDE,\n                maxCount: maxCount\n            };\n        }\n    }\n\n    cd[0].t.labels.kde = Lib._(gd, 'kde:');\n\n    return cd;\n};\n\n// Default to Silveman's rule of thumb\n// - https://stats.stackexchange.com/a/6671\n// - https://en.wikipedia.org/wiki/Kernel_density_estimation#A_rule-of-thumb_bandwidth_estimator\n// - https://github.com/statsmodels/statsmodels/blob/master/statsmodels/nonparametric/bandwidths.py\nfunction silvermanRule(len, ssd, iqr) {\n    var a = Math.min(ssd, iqr / 1.349);\n    return 1.059 * a * Math.pow(len, -0.2);\n}\n\nfunction calcBandwidth(trace, cdi, vals) {\n    var span = cdi.max - cdi.min;\n\n    // If span is zero\n    if(!span) {\n        if(trace.bandwidth) {\n            return trace.bandwidth;\n        } else {\n            // if span is zero and no bandwidth is specified\n            // it returns zero bandwidth which is a special case\n            return 0;\n        }\n    }\n\n    // Limit how small the bandwidth can be.\n    //\n    // Silverman's rule of thumb can be \"very\" small\n    // when IQR does a poor job at describing the spread\n    // of the distribution.\n    // We also want to limit custom bandwidths\n    // to not blow up kde computations.\n\n    if(trace.bandwidth) {\n        return Math.max(trace.bandwidth, span / 1e4);\n    } else {\n        var len = vals.length;\n        var ssd = Lib.stdev(vals, len - 1, cdi.mean);\n        return Math.max(\n            silvermanRule(len, ssd, cdi.q3 - cdi.q1),\n            span / 100\n        );\n    }\n}\n\nfunction calcSpan(trace, cdi, valAxis, bandwidth) {\n    var spanmode = trace.spanmode;\n    var spanIn = trace.span || [];\n    var spanTight = [cdi.min, cdi.max];\n    var spanLoose = [cdi.min - 2 * bandwidth, cdi.max + 2 * bandwidth];\n    var spanOut;\n\n    function calcSpanItem(index) {\n        var s = spanIn[index];\n        var sc = valAxis.type === 'multicategory' ?\n            valAxis.r2c(s) :\n            valAxis.d2c(s, 0, trace[cdi.valLetter + 'calendar']);\n        return sc === BADNUM ? spanLoose[index] : sc;\n    }\n\n    if(spanmode === 'soft') {\n        spanOut = spanLoose;\n    } else if(spanmode === 'hard') {\n        spanOut = spanTight;\n    } else {\n        spanOut = [calcSpanItem(0), calcSpanItem(1)];\n    }\n\n    // to reuse the equal-range-item block\n    var dummyAx = {\n        type: 'linear',\n        range: spanOut\n    };\n    Axes.setConvert(dummyAx);\n    dummyAx.cleanRange();\n\n    return spanOut;\n}\n","'use strict';\n\nvar setPositionOffset = require('../box/cross_trace_calc').setPositionOffset;\nvar orientations = ['v', 'h'];\n\nmodule.exports = function crossTraceCalc(gd, plotinfo) {\n    var calcdata = gd.calcdata;\n    var xa = plotinfo.xaxis;\n    var ya = plotinfo.yaxis;\n\n    for(var i = 0; i < orientations.length; i++) {\n        var orientation = orientations[i];\n        var posAxis = orientation === 'h' ? ya : xa;\n        var violinList = [];\n\n        for(var j = 0; j < calcdata.length; j++) {\n            var cd = calcdata[j];\n            var t = cd[0].t;\n            var trace = cd[0].trace;\n\n            if(trace.visible === true && trace.type === 'violin' &&\n                    !t.empty &&\n                    trace.orientation === orientation &&\n                    trace.xaxis === xa._id &&\n                    trace.yaxis === ya._id\n              ) {\n                violinList.push(j);\n            }\n        }\n\n        setPositionOffset('violin', gd, violinList, posAxis);\n    }\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Color = require('../../components/color');\n\nvar boxDefaults = require('../box/defaults');\nvar attributes = require('./attributes');\n\nmodule.exports = function supplyDefaults(traceIn, traceOut, defaultColor, layout) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(traceIn, traceOut, attributes, attr, dflt);\n    }\n    function coerce2(attr, dflt) {\n        return Lib.coerce2(traceIn, traceOut, attributes, attr, dflt);\n    }\n\n    boxDefaults.handleSampleDefaults(traceIn, traceOut, coerce, layout);\n    if(traceOut.visible === false) return;\n\n    coerce('bandwidth');\n    coerce('side');\n\n    var width = coerce('width');\n    if(!width) {\n        coerce('scalegroup', traceOut.name);\n        coerce('scalemode');\n    }\n\n    var span = coerce('span');\n    var spanmodeDflt;\n    if(Array.isArray(span)) spanmodeDflt = 'manual';\n    coerce('spanmode', spanmodeDflt);\n\n    var lineColor = coerce('line.color', (traceIn.marker || {}).color || defaultColor);\n    var lineWidth = coerce('line.width');\n    var fillColor = coerce('fillcolor', Color.addOpacity(traceOut.line.color, 0.5));\n\n    boxDefaults.handlePointsDefaults(traceIn, traceOut, coerce, {prefix: ''});\n\n    var boxWidth = coerce2('box.width');\n    var boxFillColor = coerce2('box.fillcolor', fillColor);\n    var boxLineColor = coerce2('box.line.color', lineColor);\n    var boxLineWidth = coerce2('box.line.width', lineWidth);\n    var boxVisible = coerce('box.visible', Boolean(boxWidth || boxFillColor || boxLineColor || boxLineWidth));\n    if(!boxVisible) traceOut.box = {visible: false};\n\n    var meanLineColor = coerce2('meanline.color', lineColor);\n    var meanLineWidth = coerce2('meanline.width', lineWidth);\n    var meanLineVisible = coerce('meanline.visible', Boolean(meanLineColor || meanLineWidth));\n    if(!meanLineVisible) traceOut.meanline = {visible: false};\n};\n","'use strict';\n\nvar Lib = require('../../lib');\n\n// Maybe add kernels more down the road,\n// but note that the default `spanmode: 'soft'` bounds might have\n// to become kernel-dependent\nvar kernels = {\n    gaussian: function(v) {\n        return (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * v * v);\n    }\n};\n\nexports.makeKDE = function(calcItem, trace, vals) {\n    var len = vals.length;\n    var kernel = kernels.gaussian;\n    var bandwidth = calcItem.bandwidth;\n    var factor = 1 / (len * bandwidth);\n\n    // don't use Lib.aggNums to skip isNumeric checks\n    return function(x) {\n        var sum = 0;\n        for(var i = 0; i < len; i++) {\n            sum += kernel((x - vals[i]) / bandwidth);\n        }\n        return factor * sum;\n    };\n};\n\nexports.getPositionOnKdePath = function(calcItem, trace, valuePx) {\n    var posLetter, valLetter;\n\n    if(trace.orientation === 'h') {\n        posLetter = 'y';\n        valLetter = 'x';\n    } else {\n        posLetter = 'x';\n        valLetter = 'y';\n    }\n\n    var pointOnPath = Lib.findPointOnPath(\n        calcItem.path,\n        valuePx,\n        valLetter,\n        {pathLength: calcItem.pathLength}\n    );\n\n    var posCenterPx = calcItem.posCenterPx;\n    var posOnPath0 = pointOnPath[posLetter];\n    var posOnPath1 = trace.side === 'both' ?\n        2 * posCenterPx - posOnPath0 :\n        posCenterPx;\n\n    return [posOnPath0, posOnPath1];\n};\n\nexports.getKdeValue = function(calcItem, trace, valueDist) {\n    var vals = calcItem.pts.map(exports.extractVal);\n    var kde = exports.makeKDE(calcItem, trace, vals);\n    return kde(valueDist) / calcItem.posDensityScale;\n};\n\nexports.extractVal = function(o) { return o.v; };\n","'use strict';\n\nvar Lib = require('../../lib');\nvar Axes = require('../../plots/cartesian/axes');\nvar boxHoverPoints = require('../box/hover');\nvar helpers = require('./helpers');\n\nmodule.exports = function hoverPoints(pointData, xval, yval, hovermode, opts) {\n    if(!opts) opts = {};\n    var hoverLayer = opts.hoverLayer;\n\n    var cd = pointData.cd;\n    var trace = cd[0].trace;\n    var hoveron = trace.hoveron;\n    var hasHoveronViolins = hoveron.indexOf('violins') !== -1;\n    var hasHoveronKDE = hoveron.indexOf('kde') !== -1;\n    var closeData = [];\n    var closePtData;\n    var violinLineAttrs;\n\n    if(hasHoveronViolins || hasHoveronKDE) {\n        var closeBoxData = boxHoverPoints.hoverOnBoxes(pointData, xval, yval, hovermode);\n\n        if(hasHoveronKDE && closeBoxData.length > 0) {\n            var xa = pointData.xa;\n            var ya = pointData.ya;\n            var pLetter, vLetter, pAxis, vAxis, vVal;\n\n            if(trace.orientation === 'h') {\n                vVal = xval;\n                pLetter = 'y';\n                pAxis = ya;\n                vLetter = 'x';\n                vAxis = xa;\n            } else {\n                vVal = yval;\n                pLetter = 'x';\n                pAxis = xa;\n                vLetter = 'y';\n                vAxis = ya;\n            }\n\n            var di = cd[pointData.index];\n\n            if(vVal >= di.span[0] && vVal <= di.span[1]) {\n                var kdePointData = Lib.extendFlat({}, pointData);\n                var vValPx = vAxis.c2p(vVal, true);\n                var kdeVal = helpers.getKdeValue(di, trace, vVal);\n                var pOnPath = helpers.getPositionOnKdePath(di, trace, vValPx);\n                var paOffset = pAxis._offset;\n                var paLength = pAxis._length;\n\n                kdePointData[pLetter + '0'] = pOnPath[0];\n                kdePointData[pLetter + '1'] = pOnPath[1];\n                kdePointData[vLetter + '0'] = kdePointData[vLetter + '1'] = vValPx;\n                kdePointData[vLetter + 'Label'] = vLetter + ': ' + Axes.hoverLabelText(vAxis, vVal, trace[vLetter + 'hoverformat']) + ', ' + cd[0].t.labels.kde + ' ' + kdeVal.toFixed(3);\n\n                // move the spike to the KDE point\n                kdePointData.spikeDistance = closeBoxData[0].spikeDistance;\n                var spikePosAttr = pLetter + 'Spike';\n                kdePointData[spikePosAttr] = closeBoxData[0][spikePosAttr];\n                closeBoxData[0].spikeDistance = undefined;\n                closeBoxData[0][spikePosAttr] = undefined;\n\n                // no hovertemplate support yet\n                kdePointData.hovertemplate = false;\n\n                closeData.push(kdePointData);\n\n                violinLineAttrs = {stroke: pointData.color};\n                violinLineAttrs[pLetter + '1'] = Lib.constrain(paOffset + pOnPath[0], paOffset, paOffset + paLength);\n                violinLineAttrs[pLetter + '2'] = Lib.constrain(paOffset + pOnPath[1], paOffset, paOffset + paLength);\n                violinLineAttrs[vLetter + '1'] = violinLineAttrs[vLetter + '2'] = vAxis._offset + vValPx;\n            }\n        }\n\n        if(hasHoveronViolins) {\n            closeData = closeData.concat(closeBoxData);\n        }\n    }\n\n    if(hoveron.indexOf('points') !== -1) {\n        closePtData = boxHoverPoints.hoverOnPoints(pointData, xval, yval);\n    }\n\n    // update violin line (if any)\n    var violinLine = hoverLayer.selectAll('.violinline-' + trace.uid)\n        .data(violinLineAttrs ? [0] : []);\n    violinLine.enter().append('line')\n        .classed('violinline-' + trace.uid, true)\n        .attr('stroke-width', 1.5);\n    violinLine.exit().remove();\n    violinLine.attr(violinLineAttrs);\n\n    // same combine logic as box hoverPoints\n    if(hovermode === 'closest') {\n        if(closePtData) return [closePtData];\n        return closeData;\n    }\n    if(closePtData) {\n        closeData.push(closePtData);\n        return closeData;\n    }\n    return closeData;\n};\n","'use strict';\n\nmodule.exports = {\n    attributes: require('./attributes'),\n    layoutAttributes: require('./layout_attributes'),\n    supplyDefaults: require('./defaults'),\n    crossTraceDefaults: require('../box/defaults').crossTraceDefaults,\n    supplyLayoutDefaults: require('./layout_defaults'),\n    calc: require('./calc'),\n    crossTraceCalc: require('./cross_trace_calc'),\n    plot: require('./plot'),\n    style: require('./style'),\n    styleOnSelect: require('../scatter/style').styleOnSelect,\n    hoverPoints: require('./hover'),\n    selectPoints: require('../box/select'),\n\n    moduleType: 'trace',\n    name: 'violin',\n    basePlotModule: require('../../plots/cartesian'),\n    categories: ['cartesian', 'svg', 'symbols', 'oriented', 'box-violin', 'showLegend', 'violinLayout', 'zoomScale'],\n    meta: {\n        description: [\n            'In vertical (horizontal) violin plots,',\n            'statistics are computed using `y` (`x`) values.',\n            'By supplying an `x` (`y`) array, one violin per distinct x (y) value',\n            'is drawn',\n            'If no `x` (`y`) {array} is provided, a single violin is drawn.',\n            'That violin position is then positioned with',\n            'with `name` or with `x0` (`y0`) if provided.'\n        ].join(' ')\n    }\n};\n","'use strict';\n\nvar boxLayoutAttrs = require('../box/layout_attributes');\nvar extendFlat = require('../../lib').extendFlat;\n\nmodule.exports = {\n    violinmode: extendFlat({}, boxLayoutAttrs.boxmode, {\n        description: [\n            'Determines how violins at the same location coordinate',\n            'are displayed on the graph.',\n            'If *group*, the violins are plotted next to one another',\n            'centered around the shared location.',\n            'If *overlay*, the violins are plotted over one another,',\n            'you might need to set *opacity* to see them multiple violins.',\n            'Has no effect on traces that have *width* set.'\n        ].join(' ')\n    }),\n    violingap: extendFlat({}, boxLayoutAttrs.boxgap, {\n        description: [\n            'Sets the gap (in plot fraction) between violins of',\n            'adjacent location coordinates.',\n            'Has no effect on traces that have *width* set.'\n        ].join(' ')\n    }),\n    violingroupgap: extendFlat({}, boxLayoutAttrs.boxgroupgap, {\n        description: [\n            'Sets the gap (in plot fraction) between violins of',\n            'the same location coordinate.',\n            'Has no effect on traces that have *width* set.'\n        ].join(' ')\n    })\n};\n","'use strict';\n\nvar Lib = require('../../lib');\nvar layoutAttributes = require('./layout_attributes');\nvar boxLayoutDefaults = require('../box/layout_defaults');\n\nmodule.exports = function supplyLayoutDefaults(layoutIn, layoutOut, fullData) {\n    function coerce(attr, dflt) {\n        return Lib.coerce(layoutIn, layoutOut, layoutAttributes, attr, dflt);\n    }\n    boxLayoutDefaults._supply(layoutIn, layoutOut, fullData, coerce, 'violin');\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar Lib = require('../../lib');\nvar Drawing = require('../../components/drawing');\n\nvar boxPlot = require('../box/plot');\nvar linePoints = require('../scatter/line_points');\nvar helpers = require('./helpers');\n\nmodule.exports = function plot(gd, plotinfo, cdViolins, violinLayer) {\n    var fullLayout = gd._fullLayout;\n    var xa = plotinfo.xaxis;\n    var ya = plotinfo.yaxis;\n\n    function makePath(pts) {\n        var segments = linePoints(pts, {\n            xaxis: xa,\n            yaxis: ya,\n            connectGaps: true,\n            baseTolerance: 0.75,\n            shape: 'spline',\n            simplify: true,\n            linearized: true\n        });\n        return Drawing.smoothopen(segments[0], 1);\n    }\n\n    Lib.makeTraceGroups(violinLayer, cdViolins, 'trace violins').each(function(cd) {\n        var plotGroup = d3.select(this);\n        var cd0 = cd[0];\n        var t = cd0.t;\n        var trace = cd0.trace;\n\n        if(trace.visible !== true || t.empty) {\n            plotGroup.remove();\n            return;\n        }\n\n        var bPos = t.bPos;\n        var bdPos = t.bdPos;\n        var valAxis = plotinfo[t.valLetter + 'axis'];\n        var posAxis = plotinfo[t.posLetter + 'axis'];\n        var hasBothSides = trace.side === 'both';\n        var hasPositiveSide = hasBothSides || trace.side === 'positive';\n        var hasNegativeSide = hasBothSides || trace.side === 'negative';\n\n        var violins = plotGroup.selectAll('path.violin').data(Lib.identity);\n\n        violins.enter().append('path')\n            .style('vector-effect', 'non-scaling-stroke')\n            .attr('class', 'violin');\n\n        violins.exit().remove();\n\n        violins.each(function(d) {\n            var pathSel = d3.select(this);\n            var density = d.density;\n            var len = density.length;\n            var posCenter = posAxis.c2l(d.pos + bPos, true);\n            var posCenterPx = posAxis.l2p(posCenter);\n\n            var scale;\n            if(trace.width) {\n                scale = t.maxKDE / bdPos;\n            } else {\n                var groupStats = fullLayout._violinScaleGroupStats[trace.scalegroup];\n                scale = trace.scalemode === 'count' ?\n                    (groupStats.maxKDE / bdPos) * (groupStats.maxCount / d.pts.length) :\n                    groupStats.maxKDE / bdPos;\n            }\n\n            var pathPos, pathNeg, path;\n            var i, k, pts, pt;\n\n            if(hasPositiveSide) {\n                pts = new Array(len);\n                for(i = 0; i < len; i++) {\n                    pt = pts[i] = {};\n                    pt[t.posLetter] = posCenter + (density[i].v / scale);\n                    pt[t.valLetter] = valAxis.c2l(density[i].t, true);\n                }\n                pathPos = makePath(pts);\n            }\n\n            if(hasNegativeSide) {\n                pts = new Array(len);\n                for(k = 0, i = len - 1; k < len; k++, i--) {\n                    pt = pts[k] = {};\n                    pt[t.posLetter] = posCenter - (density[i].v / scale);\n                    pt[t.valLetter] = valAxis.c2l(density[i].t, true);\n                }\n                pathNeg = makePath(pts);\n            }\n\n            if(hasBothSides) {\n                path = pathPos + 'L' + pathNeg.substr(1) + 'Z';\n            } else {\n                var startPt = [posCenterPx, valAxis.c2p(density[0].t)];\n                var endPt = [posCenterPx, valAxis.c2p(density[len - 1].t)];\n\n                if(trace.orientation === 'h') {\n                    startPt.reverse();\n                    endPt.reverse();\n                }\n\n                if(hasPositiveSide) {\n                    path = 'M' + startPt + 'L' + pathPos.substr(1) + 'L' + endPt;\n                } else {\n                    path = 'M' + endPt + 'L' + pathNeg.substr(1) + 'L' + startPt;\n                }\n            }\n            pathSel.attr('d', path);\n\n            // save a few things used in getPositionOnKdePath, getKdeValue\n            // on hover and for meanline draw block below\n            d.posCenterPx = posCenterPx;\n            d.posDensityScale = scale * bdPos;\n            d.path = pathSel.node();\n            d.pathLength = d.path.getTotalLength() / (hasBothSides ? 2 : 1);\n        });\n\n        var boxAttrs = trace.box;\n        var boxWidth = boxAttrs.width;\n        var boxLineWidth = (boxAttrs.line || {}).width;\n        var bdPosScaled;\n        var bPosPxOffset;\n\n        if(hasBothSides) {\n            bdPosScaled = bdPos * boxWidth;\n            bPosPxOffset = 0;\n        } else if(hasPositiveSide) {\n            bdPosScaled = [0, bdPos * boxWidth / 2];\n            bPosPxOffset = boxLineWidth * {x: 1, y: -1}[t.posLetter];\n        } else {\n            bdPosScaled = [bdPos * boxWidth / 2, 0];\n            bPosPxOffset = boxLineWidth * {x: -1, y: 1}[t.posLetter];\n        }\n\n        // inner box\n        boxPlot.plotBoxAndWhiskers(plotGroup, {pos: posAxis, val: valAxis}, trace, {\n            bPos: bPos,\n            bdPos: bdPosScaled,\n            bPosPxOffset: bPosPxOffset\n        });\n\n        // meanline insider box\n        boxPlot.plotBoxMean(plotGroup, {pos: posAxis, val: valAxis}, trace, {\n            bPos: bPos,\n            bdPos: bdPosScaled,\n            bPosPxOffset: bPosPxOffset\n        });\n\n        var fn;\n        if(!trace.box.visible && trace.meanline.visible) {\n            fn = Lib.identity;\n        }\n\n        // N.B. use different class name than boxPlot.plotBoxMean,\n        // to avoid selectAll conflict\n        var meanPaths = plotGroup.selectAll('path.meanline').data(fn || []);\n        meanPaths.enter().append('path')\n            .attr('class', 'meanline')\n            .style('fill', 'none')\n            .style('vector-effect', 'non-scaling-stroke');\n        meanPaths.exit().remove();\n        meanPaths.each(function(d) {\n            var v = valAxis.c2p(d.mean, true);\n            var p = helpers.getPositionOnKdePath(d, trace, v);\n\n            d3.select(this).attr('d',\n                trace.orientation === 'h' ?\n                    'M' + v + ',' + p[0] + 'V' + p[1] :\n                    'M' + p[0] + ',' + v + 'H' + p[1]\n            );\n        });\n\n        boxPlot.plotPoints(plotGroup, {x: xa, y: ya}, trace, t);\n    });\n};\n","'use strict';\n\nvar d3 = require('@plotly/d3');\nvar Color = require('../../components/color');\nvar stylePoints = require('../scatter/style').stylePoints;\n\nmodule.exports = function style(gd) {\n    var s = d3.select(gd).selectAll('g.trace.violins');\n\n    s.style('opacity', function(d) { return d[0].trace.opacity; });\n\n    s.each(function(d) {\n        var trace = d[0].trace;\n        var sel = d3.select(this);\n        var box = trace.box || {};\n        var boxLine = box.line || {};\n        var meanline = trace.meanline || {};\n        var meanLineWidth = meanline.width;\n\n        sel.selectAll('path.violin')\n            .style('stroke-width', trace.line.width + 'px')\n            .call(Color.stroke, trace.line.color)\n            .call(Color.fill, trace.fillcolor);\n\n        sel.selectAll('path.box')\n            .style('stroke-width', boxLine.width + 'px')\n            .call(Color.stroke, boxLine.color)\n            .call(Color.fill, box.fillcolor);\n\n        var meanLineStyle = {\n            'stroke-width': meanLineWidth + 'px',\n            'stroke-dasharray': (2 * meanLineWidth) + 'px,' + meanLineWidth + 'px'\n        };\n\n        sel.selectAll('path.mean')\n            .style(meanLineStyle)\n            .call(Color.stroke, meanline.color);\n\n        sel.selectAll('path.meanline')\n            .style(meanLineStyle)\n            .call(Color.stroke, meanline.color);\n\n        stylePoints(sel, trace, gd);\n    });\n};\n","'use strict';\n\nvar Axes = require('../plots/cartesian/axes');\nvar Lib = require('../lib');\nvar PlotSchema = require('../plot_api/plot_schema');\nvar pointsAccessorFunction = require('./helpers').pointsAccessorFunction;\nvar BADNUM = require('../constants/numerical').BADNUM;\n\nexports.moduleType = 'transform';\n\nexports.name = 'aggregate';\n\nvar attrs = exports.attributes = {\n    enabled: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'calc',\n        description: [\n            'Determines whether this aggregate transform is enabled or disabled.'\n        ].join(' ')\n    },\n    groups: {\n        // TODO: groupby should support string or array grouping this way too\n        // currently groupby only allows a grouping array\n        valType: 'string',\n        strict: true,\n        noBlank: true,\n        arrayOk: true,\n        dflt: 'x',\n        editType: 'calc',\n        description: [\n            'Sets the grouping target to which the aggregation is applied.',\n            'Data points with matching group values will be coalesced into',\n            'one point, using the supplied aggregation functions to reduce data',\n            'in other data arrays.',\n            'If a string, `groups` is assumed to be a reference to a data array',\n            'in the parent trace object.',\n            'To aggregate by nested variables, use *.* to access them.',\n            'For example, set `groups` to *marker.color* to aggregate',\n            'about the marker color array.',\n            'If an array, `groups` is itself the data array by which we aggregate.'\n        ].join(' ')\n    },\n    aggregations: {\n        _isLinkedToArray: 'aggregation',\n        target: {\n            valType: 'string',\n            editType: 'calc',\n            description: [\n                'A reference to the data array in the parent trace to aggregate.',\n                'To aggregate by nested variables, use *.* to access them.',\n                'For example, set `groups` to *marker.color* to aggregate',\n                'over the marker color array.',\n                'The referenced array must already exist, unless `func` is *count*,',\n                'and each array may only be referenced once.'\n            ].join(' ')\n        },\n        func: {\n            valType: 'enumerated',\n            values: ['count', 'sum', 'avg', 'median', 'mode', 'rms', 'stddev', 'min', 'max', 'first', 'last', 'change', 'range'],\n            dflt: 'first',\n            editType: 'calc',\n            description: [\n                'Sets the aggregation function.',\n                'All values from the linked `target`, corresponding to the same value',\n                'in the `groups` array, are collected and reduced by this function.',\n                '*count* is simply the number of values in the `groups` array, so does',\n                'not even require the linked array to exist. *first* (*last*) is just',\n                'the first (last) linked value.',\n                'Invalid values are ignored, so for example in *avg* they do not',\n                'contribute to either the numerator or the denominator.',\n                'Any data type (numeric, date, category) may be aggregated with any',\n                'function, even though in certain cases it is unlikely to make sense,',\n                'for example a sum of dates or average of categories.',\n                '*median* will return the average of the two central values if there is',\n                'an even count. *mode* will return the first value to reach the maximum',\n                'count, in case of a tie.',\n                '*change* will return the difference between the first and last linked values.',\n                '*range* will return the difference between the min and max linked values.'\n            ].join(' ')\n        },\n        funcmode: {\n            valType: 'enumerated',\n            values: ['sample', 'population'],\n            dflt: 'sample',\n            editType: 'calc',\n            description: [\n                '*stddev* supports two formula variants: *sample* (normalize by N-1)',\n                'and *population* (normalize by N).'\n            ].join(' ')\n        },\n        enabled: {\n            valType: 'boolean',\n            dflt: true,\n            editType: 'calc',\n            description: [\n                'Determines whether this aggregation function is enabled or disabled.'\n            ].join(' ')\n        },\n        editType: 'calc'\n    },\n    editType: 'calc'\n};\n\nvar aggAttrs = attrs.aggregations;\n\n/**\n * Supply transform attributes defaults\n *\n * @param {object} transformIn\n *  object linked to trace.transforms[i] with 'func' set to exports.name\n * @param {object} traceOut\n *  the _fullData trace this transform applies to\n * @param {object} layout\n *  the plot's (not-so-full) layout\n * @param {object} traceIn\n *  the input data trace this transform applies to\n *\n * @return {object} transformOut\n *  copy of transformIn that contains attribute defaults\n */\nexports.supplyDefaults = function(transformIn, traceOut) {\n    var transformOut = {};\n    var i;\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(transformIn, transformOut, attrs, attr, dflt);\n    }\n\n    var enabled = coerce('enabled');\n\n    if(!enabled) return transformOut;\n\n    /*\n     * Normally _arrayAttrs is calculated during doCalc, but that comes later.\n     * Anyway this can change due to *count* aggregations (see below) so it's not\n     * necessarily the same set.\n     *\n     * For performance we turn it into an object of truthy values\n     * we'll use 1 for arrays we haven't aggregated yet, 0 for finished arrays,\n     * as distinct from undefined which means this array isn't present in the input\n     * missing arrays can still be aggregate outputs for *count* aggregations.\n     */\n    var arrayAttrArray = PlotSchema.findArrayAttributes(traceOut);\n    var arrayAttrs = {};\n    for(i = 0; i < arrayAttrArray.length; i++) arrayAttrs[arrayAttrArray[i]] = 1;\n\n    var groups = coerce('groups');\n\n    if(!Array.isArray(groups)) {\n        if(!arrayAttrs[groups]) {\n            transformOut.enabled = false;\n            return transformOut;\n        }\n        arrayAttrs[groups] = 0;\n    }\n\n    var aggregationsIn = transformIn.aggregations || [];\n    var aggregationsOut = transformOut.aggregations = new Array(aggregationsIn.length);\n    var aggregationOut;\n\n    function coercei(attr, dflt) {\n        return Lib.coerce(aggregationsIn[i], aggregationOut, aggAttrs, attr, dflt);\n    }\n\n    for(i = 0; i < aggregationsIn.length; i++) {\n        aggregationOut = {_index: i};\n        var target = coercei('target');\n        var func = coercei('func');\n        var enabledi = coercei('enabled');\n\n        // add this aggregation to the output only if it's the first instance\n        // of a valid target attribute - or an unused target attribute with \"count\"\n        if(enabledi && target && (arrayAttrs[target] || (func === 'count' && arrayAttrs[target] === undefined))) {\n            if(func === 'stddev') coercei('funcmode');\n\n            arrayAttrs[target] = 0;\n            aggregationsOut[i] = aggregationOut;\n        } else aggregationsOut[i] = {enabled: false, _index: i};\n    }\n\n    // any array attributes we haven't yet covered, fill them with the default aggregation\n    for(i = 0; i < arrayAttrArray.length; i++) {\n        if(arrayAttrs[arrayAttrArray[i]]) {\n            aggregationsOut.push({\n                target: arrayAttrArray[i],\n                func: aggAttrs.func.dflt,\n                enabled: true,\n                _index: -1\n            });\n        }\n    }\n\n    return transformOut;\n};\n\n\nexports.calcTransform = function(gd, trace, opts) {\n    if(!opts.enabled) return;\n\n    var groups = opts.groups;\n\n    var groupArray = Lib.getTargetArray(trace, {target: groups});\n    if(!groupArray) return;\n\n    var i, vi, groupIndex, newGrouping;\n\n    var groupIndices = {};\n    var indexToPoints = {};\n    var groupings = [];\n\n    var originalPointsAccessor = pointsAccessorFunction(trace.transforms, opts);\n\n    var len = groupArray.length;\n    if(trace._length) len = Math.min(len, trace._length);\n\n    for(i = 0; i < len; i++) {\n        vi = groupArray[i];\n        groupIndex = groupIndices[vi];\n        if(groupIndex === undefined) {\n            groupIndices[vi] = groupings.length;\n            newGrouping = [i];\n            groupings.push(newGrouping);\n            indexToPoints[groupIndices[vi]] = originalPointsAccessor(i);\n        } else {\n            groupings[groupIndex].push(i);\n            indexToPoints[groupIndices[vi]] = (indexToPoints[groupIndices[vi]] || []).concat(originalPointsAccessor(i));\n        }\n    }\n\n    opts._indexToPoints = indexToPoints;\n\n    var aggregations = opts.aggregations;\n\n    for(i = 0; i < aggregations.length; i++) {\n        aggregateOneArray(gd, trace, groupings, aggregations[i]);\n    }\n\n    if(typeof groups === 'string') {\n        aggregateOneArray(gd, trace, groupings, {\n            target: groups,\n            func: 'first',\n            enabled: true\n        });\n    }\n\n    trace._length = groupings.length;\n};\n\nfunction aggregateOneArray(gd, trace, groupings, aggregation) {\n    if(!aggregation.enabled) return;\n\n    var attr = aggregation.target;\n    var targetNP = Lib.nestedProperty(trace, attr);\n    var arrayIn = targetNP.get();\n    var conversions = Axes.getDataConversions(gd, trace, attr, arrayIn);\n    var func = getAggregateFunction(aggregation, conversions);\n\n    var arrayOut = new Array(groupings.length);\n    for(var i = 0; i < groupings.length; i++) {\n        arrayOut[i] = func(arrayIn, groupings[i]);\n    }\n    targetNP.set(arrayOut);\n\n    if(aggregation.func === 'count') {\n        // count does not depend on an input array, so it's likely not part of _arrayAttrs yet\n        // but after this transform it most definitely *is* an array attribute.\n        Lib.pushUnique(trace._arrayAttrs, attr);\n    }\n}\n\nfunction getAggregateFunction(opts, conversions) {\n    var func = opts.func;\n    var d2c = conversions.d2c;\n    var c2d = conversions.c2d;\n\n    switch(func) {\n        // count, first, and last don't depend on anything about the data\n        // point back to pure functions for performance\n        case 'count':\n            return count;\n        case 'first':\n            return first;\n        case 'last':\n            return last;\n\n        case 'sum':\n            // This will produce output in all cases even though it's nonsensical\n            // for date or category data.\n            return function(array, indices) {\n                var total = 0;\n                for(var i = 0; i < indices.length; i++) {\n                    var vi = d2c(array[indices[i]]);\n                    if(vi !== BADNUM) total += vi;\n                }\n                return c2d(total);\n            };\n\n        case 'avg':\n            // Generally meaningless for category data but it still does something.\n            return function(array, indices) {\n                var total = 0;\n                var cnt = 0;\n                for(var i = 0; i < indices.length; i++) {\n                    var vi = d2c(array[indices[i]]);\n                    if(vi !== BADNUM) {\n                        total += vi;\n                        cnt++;\n                    }\n                }\n                return cnt ? c2d(total / cnt) : BADNUM;\n            };\n\n        case 'min':\n            return function(array, indices) {\n                var out = Infinity;\n                for(var i = 0; i < indices.length; i++) {\n                    var vi = d2c(array[indices[i]]);\n                    if(vi !== BADNUM) out = Math.min(out, vi);\n                }\n                return (out === Infinity) ? BADNUM : c2d(out);\n            };\n\n        case 'max':\n            return function(array, indices) {\n                var out = -Infinity;\n                for(var i = 0; i < indices.length; i++) {\n                    var vi = d2c(array[indices[i]]);\n                    if(vi !== BADNUM) out = Math.max(out, vi);\n                }\n                return (out === -Infinity) ? BADNUM : c2d(out);\n            };\n\n        case 'range':\n            return function(array, indices) {\n                var min = Infinity;\n                var max = -Infinity;\n                for(var i = 0; i < indices.length; i++) {\n                    var vi = d2c(array[indices[i]]);\n                    if(vi !== BADNUM) {\n                        min = Math.min(min, vi);\n                        max = Math.max(max, vi);\n                    }\n                }\n                return (max === -Infinity || min === Infinity) ? BADNUM : c2d(max - min);\n            };\n\n        case 'change':\n            return function(array, indices) {\n                var first = d2c(array[indices[0]]);\n                var last = d2c(array[indices[indices.length - 1]]);\n                return (first === BADNUM || last === BADNUM) ? BADNUM : c2d(last - first);\n            };\n\n        case 'median':\n            return function(array, indices) {\n                var sortCalc = [];\n                for(var i = 0; i < indices.length; i++) {\n                    var vi = d2c(array[indices[i]]);\n                    if(vi !== BADNUM) sortCalc.push(vi);\n                }\n                if(!sortCalc.length) return BADNUM;\n                sortCalc.sort(Lib.sorterAsc);\n                var mid = (sortCalc.length - 1) / 2;\n                return c2d((sortCalc[Math.floor(mid)] + sortCalc[Math.ceil(mid)]) / 2);\n            };\n\n        case 'mode':\n            return function(array, indices) {\n                var counts = {};\n                var maxCnt = 0;\n                var out = BADNUM;\n                for(var i = 0; i < indices.length; i++) {\n                    var vi = d2c(array[indices[i]]);\n                    if(vi !== BADNUM) {\n                        var counti = counts[vi] = (counts[vi] || 0) + 1;\n                        if(counti > maxCnt) {\n                            maxCnt = counti;\n                            out = vi;\n                        }\n                    }\n                }\n                return maxCnt ? c2d(out) : BADNUM;\n            };\n\n        case 'rms':\n            return function(array, indices) {\n                var total = 0;\n                var cnt = 0;\n                for(var i = 0; i < indices.length; i++) {\n                    var vi = d2c(array[indices[i]]);\n                    if(vi !== BADNUM) {\n                        total += vi * vi;\n                        cnt++;\n                    }\n                }\n                return cnt ? c2d(Math.sqrt(total / cnt)) : BADNUM;\n            };\n\n        case 'stddev':\n            return function(array, indices) {\n                // balance numerical stability with performance:\n                // so that we call d2c once per element but don't need to\n                // store them, reference all to the first element\n                var total = 0;\n                var total2 = 0;\n                var cnt = 1;\n                var v0 = BADNUM;\n                var i;\n                for(i = 0; i < indices.length && v0 === BADNUM; i++) {\n                    v0 = d2c(array[indices[i]]);\n                }\n                if(v0 === BADNUM) return BADNUM;\n\n                for(; i < indices.length; i++) {\n                    var vi = d2c(array[indices[i]]);\n                    if(vi !== BADNUM) {\n                        var dv = vi - v0;\n                        total += dv;\n                        total2 += dv * dv;\n                        cnt++;\n                    }\n                }\n\n                // This is population std dev, if we want sample std dev\n                // we would need (...) / (cnt - 1)\n                // Also note there's no c2d here - that means for dates the result\n                // is a number of milliseconds, and for categories it's a number\n                // of category differences, which is not generically meaningful but\n                // as in other cases we don't forbid it.\n                var norm = (opts.funcmode === 'sample') ? (cnt - 1) : cnt;\n                // this is debatable: should a count of 1 return sample stddev of\n                // 0 or undefined?\n                if(!norm) return 0;\n                return Math.sqrt((total2 - (total * total / cnt)) / norm);\n            };\n    }\n}\n\nfunction count(array, indices) {\n    return indices.length;\n}\n\nfunction first(array, indices) {\n    return array[indices[0]];\n}\n\nfunction last(array, indices) {\n    return array[indices[indices.length - 1]];\n}\n","'use strict';\n\nvar Lib = require('../lib');\nvar Registry = require('../registry');\nvar Axes = require('../plots/cartesian/axes');\nvar pointsAccessorFunction = require('./helpers').pointsAccessorFunction;\n\nvar filterOps = require('../constants/filter_ops');\nvar COMPARISON_OPS = filterOps.COMPARISON_OPS;\nvar INTERVAL_OPS = filterOps.INTERVAL_OPS;\nvar SET_OPS = filterOps.SET_OPS;\n\nexports.moduleType = 'transform';\n\nexports.name = 'filter';\n\nexports.attributes = {\n    enabled: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'calc',\n        description: [\n            'Determines whether this filter transform is enabled or disabled.'\n        ].join(' ')\n    },\n    target: {\n        valType: 'string',\n        strict: true,\n        noBlank: true,\n        arrayOk: true,\n        dflt: 'x',\n        editType: 'calc',\n        description: [\n            'Sets the filter target by which the filter is applied.',\n\n            'If a string, `target` is assumed to be a reference to a data array',\n            'in the parent trace object.',\n            'To filter about nested variables, use *.* to access them.',\n            'For example, set `target` to *marker.color* to filter',\n            'about the marker color array.',\n\n            'If an array, `target` is then the data array by which the filter is applied.'\n        ].join(' ')\n    },\n    operation: {\n        valType: 'enumerated',\n        values: []\n            .concat(COMPARISON_OPS)\n            .concat(INTERVAL_OPS)\n            .concat(SET_OPS),\n        dflt: '=',\n        editType: 'calc',\n        description: [\n            'Sets the filter operation.',\n\n            '*=* keeps items equal to `value`',\n            '*!=* keeps items not equal to `value`',\n\n            '*<* keeps items less than `value`',\n            '*<=* keeps items less than or equal to `value`',\n\n            '*>* keeps items greater than `value`',\n            '*>=* keeps items greater than or equal to `value`',\n\n            '*[]* keeps items inside `value[0]` to `value[1]` including both bounds',\n            '*()* keeps items inside `value[0]` to `value[1]` excluding both bounds',\n            '*[)* keeps items inside `value[0]` to `value[1]` including `value[0]` but excluding `value[1]',\n            '*(]* keeps items inside `value[0]` to `value[1]` excluding `value[0]` but including `value[1]',\n\n            '*][* keeps items outside `value[0]` to `value[1]` and equal to both bounds',\n            '*)(* keeps items outside `value[0]` to `value[1]`',\n            '*](* keeps items outside `value[0]` to `value[1]` and equal to `value[0]`',\n            '*)[* keeps items outside `value[0]` to `value[1]` and equal to `value[1]`',\n\n            '*{}* keeps items present in a set of values',\n            '*}{* keeps items not present in a set of values'\n        ].join(' ')\n    },\n    value: {\n        valType: 'any',\n        dflt: 0,\n        editType: 'calc',\n        description: [\n            'Sets the value or values by which to filter.',\n\n            'Values are expected to be in the same type as the data linked',\n            'to `target`.',\n\n            'When `operation` is set to one of',\n            'the comparison values (' + COMPARISON_OPS + ')',\n            '`value` is expected to be a number or a string.',\n\n            'When `operation` is set to one of the interval values',\n            '(' + INTERVAL_OPS + ')',\n            '`value` is expected to be 2-item array where the first item',\n            'is the lower bound and the second item is the upper bound.',\n\n            'When `operation`, is set to one of the set values',\n            '(' + SET_OPS + ')',\n            '`value` is expected to be an array with as many items as',\n            'the desired set elements.'\n        ].join(' ')\n    },\n    preservegaps: {\n        valType: 'boolean',\n        dflt: false,\n        editType: 'calc',\n        description: [\n            'Determines whether or not gaps in data arrays produced by the filter operation',\n            'are preserved.',\n            'Setting this to *true* might be useful when plotting a line chart',\n            'with `connectgaps` set to *false*.'\n        ].join(' ')\n    },\n    editType: 'calc'\n};\n\nexports.supplyDefaults = function(transformIn) {\n    var transformOut = {};\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(transformIn, transformOut, exports.attributes, attr, dflt);\n    }\n\n    var enabled = coerce('enabled');\n\n    if(enabled) {\n        var target = coerce('target');\n\n        if(Lib.isArrayOrTypedArray(target) && target.length === 0) {\n            transformOut.enabled = false;\n            return transformOut;\n        }\n\n        coerce('preservegaps');\n        coerce('operation');\n        coerce('value');\n\n        var handleCalendarDefaults = Registry.getComponentMethod('calendars', 'handleDefaults');\n        handleCalendarDefaults(transformIn, transformOut, 'valuecalendar', null);\n        handleCalendarDefaults(transformIn, transformOut, 'targetcalendar', null);\n    }\n\n    return transformOut;\n};\n\nexports.calcTransform = function(gd, trace, opts) {\n    if(!opts.enabled) return;\n\n    var targetArray = Lib.getTargetArray(trace, opts);\n    if(!targetArray) return;\n\n    var target = opts.target;\n\n    var len = targetArray.length;\n    if(trace._length) len = Math.min(len, trace._length);\n\n    var targetCalendar = opts.targetcalendar;\n    var arrayAttrs = trace._arrayAttrs;\n    var preservegaps = opts.preservegaps;\n\n    // even if you provide targetcalendar, if target is a string and there\n    // is a calendar attribute matching target it will get used instead.\n    if(typeof target === 'string') {\n        var attrTargetCalendar = Lib.nestedProperty(trace, target + 'calendar').get();\n        if(attrTargetCalendar) targetCalendar = attrTargetCalendar;\n    }\n\n    var d2c = Axes.getDataToCoordFunc(gd, trace, target, targetArray);\n    var filterFunc = getFilterFunc(opts, d2c, targetCalendar);\n    var originalArrays = {};\n    var indexToPoints = {};\n    var index = 0;\n\n    function forAllAttrs(fn, index) {\n        for(var j = 0; j < arrayAttrs.length; j++) {\n            var np = Lib.nestedProperty(trace, arrayAttrs[j]);\n            fn(np, index);\n        }\n    }\n\n    var initFn;\n    var fillFn;\n    if(preservegaps) {\n        initFn = function(np) {\n            originalArrays[np.astr] = Lib.extendDeep([], np.get());\n            np.set(new Array(len));\n        };\n        fillFn = function(np, index) {\n            var val = originalArrays[np.astr][index];\n            np.get()[index] = val;\n        };\n    } else {\n        initFn = function(np) {\n            originalArrays[np.astr] = Lib.extendDeep([], np.get());\n            np.set([]);\n        };\n        fillFn = function(np, index) {\n            var val = originalArrays[np.astr][index];\n            np.get().push(val);\n        };\n    }\n\n    // copy all original array attribute values, and clear arrays in trace\n    forAllAttrs(initFn);\n\n    var originalPointsAccessor = pointsAccessorFunction(trace.transforms, opts);\n\n    // loop through filter array, fill trace arrays if passed\n    for(var i = 0; i < len; i++) {\n        var passed = filterFunc(targetArray[i]);\n        if(passed) {\n            forAllAttrs(fillFn, i);\n            indexToPoints[index++] = originalPointsAccessor(i);\n        } else if(preservegaps) index++;\n    }\n\n    opts._indexToPoints = indexToPoints;\n    trace._length = index;\n};\n\nfunction getFilterFunc(opts, d2c, targetCalendar) {\n    var operation = opts.operation;\n    var value = opts.value;\n    var hasArrayValue = Array.isArray(value);\n\n    function isOperationIn(array) {\n        return array.indexOf(operation) !== -1;\n    }\n\n    var d2cValue = function(v) { return d2c(v, 0, opts.valuecalendar); };\n    var d2cTarget = function(v) { return d2c(v, 0, targetCalendar); };\n\n    var coercedValue;\n\n    if(isOperationIn(COMPARISON_OPS)) {\n        coercedValue = hasArrayValue ? d2cValue(value[0]) : d2cValue(value);\n    } else if(isOperationIn(INTERVAL_OPS)) {\n        coercedValue = hasArrayValue ?\n            [d2cValue(value[0]), d2cValue(value[1])] :\n            [d2cValue(value), d2cValue(value)];\n    } else if(isOperationIn(SET_OPS)) {\n        coercedValue = hasArrayValue ? value.map(d2cValue) : [d2cValue(value)];\n    }\n\n    switch(operation) {\n        case '=':\n            return function(v) { return d2cTarget(v) === coercedValue; };\n\n        case '!=':\n            return function(v) { return d2cTarget(v) !== coercedValue; };\n\n        case '<':\n            return function(v) { return d2cTarget(v) < coercedValue; };\n\n        case '<=':\n            return function(v) { return d2cTarget(v) <= coercedValue; };\n\n        case '>':\n            return function(v) { return d2cTarget(v) > coercedValue; };\n\n        case '>=':\n            return function(v) { return d2cTarget(v) >= coercedValue; };\n\n        case '[]':\n            return function(v) {\n                var cv = d2cTarget(v);\n                return cv >= coercedValue[0] && cv <= coercedValue[1];\n            };\n\n        case '()':\n            return function(v) {\n                var cv = d2cTarget(v);\n                return cv > coercedValue[0] && cv < coercedValue[1];\n            };\n\n        case '[)':\n            return function(v) {\n                var cv = d2cTarget(v);\n                return cv >= coercedValue[0] && cv < coercedValue[1];\n            };\n\n        case '(]':\n            return function(v) {\n                var cv = d2cTarget(v);\n                return cv > coercedValue[0] && cv <= coercedValue[1];\n            };\n\n        case '][':\n            return function(v) {\n                var cv = d2cTarget(v);\n                return cv <= coercedValue[0] || cv >= coercedValue[1];\n            };\n\n        case ')(':\n            return function(v) {\n                var cv = d2cTarget(v);\n                return cv < coercedValue[0] || cv > coercedValue[1];\n            };\n\n        case '](':\n            return function(v) {\n                var cv = d2cTarget(v);\n                return cv <= coercedValue[0] || cv > coercedValue[1];\n            };\n\n        case ')[':\n            return function(v) {\n                var cv = d2cTarget(v);\n                return cv < coercedValue[0] || cv >= coercedValue[1];\n            };\n\n        case '{}':\n            return function(v) {\n                return coercedValue.indexOf(d2cTarget(v)) !== -1;\n            };\n\n        case '}{':\n            return function(v) {\n                return coercedValue.indexOf(d2cTarget(v)) === -1;\n            };\n    }\n}\n","'use strict';\n\nvar Lib = require('../lib');\nvar PlotSchema = require('../plot_api/plot_schema');\nvar Plots = require('../plots/plots');\nvar pointsAccessorFunction = require('./helpers').pointsAccessorFunction;\n\nexports.moduleType = 'transform';\n\nexports.name = 'groupby';\n\nexports.attributes = {\n    enabled: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'calc',\n        description: [\n            'Determines whether this group-by transform is enabled or disabled.'\n        ].join(' ')\n    },\n    groups: {\n        valType: 'data_array',\n        dflt: [],\n        editType: 'calc',\n        description: [\n            'Sets the groups in which the trace data will be split.',\n            'For example, with `x` set to *[1, 2, 3, 4]* and',\n            '`groups` set to *[\\'a\\', \\'b\\', \\'a\\', \\'b\\']*,',\n            'the groupby transform with split in one trace',\n            'with `x` [1, 3] and one trace with `x` [2, 4].'\n        ].join(' ')\n    },\n    nameformat: {\n        valType: 'string',\n        editType: 'calc',\n        description: [\n            'Pattern by which grouped traces are named. If only one trace is present,',\n            'defaults to the group name (`\"%{group}\"`), otherwise defaults to the group name',\n            'with trace name (`\"%{group} (%{trace})\"`). Available escape sequences are `%{group}`, which',\n            'inserts the group name, and `%{trace}`, which inserts the trace name. If grouping',\n            'GDP data by country when more than one trace is present, for example, the',\n            'default \"%{group} (%{trace})\" would return \"Monaco (GDP per capita)\".'\n        ].join(' ')\n    },\n    styles: {\n        _isLinkedToArray: 'style',\n        target: {\n            valType: 'string',\n            editType: 'calc',\n            description: [\n                'The group value which receives these styles.'\n            ].join(' ')\n        },\n        value: {\n            valType: 'any',\n            dflt: {},\n            editType: 'calc',\n            description: [\n                'Sets each group styles.',\n                'For example, with `groups` set to *[\\'a\\', \\'b\\', \\'a\\', \\'b\\']*',\n                'and `styles` set to *[{target: \\'a\\', value: { marker: { color: \\'red\\' } }}]',\n                'marker points in group *\\'a\\'* will be drawn in red.'\n            ].join(' '),\n            _compareAsJSON: true\n        },\n        editType: 'calc'\n    },\n    editType: 'calc'\n};\n\n/**\n * Supply transform attributes defaults\n *\n * @param {object} transformIn\n *  object linked to trace.transforms[i] with 'type' set to exports.name\n * @param {object} traceOut\n *  the _fullData trace this transform applies to\n * @param {object} layout\n *  the plot's (not-so-full) layout\n * @param {object} traceIn\n *  the input data trace this transform applies to\n *\n * @return {object} transformOut\n *  copy of transformIn that contains attribute defaults\n */\nexports.supplyDefaults = function(transformIn, traceOut, layout) {\n    var i;\n    var transformOut = {};\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(transformIn, transformOut, exports.attributes, attr, dflt);\n    }\n\n    var enabled = coerce('enabled');\n\n    if(!enabled) return transformOut;\n\n    coerce('groups');\n    coerce('nameformat', layout._dataLength > 1 ? '%{group} (%{trace})' : '%{group}');\n\n    var styleIn = transformIn.styles;\n    var styleOut = transformOut.styles = [];\n\n    if(styleIn) {\n        for(i = 0; i < styleIn.length; i++) {\n            var thisStyle = styleOut[i] = {};\n            Lib.coerce(styleIn[i], styleOut[i], exports.attributes.styles, 'target');\n            var value = Lib.coerce(styleIn[i], styleOut[i], exports.attributes.styles, 'value');\n\n            // so that you can edit value in place and have Plotly.react notice it, or\n            // rebuild it every time and have Plotly.react NOT think it changed:\n            // use _compareAsJSON to say we should diff the _JSON_value\n            if(Lib.isPlainObject(value)) thisStyle.value = Lib.extendDeep({}, value);\n            else if(value) delete thisStyle.value;\n        }\n    }\n\n    return transformOut;\n};\n\n\n/**\n * Apply transform !!!\n *\n * @param {array} data\n *  array of transformed traces (is [fullTrace] upon first transform)\n *\n * @param {object} state\n *  state object which includes:\n *      - transform {object} full transform attributes\n *      - fullTrace {object} full trace object which is being transformed\n *      - fullData {array} full pre-transform(s) data array\n *      - layout {object} the plot's (not-so-full) layout\n *\n * @return {object} newData\n *  array of transformed traces\n */\nexports.transform = function(data, state) {\n    var newTraces, i, j;\n    var newData = [];\n\n    for(i = 0; i < data.length; i++) {\n        newTraces = transformOne(data[i], state);\n\n        for(j = 0; j < newTraces.length; j++) {\n            newData.push(newTraces[j]);\n        }\n    }\n\n    return newData;\n};\n\nfunction transformOne(trace, state) {\n    var i, j, k, attr, srcArray, groupName, newTrace, transforms, arrayLookup;\n    var groupNameObj;\n\n    var opts = state.transform;\n    var transformIndex = state.transformIndex;\n    var groups = trace.transforms[transformIndex].groups;\n    var originalPointsAccessor = pointsAccessorFunction(trace.transforms, opts);\n\n    if(!(Lib.isArrayOrTypedArray(groups)) || groups.length === 0) {\n        return [trace];\n    }\n\n    var groupNames = Lib.filterUnique(groups);\n    var newData = new Array(groupNames.length);\n    var len = groups.length;\n\n    var arrayAttrs = PlotSchema.findArrayAttributes(trace);\n\n    var styles = opts.styles || [];\n    var styleLookup = {};\n    for(i = 0; i < styles.length; i++) {\n        styleLookup[styles[i].target] = styles[i].value;\n    }\n\n    if(opts.styles) {\n        groupNameObj = Lib.keyedContainer(opts, 'styles', 'target', 'value.name');\n    }\n\n    // An index to map group name --> expanded trace index\n    var indexLookup = {};\n    var indexCnts = {};\n\n    for(i = 0; i < groupNames.length; i++) {\n        groupName = groupNames[i];\n        indexLookup[groupName] = i;\n        indexCnts[groupName] = 0;\n\n        // Start with a deep extend that just copies array references.\n        newTrace = newData[i] = Lib.extendDeepNoArrays({}, trace);\n        newTrace._group = groupName;\n        newTrace.transforms[transformIndex]._indexToPoints = {};\n\n        var suppliedName = null;\n        if(groupNameObj) {\n            suppliedName = groupNameObj.get(groupName);\n        }\n\n        if(suppliedName || suppliedName === '') {\n            newTrace.name = suppliedName;\n        } else {\n            newTrace.name = Lib.templateString(opts.nameformat, {\n                trace: trace.name,\n                group: groupName\n            });\n        }\n\n        // In order for groups to apply correctly to other transform data (e.g.\n        // a filter transform), we have to break the connection and clone the\n        // transforms so that each group writes grouped values into a different\n        // destination. This function does not break the array reference\n        // connection between the split transforms it creates. That's handled in\n        // initialize, which creates a new empty array for each arrayAttr.\n        transforms = newTrace.transforms;\n        newTrace.transforms = [];\n        for(j = 0; j < transforms.length; j++) {\n            newTrace.transforms[j] = Lib.extendDeepNoArrays({}, transforms[j]);\n        }\n\n        // Initialize empty arrays for the arrayAttrs, to be split in the next step\n        for(j = 0; j < arrayAttrs.length; j++) {\n            Lib.nestedProperty(newTrace, arrayAttrs[j]).set([]);\n        }\n    }\n\n    // For each array attribute including those nested inside this and other\n    // transforms (small note that we technically only need to do this for\n    // transforms that have not yet been applied):\n    for(k = 0; k < arrayAttrs.length; k++) {\n        attr = arrayAttrs[k];\n\n        // Cache all the arrays to which we'll push:\n        for(j = 0, arrayLookup = []; j < groupNames.length; j++) {\n            arrayLookup[j] = Lib.nestedProperty(newData[j], attr).get();\n        }\n\n        // Get the input data:\n        srcArray = Lib.nestedProperty(trace, attr).get();\n\n        // Send each data point to the appropriate expanded trace:\n        for(j = 0; j < len; j++) {\n            // Map group data --> trace index --> array and push data onto it\n            arrayLookup[indexLookup[groups[j]]].push(srcArray[j]);\n        }\n    }\n\n    for(j = 0; j < len; j++) {\n        newTrace = newData[indexLookup[groups[j]]];\n\n        var indexToPoints = newTrace.transforms[transformIndex]._indexToPoints;\n        indexToPoints[indexCnts[groups[j]]] = originalPointsAccessor(j);\n        indexCnts[groups[j]]++;\n    }\n\n    for(i = 0; i < groupNames.length; i++) {\n        groupName = groupNames[i];\n        newTrace = newData[i];\n\n        Plots.clearExpandedTraceDefaultColors(newTrace);\n\n        // there's no need to coerce styleLookup[groupName] here\n        // as another round of supplyDefaults is done on the transformed traces\n        newTrace = Lib.extendDeepNoArrays(newTrace, styleLookup[groupName] || {});\n    }\n\n    return newData;\n}\n","'use strict';\n\nexports.pointsAccessorFunction = function(transforms, opts) {\n    var tr;\n    var prevIndexToPoints;\n    for(var i = 0; i < transforms.length; i++) {\n        tr = transforms[i];\n        if(tr === opts) break;\n        if(!tr._indexToPoints || tr.enabled === false) continue;\n        prevIndexToPoints = tr._indexToPoints;\n    }\n    var originalPointsAccessor = prevIndexToPoints ?\n        function(i) {return prevIndexToPoints[i];} :\n        function(i) {return [i];};\n    return originalPointsAccessor;\n};\n","'use strict';\n\nvar Lib = require('../lib');\nvar Axes = require('../plots/cartesian/axes');\nvar pointsAccessorFunction = require('./helpers').pointsAccessorFunction;\n\nvar BADNUM = require('../constants/numerical').BADNUM;\n\nexports.moduleType = 'transform';\n\nexports.name = 'sort';\n\nexports.attributes = {\n    enabled: {\n        valType: 'boolean',\n        dflt: true,\n        editType: 'calc',\n        description: [\n            'Determines whether this sort transform is enabled or disabled.'\n        ].join(' ')\n    },\n    target: {\n        valType: 'string',\n        strict: true,\n        noBlank: true,\n        arrayOk: true,\n        dflt: 'x',\n        editType: 'calc',\n        description: [\n            'Sets the target by which the sort transform is applied.',\n\n            'If a string, *target* is assumed to be a reference to a data array',\n            'in the parent trace object.',\n            'To sort about nested variables, use *.* to access them.',\n            'For example, set `target` to *marker.size* to sort',\n            'about the marker size array.',\n\n            'If an array, *target* is then the data array by which',\n            'the sort transform is applied.'\n        ].join(' ')\n    },\n    order: {\n        valType: 'enumerated',\n        values: ['ascending', 'descending'],\n        dflt: 'ascending',\n        editType: 'calc',\n        description: [\n            'Sets the sort transform order.'\n        ].join(' ')\n    },\n    editType: 'calc'\n};\n\nexports.supplyDefaults = function(transformIn) {\n    var transformOut = {};\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(transformIn, transformOut, exports.attributes, attr, dflt);\n    }\n\n    var enabled = coerce('enabled');\n\n    if(enabled) {\n        coerce('target');\n        coerce('order');\n    }\n\n    return transformOut;\n};\n\nexports.calcTransform = function(gd, trace, opts) {\n    if(!opts.enabled) return;\n\n    var targetArray = Lib.getTargetArray(trace, opts);\n    if(!targetArray) return;\n\n    var target = opts.target;\n\n    var len = targetArray.length;\n    if(trace._length) len = Math.min(len, trace._length);\n\n    var arrayAttrs = trace._arrayAttrs;\n    var d2c = Axes.getDataToCoordFunc(gd, trace, target, targetArray);\n    var indices = getIndices(opts, targetArray, d2c, len);\n    var originalPointsAccessor = pointsAccessorFunction(trace.transforms, opts);\n    var indexToPoints = {};\n    var i, j;\n\n    for(i = 0; i < arrayAttrs.length; i++) {\n        var np = Lib.nestedProperty(trace, arrayAttrs[i]);\n        var arrayOld = np.get();\n        var arrayNew = new Array(len);\n\n        for(j = 0; j < len; j++) {\n            arrayNew[j] = arrayOld[indices[j]];\n        }\n\n        np.set(arrayNew);\n    }\n\n    for(j = 0; j < len; j++) {\n        indexToPoints[j] = originalPointsAccessor(indices[j]);\n    }\n\n    opts._indexToPoints = indexToPoints;\n    trace._length = len;\n};\n\nfunction getIndices(opts, targetArray, d2c, len) {\n    var sortedArray = new Array(len);\n    var indices = new Array(len);\n    var i;\n\n    for(i = 0; i < len; i++) {\n        sortedArray[i] = {v: targetArray[i], i: i};\n    }\n\n    sortedArray.sort(getSortFunc(opts, d2c));\n\n    for(i = 0; i < len; i++) {\n        indices[i] = sortedArray[i].i;\n    }\n\n    return indices;\n}\n\nfunction getSortFunc(opts, d2c) {\n    switch(opts.order) {\n        case 'ascending':\n            return function(a, b) {\n                var ac = d2c(a.v);\n                var bc = d2c(b.v);\n                if(ac === BADNUM) {\n                    return 1;\n                }\n                if(bc === BADNUM) {\n                    return -1;\n                }\n                return ac - bc;\n            };\n        case 'descending':\n            return function(a, b) {\n                var ac = d2c(a.v);\n                var bc = d2c(b.v);\n                if(ac === BADNUM) {\n                    return 1;\n                }\n                if(bc === BADNUM) {\n                    return -1;\n                }\n                return bc - ac;\n            };\n    }\n}\n","'use strict';\n\n// package version injected by `npm run preprocess`\nexports.version = '2.2.0';\n"],"names":["Lib","rules","Y","selector","fullSelector","replace","addStyleRule","module","exports","Plotly","register","annAttrs","overrideAll","templatedArray","visible","x","valType","description","join","y","z","ax","ay","xanchor","xshift","yanchor","yshift","text","textangle","font","width","height","opacity","align","valign","bgcolor","bordercolor","borderpad","borderwidth","showarrow","arrowcolor","arrowhead","startarrowhead","arrowside","arrowsize","startarrowsize","arrowwidth","standoff","startstandoff","hovertext","hoverlabel","captureevents","Axes","mockAnnAxes","ann","scene","domain","fullSceneLayout","size","fullLayout","_size","base","pdata","type","autorange","range","Infinity","_xa","extendFlat","setConvert","_offset","l","w","l2p","_pdata","_ya","t","h","anns","annotations","i","length","_infolayer","selectAll","id","remove","handleArrayContainerDefaults","handleAnnotationCommonDefaults","attributes","handleAnnotationDefaults","annIn","annOut","sceneLayout","opts","coerce","attr","dflt","coercePosition","axLetter","axName","gdMock","_fullLayout","noneOrAll","xref","yref","zref","axref","ayref","sceneLayoutIn","sceneLayoutOut","name","handleItemDefaults","drawRaw","project","axLetters","dataScale","annotationIsOffscreen","j","pos","posFraction","r2fraction","select","glplot","cameraParams","xaxis","r2l","yaxis","zaxis","graphDiv","Registry","moduleType","schema","subplots","layoutAttributes","handleDefaults","includeBasePlot","layoutIn","layoutOut","GL3D","subplotsRegistry","gl3d","attrRegex","keys","Object","k","test","pushUnique","_basePlotModules","_subplots","convert","draw","path","backoff","noRotate","ARROWPATHS","fontAttrs","cartesianConstants","axisPlaceableObjs","arrowAxisRefDescription","axis","arrowCoordinateDescription","lower","upper","editType","colorEditType","min","max","values","flags","extras","idRegex","toString","axisRefDescription","clicktoshow","xclick","yclick","_deprecated","ref","annAutorange","gd","filterVisible","forEach","xa","getFromId","ya","xRefType","getRefType","yRefType","_extremes","calcAxisExpansion","extremes","axId","_id","letter","charAt","apos","aref","padplus","padminus","shift","headSize","headPlus","headMinus","startHeadSize","startHeadPlus","startHeadMinus","extremeArrowHead","findExtremes","r2c","ppadplus","ppadminus","extremeText","Math","_fullData","syncOrAsync","arrayEditor","getToggleSets","hoverData","anni","showMode","pointj","onSet","offSet","explicitOffSet","hoverLen","d2r","clickData2r","_xclick","_yclick","push","on","off","explicitOff","d","l2r","hasClickToShow","sets","onClick","editHelpers","toggleSets","concat","update","annotationsOut","layout","modifyItem","getUpdateObj","call","Color","bgColor","borderColor","borderOpacity","borderWidth","showArrow","_dfltTitle","annotation","coerceFont","indexOf","defaultLine","hoverText","globalHoverLabel","hoverBG","rgb","hoverBorder","contrast","family","color","isNumeric","toLogRange","newType","doExtra","toLog","fromLog","attrPrefix","currentVal","newVal","pow","clickToShow","arrowPosDflt","axRef","coerceRef","_annIndices","_index","arrowPosAttr","aaxRef","aDflt","xClick","yClick","undefined","cleanPosition","d3","Plots","strTranslate","Drawing","Fx","svgTextUtils","setCursor","dragElement","drawArrowHead","drawOne","index","options","setScale","shiftPosition","axa","dAx","gs","optAx","vertical","axDomainRef","gsDim","_length","p2r","r2p","subplotId","className","containerStr","edits","_context","modifyBase","annClipID","_uid","_input","annPosPx","annGroup","append","classed","String","style","annTextGroup","editTextPosition","textEvents","annotationText","annTextGroupInner","_dragging","emit","makeEventData","event","hoverOptions","hoverFont","bBox","this","getBoundingClientRect","bBoxRef","loneHover","x0","left","x1","right","top","bottom","fontFamily","fontSize","fontColor","container","_hoverlayer","node","outerContainer","_paper","loneUnhover","borderfull","annTextBG","stroke","fill","isSizeConstrained","annTextClip","_topclips","data","enter","exit","_meta","templateString","annText","makeEditable","delegate","textLayout","_text","_name","initialEvent","eventData","fullAnnotation","s","convertToTspans","drawGraphicalElements","anchor3","insert","cursor","appendChild","mathjaxGroup","hasMathjax","empty","anntextBB","textWidth","textHeight","annWidth","annHeight","outerWidth","round","outerHeight","shiftFraction","v","anchor","center","middle","letters","basePx","textPadShift","alignPosition","autoAlignFraction","textShift","tailRef","dimAngle","PI","annSizeFromWidth","cos","annSizeFromHeight","sin","annSize","abs","overallShift","posPx","axRefType","axRefTypeEqDomain","head","arrowLength","tailRefType","tail","maxPx","constrain","shiftPlus","shiftMinus","xShift","yShift","setClipUrl","texty","textx","positionText","setRect","setTranslate","transform","baseTextTransform","drawArrow","dx","dy","headX","headY","tailX","tailY","textX","textY","rotationXYMatrix","applyTransform","apply2DTransform","applyTransform2","apply2DTransform2","xLeft","xRight","yTop","yBottom","edges","map","reduce","a","segmentsIntersect","p","strokewidth","arrowColor","arrowSide","arrowGroup","arrow","annotationPosition","parentNode","arrowDragHeadX","arrowDragHeadY","sqrt","annx0","anny0","arrowDrag","init","element","prepFn","getTranslate","moveFn","annxy0","xcenter","ycenter","doneFn","notesBox","document","querySelector","redraw","selectedObj","csr","xUpdate","yUpdate","widthFraction","_xsize","_xshift","heightFraction","_ysize","_yshift","getCursor","clickFn","_","previousPromises","strScale","strRotate","el3","ends","start","end","startRot","endRot","el","headStyle","startHeadStyle","scale","startScale","doStart","doEnd","backOff","startBackOff","nodeName","atan2","hideLine","backOffX","backOffY","x2","y2","startBackOffX","startbackOffY","y1","pathlen","getTotalLength","dashArray","start0","getPointAtLength","dstart","end0","dend","drawhead","arrowHeadStyle","rot","arrowScale","drawModule","clickModule","supplyLayoutDefaults","calcAutorange","convertCoords","calendars","constants","EPOCHJD","ONEDAY","contIn","contOut","attrs","UNKNOWN","d3ToWorldCalendars","allCals","getCal","calendar","calendarObj","instance","makeAttrs","makeTraceAttrsDescription","coord","xAttrs","xcalendar","xyAttrs","ycalendar","xyzAttrs","zcalendar","axisAttrs","traces","scatter","bar","box","heatmap","contour","histogram","histogram2d","histogram2dcontour","scatter3d","surface","mesh3d","scattergl","ohlc","candlestick","polar","radialaxis","transforms","filter","valuecalendar","targetcalendar","handleTraceDefaults","traceIn","traceOut","coords","CANONICAL_SUNDAY","chinese","coptic","discworld","ethiopian","hebrew","islamic","julian","mayan","nanakshahi","nepali","persian","jalali","taiwan","thai","ummalqura","CANONICAL_TICK","DFLTRANGE","worldCalFmt","fmt","modifier","directive","directiveLen","directiveObj","replacementPart","dateJD","floor","cDate","fromJD","formatDate","substr","defaults","lightLine","background","borderLine","lightFraction","tinycolor","isTypedArray","colorAttrs","cleanOne","val","valTrim","trim","match","parts","split","rgba","Number","rgbStr","tinyRGB","tc","c","toRgb","r","g","b","cstr","getAlpha","addOpacity","op","combine","front","back","fc","toRgbString","bc","bcflat","fcflat","lightAmount","darkAmount","isDark","lighten","darken","clean","key","Array","isArray","el0","axesAttrs","thicknessmode","thickness","lenmode","len","xpad","ypad","outlinecolor","linecolor","outlinewidth","linewidth","tickmode","nticks","tick0","dtick","tickvals","ticktext","ticks","ticklabeloverflow","ticklabelposition","ticklen","tickwidth","tickcolor","showticklabels","tickfont","tickangle","tickformat","tickformatstops","tickprefix","showtickprefix","ticksuffix","showticksuffix","separatethousands","exponentformat","minexponent","showexponent","title","side","titlefont","titleside","cn","colorbar","cbbg","cbfill","cbfills","cbline","cblines","cbaxis","cbtitleunshift","cbtitle","cboutline","crisp","jsPlaceholder","Template","handleTickValueDefaults","handleTickMarkDefaults","handleTickLabelDefaults","containerIn","containerOut","colorbarOut","newContainer","colorbarIn","margin","outerTicks","tickFont","dfltTitleFont","bigFont","Titles","flipScale","handleAxisDefaults","handleAxisPositionDefaults","axisLayoutAttrs","alignmentConstants","LINE_SPACING","FROM_TL","FROM_BR","colorBars","cont","trace","cbOpt","calcdata","out","initOpts","_fillcolor","_line","dash","_levels","_filllevels","_fillgradient","_zrange","calcOpts","calc","reversescale","colorscale","cd","moduleOpts","_module","allowsMultiplotCbs","cbOpts","contName","showscale","uid","_traceIndex","_propPrefix","_colorAxes","colorAxOpts","makeColorBarData","each","ensureSingle","done","fillColor","line","titleSide","zrange","extent","lineColormap","fillColormap","levelsIn","levelsOut","lineLevels","fillLevels","l0","ls","zr0","zr1","fillLevelsIn","reverse","calcLevels","thickPx","thickFrac","lenPx","lenFrac","xpadFrac","yExtraPx","ypadFrac","xLeftFrac","yBottomFrac","yBottomPx","yTopPx","_lenFrac","_thickFrac","_xLeftFrac","_yBottomFrac","_axis","cbAxisIn","showline","position","cbAxisOut","axisOptions","noHover","noTickson","noTicklabelmode","mockColorBarAxis","titlex","titley","autoNtick","dtFactor","dtexp","log","LN10","roundUp","titleEl","titleCont","axLayer","titleHeight","drawTitle","titleClass","titleOpts","dfltTitleOpts","propContainer","propName","traceIndex","placeholder","containerGroup","otherClass","titleGroup","titleText","titleTrans","mathJaxNode","lineSize","parseInt","nlines","lineCount","fills","zBounds","c2p","sort","fillEl","gradient","colorString","toHexString","lines","lineGroupStyle","vals","calcTicks","tickSign","getTickSigns","drawTicks","clipEnds","layer","makeTickPath","transFn","makeTransTickFn","drawLabels","makeTransTickLabelFn","labelFns","makeLabelFns","avoid","selection","offsetLeft","offsetTop","maxShift","rotate","offset","innerWidth","titleWidth","outerwidth","outerheight","xoffset","marginOpts","tFrac","bFrac","yt","yb","lFrac","rFrac","extraThickness","xl","xr","autoMargin","drawColorBar","then","_promises","colorbarPosition","t0","xf","yf","order","isPlainObject","supplyDefaults","hasColorbar","colorbarAttrs","counterRegex","palettes","paletteStr","code","context","colorAttr","colorAttrFull","cLetter","onlyIfNumerical","Boolean","noScale","showScaleDflt","colorscaleDflt","editTypeOverride","contextHead","effectDesc","auto","mid","autoFull","minFull","maxFull","minmaxFull","autoImpliedEdits","minmaxImpliedEdits","arrayOk","anim","impliedEdits","autocolorscale","autoColorDflt","noColorAxis","coloraxis","regex","extractOpts","scl","nestedProperty","get","cOpts","minVal","aggNums","maxVal","_colorAx","_sync","diverging","sequential","sequentialminus","hasColorscale","fullData","relinkColorAttrs","outerCont","isAuto","colorbarDefaults","isValidScale","traceIs","npMaybe","parentCont","prefix","slice","colorScaleDefaults","parentContIn","parentContOut","inTrace","template","_template","thisFn","colorAxes","colorAx","colorbarVisuals","stash","warn","minIn","maxIn","validMinMax","autoColorscaleDflt","sclIn","sclTemplate","constantAttrs","letterAttrs","cont2","k2","extractScale","cmin","cmax","N","si","sclNew","makeColorScaleFunc","specs","_range","sclFunc","_sclFunc","linear","clamp","noNumericCheck","returnArray","colorArray2rbga","isValid","colorArray","colorObj","colorKey","isArrayWithOneNumber","isArrayOrTypedArray","makeColorScaleFuncFromTrace","scales","helpers","crossTraceDefaults","defaultScale","getScale","colorScaleAttrs","msg","Reds","Blues","RdBu","_isSubplotObj","colorAxIn","colorAxOut","coerceAx","isValidScaleArray","highestVal","parseScale","JSON","parse","e","dv","v0","v1","vmin","vmax","vc","cursorset","selectMode","dragmode","drawMode","openMode","rectMode","freeMode","selectingOrDrawing","mouseOffset","hasHover","supportsPassive","removeElement","unhover","coverSlip","cover","createElement","cStyle","zIndex","body","pointerOffset","changedTouches","wrapped","unhoverRaw","raw","startX","startY","newMouseDownTime","dragCover","initialTarget","rightClick","numClicks","doubleClickDelay","_mouseDownTime","pointerEvents","onmousedown","onStart","_ontouchstart","removeEventListener","addEventListener","passive","ontouchstart","clampFn","minDrag","_dragged","target","buttons","ctrlKey","clientX","clientY","Date","getTime","window","getComputedStyle","documentElement","onDone","preventDefault","onMove","MINDRAG","dxdy","_dragdata","e2","MouseEvent","err","createEvent","initMouseEvent","bubbles","cancelable","view","detail","screenX","screenY","altKey","shiftKey","metaKey","button","relatedTarget","dispatchEvent","Events","throttle","getGraphDiv","hoverConstants","evt","subplot","clear","HOVERID","oldhoverdata","_hoverdata","triggerHandler","points","shape","fillmode","fgcolor","fgopacity","solidity","Colorscale","xmlnsNamespaces","DESELECTDIM","subTypes","makeBubbleSizeFn","appendArrayPointValue","drawing","setPosition","setSize","translatePoint","sel","translatePoints","hideOutsideRangePoint","isPtWithinRange","hideOutsideRangePoints","traceGroups","_hasClipOnAxisFalse","crispRound","lineWidth","staticPlot","singleLineStyle","lw","lc","ld","lw1","dashLine","dashStyle","dlw","singleFillStyle","fillcolor","fillGroupStyle","SYMBOLDEFS","symbolNames","symbolFuncs","symbolNeedLines","symbolNoDot","symbolNoFill","symbolList","symDef","n","f","needLine","noDot","noFill","MAXSYMBOL","makePointPath","symbolNumber","vbase","HORZGRADIENT","VERTGRADIENT","stopFormatter","format","gradientInfo","radial","radialreversed","reversed","horizontal","horizontalreversed","verticalreversed","gradientID","prop","info","colorStops","fullID","_defs","identity","stops","getFullUrl","className2query","_gradientUrlQueryParts","pattern","calledBy","patternID","mcc","isLegend","radius","patternTag","y0","patternAttrs","str","rects","patterns","_patternUrlQueryParts","initGradients","initPatterns","getPatternAttr","mp","pointStyle","fns","makePointStyleFns","singlePointStyle","marker","markerLine","selectedOpacityFn","mo","ms2mrc","ms","mrc","selectedSizeFn","mx","symbol","om","lineColor","perPointGradient","so","outlierwidth","outliercolor","markerLineWidth","mlw","mlcc","lineScale","mlc","markerScale","mc","selectedColorFn","isBlank","markerGradient","gradientType","mgt","markerPattern","patternShape","gradientColor","mgc","patternBGColor","patternFGColor","patternFGOpacity","patternSize","patternSolidity","perPointPattern","tryColorscale","isBubble","selectedpoints","makeSelectedPointStyleFns","selectedAttrs","selected","unselectedAttrs","unselected","selectedMarker","unselectedMarker","smo","usmo","smoIsDefined","usmoIsDefined","smc","usmc","sms","usms","smsIsDefined","usmsIsDefined","makeSelectedTextStyleFns","textFont","textfont","selectedTextFont","unselectedTextFont","stc","utc","selectedTextColorFn","selectedPointStyle","seq","pt","mrc2","TEXTOFFSETSIGN","textPointPosition","textPosition","markerRadius","group","numLines","extracTextFontSize","ts","makeTangent","prevpt","thispt","nextpt","smoothness","d1x","d1y","d2x","d2y","d1a","CatmullRomExp","d2a","numx","numy","denom1","denom2","textPointStyle","texttemplate","extractOption","fn","formatLabels","labels","pointValues","meta","texttemplateString","_d3locale","tp","textposition","tf","selectedTextStyle","tx","smoothopen","pts","tangents","smoothclosed","pLast","STEPPATH","hv","p0","p1","vh","hvh","vhv","STEPLINEAR","steps","onestep","makeTester","tester","ensureSingleById","svgAttrs","testref","savedBBoxes","savedBBoxesCount","nodeHash","inputText","getAttribute","localId","baseUrl","_exportedPlot","_baseUrl","inTester","hash","testNode","childNodes","innerNode","innerBB","cloneNode","testRect","refRect","removeChild","bb","translate","p2","getter","setter","SCALE_RE","setPointGroupScale","xScale","yScale","setAttribute","TEXT_POINT_LAST_TRANSLATION_RE","setTextPointsScale","parseFloat","existingTransform","circle","rs","square","diamond","rd","cross","rc","rc2","rx","ne","se","sw","nw","rt","r1","r2","pentagon","hexagon","hexagon2","octagon","star","x3","x4","y3","y4","hexagram","aPart","rp","hourglass","bowtie","asterisk","ry","symmetric","array","arrayminus","value","valueminus","traceref","tracerefminus","copy_ystyle","copy_zstyle","makeComputeError","calcOneAxis","calcTrace","computeError","calcPt","iIn","calcCoord","c2l","errors","shoe","hat","baseExtremes","tozero","padded","makeComputeErrorValue","dataPt","valMinus","isNaN","NaN","computeErrorValue","computeErrorValueMinus","defaultColor","objName","copyAttr","inherit","error_x","error_y","error_z","plot","hoverInfo","calcPoint","hoverPoint","yerr","yh","yerrneg","ys","xerr","xh","xerrneg","xs","plotinfo","transitionOpts","hasAnimation","duration","keyFunc","xObj","yObj","ids","sparse","hasMarkers","maxdisplayed","errorbars","transition","layerClipId","errorbar","noYS","noXS","errorCoords","vis","yerror","yw","ease","easing","xerror","xw","hoverLabelAttrs","namelength","paste","traceAttr","cdAttr","makeCoerceHoverInfo","coerceHoverinfo","hoverinfo","fillFn","fillArray","hovertemplate","hover","annotationsDone","getComponentMethod","emitClick","stopImmediatePropagation","YANGLE","HOVERARROWSIZE","HOVERTEXTPAD","HOVERFONTSIZE","HOVERFONT","HOVERMINTIME","handleHoverLabelDefaults","getSubplot","geo","isTraceInSubplots","xaxes","yaxes","flat","p2c","axArray","getDistanceFunction","mode","dxy","quadrature","getClosest","distfn","pointData","distance","newDistance","inbox","passVal","di","pointNumber","curveNumber","_indexToPoints","pointIndices","pointIndex","xVal","yVal","zLabelVal","arrayAttrs","_arrayAttrs","astr","getPointKey","pointVal","getPointData","appendArrayMultiPointValues","pointNumbers","keyVal","pointKeyMap","locations","parents","xyHoverMode","unifiedHoverMode","isUnifiedHover","hovermode","isXYhover","overrideCursor","legendSupplyDefaults","legendDraw","YA_RADIANS","YFACTOR","YSHIFTX","YSHIFTY","multipleHoverPoints","violin","hoverDataKey","noHoverEvent","plots","_plots","hasCartesian","_has","overlayedSubplots","overlays","pi","xaArray","yaArray","supportsCompare","spId","_subplot","hoverdistance","spikedistance","xvalArray","yvalArray","itemnum","curvenum","subploti","_mode","xval","yval","closedataPreviousLength","searchData","spikePoints","hLinePoint","vLinePoint","hasOneHorizontalTrace","orientation","xpx","ypx","composedPath","dbb","_calcInverseTransform","transformedCoords","apply3DTransform","_invTransform","pointerX","pointerY","findHoverPoints","customXVal","customYVal","maxHoverDistance","maxSpikeDistance","spikeDistance","xSpike","ySpike","xLabelVal","yLabelVal","_splomScenes","hoverPoints","newPoints","finiteRange","hoverLayer","newPoint","newPointNum","cleanPoint","splice","closestPoints","point","tmpPoint","closestVPoints","showspikes","spikesnap","closestVPt","fillSpikePoint","closestHPoints","closestHPt","selectClosestPoint","pointsData","thisSpikeDistance","resultPoint","minDistance","spikelineOpts","_paperdiv","oldspikepoints","_spikepoints","newspikepoints","tmpHPoint","tmpVPoint","result","spikesChanged","createSpikelines","sortHoverData","d1","d2","first","second","last","orderRangePoints","winningPoint","initLen","getCoord","finalPoints","seen","newHd","oldId","oldHd","newhoverdata","ht","rotateLabels","plot_bgcolor","paper_bgcolor","labelOpts","commonLabelOpts","hoverLabels","createHoverText","axKey","donepositioning","topOverlap","bottomOverlap","pti","sumdp","nummoves","axSign","nLabels","pointgroups","constrainGroup","grp","minPt","maxPt","pmin","dp","pmax","deleteCount","del","axIsX","rng","datum","posref","by","g0","g1","apply","hoverPt","hoverAvoidOverlaps","alignHoverText","_invScaleX","_invScaleY","tagName","oldPt","newPt","hoverChanged","xvals","yvals","_hover","hoverItems","multiHover","hoverItem","xLabel","yLabel","zLabel","idealAlign","nameLength","textAlign","hovertemplateLabels","container3","outerContainer3","fullOpts","hoverLabel","lastBottomY","topY","anchorIndex","scaleX","scaleY","EXTRA_STRING_REGEX","c0","outerContainerBB","outerTop","showCommonLabel","traceHoverinfo","allHaveZ","commonLabel","label","lpath","ltext","commonBgColor","commonStroke","contrastColor","commonLabelFont","lx","ly","tbb","topsign","halfWidth","sgn","leftsign","clipPath","halfHeight","lty","clipId","ltx","dummy","dummyBB","textClip","mockLayoutIn","showlegend","legend","tracegroupgap","traceorder","mockLayoutOut","mockLegend","entries","texts","getHoverLabelText","dir","_distinct","_inHover","legendContainer","txWidth","txHeight","overflowBottom","dColor","color0","numsColor","nameColor","tx2","tx2width","tx2height","t2bb","anchorStartOK","anchorEndOK","htx","hty","txTotalWidth","ty0","bx","txwidth","txHalfWidth","overflowR","overflowL","nameOverride","plainText","h0","h1","extraText","hovertemplateString","extra","pX","pY","horzSign","alignShift","txx","tx2x","offsetX","offsetY","isMiddle","posX","posY","cd0","pass","getVal","calcKey","traceKey","castOption","hoverLabelText","xhoverformat","c2d","yhoverformat","xeText","tickText","yeText","infomode","showY","showX","hLinePointX","hLinePointY","xBase","xEndSpike","dfltHLineColor","readability","yMode","spikemode","yThickness","spikethickness","yColor","spikecolor","xEdge","getPxPosition","xAcross0","_counterDomainMin","xAcross1","_counterDomainMax","spikedash","cx","cy","vLinePointX","vLinePointY","yBase","yEndSpike","dfltVLineColor","xMode","xThickness","xColor","yEdge","yAcross0","yAcross1","allowedTags","_categoriesMap","d2c","posLetter","boxmode","violinmode","dPos","inheritFontAttr","hoverModule","supplyLayoutGlobalDefaults","castHoverOption","ptNumber","castHoverinfo","containerOrSelection","isD3Selection","click","clickmode","selectdirection","handleHoverModeDefaults","hasMapbox","hasGeo","domainAttrs","cartesianIdRegex","gridAttrs","rows","roworder","columns","freeLength","dimensions","items","xgap","ygap","noGridCell","xside","yside","getAxes","grid","gridVal","splomVal","_splomAxes","fillGridPositions","dfltGap","dfltSide","dirGap","step","cellDomain","cellStart","fillGridAxes","axesIn","axesAllowed","axisMap","fillOneAxis","axisId","sizeDefaults","gridIn","xAxes","yAxes","dfltRows","dfltColumns","hasSubplotGrid","hasXaxes","hasYaxes","isSplomGenerated","gridOut","_hasSubplotGrid","dfltSideX","dfltSideY","dfltGapX","dfltGapY","_splomGridDflt","_domains","contentDefaults","xId","yId","subplotsOut","yPos","useDefaultSubplots","_axisMap","subplotsIn","rowOut","rowIn","cartesian","anchors","_anchors","i0","inc","iFinal","column","row","source","sizex","sizey","sizing","image","images","currentPos","currentSize","newPos","newSize","imageDefaults","imageIn","imageOut","_imgIndices","axisIds","imageDataAbove","imageDataSubplot","imageDataBelow","img","ref2id","mainplot","setImage","thisImage","_imgSrc","svg","imagePromise","Promise","resolve","Image","errorHandler","onerror","onload","canvas","getContext","drawImage","dataURL","toDataURL","src","bind","applyAttributes","xIsDomain","yIsDomain","xPos","xOffset","yOffset","preserveAspectRatio","clipAxes","imagesBelow","_imageLowerLayer","imagesAbove","_imageUpperLayer","allSubplots","subplotObj","imagelayer","imagesOnSubplot","itemsizing","itemwidth","itemclick","itemdoubleclick","uirevision","scrollBarWidth","scrollBarMinHeight","scrollBarColor","scrollBarMargin","scrollBarEnterAttrs","titlePad","itemGap","basePlotLayoutAttributes","legendTraceCount","legendReallyHasATrace","defaultOrder","_dfltShowLegend","barmode","isGrouped","legendgroup","isReversed","showLegend","defaultX","defaultY","defaultYAnchor","itemFont","isHorizontal","handleClick","getLegendData","clickOrDoubleClick","legendItem","evtData","expandedIndex","_expandedIndex","frames","_transitionData","_frames","config","_group","_clickTimeout","setTimeout","clearTimeout","_legendMouseDownTime","drawTexts","legendObj","isPieLike","isEditable","legendText","maxNameLength","_maxNameLength","groupTitle","textEl","ensureLength","textGap","newName","fullInput","_fullInput","hasTransform","groupbyIndices","getTransformIndices","kcont","keyedContainer","set","constructUpdate","maxLength","targetLength","setupTraceToggle","traceToggle","_editing","aTitle","mathjaxNode","bw","lineHeight","mathjaxBB","textLines","textNode","_titleWidth","_titleHeight","computeTextDimensions","getXanchor","isRightAnchor","isCenterAnchor","getYanchor","isBottomAnchor","isMiddleAnchor","legendData","inHover","hiddenSlices","hiddenlabels","_topdefs","bg","scrollBox","scrollBar","groups","isVertical","bw2","endPad","isBelowPlotArea","isAbovePlotArea","traceGroupGap","_maxHeight","toggleRectWidth","_width","_height","titleSize","getTitleSize","_lgroupsLength","isLeftOfPlotArea","isRightOfPlotArea","isBeyondPlotAreaY","hw","_maxWidth","maxItemWidth","combinedItemWidth","maxRowWidth","maxGroupHeightInRow","groupOffsetX","groupOffsetY","maxWidthInGroup","next","nTraces","oneRowLegend","maxItemHeightInRow","rowWidth","ceil","_effHeight","legendPosition","computeLegendDimensions","expandMargin","autoexpand","lx0","ly0","_scrollY","eventY0","eventY1","scrollBoxY0","scrollBarHeight","scrollBarYMax","scrollBoxYMax","scrollRatio","scrollBoxY","scrollHandler","deltaY","scrollBarDrag","behavior","drag","sourceEvent","getScrollBarDragY","scrollBoxTouchDrag","getNaturalDragY","newX","newY","clickedTrace","bbox","_draw","grouped","lgroupToTraces","lgroups","hasOneNonBlankGroup","slicesShown","lgroupi","addOneItem","legendGroup","uniqueGroup","lgroup","labelj","shouldCollapse","groupMinRank","rank","legendrank","_groupMinRank","_preGroupSort","orderFn2","_preSort","firstItem","gt","legendgrouptitle","unshift","SHOWISOLATETIP","itemClick","itemDoubleClick","showTips","notifier","fullTrace","attrUpdate","attrIndices","carrs","carrIdx","thisLabel","thisLabelIndex","tracei","hasLegendgroup","traceIndicesInGroup","nextVisibility","setVisibility","isClicked","isInGroup","notInLegend","otherState","isIsolated","updateKeys","hasOwnProperty","insertUpdate","attrIndex","valueArray","visibility","lastGroupbyIndex","curState","legendLayout","stylePie","pieCastOption","getGradientDirection","isRadial","getStyleGuide","contours","showLine","hasLines","showMarker","showFill","showGradientLine","showGradientFill","coloring","showlines","_operation","anyLine","anyFill","dimAttr","constantItemSizing","itemWidth","centerPos","centerTransform","boundLineWidth","cst","styleBarLike","lThis","desiredType","isVisible","barpath","d0","stylePieLike","tMod","minExtend","d0Mod","traceGroup","layers","markerOffsetY","useGradient","ptsData","dd","vertexcolor","facecolor","isWaterfall","hasTotals","boxpoints","sizeref","sizemin","sizemode","dMod","styleGuide","pathStart","this3","showText","hasText","boundVal","attrIn","arrayToValFn","bounds","valIn","valToBound","pickFirst","dEdit","tEdit","mean","ptgroup","txt","activecolor","add","backButtons","foreButtons","Icons","eraseActiveShape","modeBarButtons","handleCartesian","ev","currentTarget","aobj","axList","list","allSpikesEnabled","_cartesianSpikesEnabled","mag","r0","fixedrange","_rangeInitial","rangeInitial","_showSpikeInitial","rangeNow","rangeNew","_isHoriz","handleDrag3d","sceneIds","layoutUpdate","val2d","handleCamera3d","resetLastSave","resetDefault","didUpdate","sceneId","camera","aspectratio","aspectmode","_scene","viewInitial","up","eye","getNextHover3d","_previousVal","axes","currentSpikes","hovermodeAStr","spikeAStr","handleGeo","geoIds","geoLayout","projection","newScale","resetView","getNextHover","toggleHover","newHover","handleMapboxZoom","subplotIds","mapbox","aObj","current","zoom","subplotType","viewKeys","toImage","toImageButtonOptions","icon","isIE","filename","catch","sendDataToCloud","disk","editInChartStudio","pencil","zoom2d","_cat","zoombox","pan2d","pan","select2d","selectbox","lasso2d","lasso","drawclosedpath","drawopenpath","drawline","drawrect","drawcircle","eraseshape","zoomIn2d","zoom_plus","zoomOut2d","zoom_minus","autoScale2d","autoscale","resetScale2d","home","hoverClosestCartesian","tooltip_basic","gravity","hoverCompareCartesian","tooltip_compare","zoom3d","pan3d","orbitRotation","tableRotation","resetCameraDefault3d","resetCameraLastSave3d","movie","hoverClosest3d","toggle","zoomInGeo","zoomOutGeo","resetGeo","hoverClosestGeo","hoverClosestGl2d","hoverClosestPie","resetViewSankey","_viewInitial","resetViews","toggleSpikelines","spikeline","areSpikesOn","setSpikelineVisibility","resetViewMapbox","zoomInMapbox","zoomOutMapbox","buttonList","DRAW_MODES","toLowerCase","addToForeButtons","modebar","manage","scatterSubTypes","createModeBar","modeBar","_modeBar","displayModeBar","watermark","modeBarButtonsToRemove","Error","modeBarButtonsToAdd","buttonGroups","customButtons","buttonGroup","fillCustomButton","B","layoutAdd","layoutRemove","buttonsToAdd","buttonsToRemove","hasGL3D","hasPie","hasFunnelarea","hasGL2D","hasTernary","hasPolar","hasSankey","allAxesFixed","areAllAxesFixed","hasUnifiedHoverLabel","addGroup","newGroup","found","q","commonGroup","showEditInChartStudio","showSendToCloud","zoomGroup","hoverGroup","resetGroup","dragModeGroup","hasNoHover","selectable","selectPoints","isSelectable","enabledHoverGroup","enableHover","newList","appendButtonsToGroups","getButtonGroups","destroy","Parser","DOMParser","ModeBar","graphInfo","proto","prototype","modeBarId","bgSelector","deleteRelatedStyleRule","addRelatedStyleRule","needsNewButtons","hasButtons","needsNewLogo","hasLogo","displaylogo","needsNewLocale","locale","removeAllButtons","updateButtons","logoGroup","getLogo","insertBefore","updateActiveButton","_this","buttonElements","buttonsNames","createGroup","buttonConfig","buttonName","createButton","createIcon","question","thisIcon","iconHeight","ascent","descent","svgNS","createElementNS","parseFromString","buttonClicked","dataAttrClicked","thisval","dataAttr","isToggleButton","button3","currentButtons","href","newplotlylogo","firstChild","_modebardiv","_privateplot","buttonAttrs","stepmode","count","yPad","minButtonWidth","buttonDefaults","buttonIn","buttonOut","selectorOut","counterAxes","selectorIn","rangeselector","posDflt","anchoredList","getPosDflt","getUpdateObject","selectorKeyFunc","drawButtonRect","selectorLayout","rect","_isActive","_isHovered","getFillColor","drawButtonText","selectors","makeSelectorData","axisLayout","isActive","tHeight","hEff","tWidth","tLines","wEff","graphSize","reposition","buttonLayout","xrange","range0","currentRange","time","base2","getXRange","colorAttributes","listAxes","getAutoRange","containerClassName","bgClassName","rangePlotClassName","maskMinClassName","maskMaxClassName","slideBoxClassName","grabberMinClassName","grabAreaMinClassName","handleMinClassName","grabberMaxClassName","grabAreaMaxClassName","handleMaxClassName","maskMinOppAxisClassName","maskMaxOppAxisClassName","maskColor","maskOppAxisColor","slideBoxFill","slideBoxCursor","grabAreaFill","grabAreaCursor","grabAreaWidth","handleWidth","handleRadius","handleStrokeWidth","extraPad","oppAxisAttrs","axIn","axOut","rangeslider","_requestRangeslider","rangeContainerIn","rangeContainerOut","isValidRange","yIds","name2id","yNames","simpleMap","id2name","yName","rangemodeDflt","yAxOut","coerceRange","Cartesian","axisIDs","drawBg","rangeSlider","axisOpts","borderCorrect","offsetShift","_offsetShift","addClipPath","_clipId","drawRangePlot","mainplotinfo","calcData","rangePlots","_subplotsWith","plotgroup","isMainPlot","oppAxisOpts","oppAxisName","oppAxisRangeOpts","mockFigure","rangebreaks","rangemode","clearCalc","isRangePlot","rangePlot","filterRangePlotCalcData","drawMasks","maskOppBorder","drawSlideBox","drawGrabbers","grabberMin","grabberMax","handleFixAttrs","handleDynamicAttrs","grabAreaFixAttrs","rangeSliderData","_rangeSliderData","rangeSliders","newRng","axRng","cleanRange","_depth","_rl","rl0","rl1","drl","p2d","d2p","rsBreaks","locateBreaks","brk","lBreaks","m2","_B","range0OppAxis","distOppAxis","d2pOppAxis","slideBox","grabAreaMin","grabAreaMax","mouseDownHandler","touches","mouseMove","pixelMin","pixelMax","delta","tmp","_pixelMin","_pixelMax","dataMin","dataMax","requestAnimationFrame","setDataRange","mouseUp","setupDragElement","hw2","clampOppAxis","clampHandle","pixelMinOppAxis","pixelMaxOppAxis","xMin","xMax","setPixelRange","makeData","autoMarginOpts","bottomDepth","BR_TAG_ALL","pad","scatterLineAttrs","xsizemode","ysizemode","fillrule","editable","calcXPaddingOptions","calcPaddingOptions","calcYPaddingOptions","sizeMode","isYAxis","ppad","axisDirectionReverted","extractPathCoords","paramIsY","paramIsX","maxValue","minValue","beforePad","afterPad","shapeBounds","paramsToUse","convertVal","drawnParam","params","segments","segmentRE","decodeDate","drawn","paramRE","shapeList","shapes","vx0","vx1","vy0","vy1","M","L","H","V","Q","C","T","S","Z","numParams","handleShapeDefaults","shapeIn","shapeOut","shapeType","xSizeMode","ySizeMode","pos2r","r2pos","attrAnchor","_shapeIndices","rangeToShapePosition","shapePositionToRange","attr0","attr1","in0","in1","inAnchor","readPaths","displayOutlines","clearOutlineControllers","_shapeUpperLayer","_shapeLowerLayer","shapelayer","shouldSkipEdits","_drawing","couldHaveActiveShape","shapePosition","o","makeOptionsAndPlotinfo","drawShape","shapeLayer","getPathString","lineDash","isOpen","isActiveShape","_activeShapeIndex","activeshape","setClipPath","dragOptions","polygons","shapePath","shapeOptions","xAnchor","yAnchor","n0","s0","w0","e0","optN","optS","optW","optE","pathIn","dragMode","xPixelSized","yPixelSized","isLine","isPath","x2p","getDataToPixel","y2p","p2x","getPixelToData","p2y","sensoryElement","minSensoryWidth","sensoryWidth","circleStyle","circleRadius","createLineDragHandles","updateDragMode","renderVisualCues","deactivateClipPathTemporarily","moveShape","resizeShape","removeVisualCues","dragBBox","noOp","moveX","moveY","encodeDate","movePath","newX0","newY0","newX1","newY1","has","hasN","hasS","hasW","hasE","newN","newS","newW","newE","isNotPath","visualCues","midRange","roundPositionForSharpStrokeRendering","crossPath","vBarPath","hBarPath","renderAnchor","onmousemove","deactivateShape","_deactivateShape","activateShape","_hadPlotinfo","x2r","y2r","xSizemode","ySizemode","segment","paramNumber","segmentType","xParams","yParams","nParams","paramString","param","convertPath","xAnchorPos","yAnchorPos","rArc","rightPt","newShapes","newshape","drawdirection","CIRCLE_SIDES","i000","i090","i180","i270","cos45","sin45","SQRT2","pointsShapeRectangle","pointsShapeEllipse","writePaths","outlines","nCalls","redrawing","updateObject","vertexDragOptions","shapeDragOptions","indexI","indexJ","copyPolygons","zoomLayer","_zoomlayer","startDragVertex","srcElement","moveVertexController","cell","endDragVertexController","clickVertexController","newPolygon","removeVertex","moveShapeController","startDragShapeController","endDragShapeController","polygonsOut","polygonsIn","recordPositions","onEllipse","vertex","addVertexControllers","addShapeControllers","parseSvgPath","cartesianHelpers","iC","iQS","almostEq","dist","nI","nJ","nK","realK","initX","initY","cmd","polys","recStart","cenX","cenY","noOffset","_x","_y","i2","handleEllipse","isEllipse","ellipseOver","dragHelpers","clearSelect","drwStyle","xPaper","yPaper","isOpenMode","newShape","xA","xB","xC","xD","yA","yB","yC","yD","xDateOrLog","yDateOrLog","xIsDate","yIsDate","fixDatesForPaths","allShapes","beforeEdit","afterEdit","r2d","convertToPx","convertToDate","extractedCoordinates","relevantParamIdx","cleanNumber","refType","dataToPixel","opt","pixelToData","strokeWidth","strokeWidthIsOdd","posValAsInt","supplyDrawNewShapeDefaults","padAttrs","extendDeepAll","animationAttrs","stepsAttrs","method","args","execute","active","currentvalue","suffix","activebgcolor","gripBgActiveColor","railBgColor","railBorderColor","railBorderWidth","tickLength","tickColor","minorticklen","minorTickLength","groupClassName","inputAreaClass","railRectClass","railTouchRectClass","gripRectClass","tickRectClass","inputProxyClass","labelsClass","labelGroupClass","labelClass","currentValueClass","railHeight","menuIndexAttrName","autoMarginIdRoot","minWidth","minHeight","textPadX","arrowOffsetX","railRadius","railWidth","railBorder","railInset","stepInset","gripRadius","gripWidth","gripHeight","gripBorder","gripBorderWidth","gripBorderColor","gripBgColor","labelPadding","labelOffset","tickWidth","tickOffset","minorTickOffset","minorTickColor","currentValuePadding","currentValueInset","stepAttrs","sliderDefaults","sliderIn","sliderOut","stepDefaults","stepCount","_stepCount","visSteps","_visibleSteps","valueIn","valueOut","autoMarginId","sliderOpts","keyFunction","findDimensions","sliderLabels","maxLabelWidth","labelHeight","stepOpts","drawLabel","dims","_dims","inputAreaWidth","outerLength","inputAreaStart","inputAreaLength","availableSpacePerLabel","computedSpacePerLabel","labelStride","currentValueMaxWidth","currentValueHeight","currentValueTotalHeight","currentValueMaxLines","dummyGroup","curValPrefix","drawCurrentValue","curValSize","sliderGroup","valueOverride","textAnchor","curVal","_gd","drawGrip","attachGripEvents","item","drawLabelGroup","labelItems","labelSteps","normalizedValueToPosition","fraction","handleInput","normalizedPosition","doTransition","quantizedPosition","quantizedIndex","setActive","doCallback","previousActive","applyUpdate","setGripPosition","slider","interaction","_nextMethod","_nextMethodRaf","_step","executeAPICommand","$gd","getSliderOpts","grip","stopPropagation","positionToNormalizedValue","mouse","tick","isMajor","_invokingCommand","drawTouchRect","drawRail","computedLength","sliderData","contOpts","makeSliderData","sliders","clearSlider","_commandObserver","sliderGroups","gSlider","nsteps","computeLabelSteps","manageCommandObserver","drawSlider","interactConstants","OPPOSITE_SIDE","numStripRE","editAttr","isplaceholder","elShouldExist","titleLayout","scootTitle","transformVal","fontWeight","titleElIn","backside","shiftSign","titlebb","paperbb","maxshift","avoidbb","bBoxIntersect","shiftTemplate","SHOW_PLACEHOLDER","HIDE_PLACEHOLDER","buttonsAttrs","args2","_arrayAttrRegexps","direction","showactive","headerGroupClassName","headerClassName","headerArrowClassName","dropdownButtonGroupClassName","dropdownButtonClassName","buttonClassName","itemRectClassName","itemTextClassName","blankHeaderOpts","arrowPadX","textOffsetX","textOffsetY","gapButtonHeader","gapButton","activeColor","hoverColor","arrowSymbol","down","menuDefaults","menuIn","menuOut","ScrollBox","menuOpts","gButton","buttonOpts","gHeader","buttonIndex","isSilentUpdate","drawButtons","drawHeader","header","headerOpts","posOpts","xPad","positionOverrides","headerWidth","headerHeight","drawItem","setItemPosition","styleOnMouseOver","styleOnMouseOut","buttonData","isFolded","klass","openHeight","openWidth","scrollBoxPosition","defaultPrevented","menu","styleButtons","translateX","translateY","heights","widths","enable","hbar","vbar","drawScrollBox","hasHBar","hasVBar","disable","hideScrollBox","itemOpts","drawItemRect","drawItemText","width1","height1","totalWidth","totalHeight","fakeButtons","paddedWidth","paddedHeight","overrideOpts","finalHeight","spanOffset","newMenuIndexAttr","menuData","clearAutoMargin","menus","_menulayer","headerGroups","scrollBoxId","_gButton","barWidth","barLength","barRadius","barPad","barColor","fullWidth","fullHeight","boxL","boxR","boxT","boxB","isDown","isLeft","isUp","boxW","boxH","_box","needsHorizontalScrollBar","hbarW","hbarH","hbarL","hbarT","_hbarXMin","_hbarTranslateMax","needsVerticalScrollBar","vbarW","vbarH","vbarL","vbarT","_vbarYMin","_vbarTranslateMax","clipL","clipR","clipT","clipB","_clipRect","onBoxDrag","_onBoxDrag","_onBoxWheel","onBarDrag","_onBarDrag","yMin","yMax","translateXMax","translateYMax","FROM_BL","CAP_SHIFT","MID_SHIFT","axisname","FORMAT_LINK","DATE_FORMAT_LINK","COMPARISON_OPS","COMPARISON_OPS2","INTERVAL_OPS","SET_OPS","CONSTRAINT_REDUCTION","BADNUM","FP_SAFE","MAX_VALUE","ONEMAXYEAR","ONEAVGYEAR","ONEMINYEAR","ONEMAXQUARTER","ONEAVGQUARTER","ONEMINQUARTER","ONEMAXMONTH","ONEAVGMONTH","ONEMINMONTH","ONEWEEK","ONEHOUR","ONEMIN","ONESEC","ALMOST_EQUAL","LOG_CLIP","MINUS_SIGN","xmlns","xlink","version","plotApi","methodNames","PlotlyLocales","resize","graphJson","Snapshot","PlotSchema","isLeftAnchor","isTopAnchor","modModule","mod","modHalf","twoPI","isFullCircle","aBnds","angleDelta","isAngleInsideSector","s1","a0","a1","_path","isClosed","aStart","aMid","aEnd","rStart","rEnd","isCircle","largeArc","arc","cw","deg2rad","deg","rad2deg","rad","angleDist","isPtInsideSector","rBnds","pathArc","pathSector","pathAnnulus","ab","ArrayBuffer","DataView","isView","_rowLength","len0","isArray1D","ensureArray","_constructor","arg0","argi","posi","leni","allArray","totalLen","arguments","constructor","maxRowLength","minRowLength","JUNK","_glcanvas","regl","depth","_responsiveChartHandler","baseTraceAttrs","colorscales","validate","valObjectDef","valObjectMeta","validateFunction","failed","propMock","coerceFunction","data_array","requiredOpts","otherOpts","propOut","enumerated","coerceNumber","RegExp","number","integer","string","okToCoerce","strict","noBlank","colorlist","every","angle","subplotid","flaglist","vParts","vi","any","info_array","coercePart","propPart","twoD","len2","vNew","vOut","arrayItems","arrayItems2D","innerItemsOnly","attribute","propIn","coerce2","dfltObj","coercePattern","markerColor","hasMarkerColorscale","isOverlay","moduleAttrs","valObj","_dataLength","coerceSelectionMarkerOpacity","smoDflt","usmoDflt","MIN_MS","MAX_MS","timeFormat","Loggers","utcFormat","DATETIME_REGEXP","DATETIME_REGEXP_CN","YFIRST","getFullYear","isWorldCalendar","componentsRegistry","lpad","digits","dateTick0","dayOfWeek","sunday","_dateTick0","dateTime2ms","ms2DateTime","dfltRange","isJSDate","tzOffset","getTimezoneOffset","offsetTweak","getUTCMinutes","getMinutes","getUTCSeconds","getSeconds","getUTCMilliseconds","getMilliseconds","comb","isWorld","isChinese","m","calInstance","isIntercalary","newDate","toMonthIndex","toJD","date","UTC","setUTCFullYear","getUTCMonth","getUTCDate","isDateTime","NINETYDAYS","THREEHOURS","FIVEMIN","includeTime","dateStr","msec10","msecTenths","msRounded","timeMs","getUTCHours","ms2DateTimeLocal","getHours","cleanDate","isFinite","error","fracMatch","halfYearMatch","quarterToHalfYear","modDateFormat","formatter","toFixed","MAXSECONDS","tr","extraFormat","year","month","timePart","timeStr","secStr","formatTime","dayMonthYear","dayMonth","THREEDAYS","incrementMonth","dMonth","setUTCMonth","findExactDates","exactYears","exactMonths","exactDays","blankCount","day","dataCount","loggers","matrix","mat4X4","elParent","styleString","getElementById","createTextNode","styleSheet","sheet","insertRule","addRule","getElementTransformMatrix","getPropertyValue","getElementAndAncestors","allElements","isTransformableElement","Element","HTMLElement","gdElement","isPlotDiv","getFullTransformMatrix","convertCssMatrix","multiply","equalDomRects","EventEmitter","plotObj","_ev","internalEv","_internalEv","once","removeListener","removeAllListeners","_internalOn","_internalOnce","_removeInternalListener","_removeAllInternalListeners","jQuery","trigger","jQueryHandlerValue","nodeEventHandlerValue","handlers","_events","handler","listener","fired","purge","_extend","inputs","isDeep","keepAllKeys","noArrayCopies","input","copy","copyIsArray","clone","allPrimitives","primitivesLoopSplice","extendDeep","extendDeepNoArrays","baseFilter","calcDataFilter","filterFn","locationCache","workingPath","workingTextWidth","det","u","perpDistance2","xab","yab","llab","xac","yac","fcAB","xbc","ybc","crossProduct","segmentDistance","x12","y12","x34","y34","ll12","ll34","dist2","getTextLocation","totalPathLen","positionOnPath","theta","atan","pCenter","clearLocationCache","getVisibleSegment","buffer","pt0","ptTotal","pMin","pTotal","pMax","getDistToPlot","distToPlot","total","findPointOnPath","diff","pathLength","tolerance","iterationLimit","mul","b0","b1","lenX1","lenDt","toPrecision","numConstants","MAX_SAFE","MIN_SAFE","lib","relativeAttr","relinkPrivateKeys","arrayModule","coerceModule","datesModule","searchModule","findBin","sorterAsc","sorterDes","distinctVals","findIndexOfMin","statsModule","median","variance","stdev","interp","matrixModule","init2dArray","transposeRagged","dot","translationMatrix","rotationMatrix","inverseTransformMatrix","anglesModule","anchorUtils","geom2dModule","extendModule","loggersModule","regexModule","counter","throttleModule","throttleDone","clearThrottle","domModule","makePtIndex2PtNumber","indexToPoints","ptIndex2ptNumber","clearResponsive","preserveDrawingBuffer","makeTraceGroups","filterUnique","increment","ensureNumber","isIndex","noop","repeat","cnt","swapAttrs","attrList","part1","part2","xp","yp","temp","raiseToTop","elem","cancelTransition","func","randstr","existing","bits","_recursion","res","rem","random","parsed","OptionControl","optname","self","optObj","optionList","smooth","arrayIn","FWHM","alen","alen2","wlen","arrayOut","sequence","arg","finalStep","ret","continueAsync","fni","promiseError","stripTrailingSlash","hasAny","hasAll","mergeArray","hasFn","imax","mergeArrayCastPositive","traceVal","tagSelected","ptNumber2cdIndex","ptIndex","cdIndex","selIndices2selPoints","getTargetArray","transformOpts","obj1","obj2","objOut","subarray","titleCase","toUpperCase","containsAny","fragments","navigator","msSaveBlob","IS_SAFARI_REGEX","isSafari","userAgent","IS_IOS_REGEX","isIOS","FIREFOX_VERSION_REGEX","getFirefoxVersion","exec","versionInt","obj","parent","nodeType","enterFn","objectFromPath","tmpObj","dottedPropertyRegex","indexedPropertyRegex","expandObjectPaths","idx","dest","trailingPath","numSeparate","separators","thousandsRe","decimalSep","thouSep","TEMPLATE_STRING_REGEX","SIMPLE_PROPERTY_REGEX","getterCache","isValidTextValue","hovertemplateWarnings","templateFormatString","texttemplateWarnings","TEMPLATE_STRING_FORMAT_SEPARATOR","d3locale","rawKey","isSpaceOther","isSpaceOtherSpace","isOtherSpace","hasOther","substring","numberFormat","keyLabel","subplotSort","numA","numB","charA","charCodeAt","charB","isNumA","isNumB","randSeed","seedPseudoRandom","pseudoRandom","lastVal","fillText","formatPercent","ratio","isHidden","display","getTextTransform","noCenter","targetX","targetY","anchorX","anchorY","ensureUniformFontSize","baseFont","uniformtext","minsize","join2","arr","mainSeparator","lastSeparator","firefoxVersion","isProblematicFirefox","getPositionFromD3Event","layerX","layerY","process","versions","getPrototypeOf","baseObj","keyName","valueName","baseProp","changeTypes","indexLookup","isSimpleValueProp","changeType","newValue","rename","object","changed","locales","dict","dictionary","localeRegistry","baseLocale","dfltConfig","logging","messages","console","notifyOnLogging","traceLayer","cdModule","cls","rowLength","colLength","maxlen","zlen","yTranspose","alpha","xyz","xy","at","xys","invert","npGet","curPart","allSame","curCont","propStr","indexed","indices","propParts","badContainer","npSet","ARGS_PATTERN","isDeletable","containerLevels","toDelete","setArrayAll","checkNewContainer","joinPropStr","pop","newPart","toAdd","containerArray","innerParts","arrayVal","allSet","thisVal","thisPropStr","deleteThis","firstPart","part","nextPart","NOTEDATA","displayLength","notifierContainer","thisText","note","html","killNote","delay","thisIndex","STASHATTR","savedCursor","classes","polygon","ptsIn","xmin","xmax","ymin","ymax","rectFirstEdgeTest","isRect","degenerate","lastPt","contains","omitFirstEdge","xmini","ycross","crossings","isSegmentBent","partParallel","startPt","segmentSquared","segmentLen","unitPerp","ptsFiltered","doneRawIndex","doneFilteredIndex","addPt","prevFilterLen","iLast","filtered","isMobileOrTablet","ua","headers","getUserAgent","tablet","featureDetect","allParts","prevPart","itemStr","queue","undoFunc","undoArgs","redoFunc","redoArgs","queueObj","queueIndex","undoQueue","autoplay","inSequence","beginSequence","undo","calls","redo","queueLength","plotDo","copyArgArray","openEnded","matchBeginning","fullTail","startWithPrefix","ASCEND","SIMPLEATTR","baseAttr","toContainer","fromContainer","fromVal","toVal","minLen","roundingError","lessThan","lessOrEqual","greaterThan","greaterOrEqual","bins","linelow","n1","n2","binSize","valsIn","preV","minDiff","errDiff","newVals","low","high","dlow","dhigh","rounded","sortFn","notOrdered","notReversed","pairOrder","ind","numArr","frac","getSize","_selection","_dimension","FIND_TEX","_callback","tex","MathJax","svgClass","_texString","_config","originalRenderer","originalConfig","originalProcessSectionDelay","tmpDiv","Hub","Queue","processSectionDelay","Config","messageStyle","tex2jax","inlineMath","displayAlign","menuSettings","renderer","setRenderer","randomID","LT_MATCH","GT_MATCH","Typeset","glyphDefs","svgBBox","texToSVG","_svgEl","_glyphDefs","_svgBBox","newSvg","overflow","newSvgW","newSvgH","hasLink","containerNode","NEWLINES","currentNode","nodeStack","currentLine","newLine","lineNode","class","oldNodeStack","enterNode","nodeSpec","nodeAttrs","popup","onclick","newNode","addTextNode","ZERO_WIDTH_SPACE","resetter","RESET_DY","SHIFT_DY","exitNode","BR_TAG","SPLIT_TAGS","parti","ONE_TAG","tagType","tagStyle","TAG_STYLES","convertEntities","css","getQuotedMatch","STYLEMATCH","COLORMATCH","HREFMATCH","dummyAnchor","PROTOCOLS","protocol","encodeURI","decodeURI","TARGETMATCH","POPUPMATCH","buildSVGText","sup","sub","span","em","_str","re","eLen","oldParts","newParts","prevTag","pLen","pLen2","entityToUnicode","mu","amp","lt","nbsp","times","plusmn","ENTITY_MATCH","fullMatch","innerMatch","stringFromCodePoint","fromCodePoint","stringFromCharCode","fromCharCode","alignHTMLWith","_base","thisRect","getTop","getLeft","alignH","horizontalAlign","alignV","verticalAlign","bRect","cRect","sanitizeHTML","rootNode","setOrGet","thisX","thisY","onePx","makeTextShadow","_delegate","dispatch","handlerElement","div","initialText","outline","padding","contenteditable","textContent","mathjaxClass","edit","editDiv","activeElement","blur","which","cancel","selectElementContents","_el","createRange","selectNodeContents","getSelection","removeAllRanges","addRange","focus","immediate","rebind","timerCache","_clearTimeout","cache","timer","minInterval","callback","now","idi","previousOnDone","days","shortDays","months","shortMonths","periods","dateTime","decimal","thousands","grouping","currency","arrayStr","rootContainers","layoutArrayContainers","regexpContainers","layoutArrayRegexes","rootPart","property","traceOpts","layoutOpts","traceEditTypeFlags","layoutEditTypeFlags","falseObj","overrideContainers","overrideOne","traceFlags","layoutFlags","editTypeParts","m4FromQuat","AxisIds","cleanId","getFromTrace","cleanAxRef","cleanTitle","titleContainer","rewireAttr","oldAttrName","newAttrName","oldAttrSet","newAttrSet","cleanFinanceDir","dirContainer","dirName","commonPrefix","name1","name2","show1","show2","cleanTextPosition","emptyContainer","outer","innerStr","clearPromiseQueue","cleanLayout","xaxis1","yaxis1","scene1","axisAttrRegex","polarAttrRegex","ternaryAttrRegex","ternary","sceneAttrRegex","overlaying","isdate","islog","categories","autotick","aaxis","baxis","caxis","cameraposition","rotation","mat","annotationsLen","shapesLen","imagesLen","cleanData","ybins","xbins","dc","yeColor","bardir","swapXYData","reversescl","getModule","containerName","highlightColor","highlightcolor","highlightWidth","highlightwidth","increasingShowlegend","increasing","decreasingShowlegend","decreasing","increasingName","decreasingName","filtersrc","styles","prevStyles","styleKeys","autobinx","autobiny","transpose","errorY","copyYstyle","hoverInfoParts","coerceTraceIndices","traceIndices","traceIndicesOut","manageArrayContainers","np","undoit","pLength","pLastIsNumber","contPath","ATTR_TAIL_RE","getParent","search","hasParent","attrParent","clearAxisTypes","axAttr","sceneName","typeAttr","main","_doPlot","newPlot","restyle","relayout","_guiRestyle","_guiRelayout","_guiUpdate","_storeDirectGUIEdit","react","extendTraces","prependTraces","addTraces","deleteTraces","moveTraces","addFrames","deleteFrames","animate","setPlotConfig","downloadImage","templateApi","makeTemplate","validateTemplate","containerArrayMatch","isAddVal","isRemoveVal","applyContainerArrayChanges","_nestedProperty","componentType","supplyComponentDefaults","replotLater","replot","recalc","fullVal","componentNum","objEdits","objKeys","objVal","adding","componentNums","componentArrayIn","componentArray","componentArrayFull","deletes","firstIndexChange","maxIndex","indicesToDraw","initInteractions","manageArrays","subroutines","editTypes","AX_NAME_PATTERN","numericNameWarningCount","emitAfterPlot","_redrawFromAutoMarginCount","setBackground","opaqueSetBackground","setPlotContext","location","plot3dPixelRatio","plotGlPixelRatio","autosizable","scrollZoom","doubleClick","showLink","_hasZeroHeight","clientHeight","_hasZeroWidth","clientWidth","szIn","szOut","_scrollZoom","positivifyIndices","parentLength","positiveIndices","assertIndexArray","arrayName","checkMoveTracesArgs","currentIndices","newIndices","spliceTraces","maxPoints","updateArray","maxPointsIsObject","assertExtendTracesArgs","updateProps","maxp","getExtendProperties","undoUpdate","undoPoints","concatTypedArray","arr0","arr1","arr2","_traces","reject","_restyle","fullReplot","markerSize","doCalcdata","addAxRangeSequence","doTraceStyle","colorbars","doColorBars","rehover","redrag","redoit","plotDone","undefinedToNull","makeNP","preGUI","guiEditFlag","storeCurrent","arrayNew","maxLen","objNew","objBoth","_guiEditing","layoutNP","_preGUI","cleanDeprecatedAttributeKeys","axlist","addToAxlist","axid","autorangeAttr","rangeAttr","getFullTrace","doextra","extraparam","_tracePreGUI","allBins","binAttr","arrayBins","vij","ai","contFull","oldVal","valObject","finalPart","prefixDot","innerContFull","getTraceValObject","impliedKey","labelsTo","valuesTo","_pielayer","orient","topOrBottom","thicknorm","lennorm","defaultOrientation","dataArrayContainers","swap","oldAxisTitleRegex","colorbarRegex","oldAttrStr","newAttrStr","_relayout","layoutReplot","axRangeSupplyDefaultsByPass","doLegend","layoutstyle","layoutStyles","axrange","rangesAltered","doTicksRelayout","doModeBar","doCamera","_matchGroup","axId2","ax2","drawAxes","axIds","skipTitle","_anchorAxis","id2","automargin","doAutoRangeAndConstraints","drawData","finalDraw","AX_RANGE_RE","AX_AUTORANGE_RE","AX_DOMAIN_RE","arrayEdits","axisAttr","newkey","recordAlteredAxis","pleafPlus","pend","pleaf","ptrunk","parentIn","parentFull","vOld","getLayoutValObject","oppositeAttr","_initialAutoSize","axFull","_inputDomain","fullProp","updateValObject","_constraintGroup","groupAxId","_constraintShrinkable","updateAutosize","oldWidth","oldHeight","autosize","plotAutoSize","traceUpdate","restyleSpecs","restyleFlags","relayoutSpecs","relayoutFlags","guiEdit","layoutUIControlPatterns","traceUIControlPatterns","findUIPattern","patternSpecs","spec","getNewRev","revAttr","newRev","getFullTraceIndexFromUid","getTraceIndexFromUid","valsMatch","v2","v1IsObj","v1IsArray","stringify","getDiffFlags","oldContainer","outerparts","getValObject","immutable","inArray","arrayIndex","arrays","nChanges","nChangesAnim","newDataRevision","valObjectCanBeDataArray","tickMode","_compareAsJSON","canBeDataArray","wasArray","nowArray","inputKey","oldValIn","newValIn","_isLinkedToArray","arrayEditIndices","extraIndices","diffConfig","oldConfig","newConfig","calcInverseTransform","newBBox","_lastBBox","frameOrGroupNameOrFrameList","animationOpts","trans","_frameQueue","supplyAnimationDefaults","frameOpts","frame","getTransitionOpts","getFrameOpts","callbackOnNthTime","cb","_frameWaitingCnt","beginAnimationLoop","_lastFrameAt","_timeToNext","_runningTransitions","_currentFrame","doFrame","_animationRaf","onComplete","newFrame","stringName","animation","cancelAnimationFrame","nextFrame","configCounter","setTransitionConfig","frameList","allFrames","isFrameArray","frameOrName","_frameHash","onInterrupt","discardExistingFrames","currentFrame","fromcurrent","filteredFrameList","computedFrame","computeFrame","queueFrames","bigIndex","insertions","_frameHashLocal","lookupName","collisionPresent","supplyFrameDefaults","ops","revops","frameCount","_counter","modifyFrames","promise","checkAddTracesArgs","startSequence","stopSequence","deletedTrace","newArray","remainder","none","both","numberOfItemsFromInsert","numberOfItemsFromTarget","targetBegin","newData","movingTraceMap","newIndex","cleanPlot","graphWasEmpty","_replotting","_shouldCreateBgLayer","gd3","_container","_glcontainer","_toppaper","_hoverpaper","otherUids","_clips","_bgLayer","_draggers","layerBelow","_cartesianlayer","_polarlayer","_ternarylayer","_geolayer","_funnelarealayer","_iciclelayer","_treemaplayer","_sunburstlayer","_indicatorlayer","_glimages","layerAbove","makePlotFramework","saveShowSpikeInitial","responsive","oldMargins","drawFrameworkCalls","marginPushers","clearAutoMarginIds","drawMarginPushers","allowAutoMargin","doAutoMargin","_transitioning","saveRangeInitial","drawFramework","basePlotModules","pick","_gl","drawingBufferWidth","drawingBufferHeight","didMarginChange","_insideTickLabelsAutorange","addLinks","oldFullData","oldFullLayout","configChanged","oldRev","preGUIVal","newNP","layoutPreGUI","bothInheritAutorange","newRangeAccepted","newAx","allTracePreGUI","tracePreGUI","newTrace","fulli","newTracei","applyUIRevisions","skipUpdateCalc","newFullData","newFullLayout","datarevision","diffLayout","sameTraceLength","diffOpts","animatable","seenUIDs","hasMakesDataTransform","diffData","allNames","getOwnPropertyNames","emptyCategories","_emptyCategories","supplyDefaultsUpdateCalc","createTransitionData","transitionFromReact","_skipDefaults","configAttributes","plotlyServerURL","annotationTail","axisTitleText","colorbarTitleText","fillFrame","frameMargins","showAxisDragHandles","showAxisRangeEntryBoxes","linkText","sendData","showSources","topojsonURL","mapboxAccessToken","globalTransforms","crawl","baseAttributes","baseLayoutAttributes","frameAttributes","animationAttributes","IS_SUBPLOT_OBJ","IS_LINKED_TO_ARRAY","DEPRECATED","UNDERSCORE_ATTRS","recurseIntoValObject","newValObject","index2","getLayoutAttributes","handleBasePlotModule","xkey","insertAttrs","formatAttributes","attrName","isValObject","makeSrcAttr","role","mergeValTypeAndRole","itemName","formatArrayContainers","walk","baseAttrs","newAttrs","allTypes","basePlotModule","modules","copyBaseAttributes","copyModuleAttributes","level","fullAttrString","getTraceAttributes","transformsRegistry","getTransformAttributes","defs","valObjects","metaKeys","specifiedLevel","attrString","findArrayAttributes","baseContainer","baseAttrName","arrayAttributes","stack","isArrayStack","crawlIntoTrace","astrPartial","newAstrPartial","tNum","subplotModule","layoutAttrOverrides","baseOverrides","baseLayoutAttrOverrides","_modules","layoutHeadAttr","plotAttributes","templateAttrs","validItemName","arrayDefaultKey","lastChar","traceTemplater","dataTemplate","traceType","typeTemplates","traceCounts","typei","baseName","arrayTemplater","inclusionAttr","defaultsTemplate","templateItems","usedNames","newItem","itemIn","templateItemName","templateItem","defaultItems","outi","_templateitemname","itemOut","lengthIn","resetUpdate","updateOut","updateToApply","clearGlCanvases","axisConstraints","enforceAxisConstraints","enforce","cleanAxisConstraints","doAutoRange","SVG_TEXT_ANCHOR_START","overlappingDomain","xDomain","yDomain","domains","existingX","existingY","lsInner","drawMainTitle","getLinePosition","counterAx","lwHalf","_lw","_linepositions","_mainLinePosition","_mainMirrorPosition","mirror","lowerBackgroundIDs","backgroundIds","lowerDomains","noNeedForBg","pgNode","plotgroupBg","xLinesXLeft","xLinesXRight","xLinesYBottom","xLinesYTop","leftYLineWidth","rightYLineWidth","yLinesYBottom","yLinesYTop","yLinesXLeft","yLinesXRight","connectYBottom","connectYTop","extraSubplot","lowerBackgrounds","_hasOnlyLargeSploms","plotClipId","plotClip","clipRect","xLinePath","xLinePathFree","yLinePath","yLinePathFree","mainPath","pathFn","pathFnFree","_mainSubplot","xPath","shouldShowLinesOrTicks","findCounterAxisLineWidth","xlines","yPath","ylines","makeClipPaths","shouldShowLineThisSide","anchorAx","sideIndex","axi","_mainAxis","getMainTitleX","hPadShift","getMainTitleY","vPadShift","getMainTitleTextAnchor","getMainTitleDy","editStyleCalls","arraysToCalcdata","editStyle","redrawReglTraces","splom","updateGrid","updateFx","setViewport","sp","cartesianIds","polarIds","_splomGrid","autoRangeDone","matchGroup","mergeTemplates","oldTemplate","newTemplate","oldKeys","mergeOne","templater","oldItem","templateitemname","getBaseKey","key2","baseKey2","walkStyleKeys","templateOut","getAttributeInfo","basePath","pathAttr","child","nextPath","getNextPath","nextBasePath","baseKey","_noTemplating","dfltDone","namedIndex","dfltPath","pathInArray","itemPropInArray","getLayoutInfo","getTraceInfo","hasPlainObject","templateCount","figure","traceTemplate","oldTypeTemplates","oldTypeLen","typeLen","oldLayoutTemplate","oldDataTemplate","figureIn","layoutTemplate","errorList","layoutPaths","crawlLayoutForContainers","paths","nextPaths","crawlLayoutTemplateForContainers","typeCount","crawlForMissingTemplates","toSVG","svgToImg","imageDataOnly","isImpliedOrValid","clonedGd","layoutImage","configImage","redrawFunc","getRedrawFunc","wait","getDelay","cleanup","json","encodeJSON","encodeSVG","url","IMAGE_URL_PREFIX","urlToImageData","objIn","valOut","nestedSchema","getNestedSchema","nestedValType","isInfoArray","isColorscale","isInSchema","valInPart","valOutPart","_p","_nestedSchema","indexList","valInj","valOutj","fillLayoutSchema","dataOut","layoutSchema","traceSchema","traceLayoutAttr","dataIn","transformsIn","transformsOut","transformType","transformSchema","code2msgFunc","inBase","unused","dynamic","invisible","convertPathToAttributeString","splitKey","keyMinusId","idMatch","ordering","parentObjIn","parentObjOut","previousContOut","fxAttrs","customdata","stream","token","maxpoints","alignment","mPeriod","period","isStart","isEnd","period0","nEstimated","startTime","endTime","isLinked","newRange","getPadMin","makePadFn","getPadMax","concatExtremes","minArray","maxArray","minmin","maxmax","axReverse","minpt","maxpt","minbest","maxbest","rangeMode","toZero","nonNegative","axLen","minSpan","mbest","calcBreaksLength","nopad","maxPad","prev","rangeEnd","rangebreaksOut","extrappad","anchorAxis","zero","isX","_vals","_tickAngles","cosA","sinA","_selections","padInsideLabelsOnAnchorAxis","extrapad","noMatch","_concat","collapseMinArray","collapseMaxArray","_traceIndices","extremes2","lenRatio","newPad","collapseArray","atLeastAsExtreme","includeThis","clipAtZero","goodNumber","presetRange","_r","_attr","axeRangeOpts","_m","dmin","dmax","ppadiplus","ppadiminus","isLog","hasArrayOption","vpadLinearized","makePadAccessor","vpadplus","vpad","vpadminus","collapseOpts","addItem","iMax","axAttrs","cleanTicks","HALFDAY","ZERO_PATH","K","GRID_PATH","TICK_PATH","TICK_TEXT","autoType","idSort","listIds","expandRange","extraOption","refAttr","attrDef","ar","cleanPos","fraction2r","redrawComponents","_redrawOneComp","moduleName","methodName","stashName","shortCircuit","getDataConversions","targetArray","d2cTarget","autotypenumbers","_categories","toNum","nMonths","getDataToCoordFunc","counterLetter","minDtick","newDiff","newFirst","allow","_minDtick","_forceTick0","overwrite","hasOneAxisChanged","isNew","hasChanged","_showspikes","autoBin","nbins","is2d","dummyAx","_dataSpan","c2r","size0","distinctData","msexp","minSize","autoTicks","binEnd","finalSize","binStart","tickIncrement","tickFirst","edgecount","midcount","intcount","nearEdge","binshift","autoShiftNumericBins","stats","numMonths","nextBinStart","autoShiftMonthBins","prepTicks","_dtickInit","_tick0Init","minPx","nt","_roughDTick","ticklabelmode","definedDelta","mDate","isMDate","getTickFormat","noDtick","_dowTick0","_rawTick0","_definedDelta","adjustPeriodDelta","autoTickRound","ticksOut","exRng","tickMin","tickMax","tickVal2l","d2l_noadd","d2l","vali","tickTextObj","maskBreaks","arrayTicks","startTick","endTick","axrev","minRange","maxRange","isDLog","isPeriod","_tmin","moveOutsideBreak","maxTicks","tickVals","xPrevious","minor","inBetween","A","actualDelta","periodLength","endPeriod","drop","periodX","positionPeriodTicks","flip","prevL","isAngular","_tmax","_prevDateHead","_inCalcTicks","_minor","_value","roundBase10","roundBase24","roundBase60","roundDays","roundLog1","roundLog2","roundAngles","roundDTick","roughDTick","roundingSet","_tickexponent","_tickround","tick0ms","tick0str","tick0len","tick1len","maxend","rangeexp","isSIFormat","beyondSI","getBase","roughX2","_hasDayOfWeekBreaks","olddtick","tType","dtSigned","tickset","sRound","tmin","dtNum","t1","mult","newDTick","noSuffixPrefix","arrayMode","extraPrecision","axType","_lBreaks","showAttr","firstOrLast","hideexp","hoverformat","headStr","_dateFormat","_extraFormat","splitIndex","isInside","insideTicklabelposition","_realSide","dtChar0","numFormat","absP","exponentFormat","firstChar","formatLog","tt","formatCategory","cats","tt2","text2","formatMultiCategory","thetaunit","num","precision","findPrecision","gcd","findGCD","num2frac","isNeg","formatAngle","formatLinear","tickson","showdividers","inbounds","xbnd","val2","logOffScale","SIPREFIXES","exponent","fmtoverride","tickRound","ah","_numFormat","signedExponent","_separators","getSecondaryLabelVals","lookup","getPosX","tickDataFn","axInfo","approxTitleDepth","extraLines","selectTickLabel","gTick","mj","axAutoMarginID","axMirrorAutoMarginID","rangeSliderAutoMarginID","mergeAxisGroups","intoSet","fromSet","swapAxisGroup","xIds","xFullAxes","yFullAxes","allAxKeys","noSwapAttrs","numericTypes","keyi","allEqual","coerceLinearX","coerceLinearY","xVali","yVali","swapAxisAttrs","dfltTitle","_rangebreaks","hideCounterAxisInsideTickLabels","_hideCounterAxisInsideTickLabels","tickstop","stopi","convertFn","leftDtick","rightDtick","convertToMs","compareLogTicks","priority","leftPriority","rightPriority","isProperLogStop","isLeftDtickNull","isRightDtickNull","isDtickInRangeLeft","isDtickInRangeRight","enabled","dtickrange","getSubplots","gl2d","findSubplotsWithAxis","aParts","bParts","axMatch","subplotsWithAx","xaList","yaList","clipList","axClips","xaxislayer","yaxislayer","gridlayer","zerolinelayer","axDone","mainPlotinfo","mainAxLayer","mainLinePosition","mainMirrorPosition","_prevTickAngles","llbboxes","valsClipped","transTickFn","transTickLabelFn","insideTicks","outsideTicks","boundaryVals","_push","bndIndex","xb","getBoundaryVals","gridVals","_gridVals","dividerVals","getDividerVals","finishedGrids","counterAxis","mainCounterID","gridPath","drawGrid","drawZeroLine","tickSigns","tickSubplots","mirrorTickPath","fullTickPath","tickPath","mainTickPath","dividerLookup","linepositions","spTickPath","bboxKey","getLabelLevelBbox","repositionOnUpdate","secondary","dividers","dividercolor","dividerwidth","drawDividers","hasRangeSlider","llbbox","mirrorPush","rangeSliderPush","sMirror","outsideTickLen","domainIndices","rExtra","lExtra","bExtra","tExtra","titleStandoff","offsetBase","tickLabels","translation","calcLabelLevelBbox","sideOpposite","uv","isTop","isRight","isBottom","isAligned","getTickLabelUV","insideTickLabels","labelsOverTicks","labelStandoff","labelShift","tickLen","ff","flipIt","endSide","xQ","xFn","yFn","anchorFn","heightFn","ang","rA","showgrid","shouldShowZeroLine","isArrayMode","xi","_gw","gridwidth","gridcolor","show","zl","da","db","zerolinecolor","zerolinewidth","tickAngle","prevAngle","labelsReady","positionLabels","nLines","anchorHeight","_adjustTickLabelsOverflow","mjShift","newPromise","hideOverflow","rl","visibleLabelMin","visibleLabelMax","adjust","partialOpts","anchoredAxes","isPeriodLabel","autoangle","all","maxFontSize","lbbArray","vLen","tickSpacing","rotate90","gap","lbb","zeroline","mainCounterAxis","zeroPosition","lineNearZero","counterLetterAxes","counterAxis2","closeEnough","pos2","linePositions","anyCounterAxLineAtZero","hasBarsOrFill","axGroups","groupsi","yi","groupj","group0","makeAxisGroups","hasTypeNumber","convertNumeric","getIncrement","noMultiCategory","multiCategory","dats","nums","stri","moreDates","category","linearOK","handleCategoryOrderDefaults","handleLineGridDefaults","DAY_OF_WEEK","HOUR","rangebreaksDefaults","bnds","dfltPattern","indexOfDay","splomStash","visibleDflt","axTemplate","handleCalendarDefaults","noTicklabelposition","noTicklabeloverflow","autorangeDflt","reverseDflt","dfltColor","dfltFontColor","showGrid","ticksonDflt","isMultiCategory","dayStrToNum","sun","mon","tue","wed","thu","fri","sat","docs","descriptionOnlyNumbers","descriptionWithDates","axisHoverFormat","noDates","isFound","AX_ID_PATTERN","axNum","domainId","domainTest","only2d","idList","sceneIds3D","subplotLists","id1","letter1","letter2","_axisMatchGroups","_axisConstraintGroups","orderDefault","categoryarray","isValidArray","categoryorder","_initialCategories","axData","findCategories","isDate","isCat","dtickDflt","dtickNum","xAxisMatch","yAxisMatch","SUBPLOT_PATTERN","HOUR_PATTERN","WEEKDAY_PATTERN","MINSELECT","MINZOOM","DRAGGERSIZE","BENDPX","REDRAWDELAY","SELECTDELAY","SELECTID","DFLTRANGEX","DFLTRANGEY","traceLayerClasses","clipOnAxisFalseQuery","layerValue2layerClass","scaleZoom","handleOneAxDefaults","hasImage","constraintGroups","matchGroups","thisID","constraintoward","thisType","linkableAxes","thisGroup","getConstraintGroup","linkableAxesNoLoops","matches","scaleanchor","canLink","scaleanchorDflt","updateConstraintGroups","matchedAx","matchRatio","scaleratio","thatID","groupi","keyj","thisGroupIndex","thisGroupKeys","baseScale","multiplyScales","aLen","bLen","aPrefix","bPrefix","finalRatios","yRatio","updateDomain","factor","inputDomain","centerFraction","axHasImage","stashAttr","axName2","matchAttrs","hasRange","hasDayOfWeekBreaks","setAttrVal","baseAx","axisID","normScale","minScale","maxScale","matchScale","normScales","hasAnyDomainConstraint","_inputRange","domainShrunk","rangeShrunk","rangeCenter","rangeMin","rangeMax","halfRange","outerMin","outerMax","getAxisGroup","isConstrained","prepSelect","selectOnClick","SHOWZOOMOUTTIP","makeDragger","dragClass","dragger3","draglayer","makeRectDragger","dragger","isDirectionActive","activeVal","zoomAxRanges","r0Fraction","r1Fraction","updates","linkedAxes","isY","r0F","r1F","p2l","axRangeLinear0","axRangeLinearSpan","linkedR0Fraction","dragAxList","pix","dZoom","makeZoombox","zoomlayer","lum","path0","makeCorners","updateZoombox","zb","corners","dimmed","transitionZoombox","removeZoombox","showDoubleClickNotifier","xyCorners","clen","calcLinks","xaHash","yaHash","exclude","xID","yID","xLinkID","yLinkID","isSubplotConstrained","xLinks","yLinks","xExclude","yExclude","xaHashLinked","xaxesLinked","yaHashLinked","yaxesLinked","attachWheelEventHandler","wheelEventName","onwheel","_onwheel","onmousewheel","isAddedWheelEvent","hashValues","makeDragBox","ns","ew","xa0","ya0","pw","ph","links","xActive","yActive","allFixedRanges","editX","editY","hasScatterGl","hasSplom","hasSVG","isMainDrag","singleEnd","recomputeAxisLists","spConstrained","nsew","getDragCursor","zoomMode","zoomDragged","clearAndResetSelect","attrStr","dig","initialVal","getEndText","hAlign","vAlign","zoomMove","dx0","dy0","_transitioningWithDuration","noZoom","xCorners","yCorners","computeZoomUpdates","updateMatchedAxRange","zoomDone","dragTail","dragModePrev","dragModeNow","_hmpixcount","_hmlumcount","getLuminance","zoomPrep","plotDrag","_redrag","dragDataNow","updateSubplots","scrollViewBox","redrawTimer","spDx","spDy","ticksAndAnnotations","xStart","yStart","dxySign","dxyFraction","dz","xSize","ySize","movedAx","newLinearizedEnd","otherEnd","newEnd","matchedAxes","constrainedAxes","activeAxIds","pushActiveAxIds","doubleClickConfig","viewBox","plotinfos","xrng","yrng","xScaleFactor","yScaleFactor","xScaleFactor2","yScaleFactor2","clipDx","clipDy","editX2","editY2","getShift","scaleAndGetShift","getLinkedScaleFactor","plotDx","plotDy","zoomScalePts","zoomScaleTxt","clipOnAxisFalseTraces","scaleFactor","from","_enablescrollzoom","wheelDelta","exp","gbb","xfrac","yfrac","zoomWheelOneAxis","axRange","maindrag","_rehover","_hoversubplot","_lasthover","onmouseout","axValue","getTransform","containerArrayName","cartesianList","hasCartesianOrGL2D","itemi","hasXref","hasYref","newAxis","getModuleCalcData","ensureSingleAndAddDatum","plotOne","cdSubplot","makeOnCompleteCallback","cdModuleAndOthers","layerData","zoomScaleQueryParts","layerName","plotMethod","zoomScale","makeSubplotLayer","xLayer","yLayer","hasOnlyLargeSploms","mainplotgroup","overlinesBelow","overaxesBelow","overplot","overlinesAbove","overaxesAbove","backLayer","purgeSubplotLayers","overlayIdsToRemove","removeSubplotExtras","overlayInfo","idRoot","transitionAxes","finalizeSubplots","xList","yList","spSVG","spAll","allX","allY","ki","pcd","subplotInfo","carpet","oldPlots","newPlots","oldSubplotList","hadGl","hasGl","oldAxIDs","oldAxId","hadCartesian","oldSubplotId","subplotData","regulars","xa2","ya2","makeSubplotData","subplotLayers","imageRoot","root","imageData","dvalue","handleTypeDefaults","constraints","handlePositionDefaults","appendList","autotypenumbersDflt","ax2traces","xaMayHide","yaMayHide","xaMustDisplay","yaMustDisplay","yaMustNotReverse","yaMayReverse","noGrids","xaName","yaName","_cheater","xNames","axNames","plotBgColor","axLayoutIn","axLayoutOut","newAxLayoutOut","_counterAxes","getCounterAxes","getOverlayableAxes","allAxisIds","missingMatchedAxisIdsLookup","missingMatchedAxisIds","addMissingMatchedAxis","matchesIn","unifiedHover","defaultOptions","unifiedSpike","overlayableAxes","defaultOptions2","rangeSliderDefaults","rangeSelectorDefaults","anchoredAxis","colorMix","gridColor","blend","gridWidth","noZeroLine","zeroLineColor","zeroLineWidth","dfltAnchor","dfltDomain","dfltPosition","rangeLinear","polybool","filteredPolygon","polygonTester","polygonOutlines","searchTraces","searchInfo","currentSelectionDef","selectionTester","thisTracesSelection","pointOrBinSelected","subtract","sendEvents","hoverOnBox","isHoverDataSet","coerceSelectionsCache","clickedPtInfo","hoverDatum","binNumber","extractClickedPtInfo","determineSearchTraces","tracesWithSelectedPts","isOnlyThisBinSelected","isOnlyOnePointSelected","isPointOrBinSelected","updateSelectedState","clearSelectionsCache","newPointSelectionDef","multiTester","selectionDefs","fillSelectionItem","mergedPolygons","convertPoly","isPointSelectionDef","newPointNumTester","pointSelectionDef","idxWantedTrace","testers","contained","selectingOnSameSubplot","_lastSelectedSubplot","hasModifierKey","xAxisIds","yAxisIds","_xaxes","_yaxes","createSearchInfo","sankeyInfo","ptNum","ptNums","ptNumToTest","fullInputTrace","hasRegl","styleOnSelect","node3","nodeRangePlot3","isFreeMode","isRectMode","isDrawMode","isSelectMode","isLineOrEllipse","filterPoly","currentPolygon","allAxes","fillRangeItems","throttleID","ascending","poly","ranges","dataPts","lassoPoints","difference","regions","inverted","union","mergePolygons","thisSelection","traceSelection","traceSelections","doneFnCompleted","isValidCategory","clip","dt2ms","msUTC","ms2dt","getCategoryName","setCategoryIndex","curLength","getCategoryIndex","getCategoryPosition","getRangePosition","_l2p","_p2l","px","_b","signAx","b2","_m2","l2c","l2d","r2c_just_indices","setupMultiCategory","ind0","ind1","linCenter","usePrivateRange","sign","vb","vDate","rangebreaksIn","_cachedPatterns","_cachedValues","getUTCDay","addBreak","isNewBreak","brkj","bndDelta","t0Date","makeCalcdata","cal","setMultiCategoryIndex","categoriesMap","sortByInitialCategories","affectedTraces","getShowAttrDflt","showAttrs","tickformatstopDefaults","showAttrDflt","tickSuffixDflt","handlePrefixSuffix","contColor","tickFormat","handleOtherDefaults","readInput","_tick0","_dtick","_tickvals","t2","raf","easeFn","_interruptCallbacks","xr0","yr0","unsetSubplotTransform","transitionInterrupt","tInterp","progress","updateSubplot","xr1","yr1","transitionComplete","xlen","ylen","dx1","dy1","fracDx","fracDy","getBoxPosLetter","isBoxWithoutPositionCoords","isBox","isCandlestick","getFirstNonEmptyTrace","calAttr","_hasPreCompStats","boxPositions","dim","_axesDim","setAutoType","bindingValueHasChanged","binding","computeLayoutBindings","bindings","computeDataBindings","thisTraces","nAttr","thisPath","commandList","onchange","lookupTable","hasSimpleAPICommandBindings","check","checkEvents","bindingsByValue","refBinding","command","computeAPICommandBindings","_method","apiMethodRegistry","allArgs","computeAnimateBindings","namePart","contPart","descPart","dfltDomains","dfltX","dfltY","baseframe","subplotCalcData","arg1","moduleCalcData","remainingCalcData","xformMatrix","model","drawNewShapeAttrs","globalFont","computed","hidesources","colorway","editrevision","selectionrevision","timeFormatLocale","frameAttrs","commandModule","redrawText","resolveLastResize","_redrawTimer","_resolveResize","oldchanged","linkContainer","getComputedTextLength","toolspan","spacespan","sourcespan","link","pathname","query","positionPlayWithData","PLOTLYENV","BASE_URL","hiddenformDiv","hiddenform","action","submit","d3FormatKeys","extraFormatKeys","getFormatObj","formatKeys","formatDone","formatObj","includeFormat","newFormat","formatFinished","formatKey","formatj","en","findMainSubplot","mockGd","mainSubplotID","nextBestMainSubplotID","anchorID","counterIDs","counterPart","ti","makesData","applyTransforms","transformIndex","getComputedSize","initMargins","_pushmargin","_pushmarginIds","newLayout","oldCalcdata","_traceWord","_mapboxAccessToken","_initialAutoSizeIsDone","sanitizeMargins","missingWidthOrHeight","getFormatter","_visibleModules","collectableSubplotTypes","subplotAttr","emptySubplotLists","splomAxes","splomSubplots","_splomSubplots","_scatterStackOpts","_firstScatter","_alignmentOpts","_traceUids","prevFullInput","oldFullInput","thisFullInput","oldLen","seenUids","setUid","tryUid","newUid","getTraceUids","_globalTransforms","supplyDataDefaults","splomXa","splomYa","_hasPlotType","supplyLayoutModuleDefaults","crossTraceDefaultsFuncs","funci","linkSubplots","hadGL2D","hadBgLayer","hasBgLayer","meta4data","fillMetaTextHelpers","uids","oldTrace","_hasCalcTransform","oldArrayVal","hasInfoLayer","oldLoop","oldUid","oldSubplots","newSubplots","newSubplotList","oldSubplot","cliponaxis","mainAx","clearExpandedTraceDefaultColors","_colorAttrs","visibleModules","colorCnt","pushModule","_transformModules","carpetIndex","carpetDependents","supplyTraceDefaults","sdInvisible","expandedTraces","expandedTrace","fullExpandedTrace","_expandedInput","carpetAxis","_carpet","optsOut","supplyAnimationFrameDefaults","supplyAnimationTransitionDefaults","frameIn","frameOut","colorIndex","traceInIndex","subplotAttrs","attri","supplyTransformDefaults","transformModules","transformList","transformOut","transformIn","isFirstStage","doLaterStages","_dataTemplate","newWidth","newHeight","innerHeight","computedStyle","maxWidth","maxHeight","widthHasChanged","heightHasChanged","transitionData","component","fid","undoqueue","undonum","_snapshotInProgress","styleModules","correction","plotWidth","plotHeight","minFinalWidth","minFinalHeight","maxSpaceW","maxSpaceH","pushMargin","pushMarginIds","rW","rH","ml","mr","mt","mb","k1","pushleft","pushbottom","fl","pl","fb","pb","fr","pr","newL","newR","ft","newB","newT","maxNumberOfRedraws","hideFn","refineTicks","marginKeys","_transition","aborted","executeCallbacks","prepareFn","numCallbacks","numCompleted","makeCallback","flushCallbacks","runFn","transitionStarting","margin0","margin1","m0","m1","dataonly","output","useDefaults","includeConfig","stripObj","keepFunction","fit","operations","oldName","frameName","destIndex","frameLookup","framePtr","frameStack","frameNameStack","extendLayout","extendTrace","recomputeFrameHash","extendObjectWithContainers","containerPaths","containerProp","containerVal","destProp","srcContainer","destContainer","expandedObj","containerObj","srcObj","destTrace","srcTrace","destLayout","srcLayout","transitionedTraces","axEdits","dataLength","traceIdx","axisAttrRe","traceTransitionOpts","hasAxisTransition","axisTransitionOpts","allTraceIndices","transitionTraces","_numBoxes","_numViolins","_violinScaleGroupStats","_piecolormap","_sunburstcolormap","_treemapcolormap","_iciclecolormap","_funnelareacolormap","angularaxis","cauto","hasCalcTransform","transformCalci","cdi","dirty","calcTransform","calci","isContainer","setupAxisCategories","doCrossTraceCalc","sorted","zMapCategory","counterAxLetter","xCategorical","yCategorical","aggFn","sortAxisCategoriesByValueRegex","aggregator","categoriesValue","_xautoBinFinished","_yautoBinFinished","isSplom","isScattergl","catIndex","currentDimensionIndex","associatedXAxisID","_diag","dimension","mapping","_categoriesValue","categoriesAggregatedValue","_categoriesAggregatedValue","sortAxisCategoriesByValue","axLookup","setupOne","crossTraceCalc","spType","methods","spInfo","generalUpdatePerTraceModule","subplotLayout","traceHashOld","traceHash","calcTraces","moduleNameOld","fakeCalcTrace","plotBasePlot","cdmodule","cleanBasePlot","had","handleDomainDefaults","subplotLayoutIn","subplotLayoutOut","subplotAttributes","partition","idsLength","baseId","templateFormatStringDescription","supportOther","describeVariables","quotedKeys","Ternary","getSubplotCalcData","TERNARY","ternaryIds","ternaryId","ternaryCalcData","oldTernaryKeys","oldTernaryKey","oldTernary","plotContainer","clipDef","clipDefRelative","ternaryAxesAttrs","sum","handleSubplotDefaults","axesNames","handleTernaryDefaults","ternaryLayoutIn","ternaryLayoutOut","letterUpper","_hovertitle","makeFramework","aTickLayout","bTickLayout","cTickLayout","layoutId","ternaryLayout","updateLayers","adjustLayout","plotbg","clipIdRelative","backplot","grids","plotLayers","toplevel","whRatio","xDomainFinal","yDomainFinal","xDomainCenter","yDomainCenter","wmax","hmax","amin","bmin","yDomain0","triangleClip","triangleClipRelative","plotTransform","bTransform","bgrid","aTransform","agrid","cTransform","cgrid","aline","bline","cline","frontplot","doTitles","titlesuffix","drawAx","apad","bpad","axLayout","stashKey","newTickLayout","caRad","CLEN","BLPATH","BRPATH","TOPPATH","mins0","span0","mins","makeUpdate","_mins","clickZoomPan","clickMode","getAFrac","getBFrac","getCFrac","afrac","bfrac","cfrac","xCenter","xSpan","dxScaled","dyScaled","minsorted","minindices","plotTransform2","dragDone","inverse","ExtendModule","basePlotAttributes","registerTraceModule","categoriesIn","plotType","componentName","findArrayRegexps","mergeComponentAttrsToSubplot","registerSubplot","categoryObj","allCategories","mergeComponentAttrsToTrace","traceLayoutAttributes","bpmName","styleRules","PlotlyGeoAssets","topojson","registerComponentModule","subplotName","mergeComponentAttrsToTransform","registerTransformModule","registerLocale","newDict","hasDict","hasFormat","localeObj","baseLocaleObj","arrayAttrRegexps","componentSchema","traceAttrs","transformAttrs","componentLayoutAttrs","getTraceType","newModule","cloneLayoutOverride","tileClass","override","graphObj","oldData","oldLayout","axesImageOverride","showaxeslabels","linetickenable","plotTile","td","defaultLayout","fileSaver","MSG_IE_BAD_FORMAT","saveLink","canUseSaveLink","blob","objectUrl","octetStream","encodeURIComponent","createBlob","createObjectURL","download","revokeObjectURL","DOM_URL","URL","webkitURL","Blob","binary","buf","Uint8Array","fixBinary","atob","emitter","ieSvgError","svgBlob","w1","ctx","imgData","errorMsg","clonePlot","DOUBLEQUOTE_REGEX","DUMMY_SUB","DUMMY_REGEX","toppaper","nodes","topGroups","topGroup","queryParts","setAttributeNS","XMLSerializer","serializeToString","hiddenDiv","replaced","htmlEntityDecode","scatterAttrs","hovertemplateAttrs","texttemplateAttrs","textFontAttrs","xperiod","yperiod","xperiod0","yperiod0","xperiodalignment","yperiodalignment","eventDataKeys","insidetextanchor","insidetextfont","outsidetextfont","constraintext","offsetgroup","alignmentgroup","alignPeriod","colorscaleCalc","calcSelection","origPos","hasPeriod","sizeOpts","serieslen","orig_p","TEXTPAD","Sieve","setGroupPositions","pa","sa","excluded","included","scalendar","hasB","hasBase","initBase","setGroupPositionsInOverlayMode","sieve","posAxis","sepNegVal","overlapNoMerge","norm","positions","distinctPositions","overlap","barGroupWidth","groupId","alignmentGroups","barWidthPlusGap","offsetFromCenter","alignmentGroupOpts","nOffsetGroups","offsetGroups","groupgap","_offsetIndex","barwidth","poffset","bargroupwidth","bardelta","binWidth","setBarCenterAndWidth","updatePositionAxis","setOffsetAndWidthInGroupMode","inTraceSieve","put","unhideBarsWithinTrace","sieveBars","normalizeBars","setBaseAndTop","setGroupPositionsInGroupMode","setOffsetAndWidth","isFunnel","sLetter","getAxisLetter","stackBars","_outmost","setGroupPositionsInStackOrRelativeMode","pLetter","extents","roundFactor","poffsetIsArray","pVal","collectExtents","newPoffset","calcTrace0","initialPoffset","initialBarwidth","newBarwidth","barwidthIsArray","calcBar","allowMinDtick","calcBarOffset","calcBarWidth","sTop","sTiny","sMin","sMax","needsPadding","fullTraces","calcTracesHorz","calcTracesVert","_computePh","ph0","ph1","xCat","yCat","barnorm","bargap","bargroupgap","handleXYDefaults","handlePeriodDefaults","handleStyleDefaults","handleGroupingDefaults","posAxId","alignmentOpts","alignmentIndex","offsetGroupOpts","offsetIndex","handleText","moduleHasSelected","moduleHasUnselected","moduleHasConstrain","moduleHasCliponaxis","moduleHasTextangle","moduleHasInsideanchor","hasPathbar","hasBoth","hasInside","hasOutside","dfltFont","insideTextFontDefault","isColorInheritedFromLayoutFont","pathbarTextFontDefault","errorBarsSupplyDefaults","coerceString","attributeDefinition","defaultValue","coerceColor","coerceEnumerated","getValue","arrayOrScalar","getLineWidth","hoverOnBars","posVal","sizeVal","sizeLetter","pRangeCalc","isClosest","sizeFn","positionFn","thisBarMinPos","thisBarExtPos","thisBarMaxPos","minPos","maxPos","_minPos","_maxPos","maxDistance","rawS","labelLabel","valueLabel","baseLabel","thisBarSizeFn","thisBarPositionFn","getTraceColor","barPointData","hasBars","shouldBeGapless","gappedAnyway","usedSubplots","uniformText","recordMinTextSize","clearMinTextSize","attributeText","attributeTextPosition","getKeyFunc","dirSign","hasTransition","getRotateFromAngle","getRotatedTextSize","textBB","absSin","absCos","toMoveInsideBar","constrained","toRight","leftToRight","toLeft","textpad","bartraces","plotGroup","shouldDisplayZeros","adjustPixel","connector","withTransition","pointGroup","bars","sAxis","pAxis","getXY","roundWithLine","fixpx","hideZeroSpan","styleFns","appendTextNode","vLetter","vAxis","formatNumber","deltaLabel","final","finalLabel","initial","initialLabel","percentInitial","begR","percentInitialLabel","percentPrevious","difR","percentPreviousLabel","percentTotal","sumR","percenTotalLabel","calcTexttemplate","textinfo","hasFlag","flag","nPercent","hasMultiplePercents","calcTextinfo","getText","getTextPosition","inStackOrRelativeMode","isOutmostBar","layoutFont","getBarColor","insideTextFont","getInsideTextFont","outsideTextFont","getOutsideTextFont","textSelection","barHeight","currentTransform","toMoveOutsideBar","appendBarText","hasClipOnAxisFalse","getCentroid","ct","getLabel","oldValue","resizeText","attributeTextFont","attributeInsideTextFont","attributeOutsideTextFont","stylePoints","styleTextPoints","determineFont","getTextFont","getFontValue","defaultFont","attributeValue","familyValue","sizeValue","colorValue","barcount","txs","selectedFontColor","styleTextInSelectionMode","stylePointsInSelectionMode","colorscaleDefaults","getMinKey","minKey","hide","gTrace","shouldHide","barAttrs","scatterMarkerAttrs","scatterMarkerLineAttrs","q1","q3","lowerfence","upperfence","notched","notchwidth","notchspan","jitter","pointpos","boxmean","sd","quartilemethod","whiskerwidth","hoveron","valAxis","valLetter","numKey","boxVals","allPosArrays","pos0","hasPos0","pos0c","getPosArrays","posArray","posDistinct","ptFilterFn","lf","uf","valArrayRaw","med","sortByVal","extractVal","computeLowerFence","computeUpperFence","lo","computeLowerOutlierBound","uo","computeUpperOutlierBound","computeNotchSpan","ln","un","imin","pts2","valArray","posBins","makeBins","ptsPerBin","initNestedArray","minLowerNotch","maxUpperNotch","usesExclusive","usesInclusive","mci","TRACE_TO_CALC","orientations","setPositionOffset","boxList","pointList","shownPts","boxdv","dPos0","numTotal","groupFraction","groupGapFraction","bdPos","bPos","wHover","pushplus","pushminus","edgeplus","edgeminus","edge","pp","pm","handleSampleDefaults","getDims","valid","sLen","yDims","xDims","yLen","xLen","setInX","hasCategories","handlePointsDefaults","outlierColorDflt","lineoutliercolor","modeDflt","hasPreCompStats","boxmeanDflt","notchedDflt","hoverOnBoxes","vVal","hoverPseudoDistance","spikePseudoDistance","boxDeltaPos","boxDeltaNeg","dVal","isViolin","closeBoxData","boxDelta","posAcceptance","shiftPos","pseudoDistance","spikePosAttr","usedVals","meanline","valPx","pointData2","hoverOnPoints","closePtData","xPx","yPx","ijClosest","xc","yc","boxgap","boxgroupgap","_supply","hasTraceType","plotBoxAndWhiskers","bdPos0","bdPos1","posHasRangeBreaks","wdPos","bPosPxOffset","whiskerWidth","lcenter","pos1","posc","posw0","posw1","posm0","posm1","useExtremes","plotPoints","gPoints","newJitter","typicalSpread","minSpread","spreadLimit","jitterFactors","maxJitterFactor","i1","jitterFactor","jitterOffset","plotBoxMean","sl","sh","cdbox","boxLayer","styleBox","boxSel","allBoxes","boxData","thisBox","heatmapAttrs","axisFormat","filterOps","xtype","ytype","zhoverformat","hoverongaps","connectgaps","autocontour","ncontours","showlabels","labelfont","labelformat","operation","smoothing","heatmapCalc","setContours","endPlus","zOut","cVals","cs","nc","min0","pathinfo","pi0","edgeVal2","prefixBoundary","edgepaths","starts","na","nb","boundaryMax","boundaryMin","contoursValue","makeColorMap","colorMap","isColorbar","BOTTOMSTART","TOPSTART","LEFTSTART","RIGHTSTART","NEWDELTA","CHOOSESADDLE","SADDLEREMAINDER","LABELDISTANCE","LABELINCREASE","LABELMIN","LABELMAX","LABELOPTIMIZER","EDGECOST","ANGLECOST","NEIGHBORCOST","SAMELEVELFACTOR","SAMELEVELDISTANCE","MAXCOST","INITIALSEARCHPOINTS","ITERATIONS","handleLabelDefaults","showLines","zvalue","handleConstraintValueDefaults","coerceValue","coercedValue","hasArrayValue","makeRangeSettings","makeInequalitySettings","contourStart","contourEnd","missingEnd","contourSize","copyPathinfo","pi1","op0","op1","handleXYZDefaults","handleConstraintDefaults","handleContoursDefaults","isConstraint","constraintMapping","contoursFinal","_carpetTrace","basePathinfo","ci","equalPts","pt1","pt2","xtol","ytol","makePath","loc","edgeflag","locStr","mi","marchStep","getStartStep","getInterpPx","startLoc","startStep","atEdge","distgroup","cnt2","cnt3","newpt","ptcnt","ptavg","thisdist","edgepathi","edgepathj","closedpath","totaldist","distThresholdFactor","alldists","cropstart","distThreshold","getpt","merged","doublemerged","locx","locy","zxy","heatmapHoverPoints","isContour","zmin0","zmax0","zRange","zmin","zmax","getMarchingIndex","startIndices","ystartIndices","twoWide","heatmapPlot","makeCrossings","findAllPaths","emptyPathinfo","convertToConstraints","closeBoundaries","costConstants","joinAllPaths","perimeter","endpt","newendpt","nexti","possiblei","addpath","fullpath","startsleft","newloop","isbottom","isleft","isright","ptNew","locationCost","textOpts","labelData","normX","normY","cost","labeli","dxd","dyd","sameLevel","distOffset","makeClipMask","emptyPoint","empties","_emptypoints","zmask","cdcontours","contourLayer","heatmapColoringLayer","cdheatmaps","leftedge","rightedge","bottomedge","topedge","fillPathinfo","bgfill","makeBackground","hasFills","boundaryPath","fillitems","makeFills","lineContainer","showLabels","clipLinesForLabels","linegroup","createLines","lineClip","createLineClip","labelGroup","labelClipPathData","contourFormat","labelFormatter","dummyText","xRng","yRng","plotDiagonal","normLength","calcTextOpts","pathBounds","maxLabels","findBestTextLocation","addLabelData","makeLinesAndLabels","clips","clipPathInfo","clipGaps","makeLines","opencontourlines","pedgepaths","closedcontourlines","ppaths","formatAxis","plotBounds","newLocation","newCost","rotateXY","bBoxPts","autoContours","zauto","sizeOut","inputContours","heatmapStyle","isConstraintType","colorLines","colorFills","labelFont","firstFill","zsmooth","histogram2dCalc","convertColumnData","clean2dArray","interp2d","findEmpties","makeBoundArray","skipBreaks","origX","origY","binned","isHist","isGL2D","orig_x","orig_y","zIn","_z","noZsmooth","newZ","dropZonBreaks","avgdx","maxErrX","avgdy","maxErrY","xIn","xArray","yIn","yArray","_hovertext","yCenter","xRanges","yRanges","dummyTrace","xfill","yfill","zOld","rowlen","collen","getCollen","old2new","cleanZvalue","padOld2new","axisMapping","axMapping","traceCategories","xMap","yMap","zNew","ax1","var1Name","var2Name","arrayVarNames","colLen","col1","col2","textCol","hasColumnText","hoverTextCol","hasColumnHoverText","col1dv","col1vals","col2dv","col2vals","newArrays","after2before","arrayVar","_after2before","prevRow","thisPt","neighborCount","newNeighborHash","foundNewNeighbors","neighborHash","noNeighborList","nextRow","blank","yl","nx","ny","zVal","NEIGHBORSHIFTS","correctionOvershoot","maxFractionalChange","iterateInterp2d","emptyPoints","overshoot","neighborShift","neighborRow","neighborVal","neighborSum","minNeighbor","maxNeighbor","v0In","dvIn","numbricks","findInterp","pixel","pixArray","maxBin","bin","pix0","pix1","bin0","bin1","findInterpFromCenters","centerPixArray","putColor","pixels","pxIndex","heatmapLayer","xrev","yrev","imageWidth","imageHeight","canvasW","canvasH","xbi","ybi","pixcount","rcount","gcount","bcount","yinterp","xForPx","yForPx","xPixArray","yPixArray","xinterpArray","findInterpX","findInterpY","interpColor","setColor","createImageData","pxArray","dlen","putImageData","xGap","yGap","xGapLeft","yGapTop","fillStyle","fillRect","avgColor","image3","pixsize","xinterp","z00","z01","z10","z11","coordDefaults","coordStr","xName","zi","allRowsAreArrays","oneRowIsFilled","hasOneNumber","isValidZ","histogramAttrs","makeBinAttrs","histnorm","histfunc","nbinsx","nbinsy","bingroup","xbingroup","ybingroup","binFunctions","normFunctions","doAvg","getBinSpanLabelRound","calcAllAutoBins","makeIncrements","nonuniform","binsToCalc","getRanges","uniqueVals","gapLow","gapHigh","roundFn","xr2c","yr2c","xBinsAndPos","xBinSpec","xPos0","yBinsAndPos","yBinSpec","yPos0","onecol","zerocol","nonuniformBinsX","nonuniformBinsY","xEdges","yEdges","counts","inputPoints","densitynorm","sizeinit","binfunc","normfunc","doavg","xinc","yinc","rawCounterData","xBinSize","xBinStart","xBinEnd","yBinSize","yBinStart","yBinEnd","ipCol","yc2r","uniqueValsPerX","uniqueValsPerY","xVals","yVals","xGapLow","xGapHigh","yGapLow","yGapHigh","heatmapHover","xRange","yRange","hrName","histogram2dAttrs","contourAttrs","cumulative","currentbin","nMax","counterData","avg","oneYear","oneMonth","oneDay","oneHour","oneMin","oneSec","biggestDigitChanged","digit","biggestGuaranteedDigitChanged","nextDigit","didDigitChange","dateParts1","dateParts","dateParts2","leftGap","rightGap","binEdges","disambiguateEdges","dv0","dv1","dv2","edge0","edge1","leftDigit","rightDigit","dashExclude","isRightEdge","dashPos","roundedV","nextV","mainData","_overlayEdgeCase","autoVals","cumulativeSpec","groupName","binOpts","_histogramBinOpts","cleanBound","setBound","newBins","allPos","isFirstVisible","has2dMap","hasHist2dContour","mainDatai","dirs","_autoBin","newBinSpec","sizeFound","overlaidTraceGroup","xid","yid","getConnectedHistograms","pastThisTrace","singleValuedTraces","resulti","binSpeci","isSingleValued","dataVals","handleSingleValueOverlays","traceInputBins","traceBinOptsCalc","mainStart","startIn","hasStart","startFound","traceStart","newStart","mainEnd","endIn","hasEnd","endFound","traceEnd","autoBinAttr","binsAndPos","binSpec","nonuniformBins","densityNorm","sizeInit","binFunc","normFunc","isAvg","pr2c","_roundFnOpts","roundFnOpts","uniqueValsPerBin","currentBin","prevSum","firstHalfPoint","nextHalfPoint","cdf","seriesLen","firstNonzero","lastNonzero","BINATTRS","aStr","BINDIRECTIONS","binDir","allBinOpts","histTraces","mustMatchTracesLookup","otherTracesList","orientation2binDir","fillBinOpts","fallbackGroupName","getAxisType","needsNewItem","aGroupId","binGroupFound","bingroupIn","binGroup","binGroupInDir","attrSpec","nbinsFound","sampleLetter","aggLetter","barHover","percent","probability","density","colormodel","cm","zminDesc","zmaxDesc","cr","zminDflt","zmaxDflt","getImageSize","_hasZ","_hasSource","yrange","_scaler","_sArray","ck","makeScaler","rgba256","hsl","hsla","pixelatedStyle","dataUri","probeSync","Buffer","buff","_canvas","getImageData","fmtColor","hi","colorstring","py","unsupportedBrowsers","cdimage","imageLayer","supportsPixelatedImage","realImage","_realImage","flipX","flipY","ty","_image","drawMagnifiedPixelsOnCanvas","readPixel","ipx","jpx","ipx0","ipx1","jpx0","jpx1","label0","dlabel","colors","scalegroup","insidetextorientation","hole","pull","titleposition","extendedColorWayList","makePullColorFn","generateExtendedColors","colorList","extendedColorWays","hiddenLabels","hasValues","_hasValues","allThisTraceLabels","pullColor","vTotal","isAggregated","hidden","colorWay","dfltColorCount","handleLabelsAndValues","hasLabels","hasPositive","_hasLabels","textInfo","textData","textTemplate","titlePosition","vRounded","formatPiePercent","formatPieValue","getFirstFilled","getRotationAngle","styleOne","piecolorway","extendpiecolors","attachFxHandlers","sliceTop","_hasHoverLabel","_hasHoverEvent","fullLayout2","trace2","rInscribed","hoverCenterX","pxmid","hoverCenterY","percentLabel","originalEvent","determineInsideTextFont","customColor","prerenderTitles","dummyTitle","titleBox","transformInsideText","rpx1","startangle","stopangle","rCenter","textPosAngle","ring","halfAngle","halfangle","midAngle","midangle","isTangential","allTransforms","considerCrossing","stop","isCrossing","dStart","dStop","closestEdge","calcTanTransform","calcRadTransform","textDiameter","calcMaxHalfSize","calcRCenter","calcRotate","tan","getInscribedRadiusFraction","transformOutsideText","outside","positionTitleOutside","plotSize","maxPull","topMiddle","getMaxPull","getTitleSpace","pieBoxHeight","layoutAreas","scaleGroups","area","baseratio","groupScale","getCoords","formatSliceLabel","hasLabel","hasValue","hasPercent","makeTemplateVariables","ptTx","computeTransform","midX","midY","plotGroups","currentCoords","currentAngle","angleFactor","firstPt","setCoords","slices","quadrants","hasOutsideText","slicePath","cxFinal","cyFinal","outerCircle","px0","outerArc","px1","rim","sliceTextGroup","sliceText","determineOutsideTextFont","newFont","textXY","yLabelMin","yLabelMid","yLabelMax","labelExtraX","labelExtraY","finish","titleTextGroup","positionTitleInside","xHalf","yHalf","equatorFirst","farthestX","farthestY","xDiffSign","yDiffSign","thisQuad","oppositeQuad","wholeSide","thisQuadOutside","firstOppositeOutsidePt","topFirst","bottomFirst","scootOneLabel","prevPt","xBuffer","otherPt","newExtraX","prevOuterY","thisInnerY","thisOuterY","thisSliceOuterY","newExtraY","scootLabels","lineStartX","textLinePath","finalX","yFromX","yNet","plotTextLines","traceBbox","vpw","vph","axisPeriod","axisPeriod0","axisPeriodAlignment","stackgroup","groupnorm","stackgaps","PTS_LINESONLY","simplify","calcColorscale","firstScatter","firstScatterGroup","stackOrientation","getStackOpts","xOptions","yOptions","calcMarkerSize","markerTrans","setFirstScatter","stackGroup","stackOpts","stackAx","isV","interpolate","stackGroupOpts","interpolateGaps","posAttr","xAttr","yAttr","hasPeriodX","hasPeriodY","xValid","yValid","minTolerance","toleranceGrowth","maxScreensAway","insertBlank","hasAnyBlanks","newEntry","prevEntry","getInterp","subplotStackOpts","posj","sumj","groupOpts","valAttr","allPositions","_rawLength","cdj","sNorm","arrayPad","ppadRaw","filli","tracej","handleStackDefaults","handleMarkerDefaults","handleLineDefaults","handleLineShapeDefaults","handleTextDefaults","handleFillColorDefaults","defaultMode","dfltHoverOn","fillDflt","inheritColorFromMarker","markerLineColor","subtypes","minRad","kink","dxRaw","dyRaw","_polygons","xCross","inside","yAvg","noDash","LOG_CLIP_PLUS","LOG_CLIP_MINUS","clusterStartPt","clusterEndPt","clusterHighPt","clusterLowPt","clusterHighFirst","clusterUnitVector","thisVector","clusterRefDist","clusterHighVal","clusterLowVal","clusterMinDeviation","clusterMaxDeviation","thisDeviation","latestXFrac","latestYFrac","xLog","yLog","connectGaps","baseTolerance","getPt","linearized","crossesViewport","xFrac0","yFrac0","xFrac1","yFrac1","norm2","getTolerance","nextPt","xFrac","yFrac","offScreenFraction","ptDist","lastXEdge","lastYEdge","lastFarPt","edgePt","getEdgeIntersections","xEdge0","xEdge1","yEdge0","yEdge1","onlyConstrainedPoint","sameEdge","getABAEdgeIntersections","limit0","limit1","ptInt1","ptInt2","midShift","updateEdge","xSame","ySame","xSame2","ySame2","updateEdgesForReentry","intersections","ptCount","ptInt","LINKEDFILLS","tonextx","tonexty","tonext","cdscatter","prevtrace","groupIndex","groupIndices","needsSort","prevGroupIndex","nextGroupIndex","prevUnstackedGroupIndex","_groupIndex","cdscatterSorted","traceA","traceB","prevtraces","_nexttrace","_prevtrace","_ownfill","sizeRef","sizeMin","baseFn","baseSize","noSelect","noLine","getPeriod0Dflt","linePoints","linkTraces","cdscatterAll","yr","mnum","tnum","selectMarkers","errorBarGroup","ownFillEl3","ownFillDir","thispath","thisrevpath","prevRevpath","prevPolygons","_prevRevpath","_nextFill","pathfn","revpathbase","revpathfn","lastSegment","thisPolygons","revpath","_ownFill","isEnter","lineJoin","clearFill","_prevPolygons","showMarkers","markerFilter","hideFilter","textFilter","showFilter","isInferZero","_needsCull","visFilterWithGaps","visFilter","gapFilter","makePoints","clipUrl","scatterLayer","isFullReplot","traceJoin","fillData","fillJoin","createFills","perStackAttrs","firstTrace","dflts","attrFound","traceHasAttr","isOrientation","styleText","dataArrays","arraysToFill","dataArray","fillArray1","fillArray2","displaySum","normSum","aLabel","bLabel","cLabel","scatterHover","scatterPointData","newPointData","yFracUp","textPart","scatterPlot","boxAttrs","bandwidth","scalemode","spanmode","boxCalc","calcBandwidth","ssd","iqr","silvermanRule","calcSpan","spanOut","spanIn","spanTight","spanLoose","calcSpanItem","sc","spanMin","spanMax","maxKDE","maxCount","kde","makeKDE","violinScaleGroupStats","scaleGroup","groupStats","violinList","boxDefaults","spanmodeDflt","boxWidth","boxFillColor","boxLineColor","boxLineWidth","meanLineColor","meanLineWidth","kernels","calcItem","kernel","getPositionOnKdePath","valuePx","pointOnPath","posCenterPx","posOnPath0","getKdeValue","valueDist","posDensityScale","boxHoverPoints","violinLineAttrs","hasHoveronViolins","hasHoveronKDE","closeData","kdePointData","vValPx","kdeVal","pOnPath","paOffset","paLength","violinLine","boxLayoutAttrs","violingap","violingroupgap","boxLayoutDefaults","boxPlot","cdViolins","violinLayer","hasBothSides","hasPositiveSide","hasNegativeSide","violins","pathPos","pathNeg","pathSel","posCenter","endPt","bdPosScaled","meanPaths","boxLine","meanLineStyle","pointsAccessorFunction","aggregations","funcmode","aggAttrs","aggregateOneArray","groupings","aggregation","targetNP","conversions","sortCalc","maxCnt","counti","total2","getAggregateFunction","arrayAttrArray","aggregationOut","aggregationsIn","aggregationsOut","coercei","groupArray","newGrouping","originalPointsAccessor","preservegaps","targetCalendar","attrTargetCalendar","initFn","filterFunc","isOperationIn","d2cValue","cv","getFilterFunc","originalArrays","forAllAttrs","transformOne","state","srcArray","arrayLookup","groupNameObj","groupNames","styleLookup","indexCnts","suppliedName","nameformat","styleIn","styleOut","thisStyle","newTraces","prevIndexToPoints","sortedArray","ac","getSortFunc","getIndices","arrayOld"],"sourceRoot":""}